{"version":3,"file":"static/js/805.199bedbe.chunk.js","mappings":"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","sources":["App.jsx","AppContext.jsx","bucket-lib/utils.js","data/descriptions-data.jsx","data/objectives-data.jsx","data/spatial-data.jsx","settings.jsx","three-resources.jsx","utils/app-utils.jsx","utils/data-utils.jsx","utils/math-utils.jsx","utils/misc-utils.jsx","utils/render-utils.jsx","views/CompareView.jsx","views/ExamineView.jsx","views/WideView.jsx"],"sourcesContent":["import * as d3 from \"d3\";\r\n\r\nimport React, { useCallback, useEffect, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { useStateRef } from \"utils/misc-utils\";\r\nimport { initWaterdrops } from \"utils/app-utils\";\r\n\r\nimport WideView from \"views/WideView\";\r\nimport ExamineView from \"views/ExamineView\";\r\nimport CompareView from \"views/CompareView\";\r\n\r\nimport {\r\n  scene,\r\n  camera,\r\n  renderer,\r\n  dropsMesh,\r\n  pointsMesh,\r\n} from \"three-resources\";\r\n\r\n// pre-calculate these so we don't lag later\r\nconst waterdrops = initWaterdrops(\"objective\");\r\n\r\nconst appWidth = window.innerWidth,\r\n  appHeight = window.innerHeight;\r\n\r\nrenderer.setSize(appWidth, appHeight);\r\n\r\nconsole.time(\"drops mesh creating\");\r\ndropsMesh.createMesh(waterdrops);\r\nconsole.timeEnd(\"drops mesh creating\");\r\n\r\n// pointsMesh.createMesh(waterdrops);\r\n\r\nexport default function App() {\r\n  const [state, setState, stateRef] = useStateRef({});\r\n  const [zoomCallbacks, setZoomCallbacks, zoomCallbacksRef] = useStateRef([]);\r\n  const [activeWaterdrops, setActiveWaterdrops] = useState([]);\r\n  const [goBack, setGoBack] = useState(null);\r\n  const [\r\n    disableCamAdjustments,\r\n    setDisableCamAdjustments,\r\n    disableCamAdjustmentsRef,\r\n  ] = useStateRef(false);\r\n\r\n  const getOutlineOpac = useCallback(\r\n    d3\r\n      .scaleLinear()\r\n      .domain([\r\n        appHeight / waterdrops.height,\r\n        appHeight / waterdrops.groups[0].height,\r\n      ])\r\n      .range([0.1, 1])\r\n      .clamp(true),\r\n    []\r\n  );\r\n\r\n  useEffect(function initialize() {\r\n    document.querySelector(\"#mosaic-webgl\").appendChild(renderer.domElement);\r\n\r\n    d3.select(\"#mosaic-svg\")\r\n      .attr(\"width\", appWidth)\r\n      .attr(\"height\", appHeight)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-trans\");\r\n\r\n    camera.mount(\r\n      d3.select(\".bubbles-wrapper\").node(),\r\n      d3.select(\"#mosaic-svg\").select(\".svg-trans\").node()\r\n    );\r\n    camera.setZoomFn((transform) => {\r\n      if (!disableCamAdjustmentsRef.current) {\r\n        dropsMesh.updateOutlineVisibility(getOutlineOpac(transform.k));\r\n      }\r\n\r\n      for (const cb of zoomCallbacksRef.current) cb(transform);\r\n    });\r\n    camera.setSize(appWidth, appHeight);\r\n\r\n    renderer.setAnimationLoop(() => {\r\n      renderer.render(scene, camera.camera);\r\n    });\r\n\r\n    resetCamera(false);\r\n    setState({ state: \"WideView\" });\r\n  }, []);\r\n\r\n  const resetCamera = useCallback((animated = true, callback) => {\r\n    const pos = [\r\n      0,\r\n      -waterdrops.height * 0.08,\r\n      camera.getZFromFarHeight(waterdrops.height),\r\n    ];\r\n    if (animated) {\r\n      const { start } = zoomTo(pos, callback);\r\n      start();\r\n    } else {\r\n      camera.callZoomFromWorldViewport({\r\n        worldX: pos[0],\r\n        worldY: -pos[1],\r\n        farHeight: waterdrops.height,\r\n      });\r\n      callback && callback();\r\n    }\r\n  }, []);\r\n\r\n  const zoomTo = useCallback((xyz, callback) => {\r\n    const i = camera.interpolateZoomCamera(xyz);\r\n\r\n    const duration = i.duration / 2;\r\n\r\n    const start = () => {\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(elapsed / duration, 1);\r\n        camera.callZoom(i(et));\r\n\r\n        if (et === 1) {\r\n          t.stop();\r\n          callback && callback();\r\n        }\r\n      });\r\n    };\r\n\r\n    return {\r\n      start,\r\n      duration,\r\n    };\r\n  }, []);\r\n\r\n  const addZoomHandler = useCallback((cb) => {\r\n    setZoomCallbacks((cbs) => [...cbs, cb]);\r\n  }, []);\r\n\r\n  return (\r\n    <AppContext.Provider\r\n      value={{\r\n        appWidth,\r\n        appHeight,\r\n        state,\r\n        setState,\r\n        activeWaterdrops,\r\n        setActiveWaterdrops,\r\n        setDisableCamAdjustments,\r\n        waterdrops,\r\n        scene,\r\n        camera,\r\n        renderer,\r\n        pointsMesh,\r\n        dropsMesh,\r\n        setGoBack,\r\n        zoomTo,\r\n        resetCamera,\r\n        getOutlineOpac,\r\n        addZoomHandler,\r\n      }}\r\n    >\r\n      <div className=\"bubbles-wrapper\">\r\n        <div id=\"mosaic-webgl\"></div>\r\n        <svg id=\"mosaic-svg\"></svg>\r\n      </div>\r\n      <WideView />\r\n      <ExamineView />\r\n      <CompareView />\r\n      {goBack && (\r\n        <button className=\"go-back-btn\" onClick={goBack}>\r\n          ←\r\n        </button>\r\n      )}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n","import { createContext } from \"react\";\r\n\r\nexport const AppContext = createContext({});\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\n// inclusive\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n\r\nexport const interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const DESCRIPTIONS_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./descriptions.json\")).json();\r\n\r\n  console.log(\"DATA: loading descriptions data\");\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n})();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { clamp } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst SCEN_DIVISOR = 1; // debugging purposes, don't render all scenarios to speed things up\r\n\r\nexport const MAX_DELIVS = 1200;\r\nexport const SCENARIO_KEY_STRING = \"scens\";\r\nexport const DELIV_KEY_STRING = \"delivs\";\r\n\r\nexport const OBJECTIVES_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./objectives.json\")).json();\r\n\r\n  for (const obj of objs) {\r\n    obj[SCENARIO_KEY_STRING] = obj[SCENARIO_KEY_STRING];\r\n    for (const scen of obj[SCENARIO_KEY_STRING]) {\r\n      // data cleanup, clamping\r\n      const unord = scen[DELIV_KEY_STRING].map((v) => clamp(v, 0, MAX_DELIVS));\r\n\r\n      scen[DELIV_KEY_STRING] = Array.from(unord).sort((a, b) => b - a);\r\n    }\r\n    obj[SCENARIO_KEY_STRING] = mapBy(\r\n      obj[SCENARIO_KEY_STRING],\r\n      ({ name }) => name\r\n    );\r\n  }\r\n\r\n  console.log(\"DATA: loading objectives data\");\r\n\r\n  return mapBy(objs, ({ obj }) => obj);\r\n})();\r\n\r\nexport const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\nconst _SCENARIO_IDS = Object.keys(\r\n  Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n);\r\n\r\nexport const SCENARIO_IDS = _SCENARIO_IDS.filter(\r\n  (_, i) => i % SCEN_DIVISOR === 0\r\n);\r\n\r\n// Flattening hierarchical data makes it more flexible for classifying\r\n// (from experience). id conveniently corresponds to index.\r\n// Also cache classifications (by objective and by scenario, for now)\r\nexport const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n  const flattenedData = [];\r\n  const dataGroupings = {\r\n    objective: {},\r\n    scenario: {},\r\n  };\r\n\r\n  // for ordering later\r\n  const means = [];\r\n\r\n  let idx = 0;\r\n  for (const obj of OBJECTIVE_IDS) {\r\n    for (const scen of SCENARIO_IDS) {\r\n      if (!dataGroupings[\"objective\"][obj])\r\n        dataGroupings[\"objective\"][obj] = [];\r\n\r\n      if (!dataGroupings[\"scenario\"][scen])\r\n        dataGroupings[\"scenario\"][scen] = [];\r\n\r\n      dataGroupings[\"objective\"][obj].push(idx);\r\n      dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n      const deliveries =\r\n        OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n      flattenedData.push({\r\n        id: idx,\r\n        objective: obj,\r\n        scenario: scen,\r\n        deliveries,\r\n      });\r\n\r\n      means.push(d3.mean(deliveries));\r\n\r\n      idx++;\r\n    }\r\n  }\r\n\r\n  const orderedDataGroupings = {};\r\n\r\n  for (const criteria of Object.keys(dataGroupings)) {\r\n    const asdfasdf = [];\r\n    for (const key of Object.keys(dataGroupings[criteria])) {\r\n      const ids = dataGroupings[criteria][key];\r\n      const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n      asdfasdf.push({\r\n        key,\r\n        sorted: sortedObjScens,\r\n        mean: d3.mean(ids.map((id) => flattenedData[id].deliveries).flat()),\r\n      });\r\n    }\r\n\r\n    const sortedObjScens = asdfasdf.sort((a, b) => b.mean - a.mean);\r\n\r\n    orderedDataGroupings[criteria] = {};\r\n\r\n    for (let i = 0; i < sortedObjScens.length; i++) {\r\n      const { key, sorted } = sortedObjScens[i];\r\n      const IDtoRank = {};\r\n\r\n      for (let j = 0; j < sorted.length; j++) {\r\n        IDtoRank[sorted[j]] = j;\r\n      }\r\n      orderedDataGroupings[criteria][key] = IDtoRank;\r\n      orderedDataGroupings[criteria][key].rank = i;\r\n    }\r\n  }\r\n\r\n  return [flattenedData, orderedDataGroupings];\r\n})();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const SPATIAL_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./callite_spatial.json\")).json();\r\n\r\n  console.log(\"DATA: loading callite spatial data\");\r\n\r\n  return objs;\r\n})();\r\n\r\nexport const SPATIAL_FEATURES = (function () {\r\n  return mapBy(SPATIAL_DATA.features, ({ properties }) => properties.CalLiteID);\r\n})();\r\n\r\nexport const CALIFORNIA_OUTLINE = await (async function load() {\r\n  const objs = await (await fetch(\"./california.json\")).json();\r\n\r\n  console.log(\"DATA: loading california spatial data\");\r\n\r\n  return objs;\r\n})();\r\n","export const LOD_1_LEVELS = 5;\r\nexport const LOD_1_RAD_PX = 1;\r\nexport const LOD_1_MIN_LEV_VAL = 0.1;\r\nexport const LOD_1_SMALL_DROP_PAD_FACTOR = 1.3;\r\nexport const LOD_1_LARGE_DROP_PAD_FACTOR = 1.2;\r\n\r\nexport const LOD_2_SMALL_DROP_PAD_FACTOR = 3;\r\n\r\nexport const GROUP_HOVER_AREA_FACTOR = 1.1 / (1 + Math.SQRT1_2);\r\n","import * as THREE from \"three\";\r\nimport * as d3 from \"d3\";\r\n\r\nimport {\r\n  WaterdropMesh,\r\n  WaterdropSimplifiedMesh,\r\n  Camera,\r\n} from \"utils/render-utils\";\r\n\r\nconst scene = (function getScene() {\r\n  const s = new THREE.Scene();\r\n  s.background = new THREE.Color(0xefefef);\r\n  return s;\r\n})();\r\n\r\nconst dropsMesh = new WaterdropMesh();\r\nconst pointsMesh = new WaterdropSimplifiedMesh();\r\n\r\nconst camera = new Camera({\r\n  fov: 45,\r\n  near: 1,\r\n  far: 3000,\r\n});\r\n\r\nconst renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\r\nexport { scene, camera, renderer, dropsMesh, pointsMesh };\r\n","import { ticksExact } from \"bucket-lib/utils\";\r\nimport {\r\n  LOD_1_LARGE_DROP_PAD_FACTOR,\r\n  LOD_1_LEVELS,\r\n  LOD_1_MIN_LEV_VAL,\r\n  LOD_1_RAD_PX,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\n\r\nimport {\r\n  DATA_GROUPINGS,\r\n  FLATTENED_DATA,\r\n  MAX_DELIVS,\r\n  OBJECTIVE_IDS,\r\n  SCENARIO_IDS,\r\n} from \"data/objectives-data\";\r\n\r\nimport { calcDomLev, createInterpsFromDelivs } from \"utils/data-utils\";\r\nimport { placeDropsUsingPhysics } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\n// TODO optimize!!\r\nexport function initWaterdrops(grouping) {\r\n  const groupKeys = grouping === \"objective\" ? OBJECTIVE_IDS : SCENARIO_IDS;\r\n  const memberKeys = grouping === \"objective\" ? SCENARIO_IDS : OBJECTIVE_IDS;\r\n\r\n  const amtGroups = groupKeys.length;\r\n  const amtPerGroup = memberKeys.length;\r\n\r\n  const largeDropRad =\r\n    Math.sqrt(amtPerGroup / Math.PI) *\r\n    LOD_1_RAD_PX *\r\n    2 *\r\n    LOD_1_SMALL_DROP_PAD_FACTOR *\r\n    LOD_1_LARGE_DROP_PAD_FACTOR;\r\n  const smallDropRad = LOD_1_RAD_PX * LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  const largeNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    groupKeys.map((p, idx) => ({\r\n      r: largeDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const largeNodesPos = mapBy(largeNodesPhys, ({ id }) => id);\r\n\r\n  const smallNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    memberKeys.map((s, idx) => ({\r\n      r: smallDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const smallNodesPos = mapBy(smallNodesPhys, ({ id }) => id);\r\n\r\n  const nodes = [];\r\n  const groupNodes = [];\r\n\r\n  const groupToNodes = {};\r\n\r\n  let idx = 0;\r\n\r\n  for (const nodeData of FLATTENED_DATA) {\r\n    const { id, objective, scenario, deliveries } = nodeData;\r\n\r\n    const i = createInterpsFromDelivs(deliveries, MAX_DELIVS);\r\n    const wds = ticksExact(0, 1, LOD_1_LEVELS + 1).map((d) => i(d));\r\n\r\n    const levs = wds.map(\r\n      (w, i) => Math.max(w, i == 0 ? LOD_1_MIN_LEV_VAL : 0) * LOD_1_RAD_PX\r\n    );\r\n\r\n    const groupID = grouping === \"objective\" ? objective : scenario;\r\n    const memberID = grouping === \"objective\" ? scenario : objective;\r\n\r\n    const groupRank = DATA_GROUPINGS[grouping][groupID].rank;\r\n    const memberRank = DATA_GROUPINGS[grouping][groupID][id];\r\n\r\n    const node = {\r\n      id,\r\n      levs,\r\n      maxLev: LOD_1_RAD_PX,\r\n      domLev: calcDomLev(levs),\r\n      tilt: Math.random() * 50 - 25,\r\n      dur: Math.random() * 100 + 400,\r\n      x: smallNodesPos[memberRank].x,\r\n      y: smallNodesPos[memberRank].y,\r\n      group: groupID,\r\n      key: memberID,\r\n      globalX: largeNodesPos[groupRank].x + smallNodesPos[memberRank].x,\r\n      globalY: largeNodesPos[groupRank].y + smallNodesPos[memberRank].y,\r\n    };\r\n\r\n    nodes.push(node);\r\n\r\n    if (!groupToNodes[groupID]) groupToNodes[groupID] = [];\r\n\r\n    groupToNodes[groupID].push(node);\r\n  }\r\n\r\n  for (const groupKey of groupKeys) {\r\n    groupNodes.push({\r\n      x: largeNodesPos[DATA_GROUPINGS[grouping][groupKey].rank].x,\r\n      y: largeNodesPos[DATA_GROUPINGS[grouping][groupKey].rank].y,\r\n      tilt: Math.random() * 50 - 25,\r\n      key: groupKey,\r\n      height: smallNodesPhys.height,\r\n      nodes: groupToNodes[groupKey],\r\n    });\r\n  }\r\n\r\n  return {\r\n    nodes: nodes,\r\n    groups: groupNodes,\r\n    height: largeNodesPhys.height,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\n\r\nimport { SCENARIO_KEY_STRING, DELIV_KEY_STRING } from \"data/objectives-data\";\r\n\r\nexport function createInterps(obj_name, scen_name, data, maxDelivs) {\r\n  const delivs =\r\n    data[obj_name][SCENARIO_KEY_STRING][scen_name][DELIV_KEY_STRING];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\nexport function createInterpsFromDelivs(delivs, maxDelivs) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\n// TODO fix colors\r\nexport function calcDomLev(levs) {\r\n  levs = [1, ...levs, 0];\r\n\r\n  let mean = 0;\r\n  for (let i = 0; i < levs.length - 1; i++) {\r\n    const dif = levs[i] - levs[i + 1];\r\n    mean += (dif * (i - 1)) / (levs.length + 4);\r\n  }\r\n\r\n  return mean;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport Matter from \"matter-js\";\r\nimport { CIRC_RAD, DROP_HEIGHT } from \"./render-utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor((Math.sqrt(AREA / 3.14) * 2) / 2);\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes, reuse = false) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r));\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\nexport function percentToRatioFilled(p) {\r\n  p -= 0.0088;\r\n  return clamp(\r\n    (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326,\r\n    0,\r\n    1\r\n  );\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport function interp(x, a, b) {\r\n  return x * (b - a) + a;\r\n}\r\n\r\nexport function revInterp(t, a, b) {\r\n  return (t - a) / (b - a);\r\n}\r\n\r\nexport function distSq([x1, y1], [x2, y2]) {\r\n  return (x2 - x1) ** 2 + (y2 - y1) ** 2;\r\n}\r\n\r\nexport function dist([x1, y1], [x2, y2]) {\r\n  return Math.sqrt(distSq([x1, y1], [x2, y2]));\r\n}\r\n\r\nexport function getCenterDomRect(domRect) {\r\n  return [domRect.left + domRect.width / 2, domRect.top + domRect.height / 2];\r\n}\r\n","// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    if (typeof v === \"function\")\r\n      _setState((curVal) => (stateRef.current = v(curVal)));\r\n    else _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n\r\nexport function isState(stateInfo, stateName) {\r\n  return stateInfo && stateInfo.state === stateName;\r\n}\r\n\r\nexport function wrap(s) {\r\n  return s.replace(/(?![^\\n]{1,15}$)([^\\n]{1,15})\\s/g, \"$1\\n\");\r\n}\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\nimport { LOD_1_LEVELS } from \"settings\";\r\nimport { sortBy } from \"./misc-utils\";\r\nimport { toRadians } from \"./math-utils\";\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport const CIRC_RAD = Math.SQRT1_2;\r\nexport const DROP_RAD = 1;\r\nexport const CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nexport const DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = 0.75;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return {\r\n    x: (mouseX / width) * 2 - 1,\r\n    y: -(mouseY / height) * 2 + 1,\r\n  };\r\n}\r\n\r\nclass MeshGeometry {\r\n  threeGeom = new THREE.BufferGeometry();\r\n  triangleIdx = 0;\r\n  positionAttribute;\r\n  colorAttribute;\r\n\r\n  constructor(numPoints, color = true) {\r\n    this.threeGeom.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n    );\r\n\r\n    if (color)\r\n      this.threeGeom.setAttribute(\r\n        \"color\",\r\n        new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n      );\r\n\r\n    this.positionAttribute = this.threeGeom.getAttribute(\"position\");\r\n    this.colorAttribute = this.threeGeom.getAttribute(\"color\");\r\n  }\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = meshCoords[j];\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 0,\r\n        transform.x + v1[0],\r\n        transform.y - v1[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 1,\r\n        transform.x + v2[0],\r\n        transform.y - v2[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 2,\r\n        transform.x + v3[0],\r\n        transform.y - v3[1],\r\n        z\r\n      );\r\n\r\n      if (color) {\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 0,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 1,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 2,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n      }\r\n\r\n      this.triangleIdx++;\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    this.threeGeom.setDrawRange(0, this.triangleIdx * 3);\r\n  }\r\n}\r\n\r\nexport class WaterdropMesh {\r\n  static MAX_POINTS_DROPS = 60 * 13e4; // approx num verts per droplet * approx num droplets on screen\r\n  static MAX_POINTS_OUTLINE = 40 * 13e4; // approx num verts per droplet * approx num droplets on screen\r\n\r\n  dropsMesh;\r\n  outlineMesh;\r\n\r\n  added = false;\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.dropsMesh) {\r\n      this.initializeMeshes(waterdrops);\r\n    } else {\r\n      this.updateMeshes(waterdrops);\r\n    }\r\n  }\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.dropsMesh);\r\n      scene.add(this.outlineMesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.dropsMesh);\r\n      scene.remove(this.outlineMesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  initializeMeshes(waterdrops) {\r\n    const dropsGeometry = new MeshGeometry(WaterdropMesh.MAX_POINTS_DROPS);\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = waterdropDeltaOutline(\r\n      0,\r\n      1,\r\n      LOD_1_RAD_PX * 2 * 0.975\r\n    );\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, maxLev } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = waterdropDelta(\r\n          l1 / maxLev,\r\n          l2 / maxLev,\r\n          LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / LOD_1_LEVELS)\r\n        );\r\n\r\n        dropsGeometry.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      outlinePoints.push(\r\n        ...outlineMeshCoords.map(\r\n          ([dx, dy]) => new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01)\r\n        )\r\n      );\r\n    }\r\n\r\n    dropsGeometry.finish();\r\n\r\n    this.dropsMesh = new THREE.Mesh(\r\n      dropsGeometry.threeGeom,\r\n      new THREE.MeshBasicMaterial({\r\n        vertexColors: true,\r\n        transparent: true,\r\n        opacity: 1,\r\n      })\r\n    );\r\n\r\n    this.outlineMesh = new THREE.LineSegments(\r\n      new THREE.BufferGeometry().setFromPoints(outlinePoints),\r\n      new THREE.LineBasicMaterial({\r\n        color: 0xcccccc,\r\n        transparent: true,\r\n        opacity: 0,\r\n      })\r\n    );\r\n  }\r\n\r\n  updateOutlineVisibility(opac) {\r\n    if (!this.outlineMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateVisibility(opac) {\r\n    if (!this.outlineMesh || !this.dropsMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n    this.dropsMesh.material.opacity = opac;\r\n    this.dropsMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateMeshes(waterdrops) {\r\n    // TODO fix\r\n  }\r\n}\r\n\r\nexport class WaterdropSimplifiedMesh {\r\n  mesh;\r\n  added = false;\r\n\r\n  vertToId = {};\r\n  idToVert = {};\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.mesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.mesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.mesh) {\r\n      this.initializeMesh(waterdrops);\r\n    }\r\n\r\n    this.updateMesh(waterdrops);\r\n\r\n    return this.mesh;\r\n  }\r\n\r\n  initializeMesh(waterdrops) {\r\n    const pointsGeometry = new THREE.BufferGeometry();\r\n\r\n    const vertices = [];\r\n    const colors = [];\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, domLev } = waterdrops.nodes[i];\r\n\r\n      const color = domLev > 0 ? interpolateWatercolorBlue(domLev) : \"white\";\r\n\r\n      vertices.push(x, -y, 0);\r\n      const t_color = new THREE.Color(color);\r\n      colors.push(t_color.r, t_color.g, t_color.b);\r\n\r\n      this.vertToId[i] = id;\r\n      this.idToVert[id] = i;\r\n    }\r\n\r\n    const pointsMaterial = new THREE.PointsMaterial({\r\n      size: LOD_1_RAD_PX * 2,\r\n      sizeAttenuation: true,\r\n      vertexColors: true,\r\n      map: new THREE.TextureLoader().load(\"drop.png\"),\r\n      transparent: true,\r\n    });\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(vertices), 3)\r\n    );\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"color\",\r\n      new THREE.BufferAttribute(new Float32Array(colors), 3)\r\n    );\r\n\r\n    this.mesh = new THREE.Points(pointsGeometry, pointsMaterial);\r\n  }\r\n\r\n  updateMesh(waterdrops) {\r\n    const positionAttr = this.mesh.geometry.getAttribute(\"position\");\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: newX, globalY: newY } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n      positionAttr.setXY(idx, newX, -newY);\r\n    }\r\n    positionAttr.needsUpdate = true;\r\n  }\r\n\r\n  updatePoints(waterdrops, translations, dt) {\r\n    const verts = this.mesh.geometry.vertices;\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n\r\n      const [dx, dy] = translations[id];\r\n\r\n      const x = verts[idx].x;\r\n      const y = verts[idx].y;\r\n\r\n      verts[idx].setX(x + dt * dx);\r\n      verts[idx].setY(y - dt * dy);\r\n    }\r\n\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n\r\n  intersectObject(camera, x, y) {\r\n    const intersects = camera.intersectObject(x, y, this.mesh);\r\n\r\n    if (intersects[0]) {\r\n      const intersect = sortBy(intersects, \"distanceToRay\")[0];\r\n      return this.vertToId[intersect.index];\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  view;\r\n  curTransform;\r\n\r\n  raycaster = new THREE.Raycaster();\r\n\r\n  _svgElement;\r\n\r\n  constructor({ fov, near, far }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n  }\r\n\r\n  setZoomFn(zoomFn) {\r\n    this.zoom = d3.zoom().on(\"zoom\", (e) => {\r\n      this.curTransform = e.transform;\r\n\r\n      this._THREEZoomHandler(e.transform);\r\n      d3.select(this._svgElement).attr(\"transform\", e.transform);\r\n\r\n      zoomFn && zoomFn(e.transform);\r\n    });\r\n  }\r\n\r\n  callZoom(transform) {\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity.translate(transform.x, transform.y).scale(transform.k)\r\n    );\r\n  }\r\n\r\n  callZoomFromWorldViewport({ worldX, worldY, farHeight }) {\r\n    const k = this.height / farHeight;\r\n\r\n    const x = -(worldX * k) + this.width / 2;\r\n    const y = worldY * k + this.height / 2;\r\n\r\n    this.callZoom({\r\n      x,\r\n      y,\r\n      k,\r\n    });\r\n  }\r\n\r\n  getZFromFarHeight(farHeight) {\r\n    return (Math.tan(toRadians(90 - this.fov / 2)) * farHeight) / 2;\r\n  }\r\n\r\n  getFarHeightFromZ(z) {\r\n    return Math.tan(toRadians(this.fov) / 2) * z * 2;\r\n  }\r\n\r\n  interpolateZoomCamera([endx, endy, endz]) {\r\n    const i = d3.interpolateZoom(\r\n      [\r\n        this.camera.position.x,\r\n        this.camera.position.y,\r\n        this.height / this.curTransform.k,\r\n      ],\r\n      [endx, -endy, this.getFarHeightFromZ(endz)]\r\n    );\r\n\r\n    const interper = (t) => {\r\n      const [worldX, worldY, farHeight] = i(t);\r\n\r\n      const k = this.height / farHeight;\r\n\r\n      const x = -(worldX * k) + this.width / 2;\r\n      const y = worldY * k + this.height / 2;\r\n\r\n      return {\r\n        x,\r\n        y,\r\n        k,\r\n      };\r\n    };\r\n\r\n    interper.duration = i.duration;\r\n\r\n    return interper;\r\n  }\r\n\r\n  mount(webglElement, svgElement) {\r\n    this.view = d3.select(webglElement);\r\n    this._svgElement = svgElement;\r\n  }\r\n\r\n  setSize(width, height) {\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.zoom = this.zoom.scaleExtent([\r\n      this.getScaleFromZ(this.far),\r\n      this.getScaleFromZ(this.near),\r\n    ]);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      this.fov,\r\n      width / height,\r\n      this.near,\r\n      this.far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.view.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  _THREEZoomHandler(transform) {\r\n    const scale = transform.k;\r\n    const x = -(transform.x - this.width / 2) / scale;\r\n    const y = (transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n\r\n  getScaleFromZ(camera_z_position) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const half_fov_height = Math.tan(half_fov_radians) * camera_z_position;\r\n    const fov_height = half_fov_height * 2;\r\n    const scale = this.height / fov_height;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const scale_height = this.height / scale;\r\n    const camera_z_position = scale_height / (2 * Math.tan(half_fov_radians));\r\n    return camera_z_position;\r\n  }\r\n\r\n  intersectObject(mouseX, mouseY, mesh) {\r\n    this.raycaster.setFromCamera(\r\n      {\r\n        x: mouseX,\r\n        y: mouseY,\r\n      },\r\n      this.camera\r\n    );\r\n\r\n    return this.raycaster.intersectObject(mesh);\r\n  }\r\n}\r\n","import { AppContext } from \"AppContext\";\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\nimport {\r\n  LOD_1_RAD_PX,\r\n  LOD_1_LEVELS,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n  LOD_2_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { DROPLET_SHAPE } from \"utils/render-utils\";\r\n\r\nconst SPREAD = LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\nexport default function CompareView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n  } = useContext(AppContext);\r\n\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const groupsRef = useRef();\r\n\r\n  useEffect(() => {\r\n    if (activeMinidrop) {\r\n      const positions = [];\r\n      for (let i = 0; i < groupsRef.current.groups.length; i++) {\r\n        const group = groupsRef.current.groups[i];\r\n        const groupPos = groupsRef.current.groupPositions[i];\r\n\r\n        const node = group.nodes.find((n) => n.key === activeMinidrop);\r\n\r\n        positions.push([\r\n          (node.x * LOD_2_SMALL_DROP_PAD_FACTOR) / LOD_1_SMALL_DROP_PAD_FACTOR +\r\n            groupPos[0],\r\n          (node.y * LOD_2_SMALL_DROP_PAD_FACTOR) / LOD_1_SMALL_DROP_PAD_FACTOR +\r\n            groupPos[1],\r\n        ]);\r\n      }\r\n\r\n      const lines = [];\r\n\r\n      const height = LOD_1_RAD_PX * 2;\r\n      for (let i = 0; i < positions.length; i++) {\r\n        const from = Array.from(positions[i]),\r\n          to = Array.from(positions[i + 1 == positions.length ? 0 : i + 1]);\r\n\r\n        const len = Math.sqrt((from[0] - to[0]) ** 2 + (from[1] - to[1]) ** 2);\r\n        const normed = [(to[0] - from[0]) / len, (to[1] - from[1]) / len];\r\n\r\n        from[0] += normed[0] * height;\r\n        from[1] += normed[1] * height;\r\n        to[0] -= normed[0] * height;\r\n        to[1] -= normed[1] * height;\r\n\r\n        lines.push([from, to]);\r\n      }\r\n\r\n      d3.select(\"#mosaic-svg\")\r\n        .select(\".svg-trans\")\r\n        .selectAll(\".compCirclet\")\r\n        .data(positions)\r\n        .join(\"circle\")\r\n        .attr(\"class\", \"compCirclet\")\r\n        .attr(\"display\", \"initial\")\r\n        .style(\"pointer-events\", \"none\")\r\n        .attr(\"fill\", \"transparent\")\r\n        .attr(\"stroke\", \"orange\")\r\n        .attr(\"stroke-dasharray\", 3)\r\n        .attr(\"stroke-width\", 3)\r\n        .attr(\"vector-effect\", \"non-scaling-stroke\")\r\n        .attr(\"r\", (height / 2) * 1.2)\r\n        .transition()\r\n        .duration(100)\r\n        .attr(\"cx\", (d) => d[0])\r\n        .attr(\"cy\", (d) => d[1] - height * 0.08);\r\n\r\n      d3.select(\"#mosaic-svg\")\r\n        .select(\".svg-trans\")\r\n        .selectAll(\".compLines\")\r\n        .data(lines)\r\n        .join(\"path\")\r\n        .attr(\"class\", \"compLines\")\r\n        .attr(\"stroke\", \"orange\")\r\n        .attr(\"stroke-dasharray\", 3)\r\n        .attr(\"opacity\", 0.5)\r\n        .attr(\"stroke-width\", 1)\r\n        .attr(\"vector-effect\", \"non-scaling-stroke\")\r\n        .transition()\r\n        .duration(100)\r\n        .attr(\"d\", (d) => d3.line()(d));\r\n    }\r\n  }, [activeMinidrop]);\r\n\r\n  useEffect(\r\n    function update() {\r\n      if (isState(state, \"CompareView\")) {\r\n        const container = d3.select(\"#mosaic-svg\").select(\".svg-trans\");\r\n\r\n        updateDropsSVG(\r\n          container,\r\n          (groupsRef.current = getWaterdropGroups(\r\n            activeWaterdrops,\r\n            waterdrops,\r\n            state.avgCoord\r\n          )),\r\n          state.transitionDuration / 5,\r\n          {\r\n            onHover: (d) => {\r\n              setActiveMinidrop(d.key);\r\n            },\r\n          }\r\n        );\r\n\r\n        setGoBack(() => () => {\r\n          setState({ state: \"WideView\" });\r\n\r\n          resetCamera();\r\n        });\r\n\r\n        return () => {\r\n          d3.select(\"#mosaic-svg\")\r\n            .select(\".svg-trans\")\r\n            .selectAll(\".compLargeDrop\")\r\n            .remove();\r\n          d3.select(\"#mosaic-svg\")\r\n            .select(\".svg-trans\")\r\n            .selectAll(\".compCirclet\")\r\n            .remove();\r\n          d3.select(\"#mosaic-svg\")\r\n            .select(\".svg-trans\")\r\n            .selectAll(\".compLines\")\r\n            .remove();\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n}\r\n\r\nfunction getWaterdropGroups(keyArr, waterdrops, center) {\r\n  const groups = waterdrops.groups.filter((g) => keyArr.includes(g.key));\r\n\r\n  const groupPositions = [];\r\n  const rad = groups[0].height * SPREAD * 0.75;\r\n\r\n  for (let i = 0, n = groups.length; i < n; i++) {\r\n    groupPositions.push([\r\n      center[0] + Math.cos(((Math.PI * 2) / n) * i) * rad,\r\n      center[1] + Math.sin(((Math.PI * 2) / n) * i) * rad,\r\n    ]);\r\n  }\r\n\r\n  return {\r\n    groups,\r\n    groupPositions,\r\n  };\r\n}\r\n\r\nfunction updateDropsSVG(\r\n  container,\r\n  waterdropGroups,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  container\r\n    .selectAll(\".compLargeDrop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"compLargeDrop\")\r\n        .each(function ({ nodes }) {\r\n          d3.select(this)\r\n            .selectAll(\".compSmallDrop\")\r\n            .data(nodes)\r\n            .enter()\r\n            .append(\"g\")\r\n            .attr(\"class\", \"compSmallDrop\")\r\n            .each(function ({ levs }) {\r\n              const s = d3.select(this);\r\n              s.append(\"rect\")\r\n                .attr(\"class\", \"bbox\")\r\n                .style(\"visibility\", \"hidden\");\r\n\r\n              const randId = Math.floor(Math.random() * 1e9);\r\n\r\n              const stops = d3\r\n                .select(this)\r\n                .append(\"defs\")\r\n                .append(\"linearGradient\")\r\n                .attr(\"id\", `${randId}`)\r\n                .attr(\"x1\", \"0%\")\r\n                .attr(\"x2\", \"0%\")\r\n                .attr(\"y1\", \"0%\")\r\n                .attr(\"y2\", \"100%\");\r\n              stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n              stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n              levs.forEach((_, i) => {\r\n                stops\r\n                  .append(\"stop\")\r\n                  .attr(\r\n                    \"stop-color\",\r\n                    interpolateWatercolorBlue(i / LOD_1_LEVELS)\r\n                  );\r\n                stops\r\n                  .append(\"stop\")\r\n                  .attr(\r\n                    \"stop-color\",\r\n                    interpolateWatercolorBlue(i / LOD_1_LEVELS)\r\n                  );\r\n              });\r\n\r\n              s.append(\"path\")\r\n                .attr(\"d\", DROPLET_SHAPE)\r\n                .attr(\"class\", \"outline\")\r\n                .attr(\"fill\", \"none\")\r\n                .attr(\"stroke\", \"lightgray\")\r\n                .attr(\"stroke-width\", 0.05);\r\n\r\n              s.append(\"path\")\r\n                .attr(\"class\", \"fill\")\r\n                .attr(\"d\", DROPLET_SHAPE)\r\n                .attr(\"fill\", `url(#${randId})`);\r\n            });\r\n        });\r\n    })\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\"transform\", ({ x, y }, i) => `translate(${x}, ${y})`)\r\n    .each(function ({ nodes }) {\r\n      d3.select(this)\r\n        .selectAll(\".compSmallDrop\")\r\n        .data(nodes)\r\n        .attr(\"display\", \"initial\")\r\n        .attr(\"transform\", ({ x, y }) => `translate(${x}, ${y})`)\r\n        .on(\"click\", function (e, d) {\r\n          onClick && onClick(d);\r\n        })\r\n        .on(\"mouseenter\", function (e, d) {\r\n          onHover && onHover(d);\r\n        })\r\n        .on(\"mouseleave\", function (e, d) {\r\n          onUnhover && onUnhover(d);\r\n        })\r\n        .each(function ({ levs, maxLev }, i) {\r\n          const s = d3.select(this);\r\n\r\n          s.select(\".outline\").attr(\r\n            \"transform\",\r\n            `scale(${LOD_1_RAD_PX * 0.95})`\r\n          );\r\n          s.select(\".fill\").attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n\r\n          s.selectAll(\"stop\").each(function (_, i) {\r\n            let actI = Math.floor(i / 2);\r\n            const isEnd = i % 2;\r\n\r\n            if (isEnd === 0) actI -= 1;\r\n\r\n            if (actI === -1) {\r\n              d3.select(this).attr(\"offset\", `${0}%`);\r\n            } else if (actI === levs.length) {\r\n              d3.select(this).attr(\"offset\", `100%`);\r\n            } else {\r\n              d3.select(this).attr(\r\n                \"offset\",\r\n                `${(1 - levs[actI] / maxLev) * 100}%`\r\n              );\r\n            }\r\n          });\r\n\r\n          const d = s.select(\".fill\");\r\n\r\n          s.select(\".bbox\")\r\n            .attr(\"x\", d.node().getBBox().x)\r\n            .attr(\"y\", d.node().getBBox().y)\r\n            .attr(\"width\", d.node().getBBox().width)\r\n            .attr(\"height\", d.node().getBBox().height);\r\n        })\r\n        .transition()\r\n        .delay(transitionDelay)\r\n        .duration(1000)\r\n        .attr(\r\n          \"transform\",\r\n          ({ x, y }) => `translate(${x * SPREAD}, ${y * SPREAD})`\r\n        );\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\r\n      \"transform\",\r\n      (_, i) =>\r\n        `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`\r\n    );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { LOD_1_LEVELS } from \"settings\";\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport { DROPLET_SHAPE } from \"utils/render-utils\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\nimport { LOD_2_SMALL_DROP_PAD_FACTOR } from \"settings\";\r\nimport { LOD_1_SMALL_DROP_PAD_FACTOR } from \"settings\";\r\n\r\nexport default function ExamineView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n  } = useContext(AppContext);\r\n\r\n  useEffect(\r\n    function update() {\r\n      if (isState(state, \"ExamineView\")) {\r\n        const transitionDelay = state.transitionDuration;\r\n        const container = d3.select(\"#mosaic-svg\").select(\".svg-trans\");\r\n\r\n        updateSmallDropSVG(\r\n          container,\r\n          waterdrops.groups.find((g) => g.key === activeWaterdrops[0]).nodes,\r\n          transitionDelay / 2,\r\n          {}\r\n        );\r\n\r\n        setGoBack(() => () => {\r\n          setState({ state: \"WideView\" });\r\n\r\n          resetCamera();\r\n        });\r\n\r\n        return () => {\r\n          d3.select(\"#mosaic-svg\")\r\n            .select(\".svg-trans\")\r\n            .selectAll(\".smallDrop\")\r\n            .attr(\"display\", \"none\");\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  return <></>;\r\n}\r\n\r\nfunction updateSmallDropSVG(\r\n  container,\r\n  waterdrops,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  container\r\n    .selectAll(\".smallDrop\")\r\n    .data(waterdrops)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"smallDrop\")\r\n        .each(function ({ levs }, i) {\r\n          // TODO replace with tooltip, remove unnec svg\r\n\r\n          const s = d3.select(this);\r\n          s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n          const stops = d3\r\n            .select(this)\r\n            .append(\"defs\")\r\n            .append(\"linearGradient\")\r\n            .attr(\"id\", `drop-fill-${i}`)\r\n            .attr(\"x1\", \"0%\")\r\n            .attr(\"x2\", \"0%\")\r\n            .attr(\"y1\", \"0%\")\r\n            .attr(\"y2\", \"100%\");\r\n          stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n          stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n          levs.forEach((_, i) => {\r\n            stops\r\n              .append(\"stop\")\r\n              .attr(\"stop-color\", interpolateWatercolorBlue(i / LOD_1_LEVELS));\r\n            stops\r\n              .append(\"stop\")\r\n              .attr(\"stop-color\", interpolateWatercolorBlue(i / LOD_1_LEVELS));\r\n          });\r\n\r\n          s.append(\"path\")\r\n            .attr(\"d\", DROPLET_SHAPE)\r\n            .attr(\"class\", \"outline\")\r\n            .attr(\"fill\", \"none\")\r\n            .attr(\"stroke\", \"lightgray\")\r\n            .attr(\"stroke-width\", 0.05);\r\n\r\n          s.append(\"path\")\r\n            .attr(\"class\", \"fill\")\r\n            .attr(\"d\", DROPLET_SHAPE)\r\n            .attr(\"fill\", `url(#drop-fill-${i})`);\r\n\r\n          s.append(\"g\")\r\n            .attr(\"class\", \"circlet\")\r\n            .append(\"circle\")\r\n            .attr(\"fill\", \"transparent\")\r\n            .attr(\"stroke\", \"transparent\")\r\n            .attr(\"stroke-dasharray\", 3)\r\n            .attr(\"stroke-width\", 3)\r\n            .attr(\"vector-effect\", \"non-scaling-stroke\")\r\n            .attr(\"r\", 1.5);\r\n        });\r\n    })\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\r\n      \"transform\",\r\n      ({ globalX, globalY }) => `translate(${globalX}, ${globalY})`\r\n    )\r\n    .each(function ({ levs, maxLev, key }, i) {\r\n      const s = d3.select(this);\r\n\r\n      s.select(\".outline\").attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n      s.select(\".fill\").attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n\r\n      s.select(\".circlet\")\r\n        .attr(\"class\", null)\r\n        .attr(\"class\", \"circlet \" + key);\r\n\r\n      s.selectAll(\"stop\").each(function (_, i) {\r\n        let actI = Math.floor(i / 2);\r\n        const isEnd = i % 2;\r\n\r\n        if (isEnd === 0) actI -= 1;\r\n\r\n        if (actI === -1) {\r\n          d3.select(this).attr(\"offset\", `${0}%`);\r\n        } else if (actI === levs.length) {\r\n          d3.select(this).attr(\"offset\", `100%`);\r\n        } else {\r\n          d3.select(this).attr(\"offset\", `${(1 - levs[actI] / maxLev) * 100}%`);\r\n        }\r\n      });\r\n\r\n      const d = s.select(\".fill\");\r\n\r\n      s.select(\".bbox\")\r\n        .attr(\"x\", d.node().getBBox().x)\r\n        .attr(\"y\", d.node().getBBox().y)\r\n        .attr(\"width\", d.node().getBBox().width)\r\n        .attr(\"height\", d.node().getBBox().height);\r\n    })\r\n    .on(\"click\", function (_, d) {\r\n      onClick && onClick(d);\r\n    })\r\n    .on(\"mouseenter\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"stroke\", \"orange\");\r\n      onHover && onHover(d);\r\n    })\r\n    .on(\"mouseleave\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"stroke\", \"transparent\");\r\n      onUnhover && onUnhover(d);\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\r\n      \"transform\",\r\n      ({ globalX, globalY, x, y }) =>\r\n        `translate(${\r\n          globalX +\r\n          x * (LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR - 1)\r\n        }, ${\r\n          globalY +\r\n          y * (LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR - 1)\r\n        }) rotate(${0})`\r\n    );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useCallback, useContext, useEffect, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { GROUP_HOVER_AREA_FACTOR } from \"settings\";\r\nimport { dropsMesh, scene } from \"three-resources\";\r\nimport { isState, useStateRef, wrap } from \"utils/misc-utils\";\r\nimport { BiCross, BiNetworkChart } from \"react-icons/bi\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { LOD_2_SMALL_DROP_PAD_FACTOR } from \"settings\";\r\nimport { LOD_1_SMALL_DROP_PAD_FACTOR } from \"settings\";\r\nimport { dist, distSq, getCenterDomRect } from \"utils/math-utils\";\r\nimport {\r\n  CALIFORNIA_OUTLINE,\r\n  SPATIAL_DATA,\r\n  SPATIAL_FEATURES,\r\n} from \"data/spatial-data\";\r\n\r\nexport default function WideView() {\r\n  const {\r\n    waterdrops,\r\n    state,\r\n    setState,\r\n    camera,\r\n    zoomTo,\r\n    setActiveWaterdrops,\r\n    activeWaterdrops,\r\n    setDisableCamAdjustments,\r\n    getOutlineOpac,\r\n    addZoomHandler,\r\n    appWidth,\r\n    appHeight,\r\n  } = useContext(AppContext);\r\n\r\n  const [activeWDObjs, setActiveWDObjs] = useState([]);\r\n  const [enableZoom, setEnableZoom, enableZoomRef] = useStateRef(false);\r\n\r\n  const [transformInfo, setTransformInfo] = useState({\r\n    zoom: 1,\r\n    mouseX: 0,\r\n    mouseY: 0,\r\n  });\r\n\r\n  const [curInfo, setCurInfo] = useState(null);\r\n\r\n  const fontSize = (d, transformZoom) => {\r\n    const MAX_RAD = window.innerHeight / 9;\r\n\r\n    const zoomRel = ((1 / transformZoom) * camera.height) / waterdrops.height;\r\n\r\n    const absFontSize = (_d) =>\r\n      _d > MAX_RAD\r\n        ? 0\r\n        : d3.scaleLinear().domain([0, MAX_RAD]).range([1, 0.4]).clamp(true)(_d);\r\n\r\n    return absFontSize(d * zoomRel) * Math.min(zoomRel, 0.4);\r\n  };\r\n\r\n  useEffect(() => {\r\n    d3.select(\".infobox\").attr(\"display\", \"none\");\r\n\r\n    if (!enableZoomRef.current) return;\r\n\r\n    d3.select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .selectAll(\"text\")\r\n      .each(function () {\r\n        const s = d3.select(this);\r\n        const tNode = s.node();\r\n\r\n        const [posx, posy] = getCenterDomRect(tNode.getBoundingClientRect());\r\n\r\n        const width =\r\n            ((tNode.getBBox().width * camera.height) / camera.far) * 8,\r\n          height = ((tNode.getBBox().height * camera.height) / camera.far) * 10;\r\n\r\n        const dis = dist(\r\n          [posx, posy],\r\n          [transformInfo.mouseX, transformInfo.mouseY]\r\n        );\r\n\r\n        s.attr(\"font-size\", fontSize(dis, transformInfo.zoom));\r\n\r\n        d3.select(this.parentNode.parentNode)\r\n          .select(\"image\")\r\n          .attr(\"x\", -width / 2)\r\n          .attr(\"y\", -height / 2)\r\n          .attr(\"width\", width)\r\n          .attr(\"height\", height);\r\n      });\r\n  }, [transformInfo]);\r\n\r\n  useEffect(() => {\r\n    addZoomHandler(function (transform) {\r\n      setTransformInfo((ti) => ({\r\n        ...ti,\r\n        zoom: transform.k,\r\n      }));\r\n    });\r\n\r\n    const mouseListener = (e) => {\r\n      setTransformInfo((ti) => ({\r\n        ...ti,\r\n        mouseX: e.x,\r\n        mouseY: e.y,\r\n      }));\r\n    };\r\n\r\n    window.addEventListener(\"mousemove\", mouseListener);\r\n\r\n    const mmWidth = 200,\r\n      mmHeight = 250;\r\n\r\n    const minimap = d3\r\n      .select(\"#minimap\")\r\n      .attr(\"width\", mmWidth)\r\n      .attr(\"height\", mmHeight);\r\n\r\n    const mmProj = d3\r\n      .geoMercator()\r\n      .scale(1000)\r\n      .center([-119, 37.7749])\r\n      .translate([mmWidth / 2, mmHeight / 2]);\r\n\r\n    minimap\r\n      .selectAll(\"path\")\r\n      .data([\r\n        ...SPATIAL_DATA.features.filter(\r\n          (f, i) => f.geometry.type === \"MultiPolygon\"\r\n        ),\r\n        CALIFORNIA_OUTLINE,\r\n      ])\r\n      .join(\"path\")\r\n      .attr(\"d\", (d) => d3.geoPath().projection(mmProj)(d))\r\n      .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n      .attr(\"stroke\", (d) =>\r\n        d.properties.CalLiteID ? \"transparent\" : \"lightgray\"\r\n      )\r\n      .attr(\"stroke-width\", 1)\r\n      .attr(\"fill\", \"transparent\");\r\n\r\n    minimap\r\n      .selectAll(\"circle\")\r\n      .data([\r\n        ...SPATIAL_DATA.features.filter(\r\n          (f, i) => f.geometry.type === \"MultiPoint\"\r\n        ),\r\n      ])\r\n      .join(\"circle\")\r\n      .each(function (d) {\r\n        const s = d3.select(this);\r\n\r\n        const [x, y] = mmProj(d.geometry.coordinates[0]);\r\n\r\n        s.attr(\"cx\", x);\r\n        s.attr(\"cy\", y);\r\n      })\r\n      .attr(\"r\", 2)\r\n      .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n      .attr(\"fill\", \"transparent\");\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener(\"mousemove\", mouseListener);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(\r\n    function update() {\r\n      if (isState(state, \"WideView\")) {\r\n        setEnableZoom(true);\r\n        setTransformInfo((ti) => ({ ...ti, zoom: camera.curTransform.k }));\r\n\r\n        console.time(\"drawing\");\r\n        dropsMesh.draw(scene);\r\n        console.timeEnd(\"drawing\");\r\n\r\n        const origOpac = getOutlineOpac(camera.curTransform.k);\r\n\r\n        dropsMesh.updateVisibility(1);\r\n        dropsMesh.updateOutlineVisibility(origOpac);\r\n\r\n        const container = d3.select(\"#mosaic-svg\").select(\".svg-trans\");\r\n        d3.select(\".infobox\").style(\"display\", \"initial\");\r\n\r\n        updateLargeDropSVG(container, waterdrops, {\r\n          onClick: (d) => {\r\n            setActiveWDObjs((wd) => {\r\n              const found = wd.findIndex((wd) => wd.key === d.key);\r\n              if (found !== -1) {\r\n                wd.splice(found, 1);\r\n              } else {\r\n                wd.push(d);\r\n              }\r\n              return [...wd];\r\n            });\r\n\r\n            setActiveWaterdrops((wd) => {\r\n              if (wd.includes(d.key)) {\r\n                wd.splice(wd.indexOf(d.key), 1);\r\n                container.select(\".circlet.\" + d.key).classed(\"active\", false);\r\n              } else {\r\n                wd.push(d.key);\r\n                container.select(\".circlet.\" + d.key).classed(\"active\", true);\r\n              }\r\n              return [...wd];\r\n            });\r\n          },\r\n          onHover: (d) => {\r\n            setCurInfo({\r\n              id: d.key,\r\n              description: DESCRIPTIONS_DATA[d.key].desc,\r\n            });\r\n\r\n            if (!SPATIAL_FEATURES[d.key]) return;\r\n\r\n            d3.select(\"#minimap\")\r\n              .select(\".outline.\" + d.key)\r\n              .attr(\"fill\", \"gray\");\r\n          },\r\n          onUnhover: (d) => {\r\n            setCurInfo(null);\r\n\r\n            if (!SPATIAL_FEATURES[d.key]) return;\r\n\r\n            d3.select(\"#minimap\")\r\n              .select(\".outline.\" + d.key)\r\n              .attr(\"fill\", \"transparent\");\r\n          },\r\n        });\r\n\r\n        for (const wd of activeWDObjs) {\r\n          container.select(\".circlet.\" + wd.key).classed(\"active\", true);\r\n        }\r\n\r\n        return () => {\r\n          d3.select(\"#mosaic-svg\")\r\n            .select(\".svg-trans\")\r\n            .selectAll(\".largeDrop\")\r\n            .attr(\"display\", \"none\");\r\n          d3.select(\".infobox\").style(\"display\", \"none\");\r\n          setEnableZoom(false);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  const handleClick = useCallback(() => {\r\n    if (activeWDObjs.length == 1) {\r\n      const d = activeWDObjs[0];\r\n\r\n      const { start, duration } = zoomTo(\r\n        [\r\n          d.x,\r\n          d.y - d.height * 0.08,\r\n          camera.getZFromFarHeight(\r\n            ((d.height * LOD_2_SMALL_DROP_PAD_FACTOR) /\r\n              LOD_1_SMALL_DROP_PAD_FACTOR) *\r\n              1.5\r\n          ),\r\n        ],\r\n        () => {\r\n          setDisableCamAdjustments(false);\r\n        }\r\n      );\r\n\r\n      start();\r\n\r\n      setState({ state: \"ExamineView\", transitionDuration: duration });\r\n\r\n      const origOpac = getOutlineOpac(camera.curTransform.k);\r\n      setDisableCamAdjustments(true);\r\n\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(1, elapsed / (duration / 2));\r\n\r\n        dropsMesh.updateVisibility(1 - et);\r\n        dropsMesh.updateOutlineVisibility(origOpac * (1 - et));\r\n\r\n        if (et >= 1) {\r\n          t.stop();\r\n          dropsMesh.remove(scene);\r\n        }\r\n      });\r\n    } else if (activeWDObjs.length > 1) {\r\n      const coords = activeWDObjs.map((w) => [w.x, w.y]);\r\n      const avgX = d3.mean(coords, (c) => c[0]);\r\n      const avgY = d3.mean(coords, (c) => c[1]);\r\n\r\n      const { start, duration } = zoomTo(\r\n        [\r\n          avgX,\r\n          avgY,\r\n          camera.getZFromFarHeight(\r\n            ((waterdrops.groups[0].height * 2 * LOD_2_SMALL_DROP_PAD_FACTOR) /\r\n              LOD_1_SMALL_DROP_PAD_FACTOR) *\r\n              0.75 *\r\n              2\r\n          ),\r\n        ],\r\n        () => {\r\n          setDisableCamAdjustments(false);\r\n        }\r\n      );\r\n\r\n      start();\r\n\r\n      setState({\r\n        state: \"CompareView\",\r\n        transitionDuration: duration,\r\n        avgCoord: [avgX, avgY],\r\n      });\r\n\r\n      const origOpac = getOutlineOpac(camera.curTransform.k);\r\n      setDisableCamAdjustments(true);\r\n\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(1, elapsed / (duration / 5));\r\n\r\n        dropsMesh.updateVisibility(1 - et);\r\n        dropsMesh.updateOutlineVisibility(origOpac * (1 - et));\r\n\r\n        if (et >= 1) {\r\n          t.stop();\r\n\r\n          dropsMesh.remove(scene);\r\n        }\r\n      });\r\n    }\r\n  }, [activeWDObjs]);\r\n\r\n  let actionBtn;\r\n\r\n  if (isState(state, \"WideView\")) {\r\n    if (activeWaterdrops.length)\r\n      actionBtn = (\r\n        <button\r\n          onClick={handleClick}\r\n          className=\"wide-view-action-btn fancy-font\"\r\n        >\r\n          {activeWaterdrops.length == 1 ? <BiCross /> : <BiNetworkChart />}\r\n          {activeWaterdrops.length == 1 ? \"examine\" : \"compare\"}\r\n        </button>\r\n      );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"infobox\">\r\n        <svg id=\"minimap\"></svg>\r\n        {curInfo && (\r\n          <div className=\"details\">\r\n            {!SPATIAL_FEATURES[curInfo.id] && (\r\n              <p className=\"no-loc-data\">No Location Data</p>\r\n            )}\r\n            <p className=\"curDesc\">{curInfo.description}</p>\r\n            <p className=\"curKey\">\r\n              id: <span> {curInfo.id} </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n      {actionBtn}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction updateLargeDropSVG(\r\n  container,\r\n  waterdrops,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  console.log(\"updating svg\");\r\n  container\r\n    .selectAll(\".largeDrop\")\r\n    .data(waterdrops.groups)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"largeDrop\")\r\n        .each(function (d) {\r\n          const s = d3.select(this);\r\n\r\n          s.append(\"g\")\r\n            .attr(\"class\", \"circlet\")\r\n            .append(\"circle\")\r\n            .attr(\"fill\", \"transparent\")\r\n            .attr(\"stroke\", \"transparent\")\r\n            .attr(\"stroke-dasharray\", 3)\r\n            .attr(\"stroke-width\", 3)\r\n            .attr(\"vector-effect\", \"non-scaling-stroke\")\r\n            .attr(\"r\", 1);\r\n\r\n          const textGroup = s.append(\"g\");\r\n          textGroup\r\n            .append(\"g\")\r\n            .append(\"image\")\r\n            .attr(\"href\", \"glow.png\")\r\n            .attr(\"preserveAspectRatio\", \"none\")\r\n            .attr(\"opacity\", 0.8);\r\n          textGroup\r\n            .append(\"g\")\r\n            .append(\"text\")\r\n            .attr(\"class\", \"fancy-font\")\r\n            .attr(\"text-anchor\", \"middle\")\r\n            .attr(\"font-size\", 0);\r\n        });\r\n    })\r\n    .each(function (d) {\r\n      d3.select(this)\r\n        .select(\".circlet\")\r\n        .attr(\"class\", null)\r\n        .attr(\"class\", \"circlet \" + d.key);\r\n      d3.select(this)\r\n        .select(\"text\")\r\n        .call((s) => {\r\n          s.selectAll(\"*\").remove();\r\n          const lines = wrap(\r\n            DESCRIPTIONS_DATA[d.key].display_name || DESCRIPTIONS_DATA[d.key].id\r\n          ).split(\"\\n\");\r\n\r\n          lines.forEach((line, i) => {\r\n            s.append(\"tspan\")\r\n              .attr(\"x\", 0)\r\n              .attr(\"y\", `${-lines.length / 2 + 0.5}em`)\r\n              .attr(\"dy\", `${i}em`)\r\n              .text(line);\r\n          });\r\n        });\r\n    })\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\r\n      \"transform\",\r\n      ({ x, y, height }) =>\r\n        `translate(${x}, ${y - height * 0.08}) scale(${\r\n          height * GROUP_HOVER_AREA_FACTOR\r\n        })`\r\n    )\r\n    .on(\"click\", function (_, d) {\r\n      onClick && onClick(d);\r\n    })\r\n    .on(\"mouseenter\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"stroke\", \"orange\");\r\n      onHover && onHover(d);\r\n    })\r\n    .on(\"mouseleave\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"stroke\", \"transparent\");\r\n      onUnhover && onUnhover(d);\r\n    });\r\n}\r\n"],"names":["waterdrops","initWaterdrops","appWidth","window","innerWidth","appHeight","innerHeight","App","state","setState","stateRef","useStateRef","zoomCallbacks","setZoomCallbacks","zoomCallbacksRef","activeWaterdrops","setActiveWaterdrops","useState","goBack","setGoBack","disableCamAdjustments","setDisableCamAdjustments","disableCamAdjustmentsRef","getOutlineOpac","useCallback","d3","domain","height","groups","range","clamp","useEffect","document","querySelector","appendChild","renderer","domElement","attr","append","camera","mount","node","select","setZoomFn","transform","current","dropsMesh","updateOutlineVisibility","k","cb","setSize","setAnimationLoop","render","scene","resetCamera","animated","arguments","length","undefined","callback","pos","getZFromFarHeight","start","zoomTo","callZoomFromWorldViewport","worldX","worldY","farHeight","xyz","i","interpolateZoomCamera","duration","t","elapsed","et","Math","min","callZoom","stop","addZoomHandler","cbs","_jsxs","AppContext","Provider","value","pointsMesh","children","className","_jsx","id","WideView","ExamineView","CompareView","onClick","console","time","createMesh","timeEnd","createContext","ticksExact","count","map","interpolateWatercolorBlue","DESCRIPTIONS_DATA","async","objs","fetch","json","log","mapBy","_ref","SCEN_DIVISOR","MAX_DELIVS","SCENARIO_KEY_STRING","DELIV_KEY_STRING","OBJECTIVES_DATA","obj","scen","unord","v","Array","from","sort","a","b","name","_ref2","OBJECTIVE_IDS","Object","keys","SCENARIO_IDS","values","filter","_","FLATTENED_DATA","DATA_GROUPINGS","flattenedData","dataGroupings","objective","scenario","means","idx","push","deliveries","orderedDataGroupings","criteria","asdfasdf","key","ids","sortedObjScens","sorted","mean","flat","IDtoRank","j","rank","SPATIAL_DATA","SPATIAL_FEATURES","features","properties","CalLiteID","CALIFORNIA_OUTLINE","LOD_1_LEVELS","LOD_1_RAD_PX","LOD_1_MIN_LEV_VAL","LOD_1_SMALL_DROP_PAD_FACTOR","LOD_1_LARGE_DROP_PAD_FACTOR","LOD_2_SMALL_DROP_PAD_FACTOR","GROUP_HOVER_AREA_FACTOR","SQRT1_2","s","THREE","background","WaterdropMesh","WaterdropSimplifiedMesh","Camera","fov","near","far","antialias","grouping","groupKeys","memberKeys","amtPerGroup","largeDropRad","sqrt","PI","smallDropRad","largeNodesPhys","placeDropsUsingPhysics","p","r","largeNodesPos","smallNodesPhys","smallNodesPos","nodes","groupNodes","groupToNodes","nodeData","createInterpsFromDelivs","levs","d","w","max","groupID","memberID","groupRank","memberRank","maxLev","domLev","calcDomLev","tilt","random","dur","x","y","group","globalX","globalY","groupKey","delivs","maxDelivs","generateWaterdrop","width","rad","delta","outer","cos","sin","SQRT2","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","reuse","shape","bounds","Matter","create","minX","maxX","minY","maxY","genX","genY","points","contains","generateRandoPoints","WIDTH_AREA","AREA","floor","radsToDropWidth","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","_ref3","nx","ny","circle","restitution","parts","quad","position","centre","vertices","isStatic","cage","setParts","setCentre","scale","add","world","FPS","SECS","update","retVal","_ref4","CIRC_RAD","DROP_HEIGHT","toRadians","dist","_ref7","_ref8","x1","y1","x2","y2","_ref5","_ref6","distSq","getCenterDomRect","domRect","left","top","fn","newObjs","groupBy","sortBy","array","object","path","defaultValue","_object","split","part","get","pick","va","vb","val","_setState","useRef","curVal","isState","stateInfo","stateName","wrap","replace","DROPLET_SHAPE","DROP_RAD","CIRC_HEIGHT","HAT_START","yToHalfWidth","trigX","angle","acos","yToSpriteY","spriteYToY","sy","waterdropDelta","yStart","yEnd","size","abs","Y_DELTA","dx1","dy1","dx2","dy2","ceil","v1","v2","v3","v4","MeshGeometry","constructor","numPoints","color","threeGeom","triangleIdx","this","setAttribute","Float32Array","positionAttribute","getAttribute","colorAttribute","addMeshCoords","meshCoords","z","setXYZ","g","finish","setDrawRange","added","updateMeshes","initializeMeshes","draw","outlineMesh","remove","dropsGeometry","MAX_POINTS_DROPS","outlinePoints","outlineMeshCoords","rightCoords","leftCoords","reverse","waterdropDeltaOutline","dx","dy","vertexColors","transparent","opacity","setFromPoints","opac","material","needsUpdate","updateVisibility","MAX_POINTS_OUTLINE","vertToId","idToVert","mesh","initializeMesh","updateMesh","pointsGeometry","colors","t_color","pointsMaterial","sizeAttenuation","load","positionAttr","geometry","newX","newY","setXY","updatePoints","translations","dt","verts","setX","setY","verticesNeedUpdate","intersectObject","intersects","intersect","index","raycaster","zoomFn","zoom","on","e","curTransform","_THREEZoomHandler","_svgElement","view","translate","tan","getFarHeightFromZ","endx","endy","endz","interper","webglElement","svgElement","scaleExtent","getScaleFromZ","set","call","getZFromScale","camera_z_position","half_fov","half_fov_radians","fov_height","mouseX","mouseY","setFromCamera","SPREAD","useContext","activeMinidrop","setActiveMinidrop","groupsRef","positions","groupPos","groupPositions","find","n","lines","to","len","normed","selectAll","data","join","style","transition","container","waterdropGroups","transitionDelay","onHover","onUnhover","enter","each","randId","stops","concat","forEach","actI","getBBox","delay","updateDropsSVG","keyArr","center","includes","getWaterdropGroups","avgCoord","transitionDuration","classed","updateSmallDropSVG","_Fragment","activeWDObjs","setActiveWDObjs","enableZoom","setEnableZoom","enableZoomRef","transformInfo","setTransformInfo","curInfo","setCurInfo","tNode","posx","posy","getBoundingClientRect","dis","fontSize","transformZoom","MAX_RAD","zoomRel","_d","parentNode","ti","mouseListener","addEventListener","minimap","mmProj","mmWidth","mmHeight","f","type","projection","coordinates","removeEventListener","origOpac","updateLargeDropSVG","wd","found","findIndex","splice","indexOf","description","desc","handleClick","avgX","c","avgY","actionBtn","BiCross","BiNetworkChart","textGroup","display_name","line","text"],"sourceRoot":""}