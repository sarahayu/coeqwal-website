{"version":3,"file":"static/js/805.3c9c531a.chunk.js","mappings":"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","sources":["App.jsx","AppContext.jsx","bucket-lib/quantile-histogram.js","bucket-lib/utils.js","components/DotHistogram.jsx","data/descriptions-data.jsx","data/objectives-data.jsx","data/spatial-data.jsx","settings.jsx","three-resources.jsx","utils/app-utils.jsx","utils/data-utils.jsx","utils/math-utils.jsx","utils/misc-utils.jsx","utils/render-utils.jsx","views/CompareView.jsx","views/ExamineView.jsx","views/WideView.jsx"],"sourcesContent":["import * as d3 from \"d3\";\r\n\r\nimport React, { useCallback, useEffect, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { useStateRef } from \"utils/misc-utils\";\r\nimport { initWaterdrops } from \"utils/app-utils\";\r\n\r\nimport WideView from \"views/WideView\";\r\nimport ExamineView from \"views/ExamineView\";\r\nimport CompareView from \"views/CompareView\";\r\n\r\nimport {\r\n  scene,\r\n  camera,\r\n  renderer,\r\n  dropsMesh,\r\n  pointsMesh,\r\n} from \"three-resources\";\r\n\r\n// pre-calculate these so we don't lag later\r\nconst waterdrops = initWaterdrops(\"objective\");\r\n\r\nconst appWidth = window.innerWidth,\r\n  appHeight = window.innerHeight;\r\n\r\nrenderer.setSize(appWidth, appHeight);\r\n\r\nconsole.time(\"drops mesh creating\");\r\ndropsMesh.createMesh(waterdrops);\r\nconsole.timeEnd(\"drops mesh creating\");\r\n\r\n// pointsMesh.createMesh(waterdrops);\r\n\r\nexport default function App() {\r\n  const [state, setState, stateRef] = useStateRef({});\r\n  const [zoomCallbacks, setZoomCallbacks, zoomCallbacksRef] = useStateRef([]);\r\n  const [activeWaterdrops, setActiveWaterdrops] = useState([]);\r\n  const [goBack, setGoBack] = useState(null);\r\n  const [\r\n    disableCamAdjustments,\r\n    setDisableCamAdjustments,\r\n    disableCamAdjustmentsRef,\r\n  ] = useStateRef(false);\r\n  const [goal, setGoal] = useState(200);\r\n\r\n  const getOutlineOpac = useCallback(\r\n    d3\r\n      .scaleLinear()\r\n      .domain([\r\n        appHeight / waterdrops.height,\r\n        appHeight / waterdrops.groups[0].height,\r\n      ])\r\n      .range([0.1, 1])\r\n      .clamp(true),\r\n    []\r\n  );\r\n\r\n  useEffect(function initialize() {\r\n    document.querySelector(\"#mosaic-webgl\").appendChild(renderer.domElement);\r\n\r\n    d3.select(\"#mosaic-svg\").attr(\"width\", appWidth).attr(\"height\", appHeight);\r\n\r\n    camera.mount(\r\n      d3.select(\".bubbles-wrapper\").node(),\r\n      d3.select(\"#mosaic-svg\").select(\".svg-trans\").node()\r\n    );\r\n    camera.setZoomFn((transform) => {\r\n      if (!disableCamAdjustmentsRef.current) {\r\n        dropsMesh.updateOutlineVisibility(getOutlineOpac(transform.k));\r\n      }\r\n\r\n      for (const cb of zoomCallbacksRef.current) cb(transform);\r\n    });\r\n    camera.setSize(appWidth, appHeight);\r\n\r\n    renderer.setAnimationLoop(() => {\r\n      renderer.render(scene, camera.camera);\r\n    });\r\n\r\n    resetCamera(false);\r\n    setState({ state: \"WideView\" });\r\n  }, []);\r\n\r\n  const resetCamera = useCallback(function (animated = true, callback) {\r\n    const pos = [\r\n      0,\r\n      -waterdrops.height * 0.08,\r\n      camera.getZFromFarHeight(waterdrops.height),\r\n    ];\r\n    if (animated) {\r\n      const { start } = zoomTo(pos, callback);\r\n      start();\r\n    } else {\r\n      camera.callZoomFromWorldViewport({\r\n        worldX: pos[0],\r\n        worldY: -pos[1],\r\n        farHeight: waterdrops.height,\r\n      });\r\n      callback && callback();\r\n    }\r\n  }, []);\r\n\r\n  const zoomTo = useCallback(function (xyz, callback) {\r\n    const i = camera.interpolateZoomCamera(xyz);\r\n\r\n    const duration = i.duration / 2;\r\n\r\n    const start = () => {\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(elapsed / duration, 1);\r\n        camera.callZoom(i(et));\r\n\r\n        if (et === 1) {\r\n          t.stop();\r\n          callback && callback();\r\n        }\r\n      });\r\n    };\r\n\r\n    return {\r\n      start,\r\n      duration,\r\n    };\r\n  }, []);\r\n\r\n  const addZoomHandler = useCallback(function (cb) {\r\n    setZoomCallbacks((cbs) => [...cbs, cb]);\r\n  }, []);\r\n\r\n  return (\r\n    <AppContext.Provider\r\n      value={{\r\n        appWidth,\r\n        appHeight,\r\n        state,\r\n        setState,\r\n        activeWaterdrops,\r\n        setActiveWaterdrops,\r\n        setDisableCamAdjustments,\r\n        waterdrops,\r\n        scene,\r\n        camera,\r\n        renderer,\r\n        pointsMesh,\r\n        dropsMesh,\r\n        setGoBack,\r\n        zoomTo,\r\n        resetCamera,\r\n        getOutlineOpac,\r\n        addZoomHandler,\r\n        goal,\r\n        setGoal,\r\n      }}\r\n    >\r\n      <div className=\"bubbles-wrapper\">\r\n        <div id=\"mosaic-webgl\"></div>\r\n        <svg id=\"mosaic-svg\">\r\n          <g className=\"svg-trans\"></g>\r\n        </svg>\r\n      </div>\r\n      <WideView />\r\n      <ExamineView />\r\n      <CompareView />\r\n      {goBack && (\r\n        <button className=\"go-back-btn\" onClick={goBack}>\r\n          ←\r\n        </button>\r\n      )}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n","import { createContext } from \"react\";\r\n\r\nexport const AppContext = createContext({});\r\n","import * as d3 from \"d3\";\r\nimport { quantileBins, ticksExact } from \"./utils\";\r\n\r\nexport function getQuantileBins(data, domain, unitsPerQuantile, width, height) {\r\n  const numQuantiles = data.length / unitsPerQuantile;\r\n  let histBins = d3\r\n    .histogram()\r\n    .value((d) => d)\r\n    .domain(domain)\r\n    .thresholds(\r\n      ticksExact(...domain, Math.ceil(width / (height / numQuantiles)))\r\n    )(data);\r\n\r\n  let binnedQuantiles = quantileBins(histBins, unitsPerQuantile, numQuantiles);\r\n\r\n  let quantiles = [];\r\n\r\n  for (let b = 0; b < binnedQuantiles.length; b++) {\r\n    for (let y = 0; y < binnedQuantiles[b]; y++) {\r\n      quantiles.push([\r\n        (histBins[b].x1 + histBins[b].x0) / 2,\r\n        ((y + 0.5) / numQuantiles) * data.length,\r\n      ]);\r\n    }\r\n  }\r\n\r\n  return quantiles;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\n// inclusive\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n\r\nexport const interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useMemo, useRef } from \"react\";\r\nimport { getQuantileBins } from \"bucket-lib/quantile-histogram\";\r\n\r\nimport { MAX_DELIVS } from \"data/objectives-data\";\r\n\r\nconst NUM_CIRCLES = 20;\r\nconst MARGIN = { top: 10, right: 10, bottom: 20, left: 10 };\r\nconst DOMAIN = [0, MAX_DELIVS];\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport default function DotHistogram({\r\n  data,\r\n  goal,\r\n  setGoal,\r\n  width = 600,\r\n  height = 400,\r\n}) {\r\n  const { current: razorID } = useRef(Math.floor(Math.random() * 1e9));\r\n  const { current: razorAreaID } = useRef(Math.floor(Math.random() * 1e9));\r\n\r\n  const svgSelector = useRef();\r\n  const circles = useMemo(\r\n    () =>\r\n      getQuantileBins(data, DOMAIN, data.length / NUM_CIRCLES, width, height),\r\n    [data]\r\n  );\r\n\r\n  const dataRange = [0, data.length];\r\n  const x = d3.scaleLinear().domain(DOMAIN).range([0, width]);\r\n  const y = d3.scaleLinear().domain(dataRange).range([height, 0]);\r\n  const count = circles.filter((d) => d[0] > goal).length;\r\n\r\n  useEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width + MARGIN.left + MARGIN.right)\r\n      .attr(\"height\", height + MARGIN.top + MARGIN.bottom)\r\n      .style(\"pointer-events\", \"none\")\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${MARGIN.left},${MARGIN.top})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(\r\n        d3\r\n          .axisBottom()\r\n          .scale(d3.scaleLinear().domain(DOMAIN).range([0, width]))\r\n          .tickFormat(d3.format(\".2s\"))\r\n      )\r\n      .call((s) => {\r\n        s.selectAll(\"line\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"path\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"text\").attr(\"fill\", \"gray\");\r\n      })\r\n      .append(\"text\")\r\n      .attr(\"fill\", \"black\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${30})`)\r\n      .text(\"Delivery (TAF)\");\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n\r\n    const ignoreFn = (e) => e.preventDefault();\r\n    let dragging = false;\r\n\r\n    document.querySelector(`#i${razorID}`).addEventListener(\"mousedown\", () => {\r\n      dragging = true;\r\n      window.addEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", () => {\r\n      dragging = false;\r\n      window.removeEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document\r\n      .querySelector(`#i${razorAreaID}`)\r\n      .addEventListener(\"mousemove\", (e) => {\r\n        if (dragging && e.target.id === `i${razorAreaID}`) {\r\n          razor.style.transform = `translateX(${Math.min(\r\n            Math.max(e.offsetX, MARGIN.left),\r\n            MARGIN.left + width\r\n          )}px)\r\n            `;\r\n\r\n          setGoal(\r\n            d3\r\n              .scaleLinear()\r\n              .domain([MARGIN.left, width + MARGIN.left])\r\n              .range(DOMAIN)\r\n              .clamp(true)(e.offsetX)\r\n          );\r\n        }\r\n      });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const svgCircles = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".icons\")\r\n      .data(circles)\r\n      .join((enter) => enter.append(\"g\").call((s) => s.append(\"path\")))\r\n      .attr(\"class\", \"icons\")\r\n      .call((s) => {\r\n        s.selectAll(\"path\").attr(\r\n          \"d\",\r\n          d3.symbol(WATERDROP_ICON, height / NUM_CIRCLES)\r\n        );\r\n      });\r\n\r\n    svgCircles.attr(\"transform\", (d) => `translate(${x(d[0])},${y(d[1])})`);\r\n\r\n    svgCircles.attr(\"fill\", (d) => (d[0] > goal ? \"steelblue\" : \"black\"));\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n  }, [goal, circles]);\r\n\r\n  return (\r\n    <div className={`dot-${razorAreaID}`} id={`i${razorAreaID}`}>\r\n      <div className={`pdf-razor`} id={`i${razorID}`}>\r\n        <div>\r\n          <span>\r\n            {circles.length - count} / {NUM_CIRCLES} yrs WILL NOT meet demand\r\n          </span>\r\n          <span>\r\n            {count} / {NUM_CIRCLES} yrs WILL meet demand\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const DESCRIPTIONS_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./descriptions.json\")).json();\r\n\r\n  console.log(\"DATA: loading descriptions data\");\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n})();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { clamp } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst SCEN_DIVISOR = 1; // debugging purposes, don't render all scenarios to speed things up\r\n\r\nexport const MAX_DELIVS = 1200;\r\nexport const SCENARIO_KEY_STRING = \"scens\";\r\nexport const DELIV_KEY_STRING = \"delivs\";\r\n\r\nexport const OBJECTIVES_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./objectives.json\")).json();\r\n\r\n  for (const obj of objs) {\r\n    obj[SCENARIO_KEY_STRING] = obj[SCENARIO_KEY_STRING];\r\n    for (const scen of obj[SCENARIO_KEY_STRING]) {\r\n      // data cleanup, clamping\r\n      const unord = scen[DELIV_KEY_STRING].map((v) => clamp(v, 0, MAX_DELIVS));\r\n\r\n      scen[DELIV_KEY_STRING] = Array.from(unord).sort((a, b) => b - a);\r\n    }\r\n    obj[SCENARIO_KEY_STRING] = mapBy(\r\n      obj[SCENARIO_KEY_STRING],\r\n      ({ name }) => name\r\n    );\r\n  }\r\n\r\n  console.log(\"DATA: loading objectives data\");\r\n\r\n  return mapBy(objs, ({ obj }) => obj);\r\n})();\r\n\r\nexport const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\nconst _SCENARIO_IDS = Object.keys(\r\n  Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n);\r\n\r\nexport const SCENARIO_IDS = _SCENARIO_IDS.filter(\r\n  (_, i) => i % SCEN_DIVISOR === 0\r\n);\r\n\r\n// Flattening hierarchical data makes it more flexible for classifying\r\n// (from experience). id conveniently corresponds to index.\r\n// Also cache classifications (by objective and by scenario, for now)\r\nexport const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n  const flattenedData = [];\r\n  const dataGroupings = {\r\n    objective: {},\r\n    scenario: {},\r\n  };\r\n\r\n  // for ordering later\r\n  const means = [];\r\n\r\n  let idx = 0;\r\n  for (const obj of OBJECTIVE_IDS) {\r\n    for (const scen of SCENARIO_IDS) {\r\n      if (!dataGroupings[\"objective\"][obj])\r\n        dataGroupings[\"objective\"][obj] = [];\r\n\r\n      if (!dataGroupings[\"scenario\"][scen])\r\n        dataGroupings[\"scenario\"][scen] = [];\r\n\r\n      dataGroupings[\"objective\"][obj].push(idx);\r\n      dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n      const deliveries =\r\n        OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n      flattenedData.push({\r\n        id: idx,\r\n        objective: obj,\r\n        scenario: scen,\r\n        deliveries,\r\n      });\r\n\r\n      means.push(d3.mean(deliveries));\r\n\r\n      idx++;\r\n    }\r\n  }\r\n\r\n  const orderedDataGroupings = {};\r\n\r\n  for (const criteria of Object.keys(dataGroupings)) {\r\n    const asdfasdf = [];\r\n    for (const key of Object.keys(dataGroupings[criteria])) {\r\n      const ids = dataGroupings[criteria][key];\r\n      const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n      asdfasdf.push({\r\n        key,\r\n        sorted: sortedObjScens,\r\n        mean: d3.mean(ids.map((id) => flattenedData[id].deliveries).flat()),\r\n      });\r\n    }\r\n\r\n    const sortedObjScens = asdfasdf.sort((a, b) => b.mean - a.mean);\r\n\r\n    orderedDataGroupings[criteria] = {};\r\n\r\n    for (let i = 0; i < sortedObjScens.length; i++) {\r\n      const { key, sorted } = sortedObjScens[i];\r\n      const IDtoRank = {};\r\n\r\n      for (let j = 0; j < sorted.length; j++) {\r\n        IDtoRank[sorted[j]] = j;\r\n      }\r\n      orderedDataGroupings[criteria][key] = IDtoRank;\r\n      orderedDataGroupings[criteria][key].rank = i;\r\n    }\r\n  }\r\n\r\n  return [flattenedData, orderedDataGroupings];\r\n})();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const SPATIAL_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./callite_spatial.json\")).json();\r\n\r\n  console.log(\"DATA: loading callite spatial data\");\r\n\r\n  return objs;\r\n})();\r\n\r\nexport const SPATIAL_FEATURES = (function () {\r\n  return mapBy(SPATIAL_DATA.features, ({ properties }) => properties.CalLiteID);\r\n})();\r\n\r\nexport const CALIFORNIA_OUTLINE = await (async function load() {\r\n  const objs = await (await fetch(\"./california.json\")).json();\r\n\r\n  console.log(\"DATA: loading california spatial data\");\r\n\r\n  return objs;\r\n})();\r\n\r\nexport const CALIFORNIA_CENTER = [-119, 37.7749];\r\n","export const LOD_1_LEVELS = 5;\r\nexport const LOD_1_RAD_PX = 1;\r\nexport const LOD_1_MIN_LEV_VAL = 0.1;\r\nexport const LOD_1_SMALL_DROP_PAD_FACTOR = 1.3;\r\nexport const LOD_1_LARGE_DROP_PAD_FACTOR = 1.2;\r\n\r\nexport const LOD_2_SMALL_DROP_PAD_FACTOR = 3;\r\n\r\nexport const GROUP_HOVER_AREA_FACTOR = 1.1 / (1 + Math.SQRT1_2);\r\n","import * as THREE from \"three\";\r\nimport * as d3 from \"d3\";\r\n\r\nimport {\r\n  WaterdropMesh,\r\n  WaterdropSimplifiedMesh,\r\n  Camera,\r\n} from \"utils/render-utils\";\r\n\r\nconst scene = (function getScene() {\r\n  const s = new THREE.Scene();\r\n  s.background = new THREE.Color(0xefefef);\r\n  return s;\r\n})();\r\n\r\nconst dropsMesh = new WaterdropMesh();\r\nconst pointsMesh = new WaterdropSimplifiedMesh();\r\n\r\nconst camera = new Camera({\r\n  fov: 45,\r\n  near: 1,\r\n  far: 3000,\r\n});\r\n\r\nconst renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\r\nexport { scene, camera, renderer, dropsMesh, pointsMesh };\r\n","import { ticksExact } from \"bucket-lib/utils\";\r\nimport {\r\n  LOD_1_LARGE_DROP_PAD_FACTOR,\r\n  LOD_1_LEVELS,\r\n  LOD_1_MIN_LEV_VAL,\r\n  LOD_1_RAD_PX,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\n\r\nimport {\r\n  DATA_GROUPINGS,\r\n  FLATTENED_DATA,\r\n  MAX_DELIVS,\r\n  OBJECTIVE_IDS,\r\n  SCENARIO_IDS,\r\n} from \"data/objectives-data\";\r\n\r\nimport { calcDomLev, createInterpsFromDelivs } from \"utils/data-utils\";\r\nimport { placeDropsUsingPhysics } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\n// TODO optimize!!\r\nexport function initWaterdrops(grouping) {\r\n  const groupKeys = grouping === \"objective\" ? OBJECTIVE_IDS : SCENARIO_IDS;\r\n  const memberKeys = grouping === \"objective\" ? SCENARIO_IDS : OBJECTIVE_IDS;\r\n\r\n  const amtGroups = groupKeys.length;\r\n  const amtPerGroup = memberKeys.length;\r\n\r\n  const largeDropRad =\r\n    Math.sqrt(amtPerGroup / Math.PI) *\r\n    LOD_1_RAD_PX *\r\n    2 *\r\n    LOD_1_SMALL_DROP_PAD_FACTOR *\r\n    LOD_1_LARGE_DROP_PAD_FACTOR;\r\n  const smallDropRad = LOD_1_RAD_PX * LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  const largeNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    groupKeys.map((p, idx) => ({\r\n      r: largeDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const largeNodesPos = mapBy(largeNodesPhys, ({ id }) => id);\r\n\r\n  const smallNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    memberKeys.map((s, idx) => ({\r\n      r: smallDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const smallNodesPos = mapBy(smallNodesPhys, ({ id }) => id);\r\n\r\n  const nodes = [];\r\n  const groupNodes = [];\r\n\r\n  const groupToNodes = {};\r\n\r\n  let idx = 0;\r\n\r\n  for (const nodeData of FLATTENED_DATA) {\r\n    const { id, objective, scenario, deliveries } = nodeData;\r\n\r\n    const i = createInterpsFromDelivs(deliveries, MAX_DELIVS);\r\n    const wds = ticksExact(0, 1, LOD_1_LEVELS + 1).map((d) => i(d));\r\n\r\n    const levs = wds.map(\r\n      (w, i) => Math.max(w, i == 0 ? LOD_1_MIN_LEV_VAL : 0) * LOD_1_RAD_PX\r\n    );\r\n\r\n    const groupID = grouping === \"objective\" ? objective : scenario;\r\n    const memberID = grouping === \"objective\" ? scenario : objective;\r\n\r\n    const groupRank = DATA_GROUPINGS[grouping][groupID].rank;\r\n    const memberRank = DATA_GROUPINGS[grouping][groupID][id];\r\n\r\n    const node = {\r\n      id,\r\n      levs,\r\n      maxLev: LOD_1_RAD_PX,\r\n      domLev: calcDomLev(levs),\r\n      tilt: Math.random() * 50 - 25,\r\n      dur: Math.random() * 100 + 400,\r\n      x: smallNodesPos[memberRank].x,\r\n      y: smallNodesPos[memberRank].y,\r\n      group: groupID,\r\n      key: memberID,\r\n      globalX: largeNodesPos[groupRank].x + smallNodesPos[memberRank].x,\r\n      globalY: largeNodesPos[groupRank].y + smallNodesPos[memberRank].y,\r\n    };\r\n\r\n    nodes.push(node);\r\n\r\n    if (!groupToNodes[groupID]) groupToNodes[groupID] = [];\r\n\r\n    groupToNodes[groupID].push(node);\r\n  }\r\n\r\n  for (const groupKey of groupKeys) {\r\n    groupNodes.push({\r\n      x: largeNodesPos[DATA_GROUPINGS[grouping][groupKey].rank].x,\r\n      y: largeNodesPos[DATA_GROUPINGS[grouping][groupKey].rank].y,\r\n      tilt: Math.random() * 50 - 25,\r\n      key: groupKey,\r\n      height: smallNodesPhys.height,\r\n      nodes: groupToNodes[groupKey],\r\n    });\r\n  }\r\n\r\n  return {\r\n    nodes: nodes,\r\n    groups: groupNodes,\r\n    height: largeNodesPhys.height,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\n\r\nimport { SCENARIO_KEY_STRING, DELIV_KEY_STRING } from \"data/objectives-data\";\r\n\r\nexport function createInterps(obj_name, scen_name, data, maxDelivs) {\r\n  const delivs =\r\n    data[obj_name][SCENARIO_KEY_STRING][scen_name][DELIV_KEY_STRING];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\nexport function createInterpsFromDelivs(delivs, maxDelivs) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\n// TODO fix colors\r\nexport function calcDomLev(levs) {\r\n  levs = [1, ...levs, 0];\r\n\r\n  let mean = 0;\r\n  for (let i = 0; i < levs.length - 1; i++) {\r\n    const dif = levs[i] - levs[i + 1];\r\n    mean += (dif * (i - 1)) / (levs.length + 4);\r\n  }\r\n\r\n  return mean;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport Matter from \"matter-js\";\r\nimport { CIRC_RAD, DROP_HEIGHT } from \"./render-utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor((Math.sqrt(AREA / 3.14) * 2) / 2);\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes, reuse = false) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r));\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\nexport function percentToRatioFilled(p) {\r\n  p -= 0.0088;\r\n  return clamp(\r\n    (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326,\r\n    0,\r\n    1\r\n  );\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport function interp(x, a, b) {\r\n  return x * (b - a) + a;\r\n}\r\n\r\nexport function revInterp(t, a, b) {\r\n  return (t - a) / (b - a);\r\n}\r\n\r\nexport function distSq([x1, y1], [x2, y2]) {\r\n  return (x2 - x1) ** 2 + (y2 - y1) ** 2;\r\n}\r\n\r\nexport function dist([x1, y1], [x2, y2]) {\r\n  return Math.sqrt(distSq([x1, y1], [x2, y2]));\r\n}\r\n\r\nexport function getCenterDomRect(domRect) {\r\n  return [domRect.left + domRect.width / 2, domRect.top + domRect.height / 2];\r\n}\r\n\r\nexport function clipEnds([from, to], shortenBy) {\r\n  const len = Math.sqrt((from[0] - to[0]) ** 2 + (from[1] - to[1]) ** 2);\r\n  const normed = [(to[0] - from[0]) / len, (to[1] - from[1]) / len];\r\n\r\n  from[0] += normed[0] * shortenBy;\r\n  from[1] += normed[1] * shortenBy;\r\n  to[0] -= normed[0] * shortenBy;\r\n  to[1] -= normed[1] * shortenBy;\r\n\r\n  return [from, to];\r\n}\r\n\r\nexport function dropRadToDropHeight(rad) {\r\n  return (1 + Math.SQRT2) * rad;\r\n}\r\n\r\nexport function dropCenterCorrection({ rad, height }) {\r\n  if (rad !== undefined) return dropRadToDropHeight(rad) * 0.08;\r\n  return height * 0.08;\r\n}\r\n","// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    if (typeof v === \"function\")\r\n      _setState((curVal) => (stateRef.current = v(curVal)));\r\n    else _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n\r\nexport function isState(stateInfo, stateName) {\r\n  return stateInfo && stateInfo.state === stateName;\r\n}\r\n\r\nexport function wrap(s) {\r\n  return s.replace(/(?![^\\n]{1,15}$)([^\\n]{1,15})\\s/g, \"$1\\n\");\r\n}\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\nimport { LOD_1_LEVELS } from \"settings\";\r\nimport { sortBy } from \"./misc-utils\";\r\nimport { toRadians } from \"./math-utils\";\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport const CIRC_RAD = Math.SQRT1_2;\r\nexport const DROP_RAD = 1;\r\nexport const CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nexport const DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = 0.75;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return {\r\n    x: (mouseX / width) * 2 - 1,\r\n    y: -(mouseY / height) * 2 + 1,\r\n  };\r\n}\r\n\r\nclass MeshGeometry {\r\n  threeGeom = new THREE.BufferGeometry();\r\n  triangleIdx = 0;\r\n  positionAttribute;\r\n  colorAttribute;\r\n\r\n  constructor(numPoints, color = true) {\r\n    this.threeGeom.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n    );\r\n\r\n    if (color)\r\n      this.threeGeom.setAttribute(\r\n        \"color\",\r\n        new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n      );\r\n\r\n    this.positionAttribute = this.threeGeom.getAttribute(\"position\");\r\n    this.colorAttribute = this.threeGeom.getAttribute(\"color\");\r\n  }\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = meshCoords[j];\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 0,\r\n        transform.x + v1[0],\r\n        transform.y - v1[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 1,\r\n        transform.x + v2[0],\r\n        transform.y - v2[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 2,\r\n        transform.x + v3[0],\r\n        transform.y - v3[1],\r\n        z\r\n      );\r\n\r\n      if (color) {\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 0,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 1,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 2,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n      }\r\n\r\n      this.triangleIdx++;\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    this.threeGeom.setDrawRange(0, this.triangleIdx * 3);\r\n  }\r\n}\r\n\r\nexport class WaterdropMesh {\r\n  static MAX_POINTS_DROPS = 60 * 13e4; // approx num verts per droplet * approx num droplets on screen\r\n  static MAX_POINTS_OUTLINE = 40 * 13e4; // approx num verts per droplet * approx num droplets on screen\r\n\r\n  dropsMesh;\r\n  outlineMesh;\r\n\r\n  added = false;\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.dropsMesh) {\r\n      this.initializeMeshes(waterdrops);\r\n    } else {\r\n      this.updateMeshes(waterdrops);\r\n    }\r\n  }\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.dropsMesh);\r\n      scene.add(this.outlineMesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.dropsMesh);\r\n      scene.remove(this.outlineMesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  initializeMeshes(waterdrops) {\r\n    const dropsGeometry = new MeshGeometry(WaterdropMesh.MAX_POINTS_DROPS);\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = waterdropDeltaOutline(\r\n      0,\r\n      1,\r\n      LOD_1_RAD_PX * 2 * 0.975\r\n    );\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, maxLev } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = waterdropDelta(\r\n          l1 / maxLev,\r\n          l2 / maxLev,\r\n          LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / LOD_1_LEVELS)\r\n        );\r\n\r\n        dropsGeometry.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      outlinePoints.push(\r\n        ...outlineMeshCoords.map(\r\n          ([dx, dy]) => new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01)\r\n        )\r\n      );\r\n    }\r\n\r\n    dropsGeometry.finish();\r\n\r\n    this.dropsMesh = new THREE.Mesh(\r\n      dropsGeometry.threeGeom,\r\n      new THREE.MeshBasicMaterial({\r\n        vertexColors: true,\r\n        transparent: true,\r\n        opacity: 1,\r\n      })\r\n    );\r\n\r\n    this.outlineMesh = new THREE.LineSegments(\r\n      new THREE.BufferGeometry().setFromPoints(outlinePoints),\r\n      new THREE.LineBasicMaterial({\r\n        color: 0xcccccc,\r\n        transparent: true,\r\n        opacity: 0,\r\n      })\r\n    );\r\n  }\r\n\r\n  updateOutlineVisibility(opac) {\r\n    if (!this.outlineMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateVisibility(opac) {\r\n    if (!this.outlineMesh || !this.dropsMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n    this.dropsMesh.material.opacity = opac;\r\n    this.dropsMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateMeshes(waterdrops) {\r\n    // TODO fix\r\n  }\r\n}\r\n\r\nexport class WaterdropSimplifiedMesh {\r\n  mesh;\r\n  added = false;\r\n\r\n  vertToId = {};\r\n  idToVert = {};\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.mesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.mesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.mesh) {\r\n      this.initializeMesh(waterdrops);\r\n    }\r\n\r\n    this.updateMesh(waterdrops);\r\n\r\n    return this.mesh;\r\n  }\r\n\r\n  initializeMesh(waterdrops) {\r\n    const pointsGeometry = new THREE.BufferGeometry();\r\n\r\n    const vertices = [];\r\n    const colors = [];\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, domLev } = waterdrops.nodes[i];\r\n\r\n      const color = domLev > 0 ? interpolateWatercolorBlue(domLev) : \"white\";\r\n\r\n      vertices.push(x, -y, 0);\r\n      const t_color = new THREE.Color(color);\r\n      colors.push(t_color.r, t_color.g, t_color.b);\r\n\r\n      this.vertToId[i] = id;\r\n      this.idToVert[id] = i;\r\n    }\r\n\r\n    const pointsMaterial = new THREE.PointsMaterial({\r\n      size: LOD_1_RAD_PX * 2,\r\n      sizeAttenuation: true,\r\n      vertexColors: true,\r\n      map: new THREE.TextureLoader().load(\"drop.png\"),\r\n      transparent: true,\r\n    });\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(vertices), 3)\r\n    );\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"color\",\r\n      new THREE.BufferAttribute(new Float32Array(colors), 3)\r\n    );\r\n\r\n    this.mesh = new THREE.Points(pointsGeometry, pointsMaterial);\r\n  }\r\n\r\n  updateMesh(waterdrops) {\r\n    const positionAttr = this.mesh.geometry.getAttribute(\"position\");\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: newX, globalY: newY } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n      positionAttr.setXY(idx, newX, -newY);\r\n    }\r\n    positionAttr.needsUpdate = true;\r\n  }\r\n\r\n  updatePoints(waterdrops, translations, dt) {\r\n    const verts = this.mesh.geometry.vertices;\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n\r\n      const [dx, dy] = translations[id];\r\n\r\n      const x = verts[idx].x;\r\n      const y = verts[idx].y;\r\n\r\n      verts[idx].setX(x + dt * dx);\r\n      verts[idx].setY(y - dt * dy);\r\n    }\r\n\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n\r\n  intersectObject(camera, x, y) {\r\n    const intersects = camera.intersectObject(x, y, this.mesh);\r\n\r\n    if (intersects[0]) {\r\n      const intersect = sortBy(intersects, \"distanceToRay\")[0];\r\n      return this.vertToId[intersect.index];\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  view;\r\n  curTransform;\r\n\r\n  raycaster = new THREE.Raycaster();\r\n\r\n  _svgElement;\r\n\r\n  constructor({ fov, near, far }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n  }\r\n\r\n  setZoomFn(zoomFn) {\r\n    this.zoom = d3.zoom().on(\"zoom\", (e) => {\r\n      this.curTransform = e.transform;\r\n\r\n      this._THREEZoomHandler(e.transform);\r\n      d3.select(this._svgElement).attr(\"transform\", e.transform);\r\n\r\n      zoomFn && zoomFn(e.transform);\r\n    });\r\n  }\r\n\r\n  callZoom(transform) {\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity.translate(transform.x, transform.y).scale(transform.k)\r\n    );\r\n  }\r\n\r\n  callZoomFromWorldViewport({ worldX, worldY, farHeight }) {\r\n    const k = this.height / farHeight;\r\n\r\n    const x = -(worldX * k) + this.width / 2;\r\n    const y = worldY * k + this.height / 2;\r\n\r\n    this.callZoom({\r\n      x,\r\n      y,\r\n      k,\r\n    });\r\n  }\r\n\r\n  getZFromFarHeight(farHeight) {\r\n    return (Math.tan(toRadians(90 - this.fov / 2)) * farHeight) / 2;\r\n  }\r\n\r\n  getFarHeightFromZ(z) {\r\n    return Math.tan(toRadians(this.fov) / 2) * z * 2;\r\n  }\r\n\r\n  interpolateZoomCamera([endx, endy, endz]) {\r\n    const i = d3.interpolateZoom(\r\n      [\r\n        this.camera.position.x,\r\n        this.camera.position.y,\r\n        this.height / this.curTransform.k,\r\n      ],\r\n      [endx, -endy, this.getFarHeightFromZ(endz)]\r\n    );\r\n\r\n    const interper = (t) => {\r\n      const [worldX, worldY, farHeight] = i(t);\r\n\r\n      const k = this.height / farHeight;\r\n\r\n      const x = -(worldX * k) + this.width / 2;\r\n      const y = worldY * k + this.height / 2;\r\n\r\n      return {\r\n        x,\r\n        y,\r\n        k,\r\n      };\r\n    };\r\n\r\n    interper.duration = i.duration;\r\n\r\n    return interper;\r\n  }\r\n\r\n  mount(webglElement, svgElement) {\r\n    this.view = d3.select(webglElement);\r\n    this._svgElement = svgElement;\r\n  }\r\n\r\n  setSize(width, height) {\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.zoom = this.zoom.scaleExtent([\r\n      this.getScaleFromZ(this.far),\r\n      this.getScaleFromZ(this.near),\r\n    ]);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      this.fov,\r\n      width / height,\r\n      this.near,\r\n      this.far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.view.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  _THREEZoomHandler(transform) {\r\n    const scale = transform.k;\r\n    const x = -(transform.x - this.width / 2) / scale;\r\n    const y = (transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n\r\n  getScaleFromZ(camera_z_position) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const half_fov_height = Math.tan(half_fov_radians) * camera_z_position;\r\n    const fov_height = half_fov_height * 2;\r\n    const scale = this.height / fov_height;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const scale_height = this.height / scale;\r\n    const camera_z_position = scale_height / (2 * Math.tan(half_fov_radians));\r\n    return camera_z_position;\r\n  }\r\n\r\n  intersectObject(mouseX, mouseY, mesh) {\r\n    this.raycaster.setFromCamera(\r\n      {\r\n        x: mouseX,\r\n        y: mouseY,\r\n      },\r\n      this.camera\r\n    );\r\n\r\n    return this.raycaster.intersectObject(mesh);\r\n  }\r\n}\r\n\r\nexport function circlet(s) {\r\n  s.attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke\", \"orange\")\r\n    .attr(\"stroke-dasharray\", 3)\r\n    .attr(\"stroke-width\", 3)\r\n    .attr(\"vector-effect\", \"non-scaling-stroke\");\r\n}\r\n","import { AppContext } from \"AppContext\";\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport * as d3 from \"d3\";\r\nimport { FLATTENED_DATA } from \"data/objectives-data\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\nimport {\r\n  LOD_1_RAD_PX,\r\n  LOD_1_LEVELS,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n  LOD_2_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\nimport { clipEnds, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { DROPLET_SHAPE, circlet } from \"utils/render-utils\";\r\n\r\nconst SPREAD = LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\nexport default function CompareView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n    camera,\r\n    goal,\r\n    setGoal,\r\n    addZoomHandler,\r\n  } = useContext(AppContext);\r\n\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const groupsRef = useRef();\r\n  const [panels, setPanels] = useState([]);\r\n  const centerRef = useRef();\r\n  const [cameraChangeFlag, setCameraChangeFlag] = useState(false);\r\n  const mouseDownInfo = useRef({});\r\n\r\n  function addDetailPanel(dropId) {\r\n    const { globalX, globalY, x, y, id, key } = waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      const newPanel = {\r\n        text: key,\r\n        x: globalX + x * (SPREAD - 1),\r\n        y: globalY + y * (SPREAD - 1),\r\n        offsetX: 20,\r\n        offsetY: 40,\r\n        id,\r\n      };\r\n\r\n      return [...p, newPanel];\r\n    });\r\n  }\r\n\r\n  function removeDetailPanel(dropId) {\r\n    const { id } = waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      p.splice(\r\n        p.findIndex((v) => v.id === id),\r\n        1\r\n      );\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  useEffect(function initialize() {\r\n    d3.select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"compare-group\");\r\n\r\n    addZoomHandler(function () {\r\n      setCameraChangeFlag((f) => !f);\r\n    });\r\n\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current = {};\r\n    });\r\n  }, []);\r\n\r\n  function getIdealGroupPos([x, y], [centerX, centerY]) {\r\n    let newX = x,\r\n      newY = y;\r\n\r\n    const correctionX = groupsRef.current.groups[0].height;\r\n\r\n    if (newX < centerX) newX -= correctionX;\r\n    else newX += correctionX;\r\n\r\n    return [newX, newY, newX < centerX];\r\n  }\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines, nodes] = calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop\r\n        );\r\n\r\n        setPanels((p) => {\r\n          return nodes.map((n, i) => {\r\n            let ox = 0,\r\n              oy = 0;\r\n\r\n            if (p[i]) {\r\n              ox = p[i].offsetX;\r\n              oy = p[i].offsetY;\r\n            }\r\n\r\n            const pos = getIdealGroupPos(\r\n              groupsRef.current.groupPositions[i],\r\n              centerRef.current\r\n            );\r\n            return {\r\n              text: n.key,\r\n              x: pos[0],\r\n              y: pos[1],\r\n              id: n.id,\r\n              isLeft: pos[2],\r\n              offsetX: ox,\r\n              offsetY: oy,\r\n            };\r\n          });\r\n        });\r\n\r\n        d3.select(\"#compare-group\")\r\n          .selectAll(\".circlet\")\r\n          .data(positions)\r\n          .join(\"circle\")\r\n          .attr(\"class\", \"circlet\")\r\n          .call(circlet)\r\n          .attr(\"display\", \"initial\")\r\n          .attr(\"r\", LOD_1_RAD_PX * 1.5)\r\n          .transition()\r\n          .duration(100)\r\n          .attr(\"cx\", (d) => d[0])\r\n          .attr(\"cy\", (d) => d[1]);\r\n\r\n        d3.select(\"#compare-group\")\r\n          .selectAll(\".comp-line\")\r\n          .data(lines)\r\n          .join(\"path\")\r\n          .attr(\"class\", \"comp-line\")\r\n          .attr(\"stroke\", \"orange\")\r\n          .attr(\"stroke-dasharray\", 3)\r\n          .attr(\"opacity\", 0.5)\r\n          .attr(\"stroke-width\", 1)\r\n          .attr(\"vector-effect\", \"non-scaling-stroke\")\r\n          .transition()\r\n          .duration(100)\r\n          .attr(\"d\", (d) => d3.line()(d));\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"CompareView\")) {\r\n        const container = d3.select(\"#compare-group\");\r\n\r\n        updateDropsSVG(\r\n          container,\r\n          (groupsRef.current = getWaterdropGroups(\r\n            activeWaterdrops,\r\n            waterdrops,\r\n            (centerRef.current = state.avgCoord)\r\n          )),\r\n          state.transitionDuration / 5,\r\n          {\r\n            onHover: (d) => {\r\n              setActiveMinidrop(d.key);\r\n            },\r\n          }\r\n        );\r\n\r\n        setTimeout(() => {\r\n          setActiveMinidrop(groupsRef.current.groups[0].nodes[0].key);\r\n        }, state.transitionDuration + 500);\r\n\r\n        setGoBack(() => () => {\r\n          setState({ state: \"WideView\" });\r\n\r\n          resetCamera();\r\n        });\r\n\r\n        return function exitState() {\r\n          container.selectAll(\".large-drop\").remove();\r\n          container.selectAll(\".circlet\").remove();\r\n          container.selectAll(\".comp-line\").remove();\r\n          setPanels([]);\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  function onPanelDragStart(e, id) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {panels.map(({ x, y, id, isLeft, offsetX, offsetY }, i) => (\r\n        <div\r\n          className={\"panel compare-panel\" + (isLeft ? \" left\" : \"\")}\r\n          key={i}\r\n          style={{\r\n            left: `${\r\n              x * camera.curTransform.k + camera.curTransform.x + offsetX\r\n            }px`,\r\n            top: `${\r\n              y * camera.curTransform.k + camera.curTransform.y + offsetY\r\n            }px`,\r\n          }}\r\n          onMouseDown={(e) => onPanelDragStart(e, id)}\r\n        >\r\n          <DotHistogram\r\n            width={300}\r\n            height={200}\r\n            data={FLATTENED_DATA[id].deliveries}\r\n            goal={goal}\r\n            setGoal={setGoal}\r\n          />\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction getWaterdropGroups(keyArr, waterdrops, center) {\r\n  const groups = waterdrops.groups.filter((g) => keyArr.includes(g.key));\r\n\r\n  const groupPositions = [];\r\n  const rad = groups[0].height * SPREAD * 0.75;\r\n\r\n  for (let i = 0, n = groups.length; i < n; i++) {\r\n    groupPositions.push([\r\n      center[0] + Math.cos(((Math.PI * 2) / n) * i) * rad,\r\n      center[1] + Math.sin(((Math.PI * 2) / n) * i) * rad,\r\n    ]);\r\n  }\r\n\r\n  return {\r\n    groups,\r\n    groupPositions,\r\n  };\r\n}\r\n\r\nfunction updateDropsSVG(\r\n  container,\r\n  waterdropGroups,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(function ({ nodes }) {\r\n          d3.select(this)\r\n            .selectAll(\".small-drop\")\r\n            .data(nodes)\r\n            .enter()\r\n            .append(\"g\")\r\n            .attr(\"class\", \"small-drop\")\r\n            .each(function ({ levs }) {\r\n              const s = d3.select(this);\r\n              s.append(\"rect\")\r\n                .attr(\"class\", \"bbox\")\r\n                .style(\"visibility\", \"hidden\");\r\n\r\n              const randId = Math.floor(Math.random() * 1e9);\r\n\r\n              const stops = d3\r\n                .select(this)\r\n                .append(\"defs\")\r\n                .append(\"linearGradient\")\r\n                .attr(\"id\", `${randId}`)\r\n                .attr(\"x1\", \"0%\")\r\n                .attr(\"x2\", \"0%\")\r\n                .attr(\"y1\", \"0%\")\r\n                .attr(\"y2\", \"100%\");\r\n              stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n              stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n              levs.forEach((_, i) => {\r\n                stops\r\n                  .append(\"stop\")\r\n                  .attr(\r\n                    \"stop-color\",\r\n                    interpolateWatercolorBlue(i / LOD_1_LEVELS)\r\n                  );\r\n                stops\r\n                  .append(\"stop\")\r\n                  .attr(\r\n                    \"stop-color\",\r\n                    interpolateWatercolorBlue(i / LOD_1_LEVELS)\r\n                  );\r\n              });\r\n\r\n              s.append(\"path\")\r\n                .attr(\"d\", DROPLET_SHAPE)\r\n                .attr(\"class\", \"outline\")\r\n                .attr(\"fill\", \"none\")\r\n                .attr(\"stroke\", \"lightgray\")\r\n                .attr(\"stroke-width\", 0.05);\r\n\r\n              s.append(\"path\")\r\n                .attr(\"class\", \"fill\")\r\n                .attr(\"d\", DROPLET_SHAPE)\r\n                .attr(\"fill\", `url(#${randId})`);\r\n            });\r\n        });\r\n    })\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\"transform\", ({ x, y }, i) => `translate(${x}, ${y})`)\r\n    .each(function ({ nodes }) {\r\n      d3.select(this)\r\n        .selectAll(\".small-drop\")\r\n        .data(nodes)\r\n        .attr(\"display\", \"initial\")\r\n        .attr(\"transform\", ({ x, y }) => `translate(${x}, ${y})`)\r\n        .on(\"click\", function (e, d) {\r\n          onClick && onClick(d);\r\n        })\r\n        .on(\"mouseenter\", function (e, d) {\r\n          onHover && onHover(d);\r\n        })\r\n        .on(\"mouseleave\", function (e, d) {\r\n          onUnhover && onUnhover(d);\r\n        })\r\n        .each(function ({ levs, maxLev }, i) {\r\n          const s = d3.select(this);\r\n\r\n          s.select(\".outline\").attr(\r\n            \"transform\",\r\n            `scale(${LOD_1_RAD_PX * 0.95})`\r\n          );\r\n          s.select(\".fill\").attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n\r\n          s.selectAll(\"stop\").each(function (_, i) {\r\n            let actI = Math.floor(i / 2);\r\n            const isEnd = i % 2;\r\n\r\n            if (isEnd === 0) actI -= 1;\r\n\r\n            if (actI === -1) {\r\n              d3.select(this).attr(\"offset\", `${0}%`);\r\n            } else if (actI === levs.length) {\r\n              d3.select(this).attr(\"offset\", `100%`);\r\n            } else {\r\n              d3.select(this).attr(\r\n                \"offset\",\r\n                `${(1 - levs[actI] / maxLev) * 100}%`\r\n              );\r\n            }\r\n          });\r\n\r\n          const d = s.select(\".fill\");\r\n\r\n          s.select(\".bbox\")\r\n            .attr(\"x\", d.node().getBBox().x)\r\n            .attr(\"y\", d.node().getBBox().y)\r\n            .attr(\"width\", d.node().getBBox().width)\r\n            .attr(\"height\", d.node().getBBox().height);\r\n        })\r\n        .transition()\r\n        .delay(transitionDelay)\r\n        .duration(1000)\r\n        .attr(\r\n          \"transform\",\r\n          ({ x, y }) => `translate(${x * SPREAD}, ${y * SPREAD})`\r\n        );\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\r\n      \"transform\",\r\n      (_, i) =>\r\n        `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`\r\n    );\r\n}\r\n\r\nfunction calcLinesAndPositions(groupsObj, activeMinidrop) {\r\n  const positions = [];\r\n  const nodes = [];\r\n  for (let i = 0; i < groupsObj.groups.length; i++) {\r\n    const group = groupsObj.groups[i];\r\n    const groupPos = groupsObj.groupPositions[i];\r\n\r\n    const node = group.nodes.find((n) => n.key === activeMinidrop);\r\n\r\n    nodes.push(node);\r\n\r\n    positions.push([\r\n      node.x * SPREAD + groupPos[0],\r\n      node.y * SPREAD +\r\n        groupPos[1] -\r\n        dropCenterCorrection({ rad: LOD_1_RAD_PX }),\r\n    ]);\r\n  }\r\n\r\n  const lines = [];\r\n\r\n  for (let i = 0; i < positions.length; i++) {\r\n    const from = Array.from(positions[i]),\r\n      to = Array.from(positions[i + 1 == positions.length ? 0 : i + 1]);\r\n\r\n    clipEnds([from, to], LOD_1_RAD_PX * 2);\r\n\r\n    lines.push([from, to]);\r\n  }\r\n\r\n  return [positions, lines, nodes];\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport {\r\n  LOD_1_LEVELS,\r\n  LOD_1_RAD_PX,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n  LOD_2_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\nimport { isState, useStateRef } from \"utils/misc-utils\";\r\nimport { DROPLET_SHAPE, circlet } from \"utils/render-utils\";\r\nimport { FLATTENED_DATA } from \"data/objectives-data\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport { dropCenterCorrection } from \"utils/math-utils\";\r\n\r\nconst SPREAD = LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\nexport default function ExamineView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n    camera,\r\n    addZoomHandler,\r\n    goal,\r\n    setGoal,\r\n  } = useContext(AppContext);\r\n\r\n  const [activeMinidrops, setActiveMinidrops, activeMinidropsRef] = useStateRef(\r\n    []\r\n  );\r\n  const [previewMinidrop, setPreviewMinidrop, previewMinidropRef] =\r\n    useStateRef(null);\r\n  const [panels, setPanels] = useState([]);\r\n  const [cameraChangeFlag, setCameraChangeFlag] = useState(false);\r\n\r\n  const mouseDownInfo = useRef({});\r\n\r\n  function addDetailPanel(dropId) {\r\n    const { globalX, globalY, x, y, id, key } = waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      const newPanel = {\r\n        text: key,\r\n        x: globalX + x * (SPREAD - 1),\r\n        y: globalY + y * (SPREAD - 1),\r\n        offsetX: 20,\r\n        offsetY: 40,\r\n        id,\r\n      };\r\n\r\n      return [...p, newPanel];\r\n    });\r\n  }\r\n\r\n  function removeDetailPanel(dropId) {\r\n    const { id } = waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      p.splice(\r\n        p.findIndex((v) => v.id === id),\r\n        1\r\n      );\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  useEffect(function initialize() {\r\n    d3.select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"examine-group\");\r\n\r\n    addZoomHandler(function () {\r\n      setCameraChangeFlag((f) => !f);\r\n    });\r\n\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current = {};\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"ExamineView\")) {\r\n        const transitionDelay = state.transitionDuration;\r\n        const container = d3.select(\"#examine-group\");\r\n\r\n        updateSmallDropSVG(\r\n          container,\r\n          waterdrops.groups.find((g) => g.key === activeWaterdrops[0]).nodes,\r\n          transitionDelay / 2,\r\n          {\r\n            onClick: (d) => {\r\n              setActiveMinidrops((wd) => {\r\n                if (wd.includes(d.id)) {\r\n                  wd.splice(wd.indexOf(d.id), 1);\r\n                  container\r\n                    .select(\".circlet.i\" + d.id)\r\n                    .classed(\"active\", false);\r\n\r\n                  removeDetailPanel(d.id);\r\n                } else {\r\n                  wd.push(d.id);\r\n                  container.select(\".circlet.i\" + d.id).classed(\"active\", true);\r\n\r\n                  addDetailPanel(d.id);\r\n                }\r\n                return [...wd];\r\n              });\r\n            },\r\n            onHover: (d) => {\r\n              if (!activeMinidropsRef.current.includes(d.id)) {\r\n                setPreviewMinidrop(d.id);\r\n                addDetailPanel(d.id);\r\n              }\r\n            },\r\n            onUnhover: (d) => {\r\n              if (previewMinidropRef.current === d.id) {\r\n                setPreviewMinidrop(null);\r\n                removeDetailPanel(d.id);\r\n              }\r\n            },\r\n          }\r\n        );\r\n\r\n        setGoBack(() => () => {\r\n          setState({ state: \"WideView\" });\r\n\r\n          resetCamera();\r\n        });\r\n\r\n        return function exitState() {\r\n          container.selectAll(\".small-drop\").attr(\"display\", \"none\");\r\n\r\n          container\r\n            .selectAll(\".circlet\")\r\n            .classed(\"active\", false)\r\n            .select(\"circle\")\r\n            .attr(\"display\", \"none\");\r\n          setPanels([]);\r\n          setActiveMinidrops([]);\r\n          setPreviewMinidrop(null);\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  function onPanelDragStart(e, id) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {panels.map(({ x, y, id, offsetX, offsetY }) => (\r\n        <div\r\n          className=\"panel\"\r\n          key={id}\r\n          style={{\r\n            left: `${\r\n              x * camera.curTransform.k + camera.curTransform.x + offsetX\r\n            }px`,\r\n            top: `${\r\n              y * camera.curTransform.k + camera.curTransform.y + offsetY\r\n            }px`,\r\n          }}\r\n          onMouseDown={(e) => onPanelDragStart(e, id)}\r\n        >\r\n          <DotHistogram\r\n            width={300}\r\n            height={200}\r\n            data={FLATTENED_DATA[id].deliveries}\r\n            goal={goal}\r\n            setGoal={setGoal}\r\n          />\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction updateSmallDropSVG(\r\n  container,\r\n  waterdrops,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  container\r\n    .selectAll(\".small-drop\")\r\n    .data(waterdrops)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"small-drop\")\r\n        .each(function ({ levs }, i) {\r\n          // TODO replace with tooltip, remove unnec svg\r\n\r\n          const s = d3.select(this);\r\n          s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n          const stops = d3\r\n            .select(this)\r\n            .append(\"defs\")\r\n            .append(\"linearGradient\")\r\n            .attr(\"id\", `drop-fill-${i}`)\r\n            .attr(\"x1\", \"0%\")\r\n            .attr(\"x2\", \"0%\")\r\n            .attr(\"y1\", \"0%\")\r\n            .attr(\"y2\", \"100%\");\r\n          stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n          stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n          levs.forEach((_, i) => {\r\n            stops\r\n              .append(\"stop\")\r\n              .attr(\"stop-color\", interpolateWatercolorBlue(i / LOD_1_LEVELS));\r\n            stops\r\n              .append(\"stop\")\r\n              .attr(\"stop-color\", interpolateWatercolorBlue(i / LOD_1_LEVELS));\r\n          });\r\n\r\n          s.append(\"path\")\r\n            .attr(\"d\", DROPLET_SHAPE)\r\n            .attr(\"class\", \"outline\")\r\n            .attr(\"fill\", \"none\")\r\n            .attr(\"stroke\", \"lightgray\")\r\n            .attr(\"stroke-width\", 0.05);\r\n\r\n          s.append(\"path\")\r\n            .attr(\"class\", \"fill\")\r\n            .attr(\"d\", DROPLET_SHAPE)\r\n            .attr(\"fill\", `url(#drop-fill-${i})`);\r\n\r\n          s.append(\"g\")\r\n            .attr(\"class\", \"circlet\")\r\n            .append(\"circle\")\r\n            .call(circlet)\r\n            .attr(\"display\", \"none\")\r\n            .attr(\"cy\", -dropCenterCorrection({ rad: 1 }))\r\n            .attr(\"r\", 1.5);\r\n        });\r\n    })\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\r\n      \"transform\",\r\n      ({ globalX, globalY }) => `translate(${globalX}, ${globalY})`\r\n    )\r\n    .each(function ({ levs, maxLev, key, id }, i) {\r\n      const s = d3.select(this);\r\n\r\n      s.select(\".outline\").attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n      s.select(\".fill\").attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n\r\n      s.select(\".circlet\")\r\n        .attr(\"class\", null)\r\n        .attr(\"class\", \"circlet i\" + id);\r\n\r\n      s.selectAll(\"stop\").each(function (_, i) {\r\n        let actI = Math.floor(i / 2);\r\n        const isEnd = i % 2;\r\n\r\n        if (isEnd === 0) actI -= 1;\r\n\r\n        if (actI === -1) {\r\n          d3.select(this).attr(\"offset\", `${0}%`);\r\n        } else if (actI === levs.length) {\r\n          d3.select(this).attr(\"offset\", `100%`);\r\n        } else {\r\n          d3.select(this).attr(\"offset\", `${(1 - levs[actI] / maxLev) * 100}%`);\r\n        }\r\n      });\r\n\r\n      const d = s.select(\".fill\");\r\n\r\n      s.select(\".bbox\")\r\n        .attr(\"x\", d.node().getBBox().x)\r\n        .attr(\"y\", d.node().getBBox().y)\r\n        .attr(\"width\", d.node().getBBox().width)\r\n        .attr(\"height\", d.node().getBBox().height);\r\n    })\r\n    .on(\"click\", function (_, d) {\r\n      onClick && onClick(d);\r\n    })\r\n    .on(\"mouseenter\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"display\", \"initial\");\r\n      onHover && onHover(d);\r\n    })\r\n    .on(\"mouseleave\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"display\", \"none\");\r\n      onUnhover && onUnhover(d);\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\r\n      \"transform\",\r\n      ({ globalX, globalY, x, y }) =>\r\n        `translate(${globalX + x * (SPREAD - 1)}, ${\r\n          globalY + y * (SPREAD - 1)\r\n        }) rotate(${0})`\r\n    );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useCallback, useContext, useEffect, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { GROUP_HOVER_AREA_FACTOR } from \"settings\";\r\nimport { dropsMesh, scene } from \"three-resources\";\r\nimport { isState, useStateRef, wrap } from \"utils/misc-utils\";\r\nimport { BiCross, BiNetworkChart } from \"react-icons/bi\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { LOD_2_SMALL_DROP_PAD_FACTOR } from \"settings\";\r\nimport { LOD_1_SMALL_DROP_PAD_FACTOR } from \"settings\";\r\nimport {\r\n  dist,\r\n  distSq,\r\n  dropCenterCorrection,\r\n  getCenterDomRect,\r\n} from \"utils/math-utils\";\r\nimport {\r\n  CALIFORNIA_CENTER,\r\n  CALIFORNIA_OUTLINE,\r\n  SPATIAL_DATA,\r\n  SPATIAL_FEATURES,\r\n} from \"data/spatial-data\";\r\nimport { circlet } from \"utils/render-utils\";\r\n\r\nexport default function WideView() {\r\n  const {\r\n    waterdrops,\r\n    state,\r\n    setState,\r\n    camera,\r\n    zoomTo,\r\n    setActiveWaterdrops,\r\n    activeWaterdrops,\r\n    setDisableCamAdjustments,\r\n    getOutlineOpac,\r\n    addZoomHandler,\r\n    appWidth,\r\n    appHeight,\r\n  } = useContext(AppContext);\r\n\r\n  const [activeWDObjs, setActiveWDObjs] = useState([]);\r\n  const [enableZoom, setEnableZoom, enableZoomRef] = useStateRef(false);\r\n\r\n  const [transformInfo, setTransformInfo] = useState({\r\n    zoom: 1,\r\n    mouseX: 0,\r\n    mouseY: 0,\r\n  });\r\n\r\n  const [curInfo, setCurInfo] = useState(null);\r\n\r\n  const getFontSize = (d, transformZoom) => {\r\n    const MAX_RAD = window.innerHeight / 9;\r\n\r\n    const zoomRel = ((1 / transformZoom) * camera.height) / waterdrops.height;\r\n\r\n    const absFontSize = (_d) =>\r\n      _d > MAX_RAD\r\n        ? 0\r\n        : d3.scaleLinear().domain([0, MAX_RAD]).range([1, 0.4]).clamp(true)(_d);\r\n\r\n    return absFontSize(d * zoomRel) * Math.min(zoomRel, 0.4);\r\n  };\r\n\r\n  useEffect(\r\n    function updateFontSizes() {\r\n      d3.select(\".infobox\").attr(\"display\", \"none\");\r\n\r\n      if (!enableZoomRef.current) return;\r\n\r\n      d3.select(\"#wide-group\")\r\n        .selectAll(\"text\")\r\n        .each(function () {\r\n          const s = d3.select(this);\r\n          const tNode = s.node();\r\n\r\n          const [posx, posy] = getCenterDomRect(tNode.getBoundingClientRect());\r\n\r\n          const width =\r\n              ((tNode.getBBox().width * camera.height) / camera.far) * 8,\r\n            height =\r\n              ((tNode.getBBox().height * camera.height) / camera.far) * 10;\r\n\r\n          const dis = dist(\r\n            [posx, posy],\r\n            [transformInfo.mouseX, transformInfo.mouseY]\r\n          );\r\n\r\n          s.attr(\"font-size\", getFontSize(dis, transformInfo.zoom));\r\n\r\n          d3.select(this.parentNode.parentNode)\r\n            .select(\"image\")\r\n            .attr(\"x\", -width / 2)\r\n            .attr(\"y\", -height / 2)\r\n            .attr(\"width\", width)\r\n            .attr(\"height\", height);\r\n        });\r\n    },\r\n    [transformInfo]\r\n  );\r\n\r\n  useEffect(function initialize() {\r\n    d3.select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"wide-group\");\r\n\r\n    addZoomHandler(function (transform) {\r\n      setTransformInfo((ti) => ({\r\n        ...ti,\r\n        zoom: transform.k,\r\n      }));\r\n    });\r\n\r\n    const mouseListener = (e) => {\r\n      setTransformInfo((ti) => ({\r\n        ...ti,\r\n        mouseX: e.x,\r\n        mouseY: e.y,\r\n      }));\r\n    };\r\n\r\n    window.addEventListener(\"mousemove\", mouseListener);\r\n\r\n    const mmWidth = 200,\r\n      mmHeight = 250;\r\n\r\n    const minimap = d3\r\n      .select(\"#minimap\")\r\n      .attr(\"width\", mmWidth)\r\n      .attr(\"height\", mmHeight);\r\n\r\n    const mmProj = d3\r\n      .geoMercator()\r\n      .scale(1000)\r\n      .center(CALIFORNIA_CENTER)\r\n      .translate([mmWidth / 2, mmHeight / 2]);\r\n\r\n    const lineGeom = [\r\n      ...SPATIAL_DATA.features.filter(\r\n        (f, i) => f.geometry.type === \"MultiPolygon\"\r\n      ),\r\n      CALIFORNIA_OUTLINE,\r\n    ];\r\n    const pointGeom = SPATIAL_DATA.features.filter(\r\n      (f, i) => f.geometry.type === \"MultiPoint\"\r\n    );\r\n\r\n    minimap\r\n      .selectAll(\"path\")\r\n      .data(lineGeom)\r\n      .join(\"path\")\r\n      .attr(\"d\", (d) => d3.geoPath().projection(mmProj)(d))\r\n      .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n      .attr(\"stroke\", (d) =>\r\n        d.properties.CalLiteID ? \"transparent\" : \"lightgray\"\r\n      )\r\n      .attr(\"stroke-width\", 1)\r\n      .attr(\"fill\", \"transparent\");\r\n\r\n    minimap\r\n      .selectAll(\"circle\")\r\n      .data(pointGeom)\r\n      .join(\"circle\")\r\n      .each(function (d) {\r\n        const s = d3.select(this);\r\n\r\n        const [x, y] = mmProj(d.geometry.coordinates[0]);\r\n\r\n        s.attr(\"cx\", x);\r\n        s.attr(\"cy\", y);\r\n      })\r\n      .attr(\"r\", 2)\r\n      .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n      .attr(\"fill\", \"transparent\");\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener(\"mousemove\", mouseListener);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"WideView\")) {\r\n        setEnableZoom(true);\r\n        setTransformInfo((ti) => ({ ...ti, zoom: camera.curTransform.k }));\r\n\r\n        console.time(\"drawing\");\r\n        dropsMesh.draw(scene);\r\n        console.timeEnd(\"drawing\");\r\n\r\n        const origOpac = getOutlineOpac(camera.curTransform.k);\r\n\r\n        dropsMesh.updateVisibility(1);\r\n        dropsMesh.updateOutlineVisibility(origOpac);\r\n\r\n        const container = d3.select(\"#wide-group\");\r\n        d3.select(\".infobox\").style(\"display\", \"initial\");\r\n\r\n        updateLargeDropSVG(container, waterdrops, {\r\n          onClick: (d) => {\r\n            setActiveWDObjs((wd) => {\r\n              const found = wd.findIndex((wd) => wd.key === d.key);\r\n              if (found !== -1) {\r\n                wd.splice(found, 1);\r\n              } else {\r\n                wd.push(d);\r\n              }\r\n              return [...wd];\r\n            });\r\n\r\n            setActiveWaterdrops((wd) => {\r\n              if (wd.includes(d.key)) {\r\n                wd.splice(wd.indexOf(d.key), 1);\r\n                container.select(\".circlet.\" + d.key).classed(\"active\", false);\r\n              } else {\r\n                wd.push(d.key);\r\n                container.select(\".circlet.\" + d.key).classed(\"active\", true);\r\n              }\r\n              return [...wd];\r\n            });\r\n          },\r\n          onHover: (d) => {\r\n            setCurInfo({\r\n              id: d.key,\r\n              description: DESCRIPTIONS_DATA[d.key].desc,\r\n            });\r\n\r\n            if (!SPATIAL_FEATURES[d.key]) return;\r\n\r\n            d3.select(\"#minimap\")\r\n              .select(\".outline.\" + d.key)\r\n              .attr(\"fill\", \"gray\");\r\n          },\r\n          onUnhover: (d) => {\r\n            setCurInfo(null);\r\n\r\n            if (!SPATIAL_FEATURES[d.key]) return;\r\n\r\n            d3.select(\"#minimap\")\r\n              .select(\".outline.\" + d.key)\r\n              .attr(\"fill\", \"transparent\");\r\n          },\r\n        });\r\n\r\n        for (const wd of activeWDObjs) {\r\n          container.select(\".circlet.\" + wd.key).classed(\"active\", true);\r\n        }\r\n\r\n        return function exitState() {\r\n          d3.select(\"#wide-group\")\r\n            .selectAll(\".large-drop\")\r\n            .attr(\"display\", \"none\");\r\n          d3.select(\".infobox\").style(\"display\", \"none\");\r\n          setEnableZoom(false);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  const handleClick = useCallback(\r\n    function () {\r\n      if (activeWDObjs.length === 1) {\r\n        const d = activeWDObjs[0];\r\n\r\n        const { start, duration } = zoomTo(\r\n          [\r\n            d.x,\r\n            d.y - d.height * 0.08,\r\n            camera.getZFromFarHeight(\r\n              ((d.height * LOD_2_SMALL_DROP_PAD_FACTOR) /\r\n                LOD_1_SMALL_DROP_PAD_FACTOR) *\r\n                1.5\r\n            ),\r\n          ],\r\n          () => {\r\n            setDisableCamAdjustments(false);\r\n          }\r\n        );\r\n\r\n        start();\r\n\r\n        setState({ state: \"ExamineView\", transitionDuration: duration });\r\n\r\n        const origOpac = getOutlineOpac(camera.curTransform.k);\r\n        setDisableCamAdjustments(true);\r\n\r\n        const t = d3.timer((elapsed) => {\r\n          const et = Math.min(1, elapsed / (duration / 2));\r\n\r\n          dropsMesh.updateVisibility(1 - et);\r\n          dropsMesh.updateOutlineVisibility(origOpac * (1 - et));\r\n\r\n          if (et >= 1) {\r\n            t.stop();\r\n            dropsMesh.remove(scene);\r\n          }\r\n        });\r\n      } else if (activeWDObjs.length > 1) {\r\n        const coords = activeWDObjs.map((w) => [w.x, w.y]);\r\n        const avgX = d3.mean(coords, (c) => c[0]);\r\n        const avgY = d3.mean(coords, (c) => c[1]);\r\n\r\n        const { start, duration } = zoomTo(\r\n          [\r\n            avgX,\r\n            avgY,\r\n            camera.getZFromFarHeight(\r\n              ((waterdrops.groups[0].height * 2 * LOD_2_SMALL_DROP_PAD_FACTOR) /\r\n                LOD_1_SMALL_DROP_PAD_FACTOR) *\r\n                0.75 *\r\n                2\r\n            ),\r\n          ],\r\n          () => {\r\n            setDisableCamAdjustments(false);\r\n          }\r\n        );\r\n\r\n        start();\r\n\r\n        setState({\r\n          state: \"CompareView\",\r\n          transitionDuration: duration,\r\n          avgCoord: [avgX, avgY],\r\n        });\r\n\r\n        const origOpac = getOutlineOpac(camera.curTransform.k);\r\n        setDisableCamAdjustments(true);\r\n\r\n        const t = d3.timer((elapsed) => {\r\n          const et = Math.min(1, elapsed / (duration / 5));\r\n\r\n          dropsMesh.updateVisibility(1 - et);\r\n          dropsMesh.updateOutlineVisibility(origOpac * (1 - et));\r\n\r\n          if (et >= 1) {\r\n            t.stop();\r\n\r\n            dropsMesh.remove(scene);\r\n          }\r\n        });\r\n      }\r\n    },\r\n    [activeWDObjs]\r\n  );\r\n\r\n  let actionBtn;\r\n\r\n  if (isState(state, \"WideView\") && activeWaterdrops.length) {\r\n    actionBtn = (\r\n      <button onClick={handleClick} className=\"wide-view-action-btn fancy-font\">\r\n        {activeWaterdrops.length === 1 ? <BiCross /> : <BiNetworkChart />}\r\n        {activeWaterdrops.length === 1 ? \"examine\" : \"compare\"}\r\n      </button>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"infobox\">\r\n        <svg id=\"minimap\"></svg>\r\n        {curInfo && (\r\n          <div className=\"details\">\r\n            {!SPATIAL_FEATURES[curInfo.id] && (\r\n              <p className=\"no-loc-data\">No Location Data</p>\r\n            )}\r\n            <p className=\"curDesc\">{curInfo.description}</p>\r\n            <p className=\"curKey\">\r\n              id: <span> {curInfo.id} </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n      {actionBtn}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction updateLargeDropSVG(\r\n  container,\r\n  waterdrops,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  console.log(\"updating svg\");\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdrops.groups)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(function (d) {\r\n          const s = d3.select(this);\r\n\r\n          s.append(\"g\")\r\n            .attr(\"class\", \"circlet\")\r\n            .append(\"circle\")\r\n            .call(circlet)\r\n            .attr(\"display\", \"none\")\r\n            .attr(\"r\", 1);\r\n\r\n          const textGroup = s.append(\"g\");\r\n          textGroup\r\n            .append(\"g\")\r\n            .append(\"image\")\r\n            .attr(\"href\", \"glow.png\")\r\n            .attr(\"preserveAspectRatio\", \"none\")\r\n            .attr(\"opacity\", 0.8);\r\n          textGroup\r\n            .append(\"g\")\r\n            .append(\"text\")\r\n            .attr(\"class\", \"fancy-font\")\r\n            .attr(\"text-anchor\", \"middle\")\r\n            .attr(\"font-size\", 0);\r\n        });\r\n    })\r\n    .each(function (d) {\r\n      d3.select(this)\r\n        .select(\".circlet\")\r\n        .attr(\"class\", null)\r\n        .attr(\"class\", \"circlet \" + d.key);\r\n      d3.select(this)\r\n        .select(\"text\")\r\n        .call((s) => {\r\n          s.selectAll(\"*\").remove();\r\n          const lines = wrap(\r\n            DESCRIPTIONS_DATA[d.key].display_name || DESCRIPTIONS_DATA[d.key].id\r\n          ).split(\"\\n\");\r\n\r\n          lines.forEach((line, i) => {\r\n            s.append(\"tspan\")\r\n              .attr(\"x\", 0)\r\n              .attr(\"y\", `${-lines.length / 2 + 0.5}em`)\r\n              .attr(\"dy\", `${i}em`)\r\n              .text(line);\r\n          });\r\n        });\r\n    })\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\r\n      \"transform\",\r\n      ({ x, y, height }) =>\r\n        `translate(${x}, ${y - dropCenterCorrection({ height })}) scale(${\r\n          height * GROUP_HOVER_AREA_FACTOR\r\n        })`\r\n    )\r\n    .on(\"click\", function (_, d) {\r\n      onClick && onClick(d);\r\n    })\r\n    .on(\"mouseenter\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"display\", \"initial\");\r\n      onHover && onHover(d);\r\n    })\r\n    .on(\"mouseleave\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"display\", \"none\");\r\n      onUnhover && onUnhover(d);\r\n    });\r\n}\r\n"],"names":["waterdrops","initWaterdrops","appWidth","window","innerWidth","appHeight","innerHeight","App","state","setState","stateRef","useStateRef","zoomCallbacks","setZoomCallbacks","zoomCallbacksRef","activeWaterdrops","setActiveWaterdrops","useState","goBack","setGoBack","disableCamAdjustments","setDisableCamAdjustments","disableCamAdjustmentsRef","goal","setGoal","getOutlineOpac","useCallback","d3","domain","height","groups","range","clamp","useEffect","document","querySelector","appendChild","renderer","domElement","attr","camera","mount","node","select","setZoomFn","transform","current","dropsMesh","updateOutlineVisibility","k","cb","setSize","setAnimationLoop","render","scene","resetCamera","animated","arguments","length","undefined","callback","pos","getZFromFarHeight","start","zoomTo","callZoomFromWorldViewport","worldX","worldY","farHeight","xyz","i","interpolateZoomCamera","duration","t","elapsed","et","Math","min","callZoom","stop","addZoomHandler","cbs","_jsxs","AppContext","Provider","value","pointsMesh","children","className","_jsx","id","WideView","ExamineView","CompareView","onClick","console","time","createMesh","timeEnd","createContext","getQuantileBins","data","unitsPerQuantile","width","numQuantiles","histBins","d","thresholds","ticksExact","ceil","binnedQuantiles","quantileBins","quantiles","b","y","push","x1","x0","count","map","numericBins","maxQuantiles","bin","round","sum","Infinity","interpolateWatercolorBlue","NUM_CIRCLES","MARGIN","top","right","bottom","left","DOMAIN","MAX_DELIVS","WATERDROP_ICON","draw","context","size","moveTo","lineTo","arc","SQRT2","PI","closePath","DotHistogram","_ref","razorID","useRef","floor","random","razorAreaID","svgSelector","circles","useMemo","dataRange","x","filter","style","append","concat","call","scale","tickFormat","s","selectAll","text","razor","ignoreFn","e","preventDefault","dragging","addEventListener","removeEventListener","target","max","offsetX","svgCircles","join","enter","ref","DESCRIPTIONS_DATA","async","objs","fetch","json","log","mapBy","SCEN_DIVISOR","SCENARIO_KEY_STRING","DELIV_KEY_STRING","OBJECTIVES_DATA","obj","scen","unord","v","Array","from","sort","a","name","_ref2","OBJECTIVE_IDS","Object","keys","SCENARIO_IDS","values","_","FLATTENED_DATA","DATA_GROUPINGS","flattenedData","dataGroupings","objective","scenario","means","idx","deliveries","orderedDataGroupings","criteria","asdfasdf","key","ids","sortedObjScens","sorted","mean","flat","IDtoRank","j","rank","SPATIAL_DATA","SPATIAL_FEATURES","features","properties","CalLiteID","CALIFORNIA_OUTLINE","CALIFORNIA_CENTER","LOD_1_LEVELS","LOD_1_RAD_PX","LOD_1_MIN_LEV_VAL","LOD_1_SMALL_DROP_PAD_FACTOR","LOD_1_LARGE_DROP_PAD_FACTOR","LOD_2_SMALL_DROP_PAD_FACTOR","GROUP_HOVER_AREA_FACTOR","SQRT1_2","THREE","background","WaterdropMesh","WaterdropSimplifiedMesh","Camera","fov","near","far","antialias","grouping","groupKeys","memberKeys","amtPerGroup","largeDropRad","sqrt","smallDropRad","largeNodesPhys","placeDropsUsingPhysics","p","r","largeNodesPos","smallNodesPhys","smallNodesPos","nodes","groupNodes","groupToNodes","nodeData","createInterpsFromDelivs","levs","w","groupID","memberID","groupRank","memberRank","maxLev","domLev","calcDomLev","tilt","dur","group","globalX","globalY","groupKey","delivs","maxDelivs","generateWaterdrop","rad","delta","outer","cos","sin","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","reuse","shape","bounds","Matter","create","minX","maxX","minY","maxY","genX","genY","points","contains","generateRandoPoints","WIDTH_AREA","AREA","radsToDropWidth","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","_ref3","nx","ny","circle","restitution","parts","quad","position","centre","vertices","isStatic","cage","setParts","setCentre","add","world","FPS","SECS","update","retVal","_ref4","CIRC_RAD","DROP_HEIGHT","toRadians","dist","_ref7","_ref8","y1","x2","y2","_ref5","_ref6","distSq","getCenterDomRect","domRect","clipEnds","_ref9","shortenBy","to","len","normed","dropCenterCorrection","_ref10","dropRadToDropHeight","fn","newObjs","groupBy","sortBy","array","object","path","defaultValue","_object","split","part","get","pick","va","vb","val","_setState","curVal","isState","stateInfo","stateName","wrap","replace","DROPLET_SHAPE","DROP_RAD","CIRC_HEIGHT","HAT_START","yToHalfWidth","trigX","angle","acos","yToSpriteY","spriteYToY","sy","waterdropDelta","yStart","yEnd","abs","Y_DELTA","dx1","dy1","dx2","dy2","v1","v2","v3","v4","MeshGeometry","constructor","numPoints","color","threeGeom","triangleIdx","this","setAttribute","Float32Array","positionAttribute","getAttribute","colorAttribute","addMeshCoords","meshCoords","z","setXYZ","g","finish","setDrawRange","added","updateMeshes","initializeMeshes","outlineMesh","remove","dropsGeometry","MAX_POINTS_DROPS","outlinePoints","outlineMeshCoords","rightCoords","leftCoords","reverse","waterdropDeltaOutline","dx","dy","vertexColors","transparent","opacity","setFromPoints","opac","material","needsUpdate","updateVisibility","MAX_POINTS_OUTLINE","vertToId","idToVert","mesh","initializeMesh","updateMesh","pointsGeometry","colors","t_color","pointsMaterial","sizeAttenuation","load","positionAttr","geometry","newX","newY","setXY","updatePoints","translations","dt","verts","setX","setY","verticesNeedUpdate","intersectObject","intersects","intersect","index","raycaster","zoomFn","zoom","on","curTransform","_THREEZoomHandler","_svgElement","view","translate","tan","getFarHeightFromZ","endx","endy","endz","interper","webglElement","svgElement","scaleExtent","getScaleFromZ","set","getZFromScale","camera_z_position","half_fov","half_fov_radians","fov_height","mouseX","mouseY","setFromCamera","circlet","SPREAD","useContext","activeMinidrop","setActiveMinidrop","groupsRef","panels","setPanels","centerRef","cameraChangeFlag","setCameraChangeFlag","mouseDownInfo","f","startX","deltaX","deltaY","startY","find","oldOffsetX","offsetY","oldOffsetY","positions","lines","calcLinesAndPositions","n","ox","oy","centerX","centerY","correctionX","getIdealGroupPos","groupPositions","isLeft","transition","container","updateDropsSVG","getWaterdropGroups","avgCoord","transitionDuration","onHover","setTimeout","_Fragment","onMouseDown","clientX","clientY","onPanelDragStart","keyArr","center","includes","waterdropGroups","transitionDelay","onUnhover","each","randId","stops","forEach","actI","getBBox","delay","_ref11","groupsObj","groupPos","activeMinidrops","setActiveMinidrops","activeMinidropsRef","previewMinidrop","setPreviewMinidrop","previewMinidropRef","addDetailPanel","dropId","removeDetailPanel","splice","findIndex","updateSmallDropSVG","wd","indexOf","classed","activeWDObjs","setActiveWDObjs","enableZoom","setEnableZoom","enableZoomRef","transformInfo","setTransformInfo","curInfo","setCurInfo","tNode","posx","posy","getBoundingClientRect","dis","getFontSize","transformZoom","MAX_RAD","zoomRel","_d","parentNode","ti","mouseListener","minimap","mmProj","mmWidth","mmHeight","lineGeom","type","pointGeom","projection","coordinates","origOpac","updateLargeDropSVG","found","description","desc","handleClick","avgX","c","avgY","actionBtn","BiCross","BiNetworkChart","textGroup","display_name","line"],"sourceRoot":""}