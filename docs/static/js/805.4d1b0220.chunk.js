"use strict";(self.webpackChunkcoeqwal_website=self.webpackChunkcoeqwal_website||[]).push([[805],{4805:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.r(e),a.d(e,{default:()=>p});a(5043);var n=a(4096),s=a(6313),o=a(5621),i=a(4654),c=a(4293),l=a(9336),d=a(579),u=t([s,o,i,c,l]);function p(){const t=(0,l.A)();return(0,d.jsxs)(n.B.Provider,{value:t,children:[(0,d.jsxs)("div",{className:"bubbles-wrapper",children:[(0,d.jsx)("div",{id:"mosaic-webgl"}),(0,d.jsx)("svg",{id:"mosaic-svg",children:(0,d.jsx)("g",{className:"svg-trans"})})]}),(0,d.jsx)(i.A,{}),(0,d.jsx)(s.A,{}),(0,d.jsx)(o.A,{}),(0,d.jsx)(c.A,{}),t.goBack&&(0,d.jsx)("button",{className:"go-back-btn",onClick:t.goBack,children:"\u2190"})]})}[s,o,i,c,l]=u.then?(await u)():u,r()}catch(h){r(h)}}))},4096:(t,e,a)=>{a.d(e,{B:()=>r});const r=(0,a(5043).createContext)({})},5111:(t,e,a)=>{a.d(e,{A:()=>d});var r=a(5760),n=a(5043),s=a(1684),o=a(579);const i=40,c=10,l=3;function d(t){let{levelInterp:e,colorInterp:a=s.YW,width:d=200,height:u=400,resolution:h=c}=t;const p=(0,n.useId)(),m=(0,n.useRef)(),f=(0,n.useMemo)((()=>(0,s.kd)(0,1,h+1).map((t=>e(t)))),[e,h]),g=(0,s.ZC)(f),y=d-2*l,A=u-l;return(0,n.useLayoutEffect)((()=>{const t=m.current.append("g").attr("class","svg-container").attr("transform","translate(".concat(l,", ").concat(l/2,")"));t.append("defs").append("clipPath").attr("id","bucket-mask-"+p).append("path").attr("class","bucket-mask-path"),t.append("g").attr("class","graph-area").attr("clip-path","url(#bucket-mask-".concat(p,")")),t.append("g").append("path").attr("class","bucket-outline").attr("stroke","lightgray").attr("stroke-linecap","round").attr("stroke-width",l).attr("fill","none")}),[p]),(0,n.useLayoutEffect)((()=>{const t=m.current.attr("width",d).attr("height",u).select(".svg-container");t.select(".bucket-mask-path").attr("d",(0,s.wh)(y,A)),t.select(".bucket-outline").attr("d",(0,s.wh)(y,A).split("z")[0])}),[d,u,y,A]),(0,n.useLayoutEffect)((()=>{const t=m.current.select(".graph-area").selectAll(".bucketBox").data(f).join("rect").attr("class","bucketBox").attr("width",2*y).attr("height",2*A).attr("x",-y/2).attr("fill",((t,e)=>a(e/h)));t.transition("liquidLevel").ease(r.easeElasticOut.period(.6)).delay(((t,e)=>e*(100/h))).duration(1e3).attr("y",(t=>A-t*A)),t.transition("liquidSway").duration(2e3).delay(((t,e)=>10*e)).ease(r.easeQuad).attrTween("transform",(function(t,e){const a=g?Math.abs(g[e]-t):0;return t=>"rotate(".concat(Math.sin(Math.min(4*Math.PI*t/(.5*a+.5),4*Math.PI))*a*i*(1-t),", ").concat(y/2,", ",0,")")}))}),[f,g,d,u,y,A,h,a]),(0,o.jsx)("div",{className:"bucket-wrapper",children:(0,o.jsx)("svg",{ref:t=>{m.current=r.select(t)}})})}},4987:(t,e,a)=>{a.d(e,{u:()=>s});var r=a(5760),n=a(1684);function s(t,e,a,s,o){const i=t.length/a;let c=r.histogram().value((t=>t)).domain(e).thresholds((0,n.kd)(...e,Math.ceil(s/(o/i))))(t),l=(0,n.Q2)(c,a,i),d=[];for(let r=0;r<l.length;r++)for(let e=0;e<l[r];e++)d.push([(c[r].x1+c[r].x0)/2,(e+.5)/i*t.length]);return d}},1684:(t,e,a)=>{a.d(e,{Q2:()=>i,YW:()=>l,ZC:()=>c,kd:()=>s,wh:()=>o});var r=a(5760),n=a(5043);function s(t,e,a){return r.range(a).map((r=>r/(a-1)*(e-t)+t))}function o(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8,s=t*n+t*(1-n)/2,o=t*(1-n)/2,i=[{x:r.interpolate(s,t)(a),y:r.interpolate(e,0)(a)},{x:s,y:e},{x:o,y:e},{x:r.interpolate(o,0)(a),y:r.interpolate(e,0)(a)}];return r.line().x((function(t){return t.x})).y((function(t){return t.y}))(i)+"z"}function i(t,e,a){let n=t.map((t=>Math.round(t.length/e))),s=r.sum(n);for(;s>a;)n[r.minIndex(t,((t,a)=>0!==t.length?t.length/e-n[a]:1/0))]-=1,s=r.sum(n);for(;s<a;)n[r.maxIndex(t,((t,a)=>0!==t.length?t.length/e-n[a]:-1/0))]+=1,s=r.sum(n);return n}function c(t,e){const a=(0,n.useRef)({value:t,prev:null}),r=a.current.value;return(e?e(t,r):t===r)||(a.current={value:t,prev:r}),a.current.prev}const l=t=>r.interpolateBlues(r.scaleLinear([.2,1])(t))},8342:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{A:()=>f});var n=a(5760),s=a(5043),o=a(4987),i=a(8058),c=a(579),l=t([i]);i=(l.then?(await l)():l)[0];const u=20,h={top:10,right:10,bottom:20,left:10},p=[0,i.j.MAX_DELIVS],m={draw:function(t,e){t.moveTo(0,-e/2),t.lineTo(e/4,-e/4),t.arc(0,0,e/Math.SQRT2/2,-Math.PI/4,5*Math.PI/4),t.lineTo(0,-e/2),t.closePath()}};function f(t){let{data:e,goal:a,setGoal:r,width:i=600,height:l=400,shortForm:d=!1}=t;const{current:f}=(0,s.useRef)(Math.floor(1e9*Math.random())),{current:g}=(0,s.useRef)(Math.floor(1e9*Math.random())),y=(0,s.useRef)(),A=(0,s.useMemo)((()=>(0,o.u)(e,p,e.length/u,i,l)),[e]),x=[0,e.length],_=n.scaleLinear().domain(p).range([0,i]),v=n.scaleLinear().domain(x).range([l,0]),w=A.filter((t=>t[0]>a)).length;return(0,s.useEffect)((()=>{y.current.attr("width",i+h.left+h.right).attr("height",l+h.top+h.bottom).style("pointer-events","none").append("g").attr("class","graph-area").attr("transform","translate(".concat(h.left,",").concat(h.top,")")).append("g").attr("transform","translate(0, ".concat(l,")")).call(n.axisBottom().scale(n.scaleLinear().domain(p).range([0,i])).tickFormat(n.format(".2s"))).call((t=>{t.selectAll("line").attr("stroke","gray"),t.selectAll("path").attr("stroke","gray"),t.selectAll("text").attr("fill","gray")})).append("text").attr("fill","black").attr("transform","translate(".concat(i/2,", ",30,")")).text("Delivery (TAF)");const t=document.querySelector("#i".concat(f));t.style.transform="translateX(".concat(n.scaleLinear().domain(p).range([h.left,i+h.left]).clamp(!0)(a),"px)");const e=t=>t.preventDefault();let s=!1;document.querySelector("#i".concat(f)).addEventListener("mousedown",(()=>{s=!0,window.addEventListener("selectstart",e)})),document.addEventListener("mouseup",(()=>{s=!1,window.removeEventListener("selectstart",e)})),document.querySelector("#i".concat(g)).addEventListener("mousemove",(e=>{s&&e.target.id==="i".concat(g)&&(t.style.transform="translateX(".concat(Math.min(Math.max(e.offsetX,h.left),h.left+i),"px)\n            "),r(n.scaleLinear().domain([h.left,i+h.left]).range(p).clamp(!0)(e.offsetX)))}))}),[]),(0,s.useEffect)((()=>{const t=y.current.select(".graph-area").selectAll(".icons").data(A).join((t=>t.append("g").call((t=>t.append("path"))))).attr("class","icons").call((t=>{t.selectAll("path").attr("d",n.symbol(m,l/u))}));t.attr("transform",(t=>"translate(".concat(_(t[0]),",").concat(v(t[1]),")"))),t.attr("fill",(t=>t[0]>a?"steelblue":"black"));document.querySelector("#i".concat(f)).style.transform="translateX(".concat(n.scaleLinear().domain(p).range([h.left,i+h.left]).clamp(!0)(a),"px)")}),[a,A]),(0,c.jsxs)("div",{className:"dot-".concat(g," dot-histogram-wrapper"),id:"i".concat(g),children:[(0,c.jsx)("div",{className:"pdf-razor "+(d?"short-form":""),id:"i".concat(f),children:(0,c.jsxs)("div",{children:[(0,c.jsxs)("span",{children:[(0,c.jsxs)("u",{children:[A.length-w," / ",u]})," ",d?"":"yrs WILL NOT meet demand"]}),(0,c.jsxs)("span",{children:[(0,c.jsxs)("u",{children:[w," / ",u]})," ",d?"":"yrs WILL meet demand"]})]})}),(0,c.jsx)("svg",{ref:t=>{y.current=n.select(t)}})]})}r()}catch(d){r(d)}}))},8687:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{A:()=>l});var n=a(5760),s=(a(5043),a(9152)),o=a(579),i=t([s]);function l(t){let{settings:e,setColorSetting:a}=t;return(0,o.jsx)("div",{className:"scen-settings comp-settings",children:e.map(((t,e)=>(0,o.jsxs)("div",{className:"full-card",onMouseEnter:()=>a(e),onMouseLeave:()=>a(null),children:[(0,o.jsx)("span",{children:s.RZ[e]}),(0,o.jsx)("span",{children:s.j9[e][t]}),(0,o.jsx)("div",{className:"sett-dot-wrapper",children:n.range(s.j9[e].length).map((a=>(0,o.jsx)("span",{className:"sett-dot ".concat(a<=t?"filled":"not-filled"),style:{opacity:(a+1)/s.j9[e].length}},a)))})]},e)))})}s=(i.then?(await i)():i)[0],r()}catch(c){r(c)}}))},9083:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{A:()=>l});var n=a(5760),s=(a(5043),a(9152)),o=a(579),i=t([s]);function l(t){let{settings:e,setColorSetting:a}=t;return(0,o.jsxs)("div",{className:"scen-settings",children:[(0,o.jsx)("div",{className:"condense",children:e.map(((t,e)=>(0,o.jsxs)("div",{className:"sett-dot-wrapper",children:[(0,o.jsx)("span",{children:s.kr[e]}),n.range(t+1).map((t=>(0,o.jsx)("span",{className:"sett-dot",style:{opacity:(t+1)/s.j9[e].length}},t)))]},e)))}),(0,o.jsx)("div",{className:"full",children:(0,o.jsxs)("div",{className:"full-container",children:[(0,o.jsx)("span",{children:"The settings for this scenario are:"}),e.map(((t,e)=>(0,o.jsxs)("div",{className:"full-card",onMouseEnter:()=>a(e),onMouseLeave:()=>a(null),children:[(0,o.jsx)("span",{children:s.RZ[e]}),(0,o.jsx)("span",{children:s.j9[e][t]}),(0,o.jsx)("div",{className:"sett-dot-wrapper",children:n.range(s.j9[e].length).map((a=>(0,o.jsx)("span",{className:"sett-dot ".concat(a<=t?"filled":"not-filled"),style:{opacity:(a+1)/s.j9[e].length}},a)))})]},e)))]})})]})}s=(i.then?(await i)():i)[0],r()}catch(c){r(c)}}))},8611:(t,e,a)=>{a.d(e,{A:()=>u});var r=a(5760),n=a(5043),s=a(1684),o=a(972),i=a(579);const c=40,l=10,d=3;function u(t){let{levelInterp:e,colorInterp:a=s.YW,width:u=200,height:h=400,resolution:p=l}=t;const m=(0,n.useId)(),f=(0,n.useRef)(),g=(0,n.useMemo)((()=>(0,s.kd)(0,1,p+1).map((t=>e(t)))),[e,p]),y=(0,s.ZC)(g),A=u-2*d,x=h-d;return(0,n.useLayoutEffect)((()=>{const t=f.current.append("g").attr("class","svg-container").attr("transform","translate(".concat(d,", ").concat(d/2,")"));t.append("defs").append("clipPath").attr("id","bucket-mask-"+m).append("path").attr("class","bucket-mask-path"),t.append("g").attr("class","graph-area").attr("clip-path","url(#bucket-mask-".concat(m,")")),t.append("g").append("path").attr("class","bucket-outline").attr("stroke","lightgray").attr("stroke-linecap","round").attr("stroke-width",d).attr("fill","none")}),[m]),(0,n.useLayoutEffect)((()=>{const t=f.current.attr("width",u).attr("height",h).select(".svg-container"),e=function(t,e){let[a,n]=e;const s=(0,o.bp)(0,1,t,20);return r.line().x((function(t){return t[0]+a})).y((function(t){return t[1]+n}))(s)+"z"}(x*(2*o.Yd)/o.IC,[u/2,h*o.Yd/o.IC]);t.select(".bucket-mask-path").attr("d",e),t.select(".bucket-outline").attr("d",e)}),[u,h,A,x]),(0,n.useLayoutEffect)((()=>{const t=f.current.select(".graph-area").selectAll(".bucketBox").data(g).join("rect").attr("class","bucketBox").attr("width",2*A).attr("height",2*x).attr("x",-A/2).attr("fill",((t,e)=>a(e/p)));t.transition("liquidLevel").ease(r.easeElasticOut.period(.6)).delay(((t,e)=>e*(100/p))).duration(1e3).attr("y",(t=>x-t*x)),t.transition("liquidSway").duration(2e3).delay(((t,e)=>10*e)).ease(r.easeQuad).attrTween("transform",(function(t,e){const a=y?Math.abs(y[e]-t):0;return t=>"rotate(".concat(Math.sin(Math.min(4*Math.PI*t/(.5*a+.5),4*Math.PI))*a*c*(1-t),", ").concat(A/2,", ",0,")")}))}),[g,y,u,h,A,x,p,a]),(0,i.jsx)("div",{className:"waterdrop-wrapper",children:(0,i.jsx)("svg",{ref:t=>{f.current=r.select(t)}})})}},3693:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{G:()=>i});var n=a(4956);async function o(){const t=await(await fetch("./descriptions.json")).json();return console.log("DATA: loading descriptions data"),(0,n.Et)(t,(t=>{let{id:e}=t;return e}))}const i=await o();r()}catch(s){r(s)}}),1)},8058:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{j:()=>h});var n=a(5760),s=a(9152),o=a(9550),i=a(4956),c=t([s]);s=(c.then?(await c)():c)[0];const d=1;async function u(){const t="scens",e="delivs",a=await async function(){const a=await(await fetch("./objectives.json")).json();for(const r of a){for(const a of(0,o.k4)(r[t])){const t=a[e].map((t=>(0,o.qE)(t,0,1200)));a[e]=t.sort(((t,e)=>e-t))}r[t]=(0,i.Et)(r[t],(t=>{let{name:e}=t;return e}))}return console.log("DATA: loading objectives data"),(0,i.Et)(a,(t=>{let{obj:e}=t;return e}))}(),r=Object.keys(a),c=function(){const t={};for(let e=0;e<r.length;e++)t[r[e]]=200;return t}(),l=Object.keys(Object.values(a)[0][t]).filter(((t,e)=>e%d===0||"expl0000"===t)),u=function(){const t={},e=Object.values(s.hU);for(let a=0;a<l.length;a++){const r=l[a];t[r]=(0,s.iu)(r.slice(4)).map(((t,a)=>(t+1)/e[a]))}return t}(),[h,p]=function(){const s=[],o={objective:{},scenario:{}},i=[];let c=0;for(const u of r)for(const r of l){o.objective[u]||(o.objective[u]=[]),o.scenario[r]||(o.scenario[r]=[]),o.objective[u].push(c),o.scenario[r].push(c);const l=a[u][t][r][e];s.push({id:c,objective:u,scenario:r,deliveries:l}),i.push(n.mean(l)),c++}const d={};for(const t of Object.keys(o)){const e=[];for(const r of Object.keys(o[t])){const a=o[t][r],c=a.sort(((t,e)=>i[e]-i[t]));e.push({key:r,sorted:c,mean:n.mean(a.map((t=>s[t].deliveries)).flat())})}const a=e.sort(((t,e)=>e.mean-t.mean));d[t]={};for(let r=0;r<a.length;r++){const{key:e,sorted:n}=a[r],s={};for(let t=0;t<n.length;t++)s[n[t]]=t;d[t][e]=s,d[t][e].rank=r}}return[s,d]}();return{MAX_DELIVS:1200,SCENARIO_KEY_STRING:t,DELIV_KEY_STRING:e,OBJECTIVES_DATA:a,OBJECTIVE_IDS:r,OBJECTIVE_GOALS_MAP:c,SCENARIO_IDS:l,KEY_SETTINGS_MAP:u,FLATTENED_DATA:h,DATA_GROUPINGS:p}}const h=await u();r()}catch(l){r(l)}}),1)},4082:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{l:()=>i});var n=a(4956);async function o(){const t=await async function(){const t=await(await fetch("./callite_spatial.json")).json();return console.log("DATA: loading callite spatial data"),t}(),e=(0,n.Et)(t.features,(t=>{let{properties:e}=t;return e.CalLiteID})),a=await async function(){const t=await(await fetch("./california.json")).json();return console.log("DATA: loading california spatial data"),t}();return{SPATIAL_DATA:t,SPATIAL_FEATURES:e,CALIFORNIA_OUTLINE:a,CALIFORNIA_CENTER:[-119,37.7749]}}const i=await o();r()}catch(s){r(s)}}),1)},9336:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{A:()=>p});var n=a(5760),s=a(5043),o=a(8058),i=a(3956),c=a(6924),l=t([o,c]);[o,c]=l.then?(await l)():l;const u=window.innerWidth,h=window.innerHeight;function p(){const[t,e]=(0,s.useState)({}),[a,r]=(0,s.useState)([]),[l,d]=(0,s.useState)(null),[p,m]=(0,s.useState)(o.j.OBJECTIVE_GOALS_MAP),f=(0,s.useRef)([]),g=(0,s.useRef)(!1);(0,s.useEffect)((function(){i.e.renderer.setSize(u,h),console.time("drops mesh creating"),i.e.dropsMesh.createMesh(c.W),console.timeEnd("drops mesh creating"),document.querySelector("#mosaic-webgl").appendChild(i.e.renderer.domElement),n.select("#mosaic-svg").attr("width",u).attr("height",h);const t=n.scaleLinear().domain([h/c.W.height,h/c.W.groups[0].height]).range([.1,1]).clamp(!0);i.e.camera.create({width:u,height:h,webglElement:n.select(".bubbles-wrapper").node(),svgElement:n.select("#mosaic-svg").select(".svg-trans").node(),zoomFn:e=>{g.current||i.e.dropsMesh.updateOutlineVisibility(t(e.k));for(const t of f.current)t(e)}}),i.e.renderer.setAnimationLoop((()=>{i.e.renderer.render(i.e.scene,i.e.camera.camera)})),e({state:"TutorialView"})}),[]);const y=(0,s.useCallback)((t=>n.scaleLinear().domain([h/c.W.height,h/c.W.groups[0].height]).range([.1,1]).clamp(!0)(t)),[]),A=(0,s.useCallback)((function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;const a=1.2*c.W.height,r=[0,.08*-c.W.height,i.e.camera.getZFromFarHeight(a)];let n=0;if(t){const[t,a]=x(r,e);n=a,t()}else i.e.camera.callZoomFromWorldViewport({worldX:r[0],worldY:-r[1],farHeight:a}),e&&e();return n}),[]),x=(0,s.useCallback)((function(t,e){const a=i.e.camera.interpolateZoomCamera(t),r=a.duration/2;return[()=>{const t=n.timer((n=>{const s=Math.min(n/r,1);i.e.camera.callZoom(a(s)),1===s&&(t.stop(),e&&e())}))},r]}),[]),_=(0,s.useCallback)((function(t){f.current.push(t)}),[]),v=(0,s.useCallback)((function(t){g.current=t}));return{appWidth:u,appHeight:h,state:t,setState:e,activeWaterdrops:a,setActiveWaterdrops:r,setDisableCamAdjustments:v,waterdrops:c.W,goBack:l,setGoBack:d,zoomTo:x,resetCamera:A,getOutlineOpacity:y,addZoomHandler:_,goals:p,setGoals:m,...i.e}}r()}catch(d){r(d)}}))},9514:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{C:()=>p});var n=a(5760),s=a(5043),o=a(2385),i=a(972),c=a(9550),l=a(7073),d=a(9701),u=t([l,d]);function p(){const[t,e]=(0,s.useState)(),a=(0,s.useRef)(),r=(0,s.useRef)({});return(0,s.useEffect)((function(){if(t){const[e,r]=d._.calcLinesAndPositions(a.current,t);!function(e){const[r,s]=e,i=a.current.groups[0].height*o.W.SPREAD_1_2/15,c=a.current.groups[0].height*o.W.SPREAD_1_2/10;n.select("#comparer-graphics").select("#member-label").text("scenario").attr("font-size",i).transition().duration(100).attr("x",r).attr("y",s-1.5*i),n.select("#comparer-graphics").select("#member-variable").attr("font-size",c).text(t.slice(4)).transition().duration(100).attr("x",r).attr("y",s)}((0,c.p6)(e)),function(t,e){n.select("#comparer-graphics .indicator-group").selectAll(".circlet").data(t).join("circle").attr("class","circlet").call(i.JB).attr("r",1.5*o.W.LOD_1_RAD_PX).transition().duration(100).attr("cx",(t=>t[0])).attr("cy",(t=>t[1])),n.select("#comparer-graphics .indicator-group").selectAll(".comp-line").data(e).join("path").attr("class","comp-line").transition().duration(100).attr("d",(t=>n.line()(t)))}(e,r)}}),[t]),{initComparer:function(t,s){a.current=d._.getWaterdropGroups([l.A.PAG_OBJECTIVE,l.A.PRF_OBJECTIVE],t,[0,0]);const c=2*t.groups[0].height*o.W.SPREAD_1_2*.75,u=s.height/c;let h=s.width/2,p=s.height/2;const m={x:h,y:p,k:u};h=-a.current.groupPositions[0][0]*u+s.width/2,p=a.current.groupPositions[0][1]*u+s.height/2;const f={x:h,y:p,k:u};r.current.firstDrop=f,r.current.midpoint=m;const g=n.select("#comparer-graphics").attr("width",window.innerWidth).attr("height",window.innerHeight).append("g").attr("class","svg-group").attr("transform",n.zoomIdentity.translate(f.x,f.y).scale(f.k)),y=g.append("g").attr("class","indicator-group");y.append("text").attr("id","member-variable"),y.append("text").attr("id","member-label"),(0,l.C)(g,a.current,{onHover:t=>{e(t.key)}}),e(l.A.DEFAULT_SCENARIO),(0,i.f2)(".large-drop.".concat(l.A.PRF_OBJECTIVE,", .indicator-group"),g)},introDrop2:function(){const t=n.select("#comparer-graphics");t.select(".svg-group").transition().attr("transform",n.zoomIdentity.translate(r.current.midpoint.x,r.current.midpoint.y).scale(r.current.midpoint.k)),(0,i.YB)(".large-drop.".concat(l.A.PRF_OBJECTIVE,", .indicator-group"),t)},exitDrop2:function(){const t=n.select("#comparer-graphics");t.select(".svg-group").transition().attr("transform",n.zoomIdentity.translate(r.current.firstDrop.x,r.current.firstDrop.y).scale(r.current.firstDrop.k)),(0,i.f2)(".large-drop.".concat(l.A.PRF_OBJECTIVE,", .indicator-group"),t)}}}[l,d]=u.then?(await u)():u,r()}catch(h){r(h)}}))},4757:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{R:()=>u});var n=a(5043),s=a(9514),o=a(419),i=a(5413),c=a(7066),l=t([s,o,i]);function u(t){const[e,a]=(0,n.useState)([]),r=(0,o.d)(),c=(0,s.C)();return{hookAnimations:(0,n.useCallback)((function(){c.initComparer(t.waterdrops,t.camera);const e={deps:{...r,largeDropComparer:c}},n=i.W.initShowLocationAnimGroup(e),s=i.W.initChartAnimGroup(e),o=i.W.initBucketsFillAnim(e),l=i.W.initDropFillAnim(e),d=i.W.initChangeRealityAnim(e),u=i.W.initFillVarDropsAnim(e),h=i.W.initShowScenLabelAnim(e),p=i.W.initHighlightBestAnim(e),m=i.W.initShowQuantilesAnim(e),f=i.W.initComparerAnimGroup(e),g=[{name:"howMuchIntro"},{name:"norCal",animHandler:n.showPAG},{name:"soCal",animHandler:n.showPRF},{name:"barsAppear",animHandler:s.barsAppear},{name:"barsExplain"},{name:"barsCondense",animHandler:s.barsCondense},{name:"bucketsFill",animHandler:o},{name:"comparingTheTwo"},{name:"butTheAgGroup"},{name:"overallIfWantReliable"},{name:"forNowLetsFocus",animHandler:l},{name:"darkerColsIndic"},{name:"ifChangeReality",animHandler:d},{name:"fortunateCanExplore",animHandler:u},{name:"theseVarsCalled",animHandler:h},{name:"atAGlance",animHandler:p},{name:"tryMoveRed",animHandler:m},{name:"collectAllScen",animHandler:f.showPAG},{name:"soWhyNot"},{name:"letsBringRefuge",animHandler:f.showPRF}];a(g)}),[t.waterdrops,t.camera]),getSlidesInRange:(0,n.useCallback)((function(t,a){let r,n;for(let s=0;s<e.length;s++)if(e[s].name===t)r=s;else if(e[s].name===a){n=s;break}return h(e.slice(r,n+1))}),[e]),storyVars:r}}function h(t){return t.map((t=>({...t,script:c.P[t.name]})))}[s,o,i]=l.then?(await l)():l,r()}catch(d){r(d)}}))},419:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{d:()=>l});var n=a(5760),s=a(5043),o=a(7073),i=t([o]);function l(){const[t,e]=(0,s.useState)(200),[a,r]=(0,s.useState)((()=>n.scaleLinear().range([0,0]))),[i,c]=(0,s.useState)((()=>n.scaleLinear().range([0,0]))),[l,d]=(0,s.useState)((()=>n.scaleLinear().range([0,0]))),[u,h]=(0,s.useState)((()=>o.A.VARIATIONS.map((()=>n.scaleLinear().range([0,0])))));return{userGoal:t,setUserGoal:e,bucketInterperPAG:a,setBucketInterperPAG:r,bucketInterperPRF:i,setBucketInterperPRF:c,dropInterper:l,setDropInterper:d,variationInterpers:u,setVariationInterpers:h}}o=(i.then?(await i)():i)[0],r()}catch(c){r(c)}}))},7368:(t,e,a)=>{a.d(e,{J:()=>o});var r=a(5043),n=a(972),s=a(4956);function o(t){const[e,a,o]=(0,s.iJ)([]),i=(0,r.useRef)({});(0,r.useEffect)((function(){window.addEventListener("mousemove",(t=>{void 0!==i.current.startX&&(i.current.deltaX=t.x-i.current.startX,i.current.deltaY=t.y-i.current.startY,a((t=>{if(void 0===i.current.startX)return t;const e=t.find((t=>t.id===i.current.id));return e.offsetX=e.oldOffsetX+i.current.deltaX,e.offsetY=e.oldOffsetY+i.current.deltaY,[...t]})))})),window.addEventListener("mouseup",(t=>{void 0!==i.current.startX&&(i.current={})}))}),[]);const c=(0,r.useCallback)((function(t,e){let{id:r}=e;""!==t.target.className&&(t.preventDefault(),i.current={startX:t.clientX,startY:t.clientY,id:r},a((t=>{const e=t.find((t=>t.id===r));return e.oldOffsetX=e.offsetX,e.oldOffsetY=e.offsetY,[...t]})))}),[]);return{panels:e,panelsRef:o,setPanels:a,onPanelDragStart:c,getPanelStyle:function(e){let{x:a,y:r,offsetX:s,offsetY:o}=e;const[i,c]=(0,n.UK)(a,r,t);return{left:"".concat(i+s,"px"),top:"".concat(c+o,"px")}}}}},2385:(t,e,a)=>{a.d(e,{W:()=>r});const r={LOD_1_LEVELS:5,LOD_1_RAD_PX:1,LOD_1_MIN_LEV_VAL:.1,LOD_1_SMALL_DROP_PAD_FACTOR:1.3,LOD_1_LARGE_DROP_PAD_FACTOR:1.2,LOD_2_SMALL_DROP_PAD_FACTOR:3,GROUP_HOVER_AREA_FACTOR:1.1/(1+Math.SQRT1_2),SPREAD_1_2:3/1.3}},3956:(t,e,a)=>{a.d(e,{e:()=>x});var r=a(9408),n=a(4473),s=a(8341),o=a(5760),i=a(1684),c=a(2385),l=a(4956),d=a(9550),u=a(972);class h{constructor(){this.added=!1}createMesh(t){this.dropsMesh?this.updateMeshes(t):this.initializeMeshes(t)}draw(t){this.added||(t.add(this.dropsMesh),t.add(this.outlineMesh),this.added=!0)}remove(t){this.added&&(t.remove(this.dropsMesh),t.remove(this.outlineMesh),this.added=!1)}initializeMeshes(t){const e=new A(h.MAX_POINTS_DROPS),a=[],n=(0,u.bp)(0,1,2*c.W.LOD_1_RAD_PX*.975);for(let s=0;s<t.nodes.length;s++){const{id:o,globalX:h,globalY:p,levs:m,maxLev:f,globalTilt:g}=t.nodes[s];for(let t=m.length-1;t>=0;t--){const a=t!==m.length-1?m[t+1]:0,n=m[t],o=(0,u.Ng)(a/f,n/f,2*c.W.LOD_1_RAD_PX),l=new r.Q1f((0,i.YW)(t/c.W.LOD_1_LEVELS));e.addMeshCoords(o,{x:h,y:-p,rotate:g},l,s%5/50+.02)}const y=(0,d.Hb)((0,l.K7)(n),g);a.push(...y.map((t=>{let[e,a]=t;return new r.Pq0(h+e,-p-a,s%5/50+.01)})))}e.finish(),this.dropsMesh=new r.eaF(e.threeGeom,new r.V9B({vertexColors:!0,transparent:!0,opacity:1})),this.outlineMesh=new r.DXC((new r.LoY).setFromPoints(a),new r.mrM({color:13421772,transparent:!0,opacity:0}))}updateOutlineVisibility(t){this.outlineMesh&&(this.outlineMesh.material.opacity=t,this.outlineMesh.material.needsUpdate=!0)}updateVisibility(t){this.outlineMesh&&this.dropsMesh&&(this.outlineMesh.material.opacity=t,this.outlineMesh.material.needsUpdate=!0,this.dropsMesh.material.opacity=t,this.dropsMesh.material.needsUpdate=!0)}updateMeshes(t){}}h.MAX_POINTS_DROPS=78e5,h.MAX_POINTS_OUTLINE=52e5;var p=(0,s.A)("finishCreate"),m=(0,s.A)("THREEHandleZoom");class f{constructor(t){let{fov:e,near:a,far:n}=t;Object.defineProperty(this,m,{value:y}),Object.defineProperty(this,p,{value:g}),this.raycaster=new r.tBo,this.fov=e,this.near=a,this.far=n}create(t){let{width:e,height:a,webglElement:r,svgElement:s,zoomFn:i}=t;this.width=e,this.height=a,this.webglView=o.select(r),this.svgView=o.select(s),this.zoom=o.zoom().on("zoom",(t=>{this.curTransform=t.transform,(0,n.A)(this,m)[m](t.transform),this.svgView.attr("transform",t.transform),i&&i(t.transform)})),(0,n.A)(this,p)[p]()}callZoom(t){this.zoom.transform(this.webglView,o.zoomIdentity.translate(t.x,t.y).scale(t.k))}callZoomFromWorldViewport(t){let{worldX:e,worldY:a,farHeight:r}=t;const n=this.height/r,s=-e*n+this.width/2,o=a*n+this.height/2;this.callZoom({x:s,y:o,k:n})}interpolateZoomCamera(t){let[e,a,r]=t;const n=o.interpolateZoom([this.camera.position.x,this.camera.position.y,this.height/this.curTransform.k],[e,-a,this.getFarHeightFromZ(r)]),s=t=>{const[e,a,r]=n(t),s=this.height/r;return{x:-e*s+this.width/2,y:a*s+this.height/2,k:s}};return s.duration=n.duration,s}getZFromFarHeight(t){return Math.tan((0,d.eh)(90-this.fov/2))*t/2}getFarHeightFromZ(t){return Math.tan((0,d.eh)(this.fov)/2)*t*2}getScaleFromZ(t){const e=this.getFarHeightFromZ(t);return this.height/e}getZFromScale(t){const e=this.height/t;return this.getZFromFarHeight(e)}intersectObject(t,e,a){return this.raycaster.setFromCamera({x:t,y:e},this.camera),this.raycaster.intersectObject(a)}worldToScreen(t,e){return(0,u.UK)(t,e,this.curTransform)}screenToWorld(t,e){return(0,u.UT)(t,e,this.curTransform)}}function g(){this.zoom=this.zoom.scaleExtent([this.getScaleFromZ(this.far),this.getScaleFromZ(this.near)]),this.camera=new r.ubm(this.fov,this.width/this.height,this.near,this.far+1),this.camera.position.set(0,0,this.far),this.webglView.call(this.zoom),this.zoom.transform(this.webglView,o.zoomIdentity.translate(this.width/2,this.height/2).scale(this.getScaleFromZ(this.far)))}function y(t){const e=t.k,a=-(t.x-this.width/2)/e,r=(t.y-this.height/2)/e,n=this.getZFromScale(e);this.camera.position.set(a,r,n)}class A{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.threeGeom=new r.LoY,this.triangleIdx=0,this.threeGeom.setAttribute("position",new r.THS(new Float32Array(3*t),3)),e&&this.threeGeom.setAttribute("color",new r.THS(new Float32Array(3*t),3)),this.positionAttribute=this.threeGeom.getAttribute("position"),this.colorAttribute=this.threeGeom.getAttribute("color")}addMeshCoords(t,e,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(let n=0;n<t.length;n++){const[s,o,i]=(0,d.Hb)((0,l.K7)(t[n]),e.rotate);this.positionAttribute.setXYZ(3*this.triangleIdx+0,e.x+s[0],e.y-s[1],r),this.positionAttribute.setXYZ(3*this.triangleIdx+1,e.x+o[0],e.y-o[1],r),this.positionAttribute.setXYZ(3*this.triangleIdx+2,e.x+i[0],e.y-i[1],r),a&&(this.colorAttribute.setXYZ(3*this.triangleIdx+0,a.r,a.g,a.b),this.colorAttribute.setXYZ(3*this.triangleIdx+1,a.r,a.g,a.b),this.colorAttribute.setXYZ(3*this.triangleIdx+2,a.r,a.g,a.b)),this.triangleIdx++}}finish(){this.threeGeom.setDrawRange(0,3*this.triangleIdx)}}const x=function(){const t=function(){const t=new r.Z58;return t.background=new r.Q1f(15724527),t}(),e=new h;return{scene:t,camera:new f({fov:45,near:1,far:3e3}),renderer:new r.JeP({antialias:!0}),dropsMesh:e}}()},5413:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{W:()=>d});var n=a(5760),s=a(7073),o=a(8058),i=a(4632),c=a(972),l=t([s,o]);[s,o]=l.then?(await l)():l;const d={initShowLocationAnimGroup:function(){return{showPAG:{do:function(){n.select("#tut-minimap").select(".outline."+s.A.PAG_OBJECTIVE).style("scale",10).transition().style("scale",1).attr("fill","gray")},undo:function(){n.select("#tut-minimap").select(".outline."+s.A.PAG_OBJECTIVE).style("scale",1).transition().attr("fill","transparent")}},showPRF:{do:function(){n.select("#tut-minimap").select(".outline."+s.A.PAG_OBJECTIVE).style("scale",1).transition().attr("fill","transparent"),n.select("#tut-minimap").select(".outline."+s.A.PRF_OBJECTIVE).style("scale",10).transition().style("scale",1).attr("fill","gray")},undo:function(){n.select("#tut-minimap").select(".outline."+s.A.PAG_OBJECTIVE).style("scale",10).transition().style("scale",1).attr("fill","gray"),n.select("#tut-minimap").select(".outline."+s.A.PRF_OBJECTIVE).transition().attr("fill","transparent")}}}},initChartAnimGroup:function(){let t,e,a,r,c,l;const d=40,u=30,h=40,p=60;return function(){{const e=n.select("#pag-bar-graph").attr("width",s.A.BAR_CHART_WIDTH+p+u).attr("height",s.A.BAR_CHART_HEIGHT+d+h).attr("opacity",1).append("g").attr("class","svg-group").attr("transform","translate(".concat(p,",").concat(d,")")),r=i[s.A.PAG_OBJECTIVE].map(((t,e)=>({val:t,placeFromLeft:e,year:e+1}))).sort(((t,e)=>e.val-t.val)),l=n.scaleBand().domain(r.map((t=>{let{year:e}=t;return e})).sort(((t,e)=>t-e))).range([0,s.A.BAR_CHART_WIDTH]).padding(.4),m=n.scaleLinear().domain([0,o.j.MAX_DELIVS]).range([s.A.BAR_CHART_HEIGHT,0]),f=n.axisBottom(l).tickSize(0).tickFormat((t=>"year ".concat(t))).tickValues(l.domain().filter(((t,e)=>0===e||(e+1)%10===0)));e.append("g").attr("class","anim-xaxis"),e.append("g").attr("class","axis-y"),e.select(".anim-xaxis").attr("opacity",1).attr("transform","translate(0, ".concat(s.A.BAR_CHART_HEIGHT,")")).call(f).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end"),e.select(".axis-y").call(n.axisLeft(m)),t=l,a=f,c=r}{const t=n.select("#prf-bar-graph").attr("width",s.A.BAR_CHART_WIDTH+p+u).attr("height",s.A.BAR_CHART_HEIGHT+d+h).attr("opacity",1).append("g").attr("class","svg-group").attr("transform","translate(".concat(p,",").concat(d,")")),a=i[s.A.PRF_OBJECTIVE].map(((t,e)=>({val:t,placeFromLeft:e,year:e+1}))).sort(((t,e)=>e.val-t.val)),c=n.scaleBand().domain(a.map((t=>{let{year:e}=t;return e})).sort(((t,e)=>t-e))).range([0,s.A.BAR_CHART_WIDTH]).padding(.4),m=n.scaleLinear().domain([0,o.j.MAX_DELIVS]).range([s.A.BAR_CHART_HEIGHT,0]),f=n.axisBottom(c).tickSize(0).tickFormat((t=>"year ".concat(t))).tickValues(c.domain().filter(((t,e)=>0===e||(e+1)%10===0)));t.append("g").attr("class","anim-xaxis"),t.append("g").attr("class","axis-y"),t.select(".anim-xaxis").attr("opacity",1).attr("transform","translate(0, ".concat(s.A.BAR_CHART_HEIGHT,")")).call(f).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end"),t.select(".axis-y").call(n.axisLeft(m)),e=c,r=f,l=a}}(),{barsAppear:{do:function(){{const e=n.scaleLinear().domain([0,o.j.MAX_DELIVS]).range([s.A.BAR_CHART_HEIGHT,0]);n.select("#pag-bar-graph .svg-group").selectAll(".bars").data(c,(t=>t.placeFromLeft)).join("rect").attr("class","bars").attr("x",(e=>t(e.year))).attr("y",s.A.BAR_CHART_HEIGHT).attr("width",t.bandwidth()).attr("height",0).attr("opacity",1).attr("fill","steelblue").transition().duration(500).delay((t=>10*t.placeFromLeft)).attr("y",(t=>e(t.val))).attr("height",(t=>s.A.BAR_CHART_HEIGHT-e(t.val)))}{const t=n.scaleLinear().domain([0,o.j.MAX_DELIVS]).range([s.A.BAR_CHART_HEIGHT,0]);n.select("#prf-bar-graph .svg-group").selectAll(".bars").data(l,(t=>t.placeFromLeft)).join("rect").attr("class","bars").attr("x",(t=>e(t.year))).attr("y",s.A.BAR_CHART_HEIGHT).attr("width",e.bandwidth()).attr("height",0).attr("opacity",1).attr("fill","steelblue").transition().duration(500).delay((t=>10*t.placeFromLeft)).attr("y",(e=>t(e.val))).attr("height",(e=>s.A.BAR_CHART_HEIGHT-t(e.val)))}},undo:function(){n.select("#pag-bar-graph .svg-group").selectAll(".bars").data(c,(t=>t.placeFromLeft)).transition().duration(500).delay((t=>10*(c.length-t.placeFromLeft-1))).attr("y",s.A.BAR_CHART_HEIGHT).attr("height",0),n.select("#prf-bar-graph .svg-group").selectAll(".bars").data(l,(t=>t.placeFromLeft)).transition().duration(500).delay((t=>10*(l.length-t.placeFromLeft-1))).attr("y",s.A.BAR_CHART_HEIGHT).attr("height",0)}},barsCondense:{do:async function(){{const t=s.A.BAR_CHART_WIDTH/8,e=n.select("#pag-bar-graph .svg-group");e.select(".anim-xaxis").call(a.tickFormat(""));const r=e.selectAll(".bars");r.style("mix-blend-mode","multiply").transition().duration(500).attr("opacity",.05).transition().delay((t=>100+1e3*(1-(1-t.placeFromLeft/c.length)**4))).duration(500).attr("width",t).attr("x",s.A.BAR_CHART_WIDTH/2-t/2).end().catch((()=>{})).then((()=>{e.select(".anim-xaxis").transition().transition(500).attr("transform","translate(0, ".concat(s.A.BAR_CHART_HEIGHT+50,")")).attr("opacity",0),r.transition().delay(500).attr("x",0),e.transition().delay(500).attr("transform","translate(".concat(p+s.A.BAR_CHART_WIDTH/2-t/2,",").concat(d,")"))}))}{const t=s.A.BAR_CHART_WIDTH/8,e=n.select("#prf-bar-graph .svg-group");e.select(".anim-xaxis").call(r.tickFormat(""));const a=e.selectAll(".bars");a.style("mix-blend-mode","multiply").transition().duration(500).attr("opacity",.05).transition().delay((t=>100+1e3*(1-(1-t.placeFromLeft/l.length)**4))).duration(500).attr("width",t).attr("x",s.A.BAR_CHART_WIDTH/2-t/2).end().catch((()=>{})).then((()=>{e.select(".anim-xaxis").transition().transition(500).attr("transform","translate(0, ".concat(s.A.BAR_CHART_HEIGHT+50,")")).attr("opacity",0),a.transition().delay(500).attr("x",0),e.transition().delay(500).attr("transform","translate(".concat(p+s.A.BAR_CHART_WIDTH/2-t/2,",").concat(d,")"))}))}},undo:function(){{const r=n.select("#pag-bar-graph .svg-group"),o=r.selectAll(".bars");r.select(".anim-xaxis").transition().transition(500).attr("transform","translate(0, ".concat(s.A.BAR_CHART_HEIGHT,")")).attr("opacity",1),r.select(".anim-xaxis").call(a.tickFormat((t=>"year ".concat(t)))),r.transition().delay(500).attr("transform","translate(".concat(p,",").concat(d,")")),o.transition().delay((t=>100+1e3*(1-(t.placeFromLeft/c.length)**4))).duration(500).attr("x",(t=>e(t.year))).attr("width",t.bandwidth()).transition().duration(500).attr("opacity",1).end().catch((()=>{})).then((()=>{o.style("mix-blend-mode","normal")}))}{const t=n.select("#prf-bar-graph .svg-group"),a=t.selectAll(".bars");t.select(".anim-xaxis").transition().transition(500).attr("transform","translate(0, ".concat(s.A.BAR_CHART_HEIGHT,")")).attr("opacity",1),t.select(".anim-xaxis").call(r.tickFormat((t=>"year ".concat(t)))),t.transition().delay(500).attr("transform","translate(".concat(p,",").concat(d,")")),a.transition().delay((t=>100+1e3*(1-(t.placeFromLeft/l.length)**4))).duration(500).attr("x",(t=>e(t.year))).attr("width",e.bandwidth()).transition().duration(500).attr("opacity",1).end().catch((()=>{})).then((()=>{a.style("mix-blend-mode","normal")}))}}}}},initBucketsFillAnim:function(t){let{deps:e}=t;return{do:function(){n.selectAll(".tut-graph-wrapper .bucket-wrapper").style("display","initial"),n.select("#pag-bar-graph").attr("opacity",0),n.select("#prf-bar-graph").attr("opacity",0),e.setBucketInterperPAG((()=>s.A.PAG_INTERPER)),e.setBucketInterperPRF((()=>s.A.PRF_INTERPER))},undo:function(){e.setBucketInterperPAG((()=>n.scaleLinear().range([0,0]))),e.setBucketInterperPRF((()=>n.scaleLinear().range([0,0]))),n.selectAll(".tut-graph-wrapper .bucket-wrapper").style("display","none"),n.select("#pag-bar-graph").transition().attr("opacity",1),n.select("#prf-bar-graph").transition().attr("opacity",1)}}},initDropFillAnim:function(t){let{deps:e}=t;return{do:function(){e.setDropInterper((()=>s.A.PAG_INTERPER_DROP))},undo:function(){e.setDropInterper((()=>n.scaleLinear().range([0,0])))}}},initChangeRealityAnim:function(){return{do:function(){n.selectAll(".vardrop").style("display","initial").classed("hasarrow",!0),(0,c.f2)(".main-waterdrop .objective-label")},undo:function(){n.selectAll(".vardrop").style("display","none").classed("hasarrow",!1),(0,c.YB)(".main-waterdrop .objective-label")}}},initFillVarDropsAnim:function(t){let{deps:e}=t;return{do:function(){n.selectAll(".vardrop path").style("stroke-dasharray","none"),e.setVariationInterpers(s.A.VARIATIONS_INTERPERS)},undo:function(){n.selectAll(".vardrop path").style("stroke-dasharray","10 10"),e.setVariationInterpers(s.A.VARIATIONS.map((()=>n.scaleLinear().range([0,0]))))}}},initShowScenLabelAnim:function(){return{do:function(){n.selectAll(".var-scen-label").style("display","block")},undo:function(){n.selectAll(".var-scen-label").style("display","none")}}},initHighlightBestAnim:function(){return{do:function(){n.select(".drop1").classed("highlighted",!0)},undo:function(){n.select(".drop1").classed("highlighted",!1)}}},initShowQuantilesAnim:function(){return{do:function(){n.select(".drop1").classed("highlighted",!1),n.selectAll(".vardrop").classed("hasarrow",!1),n.selectAll(".var-scen-label").style("opacity","0.5"),n.selectAll(".var-scen-label, .scen-number").style("color","gray"),n.select(".main-waterdrop").transition().style("transform","translateY(-100px) scale(0.5)"),n.select(".main-waterdrop .var-scen-label").transition().style("transform","scale(2)"),n.selectAll(".drop1 .waterdrop-wrapper, .drop3 .waterdrop-wrapper").transition().style("transform","translate(-50px, 15px) scale(0.5)"),n.selectAll(".drop2 .waterdrop-wrapper, .drop4 .waterdrop-wrapper").transition().style("transform","translate(50px, 15px) scale(0.5)"),n.select(".main-histogram").style("display","initial"),n.selectAll(".vardrop .dot-histogram-wrapper").style("display","initial")},undo:function(){n.select(".drop1").classed("highlighted",!0),n.selectAll(".vardrop").classed("hasarrow",!0),n.selectAll(".var-scen-label").style("opacity","1"),n.selectAll(".var-scen-label").style("color","black"),n.selectAll(".scen-number").style("color","orange"),n.select(".main-waterdrop").transition().style("transform","none"),n.select(".main-waterdrop .var-scen-label").transition().style("transform","scale(1)"),n.selectAll(".drop1 .waterdrop-wrapper, .drop3 .waterdrop-wrapper").transition().style("transform","none"),n.selectAll(".drop2 .waterdrop-wrapper, .drop4 .waterdrop-wrapper").transition().style("transform","none"),n.select(".main-histogram").style("display","none"),n.selectAll(".vardrop .dot-histogram-wrapper").style("display","none")}}},initComparerAnimGroup:function(t){let{deps:e}=t;return{showPAG:{do:function(){(0,c.f2)(".scrollama-compare-scenobjs .tut-drop-graphics-wrapper"),(0,c.YB)(".scrollama-compare-scenobjs .tut-comparer-graphics-wrapper")},undo:function(){(0,c.YB)(".scrollama-compare-scenobjs .tut-drop-graphics-wrapper",n,"grid"),(0,c.f2)(".scrollama-compare-scenobjs .tut-comparer-graphics-wrapper")}},showPRF:{do:function(){e.largeDropComparer.introDrop2()},undo:function(){e.largeDropComparer.exitDrop2()}}}}};r()}catch(d){r(d)}}))},9152:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{Dq:()=>d,Dy:()=>l,RZ:()=>h,hU:()=>m,iu:()=>f,j9:()=>p,kr:()=>u});var n=a(5760),s=a(1684),o=a(8058),i=t([o]);function l(t,e){return n.scaleLinear().domain((0,s.kd)(0,1,t.length)).range(t.map((t=>Math.min(1,t/e)))).clamp(!0)}function d(t){t=[1,...t,0];let e=0;for(let a=0;a<t.length-1;a++){e+=(t[a]-t[a+1])*(a-1)/(t.length+4)}return e}o=(i.then?(await i)():i)[0];const u=["D","C","P","R","M"],h=["Demand","Carryover","Priority","Regs.","Min. Flow"],p=[[1,.9,.8,.7,.6].reverse(),[1,1.2,1.3],[0,1],[1,2,3,4],[0,.4,.6,.7,.8]],m={demand:p[0].length,carryover:p[1].length,priority:p[2].length,regs:p[3].length,minflow:p[4].length};function f(t){let e=parseInt(t);const a=e%m.minflow;e=(e-a)/m.minflow;const r=e%m.regs;e=(e-r)/m.regs;const n=e%m.priority;e=(e-n)/m.priority;const s=e%m.carryover;e=(e-s)/m.carryover;const o=e%m.demand;return[m.demand-1-o,s,n,r,a]}r()}catch(c){r(c)}}))},9550:(t,e,a)=>{a.d(e,{D5:()=>_,Hb:()=>E,eh:()=>y,hh:()=>f,jF:()=>v,k4:()=>R,kt:()=>x,p6:()=>w,qE:()=>c,sR:()=>b,si:()=>g,xg:()=>A});var r=a(5760),n=a(9408),s=a(3783),o=a.n(s),i=a(972);function c(t,e,a){return Math.max(e,Math.min(a,t))}function l(t){const e=t/2,a=3*Math.PI/2/16,r=[{x:Math.cos(5*Math.PI/4)*e,y:Math.sin(5*Math.PI/4)*e},{x:0,y:-Math.SQRT2*e}];for(let n=0;n<=16;n++)r.push({x:Math.cos(n*a-Math.PI/4)*e,y:Math.sin(n*a-Math.PI/4)*e});return r}const d=function(){const t=l(3),e=l(1),a=[];for(let r=0;r<t.length-2;r++)a.push([t[r],t[r+(r<2?1:2)],e[r+(r<2?1:2)],e[r]]);return a}();let u,h,p,m;function f(t,e,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n&&p&&a.length===m)return p;u&&a.length===h||(u=r.range(4).map((()=>function(t,e){const a=o().Bounds.create(t),n=a.min.x,s=a.max.x,i=a.min.y,c=a.max.y,l=r.scaleLinear([n,s]),d=r.scaleLinear([i,c]),u=[];for(let r=0;r<e;r++)for(;;){const e=l(Math.random()),a=d(Math.random());if(o().Vertices.contains(t,{x:e,y:a})){u.push([e,a]);break}}return u}(l(1),h=a.length))));const s=function(t){const e=r.sum(t.map((t=>t**2*3.14)));return Math.floor(2*Math.sqrt(e/3.14)/2)}(a.map((t=>{let{r:e}=t;return e}))),c=u[Math.floor(Math.random()*u.length)].map((t=>{let[e,a]=t;return[e*s,a*s]})),f=o().Engine,g=o().Bodies,y=o().Composite,A=f.create(),x=c.sort(((t,e)=>e[1]-t[1])),_=a.map(((t,e)=>{let{r:a,id:r}=t;const[n,s]=x[e];return g.circle(n,s,a,{restitution:0,id:r})})),v=d.map((t=>o().Body.create({position:o().Vertices.centre(t),vertices:t,isStatic:!0}))),w=o().Body.create({isStatic:!0});o().Body.setParts(w,v),o().Body.setCentre(w,{x:0,y:0}),o().Body.scale(w,s,s),y.add(A.world,[..._,w]);for(let r=0,o=60,i=.1;r<o*i;r++)f.update(A,1e3/o);const b=_.map((a=>{let{position:r,id:n}=a;return{id:n,x:r.x+t,y:r.y+e}}));return b.height=s/2/i.Sz*i.IC,!n||p&&b.length===m||(p=b,m=b.length),b}function g(t){return c((3.1304*(t-=.0088)**3-4.2384*t**2+3.3471*t+.0298)/2.2326,0,1)}function y(t){return t*Math.PI/180}function A(t,e){let[a,r]=t,[n,s]=e;return Math.sqrt(function(t,e){let[a,r]=t,[n,s]=e;return(n-a)**2+(s-r)**2}([a,r],[n,s]))}function x(t){return[t.left+t.width/2,t.top+t.height/2]}function _(t,e,a){let[r,n]=t;const s=Math.sqrt((r[0]-n[0])**2+(r[1]-n[1])**2),o=[(n[0]-r[0])/s,(n[1]-r[1])/s];return void 0===a&&(a=e),r[0]+=o[0]*e,r[1]+=o[1]*e,n[0]-=o[0]*a,n[1]-=o[1]*a,[r,n]}function v(t){let{rad:e,height:a}=t;return void 0!==e?.08*function(t){return(1+Math.SQRT2)*t}(e):.08*a}function w(t){return[r.mean(t,(t=>t[0])),r.mean(t,(t=>t[1]))]}function b(t,e,a){const r=new n.Pq0(t,e,0).applyEuler(new n.O9p(0,0,y(a)));return[r.x,r.y]}function E(t,e){for(const a of t){const t=b(a[0],a[1],e);a[0]=t[0],a[1]=t[1]}return t}function R(t){let e=t.length;for(;0!=e;){let a=Math.floor(Math.random()*e);e--,[t[e],t[a]]=[t[a],t[e]]}return t}},4956:(t,e,a)=>{a.d(e,{Ee:()=>c,Et:()=>n,K7:()=>d,LV:()=>i,ad:()=>o,iJ:()=>s,od:()=>l});var r=a(5043);function n(t,e){const a=Object.groupBy(t,e);for(const r of Object.keys(a))a[r]=a[r][0];return a}function s(t){const[e,a]=(0,r.useState)(t),n=(0,r.useRef)(t);(0,r.useEffect)((()=>{n.current=e}),[e]);const s=(0,r.useCallback)((t=>{a("function"===typeof t?e=>n.current=t(e):n.current=t)}),[]);return[e,s,n]}function o(t,e){return t&&t.state===e}function i(t){return t.replace(/(?![^\n]{1,15}$)([^\n]{1,15})\s/g,"$1\n")}function c(){return Math.floor(1e9*Math.random())}function l(t,e){let a;return a="function"===typeof e?t.findIndex(e):t.indexOf(e),-1!==a&&t.splice(a,1),t}function d(t){return t.map((t=>Array.from(t)))}},972:(t,e,a)=>{a.d(e,{GI:()=>E,IC:()=>h,JB:()=>x,Ng:()=>A,Sz:()=>l,UK:()=>R,UT:()=>j,YB:()=>_,Y_:()=>I,Yd:()=>d,bp:()=>y,f2:()=>v,h7:()=>w,ji:()=>b,js:()=>c});var r=a(1684),n=a(5760),s=a(2385),o=a(4956),i=a(9550);const c="M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z",l=Math.SQRT1_2,d=1,u=l+l,h=d+l,p=(l+d/2)/h;function m(t){if(t>=p){return Math.SQRT1_2*(1-t)/(1-p)}const e=2*(1-t/(u/h))-1,a=Math.acos(e);return Math.sin(a)}function f(t){return(t-l/h)*(1+Math.SQRT2)}function g(t){return t/(1+Math.SQRT2)+l/h}function y(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;if(Math.abs(t-e)<.01)return[];const n=a/2/d*l,s=1/r,o=[],i=[];let c,u,h,p;for(let l=1;l<=Math.ceil(1/s)&&(c=m(t+(l-1)*s),u=f(t+(l-1)*s),h=m(t+l*s),p=f(t+l*s),!(g(p)>=e));l++){const t=[-c*n,-u*n],e=[c*n,-u*n],a=[h*n,-p*n],r=[-h*n,-p*n];o.push(e,a),i.push(t,r)}h=m(e),p=f(e);const y=[-c*n,-u*n],A=[c*n,-u*n],x=[h*n,-p*n],_=[-h*n,-p*n];return o.push(A,x),i.push(y,_),o.push(...i.reverse()),o}function A(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(Math.abs(t-e)<.01)return[];const r=a/2/d*l,n=.1,s=[];let o,i,c,u;for(let l=1;l<=Math.ceil(10)&&(o=m(t+(l-1)*n),i=f(t+(l-1)*n),c=m(t+l*n),u=f(t+l*n),!(g(u)>=e));l++){const t=[-o*r,-i*r],e=[o*r,-i*r],a=[c*r,-u*r],n=[-c*r,-u*r];s.push([t,e,a]),s.push([t,a,n])}c=m(e),u=f(e);const h=[-o*r,-i*r],p=[o*r,-i*r],y=[c*r,-u*r],A=[-c*r,-u*r];return s.push([h,p,y]),s.push([h,y,A]),s}function x(t){t.attr("fill","transparent").attr("stroke","orange").attr("stroke-dasharray",3).attr("stroke-width",3).attr("vector-effect","non-scaling-stroke")}function _(t,e,a){(e||n).selectAll(t).style("display",a||"block")}function v(t,e){(e||n).selectAll(t).style("display","none")}function w(t,e){(e||n).selectAll(t).remove()}function b(t,e){return a=>{const n=a.append("defs").append("linearGradient").attr("id",e).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");n.append("stop").attr("stop-color","transparent"),n.append("stop").attr("stop-color","transparent"),t.forEach(((t,e)=>{for(let a=0;a<2;a++)n.append("stop").attr("stop-color",(0,r.YW)(e/s.W.LOD_1_LEVELS))}))}}function E(t,e){return a=>{a.selectAll("stop").each((function(a,r){if(0===r)return void n.select(this).attr("offset","0%");if(r===2*(t.length+1)-1)return void n.select(this).attr("offset","100%");let s=Math.floor((r-1)/2);n.select(this).attr("offset","".concat(100*(1-(0,i.si)(t[s]/e)),"%"))}))}}function R(t,e,a){return[t*a.k+a.x,e*a.k+a.y]}function j(t,e,a){return[(t-a.x)/a.k,(e-a.y)/a.k]}function I(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.2;return a=>{a.selectAll("*").remove();const r="string"===typeof t?(0,o.LV)(t).split("\n"):t,n=a.attr("x");r.forEach((t=>{a.append("tspan").attr("x",n).attr("dy","".concat(e,"em")).text(t)}))}}},7066:(t,e,a)=>{a.d(e,{P:()=>n});a(5043);var r=a(579);const n={howMuchIntro:(0,r.jsxs)("div",{className:"tut-text-card hero",children:[(0,r.jsx)("em",{children:"How much water do the people of California get?"})," Let's focus on two groups of people:"]}),norCal:(0,r.jsx)("div",{className:"tut-text-card",children:"the agriculture group in the north..."}),soCal:(0,r.jsx)("div",{className:"tut-text-card",children:"...and the refuge group in the south."}),barsAppear:(0,r.jsxs)("div",{className:"tut-text-card",children:["This is the average yearly amount of water each group receives, specifically from the ",(0,r.jsx)("b",{children:"Central Valley Project"}),", one of two water municipalities in California."]}),barsExplain:(0,r.jsx)("div",{className:"tut-text-card",children:"Here, it is presented as bar graphs, with the bottom axis representing the year and the side axis representing the amount of water delivered in thousand acre-feet (TAF)."}),barsCondense:(0,r.jsx)("div",{className:"tut-text-card",children:"We'll condense each bar graph into a single bar with a filled gradient."}),bucketsFill:(0,r.jsx)("div",{className:"tut-text-card",children:"What we get are buckets of water showing which water levels are most likely, with the darker areas being the most likely water levels."}),comparingTheTwo:(0,r.jsx)("div",{className:"tut-text-card",children:"Comparing the two, we see that the maximum water level for the refuge group is more than the agriculture group. Additionally, the refuge group's water level is more consistent than that of the agriculture group, with 1/3 maximum capacity being the most likely water level."}),butTheAgGroup:(0,r.jsx)("div",{className:"tut-text-card",children:"But the agriculture group has some chances of reaching higher than the refuge group's most likely water level, judging from the light blue levels that are situated above the 1/3 mark."}),overallIfWantReliable:(0,r.jsx)("div",{className:"tut-text-card",style:{marginBottom:"80vh"},children:"Overall, if we want a reliable supply we would want the refuge group's deliveries, but if we want a chance at higher supplies of water albeit with more inconsistent results, we would want the agriculture group's deliveries."}),forNowLetsFocus:(0,r.jsx)("div",{className:"tut-text-card",children:"For now, let's focus on the agriculture group. Here it is as a drop of water. We see here that the lightest color reaches the midpoint of the maximum water possible, meaning that there is a chance 600 TAF of water will be delivered to this group."}),darkerColsIndic:(0,r.jsx)("div",{className:"tut-text-card",children:"The darker colors, however, indicate that it's more likely that less than a quarter of the maximum, or around 300 TAF, will be delivered. As we'll later see, this is not a lot compared to other areas of California."}),ifChangeReality:(0,r.jsxs)("div",{className:"tut-text-card",children:["But what if we could ",(0,r.jsx)("em",{children:"change reality"}),"? What if we could increase the likelihood of delivering as much water as possible by changing the way we manage it?"]}),fortunateCanExplore:(0,r.jsxs)("div",{className:"tut-text-card",children:["Fortunately, we can explore those possibilities with the help of a simulator called",(0,r.jsx)("b",{children:" CalSim"}),"."]}),theseVarsCalled:(0,r.jsxs)("div",{className:"tut-text-card",children:["These variations are called ",(0,r.jsx)("em",{children:"scenarios"})," and are labelled with unique numbers. Our reality is a scenario with no variables changed, labelled scenario 0000."]}),atAGlance:(0,r.jsx)("div",{className:"tut-text-card",children:"At a glance, we can easily see that scenario 0020 appears to be the best scenario since the darker water levels reach higher than those of the other scenarios. To more concretely compare these scenarios, however, we'll use a different view."}),tryMoveRed:(0,r.jsx)("div",{className:"tut-text-card",style:{marginBottom:"120vh"},children:"Try moving the red line to change the minimum demand and see how well each of these scenarios meet those demands."}),collectAllScen:(0,r.jsx)("div",{className:"tut-text-card",children:"We'll collect all the possible scenarios and sort them by their average deliveries."}),soWhyNot:(0,r.jsxs)("div",{className:"tut-text-card",children:["So why don't we just choose the best scenario? Well, it's because it's not just this group that wants water. Other groups, which we call"," ",(0,r.jsx)("em",{children:"objectives"}),", want scenarios that best fit ",(0,r.jsx)("em",{children:"them."})]}),letsBringRefuge:(0,r.jsx)("div",{className:"tut-text-card",style:{marginBottom:"120vh"},children:"Let's bring back the refuge group. The scenarios that benefit the agriculture group do not always benefit the refuge group, and vice versa. Hover over the waterdrops to see how the same scenarios place for each objective. (Can you find a scenario that benefits both?)"})}},7073:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{A:()=>_,C:()=>x});var n=a(5760),s=a(1684),o=a(8058),i=a(3693),c=a(2385),l=a(972),d=a(9550),u=a(4956),h=t([o,i]);function m(){const t=n.interpolateRgbBasis(["#F2F5FB","#D0DDEB","#7B9BC0","#4F739F","#112A57"]),e="DEL_CVP_PAG_N",a="DEL_CVP_PRF_S",r="expl0000",i=o.j.OBJECTIVES_DATA[e][o.j.SCENARIO_KEY_STRING][r][o.j.DELIV_KEY_STRING],c=o.j.OBJECTIVES_DATA[a][o.j.SCENARIO_KEY_STRING][r][o.j.DELIV_KEY_STRING],l=["expl0020","expl0080","expl0480","expl0004"],u=l.map((t=>o.j.OBJECTIVES_DATA[e][o.j.SCENARIO_KEY_STRING][t][o.j.DELIV_KEY_STRING])),h=u.map((t=>e=>(0,d.si)(n.scaleLinear().domain((0,s.kd)(0,1,t.length)).range(t.map((t=>t/o.j.MAX_DELIVS)).sort().reverse()).clamp(!0)(e))));return{BAR_CHART_WIDTH:500,BAR_CHART_HEIGHT:400,INTERP_COLOR:t,PAG_OBJECTIVE:e,PRF_OBJECTIVE:a,DEFAULT_SCENARIO:r,PAG_DELIVS:i,PRF_DELIVS:c,VARIATIONS:l,VARIATIONS_DELIVS:u,VARIATIONS_INTERPERS:h,PAG_INTERPER:t=>n.scaleLinear().domain((0,s.kd)(0,1,i.length)).range(i.map((t=>t/o.j.MAX_DELIVS)).sort().reverse()).clamp(!0)(t),PAG_INTERPER_DROP:t=>(0,d.si)(n.scaleLinear().domain((0,s.kd)(0,1,i.length)).range(i.map((t=>t/o.j.MAX_DELIVS)).sort().reverse()).clamp(!0)(t)),PRF_INTERPER:t=>n.scaleLinear().domain((0,s.kd)(0,1,c.length)).range(c.map((t=>t/o.j.MAX_DELIVS)).sort().reverse()).clamp(!0)(t),DROP_VARIATIONS:[{idx:0,scen:"0020",clas:"drop1",desc:"change priority"},{idx:1,scen:"0080",clas:"drop2",desc:"increase carryover"},{idx:2,scen:"0480",clas:"drop3",desc:"decrease demand"},{idx:3,scen:"0004",clas:"drop4",desc:"increase minimum flow"}]}}function f(t){let{nodes:e,height:a,key:r}=t;return t=>{t.attr("class","large-drop "+r),t.append("circle").attr("class","highlight-circle").attr("stroke","none").attr("fill","yellow").attr("r",2*c.W.LOD_1_RAD_PX),t.append("text").style("font-size",a*c.W.SPREAD_1_2/15).attr("class","fancy-font large-gray-text").attr("text-anchor","middle"),t.selectAll(".small-drop").data(e).enter().append("g").attr("class","small-drop").each((function(t){n.select(this).call(g(t))}))}}function g(t){let{key:e,levs:a,x:r,y:s}=t;return t=>{t.append("rect").attr("class","bbox").style("visibility","hidden");const o="tut-grad-".concat((0,u.Ee)());t.call((0,l.ji)(a,o)),"expl0000"===e&&n.select(t.node().parentNode).select(".highlight-circle").attr("cx",r*c.W.SPREAD_1_2).attr("cy",s*c.W.SPREAD_1_2-(0,d.jF)({rad:c.W.LOD_1_RAD_PX})),t.append("path").attr("d",l.js).attr("class","outline").attr("transform","scale(".concat(.95*c.W.LOD_1_RAD_PX,")")),t.append("path").attr("class","fill").attr("d",l.js).attr("fill","url(#".concat(o,")")).attr("transform","scale(".concat(c.W.LOD_1_RAD_PX,")"))}}function y(t){let{nodes:e,key:a,height:r}=t;return t=>{t.select("text").attr("x",0).attr("y",r/2*c.W.SPREAD_1_2*.8).call((0,l.Y_)(i.G[a].display_name||i.G[a].id)),t.selectAll(".small-drop").data(e).attr("display","initial").attr("transform",(t=>{let{x:e,y:a}=t;return"translate(".concat(e*c.W.SPREAD_1_2,", ").concat(a*c.W.SPREAD_1_2,")")})).each((function(t){n.select(this).call(A(t))}))}}function A(t){let{levs:e,maxLev:a}=t;return t=>{t.call((0,l.GI)(e,a));const r=t.select(".fill").node().getBBox();t.select(".bbox").attr("x",r.x).attr("y",r.y).attr("width",r.width).attr("height",r.height)}}function x(t,e,a){let{onHover:r}=a;t.selectAll(".large-drop").data(e.groups).join((t=>t.append("g").each((function(t,a){n.select(this).call(f(t,e.groupPositions[a]))})))).attr("transform",((t,a)=>{const r=e.groupPositions[a];return"translate(".concat(r[0],", ").concat(r[1],")")})).each((function(t){n.select(this).call(y(t)).selectAll(".small-drop").on("mouseenter",(function(t,e){r&&r(e)}))}))}[o,i]=h.then?(await h)():h;const _=m();r()}catch(p){r(p)}}))},6924:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{W:()=>p});var n=a(1684),s=a(2385),o=a(8058),i=a(9152),c=a(9550),l=a(4956),d=t([o,i]);function h(t){console.time("init waterdrops");const e="objective"===t?o.j.OBJECTIVE_IDS:o.j.SCENARIO_IDS,a="objective"===t?o.j.SCENARIO_IDS:o.j.OBJECTIVE_IDS,r=(e.length,a.length),d=Math.sqrt(r/Math.PI)*s.W.LOD_1_RAD_PX*2*s.W.LOD_1_SMALL_DROP_PAD_FACTOR*s.W.LOD_1_LARGE_DROP_PAD_FACTOR,u=s.W.LOD_1_RAD_PX*s.W.LOD_1_SMALL_DROP_PAD_FACTOR,h=(0,c.hh)(0,0,e.map(((t,e)=>({r:d,id:e}))));for(let n=0;n<h.length;n++)h[n].tilt=50*Math.random()-25;const p=(0,l.Et)(h,(t=>{let{id:e}=t;return e})),m=(0,c.hh)(0,0,a.map(((t,e)=>({r:u,id:e})))),f=(0,l.Et)(m,(t=>{let{id:e}=t;return e})),g=[],y=[],A={};for(const l of o.j.FLATTENED_DATA){const{id:e,objective:a,scenario:r,deliveries:d}=l,u=(0,i.Dy)(d,o.j.MAX_DELIVS),h=(0,n.kd)(0,1,s.W.LOD_1_LEVELS+1).map((t=>u(t))).map(((t,e)=>Math.max(t,0==e?s.W.LOD_1_MIN_LEV_VAL:0)*s.W.LOD_1_RAD_PX)),m="objective"===t?a:r,y="objective"===t?r:a,x=o.j.DATA_GROUPINGS[t][m].rank,_=o.j.DATA_GROUPINGS[t][m][e],v=50*Math.random()-25,w=p[x].tilt,{x:b,y:E}=f[_],[R,j]=(0,c.sR)(b,E,w),I={id:e,levs:h,maxLev:s.W.LOD_1_RAD_PX,domLev:(0,i.Dq)(h),tilt:v,dur:100*Math.random()+400,x:b,y:E,group:m,key:y,globalX:p[x].x+R,globalY:p[x].y+j,globalTilt:w+v};g.push(I),A[m]||(A[m]=[]),A[m].push(I)}for(const n of e){const{x:e,y:a,tilt:r}=p[o.j.DATA_GROUPINGS[t][n].rank];y.push({x:e,y:a,tilt:r,key:n,height:m.height,nodes:A[n]})}return console.timeEnd("init waterdrops"),{nodes:g,groups:y,height:h.height}}[o,i]=d.then?(await d)():d;const p=h("objective");r()}catch(u){r(u)}}))},4293:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{A:()=>_});var n=a(5760),s=a(5043),o=a(4096),i=a(8342),c=a(8687),l=a(8058),d=a(2385),u=a(9550),h=a(4956),p=a(972),m=a(9152),f=a(7368),g=a(9701),y=a(579),A=t([i,c,l,m,g]);function _(){const t=(0,s.useContext)(o.B),[e,a]=(0,s.useState)(),[r,A]=(0,s.useState)(null),[x,_]=(0,s.useState)(n.zoomIdentity),{panels:v,setPanels:w,onPanelDragStart:b,getPanelStyle:E}=(0,f.J)(x),R=(0,s.useRef)(),j=(0,s.useRef)();return(0,s.useEffect)((function(){const e=n.select("#mosaic-svg").select(".svg-trans").append("g").attr("id","compare-group");e.append("text").attr("id","member-variable"),e.append("text").attr("id","member-label"),t.addZoomHandler((function(t){_(t)}))}),[]),(0,s.useEffect)((function(){if((0,h.ad)(t.state,"CompareView")){const e=n.select("#compare-group"),{viewCenter:r,transitionDuration:s=0}=t.state;return j.current=r,R.current=g._.getWaterdropGroups(t.activeWaterdrops,t.waterdrops,r),g._.updateDropsSVG(e,R.current,s/5,{onHover:t=>{a({key:t.key})}}),(0,p.f2)(".large-gray-text",e),setTimeout((()=>{a({key:R.current.groups[0].nodes[0].key}),(0,p.YB)("#member-variable, #member-label, .large-gray-text",e),(0,p.YB)(".comp-settings",n,"flex")}),s+500),t.setGoBack((()=>()=>{const e=t.resetCamera();t.setState({state:"WideView",transitionDuration:e})})),_(t.camera.curTransform),function(){(0,p.h7)(".large-drop, .circlet, .comp-line",e),(0,p.f2)("#member-variable, #member-label",e),(0,p.f2)(".comp-settings"),w([]),t.setGoBack(null)}}}),[t.state]),(0,s.useEffect)((function(){if(e){const[t,a,r]=g._.calcLinesAndPositions(R.current,e.key);w(function(t){return e=>t.map(((t,a)=>{let r=0,n=0;e[a]&&(r=e[a].offsetX,n=e[a].offsetY);const[s,o,i]=function(t,e){let[a,r]=t,[n,s]=e,o=a,i=r;const c=2*R.current.groups[0].height;o<n?o-=c:o+=c;return[o,i,o<n]}(R.current.groupPositions[a],j.current);return{text:t.key,x:s,y:o,id:R.current.groups[a].key,nodeID:t.id,isLeft:i,offsetX:r,offsetY:n}}))}(r)),g._.updateLabelSVG((0,u.p6)(t),e.key.slice(4),R.current.groups[0].height*d.W.SPREAD_1_2),g._.updateScenIndicatorsSVG(t,a)}}),[e]),(0,s.useEffect)((function(){const t=n.select("#compare-group");if(null===r)return(0,p.f2)(".color-drop-group",t),void(0,p.YB)(".large-drop",t);g._.updateColorDrops(t,R.current,(t=>l.j.KEY_SETTINGS_MAP[t][r]),["red","orange","blue","green","magenta"][r]),(0,p.YB)(".color-drop-group",t),(0,p.f2)(".large-drop",t)}),[r]),(0,y.jsxs)(y.Fragment,{children:[e&&(0,y.jsx)(c.A,{settings:(0,m.iu)(e.key.slice(4)),setColorSetting:A}),v.map(((e,a)=>{let{x:r,y:n,id:s,isLeft:o,offsetX:c,offsetY:d,nodeID:u}=e;return(0,y.jsx)("div",{className:"panel compare-panel"+(o?" left":""),style:E({x:r,y:n,offsetX:c,offsetY:d}),onMouseDown:t=>b(t,{id:s}),children:(0,y.jsx)(i.A,{width:300,height:200,data:l.j.FLATTENED_DATA[u].deliveries,goal:t.goals[s],setGoal:e=>{t.setGoals((t=>(t[s]=e,{...t})))}})},a)}))]})}[i,c,l,m,g]=A.then?(await A)():A,r()}catch(x){r(x)}}))},5621:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{A:()=>w});var n=a(5760),s=a(5043),o=a(4096),i=a(8342),c=a(9083),l=a(8058),d=a(2385),u=a(3693),h=a(4956),p=a(972),m=a(9152),f=a(9550),g=a(2186),y=a(7368),A=a(7285),x=a(579),_=t([i,c,l,u,m]);function w(){const t=(0,s.useContext)(o.B),e=(0,s.useRef)([]),a=(0,s.useRef)(null),[r,g]=(0,s.useState)(null),[_,v]=(0,s.useState)(n.zoomIdentity),{panels:w,panelsRef:E,setPanels:R,onPanelDragStart:j,getPanelStyle:I}=(0,y.J)(_),[D,T]=(0,s.useState)(null),k=(0,s.useRef)(null);function C(){const e=16/t.camera.height*t.camera.getZFromFarHeight(a.current.height*d.W.SPREAD_1_2*1.5);n.select("#examine-group .instruction-text").attr("x",a.current.x-a.current.height*d.W.SPREAD_1_2*.8).attr("y",a.current.y-e).attr("opacity",0).attr("text-anchor","end").attr("font-size",e).call((0,p.Y_)(["click to show panels.","you can drag panels."],1.6)).call((t=>{t.transition().attr("opacity",1)})).selectAll("tspan").each((function(t,a){n.select(this).attr("dx",a*e)}));const r=20/t.camera.height*t.camera.getZFromFarHeight(a.current.height*d.W.SPREAD_1_2*1.5);n.select("#examine-group .large-drop-label").attr("x",a.current.x).attr("y",a.current.y+a.current.height/2*d.W.SPREAD_1_2*.9).attr("opacity",0).attr("text-anchor","middle").attr("font-size",r).call((0,p.Y_)(u.G[t.activeWaterdrops[0]].display_name||u.G[t.activeWaterdrops[0]].id,1.2)).transition().attr("opacity",1)}function S(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{x:s,y:o}=a.current,{x:i,y:c,id:l,key:u}=t.waterdrops.nodes[e];R((t=>{if(-1!==t.findIndex((t=>{let{id:e}=t;return l===e}))){if(!n)return t;(0,h.od)(t,(t=>t.id===l))}const a={text:u.slice(4),x:s+i*d.W.SPREAD_1_2,y:o+c*d.W.SPREAD_1_2,offsetX:20,offsetY:40,id:l,preview:r,panelKey:r?-1:e};return[...t,a]}))}function L(t){R((e=>((0,h.od)(e,(e=>{let{id:a}=e;return t===a})),[...e])))}function P(t){const a=n.select("#examine-group");e.current.includes(t.id)?((0,h.od)(e.current,t.id),a.select(".circlet#i".concat(t.id)).classed("active",!1),L(t.id),T(null)):(L(t.id),e.current.push(t.id),a.select(".circlet#i".concat(t.id)).classed("active",!0),S(t.id),T(t.id))}function O(t){e.current.includes(t.id)?(n.select(".examine-panel#p".concat(t.id)).style("z-index",100),T(t.id)):(k.current&&(clearTimeout(k.current),R((t=>((0,h.od)(t,(t=>{let{panelKey:e}=t;return-1===e})),[...t])))),S(t.id,!0))}function M(t){e.current.includes(t.id)||(k.current=setTimeout((()=>{L(t.id),k.current=null}),100)),T((e=>e===t.id?null:e)),n.select(".examine-panel#p".concat(t.id)).style("z-index",0)}if((0,s.useEffect)((function(){const e=n.select("#mosaic-svg").select(".svg-trans").append("g").attr("id","examine-group");e.append("circle").attr("class","highlight-circle"),e.append("path").attr("class","connect-line"),e.append("text").attr("class","instruction-text large-gray-text fancy-font"),e.append("text").attr("class","large-drop-label large-gray-text fancy-font"),t.addZoomHandler((function(t){v(t)}))}),[]),(0,s.useEffect)((function(){if((0,h.ad)(t.state,"ExamineView")){const{transitionDuration:r=0}=t.state,s=n.select("#examine-group");return a.current=t.waterdrops.groups.find((e=>e.key===t.activeWaterdrops[0])),A._.updateSmallDropSVG(s,a.current,r/2,{onClick:P,onHover:O,onUnhover:M}),setTimeout(C,1.2*r),t.setGoBack((()=>()=>{const e=t.resetCamera();t.setState({state:"WideView",transitionDuration:e})})),v(t.camera.curTransform),(0,p.YB)("#examine-group"),function(){(0,p.h7)(".small-drop, .circlet",s),(0,p.f2)("#examine-group"),n.selectAll("#examine-group .instruction-text, #examine-group .large-drop-label").attr("opacity",0),R([]),e.current=[],a.current=null,t.setGoBack(null)}}}),[t.state]),(0,s.useEffect)((function(){const t=n.select("#examine-group");if(null===r)return(0,p.f2)(".color-drop",t),void(0,p.YB)(".small-drop",t);A._.updateColorDrops(t,a.current,(t=>l.j.KEY_SETTINGS_MAP[t][r]),["red","orange","blue","green","magenta"][r]),(0,p.YB)(".color-drop",t),(0,p.f2)(".small-drop",t)}),[r]),(0,h.ad)(t.state,"ExamineView"))return(0,x.jsxs)(x.Fragment,{children:[w.map((e=>{let{text:a,x:r,y:n,id:s,offsetX:o,offsetY:d,panelKey:u,preview:h}=e;return(0,x.jsxs)("div",{className:"panel examine-panel ".concat(h?"preview":""),id:"p".concat(s),style:I({x:r,y:n,offsetX:o,offsetY:d}),onMouseDown:t=>!h&&j(t,{id:s}),onMouseEnter:()=>!h&&O({id:s}),onMouseLeave:()=>!h&&M({id:s}),children:[(0,x.jsxs)("div",{className:"panel-tab",children:["scenario ",(0,x.jsx)("span",{children:a})]}),(0,x.jsx)(i.A,{width:300,height:200,data:l.j.FLATTENED_DATA[s].deliveries,goal:t.goals[t.activeWaterdrops[0]],setGoal:e=>{t.setGoals((a=>(a[t.activeWaterdrops[0]]=e,{...a})))}}),(0,x.jsx)(c.A,{settings:(0,m.iu)(a),setColorSetting:g})]},h?-1:s)})),D&&(0,x.jsx)(b,{connectLine:function(e){if(-1===E.current.findIndex((t=>{let{id:a}=t;return e===a})))return;const{x:a,y:r}=E.current.find((t=>t.id===e)),[s,o]=t.camera.worldToScreen(a,r),i=n.select(".examine-panel#p".concat(e)).node().getBoundingClientRect(),[c,l]=[i.left+i.width/2,i.top+i.height/2],d=c-s,u=l-o;let h,p;return Math.abs(d)>Math.abs(u)?(p=0,h=(d<0?1:-1)*(i.width/2-5)):(h=0,p=(u<0?1:-1)*(i.height/2-5)),(0,f.D5)([[s,o],[c+h,l+p]],8,0)}(D)})]})}function b(t){let{connectLine:e}=t;return(0,x.jsx)("div",{className:"connect-line",style:E(...e),children:(0,x.jsx)("div",{className:"connect-line-container"})})}function E(t,e){const a=(0,f.xg)(t,e),r=(0,g.H)(Math.atan2(e[1]-t[1],e[0]-t[0]));return{left:"".concat(t[0],"px"),top:"".concat(t[1],"px"),width:"".concat(a,"px"),rotate:"".concat(r,"deg")}}[i,c,l,u,m]=_.then?(await _)():_,r()}catch(v){r(v)}}))},4654:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{A:()=>_});var n=a(5760),s=a(5043),o=a(3999),i=a(4096),c=a(4956),l=a(5111),d=a(8342),u=a(8611),h=a(972),p=a(7073),m=a(4757),f=a(3693),g=a(4082),y=a(579),A=t([d,p,m,f,g]);function _(){const t=(0,s.useContext)(i.B),{hookAnimations:e,getSlidesInRange:a,storyVars:r}=(0,m.R)(t);if((0,s.useLayoutEffect)((function(){if((0,c.ad)(t.state,"TutorialView"))return(0,h.f2)(".bucket-wrapper, .vardrop, .var-scen-label, .vardrop .dot-histogram-wrapper, .main-histogram, .tut-comparer-graphics-wrapper"),e(),function(){t.resetCamera(!1),(0,h.f2)(".tutorial-view")}}),[t.state]),(0,c.ad)(t.state,"TutorialView"))return(0,y.jsxs)("div",{className:"tutorial-view",children:[(0,y.jsxs)("div",{className:"scrollama scrollama-locations",children:[(0,y.jsx)(w,{}),(0,y.jsx)(b,{onClick:()=>t.setState({state:"WideView"})}),(0,y.jsx)(v,{children:a("howMuchIntro","soCal").map(((t,e)=>(0,y.jsx)(o.p,{data:t,children:t.script},e)))})]}),(0,y.jsxs)("div",{className:"scrollama scrollama-create-buckets",children:[(0,y.jsx)(R,{storyVars:r}),(0,y.jsx)(v,{children:a("barsAppear","overallIfWantReliable").map(((t,e)=>(0,y.jsx)(o.p,{data:t,children:t.script},e)))})]}),(0,y.jsxs)("div",{className:"scrollama scrollama-compare-scenobjs",children:[(0,y.jsx)(j,{storyVars:r}),(0,y.jsx)(I,{}),(0,y.jsx)(v,{children:a("forNowLetsFocus","letsBringRefuge").map(((t,e)=>(0,y.jsx)(o.p,{data:t,children:t.script},e)))})]}),(0,y.jsx)(E,{onClick:()=>t.setState({state:"WideView"})})]})}function v(t){let{children:e}=t;return(0,y.jsx)(o.h,{offset:.8,onStepEnter:async t=>{var e;let{data:a,direction:r,element:s}=t;"up"!==r&&(null===(e=a.animHandler)||void 0===e||e.do(),n.select(s).transition().style("opacity",1))},onStepExit:async t=>{var e;let{data:a,direction:r,element:s}=t;"down"!==r&&(null===(e=a.animHandler)||void 0===e||e.undo(),n.select(s).transition().style("opacity",.2))},children:e})}function w(t){let{}=t;return(0,s.useEffect)((function(){const t=[p.A.PAG_OBJECTIVE,p.A.PRF_OBJECTIVE],e=n.select("#tut-minimap").attr("width",400).attr("height",500),a=n.geoMercator().scale(2e3).center(g.l.CALIFORNIA_CENTER).translate([200,250]),r=[...g.l.SPATIAL_DATA.features.filter((e=>t.includes(e.properties.CalLiteID))),g.l.CALIFORNIA_OUTLINE];e.selectAll("path").data(r).join("path").attr("d",(t=>n.geoPath().projection(a)(t))).attr("class",(t=>"outline "+t.properties.CalLiteID)).attr("stroke",(t=>t.properties.CalLiteID?"transparent":"gray")).attr("stroke-width",1).style("transform-origin",(t=>{const[e,r]=a(t.geometry.coordinates[0][0][0]);return"".concat(e,"px ").concat(r,"px")})).attr("fill","transparent")}),[]),(0,y.jsx)("svg",{className:"tut-minimap",id:"tut-minimap"})}function b(t){let{onClick:e}=t;return(0,s.useEffect)((function(){const t=document.documentElement.scrollTop;window.addEventListener("scroll",(function(){const e=document.documentElement.scrollTop,a=Math.max(0,1-(e-t)/50);n.select(".skip-btn").style("opacity",a)}))}),[]),(0,y.jsx)("button",{className:"skip-btn",onClick:e,children:"Skip intro"})}function E(t){let{onClick:e}=t;return(0,y.jsxs)("div",{className:"tut-text-card cte",children:["Thus, tradeoffs must often be made when managing California's water supply. What are the ways we can manage California's water, and how do their outcomes compare? Go to the next step to find out!",(0,y.jsx)("button",{className:"fancy-font",onClick:e,children:"click to explore!"})]})}function R(t){var e,a;let{storyVars:r}=t;return(0,y.jsxs)("div",{className:"tut-graph-wrapper",children:[(0,y.jsx)(k,{id:"pag-bar-graph",label:null===(e=f.G[p.A.PAG_OBJECTIVE])||void 0===e?void 0:e.display_name,bucketInterper:r.bucketInterperPAG}),(0,y.jsx)(k,{id:"prf-bar-graph",label:null===(a=f.G[p.A.PRF_OBJECTIVE])||void 0===a?void 0:a.display_name,bucketInterper:r.bucketInterperPRF})]})}function j(t){var e;let{storyVars:a}=t;return(0,y.jsxs)("div",{className:"tut-drop-graphics-wrapper",children:[(0,y.jsx)(D,{objectiveLabel:null===(e=f.G[p.A.PAG_OBJECTIVE])||void 0===e?void 0:e.display_name,dropInterper:a.dropInterper,histData:p.A.PAG_DELIVS,goal:a.userGoal,setGoal:t=>{a.setUserGoal(t)}}),(0,y.jsx)(T,{variations:p.A.DROP_VARIATIONS.map((t=>({...t,interper:a.variationInterpers[t.idx],histData:p.A.VARIATIONS_DELIVS[t.idx]}))),goal:a.userGoal,setGoal:t=>{a.setUserGoal(t)}})]})}function I(){return(0,y.jsx)("div",{className:"tut-comparer-graphics-wrapper",children:(0,y.jsx)("svg",{id:"comparer-graphics"})})}function D(t){let{objectiveLabel:e,dropInterper:a,histData:r,goal:n,setGoal:s}=t;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"main-waterdrop",children:[(0,y.jsx)(u.A,{levelInterp:a,width:400,height:p.A.BAR_CHART_HEIGHT,colorInterp:p.A.INTERP_COLOR}),(0,y.jsxs)("p",{className:"var-scen-label",children:["scenario ",(0,y.jsx)("span",{className:"scen-number",children:"0000"})]}),(0,y.jsx)("p",{className:"fancy-font objective-label",children:e})]}),(0,y.jsx)("div",{className:"main-histogram",children:(0,y.jsx)(d.A,{width:210,height:140,data:r,goal:n,setGoal:s})})]})}function T(t){let{variations:e,goal:a,setGoal:r}=t;return e.map((t=>{let{idx:e,scen:n,clas:s,desc:o,interper:i,histData:c}=t;return(0,y.jsxs)("div",{className:"vardrop ".concat(s),desc:o,children:[(0,y.jsx)(u.A,{levelInterp:i,width:400,height:2*p.A.BAR_CHART_HEIGHT/3,colorInterp:p.A.INTERP_COLOR}),(0,y.jsxs)("p",{className:"var-scen-label",children:["scenario ",(0,y.jsx)("span",{className:"scen-number",children:n})]}),(0,y.jsx)(d.A,{shortForm:!0,width:210,height:140,data:c,goal:a,setGoal:r})]},e)}))}function k(t){let{id:e,bucketInterper:a,label:r}=t;return(0,y.jsxs)("div",{className:"tut-graph",children:[(0,y.jsx)("svg",{id:e}),(0,y.jsx)(l.A,{levelInterp:a,width:300,height:p.A.BAR_CHART_HEIGHT,colorInterp:p.A.INTERP_COLOR}),(0,y.jsx)("p",{className:"fancy-font objective-label",children:r})]})}[d,p,m,f,g]=A.then?(await A)():A,r()}catch(x){r(x)}}))},6313:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{A:()=>_});var n=a(5760),s=a(5043),o=a(9128),i=a(7192),c=a.n(i),l=a(4096),d=a(3693),u=a(4082),h=a(2385),p=a(9550),m=a(4956),f=a(972),g=a(3097),y=a(579),A=t([d,u,g]);function _(){const t=(0,s.useContext)(l.B),[e,a]=(0,s.useState)({zoom:1,mouseX:0,mouseY:0}),[r,o]=(0,s.useState)(null),[i,A]=(0,s.useState)(null),x=(0,s.useRef)(!1),_=(0,s.useRef)([]);(0,s.useEffect)((function(){if(!t.waterdrops)return;!function(){(0,f.f2)("#infobox, #mosaic-webgl, #mosaic-svg");n.select("#mosaic-svg").select(".svg-trans").append("g").attr("id","wide-group").append("text").attr("class","instruction-text large-gray-text fancy-font").attr("x",0-.6*t.waterdrops.height)}();const e=function(){const e=t=>{a((e=>({...e,zoom:t.k})))},r=t=>{a((e=>({...e,mouseX:t.x,mouseY:t.y})))};return t.addZoomHandler(e),window.addEventListener("mousemove",r),function(){window.removeEventListener("mousemove",r)}}();return g._.drawMinimapSVG(),e}),[]),(0,s.useEffect)((function(){if((0,m.ad)(t.state,"WideView")){const{transitionDuration:e=0}=t.state;return n.select("body").style("overflow","hidden"),x.current=!0,a((e=>({...e,zoom:t.camera.curTransform.k}))),console.time("drawing"),t.dropsMesh.draw(t.scene),console.timeEnd("drawing"),t.dropsMesh.updateVisibility(1),t.dropsMesh.updateOutlineVisibility(t.getOutlineOpacity(t.camera.curTransform.k)),function(){const e=n.select("#wide-group");g._.updateLargeDropSVG(e,t.waterdrops,{onClick:R,onHover:j,onUnhover:I});for(const t of _.current)e.select(".circlet#b".concat(t.key)).classed("active",!0);const a=20/t.camera.height*t.camera.getZFromFarHeight(t.waterdrops.height);e.select(".instruction-text").attr("y",5*-a).attr("text-anchor","end").attr("font-size",a).call((0,f.Y_)(["click to interact.","scroll to zoom.","drag to pan."],2)).selectAll("tspan").each((function(t,e){n.select(this).attr("dx",e*a)}))}(),(0,f.YB)("#infobox, #mosaic-webgl, #mosaic-svg, #wide-group"),function(){(0,f.f2)("#infobox, #wide-group"),x.current=!1}}}),[t.state]),(0,s.useEffect)((function(){x.current&&n.select("#wide-group").selectAll(".cloud-text").each(g._.fontSizer(e,t.camera,t.waterdrops.height))}),[e]);const w=(0,s.useCallback)((function(){t.setDisableCamAdjustments(!0);const{x:e,y:a,height:r}=_.current[0],n=[e,a-(0,p.jF)({height:r}),t.camera.getZFromFarHeight(r*h.W.SPREAD_1_2*1.5)],[s,o]=t.zoomTo(n,(function(){t.setDisableCamAdjustments(!1)}));s(),t.setState({state:"ExamineView",transitionDuration:o});const i=t.getOutlineOpacity(t.camera.curTransform.k);g._.fadeOutDrops(t.dropsMesh,t.scene,i,o/2)}),[]),b=(0,s.useCallback)((function(){t.setDisableCamAdjustments(!0);const e=(0,p.p6)(_.current.map((t=>[t.x,t.y]))),a=[...e,t.camera.getZFromFarHeight(2*t.waterdrops.groups[0].height*h.W.SPREAD_1_2*.75*2)],[r,n]=t.zoomTo(a,(function(){t.setDisableCamAdjustments(!1)}));r(),t.setState({state:"CompareView",transitionDuration:n,viewCenter:e});const s=t.getOutlineOpacity(t.camera.curTransform.k);g._.fadeOutDrops(t.dropsMesh,t.scene,s,n/5)}),[]),E=(0,s.useCallback)((function(){t.setActiveWaterdrops([]),_.current=[],n.selectAll("#wide-group .circlet").classed("active",!1)}),[]);function R(e){const a=n.select("#wide-group");t.setActiveWaterdrops((t=>(t.includes(e.key)?(t=(0,m.od)(t,e.key),_.current=(0,m.od)(_.current,e),a.select(".circlet#b".concat(e.key)).classed("active",!1)):(t.push(e.key),_.current.push(e),a.select(".circlet#b".concat(e.key)).classed("active",!0)),[...t])))}function j(t){o({id:t.key,description:d.G[t.key].desc}),n.select("#minimap").select(".outline."+t.key).attr("fill","gray")}function I(t){o(null),n.select("#minimap").select(".outline."+t.key).attr("fill","transparent")}const D=(0,s.useMemo)((()=>null===i?[]:c().go(i,t.waterdrops.groups,{keys:[t=>d.G[t.key].id,t=>d.G[t.key].display_name,t=>d.G[t.key].desc],limit:10,all:!0})),[i,t.waterdrops]);return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{id:"infobox",children:[(0,y.jsx)("svg",{id:"minimap"}),r&&(0,y.jsxs)("div",{className:"details",children:[!u.l.SPATIAL_FEATURES[r.id]&&(0,y.jsx)("p",{className:"no-loc-data",children:"No Location Data"}),(0,y.jsx)("p",{className:"curDesc",children:r.description}),(0,y.jsxs)("p",{className:"curKey",children:["id: ",(0,y.jsxs)("span",{children:[" ",r.id," "]})]})]}),!r&&(0,y.jsxs)("div",{className:"searchbox",children:[(0,y.jsx)("input",{type:"text",placeholder:"search",value:i||"",onChange:t=>A(t.target.value),onFocus:()=>{A(""),n.select(".results").style("display","flex")},onBlur:()=>{setTimeout((()=>{A(null),n.select(".results").style("display","none")}),100)}}),(0,y.jsx)("div",{className:"results",style:{display:"none"},children:D.map((t=>{let{obj:e}=t;return(0,y.jsx)("button",{onClick:()=>R(e),children:d.G[e.key].display_name||d.G[e.key].id},e.key)}))})]})]}),(0,y.jsx)("div",{className:"action-btn-wrapper",children:(0,y.jsx)(v,{appCtx:t,handleClickExamine:w,handleClickDeselectAll:E,handleClickCompare:b})})]})}function v(t){let e,a,{appCtx:r,handleClickExamine:n,handleClickDeselectAll:s,handleClickCompare:i}=t;return(0,m.ad)(r.state,"WideView")&&r.activeWaterdrops.length&&(1===r.activeWaterdrops.length?e=(0,y.jsxs)("button",{onClick:n,className:"wide-view-action-btn fancy-font",children:[(0,y.jsx)(o.WEK,{}),(0,y.jsx)("span",{children:"examine"})]}):a=(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("button",{onClick:s,className:"fancy-font supplement-btn",children:(0,y.jsx)("span",{children:"deselect all"})}),(0,y.jsxs)("button",{onClick:i,className:"wide-view-action-btn fancy-font",children:[(0,y.jsx)(o.IS1,{}),(0,y.jsx)("span",{children:"compare"})]})]})),(0,y.jsxs)(y.Fragment,{children:[e,a]})}[d,u,g]=A.then?(await A)():A,r()}catch(x){r(x)}}))},9701:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{_:()=>w});var n=a(5760),s=a(2385),o=a(3693),i=a(9550),c=a(972),l=t([o]);function u(t){let{nodes:e,height:a}=t;return t=>{t.attr("class","large-drop"),t.append("circle").attr("class","highlight-circle").attr("stroke","none").attr("fill","yellow").attr("r",2*s.W.LOD_1_RAD_PX),t.append("text").style("font-size",a*s.W.SPREAD_1_2/15).attr("class","fancy-font large-gray-text").attr("text-anchor","middle"),t.selectAll(".small-drop").data(e).enter().append("g").attr("class","small-drop").each((function(t){n.select(this).call(p(t))}))}}function h(t,e){let{nodes:a,key:r,height:o}=t;return t=>{const c={};t.call(f(r,o)).selectAll(".small-drop").data(a).attr("display","initial").attr("transform",(t=>{let{x:e,y:a,tilt:r}=t;return"translate(".concat(e,", ").concat(a,") rotate(").concat(r,")")})).each((function(t){n.select(this).call(m(t,c))})).transition().delay(e).duration(1e3).attr("transform",(t=>{let{x:e,y:a,tilt:r}=t;return"translate(".concat(e*s.W.SPREAD_1_2,", ").concat(a*s.W.SPREAD_1_2,") rotate(").concat(r,")")})),t.select(".highlight-circle").attr("cx",c.x).attr("cy",c.y-(0,i.jF)({rad:s.W.LOD_1_RAD_PX})).transition().delay(e).duration(1e3).attr("cx",c.x*s.W.SPREAD_1_2).attr("cy",c.y*s.W.SPREAD_1_2-(0,i.jF)({rad:s.W.LOD_1_RAD_PX}))}}function p(t){let{levs:e,id:a}=t;return t=>{t.append("rect").attr("class","bbox").style("visibility","hidden");const r="compare-grad-".concat(a);t.call((0,c.ji)(e,r)),t.append("path").attr("d",c.js).attr("class","outline").attr("transform","scale(".concat(.95*s.W.LOD_1_RAD_PX,")")),t.append("path").attr("class","fill").attr("d",c.js).attr("fill","url(#".concat(r,")")).attr("transform","scale(".concat(s.W.LOD_1_RAD_PX,")"))}}function m(t,e){let{key:a,levs:r,maxLev:n,x:s,y:o}=t;return t=>{"expl0000"===a&&(e.x=s,e.y=o),t.call((0,c.GI)(r,n));const i=t.select(".fill").node().getBBox();t.select(".bbox").attr("x",i.x).attr("y",i.y).attr("width",i.width).attr("height",i.height)}}function f(t,e){return a=>{a.select("text").attr("x",0).attr("y",e/2*s.W.SPREAD_1_2*.9).call((0,c.Y_)(o.G[t].display_name||o.G[t].id))}}function g(t,e,a,r){let{onClick:s,onHover:o,onUnhover:i}=r;t.selectAll(".large-drop").data(e.groups).join((t=>t.append("g").each((function(t){n.select(this).call(u(t))})))).attr("transform",(t=>{let{x:e,y:a,tilt:r}=t;return"translate(".concat(e,", ").concat(a,") rotate(").concat(r,")")})).each((function(t){const e=n.select(this).call(h(t,a)).selectAll(".small-drop");s&&e.on("click",(function(t,e){s(e)})),o&&e.on("mouseenter",(function(t,e){n.select(this.parentNode).raise(),o(e)})),i&&e.on("mouseleave",(function(t,e){i(e)}))})).transition().delay(a).duration(1e3).attr("transform",((t,a)=>"translate(".concat(e.groupPositions[a][0],", ").concat(e.groupPositions[a][1],")")))}function y(t,e,a,r){t.selectAll(".color-drop-group").data(e.groups).join((t=>t.append("g").each((function(t){let{nodes:e}=t;n.select(this).call((t=>{t.attr("class","color-drop-group").selectAll(".color-drop").data(e).join("circle").attr("class","color-drop").attr("r",s.W.LOD_1_RAD_PX)}))})))).attr("transform",((t,a)=>"translate(".concat(e.groupPositions[a][0],", ").concat(e.groupPositions[a][1],")"))).each((function(){n.select(this).selectAll(".color-drop").call((t=>{t.attr("opacity",(t=>{let{key:e}=t;return a(e)})).attr("fill",r)})).attr("cx",(t=>{let{x:e}=t;return e*s.W.SPREAD_1_2})).attr("cy",(t=>{let{y:e}=t;return e*s.W.SPREAD_1_2}))}))}function A(t,e,a){const r=t.map((t=>e.groups.find((e=>e.key===t)))),n=[],o=r[0].height*s.W.SPREAD_1_2*.75;for(let s=0,i=r.length;s<i;s++){const t=2*Math.PI/i*(s-.5)-Math.PI/2;n.push([a[0]+Math.cos(t)*o,a[1]+Math.sin(t)*o])}return{groups:r,groupPositions:n}}function x(t,e){const a=[],r=[];for(let o=0;o<t.groups.length;o++){const n=t.groups[o],c=t.groupPositions[o],l=n.nodes.find((t=>t.key===e));r.push(l),a.push([l.x*s.W.SPREAD_1_2+c[0],l.y*s.W.SPREAD_1_2+c[1]-(0,i.jF)({rad:s.W.LOD_1_RAD_PX})])}const n=[];for(let o=0;o<a.length;o++){const t=Array.from(a[o]),e=Array.from(a[o+1==a.length?0:o+1]);(0,i.D5)([t,e],2*s.W.LOD_1_RAD_PX),n.push([t,e])}return[a,n,r]}function _(t,e,a){const[r,s]=t,o=a/15,i=a/10;n.select("#compare-group").select("#member-label").text("scenario").attr("font-size",o).transition().duration(100).attr("x",r).attr("y",s-1.5*o),n.select("#compare-group").select("#member-variable").attr("font-size",i).text(e).transition().duration(100).attr("x",r).attr("y",s)}function v(t,e){n.select("#compare-group").selectAll(".circlet").data(t).join("circle").attr("class","circlet").call(c.JB).attr("display","initial").attr("r",1.5*s.W.LOD_1_RAD_PX).transition().duration(100).attr("cx",(t=>t[0])).attr("cy",(t=>t[1])),n.select("#compare-group").selectAll(".comp-line").data(e).join("path").attr("class","comp-line").transition().duration(100).attr("d",(t=>n.line()(t)))}o=(l.then?(await l)():l)[0];const w={updateDropsSVG:g,updateColorDrops:y,getWaterdropGroups:A,calcLinesAndPositions:x,updateLabelSVG:_,updateScenIndicatorsSVG:v};r()}catch(d){r(d)}}))},7285:(t,e,a)=>{a.d(e,{_:()=>i});var r=a(5760),n=a(2385),s=a(9550),o=a(972);const i={updateSmallDropSVG:function(t,e,a,i){let{onClick:c,onHover:l,onUnhover:d}=i;const u={},h=t.selectAll(".small-drop").data(e.nodes).join((t=>t.append("g").each((function(t){r.select(this).call(function(t){let{levs:e,id:a}=t;return t=>{t.attr("class","small-drop hover-capture");const r="drop-fill-".concat(a);t.call((0,o.ji)(e,r)),t.append("path").attr("d",o.js).attr("class","outline"),t.append("path").attr("class","fill").attr("d",o.js).attr("fill","url(#".concat(r,")")),t.append("circle").attr("class","circlet interactive").call(o.JB).attr("cy",-(0,s.jF)({rad:1})).attr("r",1.5),t.append("rect").attr("class","bbox").style("visibility","hidden")}}(t))})))).attr("transform",(t=>{let{globalX:e,globalY:a,globalTilt:r}=t;return"translate(".concat(e,", ").concat(a,") rotate(").concat(r,")")})).each((function(t){r.select(this).call(function(t,e){let{key:a,levs:r,maxLev:s,id:i,x:c,y:l}=t;return t=>{"expl0000"===a&&(e.x=c,e.y=l),t.call((0,o.GI)(r,s)),t.select(".outline").attr("transform","scale(".concat(.95*n.W.LOD_1_RAD_PX,")")),t.select(".fill").attr("transform","scale(".concat(n.W.LOD_1_RAD_PX,")")),t.select(".circlet").attr("id","i".concat(i));const d=t.select(".fill").node().getBBox();t.select(".bbox").attr("x",d.x).attr("y",d.y).attr("width",d.width).attr("height",d.height)}}(t,u))}));c&&h.on("click",(function(t,e){c(e)})),l&&h.on("mouseenter",(function(t,e){l(e)})),d&&h.on("mouseleave",(function(t,e){d(e)})),h.transition().delay(a).duration(1e3).attr("transform",(t=>{let{x:a,y:r,tilt:s}=t;return"translate(".concat(e.x+a*n.W.SPREAD_1_2,", ").concat(e.y+r*n.W.SPREAD_1_2,") rotate(").concat(s,")")})),t.select(".highlight-circle").attr("stroke","none").attr("fill","yellow").attr("r",2*n.W.LOD_1_RAD_PX).attr("cx",e.x+u.x).attr("cy",e.y+u.y-(0,s.jF)({rad:n.W.LOD_1_RAD_PX})).attr("cx",e.x+u.x*n.W.SPREAD_1_2).attr("cy",e.y+u.y*n.W.SPREAD_1_2-(0,s.jF)({rad:n.W.LOD_1_RAD_PX}))},updateColorDrops:function(t,e,a,r){t.selectAll(".color-drop").data(e.nodes).join("circle").attr("class","color-drop").attr("r",n.W.LOD_1_RAD_PX).attr("opacity",(t=>{let{key:e}=t;return a(e)})).attr("fill",r).attr("cx",(t=>{let{x:a}=t;return e.x+a*n.W.SPREAD_1_2})).attr("cy",(t=>{let{y:a}=t;return e.y+a*n.W.SPREAD_1_2}))}}},3097:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.d(e,{_:()=>w});var n=a(5760),s=a(3693),o=a(4082),i=a(2385),c=a(9550),l=a(4956),d=a(972),u=t([s,o]);function p(){const t=n.select(this);t.append("circle").attr("class","hover-capture").attr("fill","transparent").attr("stroke-width",0).attr("r",.8),t.append("circle").attr("class","circlet interactive").call(d.JB).attr("r",1);const e=t.append("g").attr("pointer-events","none");e.append("image").attr("href","glow.png").attr("preserveAspectRatio","none").attr("opacity",.8),e.append("text").attr("class","fancy-font cloud-text").attr("text-anchor","middle").attr("font-size",0)}function m(t){n.select(this).select(".circlet").attr("id","b".concat(t.key)),n.select(this).select("text").call(f(t))}function f(t){return function(e){e.selectAll("*").remove();const a=(0,l.LV)(s.G[t.key].display_name||s.G[t.key].id).split("\n");a.forEach(((t,r)=>{e.append("tspan").attr("x",0).attr("y","".concat(-a.length/2+.5,"em")).attr("dy","".concat(r,"em")).text(t)}))}}function g(t){let{x:e,y:a,height:r}=t;return"translate(".concat(e,", ").concat(a-(0,c.jF)({height:r}),") scale(").concat(r*i.W.GROUP_HOVER_AREA_FACTOR,")")}function y(t,e,a,r){const s=window.innerHeight/9,o=a/r/e;return((i=t*o)>s?0:n.scaleLinear().domain([0,s]).range([1,.4]).clamp(!0)(i))*Math.min(o,.4);var i}function A(){const t=n.select("#minimap").attr("width",200).attr("height",250),e=n.geoMercator().scale(1e3).center(o.l.CALIFORNIA_CENTER).translate([100,125]),a=[...o.l.SPATIAL_DATA.features.filter((t=>"MultiPolygon"===t.geometry.type)),o.l.CALIFORNIA_OUTLINE],r=o.l.SPATIAL_DATA.features.filter((t=>"MultiPoint"===t.geometry.type));t.selectAll("path").data(a).join("path").attr("d",(t=>n.geoPath().projection(e)(t))).attr("class",(t=>"outline "+t.properties.CalLiteID)).attr("stroke",(t=>t.properties.CalLiteID?"transparent":"gray")).attr("stroke-width",1).attr("fill","transparent"),t.selectAll("circle").data(r).join("circle").each((function(t){const a=n.select(this),[r,s]=e(t.geometry.coordinates[0]);a.attr("cx",r),a.attr("cy",s)})).attr("r",2).attr("class",(t=>"outline "+t.properties.CalLiteID)).attr("fill","transparent")}function x(t,e,a){let{onClick:r,onHover:s,onUnhover:o}=a;const i=t.selectAll(".large-drop").data(e.groups,(t=>{let{key:e}=t;return e})).join((t=>t.append("g").attr("class","large-drop").each(p))).each(m).attr("transform",g).select(".hover-capture");r&&i.on("click",(function(t,e){r(e)})),s&&i.on("mouseenter",(function(t,e){n.select(this.parentNode).raise(),s(e)})),o&&i.on("mouseleave",(function(t,e){o(e)}))}function _(t,e,a){return function(){const r=n.select(this).node(),[s,o]=(0,c.kt)(r.getBoundingClientRect()),i=r.getBBox().width*e.height/e.far*8,l=r.getBBox().height*e.height/e.far*10,d=(0,c.xg)([s,o],[t.mouseX,t.mouseY]);n.select(this).attr("font-size",y(d,t.zoom,e.height,a)),n.select(this.parentNode.parentNode).select("image").attr("x",-i/2).attr("y",-l/2).attr("width",i).attr("height",l)}}function v(t,e,a,r){const s=n.timer((n=>{const o=Math.min(1,n/r);t.updateVisibility(1-o),t.updateOutlineVisibility(a*(1-o)),o>=1&&(s.stop(),t.remove(e))}))}[s,o]=u.then?(await u)():u;const w={drawMinimapSVG:A,updateLargeDropSVG:x,fontSizer:_,fadeOutDrops:v};r()}catch(h){r(h)}}))},4632:t=>{t.exports=JSON.parse('{"DEL_CVP_PAG_N":[26.54089666666667,490.70107158333343,480.75046199999997,0,468.9617508333333,199.5198665,489.89867966666674,481.6847633333334,0,120.97622208333335,0,0,0,0,180.30283060833335,316.29179825,316.83403416666664,483.4566109,329.81390833333336,487.17027625,461.43429475,482.1430833333333,483.63599412499997,207.81874266666668,453.9334891583333,490.4804715833333,422.7423296,436.1324621666667,433.7844246,361.6409625833333,484.7514305833334,489.5871041666666,488.4329391666666,489.6914116666667,455.19454633333334,490.0523268333333,476.7778382083334,468.43751208333333,485.5361188333334,244.1499304833333,444.1810591666667,483.67302166666667,472.9301945833334,312.4230875,473.8236858333334,490.5980725,466.7899811,448.7265694833333,489.7991575083333,400.1564136333334,490.22321202500007,440.74410320833334,488.2565359999999,489.3695789583333,484.15396029999994,150.13043305,0.71402925,488.86027000000007,482.79008058333335,482.96865791666664,485.8787025,456.29388666666665,470.3546516666667,485.9276427500001,453.37263583333333,274.92257075,286.98769918333335,108.79428633333333,281.8710843,43.742478866666666,0.11097172500000001,66.48312043833333,484.7076083333333,308.92389633333335,486.2882788333334,476.31413649999996,480.2372991666666,440.2352195833333,489.7679016666666,475.3977978916668,241.44484506666663,488.4416048333333,613.6564777777778],"DEL_CVP_PRF_S":[691.6617766666667,387.6919421666667,387.6919421666667,295.6181188333333,382.5381216666667,387.6919421666667,387.6919421666667,385.3365983333333,387.6919421666667,387.6919421666667,295.922771,290.54046175,290.7689505,290.7689505,382.5381216666667,387.38729000000006,387.6919421666667,387.6919421666667,383.2639863333334,385.3365983333333,387.6919421666667,387.6919421666667,387.6919421666667,387.38729000000006,387.6919421666667,387.6919421666667,387.6919421666667,387.38729000000006,387.6919421666667,387.6919421666667,387.6919421666667,387.38729000000006,387.6919421666667,387.6919421666667,387.6919421666667,387.38729000000006,387.6919421666667,387.6919421666667,383.2639863333334,387.38729000000006,387.6919421666667,387.6919421666667,387.6919421666667,387.38729000000006,387.6919421666667,383.2639863333334,387.6919421666667,387.38729000000006,387.6919421666667,385.6412505,387.6919421666667,387.38729000000006,387.6919421666667,387.6919421666667,387.6919421666667,387.38729000000006,295.922771,382.5381216666667,387.6919421666667,387.38729000000006,387.6919421666667,387.6919421666667,387.6919421666667,387.38729000000006,387.6919421666667,387.6919421666667,387.6919421666667,387.38729000000006,387.6919421666667,387.6919421666667,295.922771,290.54046175,382.5381216666667,295.922771,382.5381216666667,387.38729000000006,385.6412505,387.6919421666667,387.6919421666667,387.38729000000006,387.6919421666667,387.6919421666667,286.368664]}')}}]);
//# sourceMappingURL=805.4d1b0220.chunk.js.map