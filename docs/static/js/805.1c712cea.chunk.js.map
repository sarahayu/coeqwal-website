{"version":3,"file":"static/js/805.1c712cea.chunk.js","mappings":"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","sources":["App.jsx","AppContext.jsx","bucket-lib/bucket-glyph.js","bucket-lib/utils.js","components/ActionButtons.jsx","components/BucketCreationGraphics.jsx","components/BucketGlyph.jsx","components/CallToExploreSection.jsx","components/CardBBox.jsx","components/CompareBigDroplets.jsx","components/CompareBucketCreationsBackground.jsx","components/CompareBucketCreationsGraphics.jsx","components/CompareBucketCreationsText.jsx","components/CompareScenariosGraphics.jsx","components/ConnectLine.jsx","components/DataStoryScrollama.jsx","bucket-lib/quantile-bins.js","components/DotHistogram.jsx","components/DropletGlyph.jsx","components/MainWaterdropGraphics.jsx","components/MapCalifornia.jsx","components/SceneSettingStickers.jsx","components/SceneSettingSubcard.jsx","components/SkipBtn.jsx","components/TutHero.jsx","components/VariationWaterdropGraphics.jsx","data/descriptions-data.jsx","data/descriptions-tutorial-data.jsx","data/objectives-data.jsx","data/objectives-tutorial-data.jsx","data/spatial-data.jsx","hooks/useAppState.jsx","hooks/useCompareLargeDrops.jsx","hooks/useDataStory.jsx","hooks/useDataStoryVars.jsx","hooks/useDragPanels.jsx","settings.jsx","utils/three-utils.jsx","three-resources.jsx","utils/compareview-helpers.jsx","utils/data-story-anims.jsx","utils/data-utils.jsx","utils/examineview-helpers.jsx","utils/math-utils.jsx","utils/misc-utils.jsx","utils/render-utils.jsx","utils/story-scripts.jsx","utils/tutorialview-utils.jsx","utils/waterdrop-utils.jsx","utils/wideview-helpers.jsx","views/CompareView.jsx","views/ExamineView.jsx","views/TutorialView.jsx","views/WideView.jsx"],"sourcesContent":["import React from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport WideView from \"views/WideView\";\r\nimport ExamineView from \"views/ExamineView\";\r\nimport TutorialView from \"views/TutorialView\";\r\nimport CompareView from \"views/CompareView\";\r\n\r\nimport useAppState from \"hooks/useAppState\";\r\n\r\nexport default function App() {\r\n  const appState = useAppState();\r\n\r\n  return (\r\n    <AppContext.Provider value={appState}>\r\n      <div className=\"bubbles-wrapper\">\r\n        <div id=\"mosaic-webgl\"></div>\r\n        <svg id=\"mosaic-svg\">\r\n          <g className=\"svg-trans\"></g>\r\n        </svg>\r\n      </div>\r\n      <TutorialView />\r\n      <WideView />\r\n      <ExamineView />\r\n      <CompareView />\r\n      {appState.goBack && (\r\n        <button className=\"go-back-btn\" onClick={appState.goBack}>\r\n          <span></span>\r\n        </button>\r\n      )}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n","import { createContext } from \"react\";\r\n\r\nexport const AppContext = createContext({});\r\n","import * as d3 from \"d3\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LINE_WIDTH = 3;\r\n\r\nlet maskCounter = 0;\r\n\r\n// ensures every mask id is unique\r\nfunction getMaskId() {\r\n  return maskCounter++;\r\n}\r\n\r\nfunction bucketGlyph(width, height, valueToLevelFn = d3.scaleLinear()) {\r\n  return function (data) {\r\n    return data.map((d) => ({\r\n      x: -width,\r\n      y: height - valueToLevelFn(d) * height - height / 2,\r\n      width: width * 2,\r\n      height: height * 2,\r\n    }));\r\n  };\r\n}\r\n\r\nfunction transitionSway(rects, multiplier = 1) {\r\n  // save previous value; we'll need it to calculate how much to sway between renders\r\n  rects.each(function (d) {\r\n    const s = d3.select(this);\r\n    const prevLevel = s.attr(\"cur-level\") || 0;\r\n\r\n    s.attr(\"prev-level\", prevLevel);\r\n    s.attr(\"cur-level\", d.y);\r\n  });\r\n\r\n  rects\r\n    .transition(\"liquidSway\")\r\n    .duration(2000)\r\n    .delay((_, i) => i * 10)\r\n    .ease(d3.easeQuad)\r\n    .attrTween(\"transform\", function (d, i) {\r\n      const s = d3.select(this);\r\n      const prevLiquidLevel = parseFloat(s.attr(\"prev-level\"));\r\n      const diff = (Math.abs(prevLiquidLevel - d.y) / 200) * multiplier;\r\n      return (t) =>\r\n        `rotate(${\r\n          Math.sin(\r\n            Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n          ) *\r\n          diff *\r\n          DEGREE_SWAY *\r\n          (1 - t)\r\n        }, ${0}, ${0})`;\r\n    });\r\n\r\n  const levelTransition = rects\r\n    .transition(\"liquidLevel\")\r\n    .ease(d3.easeElasticOut.period(0.6))\r\n    .delay((_, i) => i * (100 / rects.size()))\r\n    .duration(1000);\r\n\r\n  return levelTransition;\r\n}\r\n\r\nfunction bucketShape(\r\n  width,\r\n  height,\r\n  shapeFunc = drawBucketMask,\r\n  shapeOutlineFunc = shapeFunc\r\n) {\r\n  return function (s) {\r\n    const id = getMaskId();\r\n\r\n    s.append(\"defs\")\r\n      .attr(\"class\", \"clip-def\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    s.append(\"g\")\r\n      .attr(\"class\", \"masked-area\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${height / 2})`)\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${height / 2})`)\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n\r\n    s.call(\r\n      bucketShapeMask({\r\n        drawFunc: shapeFunc,\r\n        drawOutlineFunc: shapeOutlineFunc,\r\n        width,\r\n        height,\r\n      })\r\n    );\r\n  };\r\n}\r\n\r\nfunction bucketShapeMask({\r\n  drawFunc,\r\n  drawOutlineFunc = drawFunc,\r\n  width,\r\n  height,\r\n}) {\r\n  return function (s) {\r\n    const getPath = (fn) => {\r\n      const path = d3.path();\r\n      fn(path, width, height);\r\n      return path.toString();\r\n    };\r\n\r\n    s.select(\".bucket-mask-path\").attr(\"d\", getPath(drawFunc));\r\n    s.select(\".bucket-outline\").attr(\"d\", getPath(drawOutlineFunc));\r\n  };\r\n}\r\n\r\nfunction drawBucketMask(context, width, height) {\r\n  drawBucket(context, width, height, true);\r\n}\r\n\r\nfunction drawBucketOutline(context, width, height) {\r\n  drawBucket(context, width, height, false);\r\n}\r\n\r\nfunction drawBucket(context, width, height, closed) {\r\n  const taper = 0.8;\r\n  const bottomRight = (width * taper) / 2,\r\n    bottomLeft = -(width * taper) / 2;\r\n\r\n  context.moveTo(width / 2, -height / 2);\r\n  context.lineTo(bottomRight, height / 2);\r\n  context.lineTo(bottomLeft, height / 2);\r\n  context.lineTo(-width / 2, -height / 2);\r\n\r\n  if (closed) context.closePath();\r\n}\r\n\r\nfunction drawDroplet(context, width, height) {\r\n  const hypToRad = Math.SQRT2;\r\n\r\n  // dimensions in \"rad\" units\r\n  const dropHeight = 1 + 1 * hypToRad;\r\n\r\n  const radToHeight = 1 / dropHeight;\r\n\r\n  const rad = Math.min(width / 2, height * radToHeight);\r\n  const hyp = rad / (1 / hypToRad);\r\n  const heightActual = rad + hyp;\r\n\r\n  context.moveTo(0, -heightActual / 2);\r\n  context.lineTo(hyp / 2, -heightActual / 2 + hyp / 2);\r\n  context.arc(0, -heightActual / 2 + hyp, rad, -Math.PI / 4, (Math.PI * 5) / 4);\r\n  context.closePath();\r\n}\r\n\r\nexport {\r\n  bucketGlyph,\r\n  transitionSway,\r\n  bucketShape,\r\n  bucketShapeMask,\r\n  drawBucketMask,\r\n  drawBucketOutline,\r\n  drawDroplet,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport { drawBucketMask } from \"./bucket-glyph\";\r\n\r\nfunction distributeQuantiles(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\nconst interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n\r\nfunction levelToDropletLevel(p) {\r\n  p -= 0.0088;\r\n  return Math.min(\r\n    1,\r\n    Math.max(\r\n      0,\r\n      (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326\r\n    )\r\n  );\r\n}\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nfunction ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nfunction bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  const getPath = (fn) => {\r\n    const path = d3.path();\r\n    fn(path, width, height);\r\n    return path.toString();\r\n  };\r\n\r\n  return getPath(drawBucketMask);\r\n}\r\n\r\nfunction collideOffsetter(data, size) {\r\n  const isTooClose = (i) => {\r\n    if (i == 0) return false;\r\n    return Math.abs(data[i - 1].y - data[i].y) < size;\r\n  };\r\n\r\n  let curXOffset = 0;\r\n\r\n  const xOffset = (i) => {\r\n    if (isTooClose(i)) return ++curXOffset * -3;\r\n    return (curXOffset = 0);\r\n  };\r\n\r\n  return xOffset;\r\n}\r\n\r\nexport {\r\n  distributeQuantiles,\r\n  interpolateWatercolorBlue,\r\n  levelToDropletLevel,\r\n  WATERDROP_ICON,\r\n  ticksExact,\r\n  bucketPath,\r\n  collideOffsetter,\r\n};\r\n","import { BiCross, BiNetworkChart } from \"react-icons/bi\";\nimport { isState } from \"utils/misc-utils\";\n\nexport function ActionButtons({\n    appCtx, handleClickExamine, handleClickDeselectAll, handleClickCompare,\n}) {\n    let examineBtn, compareBtn;\n\n    if (isState(appCtx.state, \"WideView\") && appCtx.activeWaterdrops.length) {\n        if (appCtx.activeWaterdrops.length === 1) {\n            examineBtn = (\n                <button\n                    onClick={handleClickExamine}\n                    className=\"wide-view-action-btn fancy-font\"\n                >\n                    <BiCross />\n                    <span>examine</span>\n                </button>\n            );\n        } else {\n            compareBtn = (\n                <>\n                    <button\n                        onClick={handleClickCompare}\n                        className=\"wide-view-action-btn fancy-font\"\n                    >\n                        <BiNetworkChart />\n                        <span>compare</span>\n                    </button>\n                    <button\n                        onClick={handleClickDeselectAll}\n                        className=\"fancy-font supplement-btn\"\n                    >\n                        <span>deselect all</span>\n                    </button>\n                </>\n            );\n        }\n    }\n\n    return (\n        <>\n            {examineBtn}\n            {compareBtn}\n        </>\n    );\n}\n","import React from \"react\";\nimport BucketGlyph from \"components/BucketGlyph\";\nimport { constants } from \"utils/tutorialview-utils\";\n\nexport function BucketCreationGraphics({ id, bucketInterper, label }) {\n    return (\n        <div className=\"tut-graph\">\n            <svg id={id}></svg>\n            <BucketGlyph\n                levelInterp={bucketInterper}\n                width={300}\n                height={constants.BAR_CHART_HEIGHT}\n                resolution={4} />\n            <p className=\"fancy-font objective-label\">{label}</p>\n        </div>\n    );\n}\n","import * as d3 from \"d3\";\r\nimport { useLayoutEffect, useRef } from \"react\";\r\n\r\nimport {\r\n  bucketGlyph,\r\n  bucketShape,\r\n  drawBucketMask,\r\n  drawBucketOutline,\r\n  transitionSway,\r\n} from \"bucket-lib/bucket-glyph\";\r\nimport {\r\n  collideOffsetter,\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n} from \"bucket-lib/utils\";\r\n\r\nconst LEVELS = 10;\r\n\r\nconst PERCENTILE_LABELS = [\r\n  \"Maximum\",\r\n  \"75th Percentile\",\r\n  \"50th Percentile\",\r\n  \"25th Percentile\",\r\n  \"Minimum\",\r\n];\r\n\r\nexport default function BucketGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const LINE_WIDTH = 3;\r\n  const GLYPH_MARGIN = {\r\n    top: 30,\r\n    right: LINE_WIDTH / 2,\r\n    bottom: 30,\r\n    left: 180,\r\n  };\r\n\r\n  const svgElement = useRef();\r\n\r\n  useLayoutEffect(function initialize() {\r\n    const svgContainer = svgElement.current\r\n      .attr(\"width\", width + GLYPH_MARGIN.left + GLYPH_MARGIN.right)\r\n      .attr(\"height\", height + GLYPH_MARGIN.top + GLYPH_MARGIN.bottom)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${GLYPH_MARGIN.left},${GLYPH_MARGIN.top})`);\r\n\r\n    svgContainer.call(\r\n      bucketShape(width, height, drawBucketMask, drawBucketOutline)\r\n    );\r\n  }, []);\r\n\r\n  useLayoutEffect(\r\n    function onDataChange() {\r\n      const liquidLevels = ticksExact(0, 1, resolution + 1).map((d) =>\r\n        levelInterp(d)\r\n      );\r\n\r\n      const glyph = bucketGlyph(width, height);\r\n      const data = glyph(liquidLevels);\r\n\r\n      const liquids = svgElement.current\r\n        .select(\".masked-area\")\r\n        .selectAll(\".bucket-box\")\r\n        .data(data)\r\n        .join(\"rect\")\r\n        .attr(\"class\", \"bucket-box\")\r\n        .attr(\"width\", (d) => d.width)\r\n        .attr(\"height\", (d) => d.height)\r\n        .attr(\"x\", (d) => d.x)\r\n        .attr(\"fill\", (_, i) => colorInterp(i / resolution));\r\n\r\n      transitionSway(liquids, 200 / height).attr(\"y\", (d) => d.y);\r\n\r\n      // percentile labels that appear on the side\r\n      const reverseData = data.reverse();\r\n\r\n      const labelWidth = 170,\r\n        labelHeight = 30;\r\n\r\n      const xOffset = collideOffsetter(reverseData, labelHeight);\r\n\r\n      const tagElem = (s) =>\r\n        s.append(\"g\").call((s) => {\r\n          s.append(\"rect\");\r\n          s.append(\"text\");\r\n        });\r\n\r\n      const labels = svgElement.current\r\n        .select(\".graph-area\")\r\n        .selectAll(\".bucket-label\")\r\n        .data(reverseData)\r\n        .join(tagElem)\r\n        .attr(\"class\", \"bucket-label\")\r\n        .transition()\r\n        .attr(\r\n          \"transform\",\r\n          (d, i) =>\r\n            `translate(${-labelWidth / 2 - 3 + xOffset(i)}, ${\r\n              d.y + height / 2\r\n            })`\r\n        );\r\n\r\n      labels\r\n        .select(\"text\")\r\n        .text((_, i) => PERCENTILE_LABELS[data.length - 1 - i])\r\n        .style(\"fill\", (_, i) => (i > data.length / 2 ? \"black\" : \"white\"));\r\n\r\n      labels\r\n        .select(\"rect\")\r\n        .attr(\"width\", labelWidth)\r\n        .attr(\"height\", labelHeight)\r\n        .attr(\"x\", -labelWidth / 2)\r\n        .attr(\"y\", -labelHeight / 2)\r\n        .attr(\"rx\", 8)\r\n        .style(\"fill\", (_, i) =>\r\n          colorInterp((data.length - 1 - i) / resolution)\r\n        );\r\n    },\r\n    [levelInterp]\r\n  );\r\n\r\n  return (\r\n    <div className=\"bucket-wrapper\">\r\n      <svg ref={(e) => void (svgElement.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\n\nexport function CallToExploreSection({ onClick }) {\n    return (\n        <div className=\"cte\">\n            <div className=\"cte-container\">\n\n                Thus, tradeoffs must often be made when managing California's water\n                supply. What are the ways we can manage California's water, and how do\n                their outcomes compare? Go to the next step to find out!\n                <button className=\"fancy-font\" onClick={onClick}>\n                    click to explore!\n                </button>\n            </div>\n        </div>\n    );\n}\n","import React, { forwardRef } from \"react\";\n\nexport const CardBBox = forwardRef(function CardBBox({ id, children }, ref) {\n  return (\n    <div id={id} ref={ref} className=\"tut-text-card-wrapper\">\n      <div className=\"tut-text-card\">\n        <div className=\"tut-text-card-container\">{children}</div>\n      </div>\n    </div>\n  );\n});\n","import React from \"react\";\n\nexport function CompareBigDroplets() {\n  return (\n    <div className=\"tut-comparer-graphics-wrapper\">\n      <p className=\"bigdrop-describe\">\n        These are all possible scenarios sorted bottom-to-top by decreasing\n        average deliveries.\n      </p>\n      <svg id=\"comparer-graphics\"></svg>\n    </div>\n  );\n}\n","import React from \"react\";\nimport { CompareBucketCreationsGraphics } from \"components/CompareBucketCreationsGraphics\";\nimport { CompareBucketCreationsText } from \"components/CompareBucketCreationsText\";\n\nexport function CompareBucketCreationsBackground({ appCtx, storyVars }) {\n    return (\n        <>\n            <div className=\"create-buckets-section\">\n                <CompareBucketCreationsText />\n                <CompareBucketCreationsGraphics\n                    storyVars={storyVars}\n                    size={appCtx.appHeight * 0.4} />\n            </div>\n        </>\n    );\n}\n","import React from \"react\";\nimport { constants } from \"utils/tutorialview-utils\";\nimport { descriptionsData } from \"data/descriptions-tutorial-data\";\nimport { BucketCreationGraphics } from \"components/BucketCreationGraphics\";\n\nexport function CompareBucketCreationsGraphics({ storyVars }) {\n    return (\n        <div className=\"tut-graph-wrapper\">\n            <BucketCreationGraphics\n                id={\"pag-bar-graph\"}\n                label={descriptionsData[constants.PAG_OBJECTIVE].display_name}\n                bucketInterper={storyVars.bucketInterperPAG} />\n            <BucketCreationGraphics\n                id={\"prf-bar-graph\"}\n                label={descriptionsData[constants.PRF_OBJECTIVE].display_name}\n                bucketInterper={storyVars.bucketInterperPRF} />\n        </div>\n    );\n}\n","import React from \"react\";\n\nexport function CompareBucketCreationsText() {\n  return (\n    <>\n      <h2>From Bar Graphs to Buckets</h2>\n      <p>\n        This is the average yearly amount of water each group receives,\n        specifically from the <b>Central Valley Project</b>, one of two water\n        municipalities in California.\n      </p>\n      <ul className=\"ag-annot\">\n        <li>higher water supply</li>\n        <li>but more likely to be around 300-500 TAF</li>\n      </ul>\n      <ul className=\"ref-annot\">\n        <li>consistently lower water supply</li>\n      </ul>\n    </>\n  );\n}\n","import React from \"react\";\nimport { constants } from \"utils/tutorialview-utils\";\nimport { descriptionsData } from \"data/descriptions-tutorial-data\";\nimport { objectivesData } from \"data/objectives-tutorial-data\";\nimport { VariationWaterdropGraphics } from \"components/VariationWaterdropGraphics\";\nimport { MainWaterdropGraphics } from \"components/MainWaterdropGraphics\";\n\nexport function CompareScenariosGraphics({ storyVars, size }) {\n    return (\n        <div className=\"tut-drop-graphics-wrapper\">\n            <h2>Seeing Scenarios</h2>\n            <div className=\"waterdrop-graphics-wrapper\">\n                <MainWaterdropGraphics\n                    objectiveLabel={descriptionsData[constants.PAG_OBJECTIVE].display_name}\n                    dropInterper={storyVars.dropInterper}\n                    histData={constants.PAG_DELIVS}\n                    histRange={[0, objectivesData.MIN_MAXES[constants.PAG_OBJECTIVE][1]]}\n                    goal={storyVars.userGoal}\n                    setGoal={(newGoal) => {\n                        storyVars.setUserGoal(newGoal);\n                    }}\n                    size={size} />\n                <VariationWaterdropGraphics\n                    variations={constants.DROP_VARIATIONS.map((variation) => ({\n                        ...variation,\n                        interper: storyVars.variationInterpers[variation.idx],\n                        histData: constants.VARIATIONS_DELIVS[variation.idx],\n                    }))}\n                    goal={storyVars.userGoal}\n                    setGoal={(newGoal) => {\n                        storyVars.setUserGoal(newGoal);\n                    }}\n                    histRange={[0, objectivesData.MIN_MAXES[constants.PAG_OBJECTIVE][1]]}\n                    size={size} />\n            </div>\n        </div>\n    );\n}\n","import React from \"react\";\nimport { getConnectStyle } from \"utils/render-utils\";\n\nexport function ConnectLine({ connectLine }) {\n    return (\n        <div className=\"connect-line\" style={getConnectStyle(...connectLine)}>\n            <div className=\"connect-line-container\"></div>\n        </div>\n    );\n}\n","import * as d3 from \"d3\";\nimport React from \"react\";\nimport { Scrollama } from \"react-scrollama\";\n\nexport function DataStoryScrollama({ children }) {\n    const onStepEnter = async ({ data, direction, element }) => {\n        if (direction === \"up\") return;\n        data.animHandler?.do();\n    };\n\n    const onStepExit = async ({ data, direction, element }) => {\n        if (direction === \"down\") return;\n        data.animHandler?.undo();\n    };\n\n    const onStepProgress = async ({ data, direction, element, progress }) => {\n        d3.select(element)\n            .select(\"div\")\n            .style(\n                \"transform\",\n                `translateY(${(d3.scaleLinear().domain([0, 0.2, 0.8, 1]).range([200, 0, 0, 200]))(progress)}%)`\n            )\n            .style('opacity', `${(d3.scaleLinear().domain([0, 0.2, 0.8, 1]).range([0, 1, 1, 0]))(progress)}`)\n    };\n\n    return (\n        <Scrollama\n            offset={0.8}\n            onStepEnter={onStepEnter}\n            onStepExit={onStepExit}\n            onStepProgress={onStepProgress}\n            threshold={1}\n        >\n            {children}\n        </Scrollama>\n    );\n}\n","import * as d3 from \"d3\";\r\nimport { distributeQuantiles } from \"./utils\";\r\n\r\n// inclusive\r\nfunction ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nfunction quantileBins(\r\n  width,\r\n  height,\r\n  unitsPerQuantile = undefined,\r\n  range = undefined\r\n) {\r\n  return function (data) {\r\n    unitsPerQuantile = unitsPerQuantile || 1;\r\n    range = range || d3.extent(data);\r\n\r\n    const numQuantiles = data.length / unitsPerQuantile;\r\n    const histBins = d3\r\n      .bin()\r\n      .value((d) => d)\r\n      .domain(range)\r\n      .thresholds(\r\n        ticksExact(...range, Math.ceil(width / (height / numQuantiles)))\r\n      )(data);\r\n\r\n    const binnedQuantiles = distributeQuantiles(\r\n      histBins,\r\n      unitsPerQuantile,\r\n      numQuantiles\r\n    );\r\n\r\n    const quantiles = [];\r\n\r\n    for (let b = 0; b < binnedQuantiles.length; b++) {\r\n      for (let y = 0; y < binnedQuantiles[b]; y++) {\r\n        quantiles.push([\r\n          (histBins[b].x1 + histBins[b].x0) / 2,\r\n          ((y + 0.5) / numQuantiles) * data.length,\r\n        ]);\r\n      }\r\n    }\r\n\r\n    return quantiles;\r\n  };\r\n}\r\n\r\nexport { quantileBins };\r\n","import * as d3 from \"d3\";\r\nimport { useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport { quantileBins } from \"bucket-lib/quantile-bins\";\r\n\r\nimport { clamp } from \"utils/math-utils\";\r\n\r\nconst NUM_CIRCLES = 20;\r\nconst MARGIN = { top: 20, right: 20, bottom: 45, left: 20 };\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport default function DotHistogram({\r\n  data,\r\n  range = [0, d3.max(data)],\r\n  goal,\r\n  setGoal,\r\n  width = 600,\r\n  height = 400,\r\n  shortForm = false,\r\n}) {\r\n  const razorElement = useRef();\r\n  const razorAreaElement = useRef();\r\n\r\n  const svgSelector = useRef();\r\n  const circles = useMemo(\r\n    () => quantileBins(width, height, data.length / NUM_CIRCLES, range)(data),\r\n    [data]\r\n  );\r\n\r\n  const dataRange = [0, data.length];\r\n  const x = d3.scaleLinear().domain(range).range([0, width]);\r\n  const y = d3.scaleLinear().domain(dataRange).range([height, 0]);\r\n  const count = circles.filter((d) => d[0] > goal).length;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width + MARGIN.left + MARGIN.right)\r\n      .attr(\"height\", height + MARGIN.top + MARGIN.bottom)\r\n      .style(\"pointer-events\", \"none\")\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${MARGIN.left},${MARGIN.top})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(\r\n        d3\r\n          .axisBottom()\r\n          .scale(d3.scaleLinear().domain(range).range([0, width]))\r\n          .ticks(8)\r\n          .tickFormat(d3.format(\".2s\"))\r\n      )\r\n      .call((s) => {\r\n        s.selectAll(\"line\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"path\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"text\").attr(\"fill\", \"gray\");\r\n      })\r\n      .append(\"text\")\r\n      .attr(\"fill\", \"black\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${40})`)\r\n      .text(\"Delivery (TAF)\");\r\n\r\n    razorElement.current.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(range)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n\r\n    const ignoreFn = (e) => e.preventDefault();\r\n    let dragging = false;\r\n\r\n    razorElement.current.addEventListener(\"mousedown\", () => {\r\n      dragging = true;\r\n      window.addEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", () => {\r\n      dragging = false;\r\n      window.removeEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    razorAreaElement.current.addEventListener(\"mousemove\", (e) => {\r\n      if (dragging && e.target === razorAreaElement.current) {\r\n        const razorPos = clamp(e.offsetX, MARGIN.left, MARGIN.left + width);\r\n        d3.select(razorElement.current).style(\r\n          \"transform\",\r\n          `translateX(${razorPos}px)`\r\n        );\r\n\r\n        setGoal(\r\n          d3\r\n            .scaleLinear()\r\n            .domain([MARGIN.left, width + MARGIN.left])\r\n            .range(range)\r\n            .clamp(true)(e.offsetX)\r\n        );\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  useLayoutEffect(() => {\r\n    const svgCircles = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".icons\")\r\n      .data(circles)\r\n      .join((enter) => enter.append(\"g\").call((s) => s.append(\"path\")))\r\n      .attr(\"class\", \"icons\")\r\n      .call((s) => {\r\n        s.selectAll(\"path\").attr(\r\n          \"d\",\r\n          d3.symbol(WATERDROP_ICON, height / NUM_CIRCLES)\r\n        );\r\n      });\r\n\r\n    svgCircles\r\n      .attr(\"transform\", (d) => `translate(${x(d[0])},${y(d[1])})`)\r\n      .attr(\"fill\", (d) => (d[0] > goal ? \"steelblue\" : \"black\"));\r\n\r\n    razorElement.current.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(range)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n  }, [goal, circles]);\r\n\r\n  return (\r\n    <div\r\n      className={`dot-histogram-wrapper`}\r\n      ref={(e) => (razorAreaElement.current = e)}\r\n    >\r\n      <div\r\n        className={`pdf-razor ` + (shortForm ? \"short-form\" : \"\")}\r\n        ref={(e) => (razorElement.current = e)}\r\n      >\r\n        <div>\r\n          <span>\r\n            <u>\r\n              {circles.length - count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL NOT meet demand\"}\r\n          </span>\r\n          <span>\r\n            <u>\r\n              {count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL meet demand\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useLayoutEffect, useRef } from \"react\";\r\n\r\nimport {\r\n  bucketGlyph,\r\n  bucketShape,\r\n  drawDroplet,\r\n  transitionSway,\r\n} from \"bucket-lib/bucket-glyph\";\r\nimport {\r\n  interpolateWatercolorBlue,\r\n  levelToDropletLevel,\r\n  ticksExact,\r\n} from \"bucket-lib/utils\";\r\n\r\nconst LEVELS = 10;\r\n\r\nexport default function DropletGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const LINE_WIDTH = 3;\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  const svgElement = useRef();\r\n\r\n  useLayoutEffect(function initialize() {\r\n    const svgContainer = svgElement.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"bucket\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer.call(bucketShape(innerWidth, innerHeight, drawDroplet));\r\n  }, []);\r\n\r\n  useLayoutEffect(\r\n    function onDataChange() {\r\n      const liquidLevels = ticksExact(0, 1, resolution + 1).map((d) =>\r\n        levelInterp(d)\r\n      );\r\n\r\n      const glyph = bucketGlyph(innerWidth, innerHeight, levelToDropletLevel);\r\n\r\n      const liquids = svgElement.current\r\n        .select(\".masked-area\")\r\n        .selectAll(\".bucket-box\")\r\n        .data(glyph(liquidLevels))\r\n        .join(\"rect\")\r\n        .attr(\"class\", \"bucket-box\")\r\n        .attr(\"width\", (d) => d.width)\r\n        .attr(\"height\", (d) => d.height)\r\n        .attr(\"x\", (d) => d.x)\r\n        .attr(\"fill\", (_, i) => colorInterp(i / resolution));\r\n\r\n      transitionSway(liquids, 200 / height).attr(\"y\", (d) => d.y);\r\n    },\r\n    [levelInterp]\r\n  );\r\n\r\n  return (\r\n    <div className=\"waterdrop-wrapper\">\r\n      <svg ref={(e) => void (svgElement.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\nimport DropletGlyph from \"components/DropletGlyph\";\nimport DotHistogram from \"components/DotHistogram\";\n\nexport function MainWaterdropGraphics({\n    objectiveLabel, dropInterper, histData, histRange, goal, setGoal, size,\n}) {\n    return (\n        <>\n            <div className=\"main-waterdrop\">\n                <DropletGlyph\n                    levelInterp={dropInterper}\n                    width={size}\n                    height={size}\n                    resolution={4} />\n                <p className=\"var-scen-label\">\n                    scenario <span className=\"scen-number\">{\"0000\"}</span>\n                </p>\n                <p className=\"fancy-font objective-label\">{objectiveLabel}</p>\n                <p className=\"volume-not-height\">\n                    Water supply represented by volume of water inside droplet, not height\n                    of water level\n                </p>\n            </div>\n            <div className=\"main-histogram\">\n                <DotHistogram\n                    width={size}\n                    height={(size * 2) / 3}\n                    data={histData}\n                    range={histRange}\n                    goal={goal}\n                    setGoal={setGoal} />\n            </div>\n        </>\n    );\n}\n","import * as d3 from \"d3\";\nimport React, { useEffect } from \"react\";\nimport { constants } from \"utils/tutorialview-utils\";\nimport { spatialData } from \"data/spatial-data\";\n\nexport function MapCalifornia({ }) {\n    useEffect(function initialize() {\n        const height = window.innerHeight, width = height * 0.9;\n\n        const drawnRegions = [constants.PAG_OBJECTIVE, constants.PRF_OBJECTIVE];\n\n        const minimap = d3\n            .select(\"#tut-map-california\")\n            .attr(\"width\", width)\n            .attr(\"height\", height);\n\n        const proj = d3\n            .geoMercator()\n            .scale((3000 * height) / 800)\n            .center(spatialData.CALIFORNIA_CENTER)\n            .translate([width / 2, height / 2]);\n\n        const lineGeom = [\n            ...spatialData.SPATIAL_DATA.features.filter((f) => drawnRegions.includes(f.properties.CalLiteID)\n            ),\n            spatialData.CALIFORNIA_OUTLINE,\n        ];\n\n        minimap\n            .selectAll(\"path\")\n            .data(lineGeom)\n            .join(\"path\")\n            .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\n            .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\n            .attr(\"stroke\", 'transparent')\n            .attr(\"stroke-width\", 1)\n            .style(\"transform-origin\", (d) => {\n                const [x, y] = proj(d.geometry.coordinates[0][0][0]);\n\n                return `${x}px ${y}px`;\n            })\n            .attr(\"fill\", \"#EFEBE0\")\n            .style('filter', 'drop-shadow(6px 6px 18px rgba(0, 0, 0, 0.3))');\n\n        minimap\n            .select(`.${constants.PAG_OBJECTIVE}`)\n            .attr(\"fill\", constants.PAG_COLOR)\n            .raise();\n        minimap\n            .select(`.${constants.PRF_OBJECTIVE}`)\n            .attr(\"fill\", constants.PRF_COLOR).raise();\n    }, []);\n\n    return <svg className=\"tut-map-california\" id=\"tut-map-california\"></svg>;\n}\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport { SETT_DESC, SETT_NAME_FULL, SETT_VAL_STEPS } from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingStickers({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings comp-settings\">\r\n      {settings.map((v, i) => (\r\n        <div\r\n          className=\"full-card\"\r\n          onMouseEnter={() => setColorSetting(i)}\r\n          onMouseLeave={() => setColorSetting(null)}\r\n          key={i}\r\n          title={SETT_DESC[i]}\r\n        >\r\n          <span>{SETT_NAME_FULL[i]}</span>\r\n          <span>{SETT_VAL_STEPS[i][v]}</span>\r\n          <div className=\"sett-dot-wrapper\">\r\n            {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n              <span\r\n                className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport {\r\n  SETT_NAME_SHORT,\r\n  SETT_NAME_FULL,\r\n  SETT_VAL_STEPS,\r\n  SETT_DESC,\r\n} from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingSubcard({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings\">\r\n      <div className=\"condense\">\r\n        {settings.map((v, i) => (\r\n          <div className=\"sett-dot-wrapper\" key={i}>\r\n            <span>{SETT_NAME_SHORT[i]}</span>\r\n            {d3.range(v + 1).map((j) => (\r\n              <span\r\n                className=\"sett-dot\"\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"full\">\r\n        <div className=\"full-container\">\r\n          <span>The settings for this scenario are:</span>\r\n          {settings.map((v, i) => (\r\n            <div\r\n              className=\"full-card\"\r\n              onMouseEnter={() => setColorSetting(i)}\r\n              onMouseLeave={() => setColorSetting(null)}\r\n              key={i}\r\n              title={SETT_DESC[i]}\r\n            >\r\n              <span>{SETT_NAME_FULL[i]}</span>\r\n              <span>{SETT_VAL_STEPS[i][v]}</span>\r\n              <div className=\"sett-dot-wrapper\">\r\n                {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n                  <span\r\n                    className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                    key={j}\r\n                    style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n                  ></span>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\nimport React, { useEffect } from \"react\";\n\nexport function SkipBtn({ onClick }) {\n    useEffect(function mountFadeOutEffect() {\n        const startPos = document.documentElement.scrollTop;\n        const buffer = 50;\n\n        window.addEventListener(\"scroll\", function () {\n            const curPos = document.documentElement.scrollTop;\n            const opac = Math.max(0, 1 - (curPos - startPos) / buffer);\n\n            d3.select(\".skip-btn\").style(\"opacity\", opac);\n        });\n    }, []);\n    return (\n        <button className=\"skip-btn\" onClick={onClick}>\n            Skip intro\n        </button>\n    );\n}\n","import React from \"react\";\nimport { SkipBtn } from \"components/SkipBtn\";\nimport { MapCalifornia } from \"components/MapCalifornia\";\n\nexport function TutHero({ appCtx }) {\n    return (\n        <div className=\"tut-hero\">\n            <div className=\"tut-hero-container\">\n\n                <h1>\n                    Watering <br /> the Future\n                </h1>\n                <MapCalifornia />\n                <p>\n                    Water is limited in California, yet everyone needs it. So how can we\n                    deal with the agricultural, environmental, urban, and other water\n                    demands of California?\n                </p>\n                <p>\n                    To start off, we'll focus on two groups: the{\" \"}\n                    <span id=\"ag-group\">agriculture group in the north</span> and the{\" \"}\n                    <span id=\"ref-group\">refuge group in the south.</span>\n                </p>\n                <p>Scroll through this page to explore!</p>\n                <SkipBtn onClick={() => appCtx.setState({ state: \"WideView\" })} />\n            </div>\n        </div>\n    );\n}\n","import React from \"react\";\nimport DropletGlyph from \"components/DropletGlyph\";\nimport DotHistogram from \"components/DotHistogram\";\n\nexport function VariationWaterdropGraphics({\n    variations, goal, setGoal, histRange, size,\n}) {\n    return variations.map(({ idx, scen, clas, desc, interper, histData }) => (\n        <div className={`vardrop ${clas}`} key={idx} desc={desc}>\n            <DropletGlyph\n                levelInterp={interper}\n                width={size * 0.7}\n                height={size * 0.7}\n                resolution={4} />\n            <p className=\"var-scen-label\">\n                scenario <span className=\"scen-number\">{scen}</span>\n            </p>\n            <DotHistogram\n                shortForm\n                width={size}\n                height={(size * 2) / 3}\n                data={histData}\n                range={histRange}\n                goal={goal}\n                setGoal={setGoal} />\n        </div>\n    ));\n}\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initDescriptionsData() {\r\n  console.log(\"DATA: loading descriptions data\");\r\n\r\n  const objs = await (await fetch(\"./descriptions.json\")).json();\r\n\r\n  // any data preprocessing goes here. none for now.\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n}\r\n\r\nexport const descriptionsData = await initDescriptionsData();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initDescriptionsData() {\r\n  console.log(\"DATA: loading descriptions tutorial data\");\r\n\r\n  const objs = await (await fetch(\"./descriptions_tutorial.json\")).json();\r\n\r\n  // any data preprocessing goes here. none for now.\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n}\r\n\r\nexport const descriptionsData = await initDescriptionsData();\r\n","import * as d3 from \"d3\";\r\nimport { SETT_NUM_OPTS, deserialize } from \"utils/data-utils\";\r\n\r\nimport { shuffle } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst SCEN_DIVISOR = 1; // debugging purposes, don't render all scenarios to speed things up\r\n\r\nasync function initObjectivesData() {\r\n  const MAX_DELIVS = 1200;\r\n  const SCENARIO_KEY_STRING = \"scens\";\r\n  const DELIV_KEY_STRING = \"delivs\";\r\n  const BASELINE_SCEN = \"expl0000\";\r\n\r\n  const OBJECTIVES_DATA = await (async function load() {\r\n    console.log(\"DATA: loading objectives data\");\r\n\r\n    const objs = await (await fetch(\"./objectives_v3.json\")).json();\r\n\r\n    const chosenScenarios = objs[0][SCENARIO_KEY_STRING].filter(\r\n      (s, i) => i % SCEN_DIVISOR === 0 || s === \"expl0000\"\r\n    ).map(({ name }) => name);\r\n\r\n    for (const obj of objs) {\r\n      // shuffle so clusters of identical scenario results don't get processed deterministically\r\n      const shuffledScens = shuffle(obj[SCENARIO_KEY_STRING]);\r\n\r\n      // iterate backwards to remove unneeded scenarios\r\n      for (let i = shuffledScens.length - 1; i >= 0; i--) {\r\n        const scen = shuffledScens[i];\r\n\r\n        if (chosenScenarios.includes(scen.name)) {\r\n          // sort data since we'll be using ordered data for all our vizes\r\n          scen[DELIV_KEY_STRING].sort(d3.descending);\r\n        } else {\r\n          shuffledScens.splice(i, 1);\r\n        }\r\n      }\r\n\r\n      obj[SCENARIO_KEY_STRING] = mapBy(\r\n        obj[SCENARIO_KEY_STRING],\r\n        ({ name }) => name\r\n      );\r\n    }\r\n\r\n    return mapBy(objs, ({ obj }) => obj);\r\n  })();\r\n\r\n  const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\n  // set default goals to 0TAF, we may want to change this on a per-objective basis\r\n  const OBJECTIVE_GOALS_MAP = (function initDefaults() {\r\n    const goalMap = {};\r\n    for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n      goalMap[OBJECTIVE_IDS[i]] = 0;\r\n    return goalMap;\r\n  })();\r\n\r\n  const SCENARIO_IDS = Object.keys(\r\n    Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n  );\r\n\r\n  const KEY_SETTINGS_MAP = (function preprocessData() {\r\n    const map = {};\r\n    const optArr = Object.values(SETT_NUM_OPTS);\r\n\r\n    for (let i = 0; i < SCENARIO_IDS.length; i++) {\r\n      const key = SCENARIO_IDS[i];\r\n\r\n      map[key] = deserialize(key.slice(4)).map((v, i) => (v + 1) / optArr[i]);\r\n    }\r\n\r\n    return map;\r\n  })();\r\n\r\n  const MIN_MAXES = (function () {\r\n    const minmaxes = {};\r\n\r\n    for (const objective of OBJECTIVE_IDS) {\r\n      const baselineMax = d3.max(\r\n        OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][BASELINE_SCEN][\r\n          DELIV_KEY_STRING\r\n        ]\r\n      );\r\n\r\n      const scenariosMin = d3.min(\r\n        SCENARIO_IDS.map((scenario) =>\r\n          d3.min(\r\n            OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][scenario][\r\n              DELIV_KEY_STRING\r\n            ]\r\n          )\r\n        )\r\n      );\r\n\r\n      // minmaxes[objective] = [scenariosMin, baselineMax];\r\n      minmaxes[objective] = [0, baselineMax];\r\n    }\r\n\r\n    return minmaxes;\r\n  })();\r\n\r\n  // Flattening hierarchical data makes it more flexible for classifying.\r\n  // id conveniently corresponds to index.\r\n  // Also cache classifications (by objective and by scenario, for now).\r\n  // TODO: change flattened_data to an iterator type function?\r\n  const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n    const flattenedData = [];\r\n    const dataGroupings = {\r\n      objective: {},\r\n      scenario: {},\r\n    };\r\n\r\n    // for ordering later\r\n    const means = [];\r\n\r\n    let idx = 0;\r\n    for (const obj of OBJECTIVE_IDS) {\r\n      for (const scen of SCENARIO_IDS) {\r\n        if (!dataGroupings[\"objective\"][obj])\r\n          dataGroupings[\"objective\"][obj] = [];\r\n\r\n        if (!dataGroupings[\"scenario\"][scen])\r\n          dataGroupings[\"scenario\"][scen] = [];\r\n\r\n        dataGroupings[\"objective\"][obj].push(idx);\r\n        dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n        const deliveries =\r\n          OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n        flattenedData.push({\r\n          id: idx,\r\n          objective: obj,\r\n          scenario: scen,\r\n          deliveries,\r\n        });\r\n\r\n        means.push(d3.mean(deliveries));\r\n\r\n        idx++;\r\n      }\r\n    }\r\n\r\n    const orderedDataGroupings = {};\r\n\r\n    for (const criteria of Object.keys(dataGroupings)) {\r\n      const objScens = [];\r\n      for (const key of Object.keys(dataGroupings[criteria])) {\r\n        const ids = dataGroupings[criteria][key];\r\n        const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n        objScens.push({\r\n          key,\r\n          sorted: sortedObjScens,\r\n          mean: d3.mean(\r\n            ids\r\n              .map((id) => {\r\n                const deliveries = flattenedData[id].deliveries;\r\n                const maxVal = MIN_MAXES[flattenedData[id].objective][1];\r\n                return deliveries.map((delivery) => delivery / maxVal);\r\n              })\r\n              .flat()\r\n          ),\r\n        });\r\n      }\r\n\r\n      const sortedObjScens = objScens.sort((a, b) => b.mean - a.mean);\r\n\r\n      orderedDataGroupings[criteria] = {};\r\n\r\n      for (let i = 0; i < sortedObjScens.length; i++) {\r\n        const { key, sorted } = sortedObjScens[i];\r\n        const IDtoRank = {};\r\n\r\n        for (let j = 0; j < sorted.length; j++) {\r\n          IDtoRank[sorted[j]] = j;\r\n        }\r\n        orderedDataGroupings[criteria][key] = IDtoRank;\r\n        orderedDataGroupings[criteria][key].rank = i;\r\n      }\r\n    }\r\n\r\n    return [flattenedData, orderedDataGroupings];\r\n  })();\r\n\r\n  return {\r\n    MAX_DELIVS,\r\n    SCENARIO_KEY_STRING,\r\n    DELIV_KEY_STRING,\r\n    BASELINE_SCEN,\r\n    OBJECTIVES_DATA,\r\n    OBJECTIVE_IDS,\r\n    OBJECTIVE_GOALS_MAP,\r\n    SCENARIO_IDS,\r\n    KEY_SETTINGS_MAP,\r\n    MIN_MAXES,\r\n    FLATTENED_DATA,\r\n    DATA_GROUPINGS,\r\n  };\r\n}\r\n\r\nexport const objectivesData = await initObjectivesData();\r\n","import * as d3 from \"d3\";\r\nimport { SETT_NUM_OPTS, deserialize } from \"utils/data-utils\";\r\n\r\nimport { shuffle } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initObjectivesData() {\r\n  const MAX_DELIVS = 800;\r\n  const SCENARIO_KEY_STRING = \"scens\";\r\n  const DELIV_KEY_STRING = \"delivs\";\r\n  const BASELINE_YRLY_KEY_STRING = \"baseline_yearly\";\r\n  const BASELINE_SCEN = \"expl0000\";\r\n\r\n  const OBJECTIVES_DATA = await (async function load() {\r\n    console.log(\"DATA: loading objectives tutorial data\");\r\n\r\n    const objs = await (await fetch(\"./objectives_tutorial.json\")).json();\r\n\r\n    for (const obj of objs) {\r\n      // shuffle so clusters of identical scenario results don't get processed deterministically\r\n      for (const scen of shuffle(obj[SCENARIO_KEY_STRING])) {\r\n        // save the baseline yearly data, don't order it\r\n        if (scen[\"name\"] === BASELINE_SCEN) {\r\n          obj[BASELINE_YRLY_KEY_STRING] = Array.from(scen[DELIV_KEY_STRING]);\r\n        }\r\n\r\n        // sort data since we'll be using ordered data for all our vizes\r\n        scen[DELIV_KEY_STRING] = scen[DELIV_KEY_STRING].sort(d3.descending);\r\n      }\r\n      obj[SCENARIO_KEY_STRING] = mapBy(\r\n        obj[SCENARIO_KEY_STRING],\r\n        ({ name }) => name\r\n      );\r\n    }\r\n\r\n    return mapBy(objs, ({ obj }) => obj);\r\n  })();\r\n\r\n  const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\n  const OBJECTIVE_GOALS_MAP = (function initDefaults() {\r\n    const goalMap = {};\r\n    for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n      goalMap[OBJECTIVE_IDS[i]] = 200;\r\n    return goalMap;\r\n  })();\r\n\r\n  const SCENARIO_IDS = Object.keys(\r\n    Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n  );\r\n\r\n  const KEY_SETTINGS_MAP = (function preprocessData() {\r\n    const map = {};\r\n    const optArr = Object.values(SETT_NUM_OPTS);\r\n\r\n    for (let i = 0; i < SCENARIO_IDS.length; i++) {\r\n      const key = SCENARIO_IDS[i];\r\n\r\n      map[key] = deserialize(key.slice(4)).map((v, i) => (v + 1) / optArr[i]);\r\n    }\r\n\r\n    return map;\r\n  })();\r\n\r\n  const MIN_MAXES = (function () {\r\n    const minmaxes = {};\r\n\r\n    for (const objective of OBJECTIVE_IDS) {\r\n      const baselineMax = d3.max(\r\n        OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][BASELINE_SCEN][\r\n          DELIV_KEY_STRING\r\n        ]\r\n      );\r\n\r\n      const scenariosMin = d3.min(\r\n        SCENARIO_IDS.map((scenario) =>\r\n          d3.min(\r\n            OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][scenario][\r\n              DELIV_KEY_STRING\r\n            ]\r\n          )\r\n        )\r\n      );\r\n\r\n      // minmaxes[objective] = [scenariosMin, baselineMax];\r\n      minmaxes[objective] = [0, baselineMax];\r\n    }\r\n\r\n    return minmaxes;\r\n  })();\r\n\r\n  // Flattening hierarchical data makes it more flexible for classifying.\r\n  // id conveniently corresponds to index.\r\n  // Also cache classifications (by objective and by scenario, for now).\r\n  // TODO: change flattened_data to an iterator type function?\r\n  const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n    const flattenedData = [];\r\n    const dataGroupings = {\r\n      objective: {},\r\n      scenario: {},\r\n    };\r\n\r\n    // for ordering later\r\n    const means = [];\r\n\r\n    let idx = 0;\r\n    for (const obj of OBJECTIVE_IDS) {\r\n      for (const scen of SCENARIO_IDS) {\r\n        if (!dataGroupings[\"objective\"][obj])\r\n          dataGroupings[\"objective\"][obj] = [];\r\n\r\n        if (!dataGroupings[\"scenario\"][scen])\r\n          dataGroupings[\"scenario\"][scen] = [];\r\n\r\n        dataGroupings[\"objective\"][obj].push(idx);\r\n        dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n        const deliveries =\r\n          OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n        flattenedData.push({\r\n          id: idx,\r\n          objective: obj,\r\n          scenario: scen,\r\n          deliveries,\r\n        });\r\n\r\n        means.push(d3.mean(deliveries));\r\n\r\n        idx++;\r\n      }\r\n    }\r\n\r\n    const orderedDataGroupings = {};\r\n\r\n    for (const criteria of Object.keys(dataGroupings)) {\r\n      const objScens = [];\r\n      for (const key of Object.keys(dataGroupings[criteria])) {\r\n        const ids = dataGroupings[criteria][key];\r\n        const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n        objScens.push({\r\n          key,\r\n          sorted: sortedObjScens,\r\n          mean: d3.mean(ids.map((id) => flattenedData[id].deliveries).flat()),\r\n        });\r\n      }\r\n\r\n      const sortedObjScens = objScens.sort((a, b) => b.mean - a.mean);\r\n\r\n      orderedDataGroupings[criteria] = {};\r\n\r\n      for (let i = 0; i < sortedObjScens.length; i++) {\r\n        const { key, sorted } = sortedObjScens[i];\r\n        const IDtoRank = {};\r\n\r\n        for (let j = 0; j < sorted.length; j++) {\r\n          IDtoRank[sorted[j]] = j;\r\n        }\r\n        orderedDataGroupings[criteria][key] = IDtoRank;\r\n        orderedDataGroupings[criteria][key].rank = i;\r\n      }\r\n    }\r\n\r\n    return [flattenedData, orderedDataGroupings];\r\n  })();\r\n\r\n  return {\r\n    MAX_DELIVS,\r\n    SCENARIO_KEY_STRING,\r\n    DELIV_KEY_STRING,\r\n    BASELINE_YRLY_KEY_STRING,\r\n    BASELINE_SCEN,\r\n    OBJECTIVES_DATA,\r\n    OBJECTIVE_IDS,\r\n    OBJECTIVE_GOALS_MAP,\r\n    SCENARIO_IDS,\r\n    KEY_SETTINGS_MAP,\r\n    MIN_MAXES,\r\n    FLATTENED_DATA,\r\n    DATA_GROUPINGS,\r\n  };\r\n}\r\n\r\nexport const objectivesData = await initObjectivesData();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initSpatialData() {\r\n  const SPATIAL_DATA = await (async function load() {\r\n    console.log(\"DATA: loading callite spatial data\");\r\n\r\n    const objs = await (await fetch(\"./callite_spatial.json\")).json();\r\n\r\n    // any data preprocessing goes here. none for now.\r\n\r\n    return objs;\r\n  })();\r\n\r\n  const SPATIAL_FEATURES = (function () {\r\n    return mapBy(\r\n      SPATIAL_DATA.features,\r\n      ({ properties }) => properties.CalLiteID\r\n    );\r\n  })();\r\n\r\n  const CALIFORNIA_OUTLINE = await (async function load() {\r\n    console.log(\"DATA: loading california spatial data\");\r\n\r\n    const objs = await (await fetch(\"./california.json\")).json();\r\n\r\n    // any data preprocessing goes here. none for now.\r\n\r\n    return objs;\r\n  })();\r\n\r\n  const CALIFORNIA_CENTER = [-119, 37.7749];\r\n\r\n  return {\r\n    SPATIAL_DATA,\r\n    SPATIAL_FEATURES,\r\n    CALIFORNIA_OUTLINE,\r\n    CALIFORNIA_CENTER,\r\n  };\r\n}\r\n\r\nexport const spatialData = await initSpatialData();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { threeResources } from \"three-resources\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { initWaterdrops } from \"utils/waterdrop-utils\";\r\n\r\nconst appWidth = window.innerWidth,\r\n  appHeight = window.innerHeight;\r\nconst waterdrops = initWaterdrops(\r\n  objectivesData,\r\n  descriptionsData,\r\n  \"objective\"\r\n);\r\n\r\nexport default function useAppState() {\r\n  const [state, setState] = useState({});\r\n  const [activeWaterdrops, setActiveWaterdrops] = useState([]);\r\n  const [goBack, setGoBack] = useState(null);\r\n  const [goals, setGoals] = useState(objectivesData.OBJECTIVE_GOALS_MAP);\r\n\r\n  const zoomCallbacksRef = useRef([]);\r\n  const disableCamAdjustmentsRef = useRef(false);\r\n\r\n  useEffect(function initialize() {\r\n    threeResources.renderer.setSize(appWidth, appHeight);\r\n\r\n    console.time(\"drops mesh creating\");\r\n    threeResources.dropsMesh.createMesh(waterdrops);\r\n    console.timeEnd(\"drops mesh creating\");\r\n\r\n    document\r\n      .querySelector(\"#mosaic-webgl\")\r\n      .appendChild(threeResources.renderer.domElement);\r\n\r\n    d3.select(\"#mosaic-svg\").attr(\"width\", appWidth).attr(\"height\", appHeight);\r\n\r\n    const outlineOpacity = d3\r\n      .scaleLinear()\r\n      .domain([\r\n        appHeight / waterdrops.height,\r\n        appHeight / waterdrops.groups[0].height,\r\n      ])\r\n      .range([0.1, 1])\r\n      .clamp(true);\r\n\r\n    threeResources.camera.create({\r\n      width: appWidth,\r\n      height: appHeight,\r\n      webglElement: d3.select(\".bubbles-wrapper\").node(),\r\n      svgElement: d3.select(\"#mosaic-svg\").select(\".svg-trans\").node(),\r\n      zoomFn: (transform) => {\r\n        if (!disableCamAdjustmentsRef.current) {\r\n          threeResources.dropsMesh.updateOutlineVisibility(\r\n            outlineOpacity(transform.k)\r\n          );\r\n        }\r\n\r\n        for (const cb of zoomCallbacksRef.current) cb(transform);\r\n      },\r\n    });\r\n\r\n    threeResources.renderer.setAnimationLoop(() => {\r\n      threeResources.renderer.render(\r\n        threeResources.scene,\r\n        threeResources.camera.camera\r\n      );\r\n    });\r\n\r\n    // resetCamera();\r\n\r\n    setState({ state: \"TutorialView\" });\r\n  }, []);\r\n\r\n  const getOutlineOpacity = useCallback(\r\n    (val) =>\r\n      d3\r\n        .scaleLinear()\r\n        .domain([\r\n          appHeight / waterdrops.height,\r\n          appHeight / waterdrops.groups[0].height,\r\n        ])\r\n        .range([0.1, 1])\r\n        .clamp(true)(val),\r\n    []\r\n  );\r\n\r\n  const resetCamera = useCallback(function (animated = true, callback) {\r\n    const farHeight = waterdrops.height * 1.2;\r\n    const pos = [\r\n      0,\r\n      -waterdrops.height * 0.08,\r\n      threeResources.camera.getZFromFarHeight(farHeight),\r\n    ];\r\n\r\n    let transitionDuration = 0;\r\n\r\n    if (animated) {\r\n      const [start, dur] = zoomTo(pos, callback);\r\n      transitionDuration = dur;\r\n\r\n      start();\r\n    } else {\r\n      threeResources.camera.callZoomFromWorldViewport({\r\n        worldX: pos[0],\r\n        worldY: -pos[1],\r\n        farHeight,\r\n      });\r\n      callback && callback();\r\n    }\r\n\r\n    return transitionDuration;\r\n  }, []);\r\n\r\n  const zoomTo = useCallback(function (worldPos, callback) {\r\n    const i = threeResources.camera.interpolateZoomCamera(worldPos);\r\n\r\n    const duration = i.duration / 2;\r\n\r\n    const start = () => {\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(elapsed / duration, 1);\r\n        threeResources.camera.callZoom(i(et));\r\n\r\n        if (et === 1) {\r\n          t.stop();\r\n          callback && callback();\r\n        }\r\n      });\r\n    };\r\n\r\n    return [start, duration];\r\n  }, []);\r\n\r\n  const addZoomHandler = useCallback(function (cb) {\r\n    zoomCallbacksRef.current.push(cb);\r\n  }, []);\r\n\r\n  const setDisableCamAdjustments = useCallback(function (disable) {\r\n    disableCamAdjustmentsRef.current = disable;\r\n  });\r\n\r\n  return {\r\n    appWidth,\r\n    appHeight,\r\n    state,\r\n    setState,\r\n    activeWaterdrops,\r\n    setActiveWaterdrops,\r\n    setDisableCamAdjustments,\r\n    waterdrops,\r\n    goBack,\r\n    setGoBack,\r\n    zoomTo,\r\n    resetCamera,\r\n    getOutlineOpacity,\r\n    addZoomHandler,\r\n    goals,\r\n    setGoals,\r\n    ...threeResources,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { circlet, hideElems, showElems } from \"utils/render-utils\";\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\nimport { helpers as compareViewHelpers } from \"utils/compareview-helpers\";\r\n\r\n// TODO turn into component?\r\nexport function useCompareLargeDrops() {\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const groupsRef = useRef();\r\n  const camCentersRef = useRef({});\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines] = compareViewHelpers.calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop\r\n        );\r\n\r\n        updateLabel(avgCoords(positions));\r\n        updateScenIndicators(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  function initialize(waterdrops, camera) {\r\n    groupsRef.current = compareViewHelpers.getWaterdropGroups(\r\n      [constants.PAG_OBJECTIVE, constants.PRF_OBJECTIVE],\r\n      waterdrops,\r\n      [0, 0],\r\n      0.6\r\n    );\r\n\r\n    const farHeight = waterdrops.groups[0].height * 2 * settings.SPREAD_1_2 * 1;\r\n    const k = camera.height / farHeight;\r\n\r\n    let x = camera.width / 2;\r\n    let y = camera.height / 2;\r\n\r\n    const camMidpoint = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    x = -(groupsRef.current.groupPositions[0].x * k) + camera.width / 2;\r\n    y = groupsRef.current.groupPositions[0].y * k + camera.height / 2;\r\n\r\n    const camFirstDrop = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    camCentersRef.current.firstDrop = camFirstDrop;\r\n    camCentersRef.current.midpoint = camMidpoint;\r\n\r\n    const container = d3\r\n      .select(\"#comparer-graphics\")\r\n      .attr(\r\n        \"width\",\r\n        window.innerWidth - 20\r\n      ) /* leave room for scrollbar on side */\r\n      .attr(\"height\", window.innerHeight)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-group\")\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(camFirstDrop.x, camFirstDrop.y)\r\n          .scale(camFirstDrop.k)\r\n      );\r\n\r\n    compareViewHelpers.updateDropsSVG(container, groupsRef.current, 0, {\r\n      onHover: (d) => {\r\n        setActiveMinidrop(d.key);\r\n      },\r\n    });\r\n\r\n    const indicatorGroup = container\r\n      .append(\"g\")\r\n      .attr(\"class\", \"indicator-group\");\r\n\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-variable\");\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    setActiveMinidrop(constants.DEFAULT_SCENARIO);\r\n    hideElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  function updateLabel(pos) {\r\n    const [textX, textY] = pos;\r\n\r\n    const smallTextSize =\r\n      (groupsRef.current.groups[0].height * settings.SPREAD_1_2) / 15;\r\n    const largeTextSize =\r\n      (groupsRef.current.groups[0].height * settings.SPREAD_1_2) / 10;\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-label\")\r\n      .text(\"scenario\")\r\n      .attr(\"font-size\", smallTextSize)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-variable\")\r\n      .attr(\"font-size\", largeTextSize)\r\n      .text(activeMinidrop.slice(4))\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY);\r\n  }\r\n\r\n  function updateScenIndicators(positions, lines) {\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".circlet\")\r\n      .data(positions)\r\n      .join(\"circle\")\r\n      .attr(\"class\", \"circlet\")\r\n      .call(circlet)\r\n      .attr(\"r\", settings.LOD_1_RAD_PX * 1.5)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"cx\", (d) => d[0])\r\n      .attr(\"cy\", (d) => d[1]);\r\n\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".comp-line\")\r\n      .data(lines)\r\n      .join(\"path\")\r\n      .attr(\"class\", \"comp-line\")\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"d\", (d) => d3.line()(d));\r\n\r\n    // TODO why do i have to do this in order for circlets to appear on top of waterdrops?\r\n    d3.select(\"#comparer-graphics .indicator-group\").raise();\r\n  }\r\n\r\n  function showOtherDrop() {\r\n    const container = d3.select(\"#comparer-graphics\");\r\n\r\n    container\r\n      .select(\".svg-group\")\r\n      .transition()\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(\r\n            camCentersRef.current.midpoint.x,\r\n            camCentersRef.current.midpoint.y\r\n          )\r\n          .scale(camCentersRef.current.midpoint.k)\r\n      );\r\n\r\n    showElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  function hideOtherDrop() {\r\n    const container = d3.select(\"#comparer-graphics\");\r\n\r\n    container\r\n      .select(\".svg-group\")\r\n      .transition()\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(\r\n            camCentersRef.current.firstDrop.x,\r\n            camCentersRef.current.firstDrop.y\r\n          )\r\n          .scale(camCentersRef.current.firstDrop.k)\r\n      );\r\n\r\n    hideElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  return { initComparer: initialize, showOtherDrop, hideOtherDrop };\r\n}\r\n","import { useCallback, useState } from \"react\";\r\n\r\nimport { useCompareLargeDrops } from \"hooks/useCompareLargeDrops\";\r\nimport { useDataStoryVars } from \"hooks/useDataStoryVars\";\r\nimport { animations as anims } from \"utils/data-story-anims\";\r\nimport { scripts } from \"utils/story-scripts\";\r\n\r\nexport function useDataStory(waterdrops, camera) {\r\n  /*\r\n    slides = [\r\n        name: string,\r\n        animHandler: {\r\n            do: someFunctionToDoAnimation,\r\n            undo: someFunctionToReverseAnimation,\r\n        }\r\n    ]\r\n     */\r\n  const [slides, setSlides] = useState([]);\r\n\r\n  const storyVars = useDataStoryVars();\r\n  const largeDropComparer = useCompareLargeDrops();\r\n\r\n  const hookAnimations = useCallback(\r\n    function () {\r\n      largeDropComparer.initComparer(waterdrops, camera);\r\n      const context = {\r\n        deps: {\r\n          ...storyVars,\r\n          largeDropComparer,\r\n        },\r\n      };\r\n\r\n      const showLocationAnimGroup = anims.initShowLocationAnimGroup(context);\r\n      const chartAnimGroup = anims.initChartAnimGroup(context);\r\n      const bucketsFillAnim = anims.initBucketsFillAnim(context);\r\n      const moveBucketsAnim = anims.initMoveBucketsAnim(context);\r\n      const dropFillAnim = anims.initDropFillAnim(context);\r\n      const changeRealityAnim = anims.initChangeRealityAnim(context);\r\n      const fillVarDropsAnim = anims.initFillVarDropsAnim(context);\r\n      const showScenLabelAnim = anims.initShowScenLabelAnim(context);\r\n      const highlightBestAnim = anims.initHighlightBestAnim(context);\r\n      const showQuantilesAnim = anims.initShowQuantilesAnim(context);\r\n      const comparerAnimGroup = anims.initComparerAnimGroup(context);\r\n\r\n      const _slides = [\r\n        {\r\n          name: \"howMuchIntro\",\r\n          // no anims\r\n        },\r\n        {\r\n          name: \"norCal\",\r\n          animHandler: showLocationAnimGroup.showPAG,\r\n        },\r\n        {\r\n          name: \"soCal\",\r\n          animHandler: showLocationAnimGroup.showPRF,\r\n        },\r\n        {\r\n          name: \"barsExplain\",\r\n          animHandler: chartAnimGroup.barsAppear,\r\n        },\r\n        {\r\n          name: \"barsCondense\",\r\n          animHandler: chartAnimGroup.barsCondense,\r\n        },\r\n        {\r\n          name: \"bucketsFill\",\r\n          animHandler: bucketsFillAnim,\r\n        },\r\n        {\r\n          name: \"comparingTheTwo\",\r\n          animHandler: moveBucketsAnim,\r\n        },\r\n        {\r\n          name: \"forNowLetsFocus\",\r\n          animHandler: dropFillAnim,\r\n        },\r\n        {\r\n          name: \"ifChangeReality\",\r\n          animHandler: changeRealityAnim,\r\n        },\r\n        {\r\n          name: \"fortunateCanExplore\",\r\n          animHandler: fillVarDropsAnim,\r\n        },\r\n        {\r\n          name: \"theseVarsCalled\",\r\n          animHandler: showScenLabelAnim,\r\n        },\r\n        {\r\n          name: \"atAGlance\",\r\n          animHandler: highlightBestAnim,\r\n        },\r\n        {\r\n          name: \"tryMoveRed\",\r\n          animHandler: showQuantilesAnim,\r\n        },\r\n        {\r\n          name: \"soWhyNot\",\r\n          animHandler: comparerAnimGroup.showPAG,\r\n        },\r\n        {\r\n          name: \"letsBringRefuge\",\r\n          animHandler: comparerAnimGroup.showPRF,\r\n        },\r\n      ];\r\n\r\n      setSlides(_slides.map((s, i) => ({ ...s, idx: i })));\r\n    },\r\n    [waterdrops, camera]\r\n  );\r\n\r\n  const getFromTo = useCallback(\r\n    function (from, to) {\r\n      let idxFrom, idxTo;\r\n\r\n      for (let i = 0; i < slides.length; i++) {\r\n        if (slides[i].name === from) idxFrom = i;\r\n        else if (slides[i].name === to) {\r\n          idxTo = i;\r\n          break;\r\n        }\r\n      }\r\n\r\n      return attachScripts(slides.slice(idxFrom, idxTo + 1));\r\n    },\r\n    [slides]\r\n  );\r\n\r\n  return {\r\n    hookAnimations,\r\n    getSlidesInRange: getFromTo,\r\n    storyVars,\r\n  };\r\n}\r\n\r\nfunction attachScripts(slides) {\r\n  return slides.map((slide) => ({\r\n    ...slide,\r\n    script: scripts[slide.name],\r\n  }));\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useState } from \"react\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\n\r\nexport function useDataStoryVars() {\r\n  const [userGoal, setUserGoal] = useState(200);\r\n  const [bucketInterperPAG, setBucketInterperPAG] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [bucketInterperPRF, setBucketInterperPRF] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [dropInterper, setDropInterper] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [variationInterpers, setVariationInterpers] = useState(() =>\r\n    constants.VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n  );\r\n\r\n  return {\r\n    userGoal,\r\n    setUserGoal,\r\n    bucketInterperPAG,\r\n    setBucketInterperPAG,\r\n    bucketInterperPRF,\r\n    setBucketInterperPRF,\r\n    dropInterper,\r\n    setDropInterper,\r\n    variationInterpers,\r\n    setVariationInterpers,\r\n  };\r\n}\r\n","import { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { worldToScreen } from \"utils/render-utils\";\r\nimport { useStateRef } from \"utils/misc-utils\";\r\n\r\nexport function useDragPanels(viewTransform) {\r\n  const [panels, setPanels, panelsRef] = useStateRef([]);\r\n  const mouseDownInfo = useRef({});\r\n\r\n  useEffect(function initialize() {\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX !== undefined) {\r\n        mouseDownInfo.current = {};\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const onPanelDragStart = useCallback(function (e, { id }) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    e.preventDefault();\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }, []);\r\n\r\n  function getPanelStyle({ x, y, offsetX, offsetY }) {\r\n    const [screenX, screenY] = worldToScreen(x, y, viewTransform);\r\n    return {\r\n      left: `${screenX + offsetX}px`,\r\n      top: `${screenY + offsetY}px`,\r\n    };\r\n  }\r\n\r\n  return {\r\n    panels,\r\n    panelsRef,\r\n    setPanels,\r\n    onPanelDragStart,\r\n    getPanelStyle,\r\n  };\r\n}\r\n","function initSettings() {\r\n  const LOD_1_LEVELS = 4;\r\n  const LOD_1_RAD_PX = 1;\r\n  const LOD_1_MIN_LEV_VAL = 0.1;\r\n  const LOD_1_SMALL_DROP_PAD_FACTOR = 3;\r\n  const LOD_1_LARGE_DROP_PAD_FACTOR = 1.2;\r\n\r\n  const LOD_2_SMALL_DROP_PAD_FACTOR = 3;\r\n\r\n  const GROUP_HOVER_AREA_FACTOR = 1.1 / (1 + Math.SQRT1_2);\r\n  const SPREAD_1_2 = LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  return {\r\n    LOD_1_LEVELS,\r\n    LOD_1_RAD_PX,\r\n    LOD_1_MIN_LEV_VAL,\r\n    LOD_1_SMALL_DROP_PAD_FACTOR,\r\n    LOD_1_LARGE_DROP_PAD_FACTOR,\r\n    LOD_2_SMALL_DROP_PAD_FACTOR,\r\n    GROUP_HOVER_AREA_FACTOR,\r\n    SPREAD_1_2,\r\n  };\r\n}\r\n\r\nexport const settings = initSettings();\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport {\r\n  interpolateWatercolorBlue,\r\n  levelToDropletLevel,\r\n} from \"bucket-lib/utils\";\r\nimport { settings } from \"settings\";\r\nimport { copyCoords, sortBy } from \"utils/misc-utils\";\r\nimport { rotatePoints, toRadians } from \"utils/math-utils\";\r\nimport {\r\n  waterdropDeltaOutline,\r\n  waterdropDelta,\r\n  worldToScreen,\r\n  screenToWorld,\r\n} from \"utils/render-utils\";\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return {\r\n    x: (mouseX / width) * 2 - 1,\r\n    y: -(mouseY / height) * 2 + 1,\r\n  };\r\n}\r\n\r\nexport class WaterdropMesh {\r\n  static MAX_POINTS_DROPS = 60 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n  static MAX_POINTS_OUTLINE = 40 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n\r\n  dropsMesh;\r\n  outlineMesh;\r\n\r\n  added = false;\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.dropsMesh) {\r\n      this.initializeMeshes(waterdrops);\r\n    } else {\r\n      this.updateMeshes(waterdrops);\r\n    }\r\n  }\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.dropsMesh);\r\n      scene.add(this.outlineMesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.dropsMesh);\r\n      scene.remove(this.outlineMesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  // TODO optimize!\r\n  initializeMeshes(waterdrops) {\r\n    const dropsGeometry = new MeshGeometry(WaterdropMesh.MAX_POINTS_DROPS);\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = waterdropDeltaOutline(\r\n      0,\r\n      1,\r\n      settings.LOD_1_RAD_PX * 2 * 0.975\r\n    );\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const {\r\n        id,\r\n        globalX: x,\r\n        globalY: y,\r\n        levs,\r\n        maxLev,\r\n        globalTilt: tilt,\r\n      } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = waterdropDelta(\r\n          levelToDropletLevel(l1 / maxLev),\r\n          levelToDropletLevel(l2 / maxLev),\r\n          settings.LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / settings.LOD_1_LEVELS)\r\n        );\r\n\r\n        dropsGeometry.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y, rotate: tilt },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      const rotOutline = rotatePoints(copyCoords(outlineMeshCoords), tilt);\r\n\r\n      outlinePoints.push(\r\n        ...rotOutline.map(([dx, dy]) => {\r\n          return new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01);\r\n        })\r\n      );\r\n    }\r\n\r\n    dropsGeometry.finish();\r\n\r\n    this.dropsMesh = new THREE.Mesh(\r\n      dropsGeometry.threeGeom,\r\n      new THREE.MeshBasicMaterial({\r\n        vertexColors: true,\r\n        transparent: true,\r\n        opacity: 1,\r\n      })\r\n    );\r\n\r\n    this.outlineMesh = new THREE.LineSegments(\r\n      new THREE.BufferGeometry().setFromPoints(outlinePoints),\r\n      new THREE.LineBasicMaterial({\r\n        color: 13421772,\r\n        transparent: true,\r\n        opacity: 0,\r\n      })\r\n    );\r\n  }\r\n\r\n  updateOutlineVisibility(opac) {\r\n    if (!this.outlineMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateVisibility(opac) {\r\n    if (!this.outlineMesh || !this.dropsMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n    this.dropsMesh.material.opacity = opac;\r\n    this.dropsMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateMeshes(waterdrops) {\r\n    // TODO fix\r\n  }\r\n}\r\n\r\nexport class WaterdropSimplifiedMesh {\r\n  mesh;\r\n  added = false;\r\n\r\n  vertToId = {};\r\n  idToVert = {};\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.mesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.mesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.mesh) {\r\n      this.initializeMesh(waterdrops);\r\n    }\r\n\r\n    this.updateMesh(waterdrops);\r\n\r\n    return this.mesh;\r\n  }\r\n\r\n  initializeMesh(waterdrops) {\r\n    const pointsGeometry = new THREE.BufferGeometry();\r\n\r\n    const vertices = [];\r\n    const colors = [];\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, domLev } = waterdrops.nodes[i];\r\n\r\n      const color = domLev > 0 ? interpolateWatercolorBlue(domLev) : \"white\";\r\n\r\n      vertices.push(x, -y, 0);\r\n      const t_color = new THREE.Color(color);\r\n      colors.push(t_color.r, t_color.g, t_color.b);\r\n\r\n      this.vertToId[i] = id;\r\n      this.idToVert[id] = i;\r\n    }\r\n\r\n    const pointsMaterial = new THREE.PointsMaterial({\r\n      size: settings.LOD_1_RAD_PX * 2,\r\n      sizeAttenuation: true,\r\n      vertexColors: true,\r\n      map: new THREE.TextureLoader().load(\"drop.png\"),\r\n      transparent: true,\r\n    });\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(vertices), 3)\r\n    );\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"color\",\r\n      new THREE.BufferAttribute(new Float32Array(colors), 3)\r\n    );\r\n\r\n    this.mesh = new THREE.Points(pointsGeometry, pointsMaterial);\r\n  }\r\n\r\n  updateMesh(waterdrops) {\r\n    const positionAttr = this.mesh.geometry.getAttribute(\"position\");\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: newX, globalY: newY } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n      positionAttr.setXY(idx, newX, -newY);\r\n    }\r\n    positionAttr.needsUpdate = true;\r\n  }\r\n\r\n  updatePoints(waterdrops, translations, dt) {\r\n    const verts = this.mesh.geometry.vertices;\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n\r\n      const [dx, dy] = translations[id];\r\n\r\n      const x = verts[idx].x;\r\n      const y = verts[idx].y;\r\n\r\n      verts[idx].setX(x + dt * dx);\r\n      verts[idx].setY(y - dt * dy);\r\n    }\r\n\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n\r\n  intersectObject(camera, x, y) {\r\n    const intersects = camera.intersectObject(x, y, this.mesh);\r\n\r\n    if (intersects[0]) {\r\n      const intersect = sortBy(intersects, \"distanceToRay\")[0];\r\n      return this.vertToId[intersect.index];\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  webglView;\r\n  curTransform;\r\n\r\n  raycaster = new THREE.Raycaster();\r\n\r\n  svgView;\r\n\r\n  constructor({ fov, near, far }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n  }\r\n\r\n  create({ width, height, webglElement, svgElement, zoomFn }) {\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.webglView = d3.select(webglElement);\r\n    this.svgView = d3.select(svgElement);\r\n\r\n    this.zoom = d3.zoom().on(\"zoom\", (e) => {\r\n      this.curTransform = e.transform;\r\n\r\n      this.#THREEHandleZoom(e.transform);\r\n      this.svgView.attr(\"transform\", e.transform);\r\n\r\n      zoomFn && zoomFn(e.transform);\r\n    });\r\n\r\n    this.#finishCreate();\r\n  }\r\n\r\n  callZoom(transform) {\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity.translate(transform.x, transform.y).scale(transform.k)\r\n    );\r\n  }\r\n\r\n  callZoomFromWorldViewport({ worldX, worldY, farHeight }) {\r\n    const k = this.height / farHeight;\r\n\r\n    const x = -(worldX * k) + this.width / 2;\r\n    const y = worldY * k + this.height / 2;\r\n\r\n    this.callZoom({\r\n      x,\r\n      y,\r\n      k,\r\n    });\r\n  }\r\n\r\n  interpolateZoomCamera([endx, endy, endz]) {\r\n    const i = d3.interpolateZoom(\r\n      [\r\n        this.camera.position.x,\r\n        this.camera.position.y,\r\n        this.height / this.curTransform.k,\r\n      ],\r\n      [endx, -endy, this.getFarHeightFromZ(endz)]\r\n    );\r\n\r\n    const interper = (t) => {\r\n      const [worldX, worldY, farHeight] = i(t);\r\n\r\n      const k = this.height / farHeight;\r\n\r\n      const x = -(worldX * k) + this.width / 2;\r\n      const y = worldY * k + this.height / 2;\r\n\r\n      return {\r\n        x,\r\n        y,\r\n        k,\r\n      };\r\n    };\r\n\r\n    interper.duration = i.duration;\r\n\r\n    return interper;\r\n  }\r\n\r\n  getZFromFarHeight(farHeight) {\r\n    return (Math.tan(toRadians(90 - this.fov / 2)) * farHeight) / 2;\r\n  }\r\n\r\n  getFarHeightFromZ(z) {\r\n    return Math.tan(toRadians(this.fov) / 2) * z * 2;\r\n  }\r\n\r\n  getScaleFromZ(z) {\r\n    const farHeight = this.getFarHeightFromZ(z);\r\n    const scale = this.height / farHeight;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const scaleHeight = this.height / scale;\r\n    const z = this.getZFromFarHeight(scaleHeight);\r\n    return z;\r\n  }\r\n\r\n  intersectObject(mouseX, mouseY, mesh) {\r\n    this.raycaster.setFromCamera(\r\n      {\r\n        x: mouseX,\r\n        y: mouseY,\r\n      },\r\n      this.camera\r\n    );\r\n\r\n    return this.raycaster.intersectObject(mesh);\r\n  }\r\n\r\n  worldToScreen(x, y) {\r\n    return worldToScreen(x, y, this.curTransform);\r\n  }\r\n\r\n  screenToWorld(x, y) {\r\n    return screenToWorld(x, y, this.curTransform);\r\n  }\r\n\r\n  #finishCreate() {\r\n    this.zoom = this.zoom.scaleExtent([\r\n      this.getScaleFromZ(this.far),\r\n      this.getScaleFromZ(this.near),\r\n    ]);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      this.fov,\r\n      this.width / this.height,\r\n      this.near,\r\n      this.far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.webglView.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  #THREEHandleZoom(transform) {\r\n    const scale = transform.k;\r\n    const x = -(transform.x - this.width / 2) / scale;\r\n    const y = (transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n}\r\n\r\nclass MeshGeometry {\r\n  threeGeom = new THREE.BufferGeometry();\r\n  triangleIdx = 0;\r\n  positionAttribute;\r\n  colorAttribute;\r\n\r\n  constructor(numPoints, color = true) {\r\n    this.threeGeom.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n    );\r\n\r\n    if (color)\r\n      this.threeGeom.setAttribute(\r\n        \"color\",\r\n        new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n      );\r\n\r\n    this.positionAttribute = this.threeGeom.getAttribute(\"position\");\r\n    this.colorAttribute = this.threeGeom.getAttribute(\"color\");\r\n  }\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = rotatePoints(\r\n        copyCoords(meshCoords[j]),\r\n        transform.rotate\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 0,\r\n        transform.x + v1[0],\r\n        transform.y - v1[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 1,\r\n        transform.x + v2[0],\r\n        transform.y - v2[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 2,\r\n        transform.x + v3[0],\r\n        transform.y - v3[1],\r\n        z\r\n      );\r\n\r\n      if (color) {\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 0,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 1,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 2,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n      }\r\n\r\n      this.triangleIdx++;\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    this.threeGeom.setDrawRange(0, this.triangleIdx * 3);\r\n  }\r\n}\r\n","import * as THREE from \"three\";\r\n\r\nimport { WaterdropMesh, Camera } from \"utils/three-utils\";\r\n\r\nfunction initThreeResources() {\r\n  const scene = (function getScene() {\r\n    const s = new THREE.Scene();\r\n    s.background = new THREE.Color(0xEFEBE0);\r\n    return s;\r\n  })();\r\n\r\n  const dropsMesh = new WaterdropMesh();\r\n\r\n  const camera = new Camera({\r\n    fov: 45,\r\n    near: 1,\r\n    far: 3000,\r\n  });\r\n\r\n  const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\r\n  return { scene, camera, renderer, dropsMesh };\r\n}\r\n\r\nexport const threeResources = initThreeResources();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { settings } from \"settings\";\r\n\r\nimport { clipEnds, dropCenterCorrection } from \"utils/math-utils\";\r\nimport {\r\n  DROPLET_SHAPE,\r\n  generateTSpan,\r\n  circlet,\r\n  gradientInit,\r\n  gradientUpdate,\r\n} from \"utils/render-utils\";\r\n\r\nfunction largeDropInit({ nodes, height, key }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"large-drop \" + key);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"stroke\", \"none\")\r\n      .attr(\"fill\", \"yellow\")\r\n      .attr(\"r\", settings.LOD_1_RAD_PX * 2);\r\n\r\n    s.append(\"g\")\r\n      .attr(\"class\", \"baseline-pointer\")\r\n      .call(function (s) {\r\n        s.append(\"path\");\r\n        s.append(\"text\").text(\"baseline\");\r\n      });\r\n\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * settings.SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"drop-label fancy-font\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate(\r\n  { nodes, height, display_name },\r\n  { isLeft, isBottom },\r\n  transitionDelay\r\n) {\r\n  return (s) => {\r\n    const getStartDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x}, ${y}) rotate(${tilt})`;\r\n    const getEndDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x * settings.SPREAD_1_2}, ${\r\n        y * settings.SPREAD_1_2\r\n      }) rotate(${tilt})`;\r\n\r\n    const baselinePos = {};\r\n\r\n    s.call(textUpdate(display_name, height))\r\n      .selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\"transform\", getStartDropLoc)\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n      })\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"transform\", getEndDropLoc);\r\n\r\n    s.select(\".highlight-circle\")\r\n      .attr(\"cx\", baselinePos.x)\r\n      .attr(\r\n        \"cy\",\r\n        baselinePos.y - dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n      )\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"cx\", baselinePos.x * settings.SPREAD_1_2)\r\n      .attr(\r\n        \"cy\",\r\n        baselinePos.y * settings.SPREAD_1_2 -\r\n          dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n      );\r\n\r\n    const circlePosX = baselinePos.x * settings.SPREAD_1_2,\r\n      circlePosY =\r\n        baselinePos.y * settings.SPREAD_1_2 -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX });\r\n\r\n    const textPosX = ((height * settings.SPREAD_1_2) / 2) * (isLeft ? -1 : 1),\r\n      textPosY = ((height * settings.SPREAD_1_2) / 2) * (isBottom ? 1 : -1);\r\n\r\n    const fontSize = height / 20;\r\n    const lineWidth = height / 100;\r\n\r\n    s.select(\".baseline-pointer path\")\r\n      .attr(\r\n        \"d\",\r\n        d3\r\n          .line()\r\n          .x((d) => d[0])\r\n          .y((d) => d[1])([\r\n          [circlePosX, circlePosY],\r\n          [textPosX, textPosY],\r\n        ])\r\n      )\r\n      .attr(\"stroke-width\", lineWidth);\r\n    s.select(\".baseline-pointer text\")\r\n      .attr(\"class\", \"fancy-font\")\r\n      .attr(\"font-size\", fontSize)\r\n      .attr(\"text-anchor\", isLeft ? \"end\" : \"start\")\r\n      .attr(\r\n        \"transform\",\r\n        `translate(${textPosX + fontSize * (isLeft ? -1 : 1)}, ${textPosY})`\r\n      );\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ levs, id }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const idStr = `compare-grad-${id}`;\r\n\r\n    s.call(gradientInit(levs, idStr));\r\n\r\n    s.append(\"path\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"class\", \"outline\")\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX * 0.95})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${idStr})`)\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX})`);\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction textUpdate(display_name, height) {\r\n  return (s) => {\r\n    s.select(\".drop-label\")\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", (height / 2) * settings.SPREAD_1_2 * 0.9)\r\n      .call(generateTSpan(display_name, 1.2, 30));\r\n  };\r\n}\r\n\r\nfunction updateDropsSVG(\r\n  container,\r\n  waterdropGroups,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartGroupLoc = ({ x, y, tilt }) =>\r\n    `translate(${x}, ${y}) rotate(${tilt})`;\r\n  const getEndGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i].x}, ${waterdropGroups.groupPositions[i].y})`;\r\n\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(largeDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartGroupLoc)\r\n    .each(function (node, i) {\r\n      const drops = d3\r\n        .select(this)\r\n        .call(\r\n          largeDropUpdate(\r\n            node,\r\n            waterdropGroups.groupPositions[i],\r\n            transitionDelay\r\n          )\r\n        )\r\n        .selectAll(\".small-drop\");\r\n\r\n      if (onClick) {\r\n        drops.on(\"click\", function (_, d) {\r\n          onClick(d);\r\n        });\r\n      }\r\n\r\n      if (onHover) {\r\n        drops.on(\"mouseenter\", function (_, d) {\r\n          d3.select(this.parentNode).raise();\r\n          onHover(d);\r\n        });\r\n      }\r\n\r\n      if (onUnhover) {\r\n        drops.on(\"mouseleave\", function (_, d) {\r\n          onUnhover(d);\r\n        });\r\n      }\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndGroupLoc);\r\n}\r\n\r\nfunction updateColorDrops(container, waterdropGroups, opacFn, color) {\r\n  const getGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i].x}, ${waterdropGroups.groupPositions[i].y})`;\r\n\r\n  container\r\n    .selectAll(\".color-drop-group\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function ({ nodes }) {\r\n        d3.select(this).call((s) => {\r\n          s.attr(\"class\", \"color-drop-group\")\r\n            .selectAll(\".color-drop\")\r\n            .data(nodes)\r\n            .join(\"circle\")\r\n            .attr(\"class\", \"color-drop\")\r\n            .attr(\"r\", settings.LOD_1_RAD_PX);\r\n        });\r\n      });\r\n    })\r\n    .attr(\"transform\", getGroupLoc)\r\n    .each(function () {\r\n      d3.select(this)\r\n        .selectAll(\".color-drop\")\r\n        .call((s) => {\r\n          s.attr(\"opacity\", ({ key }) => opacFn(key)).attr(\"fill\", color);\r\n        })\r\n        .attr(\"cx\", ({ x }) => x * settings.SPREAD_1_2)\r\n        .attr(\"cy\", ({ y }) => y * settings.SPREAD_1_2);\r\n    });\r\n}\r\n\r\nfunction getWaterdropGroups(keyArr, waterdrops, center, spacing = 0.75) {\r\n  const groups = keyArr.map((k) => waterdrops.groups.find((g) => g.key === k));\r\n\r\n  const groupPositions = [];\r\n  const rad = groups[0].height * settings.SPREAD_1_2 * spacing;\r\n\r\n  for (let i = 0, n = groups.length; i < n; i++) {\r\n    const angle = ((Math.PI * 2) / n) * (i - 0.5) - Math.PI / 2;\r\n    const x = center[0] + Math.cos(angle) * rad,\r\n      y = center[1] + Math.sin(angle) * rad,\r\n      isLeft = x < center[0],\r\n      isBottom = y > center[1];\r\n\r\n    groupPositions.push({\r\n      x,\r\n      y,\r\n      isLeft,\r\n      isBottom,\r\n    });\r\n  }\r\n\r\n  return {\r\n    groups,\r\n    groupPositions,\r\n  };\r\n}\r\n\r\nfunction calcLinesAndPositions(groupsObj, activeMinidropKey) {\r\n  const positions = [];\r\n  const nodes = [];\r\n  for (let i = 0; i < groupsObj.groups.length; i++) {\r\n    const group = groupsObj.groups[i];\r\n    const groupPos = groupsObj.groupPositions[i];\r\n\r\n    const node = group.nodes.find((n) => n.key === activeMinidropKey);\r\n\r\n    nodes.push(node);\r\n\r\n    positions.push([\r\n      node.x * settings.SPREAD_1_2 + groupPos.x,\r\n      node.y * settings.SPREAD_1_2 +\r\n        groupPos.y -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX }),\r\n    ]);\r\n  }\r\n\r\n  const lines = [];\r\n\r\n  for (let i = 0; i < positions.length; i++) {\r\n    const from = Array.from(positions[i]),\r\n      to = Array.from(positions[i + 1 == positions.length ? 0 : i + 1]);\r\n\r\n    clipEnds([from, to], settings.LOD_1_RAD_PX * 2);\r\n\r\n    lines.push([from, to]);\r\n  }\r\n\r\n  return [positions, lines, nodes];\r\n}\r\n\r\nfunction updateLabelSVG(pos, labelText, normedTextSize) {\r\n  const [textX, textY] = pos;\r\n\r\n  const smallTextSize = normedTextSize / 15;\r\n  const largeTextSize = normedTextSize / 10;\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-label\")\r\n    .text(\"scenario\")\r\n    .attr(\"font-size\", smallTextSize)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-variable\")\r\n    .attr(\"font-size\", largeTextSize)\r\n    .text(labelText)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY);\r\n}\r\n\r\nfunction updateScenIndicatorsSVG(positions, lines) {\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".circlet\")\r\n    .data(positions)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"circlet\")\r\n    .call(circlet)\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX * 1.5)\r\n    .raise()\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"cx\", (d) => d[0])\r\n    .attr(\"cy\", (d) => d[1]);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".comp-line\")\r\n    .data(lines)\r\n    .join(\"path\")\r\n    .attr(\"class\", \"comp-line\")\r\n    .raise()\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"d\", (d) => d3.line()(d));\r\n}\r\n\r\nexport const helpers = {\r\n  updateDropsSVG,\r\n  updateColorDrops,\r\n  getWaterdropGroups,\r\n  calcLinesAndPositions,\r\n  updateLabelSVG,\r\n  updateScenIndicatorsSVG,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\n\r\nimport { objectivesData } from \"data/objectives-tutorial-data\";\r\nimport { hideElems, showElems } from \"utils/render-utils\";\r\n\r\nfunction initAllAnims() {\r\n  function initShowLocationAnimGroup() {\r\n    function showPAGDo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n    }\r\n\r\n    function showPAGUndo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 1)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n    }\r\n\r\n    function showPRFDo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 1)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PRF_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n    }\r\n\r\n    function showPRFUndo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PRF_OBJECTIVE)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n    }\r\n\r\n    return {\r\n      showPAG: {\r\n        do: showPAGDo,\r\n        undo: showPAGUndo,\r\n      },\r\n      showPRF: {\r\n        do: showPRFDo,\r\n        undo: showPRFUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  function initChartAnimGroup() {\r\n    let _pagX;\r\n    let _prfX;\r\n    let _pagXAxis;\r\n    let _prfXAxis;\r\n    let _pagDataDescending;\r\n    let _prfDataDescending;\r\n\r\n    const BAR_CHART_MARGIN = { top: 40, right: 30, bottom: 40, left: 60 };\r\n\r\n    function prepareSVG() {\r\n      // PAG\r\n      {\r\n        const svgGroup = d3\r\n          .select(\"#pag-bar-graph\")\r\n          .attr(\r\n            \"width\",\r\n            constants.BAR_CHART_WIDTH +\r\n              BAR_CHART_MARGIN.left +\r\n              BAR_CHART_MARGIN.right\r\n          )\r\n          .attr(\r\n            \"height\",\r\n            constants.BAR_CHART_HEIGHT +\r\n              BAR_CHART_MARGIN.top +\r\n              BAR_CHART_MARGIN.bottom\r\n          )\r\n          .attr(\"opacity\", 1)\r\n          .append(\"g\")\r\n          .attr(\"class\", \"svg-group\")\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        const dataDescending = objectivesData.OBJECTIVES_DATA[\r\n          constants.PAG_OBJECTIVE\r\n        ][objectivesData.BASELINE_YRLY_KEY_STRING]\r\n          .map((val, placeFromLeft) => ({\r\n            val,\r\n            placeFromLeft,\r\n            year: placeFromLeft + 1,\r\n          }))\r\n          .sort(d3.descending);\r\n\r\n        const x = d3\r\n          .scaleBand()\r\n          .domain(dataDescending.map(({ year }) => year).sort(d3.ascending))\r\n          .range([0, constants.BAR_CHART_WIDTH])\r\n          .padding(0.4);\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        const xaxis = d3\r\n          .axisBottom(x)\r\n          .tickSize(0)\r\n          .tickFormat((d) => `year ${d}`)\r\n          .tickValues(\r\n            x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0)\r\n          );\r\n\r\n        svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n        svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .call(xaxis)\r\n          .selectAll(\"text\")\r\n          .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n          .style(\"text-anchor\", \"end\");\r\n        svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n        _pagX = x;\r\n        _pagXAxis = xaxis;\r\n        _pagDataDescending = dataDescending;\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const svgGroup = d3\r\n          .select(\"#prf-bar-graph\")\r\n          .attr(\r\n            \"width\",\r\n            constants.BAR_CHART_WIDTH +\r\n              BAR_CHART_MARGIN.left +\r\n              BAR_CHART_MARGIN.right\r\n          )\r\n          .attr(\r\n            \"height\",\r\n            constants.BAR_CHART_HEIGHT +\r\n              BAR_CHART_MARGIN.top +\r\n              BAR_CHART_MARGIN.bottom\r\n          )\r\n          .attr(\"opacity\", 1)\r\n          .append(\"g\")\r\n          .attr(\"class\", \"svg-group\")\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        const dataDescending = objectivesData.OBJECTIVES_DATA[\r\n          constants.PRF_OBJECTIVE\r\n        ][objectivesData.BASELINE_YRLY_KEY_STRING]\r\n          .map((val, placeFromLeft) => ({\r\n            val,\r\n            placeFromLeft,\r\n            year: placeFromLeft + 1,\r\n          }))\r\n          .sort(d3.descending);\r\n\r\n        const x = d3\r\n          .scaleBand()\r\n          .domain(dataDescending.map(({ year }) => year).sort(d3.ascending))\r\n          .range([0, constants.BAR_CHART_WIDTH])\r\n          .padding(0.4);\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        const xaxis = d3\r\n          .axisBottom(x)\r\n          .tickSize(0)\r\n          .tickFormat((d) => `year ${d}`)\r\n          .tickValues(\r\n            x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0)\r\n          );\r\n\r\n        svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n        svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .call(xaxis)\r\n          .selectAll(\"text\")\r\n          .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n          .style(\"text-anchor\", \"end\");\r\n        svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n        _prfX = x;\r\n        _prfXAxis = xaxis;\r\n        _prfDataDescending = dataDescending;\r\n      }\r\n    }\r\n\r\n    function barsAppearDo() {\r\n      // PAG\r\n      {\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        d3.select(\"#pag-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_pagDataDescending, (d) => d.placeFromLeft)\r\n          .join(\"rect\")\r\n          .attr(\"class\", \"bars\")\r\n          .attr(\"x\", (d) => _pagX(d.year))\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"width\", _pagX.bandwidth())\r\n          .attr(\"height\", 0)\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"fill\", \"steelblue\")\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => d.placeFromLeft * 10)\r\n          .attr(\"y\", (d) => y(d.val))\r\n          .attr(\"height\", (d) => constants.BAR_CHART_HEIGHT - y(d.val));\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        d3.select(\"#prf-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_prfDataDescending, (d) => d.placeFromLeft)\r\n          .join(\"rect\")\r\n          .attr(\"class\", \"bars\")\r\n          .attr(\"x\", (d) => _prfX(d.year))\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"width\", _prfX.bandwidth())\r\n          .attr(\"height\", 0)\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"fill\", \"steelblue\")\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => d.placeFromLeft * 10)\r\n          .attr(\"y\", (d) => y(d.val))\r\n          .attr(\"height\", (d) => constants.BAR_CHART_HEIGHT - y(d.val));\r\n      }\r\n    }\r\n\r\n    function barsAppearUndo() {\r\n      // PAG\r\n      {\r\n        d3.select(\"#pag-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_pagDataDescending, (d) => d.placeFromLeft)\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => (_pagDataDescending.length - d.placeFromLeft - 1) * 10)\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"height\", 0);\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        d3.select(\"#prf-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_prfDataDescending, (d) => d.placeFromLeft)\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => (_prfDataDescending.length - d.placeFromLeft - 1) * 10)\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"height\", 0);\r\n      }\r\n    }\r\n\r\n    async function barsCondenseDo() {\r\n      // PAG\r\n      {\r\n        const newWidth = constants.BAR_CHART_WIDTH / 8;\r\n        const svgGroup = d3.select(\"#pag-bar-graph .svg-group\");\r\n\r\n        svgGroup.select(\".anim-xaxis\").call(_pagXAxis.tickFormat(\"\"));\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        bars\r\n          .style(\"mix-blend-mode\", \"multiply\")\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 0.05)\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (1 - d.placeFromLeft / _pagDataDescending.length) ** 4) *\r\n                1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"width\", newWidth)\r\n          .attr(\"x\", constants.BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            svgGroup\r\n              .select(\".anim-xaxis\")\r\n              .transition()\r\n              .transition(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(0, ${constants.BAR_CHART_HEIGHT + 50})`\r\n              )\r\n              .attr(\"opacity\", 0);\r\n\r\n            bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n            svgGroup\r\n              .transition()\r\n              .delay(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(${\r\n                  BAR_CHART_MARGIN.left +\r\n                  constants.BAR_CHART_WIDTH / 2 -\r\n                  newWidth / 2\r\n                },${BAR_CHART_MARGIN.top})`\r\n              );\r\n          });\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const newWidth = constants.BAR_CHART_WIDTH / 8;\r\n        const svgGroup = d3.select(\"#prf-bar-graph .svg-group\");\r\n\r\n        svgGroup.select(\".anim-xaxis\").call(_prfXAxis.tickFormat(\"\"));\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        bars\r\n          .style(\"mix-blend-mode\", \"multiply\")\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 0.05)\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (1 - d.placeFromLeft / _prfDataDescending.length) ** 4) *\r\n                1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"width\", newWidth)\r\n          .attr(\"x\", constants.BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            svgGroup\r\n              .select(\".anim-xaxis\")\r\n              .transition()\r\n              .transition(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(0, ${constants.BAR_CHART_HEIGHT + 50})`\r\n              )\r\n              .attr(\"opacity\", 0);\r\n\r\n            bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n            svgGroup\r\n              .transition()\r\n              .delay(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(${\r\n                  BAR_CHART_MARGIN.left +\r\n                  constants.BAR_CHART_WIDTH / 2 -\r\n                  newWidth / 2\r\n                },${BAR_CHART_MARGIN.top})`\r\n              );\r\n          });\r\n      }\r\n    }\r\n\r\n    function barsCondenseUndo() {\r\n      // PAG\r\n      {\r\n        const svgGroup = d3.select(\"#pag-bar-graph .svg-group\");\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .transition()\r\n          .transition(500)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .attr(\"opacity\", 1);\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .call(_pagXAxis.tickFormat((d) => `year ${d}`));\r\n\r\n        svgGroup\r\n          .transition()\r\n          .delay(500)\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        bars\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (d.placeFromLeft / _pagDataDescending.length) ** 4) * 1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"x\", (d) => _prfX(d.year))\r\n          .attr(\"width\", _pagX.bandwidth())\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 1)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            bars.style(\"mix-blend-mode\", \"normal\");\r\n          });\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const svgGroup = d3.select(\"#prf-bar-graph .svg-group\");\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .transition()\r\n          .transition(500)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .attr(\"opacity\", 1);\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .call(_prfXAxis.tickFormat((d) => `year ${d}`));\r\n\r\n        svgGroup\r\n          .transition()\r\n          .delay(500)\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        bars\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (d.placeFromLeft / _prfDataDescending.length) ** 4) * 1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"x\", (d) => _prfX(d.year))\r\n          .attr(\"width\", _prfX.bandwidth())\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 1)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            bars.style(\"mix-blend-mode\", \"normal\");\r\n          });\r\n      }\r\n    }\r\n\r\n    prepareSVG();\r\n\r\n    return {\r\n      barsAppear: {\r\n        do: barsAppearDo,\r\n        undo: barsAppearUndo,\r\n      },\r\n      barsCondense: {\r\n        do: barsCondenseDo,\r\n        undo: barsCondenseUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  function initBucketsFillAnim({ deps }) {\r\n    function animDo() {\r\n      d3.selectAll(\".tut-graph-wrapper .bucket-wrapper\").style(\r\n        \"display\",\r\n        \"initial\"\r\n      );\r\n      d3.select(\"#pag-bar-graph\").attr(\"opacity\", 0);\r\n      d3.select(\"#prf-bar-graph\").attr(\"opacity\", 0);\r\n\r\n      deps.setBucketInterperPAG(() => constants.PAG_INTERPER);\r\n      deps.setBucketInterperPRF(() => constants.PRF_INTERPER);\r\n    }\r\n\r\n    function animUndo() {\r\n      deps.setBucketInterperPAG(() => d3.scaleLinear().range([0, 0]));\r\n      deps.setBucketInterperPRF(() => d3.scaleLinear().range([0, 0]));\r\n\r\n      d3.selectAll(\".tut-graph-wrapper .bucket-wrapper\").style(\r\n        \"display\",\r\n        \"none\"\r\n      );\r\n      d3.select(\"#pag-bar-graph\").transition().attr(\"opacity\", 1);\r\n      d3.select(\"#prf-bar-graph\").transition().attr(\"opacity\", 1);\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initMoveBucketsAnim({ deps }) {\r\n    function animDo() {\r\n      showElems(\".ag-annot, .ref-annot\");\r\n    }\r\n\r\n    function animUndo() {\r\n      hideElems(\".ag-annot, .ref-annot\");\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initDropFillAnim({ deps }) {\r\n    function animDo() {\r\n      deps.setDropInterper(() => constants.PAG_INTERPER_DROP);\r\n    }\r\n\r\n    function animUndo() {\r\n      deps.setDropInterper(() => d3.scaleLinear().range([0, 0]));\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initChangeRealityAnim() {\r\n    function animDo() {\r\n      d3.selectAll(\".vardrop\")\r\n        .style(\"display\", \"initial\")\r\n        .classed(\"hasarrow\", true);\r\n\r\n      hideElems(\r\n        \".main-waterdrop .objective-label, .main-waterdrop .volume-not-height, .waterdrop-explain-pag\"\r\n      );\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.selectAll(\".vardrop\")\r\n        .style(\"display\", \"none\")\r\n        .classed(\"hasarrow\", false);\r\n\r\n      showElems(\r\n        \".main-waterdrop .objective-label, .main-waterdrop .volume-not-height, .waterdrop-explain-pag\"\r\n      );\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initFillVarDropsAnim({ deps }) {\r\n    function animDo() {\r\n      d3.selectAll(\".vardrop path\").style(\"stroke-dasharray\", \"none\");\r\n      deps.setVariationInterpers(constants.VARIATIONS_INTERPERS);\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.selectAll(\".vardrop path\").style(\"stroke-dasharray\", \"10 10\");\r\n      deps.setVariationInterpers(\r\n        constants.VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n      );\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initShowScenLabelAnim() {\r\n    return {\r\n      do: function () {\r\n        d3.selectAll(\".var-scen-label\").style(\"display\", \"block\");\r\n      },\r\n      undo: function () {\r\n        d3.selectAll(\".var-scen-label\").style(\"display\", \"none\");\r\n      },\r\n    };\r\n  }\r\n\r\n  function initHighlightBestAnim() {\r\n    return {\r\n      do: function () {\r\n        d3.select(\".drop1\").classed(\"highlighted\", true);\r\n      },\r\n      undo: function () {\r\n        d3.select(\".drop1\").classed(\"highlighted\", false);\r\n      },\r\n    };\r\n  }\r\n\r\n  function initShowQuantilesAnim() {\r\n    function animDo() {\r\n      d3.select(\".drop1\").classed(\"highlighted\", false);\r\n      d3.selectAll(\".vardrop\").classed(\"hasarrow\", false);\r\n\r\n      d3.selectAll(\".var-scen-label\").style(\"opacity\", \"0.5\");\r\n      d3.selectAll(\".var-scen-label, .scen-number\").style(\"color\", \"gray\");\r\n\r\n      d3.select(\".main-waterdrop\")\r\n        .transition()\r\n        .style(\"transform\", \"translateY(-100px) scale(0.5)\");\r\n      // undo scaling of label due to shrinking div\r\n      d3.select(\".main-waterdrop .var-scen-label\")\r\n        .transition()\r\n        .style(\"transform\", \"scale(2)\");\r\n      d3.selectAll(\".drop1 .waterdrop-wrapper, .drop3 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"translate(-50px, 15px) scale(0.5)\");\r\n      d3.selectAll(\".drop2 .waterdrop-wrapper, .drop4 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"translate(50px, 15px) scale(0.5)\");\r\n\r\n      d3.select(\".main-histogram\").style(\"display\", \"initial\");\r\n      d3.selectAll(\".vardrop .dot-histogram-wrapper\").style(\"display\", \"flex\");\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.select(\".drop1\").classed(\"highlighted\", true);\r\n      d3.selectAll(\".vardrop\").classed(\"hasarrow\", true);\r\n\r\n      d3.selectAll(\".var-scen-label\").style(\"opacity\", \"1\");\r\n      d3.selectAll(\".var-scen-label\").style(\"color\", \"black\");\r\n      d3.selectAll(\".scen-number\").style(\"color\", \"#CC8F43\");\r\n\r\n      d3.select(\".main-waterdrop\").transition().style(\"transform\", \"none\");\r\n      // undo scaling of label due to shrinking div\r\n      d3.select(\".main-waterdrop .var-scen-label\")\r\n        .transition()\r\n        .style(\"transform\", \"scale(1)\");\r\n      d3.selectAll(\".drop1 .waterdrop-wrapper, .drop3 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"none\");\r\n      d3.selectAll(\".drop2 .waterdrop-wrapper, .drop4 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"none\");\r\n\r\n      d3.select(\".main-histogram\").style(\"display\", \"none\");\r\n      d3.selectAll(\".vardrop .dot-histogram-wrapper\").style(\"display\", \"none\");\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initComparerAnimGroup({ deps }) {\r\n    function showPAGAnimDo() {\r\n      hideElems(\".scrollama-compare-scenobjs .waterdrop-graphics-wrapper\");\r\n      showElems(\".scrollama-compare-scenobjs .tut-comparer-graphics-wrapper\");\r\n    }\r\n\r\n    function showPAGAnimUndo() {\r\n      showElems(\r\n        \".scrollama-compare-scenobjs .waterdrop-graphics-wrapper\",\r\n        d3,\r\n        \"grid\"\r\n      );\r\n      hideElems(\".scrollama-compare-scenobjs .tut-comparer-graphics-wrapper\");\r\n    }\r\n\r\n    function showPRFAnimDo() {\r\n      deps.largeDropComparer.showOtherDrop();\r\n    }\r\n\r\n    function showPRFAnimUndo() {\r\n      deps.largeDropComparer.hideOtherDrop();\r\n    }\r\n\r\n    return {\r\n      showPAG: {\r\n        do: showPAGAnimDo,\r\n        undo: showPAGAnimUndo,\r\n      },\r\n      showPRF: {\r\n        do: showPRFAnimDo,\r\n        undo: showPRFAnimUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  return {\r\n    initShowLocationAnimGroup,\r\n    initChartAnimGroup,\r\n    initBucketsFillAnim,\r\n    initMoveBucketsAnim,\r\n    initDropFillAnim,\r\n    initChangeRealityAnim,\r\n    initFillVarDropsAnim,\r\n    initShowScenLabelAnim,\r\n    initHighlightBestAnim,\r\n    initShowQuantilesAnim,\r\n    initComparerAnimGroup,\r\n  };\r\n}\r\n\r\nexport const animations = initAllAnims();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\n\r\nexport function createInterpsFromDelivs(delivs, minDelivs, maxDelivs) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(\r\n      delivs.map((v) => Math.min(1, (v - minDelivs) / (maxDelivs - minDelivs)))\r\n    )\r\n    .clamp(true);\r\n}\r\n\r\n// TODO fix colors\r\nexport function calcDomLev(levs) {\r\n  levs = [1, ...levs, 0];\r\n\r\n  let mean = 0;\r\n  for (let i = 0; i < levs.length - 1; i++) {\r\n    const dif = levs[i] - levs[i + 1];\r\n    mean += (dif * (i - 1)) / (levs.length + 4);\r\n  }\r\n\r\n  return mean;\r\n}\r\n\r\n// TODO combine these arrays to just one array of objects\r\nexport const SETT_NAME_SHORT = [\"D\", \"C\", \"P\", \"R\", \"M\"];\r\nexport const SETT_NAME_FULL = [\r\n  \"Demand\",\r\n  \"Carryover\",\r\n  \"Priority\",\r\n  \"Regs.\",\r\n  \"Min. Flow\",\r\n];\r\nexport const SETT_VAL_STEPS = [\r\n  [1, 0.9, 0.8, 0.7, 0.6].reverse(), // demand\r\n  [1.0, 1.2, 1.3], // carryover\r\n  [0, 1], // priority\r\n  [1, 2, 3, 4], // regs\r\n  [0, 0.4, 0.6, 0.7, 0.8], // minflow\r\n];\r\n\r\nexport const SETT_NUM_OPTS = {\r\n  demand: SETT_VAL_STEPS[0].length,\r\n  carryover: SETT_VAL_STEPS[1].length,\r\n  priority: SETT_VAL_STEPS[2].length,\r\n  regs: SETT_VAL_STEPS[3].length,\r\n  minflow: SETT_VAL_STEPS[4].length,\r\n};\r\n\r\nexport const SETT_DESC = [\r\n  String.raw`Reduce total agriculture demands\r\n(1) Reduce 40%\r\n(2) Reduce 30%\r\n(3) Reduce 20%\r\n(4) Reduce 10%\r\n(5) Baseline`,\r\n\r\n  String.raw`Modify balance of reservoir storage and delivery\r\n(1) Baseline\r\n(2) Increase carryover (relative to delivery) 10%\r\n(3) Increase carryover to 20%`,\r\n\r\n  String.raw`Modify how CVP cuts are distributed during times of shortage\r\n(1) Baseline\r\n(2) Equal cuts`,\r\n\r\n  String.raw`Selective removal/activation of D1641 regulations\r\n(1) Baseline (all \"on\")\r\n(2) No NDO, Rio Vista min flows\r\n(3) No X2/salinity\r\n(4) Combined no NDO + no X2`,\r\n\r\n  String.raw`Modify/add minimum flow on Central Valley tributaries\r\n(1) Baseline\r\n(2) 40% unimpaired flow on main tributaries\r\n(3) 60% unimpaired flow\r\n(4) 70% unimpaired flow\r\n(5) 80% unimpaired flow`,\r\n];\r\n\r\nexport function deserialize(scenStr) {\r\n  let scenNum = parseInt(scenStr);\r\n\r\n  const minflow = scenNum % SETT_NUM_OPTS.minflow;\r\n  scenNum = (scenNum - minflow) / SETT_NUM_OPTS.minflow;\r\n\r\n  const regs = scenNum % SETT_NUM_OPTS.regs;\r\n  scenNum = (scenNum - regs) / SETT_NUM_OPTS.regs;\r\n\r\n  const priority = scenNum % SETT_NUM_OPTS.priority;\r\n  scenNum = (scenNum - priority) / SETT_NUM_OPTS.priority;\r\n\r\n  const carryover = scenNum % SETT_NUM_OPTS.carryover;\r\n  scenNum = (scenNum - carryover) / SETT_NUM_OPTS.carryover;\r\n\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demand = scenNum % SETT_NUM_OPTS.demand;\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n\r\n  return [demandReverse, carryover, priority, regs, minflow];\r\n}\r\n\r\nexport function serialize(demand, carryover, priority, regs, minflow) {\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n  let code = 0;\r\n  code += minflow;\r\n  code += SETT_NUM_OPTS.minflow * regs;\r\n  code += SETT_NUM_OPTS.regs * SETT_NUM_OPTS.minflow * priority;\r\n  code +=\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    carryover;\r\n  code +=\r\n    SETT_NUM_OPTS.carryover *\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    demandReverse;\r\n\r\n  const finalKey = `expl${d3.format(\"0>4\")(code)}`;\r\n\r\n  return finalKey;\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { settings } from \"settings\";\r\n\r\nimport { dropCenterCorrection } from \"utils/math-utils\";\r\nimport {\r\n  DROPLET_SHAPE,\r\n  circlet,\r\n  gradientInit,\r\n  gradientUpdate,\r\n} from \"utils/render-utils\";\r\n\r\nfunction smallDropInit({ levs, id }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"small-drop hover-capture\");\r\n\r\n    const idStr = `drop-fill-${id}`;\r\n\r\n    s.call(gradientInit(levs, idStr));\r\n\r\n    s.append(\"path\").attr(\"d\", DROPLET_SHAPE).attr(\"class\", \"outline\");\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${idStr})`);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"circlet interactive\")\r\n      .call(circlet)\r\n      .attr(\"cy\", -dropCenterCorrection({ rad: 1 }))\r\n      .attr(\"r\", 1.5);\r\n\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, id, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n    s.select(\".outline\").attr(\r\n      \"transform\",\r\n      `scale(${settings.LOD_1_RAD_PX * 0.95})`\r\n    );\r\n    s.select(\".fill\").attr(\"transform\", `scale(${settings.LOD_1_RAD_PX})`);\r\n\r\n    s.select(\".circlet\").attr(\"id\", `i${id}`);\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction updateSmallDropSVG(\r\n  container,\r\n  waterdropGroup,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartLoc = ({ globalX, globalY, globalTilt }) =>\r\n    `translate(${globalX}, ${globalY}) rotate(${globalTilt})`;\r\n  const getEndLoc = ({ x, y, tilt }) =>\r\n    `translate(${waterdropGroup.x + x * settings.SPREAD_1_2}, ${\r\n      waterdropGroup.y + y * settings.SPREAD_1_2\r\n    }) rotate(${tilt})`;\r\n\r\n  const baselinePos = {};\r\n\r\n  const drops = container\r\n    .selectAll(\".small-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartLoc)\r\n    .each(function (node) {\r\n      d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n    });\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n\r\n  drops\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndLoc);\r\n\r\n  const circlePosX = waterdropGroup.x + baselinePos.x * settings.SPREAD_1_2,\r\n    circlePosY =\r\n      waterdropGroup.y +\r\n      baselinePos.y * settings.SPREAD_1_2 -\r\n      dropCenterCorrection({ rad: settings.LOD_1_RAD_PX });\r\n\r\n  const textPosX =\r\n      waterdropGroup.x + (waterdropGroup.height * settings.SPREAD_1_2) / 2,\r\n    textPosY =\r\n      waterdropGroup.y - (waterdropGroup.height * settings.SPREAD_1_2) / 2;\r\n\r\n  const fontSize = waterdropGroup.height / 20;\r\n  const lineWidth = waterdropGroup.height / 100;\r\n\r\n  container\r\n    .select(\".highlight-circle\")\r\n    .attr(\"stroke\", \"none\")\r\n    .attr(\"fill\", \"yellow\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX * 2)\r\n    .attr(\"cx\", circlePosX)\r\n    .attr(\"cy\", circlePosY);\r\n\r\n  container\r\n    .select(\".baseline-pointer path\")\r\n    .attr(\r\n      \"d\",\r\n      d3\r\n        .line()\r\n        .x((d) => d[0])\r\n        .y((d) => d[1])([\r\n        [circlePosX, circlePosY],\r\n        [textPosX, textPosY],\r\n      ])\r\n    )\r\n    .attr(\"stroke-width\", lineWidth);\r\n  container\r\n    .select(\".baseline-pointer text\")\r\n    .attr(\"class\", \"fancy-font\")\r\n    .attr(\"font-size\", fontSize)\r\n    .attr(\"transform\", `translate(${textPosX + fontSize}, ${textPosY})`);\r\n}\r\n\r\nfunction updateColorDrops(container, waterdropGroup, opacFn, color) {\r\n  container\r\n    .selectAll(\".color-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"color-drop\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX)\r\n    .attr(\"opacity\", ({ key }) => opacFn(key))\r\n    .attr(\"fill\", color)\r\n    .attr(\"cx\", ({ x }) => waterdropGroup.x + x * settings.SPREAD_1_2)\r\n    .attr(\"cy\", ({ y }) => waterdropGroup.y + y * settings.SPREAD_1_2);\r\n}\r\n\r\nexport const helpers = {\r\n  updateSmallDropSVG,\r\n  updateColorDrops,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport Matter from \"matter-js\";\r\n\r\nimport { CIRC_RAD, DROP_HEIGHT } from \"./render-utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor(Math.sqrt(AREA / 3.14));\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(\r\n  x,\r\n  y,\r\n  nodes,\r\n  packingFactor = 1,\r\n  reuse = false\r\n) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r)) / packingFactor;\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport function interp(x, a, b) {\r\n  return x * (b - a) + a;\r\n}\r\n\r\nexport function revInterp(t, a, b) {\r\n  return (t - a) / (b - a);\r\n}\r\n\r\nexport function distSq([x1, y1], [x2, y2]) {\r\n  return (x2 - x1) ** 2 + (y2 - y1) ** 2;\r\n}\r\n\r\nexport function dist([x1, y1], [x2, y2]) {\r\n  return Math.sqrt(distSq([x1, y1], [x2, y2]));\r\n}\r\n\r\nexport function getCenterDomRect(domRect) {\r\n  return [domRect.left + domRect.width / 2, domRect.top + domRect.height / 2];\r\n}\r\n\r\nexport function clipEnds([from, to], shortenByStart, shortenByEnd) {\r\n  const len = Math.sqrt((from[0] - to[0]) ** 2 + (from[1] - to[1]) ** 2);\r\n  const normed = [(to[0] - from[0]) / len, (to[1] - from[1]) / len];\r\n\r\n  if (shortenByEnd === undefined) shortenByEnd = shortenByStart;\r\n\r\n  from[0] += normed[0] * shortenByStart;\r\n  from[1] += normed[1] * shortenByStart;\r\n  to[0] -= normed[0] * shortenByEnd;\r\n  to[1] -= normed[1] * shortenByEnd;\r\n\r\n  return [from, to];\r\n}\r\n\r\nexport function dropRadToDropHeight(rad) {\r\n  return (1 + Math.SQRT2) * rad;\r\n}\r\n\r\nexport function dropCenterCorrection({ rad, height }) {\r\n  if (rad !== undefined) return dropRadToDropHeight(rad) * 0.08;\r\n  return height * 0.08;\r\n}\r\n\r\nexport function avgCoords(coords) {\r\n  return [d3.mean(coords, (c) => c[0]), d3.mean(coords, (c) => c[1])];\r\n}\r\n\r\nexport function rotatePoint(x, y, deg) {\r\n  const vec = new THREE.Vector3(x, y, 0).applyEuler(\r\n    new THREE.Euler(0, 0, toRadians(deg))\r\n  );\r\n  return [vec.x, vec.y];\r\n}\r\n\r\n// modifies arr!\r\nexport function rotatePoints(arr, deg) {\r\n  for (const a of arr) {\r\n    const newPoint = rotatePoint(a[0], a[1], deg);\r\n    a[0] = newPoint[0];\r\n    a[1] = newPoint[1];\r\n  }\r\n  return arr;\r\n}\r\n\r\n// https://stackoverflow.com/a/2450976\r\nexport function shuffle(array) {\r\n  let currentIndex = array.length;\r\n\r\n  // While there remain elements to shuffle...\r\n  while (currentIndex != 0) {\r\n    // Pick a remaining element...\r\n    let randomIndex = Math.floor(Math.random() * currentIndex);\r\n    currentIndex--;\r\n\r\n    // And swap it with the current element.\r\n    [array[currentIndex], array[randomIndex]] = [\r\n      array[randomIndex],\r\n      array[currentIndex],\r\n    ];\r\n  }\r\n\r\n  return array;\r\n}\r\n","import { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\n// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    if (typeof v === \"function\")\r\n      _setState((curVal) => (stateRef.current = v(curVal)));\r\n    else _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n\r\nexport function isState(stateInfo, stateName) {\r\n  return stateInfo && stateInfo.state === stateName;\r\n}\r\n\r\nexport function wrap(s, len = 15) {\r\n  return s.replace(\r\n    new RegExp(`(?![^\\\\n]{1,${len}}$)([^\\\\n]{1,${len}})\\\\s`, \"g\"),\r\n    \"$1\\n\"\r\n  );\r\n}\r\n\r\nexport function genUUID() {\r\n  return Math.floor(Math.random() * 1e9);\r\n}\r\n\r\nexport function arrRemove(arr, item) {\r\n  let idx;\r\n  if (typeof item === \"function\") {\r\n    idx = arr.findIndex(item);\r\n  } else {\r\n    idx = arr.indexOf(item);\r\n  }\r\n  if (idx !== -1) arr.splice(idx, 1);\r\n  return arr;\r\n}\r\n\r\nexport function copyCoords(arr) {\r\n  return arr.map((a) => Array.from(a));\r\n}\r\n\r\n// https://www.geeksforgeeks.org/implement-search-box-with-debounce-in-javascript/\r\nexport const debounce = (fn, delay = 1000) => {\r\n  let timerId = null;\r\n  return (...args) => {\r\n    clearTimeout(timerId);\r\n    timerId = setTimeout(() => fn(...args), delay);\r\n  };\r\n};\r\n","import {\r\n  interpolateWatercolorBlue,\r\n  levelToDropletLevel,\r\n} from \"bucket-lib/utils\";\r\nimport * as d3 from \"d3\";\r\nimport { settings } from \"settings\";\r\nimport { radToDeg } from \"three/src/math/MathUtils\";\r\nimport { wrap } from \"utils/misc-utils\";\r\nimport { dist } from \"utils/math-utils\";\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport const CIRC_RAD = Math.SQRT1_2;\r\nexport const DROP_RAD = 1;\r\nexport const CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nexport const DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = (CIRC_RAD + DROP_RAD / 2) / DROP_HEIGHT;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2, subdivs = 10) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 1 / subdivs;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function circlet(s) {\r\n  s.attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke\", \"#CC8F43\")\r\n    .attr(\"stroke-dasharray\", 3)\r\n    .attr(\"stroke-width\", 3)\r\n    .attr(\"vector-effect\", \"non-scaling-stroke\");\r\n}\r\n\r\nexport function showElems(elemStr, container, displayVal) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", displayVal || \"block\");\r\n}\r\n\r\nexport function hideElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", \"none\");\r\n}\r\n\r\nexport function removeElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).remove();\r\n}\r\n\r\nexport function gradientInit(levs, gradId) {\r\n  return (s) => {\r\n    const stops = s\r\n      .append(\"defs\")\r\n      .append(\"linearGradient\")\r\n      .attr(\"id\", gradId)\r\n      .attr(\"x1\", \"0%\")\r\n      .attr(\"x2\", \"0%\")\r\n      .attr(\"y1\", \"0%\")\r\n      .attr(\"y2\", \"100%\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n    levs.forEach((_, i) => {\r\n      for (let j = 0; j < 2; j++) {\r\n        stops\r\n          .append(\"stop\")\r\n          .attr(\r\n            \"stop-color\",\r\n            interpolateWatercolorBlue(i / settings.LOD_1_LEVELS)\r\n          );\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nexport function gradientUpdate(levs, maxLev) {\r\n  return (s) => {\r\n    s.selectAll(\"stop\").each(function (_, i) {\r\n      // first stop is at 0\r\n      if (i === 0) {\r\n        d3.select(this).attr(\"offset\", `0%`);\r\n        return;\r\n      }\r\n\r\n      // last stop is at 100\r\n      if (i === (levs.length + 1) * 2 - 1) {\r\n        d3.select(this).attr(\"offset\", `100%`);\r\n        return;\r\n      }\r\n\r\n      let valOffset = Math.floor((i - 1) / 2);\r\n\r\n      d3.select(this).attr(\r\n        \"offset\",\r\n        `${(1 - levelToDropletLevel(levs[valOffset] / maxLev)) * 100}%`\r\n      );\r\n    });\r\n  };\r\n}\r\n\r\nexport function worldToScreen(x, y, camTransform) {\r\n  return [\r\n    x * camTransform.k + camTransform.x,\r\n    y * camTransform.k + camTransform.y,\r\n  ];\r\n}\r\n\r\nexport function screenToWorld(x, y, camTransform) {\r\n  return [\r\n    (x - camTransform.x) / camTransform.k,\r\n    (y - camTransform.y) / camTransform.k,\r\n  ];\r\n}\r\n\r\nexport function generateTSpan(text, lineHeight = 1.2, len = 15) {\r\n  return (s) => {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = typeof text === \"string\" ? wrap(text, len).split(\"\\n\") : text;\r\n\r\n    const x = s.attr(\"x\");\r\n\r\n    lines.forEach((line) => {\r\n      s.append(\"tspan\").attr(\"x\", x).attr(\"dy\", `${lineHeight}em`).text(line);\r\n    });\r\n  };\r\n}\r\n\r\nexport function getConnectStyle(from, to) {\r\n  const width = dist(from, to);\r\n  const rot = radToDeg(Math.atan2(to[1] - from[1], to[0] - from[0]));\r\n  return {\r\n    left: `${from[0]}px`,\r\n    top: `${from[1]}px`,\r\n    width: `${width}px`,\r\n    rotate: `${rot}deg`,\r\n  };\r\n}","import React from \"react\";\r\n\r\nfunction initScripts() {\r\n  return {\r\n    barsExplain: (\r\n      <>\r\n        Here, the data is presented as bar graphs, with the bottom axis\r\n        representing the year and the side axis representing the amount of water\r\n        delivered in thousand acre-feet (TAF).\r\n      </>\r\n    ),\r\n    barsCondense: (\r\n      <>\r\n        We'll condense each bar graph into a single bar with a filled gradient.\r\n      </>\r\n    ),\r\n    bucketsFill: (\r\n      <>\r\n        What we get are buckets of water showing which water levels are most\r\n        likely, with the darker areas being the most likely water levels.\r\n        <span className=\"supplement-card-info\">\r\n          Visuals made using{\" \"}\r\n          <a href=\"https://sarahayu.github.io/bucket-glyph/\" target=\"_blank\">\r\n            Bucket-Glyph\r\n          </a>\r\n        </span>\r\n      </>\r\n    ),\r\n    comparingTheTwo: (\r\n      <>\r\n        If we want a reliable supply we would want the refuge group's\r\n        deliveries, but if we want a chance at higher supplies of water however\r\n        with more inconsistent results, we would want the agriculture group's\r\n        deliveries.\r\n      </>\r\n    ),\r\n    forNowLetsFocus: (\r\n      <>\r\n        There is a chance 600 TAF of water will be delivered to this group. The\r\n        darker colors, however, indicate that it's more likely that slightly\r\n        less than 600 TAF of water will be delivered  around 500 TAF. As we'll\r\n        later see, this is not a lot compared to other areas of California.\r\n      </>\r\n    ),\r\n    ifChangeReality: (\r\n      <>\r\n        But what if we could <em>change reality</em>? What if we could increase\r\n        the likelihood of delivering as much water as possible by changing the\r\n        way we manage it?\r\n      </>\r\n    ),\r\n    fortunateCanExplore: (\r\n      <>\r\n        Fortunately, we can explore those possibilities with the help of a\r\n        simulator called\r\n        <b> CalSim</b>.\r\n      </>\r\n    ),\r\n    theseVarsCalled: (\r\n      <>\r\n        These variations are called <em>scenarios</em> and are labelled with\r\n        unique numbers. Our reality is a scenario with no variables changed,\r\n        labelled scenario 0000.\r\n      </>\r\n    ),\r\n    atAGlance: (\r\n      <>\r\n        At a glance, we can easily see that scenario 0020 appears to be the best\r\n        scenario since the darker water levels reach higher than those of the\r\n        other scenarios. To more concretely compare these scenarios, however,\r\n        we'll use a different view.\r\n      </>\r\n    ),\r\n    tryMoveRed: (\r\n      <>\r\n        Try moving the dotted line to change the minimum demand and see how well\r\n        each of these scenarios meet those demands.\r\n      </>\r\n    ),\r\n    soWhyNot: (\r\n      <>\r\n        So why don't we just choose the best scenario? Well, it's because it's\r\n        not just this group that wants water. Other groups, which we call{\" \"}\r\n        <em>objectives</em>, want scenarios that best fit <em>them.</em>\r\n      </>\r\n    ),\r\n    letsBringRefuge: (\r\n      <>\r\n        The scenarios that benefit one objective do not always benefit another.\r\n        Hover over the waterdrops to see how the same scenarios place for each\r\n        objective. (Can you find a scenario that benefits both?)\r\n      </>\r\n    ),\r\n  };\r\n}\r\n\r\nexport const scripts = initScripts();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact, levelToDropletLevel } from \"bucket-lib/utils\";\r\n\r\nimport { objectivesData } from \"data/objectives-tutorial-data\";\r\n\r\nfunction initConstants() {\r\n  const BAR_CHART_WIDTH = 500,\r\n    BAR_CHART_HEIGHT = 400;\r\n\r\n  const INTERP_COLOR = d3.interpolateRgbBasis([\r\n    \"#F2F5FB\",\r\n    \"#D0DDEB\",\r\n    \"#7B9BC0\",\r\n    \"#4F739F\",\r\n    \"#112A57\",\r\n  ]);\r\n\r\n  const PAG_OBJECTIVE = \"DEL_CVP_PAG_N\";\r\n  const PRF_OBJECTIVE = \"DEL_CVP_PRF_S\";\r\n\r\n  const PAG_COLOR = \"#808C54\";\r\n  const PRF_COLOR = \"#60A4BF\";\r\n\r\n  const DEFAULT_SCENARIO = \"expl0000\";\r\n\r\n  const PAG_DELIVS =\r\n    objectivesData.OBJECTIVES_DATA[PAG_OBJECTIVE][\r\n    objectivesData.SCENARIO_KEY_STRING\r\n    ][DEFAULT_SCENARIO][objectivesData.DELIV_KEY_STRING];\r\n  const PRF_DELIVS =\r\n    objectivesData.OBJECTIVES_DATA[PRF_OBJECTIVE][\r\n    objectivesData.SCENARIO_KEY_STRING\r\n    ][DEFAULT_SCENARIO][objectivesData.DELIV_KEY_STRING];\r\n\r\n  const VARIATIONS = [\r\n    \"expl0020\", // change priority\r\n    \"expl0080\", // increase carryover\r\n    \"expl0480\", // decrease demand\r\n    \"expl0004\", // increase minflow\r\n  ];\r\n\r\n  const VARIATIONS_DELIVS = VARIATIONS.map(\r\n    (vars) =>\r\n      objectivesData.OBJECTIVES_DATA[PAG_OBJECTIVE][\r\n      objectivesData.SCENARIO_KEY_STRING\r\n      ][vars][objectivesData.DELIV_KEY_STRING]\r\n  );\r\n\r\n  const VARIATIONS_INTERPERS = VARIATIONS_DELIVS.map(\r\n    (varDelivs) => (val) =>\r\n      levelToDropletLevel(\r\n        d3\r\n          .scaleLinear()\r\n          .domain(ticksExact(0, 1, varDelivs.length))\r\n          .range(\r\n            varDelivs\r\n              .map((v) => v / objectivesData.MAX_DELIVS)\r\n              .sort()\r\n              .reverse()\r\n          )\r\n          .clamp(true)(val)\r\n      )\r\n  );\r\n\r\n  const PAG_INTERPER = (val) =>\r\n    d3\r\n      .scaleLinear()\r\n      .domain(ticksExact(0, 1, PAG_DELIVS.length))\r\n      .range(\r\n        PAG_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n          .sort()\r\n          .reverse()\r\n      )\r\n      .clamp(true)(val);\r\n\r\n  const PAG_INTERPER_DROP = (val) =>\r\n    levelToDropletLevel(\r\n      d3\r\n        .scaleLinear()\r\n        .domain(ticksExact(0, 1, PAG_DELIVS.length))\r\n        .range(\r\n          PAG_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n            .sort()\r\n            .reverse()\r\n        )\r\n        .clamp(true)(val)\r\n    );\r\n\r\n  const PRF_INTERPER = (val) =>\r\n    d3\r\n      .scaleLinear()\r\n      .domain(ticksExact(0, 1, PRF_DELIVS.length))\r\n      .range(\r\n        PRF_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n          .sort()\r\n          .reverse()\r\n      )\r\n      .clamp(true)(val);\r\n\r\n  const DROP_VARIATIONS = [\r\n    {\r\n      idx: 0,\r\n      scen: \"0020\",\r\n      clas: \"drop1\",\r\n      desc: \"change priority\",\r\n    },\r\n    {\r\n      idx: 1,\r\n      scen: \"0080\",\r\n      clas: \"drop2\",\r\n      desc: \"increase carryover\",\r\n    },\r\n    {\r\n      idx: 2,\r\n      scen: \"0480\",\r\n      clas: \"drop3\",\r\n      desc: \"decrease demand\",\r\n    },\r\n    {\r\n      idx: 3,\r\n      scen: \"0004\",\r\n      clas: \"drop4\",\r\n      desc: \"increase minimum flow\",\r\n    },\r\n  ];\r\n\r\n  return {\r\n    BAR_CHART_WIDTH,\r\n    BAR_CHART_HEIGHT,\r\n    INTERP_COLOR,\r\n    PAG_OBJECTIVE,\r\n    PRF_OBJECTIVE,\r\n    PAG_COLOR,\r\n    PRF_COLOR,\r\n    DEFAULT_SCENARIO,\r\n    PAG_DELIVS,\r\n    PRF_DELIVS,\r\n    VARIATIONS,\r\n    VARIATIONS_DELIVS,\r\n    VARIATIONS_INTERPERS,\r\n    PAG_INTERPER,\r\n    PAG_INTERPER_DROP,\r\n    PRF_INTERPER,\r\n    DROP_VARIATIONS,\r\n  };\r\n}\r\n\r\nconst constants = initConstants();\r\n\r\nexport { constants };\r\n","import { ticksExact } from \"bucket-lib/utils\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { calcDomLev, createInterpsFromDelivs } from \"utils/data-utils\";\r\nimport { placeDropsUsingPhysics, rotatePoint } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\n// TODO optimize!!\r\nfunction initWaterdrops(objectivesData, descriptionsData, grouping) {\r\n  console.time(\"init waterdrops\");\r\n  const groupKeys =\r\n    grouping === \"objective\"\r\n      ? objectivesData.OBJECTIVE_IDS\r\n      : objectivesData.SCENARIO_IDS;\r\n  const memberKeys =\r\n    grouping === \"objective\"\r\n      ? objectivesData.SCENARIO_IDS\r\n      : objectivesData.OBJECTIVE_IDS;\r\n\r\n  const amtGroups = groupKeys.length;\r\n  const amtPerGroup = memberKeys.length;\r\n\r\n  const largeDropRad =\r\n    Math.sqrt(amtPerGroup / Math.PI) *\r\n    settings.LOD_1_RAD_PX *\r\n    2 *\r\n    settings.LOD_1_SMALL_DROP_PAD_FACTOR *\r\n    settings.LOD_1_LARGE_DROP_PAD_FACTOR;\r\n  const smallDropRad =\r\n    settings.LOD_1_RAD_PX * settings.LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  const largeNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    groupKeys.map((p, idx) => ({\r\n      r: largeDropRad,\r\n      id: idx,\r\n    })),\r\n    0.8\r\n  );\r\n\r\n  for (let i = 0; i < largeNodesPhys.length; i++) {\r\n    largeNodesPhys[i].tilt = Math.random() * 40 - 20;\r\n  }\r\n\r\n  const largeNodesPos = mapBy(largeNodesPhys, ({ id }) => id);\r\n\r\n  const smallNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    memberKeys.map((s, idx) => ({\r\n      r: smallDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const smallNodesPos = mapBy(smallNodesPhys, ({ id }) => id);\r\n\r\n  const nodes = [];\r\n  const groupNodes = [];\r\n\r\n  const groupToNodes = {};\r\n\r\n  let idx = 0;\r\n\r\n  for (const nodeData of objectivesData.FLATTENED_DATA) {\r\n    const { id, objective, scenario, deliveries } = nodeData;\r\n\r\n    const [delivMin, delivMax] = objectivesData.MIN_MAXES[objective];\r\n\r\n    const i = createInterpsFromDelivs(deliveries, delivMin, delivMax);\r\n    const wds = ticksExact(0, 1, settings.LOD_1_LEVELS + 1).map((d) => i(d));\r\n\r\n    const levs = wds.map(\r\n      (w, i) =>\r\n        Math.max(w, i == 0 ? settings.LOD_1_MIN_LEV_VAL : 0) *\r\n        settings.LOD_1_RAD_PX\r\n    );\r\n\r\n    const groupID = grouping === \"objective\" ? objective : scenario;\r\n    const memberID = grouping === \"objective\" ? scenario : objective;\r\n\r\n    const groupRank = objectivesData.DATA_GROUPINGS[grouping][groupID].rank;\r\n    const memberRank = objectivesData.DATA_GROUPINGS[grouping][groupID][id];\r\n\r\n    const localTilt = Math.random() * 50 - 25;\r\n    const parentTilt = largeNodesPos[groupRank].tilt;\r\n\r\n    const { x, y } = smallNodesPos[memberRank];\r\n    const [rotatedX, rotatedY] = rotatePoint(x, y, parentTilt);\r\n\r\n    const node = {\r\n      id,\r\n      levs,\r\n      maxLev: settings.LOD_1_RAD_PX,\r\n      domLev: calcDomLev(levs),\r\n      tilt: localTilt,\r\n      dur: Math.random() * 100 + 400,\r\n      x,\r\n      y,\r\n      group: groupID,\r\n      key: memberID,\r\n      globalX: largeNodesPos[groupRank].x + rotatedX,\r\n      globalY: largeNodesPos[groupRank].y + rotatedY,\r\n      globalTilt: parentTilt + localTilt,\r\n    };\r\n\r\n    nodes.push(node);\r\n\r\n    if (!groupToNodes[groupID]) groupToNodes[groupID] = [];\r\n\r\n    groupToNodes[groupID].push(node);\r\n  }\r\n\r\n  for (const groupKey of groupKeys) {\r\n    const { x, y, tilt } =\r\n      largeNodesPos[objectivesData.DATA_GROUPINGS[grouping][groupKey].rank];\r\n    groupNodes.push({\r\n      x,\r\n      y,\r\n      tilt,\r\n      key: groupKey,\r\n      height: smallNodesPhys.height,\r\n      nodes: groupToNodes[groupKey],\r\n      display_name: descriptionsData[groupKey].display_name || groupKey,\r\n    });\r\n  }\r\n\r\n  console.timeEnd(\"init waterdrops\");\r\n\r\n  return {\r\n    nodes: nodes,\r\n    groups: groupNodes,\r\n    height: largeNodesPhys.height,\r\n  };\r\n}\r\n\r\nexport { initWaterdrops };\r\n","import * as d3 from \"d3\";\r\n\r\nimport { spatialData } from \"data/spatial-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { dist, dropCenterCorrection, getCenterDomRect } from \"utils/math-utils\";\r\nimport { wrap } from \"utils/misc-utils\";\r\nimport { circlet } from \"utils/render-utils\";\r\n\r\nfunction interactorsInit() {\r\n  const s = d3.select(this);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"hover-capture\")\r\n    .attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke-width\", 0)\r\n    .attr(\"r\", 0.8);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"circlet interactive\")\r\n    .call(circlet)\r\n    .attr(\"r\", 1);\r\n\r\n  const textGroup = s.append(\"g\").attr(\"pointer-events\", \"none\");\r\n  textGroup\r\n    .append(\"image\")\r\n    .attr(\"href\", \"glow.png\")\r\n    .attr(\"preserveAspectRatio\", \"none\")\r\n    .attr(\"opacity\", 0.8);\r\n  textGroup\r\n    .append(\"text\")\r\n    .attr(\"class\", \"fancy-font cloud-text\")\r\n    .attr(\"text-anchor\", \"middle\")\r\n    .attr(\"font-size\", 0);\r\n}\r\n\r\nfunction interactorsUpdate(d) {\r\n  d3.select(this).select(\".circlet\").attr(\"id\", `b${d.key}`);\r\n  d3.select(this).select(\"text\").call(textUpdate(d));\r\n}\r\n\r\nfunction textUpdate(d) {\r\n  return function (s) {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = wrap(d.display_name).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      s.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", `${-lines.length / 2 + 0.5}em`)\r\n        .attr(\"dy\", `${i}em`)\r\n        .text(line);\r\n    });\r\n  };\r\n}\r\n\r\nfunction dropTransform({ x, y, height }) {\r\n  return `translate(${x}, ${y - dropCenterCorrection({ height })}) scale(${\r\n    height * settings.GROUP_HOVER_AREA_FACTOR\r\n  })`;\r\n}\r\n\r\nfunction getFontSize(d, transformZoom, cameraHeight, waterdropsHeight) {\r\n  const MAX_RAD = window.innerHeight / 9;\r\n\r\n  const zoomRel = cameraHeight / waterdropsHeight / transformZoom;\r\n\r\n  const absFontSize = (_d) =>\r\n    _d > MAX_RAD\r\n      ? 0\r\n      : d3.scaleLinear().domain([0, MAX_RAD]).range([1, 0.4]).clamp(true)(_d);\r\n\r\n  return absFontSize(d * zoomRel) * Math.min(zoomRel, 0.4);\r\n}\r\n\r\nfunction drawMinimapSVG() {\r\n  const width = 250,\r\n    height = 300;\r\n\r\n  const minimap = d3\r\n    .select(\"#minimap\")\r\n    .attr(\"width\", width)\r\n    .attr(\"height\", height);\r\n\r\n  const proj = d3\r\n    .geoMercator()\r\n    .scale(1000)\r\n    .center(spatialData.CALIFORNIA_CENTER)\r\n    .translate([width / 2, height / 2]);\r\n\r\n  const lineGeom = [\r\n    ...spatialData.SPATIAL_DATA.features.filter(\r\n      (f) => f.geometry.type === \"MultiPolygon\"\r\n    ),\r\n    spatialData.CALIFORNIA_OUTLINE,\r\n  ];\r\n  const pointGeom = spatialData.SPATIAL_DATA.features.filter(\r\n    (f) => f.geometry.type === \"MultiPoint\"\r\n  );\r\n\r\n  minimap\r\n    .selectAll(\"path\")\r\n    .data(lineGeom)\r\n    .join(\"path\")\r\n    .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"stroke\", \"transparent\")\r\n    .attr(\"stroke-width\", 1)\r\n    .attr(\"fill\", (d) => (d.properties.CalLiteID ? \"transparent\" : \"white\"))\r\n    .style(\"filter\", (d) =>\r\n      d.properties.CalLiteID\r\n        ? \"none\"\r\n        : \"drop-shadow(6px 6px 18px rgba(0, 0, 0, 0.1))\"\r\n    );\r\n\r\n  minimap\r\n    .selectAll(\"circle\")\r\n    .data(pointGeom)\r\n    .join(\"circle\")\r\n    .each(function (d) {\r\n      const s = d3.select(this);\r\n\r\n      const [x, y] = proj(d.geometry.coordinates[0]);\r\n\r\n      s.attr(\"cx\", x);\r\n      s.attr(\"cy\", y);\r\n    })\r\n    .attr(\"r\", 2)\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"fill\", \"transparent\");\r\n}\r\n\r\nfunction updateLargeDropSVG(\r\n  container,\r\n  waterdrops,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const drops = container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdrops.groups, ({ key }) => key)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(interactorsInit);\r\n    })\r\n    .each(interactorsUpdate)\r\n    .attr(\"transform\", dropTransform)\r\n    .select(\".hover-capture\");\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      d3.select(this.parentNode).raise();\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n}\r\n\r\nfunction fontSizer(transformInfo, camera, waterdropsHeight) {\r\n  return function () {\r\n    const tNode = d3.select(this).node();\r\n\r\n    const [posx, posy] = getCenterDomRect(tNode.getBoundingClientRect());\r\n\r\n    const width = ((tNode.getBBox().width * camera.height) / camera.far) * 8,\r\n      height = ((tNode.getBBox().height * camera.height) / camera.far) * 10;\r\n\r\n    const dis = dist(\r\n      [posx, posy],\r\n      [transformInfo.mouseX, transformInfo.mouseY]\r\n    );\r\n\r\n    d3.select(this).attr(\r\n      \"font-size\",\r\n      getFontSize(dis, transformInfo.zoom, camera.height, waterdropsHeight)\r\n    );\r\n\r\n    d3.select(this.parentNode.parentNode)\r\n      .select(\"image\")\r\n      .attr(\"x\", -width / 2)\r\n      .attr(\"y\", -height / 2)\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n  };\r\n}\r\n\r\nfunction fadeOutDrops(dropsMesh, scene, startOpac, duration) {\r\n  const t = d3.timer((elapsed) => {\r\n    const et = Math.min(1, elapsed / duration);\r\n\r\n    dropsMesh.updateVisibility(1 - et);\r\n    dropsMesh.updateOutlineVisibility(startOpac * (1 - et));\r\n\r\n    if (et >= 1) {\r\n      t.stop();\r\n      dropsMesh.remove(scene);\r\n    }\r\n  });\r\n}\r\n\r\nexport const helpers = {\r\n  drawMinimapSVG,\r\n  updateLargeDropSVG,\r\n  fontSizer,\r\n  fadeOutDrops,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingStickers from \"components/SceneSettingStickers\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { hideElems, removeElems, showElems } from \"utils/render-utils\";\r\nimport { createInterpsFromDelivs, deserialize } from \"utils/data-utils\";\r\nimport { helpers } from \"utils/compareview-helpers\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\nimport DropletGlyph from \"components/DropletGlyph\";\r\n\r\nexport default function CompareView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n\r\n  const groupsRef = useRef();\r\n  const centerRef = useRef();\r\n\r\n  const getScreenDropHeight = () =>\r\n    groupsRef.current.groups[0].height * settings.SPREAD_1_2;\r\n\r\n  useEffect(function initialize() {\r\n    const container = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"compare-group\");\r\n\r\n    container.append(\"text\").attr(\"id\", \"member-variable\");\r\n    container.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    appCtx.addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"CompareView\")) {\r\n        const container = d3.select(\"#compare-group\");\r\n\r\n        const { viewCenter, transitionDuration = 0 } = appCtx.state;\r\n\r\n        centerRef.current = viewCenter;\r\n\r\n        groupsRef.current = helpers.getWaterdropGroups(\r\n          appCtx.activeWaterdrops,\r\n          appCtx.waterdrops,\r\n          viewCenter\r\n        );\r\n\r\n        helpers.updateDropsSVG(\r\n          container,\r\n          groupsRef.current,\r\n          transitionDuration / 5,\r\n          {\r\n            onHover: (d) => {\r\n              setActiveMinidrop({ key: d.key });\r\n            },\r\n          }\r\n        );\r\n\r\n        hideElems(\r\n          \".large-green-text, .baseline-pointer, .circlet, .comp-line, .highlight-circle\",\r\n          container\r\n        );\r\n\r\n        setTimeout(() => {\r\n          setActiveMinidrop({ key: groupsRef.current.groups[0].nodes[0].key });\r\n          showElems(\r\n            \"#member-variable, #member-label, .large-green-text, .baseline-pointer, .circlet, .comp-line, .highlight-circle\",\r\n            container\r\n          );\r\n          showElems(\".comp-settings\", d3, \"flex\");\r\n        }, transitionDuration + 500);\r\n\r\n        appCtx.setGoBack(() => () => {\r\n          const transitionDuration = appCtx.resetCamera();\r\n\r\n          appCtx.setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(appCtx.camera.curTransform);\r\n\r\n        return function exitState() {\r\n          removeElems(\".large-drop, .circlet, .comp-line\", container);\r\n\r\n          hideElems(\r\n            \"#member-variable, #member-label, .baseline-pointer\",\r\n            container\r\n          );\r\n          hideElems(\".comp-settings\");\r\n\r\n          setPanels([]);\r\n          appCtx.setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines, nodes] = helpers.calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop.key\r\n        );\r\n\r\n        setPanels(makePanelsFromNodes(nodes));\r\n        helpers.updateLabelSVG(\r\n          avgCoords(positions),\r\n          activeMinidrop.key.slice(4),\r\n          getScreenDropHeight()\r\n        );\r\n        helpers.updateScenIndicatorsSVG(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#compare-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop-group\", container);\r\n        showElems(\".large-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return objectivesData.KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      helpers.updateColorDrops(\r\n        container,\r\n        groupsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop-group\", container);\r\n      hideElems(\".large-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function makePanelsFromNodes(nodes) {\r\n    return (p) => {\r\n      return nodes.map((n, i) => {\r\n        let ox = 0,\r\n          oy = 0;\r\n\r\n        if (p[i]) {\r\n          ox = p[i].offsetX;\r\n          oy = p[i].offsetY;\r\n        }\r\n\r\n        const [x, y, isLeft] = getIdealGroupPos(\r\n          groupsRef.current.groupPositions[i]\r\n        );\r\n\r\n        return {\r\n          text: n.key,\r\n          x,\r\n          y,\r\n          id: groupsRef.current.groups[i].key,\r\n          nodeID: n.id,\r\n          isLeft,\r\n          offsetX: ox,\r\n          offsetY: oy,\r\n        };\r\n      });\r\n    };\r\n  }\r\n\r\n  function getIdealGroupPos({ x, y, isLeft }) {\r\n    let newX = x,\r\n      newY = y;\r\n\r\n    const correctionX =\r\n      groupsRef.current.groups[0].height * settings.SPREAD_1_2;\r\n\r\n    if (isLeft) newX -= correctionX;\r\n    else newX += correctionX;\r\n\r\n    return [newX, newY, isLeft];\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {activeMinidrop && (\r\n        <SceneSettingStickers\r\n          settings={deserialize(activeMinidrop.key.slice(4))}\r\n          setColorSetting={setColorSetting}\r\n        />\r\n      )}\r\n      {panels.map(({ x, y, id, isLeft, offsetX, offsetY, nodeID }, i) => {\r\n        const { objective } = objectivesData.FLATTENED_DATA[nodeID];\r\n        const delivs = objectivesData.FLATTENED_DATA[nodeID].deliveries;\r\n\r\n        const [delivMin, delivMax] = objectivesData.MIN_MAXES[objective];\r\n        const interper = createInterpsFromDelivs(delivs, delivMin, delivMax);\r\n\r\n        return (\r\n          <div\r\n            className={\"panel compare-panel\" + (isLeft ? \" left\" : \"\")}\r\n            key={i}\r\n            style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n            onMouseDown={(e) => onPanelDragStart(e, { id })}\r\n          >\r\n            <div className=\"panel-main-container\">\r\n              <DotHistogram\r\n                width={420}\r\n                height={280}\r\n                data={delivs}\r\n                range={[delivMin, delivMax]}\r\n                goal={appCtx.goals[id]}\r\n                setGoal={(newGoal) => {\r\n                  appCtx.setGoals((g) => {\r\n                    g[id] = newGoal;\r\n                    return { ...g };\r\n                  });\r\n                }}\r\n              />\r\n              <DropletGlyph\r\n                levelInterp={interper}\r\n                height={200}\r\n                resolution={4}\r\n              />\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingSubcard from \"components/SceneSettingSubcard\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport {\r\n  generateTSpan,\r\n  hideElems,\r\n  removeElems,\r\n  showElems,\r\n} from \"utils/render-utils\";\r\nimport { createInterpsFromDelivs, deserialize } from \"utils/data-utils\";\r\nimport { clipEnds } from \"utils/math-utils\";\r\nimport { helpers } from \"utils/examineview-helpers\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\nimport DropletGlyph from \"components/DropletGlyph\";\r\nimport { ConnectLine } from \"components/ConnectLine\";\r\n\r\nexport default function ExamineView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const activeMinidropsRef = useRef([]);\r\n  const curMinidropsRef = useRef(null);\r\n\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, panelsRef, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n  const [hoveredCard, setHoveredCard] = useState(null);\r\n  const removePreviewRef = useRef(null);\r\n\r\n  useEffect(function initialize() {\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"examine-group\");\r\n\r\n    svgGroup\r\n      .append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"opacity\", 0);\r\n\r\n    svgGroup\r\n      .append(\"g\")\r\n      .attr(\"class\", \"baseline-pointer\")\r\n      .call(function (s) {\r\n        s.append(\"path\");\r\n        s.append(\"text\").text(\"baseline\");\r\n      })\r\n      .attr(\"opacity\", 0);\r\n\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"instruction-text large-green-text fancy-font\");\r\n    svgGroup.append(\"text\").attr(\"class\", \"drop-label fancy-font\");\r\n\r\n    appCtx.addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"ExamineView\")) {\r\n        const { transitionDuration = 0 } = appCtx.state;\r\n        const container = d3.select(\"#examine-group\");\r\n        curMinidropsRef.current = appCtx.waterdrops.groups.find(\r\n          (g) => g.key === appCtx.activeWaterdrops[0]\r\n        );\r\n\r\n        helpers.updateSmallDropSVG(\r\n          container,\r\n          curMinidropsRef.current,\r\n          transitionDuration / 2,\r\n          {\r\n            onClick: updateActiveMinidrops,\r\n            onHover: hoverDrop,\r\n            onUnhover: unhoverDrop,\r\n          }\r\n        );\r\n\r\n        setTimeout(showAdditionalInfo, transitionDuration * 1.2);\r\n\r\n        appCtx.setGoBack(() => () => {\r\n          const transitionDuration = appCtx.resetCamera();\r\n\r\n          appCtx.setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(appCtx.camera.curTransform);\r\n        showElems(\"#examine-group\");\r\n\r\n        return function exitState() {\r\n          removeElems(\".small-drop, .circlet\", container);\r\n          hideElems(\"#examine-group\");\r\n          d3.selectAll(\r\n            \"#examine-group .instruction-text, #examine-group .drop-label, #examine-group .highlight-circle, #examine-group .baseline-pointer\"\r\n          ).attr(\"opacity\", 0);\r\n\r\n          setPanels([]);\r\n          activeMinidropsRef.current = [];\r\n          curMinidropsRef.current = null;\r\n          appCtx.setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#examine-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop\", container);\r\n        showElems(\".small-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return objectivesData.KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      helpers.updateColorDrops(\r\n        container,\r\n        curMinidropsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop\", container);\r\n      hideElems(\".small-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function showAdditionalInfo() {\r\n    const instrFontSize =\r\n      (curMinidropsRef.current.height * settings.SPREAD_1_2) / 20;\r\n\r\n    d3.select(\"#examine-group .instruction-text\")\r\n      .attr(\r\n        \"x\",\r\n        curMinidropsRef.current.x -\r\n          curMinidropsRef.current.height * settings.SPREAD_1_2 * 0.8\r\n      )\r\n      .attr(\"y\", curMinidropsRef.current.y - instrFontSize)\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", instrFontSize)\r\n      .call(\r\n        generateTSpan(\r\n          [\"click to keep panels open.\", \"you can drag panels.\"],\r\n          1.6\r\n        )\r\n      )\r\n      .call((s) => {\r\n        s.transition().attr(\"opacity\", 1);\r\n      })\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * instrFontSize);\r\n      });\r\n\r\n    const labelFontSize =\r\n      (curMinidropsRef.current.height * settings.SPREAD_1_2) / 15;\r\n\r\n    d3.select(\"#examine-group .drop-label\")\r\n      .attr(\"x\", curMinidropsRef.current.x)\r\n      .attr(\r\n        \"y\",\r\n        curMinidropsRef.current.y +\r\n          (curMinidropsRef.current.height / 2) * settings.SPREAD_1_2 * 0.9\r\n      )\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"font-size\", labelFontSize)\r\n      .call(generateTSpan(curMinidropsRef.current.display_name, 1.2, 30))\r\n      .transition()\r\n      .attr(\"opacity\", 1);\r\n\r\n    d3.selectAll(\r\n      \"#examine-group .highlight-circle, #examine-group .baseline-pointer\"\r\n    )\r\n      .attr(\"opacity\", 0)\r\n      .transition()\r\n      .attr(\"opacity\", 1);\r\n  }\r\n\r\n  function addDetailPanel(dropId, preview = false, forceReplace = false) {\r\n    const { x: groupX, y: groupY } = curMinidropsRef.current;\r\n    const { x, y, id, key } = appCtx.waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      if (p.findIndex(({ id: pid }) => id === pid) !== -1) {\r\n        if (!forceReplace) return p;\r\n\r\n        arrRemove(p, (_p) => _p.id === id);\r\n      }\r\n      const newPanel = {\r\n        text: key.slice(4),\r\n        x: groupX + x * settings.SPREAD_1_2,\r\n        y: groupY + y * settings.SPREAD_1_2,\r\n        offsetX: 20,\r\n        offsetY: 40,\r\n        id,\r\n        preview,\r\n        panelKey: preview ? -1 : dropId,\r\n      };\r\n\r\n      return [...p, newPanel];\r\n    });\r\n  }\r\n\r\n  function removeDetailPanel(dropId) {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ id }) => dropId === id);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function removePreviewPanel() {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ panelKey }) => panelKey === -1);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function updateActiveMinidrops(d) {\r\n    const container = d3.select(\"#examine-group\");\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      arrRemove(activeMinidropsRef.current, d.id);\r\n      container.select(`.circlet#i${d.id}`).classed(\"active\", false);\r\n      removeDetailPanel(d.id);\r\n      setHoveredCard(null);\r\n    } else {\r\n      removeDetailPanel(d.id);\r\n      activeMinidropsRef.current.push(d.id);\r\n      container.select(`.circlet#i${d.id}`).classed(\"active\", true);\r\n      addDetailPanel(d.id);\r\n      setHoveredCard(d.id);\r\n    }\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      d3.select(`.examine-panel#p${d.id}`).style(\"z-index\", 100);\r\n      setHoveredCard(d.id);\r\n    } else {\r\n      if (removePreviewRef.current) {\r\n        clearTimeout(removePreviewRef.current);\r\n        removePreviewPanel();\r\n      }\r\n      addDetailPanel(d.id, true);\r\n    }\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    if (!activeMinidropsRef.current.includes(d.id)) {\r\n      removePreviewRef.current = setTimeout(() => {\r\n        removeDetailPanel(d.id);\r\n        removePreviewRef.current = null;\r\n      }, 100);\r\n    }\r\n\r\n    setHoveredCard((hc) => (hc === d.id ? null : hc));\r\n    d3.select(`.examine-panel#p${d.id}`).style(\"z-index\", 0);\r\n  }\r\n\r\n  function drawLineConnect(id) {\r\n    if (panelsRef.current.findIndex(({ id: pid }) => id === pid) === -1) return;\r\n\r\n    const { x: circleX, y: circleY } = panelsRef.current.find(\r\n      (p) => p.id === id\r\n    );\r\n\r\n    const [cx, cy] = appCtx.camera.worldToScreen(circleX, circleY);\r\n\r\n    const panelBox = d3\r\n      .select(`.examine-panel#p${id}`)\r\n      .node()\r\n      .getBoundingClientRect();\r\n    const [px, py] = [\r\n      panelBox.left + panelBox.width / 2,\r\n      panelBox.top + panelBox.height / 2,\r\n    ];\r\n\r\n    const diffX = px - cx;\r\n    const diffY = py - cy;\r\n\r\n    let left, top;\r\n    const margin = 5;\r\n\r\n    if (Math.abs(diffX) > Math.abs(diffY)) {\r\n      top = 0;\r\n      left = (diffX < 0 ? 1 : -1) * (panelBox.width / 2 - margin);\r\n    } else {\r\n      left = 0;\r\n      top = (diffY < 0 ? 1 : -1) * (panelBox.height / 2 - margin);\r\n    }\r\n\r\n    const line = clipEnds(\r\n      [\r\n        [cx, cy],\r\n        [px + left, py + top],\r\n      ],\r\n      8,\r\n      0\r\n    );\r\n\r\n    return line;\r\n  }\r\n\r\n  if (isState(appCtx.state, \"ExamineView\")) {\r\n    return (\r\n      <>\r\n        {panels.map(\r\n          ({ text, x, y, id, offsetX, offsetY, panelKey, preview }) => {\r\n            const { objective, scenario } = objectivesData.FLATTENED_DATA[id];\r\n            const delivs = objectivesData.FLATTENED_DATA[id].deliveries;\r\n\r\n            const [delivMin, delivMax] = objectivesData.MIN_MAXES[objective];\r\n            const interper = createInterpsFromDelivs(\r\n              delivs,\r\n              delivMin,\r\n              delivMax\r\n            );\r\n\r\n            return (\r\n              <div\r\n                className={`panel examine-panel ${preview ? \"preview\" : \"\"}`}\r\n                id={`p${id}`}\r\n                key={preview ? -1 : id}\r\n                style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n                onMouseDown={(e) => !preview && onPanelDragStart(e, { id })}\r\n                onMouseEnter={() => !preview && hoverDrop({ id })}\r\n                onMouseLeave={() => !preview && unhoverDrop({ id })}\r\n              >\r\n                <div className=\"panel-tab\">\r\n                  scenario <span>{text}</span>\r\n                </div>\r\n                <div className=\"panel-main-container\">\r\n                  <DotHistogram\r\n                    width={480}\r\n                    height={320}\r\n                    data={delivs}\r\n                    range={[delivMin, delivMax]}\r\n                    goal={appCtx.goals[appCtx.activeWaterdrops[0]]}\r\n                    setGoal={(newGoal) => {\r\n                      appCtx.setGoals((g) => {\r\n                        g[appCtx.activeWaterdrops[0]] = newGoal;\r\n                        return { ...g };\r\n                      });\r\n                    }}\r\n                  />\r\n                  <DropletGlyph\r\n                    levelInterp={interper}\r\n                    height={200}\r\n                    resolution={4}\r\n                  />\r\n                </div>\r\n                <SceneSettingSubcard\r\n                  settings={deserialize(text)}\r\n                  setColorSetting={setColorSetting}\r\n                />\r\n              </div>\r\n            );\r\n          }\r\n        )}\r\n        {hoveredCard && (\r\n          <ConnectLine connectLine={drawLineConnect(hoveredCard)} />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { useContext, useLayoutEffect } from \"react\";\r\nimport { Step } from \"react-scrollama\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { useDataStory } from \"hooks/useDataStory\";\r\nimport { hideElems } from \"utils/render-utils\";\r\n\r\nimport { CallToExploreSection } from \"components/CallToExploreSection\";\r\nimport { CardBBox } from \"components/CardBBox\";\r\nimport { CompareBigDroplets } from \"components/CompareBigDroplets\";\r\nimport { CompareBucketCreationsBackground } from \"components/CompareBucketCreationsBackground\";\r\nimport { CompareScenariosGraphics } from \"components/CompareScenariosGraphics\";\r\nimport { DataStoryScrollama } from \"components/DataStoryScrollama\";\r\nimport { PointGroups } from \"components/PointGroups\";\r\nimport { TutHero } from \"components/TutHero\";\r\nimport { descriptionsData } from \"data/descriptions-tutorial-data\";\r\nimport { objectivesData } from \"data/objectives-tutorial-data\";\r\nimport { initWaterdrops } from \"utils/waterdrop-utils\";\r\n\r\nconst tutorialWaterdrops = initWaterdrops(\r\n  objectivesData,\r\n  descriptionsData,\r\n  \"objective\"\r\n);\r\n\r\nexport default function TutorialView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const { hookAnimations, getSlidesInRange, storyVars } = useDataStory(\r\n    tutorialWaterdrops,\r\n    appCtx.camera\r\n  );\r\n\r\n  useLayoutEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"TutorialView\")) {\r\n        hideElems(\r\n          \".bucket-wrapper, .vardrop, .var-scen-label, .vardrop .dot-histogram-wrapper, .main-histogram, .tut-comparer-graphics-wrapper\"\r\n        );\r\n\r\n        hookAnimations();\r\n\r\n        return function exitState() {\r\n          appCtx.resetCamera(false);\r\n          hideElems(\".tutorial-view\");\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  if (!isState(appCtx.state, \"TutorialView\")) return;\r\n\r\n  return (\r\n    <div className=\"tutorial-view\">\r\n      <TutHero appCtx={appCtx} />\r\n      <div className=\"scrollama scrollama-create-buckets\">\r\n        <CompareBucketCreationsBackground\r\n          appCtx={appCtx}\r\n          storyVars={storyVars}\r\n        />\r\n        <DataStoryScrollama>\r\n          {getSlidesInRange(\"barsExplain\", \"comparingTheTwo\").map(\r\n            (slide, i) => (\r\n              <Step key={i} data={slide}>\r\n                <CardBBox id={`card${slide.idx}`}>{slide.script}</CardBBox>\r\n              </Step>\r\n            )\r\n          )}\r\n        </DataStoryScrollama>\r\n      </div>\r\n      <div className=\"scrollama scrollama-compare-scenobjs scenarios-section\">\r\n        <CompareScenariosGraphics\r\n          storyVars={storyVars}\r\n          size={appCtx.appHeight * 0.4}\r\n        />\r\n        <CompareBigDroplets />\r\n        <DataStoryScrollama>\r\n          {getSlidesInRange(\"forNowLetsFocus\", \"letsBringRefuge\").map(\r\n            (slide, i) => (\r\n              <Step key={i} data={slide}>\r\n                <CardBBox id={`card${slide.idx}`}>{slide.script}</CardBBox>\r\n              </Step>\r\n            )\r\n          )}\r\n        </DataStoryScrollama>\r\n      </div>\r\n      <CallToExploreSection\r\n        onClick={() => appCtx.setState({ state: \"WideView\" })}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport fuzzysort from \"fuzzysort\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { spatialData } from \"data/spatial-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { avgCoords, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport { generateTSpan, hideElems, showElems } from \"utils/render-utils\";\r\nimport { helpers } from \"utils/wideview-helpers\";\r\nimport { ActionButtons } from \"components/ActionButtons\";\r\n\r\nexport default function WideView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const [curScreenTransform, setCurScreenTransform] = useState({\r\n    zoom: 1,\r\n    mouseX: 0,\r\n    mouseY: 0,\r\n  });\r\n\r\n  const [currentHoveredDrop, setCurrentHoveredDrop] = useState(null);\r\n  const [searchPrompt, setSearchPrompt] = useState(null);\r\n\r\n  const enableZoomRef = useRef(false);\r\n  const activeDropsRef = useRef([]);\r\n\r\n  useEffect(function initialize() {\r\n    initSVGGraphics();\r\n\r\n    const cleanup = registerEventListeners();\r\n\r\n    helpers.drawMinimapSVG();\r\n\r\n    return cleanup;\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"WideView\")) {\r\n        const { transitionDuration = 0 } = appCtx.state;\r\n        d3.select(\"body\").style(\"overflow\", \"hidden\");\r\n\r\n        enableZoomRef.current = true;\r\n        setCurScreenTransform((cst) => ({\r\n          ...cst,\r\n          zoom: appCtx.camera.curTransform.k,\r\n        }));\r\n\r\n        drawTHREEGraphics();\r\n        drawSVGGraphics();\r\n\r\n        showElems(\"#infobox, #mosaic-webgl, #mosaic-svg, #wide-group\");\r\n\r\n        return function exitState() {\r\n          hideElems(\"#infobox, #wide-group\");\r\n\r\n          enableZoomRef.current = false;\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateFontSizes() {\r\n      if (enableZoomRef.current) {\r\n        d3.select(\"#wide-group\")\r\n          .selectAll(\".cloud-text\")\r\n          .each(\r\n            helpers.fontSizer(\r\n              curScreenTransform,\r\n              appCtx.camera,\r\n              appCtx.waterdrops.height\r\n            )\r\n          );\r\n      }\r\n    },\r\n    [curScreenTransform]\r\n  );\r\n\r\n  const handleClickExamine = useCallback(function () {\r\n    appCtx.setDisableCamAdjustments(true);\r\n\r\n    const { x, y, height } = activeDropsRef.current[0];\r\n\r\n    const newCamPos = [\r\n      x,\r\n      y,\r\n      appCtx.camera.getZFromFarHeight(height * settings.SPREAD_1_2 * 1.5),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = appCtx.zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        appCtx.setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    appCtx.setState({ state: \"ExamineView\", transitionDuration });\r\n\r\n    const startOpacity = appCtx.getOutlineOpacity(appCtx.camera.curTransform.k);\r\n    helpers.fadeOutDrops(\r\n      appCtx.dropsMesh,\r\n      appCtx.scene,\r\n      startOpacity,\r\n      transitionDuration / 2\r\n    );\r\n  }, []);\r\n\r\n  const handleClickCompare = useCallback(function () {\r\n    appCtx.setDisableCamAdjustments(true);\r\n\r\n    const dropsMidpoint = avgCoords(\r\n      activeDropsRef.current.map((w) => [w.x, w.y])\r\n    );\r\n\r\n    const newCamPos = [\r\n      ...dropsMidpoint,\r\n      appCtx.camera.getZFromFarHeight(\r\n        appCtx.waterdrops.groups[0].height * 2 * settings.SPREAD_1_2 * 0.75 * 2\r\n      ),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = appCtx.zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        appCtx.setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    appCtx.setState({\r\n      state: \"CompareView\",\r\n      transitionDuration,\r\n      viewCenter: dropsMidpoint,\r\n    });\r\n\r\n    const startOpacity = appCtx.getOutlineOpacity(appCtx.camera.curTransform.k);\r\n    helpers.fadeOutDrops(\r\n      appCtx.dropsMesh,\r\n      appCtx.scene,\r\n      startOpacity,\r\n      transitionDuration / 5\r\n    );\r\n  }, []);\r\n\r\n  const handleClickDeselectAll = useCallback(function () {\r\n    appCtx.setActiveWaterdrops([]);\r\n    activeDropsRef.current = [];\r\n    d3.selectAll(\"#wide-group .circlet\").classed(\"active\", false);\r\n  }, []);\r\n\r\n  function initSVGGraphics() {\r\n    hideElems(\"#infobox, #mosaic-webgl, #mosaic-svg\");\r\n\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"wide-group\");\r\n\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"instruction-text large-green-text fancy-font\")\r\n      .attr(\"x\", 0 - appCtx.waterdrops.height * 0.6);\r\n  }\r\n\r\n  function registerEventListeners() {\r\n    const cameraListener = (transform) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        zoom: transform.k,\r\n      }));\r\n    };\r\n\r\n    const mouseListener = (e) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        mouseX: e.x,\r\n        mouseY: e.y,\r\n      }));\r\n    };\r\n\r\n    appCtx.addZoomHandler(cameraListener);\r\n    window.addEventListener(\"mousemove\", mouseListener);\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener(\"mousemove\", mouseListener);\r\n    };\r\n  }\r\n\r\n  function drawTHREEGraphics() {\r\n    console.time(\"drawing\");\r\n    appCtx.dropsMesh.draw(appCtx.scene);\r\n    console.timeEnd(\"drawing\");\r\n\r\n    appCtx.dropsMesh.updateVisibility(1);\r\n    appCtx.dropsMesh.updateOutlineVisibility(\r\n      appCtx.getOutlineOpacity(appCtx.camera.curTransform.k)\r\n    );\r\n  }\r\n\r\n  function drawSVGGraphics() {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    helpers.updateLargeDropSVG(container, appCtx.waterdrops, {\r\n      onClick: updateActiveDrops,\r\n      onHover: hoverDrop,\r\n      onUnhover: unhoverDrop,\r\n    });\r\n\r\n    for (const wd of activeDropsRef.current) {\r\n      container.select(`.circlet#b${wd.key}`).classed(\"active\", true);\r\n    }\r\n\r\n    const fontSize =\r\n      (40 * appCtx.camera.getZFromFarHeight(appCtx.waterdrops.height)) /\r\n      appCtx.camera.height;\r\n    container\r\n      .select(\".instruction-text\")\r\n      .attr(\"y\", -fontSize * 5)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", fontSize)\r\n      .call(\r\n        generateTSpan(\r\n          [\"click to interact.\", \"scroll to zoom.\", \"drag to pan.\"],\r\n          2\r\n        )\r\n      )\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * fontSize);\r\n      });\r\n  }\r\n\r\n  function updateActiveDrops(d) {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    appCtx.setActiveWaterdrops((aw) => {\r\n      if (aw.includes(d.key)) {\r\n        aw = arrRemove(aw, d.key);\r\n        activeDropsRef.current = arrRemove(activeDropsRef.current, d);\r\n\r\n        container.select(`.circlet#b${d.key}`).classed(\"active\", false);\r\n      } else {\r\n        aw.push(d.key);\r\n        activeDropsRef.current.push(d);\r\n\r\n        container.select(`.circlet#b${d.key}`).classed(\"active\", true);\r\n      }\r\n      return [...aw];\r\n    });\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    setCurrentHoveredDrop({\r\n      id: d.key,\r\n      description: descriptionsData[d.key]?.desc || d.key,\r\n    });\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"gray\");\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    setCurrentHoveredDrop(null);\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"transparent\");\r\n  }\r\n\r\n  const searchResults = useMemo(() => {\r\n    if (searchPrompt === null) return [];\r\n\r\n    return fuzzysort.go(searchPrompt, appCtx.waterdrops.groups, {\r\n      keys: [\r\n        (obj) => descriptionsData[obj.key].id,\r\n        (obj) => descriptionsData[obj.key].display_name,\r\n        (obj) => descriptionsData[obj.key].desc,\r\n      ],\r\n      limit: 10,\r\n      all: true,\r\n    });\r\n  }, [searchPrompt, appCtx.waterdrops]);\r\n\r\n  return (\r\n    <>\r\n      <div id=\"infobox\">\r\n        <svg id=\"minimap\"></svg>\r\n        {currentHoveredDrop && (\r\n          <div className=\"details\">\r\n            {!spatialData.SPATIAL_FEATURES[currentHoveredDrop.id] && (\r\n              <p className=\"no-loc-data\">No Location Data</p>\r\n            )}\r\n            <p className=\"curDesc\">{currentHoveredDrop.description}</p>\r\n            <p className=\"curKey\">\r\n              id: <span> {currentHoveredDrop.id} </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n        {!currentHoveredDrop && (\r\n          <div className=\"searchbox\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"search\"\r\n              value={searchPrompt || \"\"}\r\n              onChange={(e) => setSearchPrompt(e.target.value)}\r\n              onFocus={() => {\r\n                setSearchPrompt(\"\");\r\n                d3.select(\".results\").style(\"display\", \"flex\");\r\n              }}\r\n              onBlur={() => {\r\n                setTimeout(() => {\r\n                  setSearchPrompt(null);\r\n                  d3.select(\".results\").style(\"display\", \"none\");\r\n                }, 100);\r\n              }}\r\n            ></input>\r\n            <div className=\"results\" style={{ display: \"none\" }}>\r\n              {searchResults.map(({ obj: wd }) => (\r\n                <button key={wd.key} onClick={() => updateActiveDrops(wd)}>\r\n                  {wd.display_name}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"action-btn-wrapper\">\r\n        <ActionButtons\r\n          appCtx={appCtx}\r\n          handleClickExamine={handleClickExamine}\r\n          handleClickDeselectAll={handleClickDeselectAll}\r\n          handleClickCompare={handleClickCompare}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":["App","appState","useAppState","_jsxs","AppContext","Provider","value","children","className","_jsx","id","TutorialView","WideView","ExamineView","CompareView","goBack","onClick","createContext","DEGREE_SWAY","LINE_WIDTH","maskCounter","bucketGlyph","width","height","valueToLevelFn","arguments","length","undefined","d3","data","map","d","x","y","transitionSway","rects","multiplier","each","s","this","prevLevel","attr","transition","duration","delay","_","i","ease","attrTween","prevLiquidLevel","parseFloat","diff","Math","abs","t","concat","sin","min","PI","period","size","bucketShape","shapeFunc","drawBucketMask","shapeOutlineFunc","append","call","_ref","drawFunc","drawOutlineFunc","getPath","fn","path","toString","select","bucketShapeMask","context","drawBucket","drawBucketOutline","closed","bottomRight","bottomLeft","moveTo","lineTo","closePath","drawDroplet","hypToRad","SQRT2","radToHeight","rad","hyp","heightActual","arc","distributeQuantiles","numericBins","unitsPerQuantile","maxQuantiles","quantileBins","bin","round","sum","Infinity","interpolateWatercolorBlue","levelToDropletLevel","p","max","ticksExact","start","stop","count","collideOffsetter","curXOffset","isTooClose","ActionButtons","examineBtn","compareBtn","appCtx","handleClickExamine","handleClickDeselectAll","handleClickCompare","isState","state","activeWaterdrops","BiCross","_Fragment","BiNetworkChart","BucketCreationGraphics","bucketInterper","label","BucketGlyph","levelInterp","constants","BAR_CHART_HEIGHT","resolution","LEVELS","PERCENTILE_LABELS","colorInterp","GLYPH_MARGIN","svgElement","useRef","useLayoutEffect","current","liquidLevels","glyph","liquids","selectAll","join","reverseData","reverse","xOffset","labels","text","style","ref","e","CallToExploreSection","CardBBox","forwardRef","CompareBigDroplets","CompareBucketCreationsBackground","storyVars","CompareBucketCreationsText","CompareBucketCreationsGraphics","appHeight","descriptionsData","PAG_OBJECTIVE","display_name","bucketInterperPAG","PRF_OBJECTIVE","bucketInterperPRF","CompareScenariosGraphics","MainWaterdropGraphics","objectiveLabel","dropInterper","histData","PAG_DELIVS","histRange","objectivesData","MIN_MAXES","goal","userGoal","setGoal","newGoal","setUserGoal","VariationWaterdropGraphics","variations","DROP_VARIATIONS","variation","interper","variationInterpers","idx","VARIATIONS_DELIVS","ConnectLine","connectLine","getConnectStyle","DataStoryScrollama","Scrollama","offset","onStepEnter","async","_data$animHandler","direction","element","_ref2","animHandler","do","onStepExit","_data$animHandler2","_ref3","undo","onStepProgress","progress","_ref4","domain","range","threshold","numQuantiles","histBins","thresholds","ceil","binnedQuantiles","quantiles","b","push","x1","x0","NUM_CIRCLES","MARGIN","top","right","bottom","left","WATERDROP_ICON","draw","DotHistogram","shortForm","razorElement","razorAreaElement","svgSelector","circles","useMemo","dataRange","filter","scale","ticks","tickFormat","transform","clamp","ignoreFn","preventDefault","dragging","addEventListener","window","document","removeEventListener","target","razorPos","offsetX","enter","DropletGlyph","innerWidth","innerHeight","MapCalifornia","useEffect","drawnRegions","minimap","proj","center","spatialData","CALIFORNIA_CENTER","translate","lineGeom","SPATIAL_DATA","features","f","includes","properties","CalLiteID","CALIFORNIA_OUTLINE","projection","geometry","coordinates","PAG_COLOR","raise","PRF_COLOR","SceneSettingStickers","settings","setColorSetting","v","onMouseEnter","onMouseLeave","title","SETT_DESC","SETT_NAME_FULL","SETT_VAL_STEPS","j","opacity","SceneSettingSubcard","SETT_NAME_SHORT","SkipBtn","startPos","documentElement","scrollTop","curPos","opac","TutHero","setState","scen","clas","desc","initDescriptionsData","console","log","objs","fetch","json","mapBy","SCEN_DIVISOR","initObjectivesData","SCENARIO_KEY_STRING","DELIV_KEY_STRING","BASELINE_SCEN","OBJECTIVES_DATA","chosenScenarios","name","obj","shuffledScens","shuffle","sort","splice","OBJECTIVE_IDS","Object","keys","OBJECTIVE_GOALS_MAP","goalMap","SCENARIO_IDS","values","KEY_SETTINGS_MAP","optArr","SETT_NUM_OPTS","key","deserialize","slice","minmaxes","objective","baselineMax","scenario","FLATTENED_DATA","DATA_GROUPINGS","flattenedData","dataGroupings","means","deliveries","orderedDataGroupings","criteria","objScens","ids","sortedObjScens","a","sorted","mean","maxVal","delivery","flat","IDtoRank","rank","MAX_DELIVS","BASELINE_YRLY_KEY_STRING","Array","from","initSpatialData","SPATIAL_FEATURES","appWidth","waterdrops","initWaterdrops","useState","setActiveWaterdrops","setGoBack","goals","setGoals","zoomCallbacksRef","disableCamAdjustmentsRef","threeResources","renderer","setSize","time","dropsMesh","createMesh","timeEnd","querySelector","appendChild","domElement","outlineOpacity","groups","camera","create","webglElement","node","zoomFn","updateOutlineVisibility","k","cb","setAnimationLoop","render","scene","getOutlineOpacity","useCallback","val","resetCamera","animated","callback","farHeight","pos","getZFromFarHeight","transitionDuration","dur","zoomTo","callZoomFromWorldViewport","worldX","worldY","worldPos","interpolateZoomCamera","elapsed","et","callZoom","addZoomHandler","setDisableCamAdjustments","disable","useCompareLargeDrops","activeMinidrop","setActiveMinidrop","groupsRef","camCentersRef","positions","lines","compareViewHelpers","calcLinesAndPositions","textX","textY","smallTextSize","SPREAD_1_2","largeTextSize","updateLabel","avgCoords","circlet","LOD_1_RAD_PX","updateScenIndicators","initComparer","getWaterdropGroups","camMidpoint","groupPositions","camFirstDrop","firstDrop","midpoint","container","updateDropsSVG","onHover","indicatorGroup","DEFAULT_SCENARIO","hideElems","showOtherDrop","showElems","hideOtherDrop","useDataStory","slides","setSlides","useDataStoryVars","largeDropComparer","hookAnimations","deps","showLocationAnimGroup","anims","initShowLocationAnimGroup","chartAnimGroup","initChartAnimGroup","bucketsFillAnim","initBucketsFillAnim","moveBucketsAnim","initMoveBucketsAnim","dropFillAnim","initDropFillAnim","changeRealityAnim","initChangeRealityAnim","fillVarDropsAnim","initFillVarDropsAnim","showScenLabelAnim","initShowScenLabelAnim","highlightBestAnim","initHighlightBestAnim","showQuantilesAnim","initShowQuantilesAnim","comparerAnimGroup","initComparerAnimGroup","_slides","showPAG","showPRF","barsAppear","barsCondense","getSlidesInRange","to","idxFrom","idxTo","attachScripts","slide","script","scripts","setBucketInterperPAG","setBucketInterperPRF","setDropInterper","setVariationInterpers","VARIATIONS","useDragPanels","viewTransform","panels","setPanels","panelsRef","useStateRef","mouseDownInfo","startX","deltaX","deltaY","startY","find","oldOffsetX","offsetY","oldOffsetY","onPanelDragStart","clientX","clientY","getPanelStyle","screenX","screenY","worldToScreen","LOD_1_LEVELS","LOD_1_MIN_LEV_VAL","LOD_1_SMALL_DROP_PAD_FACTOR","LOD_1_LARGE_DROP_PAD_FACTOR","LOD_2_SMALL_DROP_PAD_FACTOR","GROUP_HOVER_AREA_FACTOR","SQRT1_2","WaterdropMesh","constructor","added","updateMeshes","initializeMeshes","add","outlineMesh","remove","dropsGeometry","MeshGeometry","MAX_POINTS_DROPS","outlinePoints","outlineMeshCoords","waterdropDeltaOutline","nodes","globalX","globalY","levs","maxLev","globalTilt","tilt","l1","l2","meshCoords","waterdropDelta","color","THREE","addMeshCoords","rotate","rotOutline","rotatePoints","copyCoords","dx","dy","finish","threeGeom","vertexColors","transparent","setFromPoints","material","needsUpdate","updateVisibility","MAX_POINTS_OUTLINE","_finishCreate","_classPrivateFieldLooseKey","_THREEHandleZoom","Camera","fov","near","far","defineProperty","_THREEHandleZoom2","_finishCreate2","raycaster","webglView","svgView","zoom","on","curTransform","_classPrivateFieldLooseBase","_ref5","endx","endy","endz","position","getFarHeightFromZ","tan","toRadians","z","getScaleFromZ","getZFromScale","scaleHeight","intersectObject","mouseX","mouseY","mesh","setFromCamera","screenToWorld","scaleExtent","set","numPoints","triangleIdx","setAttribute","Float32Array","positionAttribute","getAttribute","colorAttribute","v1","v2","v3","setXYZ","r","g","setDrawRange","background","antialias","initThreeResources","largeDropInit","_ref6","idStr","gradientInit","DROPLET_SHAPE","smallDropInit","largeDropUpdate","transitionDelay","isLeft","isBottom","baselinePos","generateTSpan","textUpdate","_ref7","gradientUpdate","dropBBox","getBBox","smallDropUpdate","dropCenterCorrection","circlePosX","circlePosY","textPosX","textPosY","fontSize","lineWidth","helpers","waterdropGroups","_ref8","onUnhover","_ref9","drops","parentNode","getEndGroupLoc","updateColorDrops","opacFn","_ref10","getGroupLoc","_ref11","_ref12","_ref13","keyArr","spacing","n","angle","cos","groupsObj","activeMinidropKey","group","groupPos","clipEnds","updateLabelSVG","labelText","normedTextSize","updateScenIndicatorsSVG","animations","_pagX","_prfX","_pagXAxis","_prfXAxis","_pagDataDescending","_prfDataDescending","BAR_CHART_MARGIN","svgGroup","BAR_CHART_WIDTH","dataDescending","placeFromLeft","year","padding","xaxis","tickSize","tickValues","prepareSVG","bandwidth","newWidth","bars","end","catch","then","PAG_INTERPER","PRF_INTERPER","PAG_INTERPER_DROP","classed","VARIATIONS_INTERPERS","createInterpsFromDelivs","delivs","minDelivs","maxDelivs","calcDomLev","demand","carryover","priority","regs","minflow","String","raw","_templateObject","_taggedTemplateLiteral","_templateObject2","_templateObject3","_templateObject4","_templateObject5","scenStr","scenNum","parseInt","updateSmallDropSVG","waterdropGroup","generateWaterdrop","delta","outer","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","placeDropsUsingPhysics","packingFactor","reuse","shape","bounds","Matter","minX","maxX","minY","maxY","genX","genY","points","random","contains","generateRandoPoints","WIDTH_AREA","AREA","floor","sqrt","radsToDropWidth","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","nx","ny","circle","restitution","parts","quad","centre","vertices","isStatic","cage","setParts","setCentre","world","FPS","SECS","update","retVal","CIRC_RAD","DROP_HEIGHT","dist","y1","x2","y2","distSq","getCenterDomRect","domRect","shortenByStart","shortenByEnd","len","normed","dropRadToDropHeight","c","rotatePoint","deg","vec","applyEuler","arr","newPoint","array","currentIndex","randomIndex","newObjs","groupBy","_setState","stateRef","curVal","stateInfo","stateName","wrap","replace","RegExp","arrRemove","item","findIndex","indexOf","DROP_RAD","CIRC_HEIGHT","HAT_START","yToHalfWidth","trigX","acos","yToSpriteY","spriteYToY","sy","yStart","yEnd","subdivs","Y_DELTA","rightCoords","leftCoords","dx1","dy1","dx2","dy2","v4","elemStr","displayVal","removeElems","gradId","stops","forEach","valOffset","camTransform","lineHeight","split","line","rot","radToDeg","atan2","barsExplain","bucketsFill","href","comparingTheTwo","forNowLetsFocus","ifChangeReality","fortunateCanExplore","theseVarsCalled","atAGlance","tryMoveRed","soWhyNot","letsBringRefuge","initConstants","INTERP_COLOR","PRF_DELIVS","vars","varDelivs","grouping","groupKeys","memberKeys","amtPerGroup","largeDropRad","smallDropRad","largeNodesPhys","largeNodesPos","smallNodesPhys","smallNodesPos","groupNodes","groupToNodes","nodeData","delivMin","delivMax","w","groupID","memberID","groupRank","memberRank","localTilt","parentTilt","rotatedX","rotatedY","domLev","groupKey","interactorsInit","textGroup","interactorsUpdate","dropTransform","getFontSize","transformZoom","cameraHeight","waterdropsHeight","MAX_RAD","zoomRel","_d","drawMinimapSVG","type","pointGeom","updateLargeDropSVG","fontSizer","transformInfo","tNode","posx","posy","getBoundingClientRect","dis","fadeOutDrops","startOpac","useContext","colorSetting","setCamTransform","centerRef","viewCenter","setTimeout","ox","oy","newX","newY","correctionX","getIdealGroupPos","nodeID","makePanelsFromNodes","onMouseDown","activeMinidropsRef","curMinidropsRef","hoveredCard","setHoveredCard","removePreviewRef","showAdditionalInfo","instrFontSize","labelFontSize","addDetailPanel","dropId","preview","forceReplace","groupX","groupY","pid","_p","newPanel","panelKey","removeDetailPanel","updateActiveMinidrops","hoverDrop","clearTimeout","unhoverDrop","hc","circleX","circleY","cx","cy","panelBox","px","py","diffX","diffY","drawLineConnect","tutorialWaterdrops","Step","curScreenTransform","setCurScreenTransform","currentHoveredDrop","setCurrentHoveredDrop","searchPrompt","setSearchPrompt","enableZoomRef","activeDropsRef","initSVGGraphics","cleanup","cameraListener","ti","mouseListener","registerEventListeners","cst","updateActiveDrops","wd","drawSVGGraphics","newCamPos","startZoom","startOpacity","dropsMidpoint","aw","_descriptionsData$d$k","description","searchResults","fuzzysort","limit","all","placeholder","onChange","onFocus","onBlur","display"],"sourceRoot":""}