{"version":3,"file":"static/js/805.c9abcf7b.chunk.js","mappings":"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","sources":["App.jsx","AppContext.jsx","bucket-lib/BucketGlyph.jsx","bucket-lib/quantile-histogram.js","bucket-lib/utils.js","components/DotHistogram.jsx","components/WaterdropGlyph.jsx","data/descriptions-data.jsx","data/objectives-data.jsx","data/spatial-data.jsx","settings.jsx","three-resources.jsx","utils/app-utils.jsx","utils/data-utils.jsx","utils/math-utils.jsx","utils/misc-utils.jsx","utils/render-utils.jsx","views/CompareView.jsx","views/ExamineView.jsx","views/TutorialView.jsx","views/WideView.jsx"],"sourcesContent":["import * as d3 from \"d3\";\r\n\r\nimport React, { useCallback, useEffect, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { useStateRef } from \"utils/misc-utils\";\r\nimport { initWaterdrops } from \"utils/app-utils\";\r\n\r\nimport WideView from \"views/WideView\";\r\nimport ExamineView from \"views/ExamineView\";\r\nimport TutorialView from \"views/TutorialView\";\r\nimport CompareView from \"views/CompareView\";\r\n\r\nimport {\r\n  scene,\r\n  camera,\r\n  renderer,\r\n  dropsMesh,\r\n  pointsMesh,\r\n} from \"three-resources\";\r\nimport { OBJECTIVE_IDS } from \"data/objectives-data\";\r\n\r\n// pre-calculate these so we don't lag later\r\nconst waterdrops = initWaterdrops(\"objective\");\r\n\r\nconst appWidth = window.innerWidth,\r\n  appHeight = window.innerHeight;\r\n\r\nrenderer.setSize(appWidth, appHeight);\r\n\r\nconsole.time(\"drops mesh creating\");\r\ndropsMesh.createMesh(waterdrops);\r\nconsole.timeEnd(\"drops mesh creating\");\r\n\r\n// pointsMesh.createMesh(waterdrops);\r\n\r\nexport default function App() {\r\n  const [state, setState, stateRef] = useStateRef({});\r\n  const [zoomCallbacks, setZoomCallbacks, zoomCallbacksRef] = useStateRef([]);\r\n  const [activeWaterdrops, setActiveWaterdrops] = useState([]);\r\n  const [goBack, setGoBack] = useState(null);\r\n  const [\r\n    disableCamAdjustments,\r\n    setDisableCamAdjustments,\r\n    disableCamAdjustmentsRef,\r\n  ] = useStateRef(false);\r\n  const [goals, setGoals] = useState(() => {\r\n    const goalMap = {};\r\n    for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n      goalMap[OBJECTIVE_IDS[i]] = 200;\r\n    return goalMap;\r\n  });\r\n\r\n  const getOutlineOpac = useCallback(\r\n    d3\r\n      .scaleLinear()\r\n      .domain([\r\n        appHeight / waterdrops.height,\r\n        appHeight / waterdrops.groups[0].height,\r\n      ])\r\n      .range([0.1, 1])\r\n      .clamp(true),\r\n    []\r\n  );\r\n\r\n  useEffect(function initialize() {\r\n    document.querySelector(\"#mosaic-webgl\").appendChild(renderer.domElement);\r\n\r\n    d3.select(\"#mosaic-svg\").attr(\"width\", appWidth).attr(\"height\", appHeight);\r\n\r\n    camera.mount(\r\n      d3.select(\".bubbles-wrapper\").node(),\r\n      d3.select(\"#mosaic-svg\").select(\".svg-trans\").node()\r\n    );\r\n    camera.setZoomFn((transform) => {\r\n      if (!disableCamAdjustmentsRef.current) {\r\n        dropsMesh.updateOutlineVisibility(getOutlineOpac(transform.k));\r\n      }\r\n\r\n      for (const cb of zoomCallbacksRef.current) cb(transform);\r\n    });\r\n    camera.setSize(appWidth, appHeight);\r\n\r\n    renderer.setAnimationLoop(() => {\r\n      renderer.render(scene, camera.camera);\r\n    });\r\n\r\n    resetCamera(false);\r\n    setState({ state: \"TutorialView\" });\r\n  }, []);\r\n\r\n  const resetCamera = useCallback(function (animated = true, callback) {\r\n    const pos = [\r\n      0,\r\n      -waterdrops.height * 0.08,\r\n      camera.getZFromFarHeight(waterdrops.height),\r\n    ];\r\n    if (animated) {\r\n      const { start } = zoomTo(pos, callback);\r\n      start();\r\n    } else {\r\n      camera.callZoomFromWorldViewport({\r\n        worldX: pos[0],\r\n        worldY: -pos[1],\r\n        farHeight: waterdrops.height,\r\n      });\r\n      callback && callback();\r\n    }\r\n  }, []);\r\n\r\n  const zoomTo = useCallback(function (xyz, callback) {\r\n    const i = camera.interpolateZoomCamera(xyz);\r\n\r\n    const duration = i.duration / 2;\r\n\r\n    const start = () => {\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(elapsed / duration, 1);\r\n        camera.callZoom(i(et));\r\n\r\n        if (et === 1) {\r\n          t.stop();\r\n          callback && callback();\r\n        }\r\n      });\r\n    };\r\n\r\n    return {\r\n      start,\r\n      duration,\r\n    };\r\n  }, []);\r\n\r\n  const addZoomHandler = useCallback(function (cb) {\r\n    setZoomCallbacks((cbs) => [...cbs, cb]);\r\n  }, []);\r\n\r\n  return (\r\n    <AppContext.Provider\r\n      value={{\r\n        appWidth,\r\n        appHeight,\r\n        state,\r\n        setState,\r\n        activeWaterdrops,\r\n        setActiveWaterdrops,\r\n        setDisableCamAdjustments,\r\n        waterdrops,\r\n        scene,\r\n        camera,\r\n        renderer,\r\n        pointsMesh,\r\n        dropsMesh,\r\n        setGoBack,\r\n        zoomTo,\r\n        resetCamera,\r\n        getOutlineOpac,\r\n        addZoomHandler,\r\n        goals,\r\n        setGoals,\r\n      }}\r\n    >\r\n      <div className=\"bubbles-wrapper\">\r\n        <div id=\"mosaic-webgl\" style={{ display: \"none\" }}></div>\r\n        <svg id=\"mosaic-svg\" style={{ display: \"none\" }}>\r\n          <g className=\"svg-trans\"></g>\r\n        </svg>\r\n      </div>\r\n      <TutorialView />\r\n      <WideView />\r\n      <ExamineView />\r\n      <CompareView />\r\n      {goBack && (\r\n        <button className=\"go-back-btn\" onClick={goBack}>\r\n          \r\n        </button>\r\n      )}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n","import { createContext } from \"react\";\r\n\r\nexport const AppContext = createContext({});\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  bucketPath,\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"./utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nexport default function BucketGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () =>\r\n      ticksExact(0, 1 - 1 / resolution, resolution).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    svgContainer\r\n      .select(\".bucket-mask-path\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight));\r\n\r\n    svgContainer\r\n      .select(\".bucket-outline\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight).split(\"z\")[0]);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / (resolution - 1)));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"bucket-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { quantileBins, ticksExact } from \"./utils\";\r\n\r\nexport function getQuantileBins(data, domain, unitsPerQuantile, width, height) {\r\n  const numQuantiles = data.length / unitsPerQuantile;\r\n  let histBins = d3\r\n    .histogram()\r\n    .value((d) => d)\r\n    .domain(domain)\r\n    .thresholds(\r\n      ticksExact(...domain, Math.ceil(width / (height / numQuantiles)))\r\n    )(data);\r\n\r\n  let binnedQuantiles = quantileBins(histBins, unitsPerQuantile, numQuantiles);\r\n\r\n  let quantiles = [];\r\n\r\n  for (let b = 0; b < binnedQuantiles.length; b++) {\r\n    for (let y = 0; y < binnedQuantiles[b]; y++) {\r\n      quantiles.push([\r\n        (histBins[b].x1 + histBins[b].x0) / 2,\r\n        ((y + 0.5) / numQuantiles) * data.length,\r\n      ]);\r\n    }\r\n  }\r\n\r\n  return quantiles;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\n// inclusive\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n\r\nexport const interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useMemo, useRef } from \"react\";\r\nimport { getQuantileBins } from \"bucket-lib/quantile-histogram\";\r\n\r\nimport { MAX_DELIVS } from \"data/objectives-data\";\r\n\r\nconst NUM_CIRCLES = 20;\r\nconst MARGIN = { top: 10, right: 10, bottom: 20, left: 10 };\r\nconst DOMAIN = [0, MAX_DELIVS];\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport default function DotHistogram({\r\n  data,\r\n  goal,\r\n  setGoal,\r\n  width = 600,\r\n  height = 400,\r\n  shortForm = false,\r\n}) {\r\n  const { current: razorID } = useRef(Math.floor(Math.random() * 1e9));\r\n  const { current: razorAreaID } = useRef(Math.floor(Math.random() * 1e9));\r\n\r\n  const svgSelector = useRef();\r\n  const circles = useMemo(\r\n    () =>\r\n      getQuantileBins(data, DOMAIN, data.length / NUM_CIRCLES, width, height),\r\n    [data]\r\n  );\r\n\r\n  const dataRange = [0, data.length];\r\n  const x = d3.scaleLinear().domain(DOMAIN).range([0, width]);\r\n  const y = d3.scaleLinear().domain(dataRange).range([height, 0]);\r\n  const count = circles.filter((d) => d[0] > goal).length;\r\n\r\n  useEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width + MARGIN.left + MARGIN.right)\r\n      .attr(\"height\", height + MARGIN.top + MARGIN.bottom)\r\n      .style(\"pointer-events\", \"none\")\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${MARGIN.left},${MARGIN.top})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(\r\n        d3\r\n          .axisBottom()\r\n          .scale(d3.scaleLinear().domain(DOMAIN).range([0, width]))\r\n          .tickFormat(d3.format(\".2s\"))\r\n      )\r\n      .call((s) => {\r\n        s.selectAll(\"line\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"path\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"text\").attr(\"fill\", \"gray\");\r\n      })\r\n      .append(\"text\")\r\n      .attr(\"fill\", \"black\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${30})`)\r\n      .text(\"Delivery (TAF)\");\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n\r\n    const ignoreFn = (e) => e.preventDefault();\r\n    let dragging = false;\r\n\r\n    document.querySelector(`#i${razorID}`).addEventListener(\"mousedown\", () => {\r\n      dragging = true;\r\n      window.addEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", () => {\r\n      dragging = false;\r\n      window.removeEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document\r\n      .querySelector(`#i${razorAreaID}`)\r\n      .addEventListener(\"mousemove\", (e) => {\r\n        if (dragging && e.target.id === `i${razorAreaID}`) {\r\n          razor.style.transform = `translateX(${Math.min(\r\n            Math.max(e.offsetX, MARGIN.left),\r\n            MARGIN.left + width\r\n          )}px)\r\n            `;\r\n\r\n          setGoal(\r\n            d3\r\n              .scaleLinear()\r\n              .domain([MARGIN.left, width + MARGIN.left])\r\n              .range(DOMAIN)\r\n              .clamp(true)(e.offsetX)\r\n          );\r\n        }\r\n      });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const svgCircles = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".icons\")\r\n      .data(circles)\r\n      .join((enter) => enter.append(\"g\").call((s) => s.append(\"path\")))\r\n      .attr(\"class\", \"icons\")\r\n      .call((s) => {\r\n        s.selectAll(\"path\").attr(\r\n          \"d\",\r\n          d3.symbol(WATERDROP_ICON, height / NUM_CIRCLES)\r\n        );\r\n      });\r\n\r\n    svgCircles.attr(\"transform\", (d) => `translate(${x(d[0])},${y(d[1])})`);\r\n\r\n    svgCircles.attr(\"fill\", (d) => (d[0] > goal ? \"steelblue\" : \"black\"));\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n  }, [goal, circles]);\r\n\r\n  return (\r\n    <div className={`dot-${razorAreaID}`} id={`i${razorAreaID}`}>\r\n      <div\r\n        className={`pdf-razor ` + (shortForm ? \"short-form\" : \"\")}\r\n        id={`i${razorID}`}\r\n      >\r\n        <div>\r\n          <span>\r\n            {circles.length - count} / {NUM_CIRCLES}{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL NOT meet demand\"}\r\n          </span>\r\n          <span>\r\n            {count} / {NUM_CIRCLES} {shortForm ? \"\" : \"yrs WILL meet demand\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"bucket-lib/utils\";\r\nimport {\r\n  CIRC_RAD,\r\n  DROP_HEIGHT,\r\n  DROP_RAD,\r\n  waterdropDeltaOutline,\r\n} from \"utils/render-utils\";\r\nimport { dropRadToDropHeight } from \"utils/math-utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nfunction dropPath(height, [x, y]) {\r\n  const points = waterdropDeltaOutline(0, 1, height, 20);\r\n\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d[0] + x;\r\n    })\r\n    .y(function (d) {\r\n      return d[1] + y;\r\n    });\r\n  return lineFunc(points) + \"z\";\r\n}\r\n\r\nexport default function WaterdropGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () =>\r\n      ticksExact(0, 1 - 1 / resolution, resolution).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    const dropD = dropPath((innerHeight * (DROP_RAD * 2)) / DROP_HEIGHT, [\r\n      width / 2,\r\n      (height * DROP_RAD) / DROP_HEIGHT,\r\n    ]);\r\n\r\n    svgContainer.select(\".bucket-mask-path\").attr(\"d\", dropD);\r\n    svgContainer.select(\".bucket-outline\").attr(\"d\", dropD);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / (resolution - 1)));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"waterdrop-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const DESCRIPTIONS_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./descriptions.json\")).json();\r\n\r\n  console.log(\"DATA: loading descriptions data\");\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n})();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { clamp } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst SCEN_DIVISOR = 1; // debugging purposes, don't render all scenarios to speed things up\r\n\r\nexport const MAX_DELIVS = 1200;\r\nexport const SCENARIO_KEY_STRING = \"scens\";\r\nexport const DELIV_KEY_STRING = \"delivs\";\r\n\r\nexport const OBJECTIVES_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./objectives.json\")).json();\r\n\r\n  for (const obj of objs) {\r\n    obj[SCENARIO_KEY_STRING] = obj[SCENARIO_KEY_STRING];\r\n    for (const scen of obj[SCENARIO_KEY_STRING]) {\r\n      // data cleanup, clamping\r\n      const unord = scen[DELIV_KEY_STRING].map((v) => clamp(v, 0, MAX_DELIVS));\r\n\r\n      scen[DELIV_KEY_STRING] = Array.from(unord).sort((a, b) => b - a);\r\n    }\r\n    obj[SCENARIO_KEY_STRING] = mapBy(\r\n      obj[SCENARIO_KEY_STRING],\r\n      ({ name }) => name\r\n    );\r\n  }\r\n\r\n  console.log(\"DATA: loading objectives data\");\r\n\r\n  return mapBy(objs, ({ obj }) => obj);\r\n})();\r\n\r\nexport const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\nconst _SCENARIO_IDS = Object.keys(\r\n  Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n);\r\n\r\nexport const SCENARIO_IDS = _SCENARIO_IDS.filter(\r\n  (_, i) => i % SCEN_DIVISOR === 0\r\n);\r\n\r\n// Flattening hierarchical data makes it more flexible for classifying\r\n// (from experience). id conveniently corresponds to index.\r\n// Also cache classifications (by objective and by scenario, for now)\r\nexport const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n  const flattenedData = [];\r\n  const dataGroupings = {\r\n    objective: {},\r\n    scenario: {},\r\n  };\r\n\r\n  // for ordering later\r\n  const means = [];\r\n\r\n  let idx = 0;\r\n  for (const obj of OBJECTIVE_IDS) {\r\n    for (const scen of SCENARIO_IDS) {\r\n      if (!dataGroupings[\"objective\"][obj])\r\n        dataGroupings[\"objective\"][obj] = [];\r\n\r\n      if (!dataGroupings[\"scenario\"][scen])\r\n        dataGroupings[\"scenario\"][scen] = [];\r\n\r\n      dataGroupings[\"objective\"][obj].push(idx);\r\n      dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n      const deliveries =\r\n        OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n      flattenedData.push({\r\n        id: idx,\r\n        objective: obj,\r\n        scenario: scen,\r\n        deliveries,\r\n      });\r\n\r\n      means.push(d3.mean(deliveries));\r\n\r\n      idx++;\r\n    }\r\n  }\r\n\r\n  const orderedDataGroupings = {};\r\n\r\n  for (const criteria of Object.keys(dataGroupings)) {\r\n    const asdfasdf = [];\r\n    for (const key of Object.keys(dataGroupings[criteria])) {\r\n      const ids = dataGroupings[criteria][key];\r\n      const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n      asdfasdf.push({\r\n        key,\r\n        sorted: sortedObjScens,\r\n        mean: d3.mean(ids.map((id) => flattenedData[id].deliveries).flat()),\r\n      });\r\n    }\r\n\r\n    const sortedObjScens = asdfasdf.sort((a, b) => b.mean - a.mean);\r\n\r\n    orderedDataGroupings[criteria] = {};\r\n\r\n    for (let i = 0; i < sortedObjScens.length; i++) {\r\n      const { key, sorted } = sortedObjScens[i];\r\n      const IDtoRank = {};\r\n\r\n      for (let j = 0; j < sorted.length; j++) {\r\n        IDtoRank[sorted[j]] = j;\r\n      }\r\n      orderedDataGroupings[criteria][key] = IDtoRank;\r\n      orderedDataGroupings[criteria][key].rank = i;\r\n    }\r\n  }\r\n\r\n  return [flattenedData, orderedDataGroupings];\r\n})();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const SPATIAL_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./callite_spatial.json\")).json();\r\n\r\n  console.log(\"DATA: loading callite spatial data\");\r\n\r\n  return objs;\r\n})();\r\n\r\nexport const SPATIAL_FEATURES = (function () {\r\n  return mapBy(SPATIAL_DATA.features, ({ properties }) => properties.CalLiteID);\r\n})();\r\n\r\nexport const CALIFORNIA_OUTLINE = await (async function load() {\r\n  const objs = await (await fetch(\"./california.json\")).json();\r\n\r\n  console.log(\"DATA: loading california spatial data\");\r\n\r\n  return objs;\r\n})();\r\n\r\nexport const CALIFORNIA_CENTER = [-119, 37.7749];\r\n","export const LOD_1_LEVELS = 5;\r\nexport const LOD_1_RAD_PX = 1;\r\nexport const LOD_1_MIN_LEV_VAL = 0.1;\r\nexport const LOD_1_SMALL_DROP_PAD_FACTOR = 1.3;\r\nexport const LOD_1_LARGE_DROP_PAD_FACTOR = 1.2;\r\n\r\nexport const LOD_2_SMALL_DROP_PAD_FACTOR = 3;\r\n\r\nexport const GROUP_HOVER_AREA_FACTOR = 1.1 / (1 + Math.SQRT1_2);\r\n","import * as THREE from \"three\";\r\nimport * as d3 from \"d3\";\r\n\r\nimport {\r\n  WaterdropMesh,\r\n  WaterdropSimplifiedMesh,\r\n  Camera,\r\n} from \"utils/render-utils\";\r\n\r\nconst scene = (function getScene() {\r\n  const s = new THREE.Scene();\r\n  s.background = new THREE.Color(0xefefef);\r\n  return s;\r\n})();\r\n\r\nconst dropsMesh = new WaterdropMesh();\r\nconst pointsMesh = new WaterdropSimplifiedMesh();\r\n\r\nconst camera = new Camera({\r\n  fov: 45,\r\n  near: 1,\r\n  far: 3000,\r\n});\r\n\r\nconst renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\r\nexport { scene, camera, renderer, dropsMesh, pointsMesh };\r\n","import { ticksExact } from \"bucket-lib/utils\";\r\nimport {\r\n  LOD_1_LARGE_DROP_PAD_FACTOR,\r\n  LOD_1_LEVELS,\r\n  LOD_1_MIN_LEV_VAL,\r\n  LOD_1_RAD_PX,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\n\r\nimport {\r\n  DATA_GROUPINGS,\r\n  FLATTENED_DATA,\r\n  MAX_DELIVS,\r\n  OBJECTIVE_IDS,\r\n  SCENARIO_IDS,\r\n} from \"data/objectives-data\";\r\n\r\nimport { calcDomLev, createInterpsFromDelivs } from \"utils/data-utils\";\r\nimport { placeDropsUsingPhysics } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\n// TODO optimize!!\r\nexport function initWaterdrops(grouping) {\r\n  const groupKeys = grouping === \"objective\" ? OBJECTIVE_IDS : SCENARIO_IDS;\r\n  const memberKeys = grouping === \"objective\" ? SCENARIO_IDS : OBJECTIVE_IDS;\r\n\r\n  const amtGroups = groupKeys.length;\r\n  const amtPerGroup = memberKeys.length;\r\n\r\n  const largeDropRad =\r\n    Math.sqrt(amtPerGroup / Math.PI) *\r\n    LOD_1_RAD_PX *\r\n    2 *\r\n    LOD_1_SMALL_DROP_PAD_FACTOR *\r\n    LOD_1_LARGE_DROP_PAD_FACTOR;\r\n  const smallDropRad = LOD_1_RAD_PX * LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  const largeNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    groupKeys.map((p, idx) => ({\r\n      r: largeDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const largeNodesPos = mapBy(largeNodesPhys, ({ id }) => id);\r\n\r\n  const smallNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    memberKeys.map((s, idx) => ({\r\n      r: smallDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const smallNodesPos = mapBy(smallNodesPhys, ({ id }) => id);\r\n\r\n  const nodes = [];\r\n  const groupNodes = [];\r\n\r\n  const groupToNodes = {};\r\n\r\n  let idx = 0;\r\n\r\n  for (const nodeData of FLATTENED_DATA) {\r\n    const { id, objective, scenario, deliveries } = nodeData;\r\n\r\n    const i = createInterpsFromDelivs(deliveries, MAX_DELIVS);\r\n    const wds = ticksExact(0, 1, LOD_1_LEVELS + 1).map((d) => i(d));\r\n\r\n    const levs = wds.map(\r\n      (w, i) => Math.max(w, i == 0 ? LOD_1_MIN_LEV_VAL : 0) * LOD_1_RAD_PX\r\n    );\r\n\r\n    const groupID = grouping === \"objective\" ? objective : scenario;\r\n    const memberID = grouping === \"objective\" ? scenario : objective;\r\n\r\n    const groupRank = DATA_GROUPINGS[grouping][groupID].rank;\r\n    const memberRank = DATA_GROUPINGS[grouping][groupID][id];\r\n\r\n    const node = {\r\n      id,\r\n      levs,\r\n      maxLev: LOD_1_RAD_PX,\r\n      domLev: calcDomLev(levs),\r\n      tilt: Math.random() * 50 - 25,\r\n      dur: Math.random() * 100 + 400,\r\n      x: smallNodesPos[memberRank].x,\r\n      y: smallNodesPos[memberRank].y,\r\n      group: groupID,\r\n      key: memberID,\r\n      globalX: largeNodesPos[groupRank].x + smallNodesPos[memberRank].x,\r\n      globalY: largeNodesPos[groupRank].y + smallNodesPos[memberRank].y,\r\n    };\r\n\r\n    nodes.push(node);\r\n\r\n    if (!groupToNodes[groupID]) groupToNodes[groupID] = [];\r\n\r\n    groupToNodes[groupID].push(node);\r\n  }\r\n\r\n  for (const groupKey of groupKeys) {\r\n    groupNodes.push({\r\n      x: largeNodesPos[DATA_GROUPINGS[grouping][groupKey].rank].x,\r\n      y: largeNodesPos[DATA_GROUPINGS[grouping][groupKey].rank].y,\r\n      tilt: Math.random() * 50 - 25,\r\n      key: groupKey,\r\n      height: smallNodesPhys.height,\r\n      nodes: groupToNodes[groupKey],\r\n    });\r\n  }\r\n\r\n  return {\r\n    nodes: nodes,\r\n    groups: groupNodes,\r\n    height: largeNodesPhys.height,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\n\r\nimport { SCENARIO_KEY_STRING, DELIV_KEY_STRING } from \"data/objectives-data\";\r\n\r\nexport function createInterps(obj_name, scen_name, data, maxDelivs) {\r\n  const delivs =\r\n    data[obj_name][SCENARIO_KEY_STRING][scen_name][DELIV_KEY_STRING];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\nexport function createInterpsFromDelivs(delivs, maxDelivs) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\n// TODO fix colors\r\nexport function calcDomLev(levs) {\r\n  levs = [1, ...levs, 0];\r\n\r\n  let mean = 0;\r\n  for (let i = 0; i < levs.length - 1; i++) {\r\n    const dif = levs[i] - levs[i + 1];\r\n    mean += (dif * (i - 1)) / (levs.length + 4);\r\n  }\r\n\r\n  return mean;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport Matter from \"matter-js\";\r\nimport { CIRC_RAD, DROP_HEIGHT } from \"./render-utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor((Math.sqrt(AREA / 3.14) * 2) / 2);\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes, reuse = false) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r));\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\nexport function percentToRatioFilled(p) {\r\n  p -= 0.0088;\r\n  return clamp(\r\n    (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326,\r\n    0,\r\n    1\r\n  );\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport function interp(x, a, b) {\r\n  return x * (b - a) + a;\r\n}\r\n\r\nexport function revInterp(t, a, b) {\r\n  return (t - a) / (b - a);\r\n}\r\n\r\nexport function distSq([x1, y1], [x2, y2]) {\r\n  return (x2 - x1) ** 2 + (y2 - y1) ** 2;\r\n}\r\n\r\nexport function dist([x1, y1], [x2, y2]) {\r\n  return Math.sqrt(distSq([x1, y1], [x2, y2]));\r\n}\r\n\r\nexport function getCenterDomRect(domRect) {\r\n  return [domRect.left + domRect.width / 2, domRect.top + domRect.height / 2];\r\n}\r\n\r\nexport function clipEnds([from, to], shortenBy) {\r\n  const len = Math.sqrt((from[0] - to[0]) ** 2 + (from[1] - to[1]) ** 2);\r\n  const normed = [(to[0] - from[0]) / len, (to[1] - from[1]) / len];\r\n\r\n  from[0] += normed[0] * shortenBy;\r\n  from[1] += normed[1] * shortenBy;\r\n  to[0] -= normed[0] * shortenBy;\r\n  to[1] -= normed[1] * shortenBy;\r\n\r\n  return [from, to];\r\n}\r\n\r\nexport function dropRadToDropHeight(rad) {\r\n  return (1 + Math.SQRT2) * rad;\r\n}\r\n\r\nexport function dropCenterCorrection({ rad, height }) {\r\n  if (rad !== undefined) return dropRadToDropHeight(rad) * 0.08;\r\n  return height * 0.08;\r\n}\r\n\r\nexport function avgCoords(coords) {\r\n  return [d3.mean(coords, (c) => c[0]), d3.mean(coords, (c) => c[1])];\r\n}\r\n","// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    if (typeof v === \"function\")\r\n      _setState((curVal) => (stateRef.current = v(curVal)));\r\n    else _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n\r\nexport function isState(stateInfo, stateName) {\r\n  return stateInfo && stateInfo.state === stateName;\r\n}\r\n\r\nexport function wrap(s) {\r\n  return s.replace(/(?![^\\n]{1,15}$)([^\\n]{1,15})\\s/g, \"$1\\n\");\r\n}\r\n\r\nexport function genUUID() {\r\n  return Math.floor(Math.random() * 1e9);\r\n}\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\nimport { LOD_1_LEVELS } from \"settings\";\r\nimport { sortBy } from \"./misc-utils\";\r\nimport { toRadians } from \"./math-utils\";\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport const CIRC_RAD = Math.SQRT1_2;\r\nexport const DROP_RAD = 1;\r\nexport const CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nexport const DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = (CIRC_RAD + DROP_RAD / 2) / DROP_HEIGHT;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2, subdivs = 10) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 1 / subdivs;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return {\r\n    x: (mouseX / width) * 2 - 1,\r\n    y: -(mouseY / height) * 2 + 1,\r\n  };\r\n}\r\n\r\nclass MeshGeometry {\r\n  threeGeom = new THREE.BufferGeometry();\r\n  triangleIdx = 0;\r\n  positionAttribute;\r\n  colorAttribute;\r\n\r\n  constructor(numPoints, color = true) {\r\n    this.threeGeom.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n    );\r\n\r\n    if (color)\r\n      this.threeGeom.setAttribute(\r\n        \"color\",\r\n        new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n      );\r\n\r\n    this.positionAttribute = this.threeGeom.getAttribute(\"position\");\r\n    this.colorAttribute = this.threeGeom.getAttribute(\"color\");\r\n  }\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = meshCoords[j];\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 0,\r\n        transform.x + v1[0],\r\n        transform.y - v1[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 1,\r\n        transform.x + v2[0],\r\n        transform.y - v2[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 2,\r\n        transform.x + v3[0],\r\n        transform.y - v3[1],\r\n        z\r\n      );\r\n\r\n      if (color) {\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 0,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 1,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 2,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n      }\r\n\r\n      this.triangleIdx++;\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    this.threeGeom.setDrawRange(0, this.triangleIdx * 3);\r\n  }\r\n}\r\n\r\nexport class WaterdropMesh {\r\n  static MAX_POINTS_DROPS = 60 * 13e4; // approx num verts per droplet * approx num droplets on screen\r\n  static MAX_POINTS_OUTLINE = 40 * 13e4; // approx num verts per droplet * approx num droplets on screen\r\n\r\n  dropsMesh;\r\n  outlineMesh;\r\n\r\n  added = false;\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.dropsMesh) {\r\n      this.initializeMeshes(waterdrops);\r\n    } else {\r\n      this.updateMeshes(waterdrops);\r\n    }\r\n  }\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.dropsMesh);\r\n      scene.add(this.outlineMesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.dropsMesh);\r\n      scene.remove(this.outlineMesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  initializeMeshes(waterdrops) {\r\n    const dropsGeometry = new MeshGeometry(WaterdropMesh.MAX_POINTS_DROPS);\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = waterdropDeltaOutline(\r\n      0,\r\n      1,\r\n      LOD_1_RAD_PX * 2 * 0.975\r\n    );\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, maxLev } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = waterdropDelta(\r\n          l1 / maxLev,\r\n          l2 / maxLev,\r\n          LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / LOD_1_LEVELS)\r\n        );\r\n\r\n        dropsGeometry.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      outlinePoints.push(\r\n        ...outlineMeshCoords.map(\r\n          ([dx, dy]) => new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01)\r\n        )\r\n      );\r\n    }\r\n\r\n    dropsGeometry.finish();\r\n\r\n    this.dropsMesh = new THREE.Mesh(\r\n      dropsGeometry.threeGeom,\r\n      new THREE.MeshBasicMaterial({\r\n        vertexColors: true,\r\n        transparent: true,\r\n        opacity: 1,\r\n      })\r\n    );\r\n\r\n    this.outlineMesh = new THREE.LineSegments(\r\n      new THREE.BufferGeometry().setFromPoints(outlinePoints),\r\n      new THREE.LineBasicMaterial({\r\n        color: 0xcccccc,\r\n        transparent: true,\r\n        opacity: 0,\r\n      })\r\n    );\r\n  }\r\n\r\n  updateOutlineVisibility(opac) {\r\n    if (!this.outlineMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateVisibility(opac) {\r\n    if (!this.outlineMesh || !this.dropsMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n    this.dropsMesh.material.opacity = opac;\r\n    this.dropsMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateMeshes(waterdrops) {\r\n    // TODO fix\r\n  }\r\n}\r\n\r\nexport class WaterdropSimplifiedMesh {\r\n  mesh;\r\n  added = false;\r\n\r\n  vertToId = {};\r\n  idToVert = {};\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.mesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.mesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.mesh) {\r\n      this.initializeMesh(waterdrops);\r\n    }\r\n\r\n    this.updateMesh(waterdrops);\r\n\r\n    return this.mesh;\r\n  }\r\n\r\n  initializeMesh(waterdrops) {\r\n    const pointsGeometry = new THREE.BufferGeometry();\r\n\r\n    const vertices = [];\r\n    const colors = [];\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, domLev } = waterdrops.nodes[i];\r\n\r\n      const color = domLev > 0 ? interpolateWatercolorBlue(domLev) : \"white\";\r\n\r\n      vertices.push(x, -y, 0);\r\n      const t_color = new THREE.Color(color);\r\n      colors.push(t_color.r, t_color.g, t_color.b);\r\n\r\n      this.vertToId[i] = id;\r\n      this.idToVert[id] = i;\r\n    }\r\n\r\n    const pointsMaterial = new THREE.PointsMaterial({\r\n      size: LOD_1_RAD_PX * 2,\r\n      sizeAttenuation: true,\r\n      vertexColors: true,\r\n      map: new THREE.TextureLoader().load(\"drop.png\"),\r\n      transparent: true,\r\n    });\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(vertices), 3)\r\n    );\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"color\",\r\n      new THREE.BufferAttribute(new Float32Array(colors), 3)\r\n    );\r\n\r\n    this.mesh = new THREE.Points(pointsGeometry, pointsMaterial);\r\n  }\r\n\r\n  updateMesh(waterdrops) {\r\n    const positionAttr = this.mesh.geometry.getAttribute(\"position\");\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: newX, globalY: newY } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n      positionAttr.setXY(idx, newX, -newY);\r\n    }\r\n    positionAttr.needsUpdate = true;\r\n  }\r\n\r\n  updatePoints(waterdrops, translations, dt) {\r\n    const verts = this.mesh.geometry.vertices;\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n\r\n      const [dx, dy] = translations[id];\r\n\r\n      const x = verts[idx].x;\r\n      const y = verts[idx].y;\r\n\r\n      verts[idx].setX(x + dt * dx);\r\n      verts[idx].setY(y - dt * dy);\r\n    }\r\n\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n\r\n  intersectObject(camera, x, y) {\r\n    const intersects = camera.intersectObject(x, y, this.mesh);\r\n\r\n    if (intersects[0]) {\r\n      const intersect = sortBy(intersects, \"distanceToRay\")[0];\r\n      return this.vertToId[intersect.index];\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  view;\r\n  curTransform;\r\n\r\n  raycaster = new THREE.Raycaster();\r\n\r\n  _svgElement;\r\n\r\n  constructor({ fov, near, far }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n  }\r\n\r\n  setZoomFn(zoomFn) {\r\n    this.zoom = d3.zoom().on(\"zoom\", (e) => {\r\n      this.curTransform = e.transform;\r\n\r\n      this._THREEZoomHandler(e.transform);\r\n      d3.select(this._svgElement).attr(\"transform\", e.transform);\r\n\r\n      zoomFn && zoomFn(e.transform);\r\n    });\r\n  }\r\n\r\n  callZoom(transform) {\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity.translate(transform.x, transform.y).scale(transform.k)\r\n    );\r\n  }\r\n\r\n  callZoomFromWorldViewport({ worldX, worldY, farHeight }) {\r\n    const k = this.height / farHeight;\r\n\r\n    const x = -(worldX * k) + this.width / 2;\r\n    const y = worldY * k + this.height / 2;\r\n\r\n    this.callZoom({\r\n      x,\r\n      y,\r\n      k,\r\n    });\r\n  }\r\n\r\n  getZFromFarHeight(farHeight) {\r\n    return (Math.tan(toRadians(90 - this.fov / 2)) * farHeight) / 2;\r\n  }\r\n\r\n  getFarHeightFromZ(z) {\r\n    return Math.tan(toRadians(this.fov) / 2) * z * 2;\r\n  }\r\n\r\n  interpolateZoomCamera([endx, endy, endz]) {\r\n    const i = d3.interpolateZoom(\r\n      [\r\n        this.camera.position.x,\r\n        this.camera.position.y,\r\n        this.height / this.curTransform.k,\r\n      ],\r\n      [endx, -endy, this.getFarHeightFromZ(endz)]\r\n    );\r\n\r\n    const interper = (t) => {\r\n      const [worldX, worldY, farHeight] = i(t);\r\n\r\n      const k = this.height / farHeight;\r\n\r\n      const x = -(worldX * k) + this.width / 2;\r\n      const y = worldY * k + this.height / 2;\r\n\r\n      return {\r\n        x,\r\n        y,\r\n        k,\r\n      };\r\n    };\r\n\r\n    interper.duration = i.duration;\r\n\r\n    return interper;\r\n  }\r\n\r\n  mount(webglElement, svgElement) {\r\n    this.view = d3.select(webglElement);\r\n    this._svgElement = svgElement;\r\n  }\r\n\r\n  setSize(width, height) {\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.zoom = this.zoom.scaleExtent([\r\n      this.getScaleFromZ(this.far),\r\n      this.getScaleFromZ(this.near),\r\n    ]);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      this.fov,\r\n      width / height,\r\n      this.near,\r\n      this.far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.view.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  _THREEZoomHandler(transform) {\r\n    const scale = transform.k;\r\n    const x = -(transform.x - this.width / 2) / scale;\r\n    const y = (transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n\r\n  getScaleFromZ(camera_z_position) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const half_fov_height = Math.tan(half_fov_radians) * camera_z_position;\r\n    const fov_height = half_fov_height * 2;\r\n    const scale = this.height / fov_height;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const scale_height = this.height / scale;\r\n    const camera_z_position = scale_height / (2 * Math.tan(half_fov_radians));\r\n    return camera_z_position;\r\n  }\r\n\r\n  intersectObject(mouseX, mouseY, mesh) {\r\n    this.raycaster.setFromCamera(\r\n      {\r\n        x: mouseX,\r\n        y: mouseY,\r\n      },\r\n      this.camera\r\n    );\r\n\r\n    return this.raycaster.intersectObject(mesh);\r\n  }\r\n}\r\n\r\nexport function circlet(s) {\r\n  s.attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke\", \"orange\")\r\n    .attr(\"stroke-dasharray\", 3)\r\n    .attr(\"stroke-width\", 3)\r\n    .attr(\"vector-effect\", \"non-scaling-stroke\");\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\n\r\nimport {\r\n  LOD_1_LEVELS,\r\n  LOD_1_RAD_PX,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n  LOD_2_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\nimport { AppContext } from \"AppContext\";\r\nimport { FLATTENED_DATA } from \"data/objectives-data\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\n\r\nimport { avgCoords, clipEnds, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { genUUID, isState, wrap } from \"utils/misc-utils\";\r\nimport { DROPLET_SHAPE, circlet } from \"utils/render-utils\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\n\r\nconst SPREAD = LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\nexport default function CompareView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n    camera,\r\n    goals,\r\n    setGoals,\r\n    addZoomHandler,\r\n  } = useContext(AppContext);\r\n\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const [panels, setPanels] = useState([]);\r\n  const groupsRef = useRef();\r\n  const centerRef = useRef();\r\n  const mouseDownInfo = useRef({});\r\n\r\n  // TODO trigger rerender another way?\r\n  const [cameraChangeFlag, setCameraChangeFlag] = useState(false);\r\n\r\n  useEffect(function initialize() {\r\n    d3.select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"compare-group\");\r\n\r\n    addZoomHandler(function () {\r\n      setCameraChangeFlag((f) => !f);\r\n    });\r\n\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current = {};\r\n    });\r\n  }, []);\r\n\r\n  function getIdealGroupPos([x, y], [centerX, centerY]) {\r\n    let newX = x,\r\n      newY = y;\r\n\r\n    const correctionX = groupsRef.current.groups[0].height * 2;\r\n\r\n    if (newX < centerX) newX -= correctionX;\r\n    else newX += correctionX;\r\n\r\n    return [newX, newY, newX < centerX];\r\n  }\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines, nodes] = calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop\r\n        );\r\n\r\n        setPanels((p) => {\r\n          return nodes.map((n, i) => {\r\n            let ox = 0,\r\n              oy = 0;\r\n\r\n            if (p[i]) {\r\n              ox = p[i].offsetX;\r\n              oy = p[i].offsetY;\r\n            }\r\n\r\n            const [x, y, isLeft] = getIdealGroupPos(\r\n              groupsRef.current.groupPositions[i],\r\n              centerRef.current\r\n            );\r\n\r\n            return {\r\n              text: n.key,\r\n              x,\r\n              y,\r\n              id: groupsRef.current.groups[i].key,\r\n              nodeID: n.id,\r\n              isLeft,\r\n              offsetX: ox,\r\n              offsetY: oy,\r\n            };\r\n          });\r\n        });\r\n\r\n        const [textX, textY] = avgCoords(Array.from(positions));\r\n\r\n        const smallTextSize =\r\n          (groupsRef.current.groups[0].height * SPREAD) / 15;\r\n        const largeTextSize =\r\n          (groupsRef.current.groups[0].height * SPREAD) / 10;\r\n\r\n        d3.select(\"#compare-group\")\r\n          .select(\"#member-label\")\r\n          .text(\"scenario\")\r\n          .attr(\"font-size\", smallTextSize)\r\n          .attr(\"text-anchor\", \"middle\")\r\n          .transition()\r\n          .duration(100)\r\n          .attr(\"x\", textX)\r\n          .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n        d3.select(\"#compare-group\")\r\n          .select(\"#member-variable\")\r\n          .attr(\"id\", \"member-variable\")\r\n          .attr(\"font-size\", largeTextSize)\r\n          .text(activeMinidrop.slice(4))\r\n          .attr(\"text-anchor\", \"middle\")\r\n          .transition()\r\n          .duration(100)\r\n          .attr(\"x\", textX)\r\n          .attr(\"y\", textY);\r\n\r\n        d3.select(\"#compare-group\")\r\n          .selectAll(\".circlet\")\r\n          .data(positions)\r\n          .join(\"circle\")\r\n          .attr(\"class\", \"circlet\")\r\n          .call(circlet)\r\n          .attr(\"display\", \"initial\")\r\n          .attr(\"r\", LOD_1_RAD_PX * 1.5)\r\n          .transition()\r\n          .duration(100)\r\n          .attr(\"cx\", (d) => d[0])\r\n          .attr(\"cy\", (d) => d[1]);\r\n\r\n        d3.select(\"#compare-group\")\r\n          .selectAll(\".comp-line\")\r\n          .data(lines)\r\n          .join(\"path\")\r\n          .attr(\"class\", \"comp-line\")\r\n          .attr(\"stroke\", \"orange\")\r\n          .attr(\"stroke-dasharray\", 3)\r\n          .attr(\"opacity\", 0.5)\r\n          .attr(\"stroke-width\", 1)\r\n          .attr(\"vector-effect\", \"non-scaling-stroke\")\r\n          .transition()\r\n          .duration(100)\r\n          .attr(\"d\", (d) => d3.line()(d));\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"CompareView\")) {\r\n        const container = d3.select(\"#compare-group\");\r\n\r\n        updateDropsSVG(\r\n          container,\r\n          (groupsRef.current = getWaterdropGroups(\r\n            activeWaterdrops,\r\n            waterdrops,\r\n            (centerRef.current = state.avgCoord)\r\n          )),\r\n          state.transitionDuration / 5,\r\n          {\r\n            onHover: (d) => {\r\n              setActiveMinidrop(d.key);\r\n            },\r\n          }\r\n        );\r\n\r\n        container.append(\"text\").attr(\"id\", \"member-variable\");\r\n        container.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n        setTimeout(() => {\r\n          setActiveMinidrop(groupsRef.current.groups[0].nodes[0].key);\r\n        }, state.transitionDuration + 500);\r\n\r\n        setGoBack(() => () => {\r\n          setState({ state: \"WideView\" });\r\n\r\n          resetCamera();\r\n        });\r\n\r\n        return function exitState() {\r\n          container.selectAll(\".large-drop\").remove();\r\n          container.selectAll(\".circlet\").remove();\r\n          container.selectAll(\".comp-line\").remove();\r\n          container.select(\"#member-variable\").remove();\r\n          container.select(\"#member-label\").remove();\r\n\r\n          setPanels([]);\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  function onPanelDragStart(e, id) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {panels.map(({ x, y, id, isLeft, offsetX, offsetY, nodeID }, i) => (\r\n        <div\r\n          className={\"panel compare-panel\" + (isLeft ? \" left\" : \"\")}\r\n          key={i}\r\n          style={{\r\n            left: `${\r\n              x * camera.curTransform.k + camera.curTransform.x + offsetX\r\n            }px`,\r\n            top: `${\r\n              y * camera.curTransform.k + camera.curTransform.y + offsetY\r\n            }px`,\r\n          }}\r\n          onMouseDown={(e) => onPanelDragStart(e, id)}\r\n        >\r\n          <DotHistogram\r\n            width={300}\r\n            height={200}\r\n            data={FLATTENED_DATA[nodeID].deliveries}\r\n            goal={goals[id]}\r\n            setGoal={(newGoal) => {\r\n              setGoals((g) => {\r\n                g[id] = newGoal;\r\n                return { ...g };\r\n              });\r\n            }}\r\n          />\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction getWaterdropGroups(keyArr, waterdrops, center) {\r\n  const groups = waterdrops.groups.filter((g) => keyArr.includes(g.key));\r\n\r\n  const groupPositions = [];\r\n  const rad = groups[0].height * SPREAD * 0.75;\r\n\r\n  for (let i = 0, n = groups.length; i < n; i++) {\r\n    groupPositions.push([\r\n      center[0] + Math.cos(((Math.PI * 2) / n) * i) * rad,\r\n      center[1] + Math.sin(((Math.PI * 2) / n) * i) * rad,\r\n    ]);\r\n  }\r\n\r\n  return {\r\n    groups,\r\n    groupPositions,\r\n  };\r\n}\r\n\r\nfunction updateDropsSVG(\r\n  container,\r\n  waterdropGroups,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(function ({ nodes, height }) {\r\n          d3.select(this)\r\n            .call((s) => {\r\n              s.append(\"text\")\r\n                .style(\"font-size\", (height * SPREAD) / 15)\r\n                .attr(\"class\", \"fancy-font water-group-label\")\r\n                .attr(\"text-anchor\", \"middle\");\r\n            })\r\n            .selectAll(\".small-drop\")\r\n            .data(nodes)\r\n            .enter()\r\n            .append(\"g\")\r\n            .attr(\"class\", \"small-drop\")\r\n            .each(function ({ levs }) {\r\n              const s = d3.select(this);\r\n              s.append(\"rect\")\r\n                .attr(\"class\", \"bbox\")\r\n                .style(\"visibility\", \"hidden\");\r\n\r\n              const randId = genUUID();\r\n\r\n              const stops = d3\r\n                .select(this)\r\n                .append(\"defs\")\r\n                .append(\"linearGradient\")\r\n                .attr(\"id\", `${randId}`)\r\n                .attr(\"x1\", \"0%\")\r\n                .attr(\"x2\", \"0%\")\r\n                .attr(\"y1\", \"0%\")\r\n                .attr(\"y2\", \"100%\");\r\n              stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n              stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n              levs.forEach((_, i) => {\r\n                for (let j = 0; j < 2; j++) {\r\n                  stops\r\n                    .append(\"stop\")\r\n                    .attr(\r\n                      \"stop-color\",\r\n                      interpolateWatercolorBlue(i / LOD_1_LEVELS)\r\n                    );\r\n                }\r\n              });\r\n\r\n              s.append(\"path\")\r\n                .attr(\"d\", DROPLET_SHAPE)\r\n                .attr(\"class\", \"outline\")\r\n                .attr(\"fill\", \"none\")\r\n                .attr(\"stroke\", \"lightgray\")\r\n                .attr(\"stroke-width\", 0.05);\r\n\r\n              s.append(\"path\")\r\n                .attr(\"class\", \"fill\")\r\n                .attr(\"d\", DROPLET_SHAPE)\r\n                .attr(\"fill\", `url(#${randId})`);\r\n            });\r\n        });\r\n    })\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\"transform\", ({ x, y }) => `translate(${x}, ${y})`)\r\n    .each(function ({ nodes, key, height }) {\r\n      d3.select(this)\r\n        .call((s) => {\r\n          const t = s.select(\"text\");\r\n\r\n          t.selectAll(\"*\").remove();\r\n          const lines = wrap(\r\n            DESCRIPTIONS_DATA[key].display_name || DESCRIPTIONS_DATA[key].id\r\n          ).split(\"\\n\");\r\n\r\n          lines.forEach((line, i) => {\r\n            t.append(\"tspan\")\r\n              .attr(\"x\", 0)\r\n              .attr(\"y\", (height / 2) * SPREAD)\r\n              .attr(\"dy\", `${i}em`)\r\n              .text(line);\r\n          });\r\n        })\r\n        .selectAll(\".small-drop\")\r\n        .data(nodes)\r\n        .attr(\"display\", \"initial\")\r\n        .attr(\"transform\", ({ x, y }) => `translate(${x}, ${y})`)\r\n        .on(\"click\", function (e, d) {\r\n          onClick && onClick(d);\r\n        })\r\n        .on(\"mouseenter\", function (e, d) {\r\n          onHover && onHover(d);\r\n        })\r\n        .on(\"mouseleave\", function (e, d) {\r\n          onUnhover && onUnhover(d);\r\n        })\r\n        .each(function ({ levs, maxLev }, i) {\r\n          const s = d3.select(this);\r\n\r\n          s.select(\".outline\").attr(\r\n            \"transform\",\r\n            `scale(${LOD_1_RAD_PX * 0.95})`\r\n          );\r\n          s.select(\".fill\").attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n\r\n          s.selectAll(\"stop\").each(function (_, i) {\r\n            let actI = Math.floor(i / 2);\r\n            const isEnd = i % 2;\r\n\r\n            if (isEnd === 0) actI -= 1;\r\n\r\n            if (actI === -1) {\r\n              d3.select(this).attr(\"offset\", `${0}%`);\r\n            } else if (actI === levs.length) {\r\n              d3.select(this).attr(\"offset\", `100%`);\r\n            } else {\r\n              d3.select(this).attr(\r\n                \"offset\",\r\n                `${(1 - levs[actI] / maxLev) * 100}%`\r\n              );\r\n            }\r\n          });\r\n\r\n          const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n          s.select(\".bbox\")\r\n            .attr(\"x\", dropBBox.x)\r\n            .attr(\"y\", dropBBox.y)\r\n            .attr(\"width\", dropBBox.width)\r\n            .attr(\"height\", dropBBox.height);\r\n        })\r\n        .transition()\r\n        .delay(transitionDelay)\r\n        .duration(1000)\r\n        .attr(\r\n          \"transform\",\r\n          ({ x, y }) => `translate(${x * SPREAD}, ${y * SPREAD})`\r\n        );\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\r\n      \"transform\",\r\n      (_, i) =>\r\n        `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`\r\n    );\r\n}\r\n\r\nfunction calcLinesAndPositions(groupsObj, activeMinidropKey) {\r\n  const positions = [];\r\n  const nodes = [];\r\n  for (let i = 0; i < groupsObj.groups.length; i++) {\r\n    const group = groupsObj.groups[i];\r\n    const groupPos = groupsObj.groupPositions[i];\r\n\r\n    const node = group.nodes.find((n) => n.key === activeMinidropKey);\r\n\r\n    nodes.push(node);\r\n\r\n    positions.push([\r\n      node.x * SPREAD + groupPos[0],\r\n      node.y * SPREAD +\r\n        groupPos[1] -\r\n        dropCenterCorrection({ rad: LOD_1_RAD_PX }),\r\n    ]);\r\n  }\r\n\r\n  const lines = [];\r\n\r\n  for (let i = 0; i < positions.length; i++) {\r\n    const from = Array.from(positions[i]),\r\n      to = Array.from(positions[i + 1 == positions.length ? 0 : i + 1]);\r\n\r\n    clipEnds([from, to], LOD_1_RAD_PX * 2);\r\n\r\n    lines.push([from, to]);\r\n  }\r\n\r\n  return [positions, lines, nodes];\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\n\r\nimport {\r\n  LOD_1_LEVELS,\r\n  LOD_1_RAD_PX,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n  LOD_2_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\nimport { AppContext } from \"AppContext\";\r\nimport { FLATTENED_DATA } from \"data/objectives-data\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\n\r\nimport { isState, useStateRef } from \"utils/misc-utils\";\r\nimport { DROPLET_SHAPE, circlet } from \"utils/render-utils\";\r\nimport { dropCenterCorrection } from \"utils/math-utils\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\n\r\nconst SPREAD = LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\nexport default function ExamineView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n    camera,\r\n    addZoomHandler,\r\n    goals,\r\n    setGoals,\r\n  } = useContext(AppContext);\r\n\r\n  const [activeMinidrops, setActiveMinidrops, activeMinidropsRef] = useStateRef(\r\n    []\r\n  );\r\n  const [previewMinidrop, setPreviewMinidrop, previewMinidropRef] =\r\n    useStateRef(null);\r\n  const [panels, setPanels] = useState([]);\r\n  const [cameraChangeFlag, setCameraChangeFlag] = useState(false);\r\n\r\n  const mouseDownInfo = useRef({});\r\n\r\n  function addDetailPanel(dropId) {\r\n    const { globalX, globalY, x, y, id, key } = waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      const newPanel = {\r\n        text: key.slice(4),\r\n        x: globalX + x * (SPREAD - 1),\r\n        y: globalY + y * (SPREAD - 1),\r\n        offsetX: 20,\r\n        offsetY: 40,\r\n        id,\r\n      };\r\n\r\n      return [...p, newPanel];\r\n    });\r\n  }\r\n\r\n  function removeDetailPanel(dropId) {\r\n    const { id } = waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      p.splice(\r\n        p.findIndex((v) => v.id === id),\r\n        1\r\n      );\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  useEffect(function initialize() {\r\n    d3.select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"examine-group\");\r\n\r\n    addZoomHandler(function () {\r\n      setCameraChangeFlag((f) => !f);\r\n    });\r\n\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current = {};\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"ExamineView\")) {\r\n        const transitionDelay = state.transitionDuration;\r\n        const container = d3.select(\"#examine-group\");\r\n\r\n        updateSmallDropSVG(\r\n          container,\r\n          waterdrops.groups.find((g) => g.key === activeWaterdrops[0]).nodes,\r\n          transitionDelay / 2,\r\n          {\r\n            onClick: (d) => {\r\n              setActiveMinidrops((wd) => {\r\n                if (wd.includes(d.id)) {\r\n                  wd.splice(wd.indexOf(d.id), 1);\r\n                  container\r\n                    .select(\".circlet.i\" + d.id)\r\n                    .classed(\"active\", false);\r\n\r\n                  removeDetailPanel(d.id);\r\n                } else {\r\n                  wd.push(d.id);\r\n                  container.select(\".circlet.i\" + d.id).classed(\"active\", true);\r\n\r\n                  addDetailPanel(d.id);\r\n                }\r\n                return [...wd];\r\n              });\r\n            },\r\n            onHover: (d) => {\r\n              if (!activeMinidropsRef.current.includes(d.id)) {\r\n                setPreviewMinidrop(d.id);\r\n                addDetailPanel(d.id);\r\n              }\r\n            },\r\n            onUnhover: (d) => {\r\n              if (previewMinidropRef.current === d.id) {\r\n                setPreviewMinidrop(null);\r\n                removeDetailPanel(d.id);\r\n              }\r\n            },\r\n          }\r\n        );\r\n\r\n        setGoBack(() => () => {\r\n          setState({ state: \"WideView\" });\r\n\r\n          resetCamera();\r\n        });\r\n\r\n        return function exitState() {\r\n          container.selectAll(\".small-drop\").attr(\"display\", \"none\");\r\n\r\n          container\r\n            .selectAll(\".circlet\")\r\n            .classed(\"active\", false)\r\n            .select(\"circle\")\r\n            .attr(\"display\", \"none\");\r\n          setPanels([]);\r\n          setActiveMinidrops([]);\r\n          setPreviewMinidrop(null);\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  function onPanelDragStart(e, id) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  let headerLabel;\r\n\r\n  if (isState(state, \"ExamineView\") && activeWaterdrops.length) {\r\n    headerLabel = (\r\n      <h1 className=\"examine-large-label\">\r\n        {DESCRIPTIONS_DATA[activeWaterdrops[0]].display_name ||\r\n          DESCRIPTIONS_DATA[activeWaterdrops[0]].id}\r\n      </h1>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {headerLabel}\r\n      {panels.map(({ text, x, y, id, offsetX, offsetY }) => (\r\n        <div\r\n          className=\"panel\"\r\n          key={id}\r\n          style={{\r\n            left: `${\r\n              x * camera.curTransform.k + camera.curTransform.x + offsetX\r\n            }px`,\r\n            top: `${\r\n              y * camera.curTransform.k + camera.curTransform.y + offsetY\r\n            }px`,\r\n          }}\r\n          onMouseDown={(e) => onPanelDragStart(e, id)}\r\n        >\r\n          <div className=\"panel-tab\">\r\n            scenario <span>{text}</span>\r\n          </div>\r\n          <DotHistogram\r\n            width={300}\r\n            height={200}\r\n            data={FLATTENED_DATA[id].deliveries}\r\n            goal={goals[activeWaterdrops[0]]}\r\n            setGoal={(newGoal) => {\r\n              setGoals((g) => {\r\n                g[activeWaterdrops[0]] = newGoal;\r\n                return { ...g };\r\n              });\r\n            }}\r\n          />\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction updateSmallDropSVG(\r\n  container,\r\n  waterdrops,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  container\r\n    .selectAll(\".small-drop\")\r\n    .data(waterdrops)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"small-drop\")\r\n        .each(function ({ levs }, i) {\r\n          const s = d3.select(this);\r\n          s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n          const stops = d3\r\n            .select(this)\r\n            .append(\"defs\")\r\n            .append(\"linearGradient\")\r\n            .attr(\"id\", `drop-fill-${i}`)\r\n            .attr(\"x1\", \"0%\")\r\n            .attr(\"x2\", \"0%\")\r\n            .attr(\"y1\", \"0%\")\r\n            .attr(\"y2\", \"100%\");\r\n          stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n          stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n          levs.forEach((_, i) => {\r\n            for (let j = 0; j < 2; j++) {\r\n              stops\r\n                .append(\"stop\")\r\n                .attr(\r\n                  \"stop-color\",\r\n                  interpolateWatercolorBlue(i / LOD_1_LEVELS)\r\n                );\r\n            }\r\n          });\r\n\r\n          s.append(\"path\")\r\n            .attr(\"d\", DROPLET_SHAPE)\r\n            .attr(\"class\", \"outline\")\r\n            .attr(\"fill\", \"none\")\r\n            .attr(\"stroke\", \"lightgray\")\r\n            .attr(\"stroke-width\", 0.05);\r\n\r\n          s.append(\"path\")\r\n            .attr(\"class\", \"fill\")\r\n            .attr(\"d\", DROPLET_SHAPE)\r\n            .attr(\"fill\", `url(#drop-fill-${i})`);\r\n\r\n          s.append(\"g\")\r\n            .attr(\"class\", \"circlet\")\r\n            .append(\"circle\")\r\n            .call(circlet)\r\n            .attr(\"display\", \"none\")\r\n            .attr(\"cy\", -dropCenterCorrection({ rad: 1 }))\r\n            .attr(\"r\", 1.5);\r\n        });\r\n    })\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\r\n      \"transform\",\r\n      ({ globalX, globalY }) => `translate(${globalX}, ${globalY})`\r\n    )\r\n    .each(function ({ levs, maxLev, id }, i) {\r\n      const s = d3.select(this);\r\n\r\n      s.select(\".outline\").attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n      s.select(\".fill\").attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n\r\n      s.select(\".circlet\")\r\n        .attr(\"class\", null)\r\n        .attr(\"class\", \"circlet i\" + id);\r\n\r\n      s.selectAll(\"stop\").each(function (_, i) {\r\n        let actI = Math.floor(i / 2);\r\n        const isEnd = i % 2;\r\n\r\n        if (isEnd === 0) actI -= 1;\r\n\r\n        if (actI === -1) {\r\n          d3.select(this).attr(\"offset\", `${0}%`);\r\n        } else if (actI === levs.length) {\r\n          d3.select(this).attr(\"offset\", `100%`);\r\n        } else {\r\n          d3.select(this).attr(\"offset\", `${(1 - levs[actI] / maxLev) * 100}%`);\r\n        }\r\n      });\r\n\r\n      const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n      s.select(\".bbox\")\r\n        .attr(\"x\", dropBBox.x)\r\n        .attr(\"y\", dropBBox.y)\r\n        .attr(\"width\", dropBBox.width)\r\n        .attr(\"height\", dropBBox.height);\r\n    })\r\n    .on(\"click\", function (_, d) {\r\n      onClick && onClick(d);\r\n    })\r\n    .on(\"mouseenter\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"display\", \"initial\");\r\n      onHover && onHover(d);\r\n    })\r\n    .on(\"mouseleave\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"display\", \"none\");\r\n      onUnhover && onUnhover(d);\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\r\n      \"transform\",\r\n      ({ globalX, globalY, x, y }) =>\r\n        `translate(${globalX + x * (SPREAD - 1)}, ${\r\n          globalY + y * (SPREAD - 1)\r\n        }) rotate(${0})`\r\n    );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\nimport { Scrollama, Step } from \"react-scrollama\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { isState, useStateRef, wrap } from \"utils/misc-utils\";\r\n\r\nimport yearlyData from \"data/yearly.json\";\r\nimport {\r\n  DELIV_KEY_STRING,\r\n  MAX_DELIVS,\r\n  OBJECTIVES_DATA,\r\n  SCENARIO_KEY_STRING,\r\n} from \"data/objectives-data\";\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\nimport BucketGlyph from \"bucket-lib/BucketGlyph\";\r\nimport WaterdropGlyph from \"components/WaterdropGlyph\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\n\r\nconst DATE_START = 1921;\r\nconst INTERP_COLOR = d3.interpolateRgbBasis([\r\n  \"#F2F5FB\",\r\n  \"#D0DDEB\",\r\n  \"#7B9BC0\",\r\n  \"#4F739F\",\r\n  \"#112A57\",\r\n]);\r\n\r\nconst D_KEY = \"demand\",\r\n  C_KEY = \"carryover\",\r\n  P_KEY = \"priority\",\r\n  R_KEY = \"regs\",\r\n  M_KEY = \"minflow\";\r\n\r\nconst NUM_OPTS = {\r\n  [D_KEY]: 5,\r\n  [C_KEY]: 3,\r\n  [P_KEY]: 2,\r\n  [R_KEY]: 4,\r\n  [M_KEY]: 5,\r\n};\r\n\r\nconst THRESHOLDS = {};\r\n\r\nObject.keys(NUM_OPTS).forEach(\r\n  (variable) =>\r\n    (THRESHOLDS[variable] = d3.scaleQuantize(\r\n      ticksExact(0, 1, NUM_OPTS[variable])\r\n    ))\r\n);\r\n\r\nconst DEFAULT_SCENARIO = {\r\n  demand: 1,\r\n  carryover: 1,\r\n  priority: 0,\r\n  regs: 0,\r\n  minflow: 0,\r\n};\r\n\r\nconst VARIATIONS = [\r\n  [1, 1, 1, 0, 0],\r\n  [1, 2, 0, 0, 0],\r\n  [1, 1, 0, 0, 4],\r\n  [1, 1, 0, 3, 0],\r\n];\r\n\r\nconst VARIATIONS_DELIVS = VARIATIONS.map(\r\n  (vars) =>\r\n    OBJECTIVES_DATA[\"DEL_CVP_PAG_N\"][SCENARIO_KEY_STRING][serialize(...vars)][\r\n      DELIV_KEY_STRING\r\n    ]\r\n);\r\n\r\nconst VARIATIONS_INTERPERS = VARIATIONS_DELIVS.map((varDelivs) =>\r\n  d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, varDelivs.length))\r\n    .range(\r\n      varDelivs\r\n        .map((v) => v / MAX_DELIVS)\r\n        .sort()\r\n        .reverse()\r\n    )\r\n    .clamp(true)\r\n);\r\n\r\nexport default function TutorialView() {\r\n  const {\r\n    waterdrops,\r\n    state,\r\n    setState,\r\n    camera,\r\n    zoomTo,\r\n    setActiveWaterdrops,\r\n    activeWaterdrops,\r\n    setDisableCamAdjustments,\r\n    getOutlineOpac,\r\n    addZoomHandler,\r\n  } = useContext(AppContext);\r\n\r\n  const [slide, setSlide] = useState(0);\r\n  const [userGoal, setUserGoal] = useState(200);\r\n  const [bucketInterper, setBucketInterper] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [dropInterper, setDropInterper] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [variationInterpers, setVariationInterpers] = useState(() =>\r\n    VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n  );\r\n  const d3Refs = useRef({});\r\n\r\n  const width = 800,\r\n    height = 400;\r\n\r\n  const margin = { top: 30, right: 30, bottom: 30, left: 60 };\r\n\r\n  useEffect(function initialize() {\r\n    //\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"TutorialView\")) {\r\n        document.querySelector(\".bucket-wrapper\").style.display = \"none\";\r\n        const svgContainer = d3.select(\"#tut-bar-graph\");\r\n        d3.selectAll(\".vardrop\").style(\"display\", \"none\");\r\n        d3.selectAll(\".vardrop p\").style(\"display\", \"none\");\r\n        d3.selectAll(\".vardrop > :last-child\").style(\"display\", \"none\");\r\n        d3.select(\".main-histogram\").style(\"display\", \"none\");\r\n\r\n        const svgGroup = svgContainer\r\n          .attr(\"width\", width + margin.left + margin.right)\r\n          .attr(\"height\", height + margin.top + margin.bottom)\r\n          .attr(\"opacity\", 1)\r\n          .append(\"g\")\r\n          .attr(\"class\", \"svg-group\")\r\n          .attr(\"transform\", `translate(${margin.left},${margin.top})`);\r\n\r\n        const dataDescending = yearlyData\r\n          .map((val, placeFromLeft) => ({\r\n            val,\r\n            placeFromLeft,\r\n            year: placeFromLeft + DATE_START,\r\n          }))\r\n          .sort((a, b) => b.val - a.val);\r\n\r\n        const x = d3\r\n          .scaleBand()\r\n          .domain(dataDescending.map(({ year }) => year).sort())\r\n          .range([0, width])\r\n          .padding(0.4);\r\n        const y = d3.scaleLinear().domain([0, MAX_DELIVS]).range([height, 0]);\r\n\r\n        const xaxis = d3\r\n          .axisBottom(x)\r\n          .tickSize(0)\r\n          .tickValues(x.domain().filter((_, i) => i % 10 === 0));\r\n\r\n        svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n        svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"transform\", `translate(0, ${height})`)\r\n          .call(xaxis)\r\n          .selectAll(\"text\")\r\n          .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n          .style(\"text-anchor\", \"end\");\r\n        svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n        d3Refs.current.x = x;\r\n        d3Refs.current.xaxis = xaxis;\r\n        d3Refs.current.dataDescending = dataDescending;\r\n\r\n        return function exitState() {\r\n          d3.select(\".tutorial-view\").style(\"display\", \"none\");\r\n          d3.select(\"#mosaic-webgl\").style(\"display\", \"initial\");\r\n          d3.select(\"#mosaic-svg\").style(\"display\", \"initial\");\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  const [currentStepIndex, setCurrentStepIndex] = useState(null);\r\n  const maxSlideReachedRef = useRef(-1);\r\n\r\n  const onStepEnter = async ({ data, direction }) => {\r\n    setCurrentStepIndex(data);\r\n\r\n    if (direction === \"up\") return;\r\n\r\n    if (data <= maxSlideReachedRef.current) return;\r\n\r\n    maxSlideReachedRef.current = data;\r\n\r\n    const svgGroup = d3.select(\".svg-group\");\r\n    const { x, xaxis, dataDescending } = d3Refs.current;\r\n    const y = d3.scaleLinear().domain([0, MAX_DELIVS]).range([height, 0]);\r\n\r\n    if (data === 2) {\r\n      svgGroup\r\n        .selectAll(\".bars\")\r\n        .data(dataDescending, (d) => d.placeFromLeft)\r\n        .join(\"rect\")\r\n        .attr(\"class\", \"bars\")\r\n        .attr(\"x\", (d) => x(d.year))\r\n        .attr(\"y\", height)\r\n        .attr(\"width\", x.bandwidth())\r\n        .attr(\"height\", 0)\r\n        .attr(\"opacity\", 1)\r\n        .attr(\"fill\", \"steelblue\")\r\n        .transition()\r\n        .duration(500)\r\n        .delay((d) => d.placeFromLeft * 10)\r\n        .attr(\"y\", (d) => y(d.val))\r\n        .attr(\"height\", (d) => height - y(d.val));\r\n    }\r\n\r\n    if (data === 4) {\r\n      const newWidth = width / 8;\r\n\r\n      svgGroup.select(\".anim-xaxis\").call(xaxis.tickFormat(\"\"));\r\n\r\n      const bars = svgGroup.selectAll(\".bars\");\r\n\r\n      await bars\r\n        .style(\"mix-blend-mode\", \"multiply\")\r\n        .transition()\r\n        .duration(500)\r\n        .attr(\"opacity\", 0.05)\r\n        .transition()\r\n        .delay(\r\n          (d) =>\r\n            100 +\r\n            (1 - (1 - d.placeFromLeft / dataDescending.length) ** 4) * 1000\r\n        )\r\n        .duration(500)\r\n        .attr(\"width\", newWidth)\r\n        .attr(\"x\", (d) => width / 2 - newWidth / 2)\r\n        .end();\r\n\r\n      svgGroup\r\n        .select(\".anim-xaxis\")\r\n        .transition()\r\n        .transition(500)\r\n        .attr(\"transform\", `translate(0, ${height + 50})`)\r\n        .attr(\"opacity\", 0);\r\n\r\n      bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n      svgGroup\r\n        .transition()\r\n        .delay(500)\r\n        .attr(\r\n          \"transform\",\r\n          `translate(${margin.left + width / 2 - newWidth / 2},${margin.top})`\r\n        );\r\n    }\r\n\r\n    if (data === 5) {\r\n      document.querySelector(\".bucket-wrapper\").style.display = \"initial\";\r\n      d3.select(\"#tut-bar-graph\").attr(\"opacity\", 0);\r\n\r\n      setBucketInterper(() =>\r\n        d3\r\n          .scaleLinear()\r\n          .domain(\r\n            ticksExact(\r\n              0,\r\n              1,\r\n              OBJECTIVES_DATA[\"DEL_CVP_PAG_N\"][SCENARIO_KEY_STRING][\r\n                serialize(...Object.values(DEFAULT_SCENARIO))\r\n              ][DELIV_KEY_STRING].length\r\n            )\r\n          )\r\n          .range(\r\n            OBJECTIVES_DATA[\"DEL_CVP_PAG_N\"][SCENARIO_KEY_STRING][\r\n              serialize(...Object.values(DEFAULT_SCENARIO))\r\n            ][DELIV_KEY_STRING].map((v) => v / MAX_DELIVS)\r\n              .sort()\r\n              .reverse()\r\n          )\r\n          .clamp(true)\r\n      );\r\n    }\r\n\r\n    if (data === 6) {\r\n      setDropInterper(() =>\r\n        d3\r\n          .scaleLinear()\r\n          .domain(\r\n            ticksExact(\r\n              0,\r\n              1,\r\n              OBJECTIVES_DATA[\"DEL_CVP_PAG_N\"][SCENARIO_KEY_STRING][\r\n                serialize(...Object.values(DEFAULT_SCENARIO))\r\n              ][DELIV_KEY_STRING].length\r\n            )\r\n          )\r\n          .range(\r\n            OBJECTIVES_DATA[\"DEL_CVP_PAG_N\"][SCENARIO_KEY_STRING][\r\n              serialize(...Object.values(DEFAULT_SCENARIO))\r\n            ][DELIV_KEY_STRING].map((v) => v / MAX_DELIVS)\r\n              .sort()\r\n              .reverse()\r\n          )\r\n          .clamp(true)\r\n      );\r\n    }\r\n\r\n    if (data === 8) {\r\n      d3.selectAll(\".vardrop\").style(\"display\", \"initial\");\r\n    }\r\n\r\n    if (data === 9) {\r\n      d3.selectAll(\".vardrop path\").style(\"stroke-dasharray\", \"none\");\r\n      setVariationInterpers(VARIATIONS_INTERPERS);\r\n    }\r\n\r\n    if (data === 10) {\r\n      d3.selectAll(\".vardrop p\").style(\"display\", \"block\");\r\n    }\r\n\r\n    if (data === 11) {\r\n      d3.select(\".drop1\").classed(\"highlighted\", true);\r\n    }\r\n\r\n    if (data === 12) {\r\n      d3.select(\".drop1\").classed(\"highlighted\", false);\r\n      d3.select(\".drop1-border\").style(\"visibility\", \"hidden\");\r\n      d3.selectAll(\".vardrop p\").style(\"opacity\", \"0.5\");\r\n      d3.selectAll(\".vardrop p, .vardrop span\").style(\"color\", \"gray\");\r\n      d3.selectAll(\".drop1 > :first-child, .drop3 > :first-child\")\r\n        .transition()\r\n        .style(\"transform\", \"translate(-50px, 15px) scale(0.5)\");\r\n      d3.selectAll(\".drop2 > :first-child, .drop4 > :first-child\")\r\n        .transition()\r\n        .style(\"transform\", \"translate(50px, 15px) scale(0.5)\");\r\n      d3.select(\".main-histogram\").style(\"display\", \"initial\");\r\n      d3.select(\".main-waterdrop\")\r\n        .transition()\r\n        .style(\"transform\", \"translateY(-100px) scale(0.5)\");\r\n      d3.selectAll(\".vardrop > :last-child\").style(\"display\", \"initial\");\r\n      d3.selectAll(\".vardrop > :last-child\").style(\"display\", \"initial\");\r\n    }\r\n  };\r\n\r\n  if (!isState(state, \"TutorialView\")) return;\r\n\r\n  return (\r\n    <div className=\"tutorial-view\">\r\n      <div className=\"card1\">\r\n        <p>\r\n          <em>How much water do the people of California get?</em> For starters,\r\n          let's focus on the agriculture sector in the north of the delta.\r\n        </p>\r\n        <img\r\n          src=\"./northdelta.png\"\r\n          alt=\"Map of California with northern delta area highlighted\"\r\n        />\r\n      </div>\r\n      <div className=\"scrollama scrollama-1\">\r\n        <div className=\"tut-graph-wrapper\">\r\n          <svg id=\"tut-bar-graph\"></svg>\r\n          <BucketGlyph\r\n            levelInterp={bucketInterper}\r\n            width={300}\r\n            height={height}\r\n            colorInterp={INTERP_COLOR}\r\n          />\r\n        </div>\r\n        <Scrollama offset={0.5} onStepEnter={onStepEnter}>\r\n          <Step data={2} key={2}>\r\n            <div className=\"tut-text-card\">\r\n              This is the average yearly amount of water this group receives,\r\n              specifically from the <b>Central Valley Project</b>, one of two\r\n              water municipalities in California.\r\n            </div>\r\n          </Step>\r\n          <Step data={3} key={3}>\r\n            <div className=\"tut-text-card\">\r\n              Here, it is presented as a bar graph, with the bottom axis\r\n              representing the year and the side axis representing the amount of\r\n              water in thousand acre-feet (TAF).\r\n            </div>\r\n          </Step>\r\n          <Step data={4} key={4}>\r\n            <div className=\"tut-text-card\">\r\n              We'll condense this bar graph into a single bar with a filled\r\n              gradient.\r\n            </div>\r\n          </Step>\r\n          <Step data={5} key={5}>\r\n            <div className=\"tut-text-card\" style={{ marginBottom: \"80vh\" }}>\r\n              What we get is a bucket of water showing which water levels are\r\n              most likely, with the darker areas being the most likely water\r\n              levels.\r\n            </div>\r\n          </Step>\r\n        </Scrollama>\r\n      </div>\r\n      <div className=\"scrollama scrollama-2\">\r\n        <div className=\"tut-drop-graphics-wrapper\">\r\n          <div className=\"main-waterdrop\">\r\n            <WaterdropGlyph\r\n              levelInterp={dropInterper}\r\n              width={400}\r\n              height={height}\r\n              colorInterp={INTERP_COLOR}\r\n            />\r\n          </div>\r\n          <div className=\"main-histogram\">\r\n            <DotHistogram\r\n              width={210}\r\n              height={140}\r\n              data={\r\n                OBJECTIVES_DATA[\"DEL_CVP_PAG_N\"][SCENARIO_KEY_STRING][\r\n                  serialize(...Object.values(DEFAULT_SCENARIO))\r\n                ][DELIV_KEY_STRING]\r\n              }\r\n              goal={userGoal}\r\n              setGoal={(newGoal) => {\r\n                setUserGoal(newGoal);\r\n              }}\r\n            />\r\n          </div>\r\n          <div className=\"vardrop drop1\">\r\n            <WaterdropGlyph\r\n              levelInterp={variationInterpers[0]}\r\n              width={400}\r\n              height={(height * 2) / 3}\r\n              colorInterp={INTERP_COLOR}\r\n            />\r\n            <p>\r\n              scenario <span className=\"scen-number\">0180</span>\r\n            </p>\r\n            <DotHistogram\r\n              shortForm\r\n              width={210}\r\n              height={140}\r\n              data={VARIATIONS_DELIVS[0]}\r\n              goal={userGoal}\r\n              setGoal={(newGoal) => {\r\n                setUserGoal(newGoal);\r\n              }}\r\n            />\r\n          </div>\r\n          <div className=\"vardrop drop2\">\r\n            <WaterdropGlyph\r\n              levelInterp={variationInterpers[1]}\r\n              width={400}\r\n              height={(height * 2) / 3}\r\n              colorInterp={INTERP_COLOR}\r\n            />\r\n            <p>\r\n              scenario <span className=\"scen-number\">0200</span>\r\n            </p>\r\n            <DotHistogram\r\n              shortForm\r\n              width={210}\r\n              height={140}\r\n              data={VARIATIONS_DELIVS[1]}\r\n              goal={userGoal}\r\n              setGoal={(newGoal) => {\r\n                setUserGoal(newGoal);\r\n              }}\r\n            />\r\n          </div>\r\n          <div className=\"vardrop drop3\">\r\n            <WaterdropGlyph\r\n              levelInterp={variationInterpers[2]}\r\n              width={400}\r\n              height={(height * 2) / 3}\r\n              colorInterp={INTERP_COLOR}\r\n            />\r\n            <p>\r\n              scenario <span className=\"scen-number\">0164</span>\r\n            </p>\r\n            <DotHistogram\r\n              shortForm\r\n              width={210}\r\n              height={140}\r\n              data={VARIATIONS_DELIVS[2]}\r\n              goal={userGoal}\r\n              setGoal={(newGoal) => {\r\n                setUserGoal(newGoal);\r\n              }}\r\n            />\r\n          </div>\r\n          <div className=\"vardrop drop4\">\r\n            <WaterdropGlyph\r\n              levelInterp={variationInterpers[3]}\r\n              width={400}\r\n              height={(height * 2) / 3}\r\n              colorInterp={INTERP_COLOR}\r\n            />\r\n            <p>\r\n              scenario <span className=\"scen-number\">0175</span>\r\n            </p>\r\n            <DotHistogram\r\n              shortForm\r\n              width={210}\r\n              height={140}\r\n              data={VARIATIONS_DELIVS[3]}\r\n              goal={userGoal}\r\n              setGoal={(newGoal) => {\r\n                setUserGoal(newGoal);\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n        <Scrollama offset={0.5} onStepEnter={onStepEnter}>\r\n          <Step data={6} key={6}>\r\n            <div className=\"tut-text-card\">\r\n              Here it is as a drop of water. We see here that the lightest color\r\n              reaches the midpoint of the maximum water possible, meaning that\r\n              there is a chance that this group will receive 600 TAF of water.\r\n            </div>\r\n          </Step>\r\n          <Step data={7} key={7}>\r\n            <div className=\"tut-text-card\">\r\n              The darker colors, however, indicate that it's more likely this\r\n              group will receive less than a quarter of the maximum, or around\r\n              300 TAF. As we'll later see, this is not a lot compared to other\r\n              areas of California.\r\n            </div>\r\n          </Step>\r\n          <Step data={8} key={8}>\r\n            <div className=\"tut-text-card\">\r\n              But what if we could <em>change reality</em>? What if we could\r\n              increase the likelihood of getting as much water as possible by\r\n              changing the way we manage it?\r\n            </div>\r\n          </Step>\r\n          <Step data={9} key={9}>\r\n            <div className=\"tut-text-card\">\r\n              Fortunately, we can explore those possibilities with the help of a\r\n              simulator called\r\n              <b> CalSim</b>.\r\n            </div>\r\n          </Step>\r\n          <Step data={10} key={10}>\r\n            <div className=\"tut-text-card\">\r\n              These variations are called <em>scenarios</em> and are labelled\r\n              with unique numbers.\r\n            </div>\r\n          </Step>\r\n          <Step data={11} key={11}>\r\n            <div className=\"tut-text-card\">\r\n              At a glance, we can easily see that scenario 0180 appears to be\r\n              the best scenario since the darker water levels reach higher than\r\n              those of the other scenarios. To more concretely compare these\r\n              scenarios, however, we'll use a different view.\r\n            </div>\r\n          </Step>\r\n          <Step data={12} key={12}>\r\n            <div className=\"tut-text-card\" style={{ marginBottom: \"120vh\" }}>\r\n              Try moving the red line to change the minimum demand and see how\r\n              well each of these scenarios meet those demands.\r\n            </div>\r\n          </Step>\r\n        </Scrollama>\r\n      </div>\r\n      <div>\r\n        <div className=\"tut-text-card\">\r\n          What are the ways we can manage California's water, and what are their\r\n          outcomes? Go to the next step to find out!\r\n          <button\r\n            className=\"fancy-font\"\r\n            onClick={() => setState({ state: \"WideView\" })}\r\n          >\r\n            click to explore!\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction serialize(demand, carryover, priority, regs, minflow) {\r\n  let code = 0;\r\n  code += minflow;\r\n  code += NUM_OPTS.minflow * regs;\r\n  code += NUM_OPTS.regs * NUM_OPTS.minflow * priority;\r\n  code += NUM_OPTS.priority * NUM_OPTS.regs * NUM_OPTS.minflow * carryover;\r\n  code +=\r\n    NUM_OPTS.carryover *\r\n    NUM_OPTS.priority *\r\n    NUM_OPTS.regs *\r\n    NUM_OPTS.minflow *\r\n    demand;\r\n\r\n  const finalKey = `expl${d3.format(\"0>4\")(code)}`;\r\n\r\n  return finalKey;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useCallback, useContext, useEffect, useState } from \"react\";\r\nimport { BiCross, BiNetworkChart } from \"react-icons/bi\";\r\n\r\nimport {\r\n  GROUP_HOVER_AREA_FACTOR,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n  LOD_2_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\nimport { AppContext } from \"AppContext\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport {\r\n  CALIFORNIA_CENTER,\r\n  CALIFORNIA_OUTLINE,\r\n  SPATIAL_DATA,\r\n  SPATIAL_FEATURES,\r\n} from \"data/spatial-data\";\r\nimport { dropsMesh, scene } from \"three-resources\";\r\n\r\nimport {\r\n  avgCoords,\r\n  dist,\r\n  dropCenterCorrection,\r\n  getCenterDomRect,\r\n} from \"utils/math-utils\";\r\nimport { isState, useStateRef, wrap } from \"utils/misc-utils\";\r\nimport { circlet } from \"utils/render-utils\";\r\n\r\nconst SPREAD = LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\nexport default function WideView() {\r\n  const {\r\n    waterdrops,\r\n    state,\r\n    setState,\r\n    camera,\r\n    zoomTo,\r\n    setActiveWaterdrops,\r\n    activeWaterdrops,\r\n    setDisableCamAdjustments,\r\n    getOutlineOpac,\r\n    addZoomHandler,\r\n  } = useContext(AppContext);\r\n\r\n  const [activeWDObjs, setActiveWDObjs] = useState([]);\r\n  const [enableZoom, setEnableZoom, enableZoomRef] = useStateRef(false);\r\n\r\n  const [transformInfo, setTransformInfo] = useState({\r\n    zoom: 1,\r\n    mouseX: 0,\r\n    mouseY: 0,\r\n  });\r\n\r\n  const [curInfo, setCurInfo] = useState(null);\r\n\r\n  const getFontSize = (d, transformZoom) => {\r\n    const MAX_RAD = window.innerHeight / 9;\r\n\r\n    const zoomRel = ((1 / transformZoom) * camera.height) / waterdrops.height;\r\n\r\n    const absFontSize = (_d) =>\r\n      _d > MAX_RAD\r\n        ? 0\r\n        : d3.scaleLinear().domain([0, MAX_RAD]).range([1, 0.4]).clamp(true)(_d);\r\n\r\n    return absFontSize(d * zoomRel) * Math.min(zoomRel, 0.4);\r\n  };\r\n\r\n  useEffect(function initialize() {\r\n    d3.select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"wide-group\");\r\n\r\n    addZoomHandler(function (transform) {\r\n      setTransformInfo((ti) => ({\r\n        ...ti,\r\n        zoom: transform.k,\r\n      }));\r\n    });\r\n\r\n    const mouseListener = (e) => {\r\n      setTransformInfo((ti) => ({\r\n        ...ti,\r\n        mouseX: e.x,\r\n        mouseY: e.y,\r\n      }));\r\n    };\r\n\r\n    window.addEventListener(\"mousemove\", mouseListener);\r\n\r\n    const mmWidth = 200,\r\n      mmHeight = 250;\r\n\r\n    const minimap = d3\r\n      .select(\"#minimap\")\r\n      .attr(\"width\", mmWidth)\r\n      .attr(\"height\", mmHeight);\r\n\r\n    const mmProj = d3\r\n      .geoMercator()\r\n      .scale(1000)\r\n      .center(CALIFORNIA_CENTER)\r\n      .translate([mmWidth / 2, mmHeight / 2]);\r\n\r\n    const lineGeom = [\r\n      ...SPATIAL_DATA.features.filter(\r\n        (f) => f.geometry.type === \"MultiPolygon\"\r\n      ),\r\n      CALIFORNIA_OUTLINE,\r\n    ];\r\n    const pointGeom = SPATIAL_DATA.features.filter(\r\n      (f) => f.geometry.type === \"MultiPoint\"\r\n    );\r\n\r\n    minimap\r\n      .selectAll(\"path\")\r\n      .data(lineGeom)\r\n      .join(\"path\")\r\n      .attr(\"d\", (d) => d3.geoPath().projection(mmProj)(d))\r\n      .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n      .attr(\"stroke\", (d) =>\r\n        d.properties.CalLiteID ? \"transparent\" : \"lightgray\"\r\n      )\r\n      .attr(\"stroke-width\", 1)\r\n      .attr(\"fill\", \"transparent\");\r\n\r\n    minimap\r\n      .selectAll(\"circle\")\r\n      .data(pointGeom)\r\n      .join(\"circle\")\r\n      .each(function (d) {\r\n        const s = d3.select(this);\r\n\r\n        const [x, y] = mmProj(d.geometry.coordinates[0]);\r\n\r\n        s.attr(\"cx\", x);\r\n        s.attr(\"cy\", y);\r\n      })\r\n      .attr(\"r\", 2)\r\n      .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n      .attr(\"fill\", \"transparent\");\r\n\r\n    d3.select(\".infobox\").style(\"display\", \"none\");\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener(\"mousemove\", mouseListener);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(\r\n    function updateFontSizes() {\r\n      d3.select(\".infobox\").attr(\"display\", \"none\");\r\n\r\n      if (!enableZoomRef.current) return;\r\n\r\n      d3.select(\"#wide-group\")\r\n        .selectAll(\"text\")\r\n        .each(function () {\r\n          const s = d3.select(this);\r\n          const tNode = s.node();\r\n\r\n          const [posx, posy] = getCenterDomRect(tNode.getBoundingClientRect());\r\n\r\n          const width =\r\n              ((tNode.getBBox().width * camera.height) / camera.far) * 8,\r\n            height =\r\n              ((tNode.getBBox().height * camera.height) / camera.far) * 10;\r\n\r\n          const dis = dist(\r\n            [posx, posy],\r\n            [transformInfo.mouseX, transformInfo.mouseY]\r\n          );\r\n\r\n          s.attr(\"font-size\", getFontSize(dis, transformInfo.zoom));\r\n\r\n          d3.select(this.parentNode.parentNode)\r\n            .select(\"image\")\r\n            .attr(\"x\", -width / 2)\r\n            .attr(\"y\", -height / 2)\r\n            .attr(\"width\", width)\r\n            .attr(\"height\", height);\r\n        });\r\n    },\r\n    [transformInfo]\r\n  );\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"WideView\")) {\r\n        d3.select(\"body\").style(\"overflow\", \"hidden\");\r\n\r\n        setEnableZoom(true);\r\n        setTransformInfo((ti) => ({ ...ti, zoom: camera.curTransform.k }));\r\n\r\n        console.time(\"drawing\");\r\n        dropsMesh.draw(scene);\r\n        console.timeEnd(\"drawing\");\r\n\r\n        const origOpac = getOutlineOpac(camera.curTransform.k);\r\n\r\n        dropsMesh.updateVisibility(1);\r\n        dropsMesh.updateOutlineVisibility(origOpac);\r\n\r\n        const container = d3.select(\"#wide-group\");\r\n        d3.select(\".infobox\").style(\"display\", \"initial\");\r\n        d3.select(\"#mosaic-webgl\").style(\"display\", \"initial\");\r\n        d3.select(\"#mosaic-svg\").style(\"display\", \"initial\");\r\n\r\n        updateLargeDropSVG(container, waterdrops, {\r\n          onClick: (d) => {\r\n            setActiveWDObjs((wd) => {\r\n              const found = wd.findIndex((wd) => wd.key === d.key);\r\n              if (found !== -1) {\r\n                wd.splice(found, 1);\r\n              } else {\r\n                wd.push(d);\r\n              }\r\n              return [...wd];\r\n            });\r\n\r\n            setActiveWaterdrops((wd) => {\r\n              if (wd.includes(d.key)) {\r\n                wd.splice(wd.indexOf(d.key), 1);\r\n                container.select(\".circlet.\" + d.key).classed(\"active\", false);\r\n              } else {\r\n                wd.push(d.key);\r\n                container.select(\".circlet.\" + d.key).classed(\"active\", true);\r\n              }\r\n              return [...wd];\r\n            });\r\n          },\r\n          onHover: (d) => {\r\n            setCurInfo({\r\n              id: d.key,\r\n              description: DESCRIPTIONS_DATA[d.key].desc,\r\n            });\r\n\r\n            if (!SPATIAL_FEATURES[d.key]) return;\r\n\r\n            d3.select(\"#minimap\")\r\n              .select(\".outline.\" + d.key)\r\n              .attr(\"fill\", \"gray\");\r\n          },\r\n          onUnhover: (d) => {\r\n            setCurInfo(null);\r\n\r\n            if (!SPATIAL_FEATURES[d.key]) return;\r\n\r\n            d3.select(\"#minimap\")\r\n              .select(\".outline.\" + d.key)\r\n              .attr(\"fill\", \"transparent\");\r\n          },\r\n        });\r\n\r\n        for (const wd of activeWDObjs) {\r\n          container.select(\".circlet.\" + wd.key).classed(\"active\", true);\r\n        }\r\n\r\n        return function exitState() {\r\n          d3.select(\"#wide-group\")\r\n            .selectAll(\".large-drop\")\r\n            .attr(\"display\", \"none\");\r\n          d3.select(\".infobox\").style(\"display\", \"none\");\r\n          setEnableZoom(false);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  const handleClick = useCallback(\r\n    function () {\r\n      if (activeWDObjs.length === 1) {\r\n        const { x, y, height } = activeWDObjs[0];\r\n\r\n        const { start, duration } = zoomTo(\r\n          [\r\n            x,\r\n            y - dropCenterCorrection({ height }),\r\n            camera.getZFromFarHeight(height * SPREAD * 1.5),\r\n          ],\r\n          () => {\r\n            setDisableCamAdjustments(false);\r\n          }\r\n        );\r\n\r\n        start();\r\n\r\n        setState({ state: \"ExamineView\", transitionDuration: duration });\r\n\r\n        const origOpac = getOutlineOpac(camera.curTransform.k);\r\n        setDisableCamAdjustments(true);\r\n\r\n        const t = d3.timer((elapsed) => {\r\n          const et = Math.min(1, elapsed / (duration / 2));\r\n\r\n          dropsMesh.updateVisibility(1 - et);\r\n          dropsMesh.updateOutlineVisibility(origOpac * (1 - et));\r\n\r\n          if (et >= 1) {\r\n            t.stop();\r\n            dropsMesh.remove(scene);\r\n          }\r\n        });\r\n      } else if (activeWDObjs.length > 1) {\r\n        const [avgX, avgY] = avgCoords(activeWDObjs.map((w) => [w.x, w.y]));\r\n\r\n        const { start, duration } = zoomTo(\r\n          [\r\n            avgX,\r\n            avgY,\r\n            camera.getZFromFarHeight(\r\n              waterdrops.groups[0].height * 2 * SPREAD * 0.75 * 2\r\n            ),\r\n          ],\r\n          () => {\r\n            setDisableCamAdjustments(false);\r\n          }\r\n        );\r\n\r\n        start();\r\n\r\n        setState({\r\n          state: \"CompareView\",\r\n          transitionDuration: duration,\r\n          avgCoord: [avgX, avgY],\r\n        });\r\n\r\n        const origOpac = getOutlineOpac(camera.curTransform.k);\r\n        setDisableCamAdjustments(true);\r\n\r\n        const t = d3.timer((elapsed) => {\r\n          const et = Math.min(1, elapsed / (duration / 5));\r\n\r\n          dropsMesh.updateVisibility(1 - et);\r\n          dropsMesh.updateOutlineVisibility(origOpac * (1 - et));\r\n\r\n          if (et >= 1) {\r\n            t.stop();\r\n\r\n            dropsMesh.remove(scene);\r\n          }\r\n        });\r\n      }\r\n    },\r\n    [activeWDObjs]\r\n  );\r\n\r\n  let actionBtn;\r\n\r\n  if (isState(state, \"WideView\") && activeWaterdrops.length) {\r\n    actionBtn = (\r\n      <button onClick={handleClick} className=\"wide-view-action-btn fancy-font\">\r\n        {activeWaterdrops.length === 1 ? <BiCross /> : <BiNetworkChart />}\r\n        {activeWaterdrops.length === 1 ? \"examine\" : \"compare\"}\r\n      </button>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"infobox\">\r\n        <svg id=\"minimap\"></svg>\r\n        {curInfo && (\r\n          <div className=\"details\">\r\n            {!SPATIAL_FEATURES[curInfo.id] && (\r\n              <p className=\"no-loc-data\">No Location Data</p>\r\n            )}\r\n            <p className=\"curDesc\">{curInfo.description}</p>\r\n            <p className=\"curKey\">\r\n              id: <span> {curInfo.id} </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n      {actionBtn}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction updateLargeDropSVG(\r\n  container,\r\n  waterdrops,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdrops.groups)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(function () {\r\n          const s = d3.select(this);\r\n\r\n          s.append(\"g\")\r\n            .attr(\"class\", \"circlet\")\r\n            .append(\"circle\")\r\n            .call(circlet)\r\n            .attr(\"display\", \"none\")\r\n            .attr(\"r\", 1);\r\n\r\n          const textGroup = s.append(\"g\");\r\n          textGroup\r\n            .append(\"g\")\r\n            .append(\"image\")\r\n            .attr(\"href\", \"glow.png\")\r\n            .attr(\"preserveAspectRatio\", \"none\")\r\n            .attr(\"opacity\", 0.8);\r\n          textGroup\r\n            .append(\"g\")\r\n            .append(\"text\")\r\n            .attr(\"class\", \"fancy-font\")\r\n            .attr(\"text-anchor\", \"middle\")\r\n            .attr(\"font-size\", 0);\r\n        });\r\n    })\r\n    .each(function (d) {\r\n      d3.select(this)\r\n        .select(\".circlet\")\r\n        .attr(\"class\", null)\r\n        .attr(\"class\", \"circlet \" + d.key);\r\n      d3.select(this)\r\n        .select(\"text\")\r\n        .call((s) => {\r\n          s.selectAll(\"*\").remove();\r\n          const lines = wrap(\r\n            DESCRIPTIONS_DATA[d.key].display_name || DESCRIPTIONS_DATA[d.key].id\r\n          ).split(\"\\n\");\r\n\r\n          lines.forEach((line, i) => {\r\n            s.append(\"tspan\")\r\n              .attr(\"x\", 0)\r\n              .attr(\"y\", `${-lines.length / 2 + 0.5}em`)\r\n              .attr(\"dy\", `${i}em`)\r\n              .text(line);\r\n          });\r\n        });\r\n    })\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\r\n      \"transform\",\r\n      ({ x, y, height }) =>\r\n        `translate(${x}, ${y - dropCenterCorrection({ height })}) scale(${\r\n          height * GROUP_HOVER_AREA_FACTOR\r\n        })`\r\n    )\r\n    .on(\"click\", function (_, d) {\r\n      onClick && onClick(d);\r\n    })\r\n    .on(\"mouseenter\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"display\", \"initial\");\r\n      onHover && onHover(d);\r\n    })\r\n    .on(\"mouseleave\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"display\", \"none\");\r\n      onUnhover && onUnhover(d);\r\n    });\r\n}\r\n"],"names":["waterdrops","initWaterdrops","appWidth","window","innerWidth","appHeight","innerHeight","App","state","setState","stateRef","useStateRef","zoomCallbacks","setZoomCallbacks","zoomCallbacksRef","activeWaterdrops","setActiveWaterdrops","useState","goBack","setGoBack","disableCamAdjustments","setDisableCamAdjustments","disableCamAdjustmentsRef","goals","setGoals","goalMap","i","OBJECTIVE_IDS","length","getOutlineOpac","useCallback","d3","domain","height","groups","range","clamp","useEffect","document","querySelector","appendChild","renderer","domElement","attr","camera","mount","node","select","setZoomFn","transform","current","dropsMesh","updateOutlineVisibility","k","cb","setSize","setAnimationLoop","render","scene","resetCamera","animated","arguments","undefined","callback","pos","getZFromFarHeight","start","zoomTo","callZoomFromWorldViewport","worldX","worldY","farHeight","xyz","interpolateZoomCamera","duration","t","elapsed","et","Math","min","callZoom","stop","addZoomHandler","cbs","_jsxs","AppContext","Provider","value","pointsMesh","children","className","_jsx","id","style","display","TutorialView","WideView","ExamineView","CompareView","onClick","console","time","createMesh","timeEnd","createContext","DEGREE_SWAY","LEVELS","LINE_WIDTH","BucketGlyph","_ref","levelInterp","colorInterp","interpolateWatercolorBlue","width","resolution","useId","svgSelector","useRef","liquidLevels","useMemo","ticksExact","map","d","prevLiquidLevels","usePrevious","useLayoutEffect","svgContainer","append","concat","bucketPath","split","liquids","selectAll","data","join","_","transition","ease","period","delay","attrTween","diff","abs","sin","PI","ref","e","getQuantileBins","unitsPerQuantile","numQuantiles","histBins","thresholds","ceil","binnedQuantiles","quantileBins","quantiles","b","y","push","x1","x0","count","filled","taper","bottomRight","bottomLeft","x","lineFunc","numericBins","maxQuantiles","bin","round","sum","Infinity","isEqualFunc","prev","NUM_CIRCLES","MARGIN","top","right","bottom","left","DOMAIN","MAX_DELIVS","WATERDROP_ICON","draw","context","size","moveTo","lineTo","arc","SQRT2","closePath","DotHistogram","goal","setGoal","shortForm","razorID","floor","random","razorAreaID","circles","dataRange","filter","call","scale","tickFormat","s","text","razor","ignoreFn","preventDefault","dragging","addEventListener","removeEventListener","target","max","offsetX","svgCircles","enter","WaterdropGlyph","_ref2","dropD","points","waterdropDeltaOutline","dropPath","DROP_RAD","DROP_HEIGHT","DESCRIPTIONS_DATA","async","objs","fetch","json","log","mapBy","SCEN_DIVISOR","SCENARIO_KEY_STRING","DELIV_KEY_STRING","OBJECTIVES_DATA","obj","scen","unord","v","Array","from","sort","a","name","Object","keys","SCENARIO_IDS","values","FLATTENED_DATA","DATA_GROUPINGS","flattenedData","dataGroupings","objective","scenario","means","idx","deliveries","orderedDataGroupings","criteria","asdfasdf","key","ids","sortedObjScens","sorted","mean","flat","IDtoRank","j","rank","SPATIAL_DATA","SPATIAL_FEATURES","features","properties","CalLiteID","CALIFORNIA_OUTLINE","CALIFORNIA_CENTER","LOD_1_LEVELS","LOD_1_RAD_PX","LOD_1_MIN_LEV_VAL","LOD_1_SMALL_DROP_PAD_FACTOR","LOD_1_LARGE_DROP_PAD_FACTOR","LOD_2_SMALL_DROP_PAD_FACTOR","GROUP_HOVER_AREA_FACTOR","SQRT1_2","THREE","background","WaterdropMesh","WaterdropSimplifiedMesh","Camera","fov","near","far","antialias","grouping","groupKeys","memberKeys","amtPerGroup","largeDropRad","sqrt","smallDropRad","largeNodesPhys","placeDropsUsingPhysics","p","r","largeNodesPos","smallNodesPhys","smallNodesPos","nodes","groupNodes","groupToNodes","nodeData","createInterpsFromDelivs","levs","w","groupID","memberID","groupRank","memberRank","maxLev","domLev","calcDomLev","tilt","dur","group","globalX","globalY","groupKey","delivs","maxDelivs","generateWaterdrop","rad","delta","outer","cos","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","reuse","shape","bounds","Matter","create","minX","maxX","minY","maxY","genX","genY","contains","generateRandoPoints","WIDTH_AREA","AREA","radsToDropWidth","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","_ref3","nx","ny","circle","restitution","parts","quad","position","centre","vertices","isStatic","cage","setParts","setCentre","add","world","FPS","SECS","update","retVal","_ref4","CIRC_RAD","toRadians","dist","_ref7","_ref8","y1","x2","y2","_ref5","_ref6","distSq","getCenterDomRect","domRect","clipEnds","_ref9","shortenBy","to","len","normed","dropCenterCorrection","_ref10","dropRadToDropHeight","avgCoords","c","fn","newObjs","groupBy","sortBy","array","object","path","defaultValue","_object","part","get","pick","va","vb","val","_setState","curVal","isState","stateInfo","stateName","wrap","replace","genUUID","DROPLET_SHAPE","CIRC_HEIGHT","HAT_START","yToHalfWidth","trigX","angle","acos","yToSpriteY","spriteYToY","sy","yStart","yEnd","subdivs","Y_DELTA","rightCoords","leftCoords","dx1","dy1","dx2","dy2","v1","v2","v3","v4","reverse","waterdropDelta","MeshGeometry","constructor","numPoints","color","threeGeom","triangleIdx","this","setAttribute","Float32Array","positionAttribute","getAttribute","colorAttribute","addMeshCoords","meshCoords","z","setXYZ","g","finish","setDrawRange","added","updateMeshes","initializeMeshes","outlineMesh","remove","dropsGeometry","MAX_POINTS_DROPS","outlinePoints","outlineMeshCoords","dx","dy","vertexColors","transparent","opacity","setFromPoints","opac","material","needsUpdate","updateVisibility","MAX_POINTS_OUTLINE","vertToId","idToVert","mesh","initializeMesh","updateMesh","pointsGeometry","colors","t_color","pointsMaterial","sizeAttenuation","load","positionAttr","geometry","newX","newY","setXY","updatePoints","translations","dt","verts","setX","setY","verticesNeedUpdate","intersectObject","intersects","intersect","index","raycaster","zoomFn","zoom","on","curTransform","_THREEZoomHandler","_svgElement","view","translate","tan","getFarHeightFromZ","endx","endy","endz","interper","webglElement","svgElement","scaleExtent","getScaleFromZ","set","getZFromScale","camera_z_position","half_fov","half_fov_radians","fov_height","mouseX","mouseY","setFromCamera","circlet","SPREAD","useContext","activeMinidrop","setActiveMinidrop","panels","setPanels","groupsRef","centerRef","mouseDownInfo","cameraChangeFlag","setCameraChangeFlag","f","startX","deltaX","deltaY","startY","find","oldOffsetX","offsetY","oldOffsetY","positions","lines","calcLinesAndPositions","n","ox","oy","isLeft","centerX","centerY","correctionX","getIdealGroupPos","groupPositions","nodeID","textX","textY","smallTextSize","largeTextSize","slice","container","updateDropsSVG","getWaterdropGroups","avgCoord","transitionDuration","onHover","setTimeout","_Fragment","onMouseDown","clientX","clientY","onPanelDragStart","newGoal","keyArr","center","includes","waterdropGroups","transitionDelay","onUnhover","each","randId","stops","forEach","display_name","line","actI","dropBBox","getBBox","_ref11","groupsObj","activeMinidropKey","groupPos","activeMinidrops","setActiveMinidrops","activeMinidropsRef","previewMinidrop","setPreviewMinidrop","previewMinidropRef","addDetailPanel","dropId","removeDetailPanel","splice","findIndex","headerLabel","updateSmallDropSVG","wd","indexOf","classed","DATE_START","INTERP_COLOR","D_KEY","C_KEY","P_KEY","R_KEY","M_KEY","NUM_OPTS","THRESHOLDS","variable","DEFAULT_SCENARIO","demand","carryover","priority","regs","minflow","VARIATIONS","VARIATIONS_DELIVS","vars","serialize","VARIATIONS_INTERPERS","varDelivs","slide","setSlide","userGoal","setUserGoal","bucketInterper","setBucketInterper","dropInterper","setDropInterper","variationInterpers","setVariationInterpers","d3Refs","margin","svgGroup","dataDescending","yearlyData","placeFromLeft","year","padding","xaxis","tickSize","tickValues","currentStepIndex","setCurrentStepIndex","maxSlideReachedRef","onStepEnter","direction","bandwidth","newWidth","bars","end","src","alt","Scrollama","offset","Step","marginBottom","code","activeWDObjs","setActiveWDObjs","enableZoom","setEnableZoom","enableZoomRef","transformInfo","setTransformInfo","curInfo","setCurInfo","ti","mouseListener","minimap","mmProj","mmWidth","mmHeight","lineGeom","type","pointGeom","projection","coordinates","tNode","posx","posy","getBoundingClientRect","dis","getFontSize","transformZoom","MAX_RAD","zoomRel","_d","parentNode","origOpac","updateLargeDropSVG","found","description","desc","handleClick","avgX","avgY","actionBtn","BiCross","BiNetworkChart","textGroup"],"sourceRoot":""}