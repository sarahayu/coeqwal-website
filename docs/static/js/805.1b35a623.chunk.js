"use strict";(self.webpackChunkcoeqwal_website=self.webpackChunkcoeqwal_website||[]).push([[805],{805:(t,e,s)=>{s.a(t,(async(t,r)=>{try{s.r(e),s.d(e,{default:()=>M});var o=s(437),a=s(43),n=s(684),i=s(385),c=s(96),l=s(58),h=s(152),d=s(550),u=s(956),p=s(313),m=s(621),f=s(293),g=s(68),v=s(579),y=t([l,h,m]);[l,h,m]=y.then?(await y)():y;const b=L("objective"),x=window.innerWidth,k=window.innerHeight;function M(){const[t,e,s]=(0,u.iJ)({}),[r,n]=(0,a.useState)([]),[i,l]=(0,a.useState)(null),[h,d,y]=(0,u.iJ)(!1);(0,a.useEffect)((function(){document.querySelector("#mosaic-webgl").appendChild(g.Uk.domElement),o.Ltv("#mosaic-svg").attr("width",x).attr("height",k).append("g").attr("class","svg-trans"),g.UI.mount(o.Ltv(".bubbles-wrapper").node(),o.Ltv("#mosaic-svg").select(".svg-trans").node()),g.UI.setZoomFn((t=>{y.current||g.Q7.updateOutlineVisibility((0,g.mK)(t.k))})),g.UI.setSize(x,k),g.Uk.setAnimationLoop((()=>{g.Uk.render(g.JH,g.UI.camera)})),w(!1),e({state:"WideView"})}),[]);const w=(0,a.useCallback)((function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;const s=[0,.08*-b.height,g.UI.getZFromFarHeight(b.height)];if(t){const{start:t}=M(s,e);t()}else g.UI.callZoomFromWorldViewport({worldX:s[0],worldY:-s[1],farHeight:b.height}),e&&e()}),[]),M=(0,a.useCallback)(((t,e)=>{const s=g.UI.interpolateZoomCamera(t),r=s.duration/2;return{start:()=>{const t=o.O1W((o=>{const a=Math.min(o/r,1);g.UI.callZoom(s(a)),1===a&&(t.stop(),e&&e())}))},duration:r}}),[]);return(0,v.jsxs)(c.B.Provider,{value:{appWidth:x,appHeight:k,state:t,setState:e,activeWaterdrops:r,setActiveWaterdrops:n,setDisableCamAdjustments:d,waterdrops:b,scene:g.JH,camera:g.UI,renderer:g.Uk,pointsMesh:g.XA,dropsMesh:g.Q7,setGoBack:l,zoomTo:M,resetCamera:w},children:[(0,v.jsxs)("div",{className:"bubbles-wrapper",children:[(0,v.jsx)("div",{id:"mosaic-webgl"}),(0,v.jsx)("svg",{id:"mosaic-svg"})]}),(0,v.jsx)(p.A,{}),(0,v.jsx)(m.A,{}),(0,v.jsx)(f.A,{}),i&&(0,v.jsx)("button",{className:"go-back-btn",onClick:i,children:"\u2190"})]})}function L(t){const e="objective"===t?l.ZS:l.uV,s="objective"===t?l.uV:l.ZS,r=(e.length,s.length),o=Math.sqrt(r/Math.PI)*i.sU*2*i.pC*i.B0,a=i.sU*i.pC,c=(0,d.hh)(0,0,e.map(((t,e)=>({r:o,id:e})))),p=(0,u.Et)(c,(t=>{let{id:e}=t;return e})),m=(0,d.hh)(0,0,s.map(((t,e)=>({r:a,id:e})))),f=(0,u.Et)(m,(t=>{let{id:e}=t;return e})),g=[],v=[],y={};for(const d of l.vR){const{id:e,objective:s,scenario:r,deliveries:o}=d,a=(0,h.Dy)(o,l.pk),c=(0,n.kd)(0,1,i.h4+1).map((t=>a(t))).map(((t,e)=>Math.max(t,0==e?i.iP:0)*i.sU)),u="objective"===t?s:r,m="objective"===t?r:s,v=l.wP[t][u].rank,w=l.wP[t][u][e],b={id:e,levs:c,maxLev:i.sU,domLev:(0,h.Dq)(c),tilt:50*Math.random()-25,dur:100*Math.random()+400,x:f[w].x,y:f[w].y,group:u,key:m,globalX:p[v].x+f[w].x,globalY:p[v].y+f[w].y};g.push(b),y[u]||(y[u]=[]),y[u].push(b)}for(const n of e)v.push({x:p[l.wP[t][n].rank].x,y:p[l.wP[t][n].rank].y,tilt:50*Math.random()-25,key:n,height:m.height,nodes:y[n]});return{nodes:g,groups:v,height:c.height}}g.Uk.setSize(x,k),console.time("drops mesh creating"),g.Q7.createMesh(b),console.timeEnd("drops mesh creating"),r()}catch(w){r(w)}}))},96:(t,e,s)=>{s.d(e,{B:()=>r});const r=(0,s(43).createContext)({})},684:(t,e,s)=>{s.d(e,{YW:()=>a,kd:()=>o});var r=s(437);s(43);function o(t,e,s){return r.y17(s).map((r=>r/(s-1)*(e-t)+t))}const a=t=>r.dM(r.m4Y([.2,1])(t))},58:(t,e,s)=>{s.a(t,(async(t,r)=>{try{s.d(e,{ZS:()=>d,pk:()=>i,uV:()=>u,vR:()=>p,wP:()=>m});var o=s(437),a=s(550),n=s(956);const t=1,i=1200,c="scens",l="delivs",h=await async function(){const t=await(await fetch("./all_objectives.json")).json();for(const e of t){e[c]=e[c];for(const t of e[c]){const e=t[l].map((t=>(0,a.qE)(t,0,i)));t[l]=Array.from(e).sort(((t,e)=>e-t))}e[c]=(0,n.Et)(e[c],(t=>{let{name:e}=t;return e}))}return console.log("DATA: loading objectives data"),(0,n.Et)(t,(t=>{let{obj:e}=t;return e}))}(),d=Object.keys(h),u=Object.keys(Object.values(h)[0][c]).filter(((e,s)=>s%t===0)),[p,m]=function(){const t=[],e={objective:{},scenario:{}},s=[];let r=0;for(const n of d)for(const a of u){e.objective[n]||(e.objective[n]=[]),e.scenario[a]||(e.scenario[a]=[]),e.objective[n].push(r),e.scenario[a].push(r);const i=h[n][c][a][l];t.push({id:r,objective:n,scenario:a,deliveries:i}),s.push(o.i2o(i)),r++}const a={};for(const n of Object.keys(e)){const r=[];for(const a of Object.keys(e[n])){const i=e[n][a],c=i.sort(((t,e)=>s[e]-s[t]));r.push({key:a,sorted:c,mean:o.i2o(i.map((e=>t[e].deliveries)).flat())})}const i=r.sort(((t,e)=>e.mean-t.mean));a[n]={};for(let t=0;t<i.length;t++){const{key:e,sorted:s}=i[t],r={};for(let t=0;t<s.length;t++)r[s[t]]=t;a[n][e]=r,a[n][e].rank=t}}return[t,a]}();r()}catch(i){r(i)}}),1)},385:(t,e,s)=>{s.d(e,{B0:()=>c,Kn:()=>r,N7:()=>l,h4:()=>o,iP:()=>n,pC:()=>i,sU:()=>a});const r=5,o=5,a=1,n=.1,i=2,c=1.2,l=1.1/(1+Math.SQRT1_2)},68:(t,e,s)=>{s.d(e,{JH:()=>n,Q7:()=>i,UI:()=>l,Uk:()=>h,XA:()=>c,mK:()=>d});var r=s(408),o=s(437),a=s(972);const n=function(){const t=new r.Z58;return t.background=new r.Q1f(15724527),t}(),i=new a.e8,c=new a._9,l=new a.i7({fov:45,near:1,far:3e3}),h=new r.JeP({antialias:!0}),d=o.m4Y().domain([1,5]).range([.1,1]).clamp(!0)},152:(t,e,s)=>{s.a(t,(async(t,r)=>{try{s.d(e,{Dq:()=>h,Dy:()=>l});var o=s(437),a=s(684),n=s(58),i=t([n]);function l(t,e){return o.m4Y().domain((0,a.kd)(0,1,t.length)).range(t.map((t=>Math.min(1,t/e)))).clamp(!0)}function h(t){t=[1,...t,0];let e=0;for(let s=0;s<t.length-1;s++){e+=(t[s]-t[s+1])*(s-1)/(t.length+4)}return e}n=(i.then?(await i)():i)[0],r()}catch(c){r(c)}}))},550:(t,e,s)=>{s.d(e,{eh:()=>f,hh:()=>m,qE:()=>i});var r=s(437),o=s(783),a=s.n(o),n=s(972);function i(t,e,s){return Math.max(e,Math.min(s,t))}function c(t){const e=t/2,s=3*Math.PI/2/16,r=[{x:Math.cos(5*Math.PI/4)*e,y:Math.sin(5*Math.PI/4)*e},{x:0,y:-Math.SQRT2*e}];for(let o=0;o<=16;o++)r.push({x:Math.cos(o*s-Math.PI/4)*e,y:Math.sin(o*s-Math.PI/4)*e});return r}const l=function(){const t=c(3),e=c(1),s=[];for(let r=0;r<t.length-2;r++)s.push([t[r],t[r+(r<2?1:2)],e[r+(r<2?1:2)],e[r]]);return s}();let h,d,u,p;function m(t,e,s){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(o&&u&&s.length===p)return u;h&&s.length===d||(h=r.y17(4).map((()=>function(t,e){const s=a().Bounds.create(t),o=s.min.x,n=s.max.x,i=s.min.y,c=s.max.y,l=r.m4Y([o,n]),h=r.m4Y([i,c]),d=[];for(let r=0;r<e;r++)for(;;){const e=l(Math.random()),s=h(Math.random());if(a().Vertices.contains(t,{x:e,y:s})){d.push([e,s]);break}}return d}(c(1),d=s.length))));const i=function(t){const e=r.czq(t.map((t=>t**2*3.14)));return Math.floor(2*Math.sqrt(e/3.14)/2)}(s.map((t=>{let{r:e}=t;return e}))),m=h[Math.floor(Math.random()*h.length)].map((t=>{let[e,s]=t;return[e*i,s*i]})),f=a().Engine,g=a().Bodies,v=a().Composite,y=f.create(),w=m.sort(((t,e)=>e[1]-t[1])),b=s.map(((t,e)=>{let{r:s,id:r}=t;const[o,a]=w[e];return g.circle(o,a,s,{restitution:0,id:r})})),x=l.map((t=>a().Body.create({position:a().Vertices.centre(t),vertices:t,isStatic:!0}))),k=a().Body.create({isStatic:!0});a().Body.setParts(k,x),a().Body.setCentre(k,{x:0,y:0}),a().Body.scale(k,i,i),v.add(y.world,[...b,k]);for(let r=0,a=60,n=.1;r<a*n;r++)f.update(y,1e3/a);const M=b.map((s=>{let{position:r,id:o}=s;return{id:o,x:r.x+t,y:r.y+e}}));return M.height=i/2/n.Sz*n.IC,!o||u&&M.length===p||(u=M,p=M.length),M}function f(t){return t*Math.PI/180}},956:(t,e,s)=>{s.d(e,{Et:()=>o,Ul:()=>a,ad:()=>i,iJ:()=>n});var r=s(43);function o(t,e){const s=Object.groupBy(t,e);for(const r of Object.keys(s))s[r]=s[r][0];return s}function a(t,e){return e=function(t){return"string"===typeof t?e=>function(t,e,s){var r;const o=e.split(".");for(let a of o){if(!t)return s;t=t[a]}return null!==(r=t)&&void 0!==r?r:s}(e,t):t}(e),t.sort(((t,s)=>{const r=e(t),o=e(s);return r<o?-1:r>o?1:0}))}function n(t){const[e,s]=(0,r.useState)(t),o=(0,r.useRef)(t);(0,r.useEffect)((()=>{o.current=e}),[e]);const a=(0,r.useCallback)((t=>{s("function"===typeof t?e=>o.current=t(e):o.current=t)}),[]);return[e,a,o]}function i(t,e){return t&&t.state===e}},972:(t,e,s)=>{s.d(e,{IC:()=>p,Sz:()=>h,_9:()=>x,e8:()=>b,i7:()=>k,js:()=>l});var r=s(437),o=s(408),a=s(684),n=s(385),i=s(956),c=s(550);const l="M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z",h=Math.SQRT1_2,d=1,u=h+h,p=d+h,m=.75;function f(t){if(t>=m){return Math.SQRT1_2*(1-t)/(1-m)}const e=2*(1-t/(u/p))-1,s=Math.acos(e);return Math.sin(s)}function g(t){return(t-h/p)*(1+Math.SQRT2)}function v(t){return t/(1+Math.SQRT2)+h/p}function y(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(Math.abs(t-e)<.01)return[];const r=s/2/d*h,o=.1,a=[];let n,i,c,l;for(let h=1;h<=Math.ceil(10)&&(n=f(t+(h-1)*o),i=g(t+(h-1)*o),c=f(t+h*o),l=g(t+h*o),!(v(l)>=e));h++){const t=[-n*r,-i*r],e=[n*r,-i*r],s=[c*r,-l*r],o=[-c*r,-l*r];a.push([t,e,s]),a.push([t,s,o])}c=f(e),l=g(e);const u=[-n*r,-i*r],p=[n*r,-i*r],m=[c*r,-l*r],y=[-c*r,-l*r];return a.push([u,p,m]),a.push([u,m,y]),a}class w{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.threeGeom=new o.LoY,this.triangleIdx=0,this.threeGeom.setAttribute("position",new o.THS(new Float32Array(3*t),3)),e&&this.threeGeom.setAttribute("color",new o.THS(new Float32Array(3*t),3)),this.positionAttribute=this.threeGeom.getAttribute("position"),this.colorAttribute=this.threeGeom.getAttribute("color")}addMeshCoords(t,e,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(let o=0;o<t.length;o++){const[a,n,i]=t[o];this.positionAttribute.setXYZ(3*this.triangleIdx+0,e.x+a[0],e.y-a[1],r),this.positionAttribute.setXYZ(3*this.triangleIdx+1,e.x+n[0],e.y-n[1],r),this.positionAttribute.setXYZ(3*this.triangleIdx+2,e.x+i[0],e.y-i[1],r),s&&(this.colorAttribute.setXYZ(3*this.triangleIdx+0,s.r,s.g,s.b),this.colorAttribute.setXYZ(3*this.triangleIdx+1,s.r,s.g,s.b),this.colorAttribute.setXYZ(3*this.triangleIdx+2,s.r,s.g,s.b)),this.triangleIdx++}}finish(){this.threeGeom.setDrawRange(0,3*this.triangleIdx)}}class b{constructor(){this.added=!1}createMesh(t){this.dropsMesh?this.updateMeshes(t):this.initializeMeshes(t)}draw(t){this.added||(t.add(this.dropsMesh),t.add(this.outlineMesh),this.added=!0)}remove(t){this.added&&(t.remove(this.dropsMesh),t.remove(this.outlineMesh),this.added=!1)}initializeMeshes(t){const e=new w(b.MAX_POINTS_DROPS),s=[],r=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(Math.abs(t-e)<.01)return[];const r=s/2/d*h,o=.1,a=[],n=[];let i,c,l,u;for(let h=1;h<=Math.ceil(10)&&(i=f(t+(h-1)*o),c=g(t+(h-1)*o),l=f(t+h*o),u=g(t+h*o),!(v(u)>=e));h++){const t=[-i*r,-c*r],e=[i*r,-c*r],s=[l*r,-u*r],o=[-l*r,-u*r];a.push(e,s),n.push(t,o)}l=f(e),u=g(e);const p=[-i*r,-c*r],m=[i*r,-c*r],y=[l*r,-u*r],w=[-l*r,-u*r];return a.push(m,y),n.push(p,w),a.push(...n.reverse()),a}(0,1,2*n.sU*.975);for(let i=0;i<t.nodes.length;i++){const{id:c,globalX:l,globalY:h,levs:d,maxLev:u}=t.nodes[i];for(let t=d.length-1;t>=0;t--){const s=y((t!==d.length-1?d[t+1]:0)/u,d[t]/u,2*n.sU),r=new o.Q1f((0,a.YW)(t/n.h4));e.addMeshCoords(s,{x:l,y:-h},r,i%5/50+.02)}s.push(...r.map((t=>{let[e,s]=t;return new o.Pq0(l+e,-h-s,i%5/50+.01)})))}e.finish(),this.dropsMesh=new o.eaF(e.threeGeom,new o.V9B({vertexColors:!0,transparent:!0,opacity:1})),this.outlineMesh=new o.DXC((new o.LoY).setFromPoints(s),new o.mrM({color:13421772,transparent:!0,opacity:0}))}updateOutlineVisibility(t){this.outlineMesh&&(this.outlineMesh.material.opacity=t,this.outlineMesh.material.needsUpdate=!0)}updateVisibility(t){this.outlineMesh&&this.dropsMesh&&(this.outlineMesh.material.opacity=t,this.outlineMesh.material.needsUpdate=!0,this.dropsMesh.material.opacity=t,this.dropsMesh.material.needsUpdate=!0)}updateMeshes(t){}}b.MAX_POINTS_DROPS=78e5,b.MAX_POINTS_OUTLINE=52e5;class x{constructor(){this.added=!1,this.vertToId={},this.idToVert={}}draw(t){this.added||(t.add(this.mesh),this.added=!0)}remove(t){this.added&&(t.remove(this.mesh),this.added=!1)}createMesh(t){return this.mesh||this.initializeMesh(t),this.updateMesh(t),this.mesh}initializeMesh(t){const e=new o.LoY,s=[],r=[];for(let n=0;n<t.nodes.length;n++){const{id:e,globalX:i,globalY:c,levs:l,domLev:h}=t.nodes[n],d=h>0?(0,a.YW)(h):"white";s.push(i,-c,0);const u=new o.Q1f(d);r.push(u.r,u.g,u.b),this.vertToId[n]=e,this.idToVert[e]=n}const i=new o.BH$({size:2*n.sU,sizeAttenuation:!0,vertexColors:!0,map:(new o.Tap).load("drop.png"),transparent:!0});e.setAttribute("position",new o.THS(new Float32Array(s),3)),e.setAttribute("color",new o.THS(new Float32Array(r),3)),this.mesh=new o.ONl(e,i)}updateMesh(t){const e=this.mesh.geometry.getAttribute("position");for(let s=0;s<t.nodes.length;s++){const{id:r,globalX:o,globalY:a}=t.nodes[s],n=this.idToVert[r];e.setXY(n,o,-a)}e.needsUpdate=!0}updatePoints(t,e,s){const r=this.mesh.geometry.vertices;for(let o=0;o<t.nodes.length;o++){const{id:a}=t.nodes[o],n=this.idToVert[a],[i,c]=e[a],l=r[n].x,h=r[n].y;r[n].setX(l+s*i),r[n].setY(h-s*c)}this.mesh.geometry.verticesNeedUpdate=!0}intersectObject(t,e,s){const r=t.intersectObject(e,s,this.mesh);if(r[0]){const t=(0,i.Ul)(r,"distanceToRay")[0];return this.vertToId[t.index]}return null}}class k{constructor(t){let{fov:e,near:s,far:r}=t;this.raycaster=new o.tBo,this.fov=e,this.near=s,this.far=r}setZoomFn(t){this.zoom=r.s_O().on("zoom",(e=>{this.curTransform=e.transform,this._THREEZoomHandler(e.transform),r.Ltv(this._svgElement).attr("transform",e.transform),t&&t(e.transform)}))}callZoom(t){this.zoom.transform(this.view,r.GSI.translate(t.x,t.y).scale(t.k))}callZoomFromWorldViewport(t){let{worldX:e,worldY:s,farHeight:r}=t;const o=this.height/r,a=-e*o+this.width/2,n=s*o+this.height/2;this.callZoom({x:a,y:n,k:o})}getZFromFarHeight(t){return Math.tan((0,c.eh)(90-this.fov/2))*t/2}getFarHeightFromZ(t){return Math.tan((0,c.eh)(this.fov)/2)*t*2}interpolateZoomCamera(t){let[e,s,o]=t;const a=r.p7([this.camera.position.x,this.camera.position.y,this.height/this.curTransform.k],[e,-s,this.getFarHeightFromZ(o)]),n=t=>{const[e,s,r]=a(t),o=this.height/r;return{x:-e*o+this.width/2,y:s*o+this.height/2,k:o}};return n.duration=a.duration,n}mount(t,e){this.view=r.Ltv(t),this._svgElement=e}setSize(t,e){this.width=t,this.height=e,this.zoom=this.zoom.scaleExtent([this.getScaleFromZ(this.far),this.getScaleFromZ(this.near)]),this.camera=new o.ubm(this.fov,t/e,this.near,this.far+1),this.camera.position.set(0,0,this.far),this.view.call(this.zoom),this.zoom.transform(this.view,r.GSI.translate(this.width/2,this.height/2).scale(this.getScaleFromZ(this.far)))}_THREEZoomHandler(t){const e=t.k,s=-(t.x-this.width/2)/e,r=(t.y-this.height/2)/e,o=this.getZFromScale(e);this.camera.position.set(s,r,o)}getScaleFromZ(t){const e=this.fov/2,s=(0,c.eh)(e),r=2*(Math.tan(s)*t);return this.height/r}getZFromScale(t){const e=this.fov/2,s=(0,c.eh)(e);return this.height/t/(2*Math.tan(s))}intersectObject(t,e,s){return this.raycaster.setFromCamera({x:t,y:e},this.camera),this.raycaster.intersectObject(s)}}},293:(t,e,s)=>{s.d(e,{A:()=>h});var r=s(96),o=s(684),a=s(437),n=s(43),i=s(385),c=s(956),l=s(972);function h(){const{state:t,setState:e,setGoBack:s,camera:h,resetCamera:d,activeWaterdrops:u,waterdrops:p}=(0,n.useContext)(r.B),[m,f]=(0,n.useState)(),g=(0,n.useRef)();(0,n.useEffect)((()=>{if(m){const t=[];for(let r=0;r<g.current.groups.length;r++){const e=g.current.groups[r],s=g.current.groupPositions[r],o=e.nodes.find((t=>t.key===m));t.push([1.5*o.x+s[0],1.5*o.y+s[1]])}const e=[],s=2*i.sU;for(let r=0;r<t.length;r++){const o=Array.from(t[r]),a=Array.from(t[r+1==t.length?0:r+1]),n=Math.sqrt((o[0]-a[0])**2+(o[1]-a[1])**2),i=[(a[0]-o[0])/n,(a[1]-o[1])/n];o[0]+=i[0]*s,o[1]+=i[1]*s,a[0]-=i[0]*s,a[1]-=i[1]*s,e.push([o,a])}a.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compCirclet").data(t).join("circle").attr("class","compCirclet").attr("display","initial").style("pointer-events","none").attr("fill","transparent").attr("stroke","orange").attr("stroke-dasharray",3).attr("stroke-width",3).attr("vector-effect","non-scaling-stroke").attr("r",s/2*1.2).transition().duration(100).attr("cx",(t=>t[0])).attr("cy",(t=>t[1]-.08*s)),a.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compLines").data(e).join("path").attr("class","compLines").attr("stroke","orange").attr("stroke-dasharray",3).attr("opacity",.5).attr("stroke-width",1).attr("vector-effect","non-scaling-stroke").transition().duration(100).attr("d",(t=>a.n8j()(t)))}}),[m]),(0,n.useEffect)((function(){if((0,c.ad)(t,"CompareView")){return function(t,e,s,r){let{onClick:n,onHover:c,onUnhover:h}=r;t.selectAll(".compLargeDrop").data(e.groups).join((t=>t.append("g").attr("class","compLargeDrop").each((function(t){let{nodes:e}=t;a.Ltv(this).selectAll(".compSmallDrop").data(e).enter().append("g").attr("class","compSmallDrop").each((function(t){let{levs:e}=t;const s=a.Ltv(this);s.append("rect").attr("class","bbox").style("visibility","hidden");const r=Math.floor(1e9*Math.random()),n=a.Ltv(this).append("defs").append("linearGradient").attr("id","".concat(r)).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");n.append("stop").attr("stop-color","transparent"),n.append("stop").attr("stop-color","transparent"),e.forEach(((t,e)=>{n.append("stop").attr("stop-color",(0,o.YW)(e/i.Kn)),n.append("stop").attr("stop-color",(0,o.YW)(e/i.Kn))})),s.append("path").attr("d",l.js).attr("class","outline").attr("fill","none").attr("stroke","lightgray").attr("stroke-width",.05),s.append("path").attr("class","fill").attr("d",l.js).attr("fill","url(#".concat(r,")"))}))})))).attr("display","initial").attr("transform",((t,e)=>{let{x:s,y:r}=t;return"translate(".concat(s,", ").concat(r,")")})).each((function(t){let{nodes:e}=t;a.Ltv(this).selectAll(".compSmallDrop").data(e).attr("display","initial").attr("transform",(t=>{let{tilt:e,x:s,y:r}=t;return"translate(".concat(s,", ").concat(r,") rotate(",0,")")})).on("click",(function(t,e){n&&n(e)})).on("mouseenter",(function(t,e){c&&c(e)})).on("mouseleave",(function(t,e){h&&h(e)})).each((function(t,e){let{levs:s,maxLev:r,key:o}=t;const n=a.Ltv(this);n.select(".outline").attr("transform","scale(".concat(.95*i.sU,")")),n.select(".fill").attr("transform","scale(".concat(i.sU,")")),n.selectAll("stop").each((function(t,e){let o=Math.floor(e/2);0===e%2&&(o-=1),-1===o?a.Ltv(this).attr("offset","".concat(0,"%")):o===s.length?a.Ltv(this).attr("offset","100%"):a.Ltv(this).attr("offset","".concat(100*(1-s[o]/r),"%"))}));const c=n.select(".fill");n.select(".bbox").attr("x",c.node().getBBox().x).attr("y",c.node().getBBox().y).attr("width",c.node().getBBox().width).attr("height",c.node().getBBox().height)})).transition().delay(s).duration(1e3).attr("transform",(t=>{let{tilt:e,x:s,y:r}=t;return"translate(".concat(1.5*s,", ").concat(1.5*r,") rotate(",0,")")}))})).transition().delay(s).duration(1e3).attr("transform",((t,s)=>"translate(".concat(e.groupPositions[s][0],", ").concat(e.groupPositions[s][1],")")))}(a.Ltv("#mosaic-svg").select(".svg-trans"),g.current=function(t,e,s){const r=e.groups.filter((e=>t.includes(e.key))),o=[],a=r[0].height;for(let n=0,i=r.length;n<i;n++)o.push([s[0]+Math.cos(2*Math.PI/i*n)*a,s[1]+Math.sin(2*Math.PI/i*n)*a]);return{groups:r,groupPositions:o}}(u,p,t.avgCoord),t.transitionDuration/5,{onHover:t=>{f(t.key)}}),s((()=>()=>{e({state:"WideView"}),d()})),()=>{a.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compLargeDrop").remove(),a.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compCirclet").remove(),a.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compLines").remove(),s(null)}}}),[t])}},621:(t,e,s)=>{s.a(t,(async(t,r)=>{try{s.d(e,{A:()=>f});var o=s(437),a=s(43),n=s(96),i=s(956),c=s(385),l=s(684),h=s(972),d=s(58),u=s(579),p=t([d]);function f(){const{state:t,setState:e,setGoBack:s,camera:r,resetCamera:c,activeWaterdrops:l,waterdrops:h}=(0,a.useContext)(n.B);return(0,a.useEffect)((function(){}),[]),(0,a.useEffect)((function(){if((0,i.ad)(t,"ExamineView")){const r=t.transitionDuration;return v(o.Ltv("#mosaic-svg").select(".svg-trans"),g(h.groups.find((t=>t.key===l[0])).nodes.map((t=>t.id)),h.nodes),r/2,{}),s((()=>()=>{e({state:"WideView"}),c()})),()=>{o.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".smallDrop").attr("display","none"),s(null)}}}),[t]),(0,u.jsx)(u.Fragment,{})}function g(t,e){const s=[];for(const r of t){const{id:t,deliveries:o}=d.vR[r];s.push({...e[t]})}return s}function v(t,e,s,r){let{onClick:a,onHover:n,onUnhover:i}=r;t.selectAll(".smallDrop").data(e).join((t=>t.append("g").attr("class","smallDrop").each((function(t,e){let{levs:s}=t;const r=o.Ltv(this);r.append("rect").attr("class","bbox").style("visibility","hidden");const a=o.Ltv(this).append("defs").append("linearGradient").attr("id","drop-fill-".concat(e)).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");a.append("stop").attr("stop-color","transparent"),a.append("stop").attr("stop-color","transparent"),s.forEach(((t,e)=>{a.append("stop").attr("stop-color",(0,l.YW)(e/c.Kn)),a.append("stop").attr("stop-color",(0,l.YW)(e/c.Kn))})),r.append("path").attr("d",h.js).attr("class","outline").attr("fill","none").attr("stroke","lightgray").attr("stroke-width",.05),r.append("path").attr("class","fill").attr("d",h.js).attr("fill","url(#drop-fill-".concat(e,")")),r.append("g").attr("class","circlet").append("circle").attr("fill","transparent").attr("stroke","transparent").attr("stroke-dasharray",3).attr("stroke-width",3).attr("vector-effect","non-scaling-stroke").attr("r",1.5)})))).attr("display","initial").attr("transform",(t=>{let{globalX:e,globalY:s,tilt:r,x:o,y:a}=t;return"translate(".concat(e,", ").concat(s,") rotate(",0,")")})).each((function(t,e){let{levs:s,maxLev:r,key:a}=t;const n=o.Ltv(this);n.select(".outline").attr("transform","scale(".concat(.95*c.sU,")")),n.select(".fill").attr("transform","scale(".concat(c.sU,")")),n.select(".circlet").attr("class",null).attr("class","circlet "+a),n.selectAll("stop").each((function(t,e){let a=Math.floor(e/2);0===e%2&&(a-=1),-1===a?o.Ltv(this).attr("offset","".concat(0,"%")):a===s.length?o.Ltv(this).attr("offset","100%"):o.Ltv(this).attr("offset","".concat(100*(1-s[a]/r),"%"))}));const i=n.select(".fill");n.select(".bbox").attr("x",i.node().getBBox().x).attr("y",i.node().getBBox().y).attr("width",i.node().getBBox().width).attr("height",i.node().getBBox().height)})).on("click",(function(t,e){a&&a(e)})).on("mouseenter",(function(t,e){o.Ltv(this).select(".circlet").classed("active")||o.Ltv(this).select("circle").attr("stroke","orange"),n&&n(e)})).on("mouseleave",(function(t,e){o.Ltv(this).select(".circlet").classed("active")||o.Ltv(this).select("circle").attr("stroke","transparent"),i&&i(e)})).transition().delay(s).duration(1e3).attr("transform",(t=>{let{globalX:e,globalY:s,tilt:r,x:o,y:a}=t;return"translate(".concat(e+.5*o,", ").concat(s+.5*a,") rotate(",0,")")}))}d=(p.then?(await p)():p)[0],r()}catch(m){r(m)}}))},313:(t,e,s)=>{s.d(e,{A:()=>h});var r=s(437),o=s(43),a=s(96),n=s(385),i=s(68),c=s(956),l=s(579);function h(){const{waterdrops:t,state:e,setState:s,camera:h,zoomTo:d,setActiveWaterdrops:u,activeWaterdrops:p,setDisableCamAdjustments:m}=(0,o.useContext)(a.B),[f,g]=(0,o.useState)([]);(0,o.useEffect)((function(){if((0,c.ad)(e,"WideView")){const{transitionDuration:s=2e3}=e;console.time("drawing"),i.Q7.draw(i.JH),console.timeEnd("drawing");const o=(0,i.mK)(h.curTransform.k);i.Q7.updateVisibility(1),i.Q7.updateOutlineVisibility(o);const a=r.O1W((t=>{Math.min(1,t/(s/2))>=1&&a.stop()})),c=r.Ltv("#mosaic-svg").select(".svg-trans");!function(t,e,s){let{onClick:o,onHover:a,onUnhover:i}=s;console.log("updating svg"),t.selectAll(".largeDrop").data(e.groups).join((t=>t.append("g").attr("class","largeDrop").each((function(t){r.Ltv(this).append("g").attr("class","circlet").append("circle").attr("fill","transparent").attr("stroke","transparent").attr("stroke-dasharray",3).attr("stroke-width",3).attr("vector-effect","non-scaling-stroke").attr("r",1)})))).each((function(t){r.Ltv(this).select(".circlet").attr("class",null).attr("class","circlet "+t.key)})).attr("display","initial").attr("transform",(t=>{let{x:e,y:s,height:r}=t;return"translate(".concat(e,", ").concat(s-.08*r,") scale(").concat(r*n.N7,")")})).on("click",(function(t,e){o&&o(e)})).on("mouseenter",(function(t,e){r.Ltv(this).select(".circlet").classed("active")||r.Ltv(this).select("circle").attr("stroke","orange"),a&&a(e)})).on("mouseleave",(function(t,e){r.Ltv(this).select(".circlet").classed("active")||r.Ltv(this).select("circle").attr("stroke","transparent"),i&&i(e)}))}(c,t,{onClick:t=>{g((e=>{const s=e.findIndex((e=>e.key===t.key));return-1!==s?e.splice(s,1):e.push(t),[...e]})),u((e=>(e.includes(t.key)?(e.splice(e.indexOf(t.key),1),c.select(".circlet."+t.key).classed("active",!1)):(e.push(t.key),c.select(".circlet."+t.key).classed("active",!0)),[...e])))}});for(const t of f)c.select(".circlet."+t.key).classed("active",!0);return()=>{r.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".largeDrop").attr("display","none")}}}),[e]);const v=(0,o.useCallback)((()=>{if(1==f.length){const t=f[0],{start:e,duration:o}=d([t.x,t.y-.08*t.height,h.getZFromFarHeight(2*t.height)],(()=>{m(!1)}));e(),s({state:"ExamineView",transitionDuration:o});const a=(0,i.mK)(h.curTransform.k);m(!0);const n=r.O1W((t=>{const e=Math.min(1,t/(o/2));i.Q7.updateVisibility(1-e),i.Q7.updateOutlineVisibility(a*(1-e)),e>=1&&(n.stop(),i.Q7.remove(i.JH))}))}else if(f.length>1){const e=f.map((t=>[t.x,t.y])),o=[r.i2o(e,(t=>t[0])),r.i2o(e,(t=>t[1]))],{start:a,duration:n}=d([o[0],o[1],h.getZFromFarHeight(2*t.groups[0].height*2)],(()=>{m(!1)}));a(),s({state:"CompareView",transitionDuration:n,avgCoord:o});const c=(0,i.mK)(h.curTransform.k);m(!0);const l=r.O1W((t=>{const e=Math.min(1,t/(n/5));i.Q7.updateVisibility(1-e),i.Q7.updateOutlineVisibility(c*(1-e)),e>=1&&(l.stop(),i.Q7.remove(i.JH))}))}}),[f]);if((0,c.ad)(e,"WideView")&&p.length)return(0,l.jsx)("button",{onClick:v,className:"wide-view-action-btn",children:1==p.length?"examine >>":"compare >>"})}}}]);
//# sourceMappingURL=805.1b35a623.chunk.js.map