{"version":3,"file":"static/js/805.866dc83d.chunk.js","mappings":"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","sources":["App.jsx","AppContext.jsx","bucket-lib/BucketGlyph.jsx","bucket-lib/quantile-histogram.js","bucket-lib/utils.js","components/DotHistogram.jsx","components/WaterdropGlyph.jsx","data/descriptions-data.jsx","data/objectives-data.jsx","data/spatial-data.jsx","settings.jsx","three-resources.jsx","utils/app-utils.jsx","utils/compareview-utils.jsx","utils/data-utils.jsx","utils/examineview-utils.jsx","utils/math-utils.jsx","utils/misc-utils.jsx","utils/render-utils.jsx","utils/tutorialview-utils.jsx","utils/wideview-utils.jsx","views/CompareView.jsx","views/ExamineView.jsx","views/TutorialView.jsx","views/WideView.jsx"],"sourcesContent":["import * as d3 from \"d3\";\r\n\r\nimport React, { useCallback, useEffect, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { useStateRef } from \"utils/misc-utils\";\r\nimport { initWaterdrops } from \"utils/app-utils\";\r\n\r\nimport WideView from \"views/WideView\";\r\nimport ExamineView from \"views/ExamineView\";\r\nimport TutorialView from \"views/TutorialView\";\r\nimport CompareView from \"views/CompareView\";\r\n\r\nimport {\r\n  scene,\r\n  camera,\r\n  renderer,\r\n  dropsMesh,\r\n  pointsMesh,\r\n} from \"three-resources\";\r\nimport { OBJECTIVE_IDS } from \"data/objectives-data\";\r\n\r\n// pre-calculate these so we don't lag later\r\nconst waterdrops = initWaterdrops(\"objective\");\r\n\r\nconst appWidth = window.innerWidth,\r\n  appHeight = window.innerHeight;\r\n\r\nrenderer.setSize(appWidth, appHeight);\r\n\r\nconsole.time(\"drops mesh creating\");\r\ndropsMesh.createMesh(waterdrops);\r\nconsole.timeEnd(\"drops mesh creating\");\r\n\r\n// pointsMesh.createMesh(waterdrops);\r\n\r\nexport default function App() {\r\n  const [state, setState, stateRef] = useStateRef({});\r\n  const [zoomCallbacks, setZoomCallbacks, zoomCallbacksRef] = useStateRef([]);\r\n  const [activeWaterdrops, setActiveWaterdrops] = useState([]);\r\n  const [goBack, setGoBack] = useState(null);\r\n  const [\r\n    disableCamAdjustments,\r\n    setDisableCamAdjustments,\r\n    disableCamAdjustmentsRef,\r\n  ] = useStateRef(false);\r\n  const [goals, setGoals] = useState(() => {\r\n    const goalMap = {};\r\n    for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n      goalMap[OBJECTIVE_IDS[i]] = 200;\r\n    return goalMap;\r\n  });\r\n\r\n  const getOutlineOpacity = useCallback(\r\n    d3\r\n      .scaleLinear()\r\n      .domain([\r\n        appHeight / waterdrops.height,\r\n        appHeight / waterdrops.groups[0].height,\r\n      ])\r\n      .range([0.1, 1])\r\n      .clamp(true),\r\n    []\r\n  );\r\n\r\n  useEffect(function initialize() {\r\n    document.querySelector(\"#mosaic-webgl\").appendChild(renderer.domElement);\r\n\r\n    d3.select(\"#mosaic-svg\").attr(\"width\", appWidth).attr(\"height\", appHeight);\r\n\r\n    camera.mount(\r\n      d3.select(\".bubbles-wrapper\").node(),\r\n      d3.select(\"#mosaic-svg\").select(\".svg-trans\").node()\r\n    );\r\n    camera.setZoomFn((transform) => {\r\n      if (!disableCamAdjustmentsRef.current) {\r\n        dropsMesh.updateOutlineVisibility(getOutlineOpacity(transform.k));\r\n      }\r\n\r\n      for (const cb of zoomCallbacksRef.current) cb(transform);\r\n    });\r\n    camera.setSize(appWidth, appHeight);\r\n\r\n    renderer.setAnimationLoop(() => {\r\n      renderer.render(scene, camera.camera);\r\n    });\r\n\r\n    resetCamera(false);\r\n    setState({ state: \"TutorialView\" });\r\n  }, []);\r\n\r\n  const resetCamera = useCallback(function (animated = true, callback) {\r\n    const pos = [\r\n      0,\r\n      -waterdrops.height * 0.08,\r\n      camera.getZFromFarHeight(waterdrops.height),\r\n    ];\r\n    if (animated) {\r\n      const [start] = zoomTo(pos, callback);\r\n      start();\r\n    } else {\r\n      camera.callZoomFromWorldViewport({\r\n        worldX: pos[0],\r\n        worldY: -pos[1],\r\n        farHeight: waterdrops.height,\r\n      });\r\n      callback && callback();\r\n    }\r\n  }, []);\r\n\r\n  const zoomTo = useCallback(function (xyz, callback) {\r\n    const i = camera.interpolateZoomCamera(xyz);\r\n\r\n    const duration = i.duration / 2;\r\n\r\n    const start = () => {\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(elapsed / duration, 1);\r\n        camera.callZoom(i(et));\r\n\r\n        if (et === 1) {\r\n          t.stop();\r\n          callback && callback();\r\n        }\r\n      });\r\n    };\r\n\r\n    return [start, duration];\r\n  }, []);\r\n\r\n  const addZoomHandler = useCallback(function (cb) {\r\n    setZoomCallbacks((cbs) => [...cbs, cb]);\r\n  }, []);\r\n\r\n  return (\r\n    <AppContext.Provider\r\n      value={{\r\n        appWidth,\r\n        appHeight,\r\n        state,\r\n        setState,\r\n        activeWaterdrops,\r\n        setActiveWaterdrops,\r\n        setDisableCamAdjustments,\r\n        waterdrops,\r\n        scene,\r\n        camera,\r\n        renderer,\r\n        pointsMesh,\r\n        dropsMesh,\r\n        setGoBack,\r\n        zoomTo,\r\n        resetCamera,\r\n        getOutlineOpacity,\r\n        addZoomHandler,\r\n        goals,\r\n        setGoals,\r\n      }}\r\n    >\r\n      <div className=\"bubbles-wrapper\">\r\n        <div id=\"mosaic-webgl\"></div>\r\n        <svg id=\"mosaic-svg\">\r\n          <g className=\"svg-trans\"></g>\r\n        </svg>\r\n      </div>\r\n      <TutorialView />\r\n      <WideView />\r\n      <ExamineView />\r\n      <CompareView />\r\n      {goBack && (\r\n        <button className=\"go-back-btn\" onClick={goBack}>\r\n          \r\n        </button>\r\n      )}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n","import { createContext } from \"react\";\r\n\r\nexport const AppContext = createContext({});\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  bucketPath,\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"./utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nexport default function BucketGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () =>\r\n      ticksExact(0, 1 - 1 / resolution, resolution).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    svgContainer\r\n      .select(\".bucket-mask-path\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight));\r\n\r\n    svgContainer\r\n      .select(\".bucket-outline\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight).split(\"z\")[0]);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / (resolution - 1)));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"bucket-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { quantileBins, ticksExact } from \"./utils\";\r\n\r\nexport function getQuantileBins(data, domain, unitsPerQuantile, width, height) {\r\n  const numQuantiles = data.length / unitsPerQuantile;\r\n  let histBins = d3\r\n    .histogram()\r\n    .value((d) => d)\r\n    .domain(domain)\r\n    .thresholds(\r\n      ticksExact(...domain, Math.ceil(width / (height / numQuantiles)))\r\n    )(data);\r\n\r\n  let binnedQuantiles = quantileBins(histBins, unitsPerQuantile, numQuantiles);\r\n\r\n  let quantiles = [];\r\n\r\n  for (let b = 0; b < binnedQuantiles.length; b++) {\r\n    for (let y = 0; y < binnedQuantiles[b]; y++) {\r\n      quantiles.push([\r\n        (histBins[b].x1 + histBins[b].x0) / 2,\r\n        ((y + 0.5) / numQuantiles) * data.length,\r\n      ]);\r\n    }\r\n  }\r\n\r\n  return quantiles;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\n// inclusive\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n\r\nexport const interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useMemo, useRef } from \"react\";\r\nimport { getQuantileBins } from \"bucket-lib/quantile-histogram\";\r\n\r\nimport { MAX_DELIVS } from \"data/objectives-data\";\r\n\r\nconst NUM_CIRCLES = 20;\r\nconst MARGIN = { top: 10, right: 10, bottom: 20, left: 10 };\r\nconst DOMAIN = [0, MAX_DELIVS];\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport default function DotHistogram({\r\n  data,\r\n  goal,\r\n  setGoal,\r\n  width = 600,\r\n  height = 400,\r\n  shortForm = false,\r\n}) {\r\n  const { current: razorID } = useRef(Math.floor(Math.random() * 1e9));\r\n  const { current: razorAreaID } = useRef(Math.floor(Math.random() * 1e9));\r\n\r\n  const svgSelector = useRef();\r\n  const circles = useMemo(\r\n    () =>\r\n      getQuantileBins(data, DOMAIN, data.length / NUM_CIRCLES, width, height),\r\n    [data]\r\n  );\r\n\r\n  const dataRange = [0, data.length];\r\n  const x = d3.scaleLinear().domain(DOMAIN).range([0, width]);\r\n  const y = d3.scaleLinear().domain(dataRange).range([height, 0]);\r\n  const count = circles.filter((d) => d[0] > goal).length;\r\n\r\n  useEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width + MARGIN.left + MARGIN.right)\r\n      .attr(\"height\", height + MARGIN.top + MARGIN.bottom)\r\n      .style(\"pointer-events\", \"none\")\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${MARGIN.left},${MARGIN.top})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(\r\n        d3\r\n          .axisBottom()\r\n          .scale(d3.scaleLinear().domain(DOMAIN).range([0, width]))\r\n          .tickFormat(d3.format(\".2s\"))\r\n      )\r\n      .call((s) => {\r\n        s.selectAll(\"line\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"path\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"text\").attr(\"fill\", \"gray\");\r\n      })\r\n      .append(\"text\")\r\n      .attr(\"fill\", \"black\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${30})`)\r\n      .text(\"Delivery (TAF)\");\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n\r\n    const ignoreFn = (e) => e.preventDefault();\r\n    let dragging = false;\r\n\r\n    document.querySelector(`#i${razorID}`).addEventListener(\"mousedown\", () => {\r\n      dragging = true;\r\n      window.addEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", () => {\r\n      dragging = false;\r\n      window.removeEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document\r\n      .querySelector(`#i${razorAreaID}`)\r\n      .addEventListener(\"mousemove\", (e) => {\r\n        if (dragging && e.target.id === `i${razorAreaID}`) {\r\n          razor.style.transform = `translateX(${Math.min(\r\n            Math.max(e.offsetX, MARGIN.left),\r\n            MARGIN.left + width\r\n          )}px)\r\n            `;\r\n\r\n          setGoal(\r\n            d3\r\n              .scaleLinear()\r\n              .domain([MARGIN.left, width + MARGIN.left])\r\n              .range(DOMAIN)\r\n              .clamp(true)(e.offsetX)\r\n          );\r\n        }\r\n      });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const svgCircles = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".icons\")\r\n      .data(circles)\r\n      .join((enter) => enter.append(\"g\").call((s) => s.append(\"path\")))\r\n      .attr(\"class\", \"icons\")\r\n      .call((s) => {\r\n        s.selectAll(\"path\").attr(\r\n          \"d\",\r\n          d3.symbol(WATERDROP_ICON, height / NUM_CIRCLES)\r\n        );\r\n      });\r\n\r\n    svgCircles.attr(\"transform\", (d) => `translate(${x(d[0])},${y(d[1])})`);\r\n\r\n    svgCircles.attr(\"fill\", (d) => (d[0] > goal ? \"steelblue\" : \"black\"));\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n  }, [goal, circles]);\r\n\r\n  return (\r\n    <div\r\n      className={`dot-${razorAreaID} dot-histogram-wrapper`}\r\n      id={`i${razorAreaID}`}\r\n    >\r\n      <div\r\n        className={`pdf-razor ` + (shortForm ? \"short-form\" : \"\")}\r\n        id={`i${razorID}`}\r\n      >\r\n        <div>\r\n          <span>\r\n            <u>\r\n              {circles.length - count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL NOT meet demand\"}\r\n          </span>\r\n          <span>\r\n            <u>\r\n              {count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL meet demand\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"bucket-lib/utils\";\r\nimport {\r\n  CIRC_RAD,\r\n  DROP_HEIGHT,\r\n  DROP_RAD,\r\n  waterdropDeltaOutline,\r\n} from \"utils/render-utils\";\r\nimport { dropRadToDropHeight } from \"utils/math-utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nfunction dropPath(height, [x, y]) {\r\n  const points = waterdropDeltaOutline(0, 1, height, 20);\r\n\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d[0] + x;\r\n    })\r\n    .y(function (d) {\r\n      return d[1] + y;\r\n    });\r\n  return lineFunc(points) + \"z\";\r\n}\r\n\r\nexport default function WaterdropGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () =>\r\n      ticksExact(0, 1 - 1 / resolution, resolution).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    const dropD = dropPath((innerHeight * (DROP_RAD * 2)) / DROP_HEIGHT, [\r\n      width / 2,\r\n      (height * DROP_RAD) / DROP_HEIGHT,\r\n    ]);\r\n\r\n    svgContainer.select(\".bucket-mask-path\").attr(\"d\", dropD);\r\n    svgContainer.select(\".bucket-outline\").attr(\"d\", dropD);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / (resolution - 1)));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"waterdrop-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const DESCRIPTIONS_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./descriptions.json\")).json();\r\n\r\n  console.log(\"DATA: loading descriptions data\");\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n})();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { clamp } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst SCEN_DIVISOR = 1; // debugging purposes, don't render all scenarios to speed things up\r\n\r\nexport const MAX_DELIVS = 1200;\r\nexport const SCENARIO_KEY_STRING = \"scens\";\r\nexport const DELIV_KEY_STRING = \"delivs\";\r\n\r\nexport const OBJECTIVES_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./objectives.json\")).json();\r\n\r\n  for (const obj of objs) {\r\n    obj[SCENARIO_KEY_STRING] = obj[SCENARIO_KEY_STRING];\r\n    for (const scen of obj[SCENARIO_KEY_STRING]) {\r\n      // data cleanup, clamping\r\n      const unord = scen[DELIV_KEY_STRING].map((v) => clamp(v, 0, MAX_DELIVS));\r\n\r\n      scen[DELIV_KEY_STRING] = Array.from(unord).sort((a, b) => b - a);\r\n    }\r\n    obj[SCENARIO_KEY_STRING] = mapBy(\r\n      obj[SCENARIO_KEY_STRING],\r\n      ({ name }) => name\r\n    );\r\n  }\r\n\r\n  console.log(\"DATA: loading objectives data\");\r\n\r\n  return mapBy(objs, ({ obj }) => obj);\r\n})();\r\n\r\nexport const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\nconst _SCENARIO_IDS = Object.keys(\r\n  Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n);\r\n\r\nexport const SCENARIO_IDS = _SCENARIO_IDS.filter(\r\n  (_, i) => i % SCEN_DIVISOR === 0\r\n);\r\n\r\n// Flattening hierarchical data makes it more flexible for classifying\r\n// (from experience). id conveniently corresponds to index.\r\n// Also cache classifications (by objective and by scenario, for now)\r\nexport const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n  const flattenedData = [];\r\n  const dataGroupings = {\r\n    objective: {},\r\n    scenario: {},\r\n  };\r\n\r\n  // for ordering later\r\n  const means = [];\r\n\r\n  let idx = 0;\r\n  for (const obj of OBJECTIVE_IDS) {\r\n    for (const scen of SCENARIO_IDS) {\r\n      if (!dataGroupings[\"objective\"][obj])\r\n        dataGroupings[\"objective\"][obj] = [];\r\n\r\n      if (!dataGroupings[\"scenario\"][scen])\r\n        dataGroupings[\"scenario\"][scen] = [];\r\n\r\n      dataGroupings[\"objective\"][obj].push(idx);\r\n      dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n      const deliveries =\r\n        OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n      flattenedData.push({\r\n        id: idx,\r\n        objective: obj,\r\n        scenario: scen,\r\n        deliveries,\r\n      });\r\n\r\n      means.push(d3.mean(deliveries));\r\n\r\n      idx++;\r\n    }\r\n  }\r\n\r\n  const orderedDataGroupings = {};\r\n\r\n  for (const criteria of Object.keys(dataGroupings)) {\r\n    const objScens = [];\r\n    for (const key of Object.keys(dataGroupings[criteria])) {\r\n      const ids = dataGroupings[criteria][key];\r\n      const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n      objScens.push({\r\n        key,\r\n        sorted: sortedObjScens,\r\n        mean: d3.mean(ids.map((id) => flattenedData[id].deliveries).flat()),\r\n      });\r\n    }\r\n\r\n    const sortedObjScens = objScens.sort((a, b) => b.mean - a.mean);\r\n\r\n    orderedDataGroupings[criteria] = {};\r\n\r\n    for (let i = 0; i < sortedObjScens.length; i++) {\r\n      const { key, sorted } = sortedObjScens[i];\r\n      const IDtoRank = {};\r\n\r\n      for (let j = 0; j < sorted.length; j++) {\r\n        IDtoRank[sorted[j]] = j;\r\n      }\r\n      orderedDataGroupings[criteria][key] = IDtoRank;\r\n      orderedDataGroupings[criteria][key].rank = i;\r\n    }\r\n  }\r\n\r\n  return [flattenedData, orderedDataGroupings];\r\n})();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const SPATIAL_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./callite_spatial.json\")).json();\r\n\r\n  console.log(\"DATA: loading callite spatial data\");\r\n\r\n  return objs;\r\n})();\r\n\r\nexport const SPATIAL_FEATURES = (function () {\r\n  return mapBy(SPATIAL_DATA.features, ({ properties }) => properties.CalLiteID);\r\n})();\r\n\r\nexport const CALIFORNIA_OUTLINE = await (async function load() {\r\n  const objs = await (await fetch(\"./california.json\")).json();\r\n\r\n  console.log(\"DATA: loading california spatial data\");\r\n\r\n  return objs;\r\n})();\r\n\r\nexport const CALIFORNIA_CENTER = [-119, 37.7749];\r\n","export const LOD_1_LEVELS = 5;\r\nexport const LOD_1_RAD_PX = 1;\r\nexport const LOD_1_MIN_LEV_VAL = 0.1;\r\nexport const LOD_1_SMALL_DROP_PAD_FACTOR = 1.3;\r\nexport const LOD_1_LARGE_DROP_PAD_FACTOR = 1.2;\r\n\r\nexport const LOD_2_SMALL_DROP_PAD_FACTOR = 3;\r\n\r\nexport const GROUP_HOVER_AREA_FACTOR = 1.1 / (1 + Math.SQRT1_2);\r\nexport const SPREAD_1_2 =\r\n  LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n","import * as THREE from \"three\";\r\nimport * as d3 from \"d3\";\r\n\r\nimport {\r\n  WaterdropMesh,\r\n  WaterdropSimplifiedMesh,\r\n  Camera,\r\n} from \"utils/render-utils\";\r\n\r\nconst scene = (function getScene() {\r\n  const s = new THREE.Scene();\r\n  s.background = new THREE.Color(0xefefef);\r\n  return s;\r\n})();\r\n\r\nconst dropsMesh = new WaterdropMesh();\r\nconst pointsMesh = new WaterdropSimplifiedMesh();\r\n\r\nconst camera = new Camera({\r\n  fov: 45,\r\n  near: 1,\r\n  far: 3000,\r\n});\r\n\r\nconst renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\r\nexport { scene, camera, renderer, dropsMesh, pointsMesh };\r\n","import { ticksExact } from \"bucket-lib/utils\";\r\nimport {\r\n  LOD_1_LARGE_DROP_PAD_FACTOR,\r\n  LOD_1_LEVELS,\r\n  LOD_1_MIN_LEV_VAL,\r\n  LOD_1_RAD_PX,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\n\r\nimport {\r\n  DATA_GROUPINGS,\r\n  FLATTENED_DATA,\r\n  MAX_DELIVS,\r\n  OBJECTIVE_IDS,\r\n  SCENARIO_IDS,\r\n} from \"data/objectives-data\";\r\n\r\nimport { calcDomLev, createInterpsFromDelivs } from \"utils/data-utils\";\r\nimport { placeDropsUsingPhysics, rotatePoint } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\n// TODO optimize!!\r\nexport function initWaterdrops(grouping) {\r\n  const groupKeys = grouping === \"objective\" ? OBJECTIVE_IDS : SCENARIO_IDS;\r\n  const memberKeys = grouping === \"objective\" ? SCENARIO_IDS : OBJECTIVE_IDS;\r\n\r\n  const amtGroups = groupKeys.length;\r\n  const amtPerGroup = memberKeys.length;\r\n\r\n  const largeDropRad =\r\n    Math.sqrt(amtPerGroup / Math.PI) *\r\n    LOD_1_RAD_PX *\r\n    2 *\r\n    LOD_1_SMALL_DROP_PAD_FACTOR *\r\n    LOD_1_LARGE_DROP_PAD_FACTOR;\r\n  const smallDropRad = LOD_1_RAD_PX * LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  const largeNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    groupKeys.map((p, idx) => ({\r\n      r: largeDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  for (let i = 0; i < largeNodesPhys.length; i++) {\r\n    largeNodesPhys[i].tilt = Math.random() * 50 - 25;\r\n  }\r\n\r\n  const largeNodesPos = mapBy(largeNodesPhys, ({ id }) => id);\r\n\r\n  const smallNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    memberKeys.map((s, idx) => ({\r\n      r: smallDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const smallNodesPos = mapBy(smallNodesPhys, ({ id }) => id);\r\n\r\n  const nodes = [];\r\n  const groupNodes = [];\r\n\r\n  const groupToNodes = {};\r\n\r\n  let idx = 0;\r\n\r\n  for (const nodeData of FLATTENED_DATA) {\r\n    const { id, objective, scenario, deliveries } = nodeData;\r\n\r\n    const i = createInterpsFromDelivs(deliveries, MAX_DELIVS);\r\n    const wds = ticksExact(0, 1, LOD_1_LEVELS + 1).map((d) => i(d));\r\n\r\n    const levs = wds.map(\r\n      (w, i) => Math.max(w, i == 0 ? LOD_1_MIN_LEV_VAL : 0) * LOD_1_RAD_PX\r\n    );\r\n\r\n    const groupID = grouping === \"objective\" ? objective : scenario;\r\n    const memberID = grouping === \"objective\" ? scenario : objective;\r\n\r\n    const groupRank = DATA_GROUPINGS[grouping][groupID].rank;\r\n    const memberRank = DATA_GROUPINGS[grouping][groupID][id];\r\n\r\n    const localTilt = Math.random() * 50 - 25;\r\n    const parentTilt = largeNodesPos[groupRank].tilt;\r\n\r\n    const { x, y } = smallNodesPos[memberRank];\r\n    const [rotatedX, rotatedY] = rotatePoint(x, y, parentTilt);\r\n\r\n    const node = {\r\n      id,\r\n      levs,\r\n      maxLev: LOD_1_RAD_PX,\r\n      domLev: calcDomLev(levs),\r\n      tilt: localTilt,\r\n      dur: Math.random() * 100 + 400,\r\n      x,\r\n      y,\r\n      group: groupID,\r\n      key: memberID,\r\n      globalX: largeNodesPos[groupRank].x + rotatedX,\r\n      globalY: largeNodesPos[groupRank].y + rotatedY,\r\n      globalTilt: parentTilt + localTilt,\r\n    };\r\n\r\n    nodes.push(node);\r\n\r\n    if (!groupToNodes[groupID]) groupToNodes[groupID] = [];\r\n\r\n    groupToNodes[groupID].push(node);\r\n  }\r\n\r\n  for (const groupKey of groupKeys) {\r\n    const { x, y, tilt } =\r\n      largeNodesPos[DATA_GROUPINGS[grouping][groupKey].rank];\r\n    groupNodes.push({\r\n      x,\r\n      y,\r\n      tilt,\r\n      key: groupKey,\r\n      height: smallNodesPhys.height,\r\n      nodes: groupToNodes[groupKey],\r\n    });\r\n  }\r\n\r\n  return {\r\n    nodes: nodes,\r\n    groups: groupNodes,\r\n    height: largeNodesPhys.height,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\n\r\nimport { LOD_1_LEVELS, LOD_1_RAD_PX, SPREAD_1_2 } from \"settings\";\r\n\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { clipEnds, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { genUUID, wrap } from \"utils/misc-utils\";\r\nimport { DROPLET_SHAPE } from \"utils/render-utils\";\r\n\r\nexport function getWaterdropGroups(keyArr, waterdrops, center) {\r\n  const groups = keyArr.map((k) => waterdrops.groups.find((g) => g.key === k));\r\n\r\n  const groupPositions = [];\r\n  const rad = groups[0].height * SPREAD_1_2 * 0.75;\r\n\r\n  for (let i = 0, n = groups.length; i < n; i++) {\r\n    const angle = ((Math.PI * 2) / n) * (i - 0.5) - Math.PI / 2;\r\n    groupPositions.push([\r\n      center[0] + Math.cos(angle) * rad,\r\n      center[1] + Math.sin(angle) * rad,\r\n    ]);\r\n  }\r\n\r\n  return {\r\n    groups,\r\n    groupPositions,\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ levs, maxLev }) {\r\n  return (s) => {\r\n    s.select(\".outline\").attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n    s.select(\".fill\").attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n\r\n    s.selectAll(\"stop\").each(function (_, i) {\r\n      let actI = Math.floor(i / 2);\r\n      const isEnd = i % 2;\r\n\r\n      if (isEnd === 0) actI -= 1;\r\n\r\n      if (actI === -1) {\r\n        d3.select(this).attr(\"offset\", `${0}%`);\r\n      } else if (actI === levs.length) {\r\n        d3.select(this).attr(\"offset\", `100%`);\r\n      } else {\r\n        d3.select(this).attr(\"offset\", `${(1 - levs[actI] / maxLev) * 100}%`);\r\n      }\r\n    });\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction gradientInit(levs, id) {\r\n  return (s) => {\r\n    const stops = s\r\n      .append(\"defs\")\r\n      .append(\"linearGradient\")\r\n      .attr(\"id\", id)\r\n      .attr(\"x1\", \"0%\")\r\n      .attr(\"x2\", \"0%\")\r\n      .attr(\"y1\", \"0%\")\r\n      .attr(\"y2\", \"100%\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n    levs.forEach((_, i) => {\r\n      for (let j = 0; j < 2; j++) {\r\n        stops\r\n          .append(\"stop\")\r\n          .attr(\"stop-color\", interpolateWatercolorBlue(i / LOD_1_LEVELS));\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ levs }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const randId = genUUID();\r\n\r\n    s.call(gradientInit(levs, randId));\r\n\r\n    s.append(\"path\").attr(\"d\", DROPLET_SHAPE).attr(\"class\", \"outline\");\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${randId})`);\r\n  };\r\n}\r\n\r\nfunction textUpdate(key, height) {\r\n  return (s) => {\r\n    const t = s.select(\"text\");\r\n\r\n    t.selectAll(\"*\").remove();\r\n    const lines = wrap(\r\n      DESCRIPTIONS_DATA[key].display_name || DESCRIPTIONS_DATA[key].id\r\n    ).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      t.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", (height / 2) * SPREAD_1_2)\r\n        .attr(\"dy\", `${i * 1.2}em`)\r\n        .text(line);\r\n    });\r\n  };\r\n}\r\n\r\nfunction largeDropInit({ nodes, height }) {\r\n  return (s) => {\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"fancy-font water-group-label\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.attr(\"class\", \"large-drop\")\r\n      .selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate({ nodes, key, height }) {\r\n  return (s) => {\r\n    s.call(textUpdate(key, height))\r\n      .selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\r\n        \"transform\",\r\n        ({ x, y, tilt }) => `translate(${x}, ${y}) rotate(${tilt})`\r\n      )\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node));\r\n      });\r\n  };\r\n}\r\n\r\nexport function updateDropsSVG(\r\n  container,\r\n  waterdropGroups,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(largeDropInit(node));\r\n      });\r\n    })\r\n    .attr(\r\n      \"transform\",\r\n      ({ x, y, tilt }) => `translate(${x}, ${y}) rotate(${tilt})`\r\n    )\r\n    .each(function (node) {\r\n      d3.select(this)\r\n        .call(largeDropUpdate(node))\r\n        .selectAll(\".small-drop\")\r\n        .on(\"click\", function (e, d) {\r\n          onClick && onClick(d);\r\n        })\r\n        .on(\"mouseenter\", function (e, d) {\r\n          onHover && onHover(d);\r\n        })\r\n        .on(\"mouseleave\", function (e, d) {\r\n          onUnhover && onUnhover(d);\r\n        })\r\n        .transition()\r\n        .delay(transitionDelay)\r\n        .duration(1000)\r\n        .attr(\r\n          \"transform\",\r\n          ({ x, y, tilt }) =>\r\n            `translate(${x * SPREAD_1_2}, ${y * SPREAD_1_2}) rotate(${tilt})`\r\n        );\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\r\n      \"transform\",\r\n      (_, i) =>\r\n        `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`\r\n    );\r\n}\r\n\r\nexport function calcLinesAndPositions(groupsObj, activeMinidropKey) {\r\n  const positions = [];\r\n  const nodes = [];\r\n  for (let i = 0; i < groupsObj.groups.length; i++) {\r\n    const group = groupsObj.groups[i];\r\n    const groupPos = groupsObj.groupPositions[i];\r\n\r\n    const node = group.nodes.find((n) => n.key === activeMinidropKey);\r\n\r\n    nodes.push(node);\r\n\r\n    positions.push([\r\n      node.x * SPREAD_1_2 + groupPos[0],\r\n      node.y * SPREAD_1_2 +\r\n        groupPos[1] -\r\n        dropCenterCorrection({ rad: LOD_1_RAD_PX }),\r\n    ]);\r\n  }\r\n\r\n  const lines = [];\r\n\r\n  for (let i = 0; i < positions.length; i++) {\r\n    const from = Array.from(positions[i]),\r\n      to = Array.from(positions[i + 1 == positions.length ? 0 : i + 1]);\r\n\r\n    clipEnds([from, to], LOD_1_RAD_PX * 2);\r\n\r\n    lines.push([from, to]);\r\n  }\r\n\r\n  return [positions, lines, nodes];\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\n\r\nimport { SCENARIO_KEY_STRING, DELIV_KEY_STRING } from \"data/objectives-data\";\r\n\r\nexport function createInterps(obj_name, scen_name, data, maxDelivs) {\r\n  const delivs =\r\n    data[obj_name][SCENARIO_KEY_STRING][scen_name][DELIV_KEY_STRING];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\nexport function createInterpsFromDelivs(delivs, maxDelivs) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\n// TODO fix colors\r\nexport function calcDomLev(levs) {\r\n  levs = [1, ...levs, 0];\r\n\r\n  let mean = 0;\r\n  for (let i = 0; i < levs.length - 1; i++) {\r\n    const dif = levs[i] - levs[i + 1];\r\n    mean += (dif * (i - 1)) / (levs.length + 4);\r\n  }\r\n\r\n  return mean;\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\n\r\nimport { LOD_1_LEVELS, LOD_1_RAD_PX, SPREAD_1_2 } from \"settings\";\r\n\r\nimport { dropCenterCorrection } from \"utils/math-utils\";\r\nimport { DROPLET_SHAPE, circlet } from \"utils/render-utils\";\r\n\r\nfunction gradientInit(levs, id) {\r\n  return (s) => {\r\n    const stops = s\r\n      .append(\"defs\")\r\n      .append(\"linearGradient\")\r\n      .attr(\"id\", id)\r\n      .attr(\"x1\", \"0%\")\r\n      .attr(\"x2\", \"0%\")\r\n      .attr(\"y1\", \"0%\")\r\n      .attr(\"y2\", \"100%\");\r\n\r\n    for (let k = 0; k < 2; k++) {\r\n      stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n    }\r\n\r\n    levs.forEach((_, j) => {\r\n      for (let k = 0; k < 2; k++) {\r\n        stops\r\n          .append(\"stop\")\r\n          .attr(\"stop-color\", interpolateWatercolorBlue(j / LOD_1_LEVELS));\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ levs }, i) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"small-drop\");\r\n\r\n    s.call(gradientInit(levs, `drop-fill-${i}`));\r\n\r\n    s.append(\"path\").attr(\"d\", DROPLET_SHAPE).attr(\"class\", \"outline\");\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#drop-fill-${i})`);\r\n\r\n    s.append(\"g\")\r\n      .attr(\"class\", \"circlet\")\r\n      .append(\"circle\")\r\n      .call(circlet)\r\n      .attr(\"display\", \"none\")\r\n      .attr(\"cy\", -dropCenterCorrection({ rad: 1 }))\r\n      .attr(\"r\", 1.5);\r\n\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n  };\r\n}\r\n\r\nfunction gradientUpdate(levs, maxLev) {\r\n  return (s) => {\r\n    s.selectAll(\"stop\").each(function (_, i) {\r\n      // first stop is at 0\r\n      if (i === 0) {\r\n        d3.select(this).attr(\"offset\", `0%`);\r\n        return;\r\n      }\r\n\r\n      // last stop is at 100\r\n      if (i === (levs.length + 1) * 2 - 1) {\r\n        d3.select(this).attr(\"offset\", `100%`);\r\n        return;\r\n      }\r\n\r\n      let valOffset = Math.floor((i - 1) / 2);\r\n\r\n      d3.select(this).attr(\r\n        \"offset\",\r\n        `${(1 - levs[valOffset] / maxLev) * 100}%`\r\n      );\r\n    });\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ levs, maxLev, id }) {\r\n  return (s) => {\r\n    s.call(gradientUpdate(levs, maxLev));\r\n    s.select(\".outline\").attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n    s.select(\".fill\").attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n\r\n    s.select(\".circlet\")\r\n      .attr(\"class\", null)\r\n      .attr(\"class\", \"circlet i\" + id);\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nexport function updateSmallDropSVG(\r\n  container,\r\n  waterdropGroup,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartLoc = ({ globalX, globalY, globalTilt }) =>\r\n    `translate(${globalX}, ${globalY}) rotate(${globalTilt})`;\r\n  const getEndLoc = ({ x, y, tilt }) =>\r\n    `translate(${waterdropGroup.x + x * SPREAD_1_2}, ${\r\n      waterdropGroup.y + y * SPREAD_1_2\r\n    }) rotate(${tilt})`;\r\n\r\n  container\r\n    .selectAll(\".small-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node, i) {\r\n        d3.select(this).call(smallDropInit(node, i));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartLoc)\r\n    .each(function (node) {\r\n      d3.select(this).call(smallDropUpdate(node));\r\n    })\r\n    .on(\"click\", function (_, d) {\r\n      onClick && onClick(d);\r\n    })\r\n    .on(\"mouseenter\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"display\", \"initial\");\r\n      onHover && onHover(d);\r\n    })\r\n    .on(\"mouseleave\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\"circle\").attr(\"display\", \"none\");\r\n      onUnhover && onUnhover(d);\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndLoc);\r\n}\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport Matter from \"matter-js\";\r\n\r\nimport { CIRC_RAD, DROP_HEIGHT } from \"./render-utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor((Math.sqrt(AREA / 3.14) * 2) / 2);\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes, reuse = false) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r));\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\nexport function percentToRatioFilled(p) {\r\n  p -= 0.0088;\r\n  return clamp(\r\n    (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326,\r\n    0,\r\n    1\r\n  );\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport function interp(x, a, b) {\r\n  return x * (b - a) + a;\r\n}\r\n\r\nexport function revInterp(t, a, b) {\r\n  return (t - a) / (b - a);\r\n}\r\n\r\nexport function distSq([x1, y1], [x2, y2]) {\r\n  return (x2 - x1) ** 2 + (y2 - y1) ** 2;\r\n}\r\n\r\nexport function dist([x1, y1], [x2, y2]) {\r\n  return Math.sqrt(distSq([x1, y1], [x2, y2]));\r\n}\r\n\r\nexport function getCenterDomRect(domRect) {\r\n  return [domRect.left + domRect.width / 2, domRect.top + domRect.height / 2];\r\n}\r\n\r\nexport function clipEnds([from, to], shortenBy) {\r\n  const len = Math.sqrt((from[0] - to[0]) ** 2 + (from[1] - to[1]) ** 2);\r\n  const normed = [(to[0] - from[0]) / len, (to[1] - from[1]) / len];\r\n\r\n  from[0] += normed[0] * shortenBy;\r\n  from[1] += normed[1] * shortenBy;\r\n  to[0] -= normed[0] * shortenBy;\r\n  to[1] -= normed[1] * shortenBy;\r\n\r\n  return [from, to];\r\n}\r\n\r\nexport function dropRadToDropHeight(rad) {\r\n  return (1 + Math.SQRT2) * rad;\r\n}\r\n\r\nexport function dropCenterCorrection({ rad, height }) {\r\n  if (rad !== undefined) return dropRadToDropHeight(rad) * 0.08;\r\n  return height * 0.08;\r\n}\r\n\r\nexport function avgCoords(coords) {\r\n  return [d3.mean(coords, (c) => c[0]), d3.mean(coords, (c) => c[1])];\r\n}\r\n\r\nexport function rotatePoint(x, y, deg) {\r\n  const vec = new THREE.Vector3(x, y, 0).applyEuler(\r\n    new THREE.Euler(0, 0, toRadians(deg))\r\n  );\r\n  return [vec.x, vec.y];\r\n}\r\n\r\n// modifies arr!\r\nexport function rotatePoints(arr, deg) {\r\n  for (const a of arr) {\r\n    const newPoint = rotatePoint(a[0], a[1], deg);\r\n    a[0] = newPoint[0];\r\n    a[1] = newPoint[1];\r\n  }\r\n  return arr;\r\n}\r\n","// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    if (typeof v === \"function\")\r\n      _setState((curVal) => (stateRef.current = v(curVal)));\r\n    else _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n\r\nexport function isState(stateInfo, stateName) {\r\n  return stateInfo && stateInfo.state === stateName;\r\n}\r\n\r\nexport function wrap(s) {\r\n  return s.replace(/(?![^\\n]{1,15}$)([^\\n]{1,15})\\s/g, \"$1\\n\");\r\n}\r\n\r\nexport function genUUID() {\r\n  return Math.floor(Math.random() * 1e9);\r\n}\r\n\r\nexport function arrRemove(arr, item) {\r\n  if (typeof item === \"function\") {\r\n    arr.splice(arr.findIndex(item), 1);\r\n  } else {\r\n    arr.splice(arr.indexOf(item), 1);\r\n  }\r\n  return arr;\r\n}\r\n\r\nexport function copyCoords(arr) {\r\n  return arr.map((a) => Array.from(a));\r\n}\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\nimport { LOD_1_LEVELS } from \"settings\";\r\nimport { copyCoords, sortBy } from \"./misc-utils\";\r\nimport { rotatePoint, rotatePoints, toRadians } from \"./math-utils\";\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport const CIRC_RAD = Math.SQRT1_2;\r\nexport const DROP_RAD = 1;\r\nexport const CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nexport const DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = (CIRC_RAD + DROP_RAD / 2) / DROP_HEIGHT;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2, subdivs = 10) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 1 / subdivs;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return {\r\n    x: (mouseX / width) * 2 - 1,\r\n    y: -(mouseY / height) * 2 + 1,\r\n  };\r\n}\r\n\r\nclass MeshGeometry {\r\n  threeGeom = new THREE.BufferGeometry();\r\n  triangleIdx = 0;\r\n  positionAttribute;\r\n  colorAttribute;\r\n\r\n  constructor(numPoints, color = true) {\r\n    this.threeGeom.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n    );\r\n\r\n    if (color)\r\n      this.threeGeom.setAttribute(\r\n        \"color\",\r\n        new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n      );\r\n\r\n    this.positionAttribute = this.threeGeom.getAttribute(\"position\");\r\n    this.colorAttribute = this.threeGeom.getAttribute(\"color\");\r\n  }\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = rotatePoints(\r\n        copyCoords(meshCoords[j]),\r\n        transform.rotate\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 0,\r\n        transform.x + v1[0],\r\n        transform.y - v1[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 1,\r\n        transform.x + v2[0],\r\n        transform.y - v2[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 2,\r\n        transform.x + v3[0],\r\n        transform.y - v3[1],\r\n        z\r\n      );\r\n\r\n      if (color) {\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 0,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 1,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 2,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n      }\r\n\r\n      this.triangleIdx++;\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    this.threeGeom.setDrawRange(0, this.triangleIdx * 3);\r\n  }\r\n}\r\n\r\nexport class WaterdropMesh {\r\n  static MAX_POINTS_DROPS = 60 * 13e4; // approx num verts per droplet * approx num droplets on screen\r\n  static MAX_POINTS_OUTLINE = 40 * 13e4; // approx num verts per droplet * approx num droplets on screen\r\n\r\n  dropsMesh;\r\n  outlineMesh;\r\n\r\n  added = false;\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.dropsMesh) {\r\n      this.initializeMeshes(waterdrops);\r\n    } else {\r\n      this.updateMeshes(waterdrops);\r\n    }\r\n  }\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.dropsMesh);\r\n      scene.add(this.outlineMesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.dropsMesh);\r\n      scene.remove(this.outlineMesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  initializeMeshes(waterdrops) {\r\n    const dropsGeometry = new MeshGeometry(WaterdropMesh.MAX_POINTS_DROPS);\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = waterdropDeltaOutline(\r\n      0,\r\n      1,\r\n      LOD_1_RAD_PX * 2 * 0.975\r\n    );\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const {\r\n        id,\r\n        globalX: x,\r\n        globalY: y,\r\n        levs,\r\n        maxLev,\r\n        globalTilt: tilt,\r\n      } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = waterdropDelta(\r\n          l1 / maxLev,\r\n          l2 / maxLev,\r\n          LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / LOD_1_LEVELS)\r\n        );\r\n\r\n        dropsGeometry.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y, rotate: tilt },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      const rotOutline = rotatePoints(copyCoords(outlineMeshCoords), tilt);\r\n\r\n      outlinePoints.push(\r\n        ...rotOutline.map(([dx, dy]) => {\r\n          return new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01);\r\n        })\r\n      );\r\n    }\r\n\r\n    dropsGeometry.finish();\r\n\r\n    this.dropsMesh = new THREE.Mesh(\r\n      dropsGeometry.threeGeom,\r\n      new THREE.MeshBasicMaterial({\r\n        vertexColors: true,\r\n        transparent: true,\r\n        opacity: 1,\r\n      })\r\n    );\r\n\r\n    this.outlineMesh = new THREE.LineSegments(\r\n      new THREE.BufferGeometry().setFromPoints(outlinePoints),\r\n      new THREE.LineBasicMaterial({\r\n        color: 0xcccccc,\r\n        transparent: true,\r\n        opacity: 0,\r\n      })\r\n    );\r\n  }\r\n\r\n  updateOutlineVisibility(opac) {\r\n    if (!this.outlineMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateVisibility(opac) {\r\n    if (!this.outlineMesh || !this.dropsMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n    this.dropsMesh.material.opacity = opac;\r\n    this.dropsMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateMeshes(waterdrops) {\r\n    // TODO fix\r\n  }\r\n}\r\n\r\nexport class WaterdropSimplifiedMesh {\r\n  mesh;\r\n  added = false;\r\n\r\n  vertToId = {};\r\n  idToVert = {};\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.mesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.mesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.mesh) {\r\n      this.initializeMesh(waterdrops);\r\n    }\r\n\r\n    this.updateMesh(waterdrops);\r\n\r\n    return this.mesh;\r\n  }\r\n\r\n  initializeMesh(waterdrops) {\r\n    const pointsGeometry = new THREE.BufferGeometry();\r\n\r\n    const vertices = [];\r\n    const colors = [];\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, domLev } = waterdrops.nodes[i];\r\n\r\n      const color = domLev > 0 ? interpolateWatercolorBlue(domLev) : \"white\";\r\n\r\n      vertices.push(x, -y, 0);\r\n      const t_color = new THREE.Color(color);\r\n      colors.push(t_color.r, t_color.g, t_color.b);\r\n\r\n      this.vertToId[i] = id;\r\n      this.idToVert[id] = i;\r\n    }\r\n\r\n    const pointsMaterial = new THREE.PointsMaterial({\r\n      size: LOD_1_RAD_PX * 2,\r\n      sizeAttenuation: true,\r\n      vertexColors: true,\r\n      map: new THREE.TextureLoader().load(\"drop.png\"),\r\n      transparent: true,\r\n    });\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(vertices), 3)\r\n    );\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"color\",\r\n      new THREE.BufferAttribute(new Float32Array(colors), 3)\r\n    );\r\n\r\n    this.mesh = new THREE.Points(pointsGeometry, pointsMaterial);\r\n  }\r\n\r\n  updateMesh(waterdrops) {\r\n    const positionAttr = this.mesh.geometry.getAttribute(\"position\");\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: newX, globalY: newY } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n      positionAttr.setXY(idx, newX, -newY);\r\n    }\r\n    positionAttr.needsUpdate = true;\r\n  }\r\n\r\n  updatePoints(waterdrops, translations, dt) {\r\n    const verts = this.mesh.geometry.vertices;\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n\r\n      const [dx, dy] = translations[id];\r\n\r\n      const x = verts[idx].x;\r\n      const y = verts[idx].y;\r\n\r\n      verts[idx].setX(x + dt * dx);\r\n      verts[idx].setY(y - dt * dy);\r\n    }\r\n\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n\r\n  intersectObject(camera, x, y) {\r\n    const intersects = camera.intersectObject(x, y, this.mesh);\r\n\r\n    if (intersects[0]) {\r\n      const intersect = sortBy(intersects, \"distanceToRay\")[0];\r\n      return this.vertToId[intersect.index];\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  view;\r\n  curTransform;\r\n\r\n  raycaster = new THREE.Raycaster();\r\n\r\n  _svgElement;\r\n\r\n  constructor({ fov, near, far }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n  }\r\n\r\n  setZoomFn(zoomFn) {\r\n    this.zoom = d3.zoom().on(\"zoom\", (e) => {\r\n      this.curTransform = e.transform;\r\n\r\n      this._THREEZoomHandler(e.transform);\r\n      d3.select(this._svgElement).attr(\"transform\", e.transform);\r\n\r\n      zoomFn && zoomFn(e.transform);\r\n    });\r\n  }\r\n\r\n  callZoom(transform) {\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity.translate(transform.x, transform.y).scale(transform.k)\r\n    );\r\n  }\r\n\r\n  callZoomFromWorldViewport({ worldX, worldY, farHeight }) {\r\n    const k = this.height / farHeight;\r\n\r\n    const x = -(worldX * k) + this.width / 2;\r\n    const y = worldY * k + this.height / 2;\r\n\r\n    this.callZoom({\r\n      x,\r\n      y,\r\n      k,\r\n    });\r\n  }\r\n\r\n  getZFromFarHeight(farHeight) {\r\n    return (Math.tan(toRadians(90 - this.fov / 2)) * farHeight) / 2;\r\n  }\r\n\r\n  getFarHeightFromZ(z) {\r\n    return Math.tan(toRadians(this.fov) / 2) * z * 2;\r\n  }\r\n\r\n  interpolateZoomCamera([endx, endy, endz]) {\r\n    const i = d3.interpolateZoom(\r\n      [\r\n        this.camera.position.x,\r\n        this.camera.position.y,\r\n        this.height / this.curTransform.k,\r\n      ],\r\n      [endx, -endy, this.getFarHeightFromZ(endz)]\r\n    );\r\n\r\n    const interper = (t) => {\r\n      const [worldX, worldY, farHeight] = i(t);\r\n\r\n      const k = this.height / farHeight;\r\n\r\n      const x = -(worldX * k) + this.width / 2;\r\n      const y = worldY * k + this.height / 2;\r\n\r\n      return {\r\n        x,\r\n        y,\r\n        k,\r\n      };\r\n    };\r\n\r\n    interper.duration = i.duration;\r\n\r\n    return interper;\r\n  }\r\n\r\n  mount(webglElement, svgElement) {\r\n    this.view = d3.select(webglElement);\r\n    this._svgElement = svgElement;\r\n  }\r\n\r\n  setSize(width, height) {\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.zoom = this.zoom.scaleExtent([\r\n      this.getScaleFromZ(this.far),\r\n      this.getScaleFromZ(this.near),\r\n    ]);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      this.fov,\r\n      width / height,\r\n      this.near,\r\n      this.far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.view.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  _THREEZoomHandler(transform) {\r\n    const scale = transform.k;\r\n    const x = -(transform.x - this.width / 2) / scale;\r\n    const y = (transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n\r\n  getScaleFromZ(camera_z_position) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const half_fov_height = Math.tan(half_fov_radians) * camera_z_position;\r\n    const fov_height = half_fov_height * 2;\r\n    const scale = this.height / fov_height;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const scale_height = this.height / scale;\r\n    const camera_z_position = scale_height / (2 * Math.tan(half_fov_radians));\r\n    return camera_z_position;\r\n  }\r\n\r\n  intersectObject(mouseX, mouseY, mesh) {\r\n    this.raycaster.setFromCamera(\r\n      {\r\n        x: mouseX,\r\n        y: mouseY,\r\n      },\r\n      this.camera\r\n    );\r\n\r\n    return this.raycaster.intersectObject(mesh);\r\n  }\r\n}\r\n\r\nexport function circlet(s) {\r\n  s.attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke\", \"orange\")\r\n    .attr(\"stroke-dasharray\", 3)\r\n    .attr(\"stroke-width\", 3)\r\n    .attr(\"vector-effect\", \"non-scaling-stroke\");\r\n}\r\n\r\nexport function showElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", \"block\");\r\n}\r\n\r\nexport function hideElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", \"none\");\r\n}\r\n\r\nexport function removeElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).remove();\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\n\r\nimport { interpolateWatercolorBlue, ticksExact } from \"bucket-lib/utils\";\r\nimport {\r\n  DELIV_KEY_STRING,\r\n  MAX_DELIVS,\r\n  OBJECTIVES_DATA,\r\n  SCENARIO_KEY_STRING,\r\n} from \"data/objectives-data\";\r\nimport yearlyData from \"data/yearly.json\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { LOD_1_LEVELS } from \"settings\";\r\nimport { SPREAD_1_2 } from \"settings\";\r\nimport { DROPLET_SHAPE, circlet, hideElems, showElems } from \"./render-utils\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\nimport { avgCoords } from \"./math-utils\";\r\nimport { calcLinesAndPositions, getWaterdropGroups } from \"./compareview-utils\";\r\nimport { genUUID, wrap } from \"./misc-utils\";\r\n\r\nexport const DATE_START = 1921;\r\nexport const INTERP_COLOR = d3.interpolateRgbBasis([\r\n  \"#F2F5FB\",\r\n  \"#D0DDEB\",\r\n  \"#7B9BC0\",\r\n  \"#4F739F\",\r\n  \"#112A57\",\r\n]);\r\n\r\nexport const NUM_OPTS = {\r\n  demand: 5,\r\n  carryover: 3,\r\n  priority: 2,\r\n  regs: 4,\r\n  minflow: 5,\r\n};\r\n\r\nexport const DEFAULT_OBJECTIVE = \"DEL_CVP_PAG_N\";\r\nexport const DEFAULT_SCENARIO = [1, 1, 0, 0, 0]; // expl0160\r\nexport const DEFAULT_DELIVS =\r\n  OBJECTIVES_DATA[DEFAULT_OBJECTIVE][SCENARIO_KEY_STRING][\r\n    serialize(...DEFAULT_SCENARIO)\r\n  ][DELIV_KEY_STRING];\r\n\r\nexport const COMP_OBJECTIVE = \"DEL_CVP_PRF_S\";\r\n\r\nexport const VARIATIONS = [\r\n  [1, 1, 1, 0, 0], // expl0180\r\n  [1, 2, 0, 0, 0], // expl0200\r\n  [1, 1, 0, 0, 4], // expl0164\r\n  [1, 1, 0, 3, 0], // expl0175\r\n];\r\n\r\nexport const VARIATIONS_DELIVS = VARIATIONS.map(\r\n  (vars) =>\r\n    OBJECTIVES_DATA[DEFAULT_OBJECTIVE][SCENARIO_KEY_STRING][serialize(...vars)][\r\n      DELIV_KEY_STRING\r\n    ]\r\n);\r\n\r\nexport const VARIATIONS_INTERPERS = VARIATIONS_DELIVS.map((varDelivs) =>\r\n  d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, varDelivs.length))\r\n    .range(\r\n      varDelivs\r\n        .map((v) => v / MAX_DELIVS)\r\n        .sort()\r\n        .reverse()\r\n    )\r\n    .clamp(true)\r\n);\r\n\r\nexport const DEFAULT_INTERPER = d3\r\n  .scaleLinear()\r\n  .domain(ticksExact(0, 1, DEFAULT_DELIVS.length))\r\n  .range(\r\n    DEFAULT_DELIVS.map((v) => v / MAX_DELIVS)\r\n      .sort()\r\n      .reverse()\r\n  )\r\n  .clamp(true);\r\n\r\nexport const BAR_CHART_WIDTH = 800,\r\n  BAR_CHART_HEIGHT = 400;\r\n\r\nexport const BAR_CHART_MARGIN = { top: 40, right: 30, bottom: 40, left: 60 };\r\n\r\nexport function serialize(demand, carryover, priority, regs, minflow) {\r\n  let code = 0;\r\n  code += minflow;\r\n  code += NUM_OPTS.minflow * regs;\r\n  code += NUM_OPTS.regs * NUM_OPTS.minflow * priority;\r\n  code += NUM_OPTS.priority * NUM_OPTS.regs * NUM_OPTS.minflow * carryover;\r\n  code +=\r\n    NUM_OPTS.carryover *\r\n    NUM_OPTS.priority *\r\n    NUM_OPTS.regs *\r\n    NUM_OPTS.minflow *\r\n    demand;\r\n\r\n  const finalKey = `expl${d3.format(\"0>4\")(code)}`;\r\n\r\n  return finalKey;\r\n}\r\n\r\nexport function useTutorialState() {\r\n  const [userGoal, setUserGoal] = useState(200);\r\n  const [bucketInterper, setBucketInterper] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [dropInterper, setDropInterper] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [variationInterpers, setVariationInterpers] = useState(() =>\r\n    VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n  );\r\n\r\n  return {\r\n    userGoal,\r\n    setUserGoal,\r\n    bucketInterper,\r\n    setBucketInterper,\r\n    dropInterper,\r\n    setDropInterper,\r\n    variationInterpers,\r\n    setVariationInterpers,\r\n  };\r\n}\r\n\r\nexport function useTutorialGraph() {\r\n  const d3Refs = useRef({});\r\n\r\n  function initGraphArea() {\r\n    const svgGroup = d3\r\n      .select(\"#tut-bar-graph\")\r\n      .attr(\r\n        \"width\",\r\n        BAR_CHART_WIDTH + BAR_CHART_MARGIN.left + BAR_CHART_MARGIN.right\r\n      )\r\n      .attr(\r\n        \"height\",\r\n        BAR_CHART_HEIGHT + BAR_CHART_MARGIN.top + BAR_CHART_MARGIN.bottom\r\n      )\r\n      .attr(\"opacity\", 1)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-group\")\r\n      .attr(\r\n        \"transform\",\r\n        `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n      );\r\n\r\n    const dataDescending = yearlyData\r\n      .map((val, placeFromLeft) => ({\r\n        val,\r\n        placeFromLeft,\r\n        year: placeFromLeft + 1,\r\n      }))\r\n      .sort((a, b) => b.val - a.val);\r\n\r\n    const x = d3\r\n      .scaleBand()\r\n      .domain(dataDescending.map(({ year }) => year).sort((a, b) => a - b))\r\n      .range([0, BAR_CHART_WIDTH])\r\n      .padding(0.4);\r\n    const y = d3\r\n      .scaleLinear()\r\n      .domain([0, MAX_DELIVS])\r\n      .range([BAR_CHART_HEIGHT, 0]);\r\n\r\n    const xaxis = d3\r\n      .axisBottom(x)\r\n      .tickSize(0)\r\n      .tickFormat((d) => `year ${d}`)\r\n      .tickValues(x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0));\r\n\r\n    svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n    svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n    svgGroup\r\n      .select(\".anim-xaxis\")\r\n      .attr(\"opacity\", 1)\r\n      .attr(\"transform\", `translate(0, ${BAR_CHART_HEIGHT})`)\r\n      .call(xaxis)\r\n      .selectAll(\"text\")\r\n      .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n      .style(\"text-anchor\", \"end\");\r\n    svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n    d3Refs.current = { x, xaxis, dataDescending };\r\n  }\r\n\r\n  function initBars() {\r\n    const { x, dataDescending } = d3Refs.current;\r\n    const y = d3\r\n      .scaleLinear()\r\n      .domain([0, MAX_DELIVS])\r\n      .range([BAR_CHART_HEIGHT, 0]);\r\n\r\n    d3.select(\".svg-group\")\r\n      .selectAll(\".bars\")\r\n      .data(dataDescending, (d) => d.placeFromLeft)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bars\")\r\n      .attr(\"x\", (d) => x(d.year))\r\n      .attr(\"y\", BAR_CHART_HEIGHT)\r\n      .attr(\"width\", x.bandwidth())\r\n      .attr(\"height\", 0)\r\n      .attr(\"opacity\", 1)\r\n      .attr(\"fill\", \"steelblue\")\r\n      .transition()\r\n      .duration(500)\r\n      .delay((d) => d.placeFromLeft * 10)\r\n      .attr(\"y\", (d) => y(d.val))\r\n      .attr(\"height\", (d) => BAR_CHART_HEIGHT - y(d.val));\r\n  }\r\n\r\n  async function condenseBars() {\r\n    const { x, xaxis, dataDescending } = d3Refs.current;\r\n    const newWidth = BAR_CHART_WIDTH / 8;\r\n    const svgGroup = d3.select(\".svg-group\");\r\n\r\n    svgGroup.select(\".anim-xaxis\").call(xaxis.tickFormat(\"\"));\r\n\r\n    const bars = svgGroup.selectAll(\".bars\");\r\n\r\n    await bars\r\n      .style(\"mix-blend-mode\", \"multiply\")\r\n      .transition()\r\n      .duration(500)\r\n      .attr(\"opacity\", 0.05)\r\n      .transition()\r\n      .delay(\r\n        (d) =>\r\n          100 + (1 - (1 - d.placeFromLeft / dataDescending.length) ** 4) * 1000\r\n      )\r\n      .duration(500)\r\n      .attr(\"width\", newWidth)\r\n      .attr(\"x\", BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n      .end();\r\n\r\n    svgGroup\r\n      .select(\".anim-xaxis\")\r\n      .transition()\r\n      .transition(500)\r\n      .attr(\"transform\", `translate(0, ${BAR_CHART_HEIGHT + 50})`)\r\n      .attr(\"opacity\", 0);\r\n\r\n    bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n    svgGroup\r\n      .transition()\r\n      .delay(500)\r\n      .attr(\r\n        \"transform\",\r\n        `translate(${\r\n          BAR_CHART_MARGIN.left + BAR_CHART_WIDTH / 2 - newWidth / 2\r\n        },${BAR_CHART_MARGIN.top})`\r\n      );\r\n  }\r\n\r\n  return {\r\n    initGraphArea,\r\n    initBars,\r\n    condenseBars,\r\n  };\r\n}\r\n\r\nexport function useTutorialComparer() {\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const groupsRef = useRef();\r\n  const camCentersRef = useRef({});\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines] = calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop\r\n        );\r\n\r\n        updateLabel(avgCoords(positions));\r\n        updateScenIndicators(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  function initComparer(waterdrops, camera) {\r\n    groupsRef.current = getWaterdropGroups(\r\n      [COMP_OBJECTIVE, DEFAULT_OBJECTIVE],\r\n      waterdrops,\r\n      [0, 0]\r\n    );\r\n\r\n    const farHeight = waterdrops.groups[0].height * 2 * SPREAD_1_2 * 0.75;\r\n    const k = camera.height / farHeight;\r\n\r\n    let x = camera.width / 2;\r\n    let y = camera.height / 2;\r\n\r\n    const camMidpoint = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    x = -(groupsRef.current.groupPositions[1][0] * k) + camera.width / 2;\r\n    y = groupsRef.current.groupPositions[1][1] * k + camera.height / 2;\r\n\r\n    const camFirstDrop = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    camCentersRef.current.firstDrop = camFirstDrop;\r\n    camCentersRef.current.midpoint = camMidpoint;\r\n\r\n    const container = d3\r\n      .select(\"#comparer-graphics\")\r\n      .attr(\"width\", window.innerWidth)\r\n      .attr(\"height\", window.innerHeight)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-group\")\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(camFirstDrop.x, camFirstDrop.y)\r\n          .scale(camFirstDrop.k)\r\n      );\r\n\r\n    const indicatorGroup = container\r\n      .append(\"g\")\r\n      .attr(\"class\", \"indicator-group\");\r\n\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-variable\");\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    updateDropsSVG(container, groupsRef.current, {\r\n      onHover: (d) => {\r\n        setActiveMinidrop(d.key);\r\n      },\r\n    });\r\n\r\n    setActiveMinidrop(\"expl0160\");\r\n    hideElems(`.large-drop.${COMP_OBJECTIVE}, .indicator-group`, container);\r\n  }\r\n\r\n  function updateLabel(pos) {\r\n    const [textX, textY] = pos;\r\n\r\n    const smallTextSize =\r\n      (groupsRef.current.groups[0].height * SPREAD_1_2) / 15;\r\n    const largeTextSize =\r\n      (groupsRef.current.groups[0].height * SPREAD_1_2) / 10;\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-label\")\r\n      .text(\"scenario\")\r\n      .attr(\"font-size\", smallTextSize)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-variable\")\r\n      .attr(\"font-size\", largeTextSize)\r\n      .text(activeMinidrop.slice(4))\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY);\r\n  }\r\n\r\n  function updateScenIndicators(positions, lines) {\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".circlet\")\r\n      .data(positions)\r\n      .join(\"circle\")\r\n      .attr(\"class\", \"circlet\")\r\n      .call(circlet)\r\n      .attr(\"r\", LOD_1_RAD_PX * 1.5)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"cx\", (d) => d[0])\r\n      .attr(\"cy\", (d) => d[1]);\r\n\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".comp-line\")\r\n      .data(lines)\r\n      .join(\"path\")\r\n      .attr(\"class\", \"comp-line\")\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"d\", (d) => d3.line()(d));\r\n  }\r\n\r\n  function introDrop2() {\r\n    const container = d3.select(\"#comparer-graphics\");\r\n\r\n    container\r\n      .select(\".svg-group\")\r\n      .transition()\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(\r\n            camCentersRef.current.midpoint.x,\r\n            camCentersRef.current.midpoint.y\r\n          )\r\n          .scale(camCentersRef.current.midpoint.k)\r\n      );\r\n\r\n    showElems(`.large-drop.${COMP_OBJECTIVE}, .indicator-group`, container);\r\n  }\r\n\r\n  return { initComparer, introDrop2 };\r\n}\r\n\r\nexport const DROP_VARIATIONS = [\r\n  {\r\n    idx: 0,\r\n    scen: \"0180\",\r\n    clas: \"drop1\",\r\n    desc: \"increase priority\",\r\n  },\r\n  {\r\n    idx: 1,\r\n    scen: \"0200\",\r\n    clas: \"drop2\",\r\n    desc: \"increase carryover\",\r\n  },\r\n  {\r\n    idx: 2,\r\n    scen: \"0164\",\r\n    clas: \"drop3\",\r\n    desc: \"increase min. flow\",\r\n  },\r\n  {\r\n    idx: 3,\r\n    scen: \"0175\",\r\n    clas: \"drop4\",\r\n    desc: \"increase regs.\",\r\n  },\r\n];\r\n\r\nfunction smallDropInit({ levs }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const randId = genUUID();\r\n\r\n    const stops = s\r\n      .append(\"defs\")\r\n      .append(\"linearGradient\")\r\n      .attr(\"id\", `${randId}`)\r\n      .attr(\"x1\", \"0%\")\r\n      .attr(\"x2\", \"0%\")\r\n      .attr(\"y1\", \"0%\")\r\n      .attr(\"y2\", \"100%\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n    levs.forEach((_, i) => {\r\n      for (let j = 0; j < 2; j++) {\r\n        stops\r\n          .append(\"stop\")\r\n          .attr(\"stop-color\", interpolateWatercolorBlue(i / LOD_1_LEVELS));\r\n      }\r\n    });\r\n\r\n    s.append(\"path\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"class\", \"outline\")\r\n      .attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${randId})`)\r\n      .attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n  };\r\n}\r\n\r\nfunction largeDropInit({ nodes, height, key }) {\r\n  return (s) => {\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"fancy-font water-group-label\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.attr(\"class\", \"large-drop \" + key)\r\n      .selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ levs, maxLev }) {\r\n  return (s) => {\r\n    s.selectAll(\"stop\").each(function (_, i) {\r\n      let actI = Math.floor(i / 2);\r\n      const isEnd = i % 2;\r\n\r\n      if (isEnd === 0) actI -= 1;\r\n\r\n      if (actI === -1) {\r\n        d3.select(this).attr(\"offset\", `${0}%`);\r\n      } else if (actI === levs.length) {\r\n        d3.select(this).attr(\"offset\", `100%`);\r\n      } else {\r\n        d3.select(this).attr(\"offset\", `${(1 - levs[actI] / maxLev) * 100}%`);\r\n      }\r\n    });\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate({ nodes, key, height }) {\r\n  return (s) => {\r\n    const t = s.select(\"text\");\r\n\r\n    t.selectAll(\"*\").remove();\r\n\r\n    const lines = wrap(\r\n      DESCRIPTIONS_DATA[key].display_name || DESCRIPTIONS_DATA[key].id\r\n    ).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      t.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", (height / 2) * SPREAD_1_2)\r\n        .attr(\"dy\", `${i}em`)\r\n        .text(line);\r\n    });\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\r\n        \"transform\",\r\n        ({ x, y }) => `translate(${x * SPREAD_1_2}, ${y * SPREAD_1_2})`\r\n      )\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction updateDropsSVG(container, waterdropGroups, { onHover }) {\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (group) {\r\n        d3.select(this).call(largeDropInit(group));\r\n      });\r\n    })\r\n    .attr(\"transform\", (_, i) => {\r\n      const groupPos = waterdropGroups.groupPositions[i];\r\n      return `translate(${groupPos[0]}, ${groupPos[1]})`;\r\n    })\r\n    .each(function (group) {\r\n      d3.select(this)\r\n        .call(largeDropUpdate(group))\r\n        .selectAll(\".small-drop\")\r\n        .on(\"mouseenter\", function (e, d) {\r\n          onHover && onHover(d);\r\n        });\r\n    });\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport {\r\n  CALIFORNIA_CENTER,\r\n  CALIFORNIA_OUTLINE,\r\n  SPATIAL_DATA,\r\n} from \"data/spatial-data\";\r\nimport { GROUP_HOVER_AREA_FACTOR } from \"settings\";\r\n\r\nimport { dist, dropCenterCorrection, getCenterDomRect } from \"utils/math-utils\";\r\nimport { wrap } from \"utils/misc-utils\";\r\nimport { circlet } from \"utils/render-utils\";\r\n\r\nfunction interactorsInit() {\r\n  const s = d3.select(this);\r\n\r\n  s.append(\"g\")\r\n    .attr(\"class\", \"circlet\")\r\n    .append(\"circle\")\r\n    .call(circlet)\r\n    .attr(\"display\", \"none\")\r\n    .attr(\"r\", 1);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"hover-capture\")\r\n    .attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke-width\", 0)\r\n    .attr(\"r\", 0.8);\r\n\r\n  const textGroup = s.append(\"g\").attr(\"pointer-events\", \"none\");\r\n  textGroup\r\n    .append(\"image\")\r\n    .attr(\"href\", \"glow.png\")\r\n    .attr(\"preserveAspectRatio\", \"none\")\r\n    .attr(\"opacity\", 0.8);\r\n  textGroup\r\n    .append(\"text\")\r\n    .attr(\"class\", \"fancy-font\")\r\n    .attr(\"text-anchor\", \"middle\")\r\n    .attr(\"font-size\", 0);\r\n}\r\n\r\nfunction interactorsUpdate(d) {\r\n  d3.select(this)\r\n    .select(\".circlet\")\r\n    .attr(\"class\", null)\r\n    .attr(\"class\", \"circlet \" + d.key);\r\n  d3.select(this).select(\"text\").call(textUpdate(d));\r\n}\r\n\r\nfunction textUpdate(d) {\r\n  return function (s) {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = wrap(\r\n      DESCRIPTIONS_DATA[d.key].display_name || DESCRIPTIONS_DATA[d.key].id\r\n    ).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      s.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", `${-lines.length / 2 + 0.5}em`)\r\n        .attr(\"dy\", `${i}em`)\r\n        .text(line);\r\n    });\r\n  };\r\n}\r\n\r\nfunction dropTransform({ x, y, height }) {\r\n  return `translate(${x}, ${y - dropCenterCorrection({ height })}) scale(${\r\n    height * GROUP_HOVER_AREA_FACTOR\r\n  })`;\r\n}\r\n\r\nexport function updateLargeDropSVG(\r\n  container,\r\n  waterdrops,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdrops.groups)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(interactorsInit);\r\n    })\r\n    .each(interactorsUpdate)\r\n    .style(\"display\", \"initial\")\r\n    .attr(\"transform\", dropTransform)\r\n    .select(\".hover-capture\")\r\n    .on(\"click\", function (_, d) {\r\n      onClick && onClick(d);\r\n    })\r\n    .on(\"mouseenter\", function (_, d) {\r\n      if (!d3.select(this.parentNode).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this.parentNode).select(\"circle\").attr(\"display\", \"initial\");\r\n      onHover && onHover(d);\r\n    })\r\n    .on(\"mouseleave\", function (_, d) {\r\n      if (!d3.select(this.parentNode).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this.parentNode).select(\"circle\").attr(\"display\", \"none\");\r\n      onUnhover && onUnhover(d);\r\n    });\r\n}\r\n\r\nexport function drawMinimapSVG() {\r\n  const width = 200,\r\n    height = 250;\r\n\r\n  const minimap = d3\r\n    .select(\"#minimap\")\r\n    .attr(\"width\", width)\r\n    .attr(\"height\", height);\r\n\r\n  const proj = d3\r\n    .geoMercator()\r\n    .scale(1000)\r\n    .center(CALIFORNIA_CENTER)\r\n    .translate([width / 2, height / 2]);\r\n\r\n  const lineGeom = [\r\n    ...SPATIAL_DATA.features.filter((f) => f.geometry.type === \"MultiPolygon\"),\r\n    CALIFORNIA_OUTLINE,\r\n  ];\r\n  const pointGeom = SPATIAL_DATA.features.filter(\r\n    (f) => f.geometry.type === \"MultiPoint\"\r\n  );\r\n\r\n  minimap\r\n    .selectAll(\"path\")\r\n    .data(lineGeom)\r\n    .join(\"path\")\r\n    .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"stroke\", (d) =>\r\n      d.properties.CalLiteID ? \"transparent\" : \"lightgray\"\r\n    )\r\n    .attr(\"stroke-width\", 1)\r\n    .attr(\"fill\", \"transparent\");\r\n\r\n  minimap\r\n    .selectAll(\"circle\")\r\n    .data(pointGeom)\r\n    .join(\"circle\")\r\n    .each(function (d) {\r\n      const s = d3.select(this);\r\n\r\n      const [x, y] = proj(d.geometry.coordinates[0]);\r\n\r\n      s.attr(\"cx\", x);\r\n      s.attr(\"cy\", y);\r\n    })\r\n    .attr(\"r\", 2)\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"fill\", \"transparent\");\r\n}\r\n\r\nexport function getFontSize(d, transformZoom, cameraHeight, waterdropsHeight) {\r\n  const MAX_RAD = window.innerHeight / 9;\r\n\r\n  const zoomRel = cameraHeight / waterdropsHeight / transformZoom;\r\n\r\n  const absFontSize = (_d) =>\r\n    _d > MAX_RAD\r\n      ? 0\r\n      : d3.scaleLinear().domain([0, MAX_RAD]).range([1, 0.4]).clamp(true)(_d);\r\n\r\n  return absFontSize(d * zoomRel) * Math.min(zoomRel, 0.4);\r\n}\r\n\r\nexport function fontSizer(transformInfo, camera, waterdropsHeight) {\r\n  return function () {\r\n    const tNode = d3.select(this).node();\r\n\r\n    const [posx, posy] = getCenterDomRect(tNode.getBoundingClientRect());\r\n\r\n    const width = ((tNode.getBBox().width * camera.height) / camera.far) * 8,\r\n      height = ((tNode.getBBox().height * camera.height) / camera.far) * 10;\r\n\r\n    const dis = dist(\r\n      [posx, posy],\r\n      [transformInfo.mouseX, transformInfo.mouseY]\r\n    );\r\n\r\n    d3.select(this).attr(\r\n      \"font-size\",\r\n      getFontSize(dis, transformInfo.zoom, camera.height, waterdropsHeight)\r\n    );\r\n\r\n    d3.select(this.parentNode.parentNode)\r\n      .select(\"image\")\r\n      .attr(\"x\", -width / 2)\r\n      .attr(\"y\", -height / 2)\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n  };\r\n}\r\n\r\nexport function fadeOutDrops(dropsMesh, scene, startOpac, duration) {\r\n  const t = d3.timer((elapsed) => {\r\n    const et = Math.min(1, elapsed / duration);\r\n\r\n    dropsMesh.updateVisibility(1 - et);\r\n    dropsMesh.updateOutlineVisibility(startOpac * (1 - et));\r\n\r\n    if (et >= 1) {\r\n      t.stop();\r\n      dropsMesh.remove(scene);\r\n    }\r\n  });\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport { FLATTENED_DATA } from \"data/objectives-data\";\r\nimport { LOD_1_RAD_PX, SPREAD_1_2 } from \"settings\";\r\n\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { circlet, hideElems, removeElems, showElems } from \"utils/render-utils\";\r\n\r\nimport {\r\n  calcLinesAndPositions,\r\n  getWaterdropGroups,\r\n  updateDropsSVG,\r\n} from \"utils/compareview-utils\";\r\n\r\nexport default function CompareView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n    camera,\r\n    goals,\r\n    setGoals,\r\n    addZoomHandler,\r\n  } = useContext(AppContext);\r\n\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const [panels, setPanels] = useState([]);\r\n  const groupsRef = useRef();\r\n  const centerRef = useRef();\r\n  const mouseDownInfo = useRef({});\r\n\r\n  // TODO trigger rerender another way?\r\n  const [cameraChangeFlag, setCameraChangeFlag] = useState(false);\r\n\r\n  useEffect(function initialize() {\r\n    const container = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"compare-group\");\r\n\r\n    container.append(\"text\").attr(\"id\", \"member-variable\");\r\n    container.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    registerEventListeners();\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"CompareView\")) {\r\n        const container = d3.select(\"#compare-group\");\r\n\r\n        const { viewCenter, transitionDuration } = state;\r\n\r\n        centerRef.current = viewCenter;\r\n\r\n        groupsRef.current = getWaterdropGroups(\r\n          activeWaterdrops,\r\n          waterdrops,\r\n          viewCenter\r\n        );\r\n\r\n        updateDropsSVG(container, groupsRef.current, transitionDuration / 5, {\r\n          onHover: (d) => {\r\n            setActiveMinidrop({ key: d.key });\r\n          },\r\n        });\r\n\r\n        hideElems(\".water-group-label\");\r\n\r\n        setTimeout(() => {\r\n          setActiveMinidrop({ key: groupsRef.current.groups[0].nodes[0].key });\r\n          showElems(\r\n            \"#member-variable, #member-label, .water-group-label\",\r\n            container\r\n          );\r\n        }, transitionDuration + 500);\r\n\r\n        setGoBack(() => () => {\r\n          setState({ state: \"WideView\" });\r\n\r\n          resetCamera();\r\n        });\r\n\r\n        return function exitState() {\r\n          removeElems(\".large-drop, .circlet, .comp-line\", container);\r\n\r\n          hideElems(\"#member-variable, #member-label\", container);\r\n\r\n          setPanels([]);\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines, nodes] = calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop.key\r\n        );\r\n\r\n        setPanels(fromNodes(nodes));\r\n        updateLabel(avgCoords(positions));\r\n        updateScenIndicators(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  function registerEventListeners() {\r\n    addZoomHandler(function () {\r\n      setCameraChangeFlag((f) => !f);\r\n    });\r\n\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX !== undefined) {\r\n        mouseDownInfo.current = {};\r\n      }\r\n    });\r\n  }\r\n\r\n  function fromNodes(nodes) {\r\n    return (p) => {\r\n      return nodes.map((n, i) => {\r\n        let ox = 0,\r\n          oy = 0;\r\n\r\n        if (p[i]) {\r\n          ox = p[i].offsetX;\r\n          oy = p[i].offsetY;\r\n        }\r\n\r\n        const [x, y, isLeft] = getIdealGroupPos(\r\n          groupsRef.current.groupPositions[i],\r\n          centerRef.current\r\n        );\r\n\r\n        return {\r\n          text: n.key,\r\n          x,\r\n          y,\r\n          id: groupsRef.current.groups[i].key,\r\n          nodeID: n.id,\r\n          isLeft,\r\n          offsetX: ox,\r\n          offsetY: oy,\r\n        };\r\n      });\r\n    };\r\n  }\r\n\r\n  function updateLabel(pos) {\r\n    const [textX, textY] = pos;\r\n\r\n    const smallTextSize =\r\n      (groupsRef.current.groups[0].height * SPREAD_1_2) / 15;\r\n    const largeTextSize =\r\n      (groupsRef.current.groups[0].height * SPREAD_1_2) / 10;\r\n\r\n    d3.select(\"#compare-group\")\r\n      .select(\"#member-label\")\r\n      .text(\"scenario\")\r\n      .attr(\"font-size\", smallTextSize)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n    d3.select(\"#compare-group\")\r\n      .select(\"#member-variable\")\r\n      .attr(\"font-size\", largeTextSize)\r\n      .text(activeMinidrop.key.slice(4))\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY);\r\n  }\r\n\r\n  function updateScenIndicators(positions, lines) {\r\n    d3.select(\"#compare-group\")\r\n      .selectAll(\".circlet\")\r\n      .data(positions)\r\n      .join(\"circle\")\r\n      .attr(\"class\", \"circlet\")\r\n      .call(circlet)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\"r\", LOD_1_RAD_PX * 1.5)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"cx\", (d) => d[0])\r\n      .attr(\"cy\", (d) => d[1]);\r\n\r\n    d3.select(\"#compare-group\")\r\n      .selectAll(\".comp-line\")\r\n      .data(lines)\r\n      .join(\"path\")\r\n      .attr(\"class\", \"comp-line\")\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"d\", (d) => d3.line()(d));\r\n  }\r\n\r\n  function getIdealGroupPos([x, y], [centerX, centerY]) {\r\n    let newX = x,\r\n      newY = y;\r\n\r\n    const correctionX = groupsRef.current.groups[0].height * 2;\r\n\r\n    if (newX < centerX) newX -= correctionX;\r\n    else newX += correctionX;\r\n\r\n    return [newX, newY, newX < centerX];\r\n  }\r\n\r\n  function onPanelDragStart(e, id) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function getStyle(x, y, offsetX, offsetY) {\r\n    return {\r\n      left: `${x * camera.curTransform.k + camera.curTransform.x + offsetX}px`,\r\n      top: `${y * camera.curTransform.k + camera.curTransform.y + offsetY}px`,\r\n    };\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {panels.map(({ x, y, id, isLeft, offsetX, offsetY, nodeID }, i) => (\r\n        <div\r\n          className={\"panel compare-panel\" + (isLeft ? \" left\" : \"\")}\r\n          key={i}\r\n          style={getStyle(x, y, offsetX, offsetY)}\r\n          onMouseDown={(e) => onPanelDragStart(e, id)}\r\n        >\r\n          <DotHistogram\r\n            width={300}\r\n            height={200}\r\n            data={FLATTENED_DATA[nodeID].deliveries}\r\n            goal={goals[id]}\r\n            setGoal={(newGoal) => {\r\n              setGoals((g) => {\r\n                g[id] = newGoal;\r\n                return { ...g };\r\n              });\r\n            }}\r\n          />\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport { FLATTENED_DATA } from \"data/objectives-data\";\r\nimport { SPREAD_1_2 } from \"settings\";\r\n\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { updateSmallDropSVG } from \"utils/examineview-utils\";\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport { removeElems } from \"utils/render-utils\";\r\n\r\nconst NUM_OPTS = {\r\n  demand: 5,\r\n  carryover: 3,\r\n  priority: 2,\r\n  regs: 4,\r\n  minflow: 5,\r\n};\r\n\r\nfunction deserialize(scenStr) {\r\n  let scenNum = parseInt(scenStr);\r\n\r\n  const minflow = scenNum % NUM_OPTS.minflow;\r\n  scenNum = (scenNum - minflow) / NUM_OPTS.minflow;\r\n\r\n  const regs = scenNum % NUM_OPTS.regs;\r\n  scenNum = (scenNum - regs) / NUM_OPTS.regs;\r\n\r\n  const priority = scenNum % NUM_OPTS.priority;\r\n  scenNum = (scenNum - priority) / NUM_OPTS.priority;\r\n\r\n  const carryover = scenNum % NUM_OPTS.carryover;\r\n  scenNum = (scenNum - carryover) / NUM_OPTS.carryover;\r\n\r\n  const demand = scenNum % NUM_OPTS.demand;\r\n  scenNum = (scenNum - demand) / NUM_OPTS.demand;\r\n\r\n  return [demand, carryover, priority, regs, minflow];\r\n}\r\n\r\nexport default function ExamineView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n    camera,\r\n    addZoomHandler,\r\n    goals,\r\n    setGoals,\r\n  } = useContext(AppContext);\r\n\r\n  const activeMinidropsRef = useRef([]);\r\n  const previewMinidropRef = useRef(null);\r\n  const [panels, setPanels] = useState([]);\r\n\r\n  const [cameraChangeFlag, setCameraChangeFlag] = useState(false);\r\n\r\n  const mouseDownInfo = useRef({});\r\n\r\n  useEffect(function initialize() {\r\n    d3.select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"examine-group\");\r\n\r\n    addZoomHandler(function () {\r\n      setCameraChangeFlag((f) => !f);\r\n    });\r\n\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current = {};\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"ExamineView\")) {\r\n        const transitionDelay = state.transitionDuration;\r\n        const container = d3.select(\"#examine-group\");\r\n        const minidrops = waterdrops.groups.find(\r\n          (g) => g.key === activeWaterdrops[0]\r\n        );\r\n\r\n        updateSmallDropSVG(container, minidrops, transitionDelay / 2, {\r\n          onClick: updateActiveMinidrops,\r\n          onHover: hoverDrop,\r\n          onUnhover: unhoverDrop,\r\n        });\r\n\r\n        setGoBack(() => () => {\r\n          setState({ state: \"WideView\" });\r\n\r\n          resetCamera();\r\n        });\r\n\r\n        return function exitState() {\r\n          removeElems(\".small-drop, .circlet\", container);\r\n\r\n          setPanels([]);\r\n          activeMinidropsRef.current = [];\r\n          previewMinidropRef.current = null;\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  function addDetailPanel(dropId) {\r\n    const { globalX, globalY, x, y, id, key } = waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      const newPanel = {\r\n        text: key.slice(4),\r\n        x: globalX + x * (SPREAD_1_2 - 1),\r\n        y: globalY + y * (SPREAD_1_2 - 1),\r\n        offsetX: 20,\r\n        offsetY: 40,\r\n        id,\r\n      };\r\n\r\n      return [...p, newPanel];\r\n    });\r\n  }\r\n\r\n  function removeDetailPanel(dropId) {\r\n    const { id } = waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      arrRemove(p, id);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function updateActiveMinidrops(d) {\r\n    const container = d3.select(\"#examine-group\");\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      arrRemove(activeMinidropsRef.current, d.id);\r\n      container.select(\".circlet.i\" + d.id).classed(\"active\", false);\r\n\r\n      removeDetailPanel(d.id);\r\n    } else {\r\n      activeMinidropsRef.current.push(d.id);\r\n      container.select(\".circlet.i\" + d.id).classed(\"active\", true);\r\n\r\n      addDetailPanel(d.id);\r\n    }\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    if (!activeMinidropsRef.current.includes(d.id)) {\r\n      previewMinidropRef.current = d.id;\r\n      addDetailPanel(d.id);\r\n    }\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    if (previewMinidropRef.current === d.id) {\r\n      previewMinidropRef.current = null;\r\n      removeDetailPanel(d.id);\r\n    }\r\n  }\r\n\r\n  function onPanelDragStart(e, id) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function getStyle(x, y, offsetX, offsetY) {\r\n    return {\r\n      left: `${x * camera.curTransform.k + camera.curTransform.x + offsetX}px`,\r\n      top: `${y * camera.curTransform.k + camera.curTransform.y + offsetY}px`,\r\n    };\r\n  }\r\n\r\n  if (isState(state, \"ExamineView\")) {\r\n    return (\r\n      <>\r\n        <h1 className=\"examine-large-label\">\r\n          {DESCRIPTIONS_DATA[activeWaterdrops[0]].display_name ||\r\n            DESCRIPTIONS_DATA[activeWaterdrops[0]].id}\r\n        </h1>\r\n        {panels.map(({ text, x, y, id, offsetX, offsetY }) => (\r\n          <div\r\n            className=\"panel examine-panel\"\r\n            key={id}\r\n            style={getStyle(x, y, offsetX, offsetY)}\r\n            onMouseDown={(e) => onPanelDragStart(e, id)}\r\n          >\r\n            <div className=\"panel-tab\">\r\n              scenario <span>{text}</span>\r\n            </div>\r\n            <DotHistogram\r\n              width={300}\r\n              height={200}\r\n              data={FLATTENED_DATA[id].deliveries}\r\n              goal={goals[activeWaterdrops[0]]}\r\n              setGoal={(newGoal) => {\r\n                setGoals((g) => {\r\n                  g[activeWaterdrops[0]] = newGoal;\r\n                  return { ...g };\r\n                });\r\n              }}\r\n            />\r\n            <SceneSettings settings={deserialize(text)} />\r\n          </div>\r\n        ))}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nconst ABBREVS = [\"D\", \"C\", \"P\", \"R\", \"M\"];\r\nconst FULLS = [\"Demand\", \"Carryover\", \"Priority\", \"Regs.\", \"Min. Flow\"];\r\nconst VAL_STEPS = [\r\n  [1, 0.9, 0.8, 0.7, 0.6], // demand\r\n  [1.0, 1.2, 1.3], // carryover\r\n  [0, 1], // priority\r\n  [1, 2, 3, 4], // regs\r\n  [0, 0.4, 0.6, 0.7, 0.8], // minflow\r\n];\r\n\r\nfunction SceneSettings({ settings }) {\r\n  return (\r\n    <div className=\"scen-settings\">\r\n      <div className=\"condense\">\r\n        {settings.map((s, i) => (\r\n          <div className=\"sett-dot-wrapper\" key={i}>\r\n            <span>{ABBREVS[i]}</span>\r\n            {d3.range(s + 1).map((i) => (\r\n              <span className=\"sett-dot\" key={i}></span>\r\n            ))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"full\">\r\n        <div className=\"full-container\">\r\n          <span>The settings for this scenario are:</span>\r\n          {settings.map((v, i) => (\r\n            <div className=\"full-card\" key={i}>\r\n              <span>{FULLS[i]}</span>\r\n              <span>{VAL_STEPS[i][v]}</span>\r\n              <div className=\"sett-dot-wrapper\">\r\n                {d3.range(v + 1).map((i) => (\r\n                  <span className=\"sett-dot\" key={i}></span>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, {\r\n  useContext,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  useMemo,\r\n  useRef,\r\n} from \"react\";\r\nimport { Scrollama, Step } from \"react-scrollama\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { isState } from \"utils/misc-utils\";\r\n\r\nimport BucketGlyph from \"bucket-lib/BucketGlyph\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport WaterdropGlyph from \"components/WaterdropGlyph\";\r\nimport { hideElems, showElems } from \"utils/render-utils\";\r\nimport {\r\n  BAR_CHART_HEIGHT,\r\n  DEFAULT_DELIVS,\r\n  DEFAULT_INTERPER,\r\n  INTERP_COLOR,\r\n  VARIATIONS_DELIVS,\r\n  VARIATIONS_INTERPERS,\r\n  useTutorialGraph,\r\n  useTutorialState,\r\n  useTutorialComparer,\r\n  DROP_VARIATIONS,\r\n} from \"utils/tutorialview-utils\";\r\n\r\nexport default function TutorialView() {\r\n  const { state, setState, waterdrops, camera } = useContext(AppContext);\r\n\r\n  const {\r\n    userGoal,\r\n    setUserGoal,\r\n    bucketInterper,\r\n    setBucketInterper,\r\n    dropInterper,\r\n    setDropInterper,\r\n    variationInterpers,\r\n    setVariationInterpers,\r\n  } = useTutorialState();\r\n\r\n  const { initGraphArea, initBars, condenseBars } = useTutorialGraph();\r\n  const { initComparer, introDrop2 } = useTutorialComparer();\r\n\r\n  const maxSlideReachedRef = useRef(-1);\r\n\r\n  useLayoutEffect(\r\n    function enterState() {\r\n      if (isState(state, \"TutorialView\")) {\r\n        hideElems(\r\n          \".bucket-wrapper, .vardrop, .vardroplabel, .vardrop .dot-histogram-wrapper, .main-histogram, .tut-comparer-graphics-wrapper\"\r\n        );\r\n\r\n        initGraphArea();\r\n        initComparer(waterdrops, camera);\r\n\r\n        return function exitState() {\r\n          hideElems(\".tutorial-view\");\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  const actions = useMemo(\r\n    () => ({\r\n      2: () => {\r\n        initBars();\r\n      },\r\n\r\n      4: () => {\r\n        condenseBars();\r\n      },\r\n\r\n      5: () => {\r\n        d3.select(\".bucket-wrapper\").style(\"display\", \"initial\");\r\n        d3.select(\"#tut-bar-graph\").attr(\"opacity\", 0);\r\n\r\n        setBucketInterper(() => DEFAULT_INTERPER);\r\n      },\r\n\r\n      6: () => {\r\n        setDropInterper(() => DEFAULT_INTERPER);\r\n      },\r\n\r\n      8: () => {\r\n        d3.selectAll(\".vardrop\")\r\n          .style(\"display\", \"initial\")\r\n          .classed(\"hasarrow\", true);\r\n      },\r\n\r\n      9: () => {\r\n        d3.selectAll(\".vardrop path\").style(\"stroke-dasharray\", \"none\");\r\n        setVariationInterpers(VARIATIONS_INTERPERS);\r\n      },\r\n\r\n      10: () => {\r\n        d3.selectAll(\".vardroplabel\").style(\"display\", \"block\");\r\n      },\r\n\r\n      11: () => {\r\n        d3.select(\".drop1\").classed(\"highlighted\", true);\r\n      },\r\n\r\n      12: () => {\r\n        d3.select(\".drop1\").classed(\"highlighted\", false);\r\n        d3.selectAll(\".vardrop\").classed(\"hasarrow\", false);\r\n\r\n        d3.selectAll(\".vardroplabel\").style(\"opacity\", \"0.5\");\r\n        d3.selectAll(\".vardroplabel, .scen-number\").style(\"color\", \"gray\");\r\n\r\n        d3.select(\".main-waterdrop\")\r\n          .transition()\r\n          .style(\"transform\", \"translateY(-100px) scale(0.5)\");\r\n        d3.selectAll(\".drop1 .waterdrop-wrapper, .drop3 .waterdrop-wrapper\")\r\n          .transition()\r\n          .style(\"transform\", \"translate(-50px, 15px) scale(0.5)\");\r\n        d3.selectAll(\".drop2 .waterdrop-wrapper, .drop4 .waterdrop-wrapper\")\r\n          .transition()\r\n          .style(\"transform\", \"translate(50px, 15px) scale(0.5)\");\r\n\r\n        d3.select(\".main-histogram\").style(\"display\", \"initial\");\r\n        d3.selectAll(\".vardrop .dot-histogram-wrapper\").style(\r\n          \"display\",\r\n          \"initial\"\r\n        );\r\n      },\r\n\r\n      13: () => {\r\n        hideElems(\".scrollama-2 .tut-drop-graphics-wrapper\");\r\n        showElems(\".scrollama-2 .tut-comparer-graphics-wrapper\");\r\n      },\r\n\r\n      15: () => {\r\n        introDrop2();\r\n      },\r\n    }),\r\n    []\r\n  );\r\n\r\n  const onStepEnter = async ({ data, direction }) => {\r\n    if (direction === \"up\") return;\r\n\r\n    if (data > maxSlideReachedRef.current) {\r\n      maxSlideReachedRef.current = data;\r\n      if (actions[data]) actions[data]();\r\n    }\r\n  };\r\n\r\n  if (!isState(state, \"TutorialView\")) return;\r\n\r\n  return (\r\n    <div className=\"tutorial-view\">\r\n      <div className=\"card1\">\r\n        <p>\r\n          <em>How much water do the people of California get?</em> For starters,\r\n          let's focus on the agriculture sector north of the delta.\r\n        </p>\r\n        <img\r\n          src=\"./northdelta.png\"\r\n          alt=\"Map of California with northern delta area highlighted\"\r\n        />\r\n        <button\r\n          className=\"skip-btn\"\r\n          onClick={() => setState({ state: \"WideView\" })}\r\n        >\r\n          Skip tutorial\r\n        </button>\r\n      </div>\r\n      <div className=\"scrollama scrollama-1\">\r\n        <div className=\"tut-graph-wrapper\">\r\n          <svg id=\"tut-bar-graph\"></svg>\r\n          <BucketGlyph\r\n            levelInterp={bucketInterper}\r\n            width={300}\r\n            height={BAR_CHART_HEIGHT}\r\n            colorInterp={INTERP_COLOR}\r\n          />\r\n        </div>\r\n        <Scrollama offset={0.5} onStepEnter={onStepEnter}>\r\n          <Step data={2}>\r\n            <div className=\"tut-text-card\">\r\n              This is the average yearly amount of water this group receives,\r\n              specifically from the <b>Central Valley Project</b>, one of two\r\n              water municipalities in California.\r\n            </div>\r\n          </Step>\r\n          <Step data={3}>\r\n            <div className=\"tut-text-card\">\r\n              Here, it is presented as a bar graph, with the bottom axis\r\n              representing the year and the side axis representing the amount of\r\n              water delivered in thousand acre-feet (TAF).\r\n            </div>\r\n          </Step>\r\n          <Step data={4}>\r\n            <div className=\"tut-text-card\">\r\n              We'll condense this bar graph into a single bar with a filled\r\n              gradient.\r\n            </div>\r\n          </Step>\r\n          <Step data={5}>\r\n            <div className=\"tut-text-card\" style={{ marginBottom: \"80vh\" }}>\r\n              What we get is a bucket of water showing which water levels are\r\n              most likely, with the darker areas being the most likely water\r\n              levels.\r\n            </div>\r\n          </Step>\r\n        </Scrollama>\r\n      </div>\r\n      <div className=\"scrollama scrollama-2\">\r\n        <div className=\"tut-drop-graphics-wrapper\">\r\n          <div className=\"main-waterdrop\">\r\n            <WaterdropGlyph\r\n              levelInterp={dropInterper}\r\n              width={400}\r\n              height={BAR_CHART_HEIGHT}\r\n              colorInterp={INTERP_COLOR}\r\n            />\r\n          </div>\r\n          <div className=\"main-histogram\">\r\n            <DotHistogram\r\n              width={210}\r\n              height={140}\r\n              data={DEFAULT_DELIVS}\r\n              goal={userGoal}\r\n              setGoal={(newGoal) => {\r\n                setUserGoal(newGoal);\r\n              }}\r\n            />\r\n          </div>\r\n          {DROP_VARIATIONS.map(({ idx, scen, clas, desc }) => (\r\n            <div className={`vardrop ${clas}`} key={idx} desc={desc}>\r\n              <WaterdropGlyph\r\n                levelInterp={variationInterpers[idx]}\r\n                width={400}\r\n                height={(BAR_CHART_HEIGHT * 2) / 3}\r\n                colorInterp={INTERP_COLOR}\r\n              />\r\n              <p className=\"vardroplabel\">\r\n                scenario <span className=\"scen-number\">{scen}</span>\r\n              </p>\r\n              <DotHistogram\r\n                shortForm\r\n                width={210}\r\n                height={140}\r\n                data={VARIATIONS_DELIVS[idx]}\r\n                goal={userGoal}\r\n                setGoal={(newGoal) => {\r\n                  setUserGoal(newGoal);\r\n                }}\r\n              />\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <div className=\"tut-comparer-graphics-wrapper\">\r\n          <svg id=\"comparer-graphics\"></svg>\r\n        </div>\r\n        <Scrollama offset={0.5} onStepEnter={onStepEnter}>\r\n          <Step data={6}>\r\n            <div className=\"tut-text-card\">\r\n              Here it is as a drop of water. We see here that the lightest color\r\n              reaches the midpoint of the maximum water possible, meaning that\r\n              there is a chance 600 TAF of water will be delivered to this\r\n              group.\r\n            </div>\r\n          </Step>\r\n          <Step data={7}>\r\n            <div className=\"tut-text-card\">\r\n              The darker colors, however, indicate that it's more likely that\r\n              less than a quarter of the maximum, or around 300 TAF, will be\r\n              delivered. As we'll later see, this is not a lot compared to other\r\n              areas of California.\r\n            </div>\r\n          </Step>\r\n          <Step data={8}>\r\n            <div className=\"tut-text-card\">\r\n              But what if we could <em>change reality</em>? What if we could\r\n              increase the likelihood of delivering as much water as possible by\r\n              changing the way we manage it?\r\n            </div>\r\n          </Step>\r\n          <Step data={9}>\r\n            <div className=\"tut-text-card\">\r\n              Fortunately, we can explore those possibilities with the help of a\r\n              simulator called\r\n              <b> CalSim</b>.\r\n            </div>\r\n          </Step>\r\n          <Step data={10}>\r\n            <div className=\"tut-text-card\">\r\n              These variations are called <em>scenarios</em> and are labelled\r\n              with unique numbers.\r\n            </div>\r\n          </Step>\r\n          <Step data={11}>\r\n            <div className=\"tut-text-card\">\r\n              At a glance, we can easily see that scenario 0180 appears to be\r\n              the best scenario since the darker water levels reach higher than\r\n              those of the other scenarios. To more concretely compare these\r\n              scenarios, however, we'll use a different view.\r\n            </div>\r\n          </Step>\r\n          <Step data={12}>\r\n            <div className=\"tut-text-card\" style={{ marginBottom: \"120vh\" }}>\r\n              Try moving the red line to change the minimum demand and see how\r\n              well each of these scenarios meet those demands.\r\n            </div>\r\n          </Step>\r\n          <Step data={13}>\r\n            <div className=\"tut-text-card\">\r\n              We'll collect all the possible scenarios and sort them by their\r\n              average deliveries.\r\n            </div>\r\n          </Step>\r\n          <Step data={14}>\r\n            <div className=\"tut-text-card\">\r\n              So why don't we just choose the best scenario? Well, it's because\r\n              it's not just this group that wants water. Other groups, which we\r\n              call <em>objectives</em>, want scenarios that best fit{\" \"}\r\n              <em>them.</em>\r\n            </div>\r\n          </Step>\r\n          <Step data={15}>\r\n            <div className=\"tut-text-card\" style={{ marginBottom: \"120vh\" }}>\r\n              For example, the refuge group south of the delta. The scenarios\r\n              that benefit the agriculture group do not always benefit the\r\n              refuge group, and vice versa. Hover over the waterdrops to see how\r\n              the same scenarios place for each objective. (Can you find a\r\n              scenario that benefits both?)\r\n            </div>\r\n          </Step>\r\n        </Scrollama>\r\n      </div>\r\n      <div>\r\n        <div className=\"tut-text-card\">\r\n          Thus, tradeoffs must often be made when managing California's water\r\n          supply. What are the ways we can manage California's water, and how do\r\n          their outcomes compare? Go to the next step to find out!\r\n          <button\r\n            className=\"fancy-font\"\r\n            onClick={() => setState({ state: \"WideView\" })}\r\n          >\r\n            click to explore!\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useCallback, useContext, useEffect, useRef, useState } from \"react\";\r\nimport { BiCross, BiNetworkChart } from \"react-icons/bi\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { SPATIAL_FEATURES } from \"data/spatial-data\";\r\nimport { SPREAD_1_2 } from \"settings\";\r\nimport { dropsMesh, scene } from \"three-resources\";\r\n\r\nimport { avgCoords, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport {\r\n  drawMinimapSVG,\r\n  fadeOutDrops,\r\n  fontSizer,\r\n  updateLargeDropSVG,\r\n} from \"utils/wideview-utils\";\r\nimport { hideElems, showElems } from \"utils/render-utils\";\r\n\r\nexport default function WideView() {\r\n  const {\r\n    waterdrops,\r\n    state,\r\n    setState,\r\n    camera,\r\n    zoomTo,\r\n    setActiveWaterdrops,\r\n    activeWaterdrops,\r\n    setDisableCamAdjustments,\r\n    getOutlineOpacity,\r\n    addZoomHandler,\r\n  } = useContext(AppContext);\r\n\r\n  const [curScreenTransform, setCurScreenTransform] = useState({\r\n    zoom: 1,\r\n    mouseX: 0,\r\n    mouseY: 0,\r\n  });\r\n\r\n  const [currentHoveredDrop, setCurrentHoveredDrop] = useState(null);\r\n\r\n  const enableZoomRef = useRef(false);\r\n  const activeDropsRef = useRef([]);\r\n\r\n  useEffect(function initialize() {\r\n    initSVGGraphics();\r\n\r\n    const cleanup = registerEventListeners();\r\n\r\n    drawMinimapSVG();\r\n\r\n    return cleanup;\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"WideView\")) {\r\n        d3.select(\"body\").style(\"overflow\", \"hidden\");\r\n\r\n        enableZoomRef.current = true;\r\n        setCurScreenTransform((cst) => ({\r\n          ...cst,\r\n          zoom: camera.curTransform.k,\r\n        }));\r\n\r\n        drawTHREEGraphics();\r\n        drawSVGGraphics();\r\n\r\n        showElems(\"#infobox, #mosaic-webgl, #mosaic-svg\");\r\n\r\n        return function exitState() {\r\n          hideElems(\"#infobox, #wide-group .large-drop\");\r\n\r\n          enableZoomRef.current = false;\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateFontSizes() {\r\n      if (enableZoomRef.current) {\r\n        d3.select(\"#wide-group\")\r\n          .selectAll(\"text\")\r\n          .each(fontSizer(curScreenTransform, camera, waterdrops.height));\r\n      }\r\n    },\r\n    [curScreenTransform]\r\n  );\r\n\r\n  const handleClick = useCallback(function () {\r\n    const willExamineDrop = activeDropsRef.current.length === 1;\r\n    const willCompareDrops = activeDropsRef.current.length > 1;\r\n\r\n    if (willExamineDrop) {\r\n      changeToExamineView();\r\n    } else if (willCompareDrops) {\r\n      changeToCompareView();\r\n    }\r\n  }, []);\r\n\r\n  function initSVGGraphics() {\r\n    hideElems(\"#infobox, #mosaic-webgl, #mosaic-svg\");\r\n\r\n    d3.select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"wide-group\");\r\n  }\r\n\r\n  function registerEventListeners() {\r\n    const cameraListener = (transform) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        zoom: transform.k,\r\n      }));\r\n    };\r\n\r\n    const mouseListener = (e) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        mouseX: e.x,\r\n        mouseY: e.y,\r\n      }));\r\n    };\r\n\r\n    addZoomHandler(cameraListener);\r\n    window.addEventListener(\"mousemove\", mouseListener);\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener(\"mousemove\", mouseListener);\r\n    };\r\n  }\r\n\r\n  function drawTHREEGraphics() {\r\n    console.time(\"drawing\");\r\n    dropsMesh.draw(scene);\r\n    console.timeEnd(\"drawing\");\r\n\r\n    dropsMesh.updateVisibility(1);\r\n    dropsMesh.updateOutlineVisibility(getOutlineOpacity(camera.curTransform.k));\r\n  }\r\n\r\n  function drawSVGGraphics() {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    updateLargeDropSVG(container, waterdrops, {\r\n      onClick: updateActiveDrops,\r\n      onHover: hoverDrop,\r\n      onUnhover: unhoverDrop,\r\n    });\r\n\r\n    for (const wd of activeDropsRef.current) {\r\n      container.select(\".circlet.\" + wd.key).classed(\"active\", true);\r\n    }\r\n  }\r\n\r\n  function updateActiveDrops(d) {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    setActiveWaterdrops((aw) => {\r\n      if (aw.includes(d.key)) {\r\n        aw = arrRemove(aw, d.key);\r\n        activeDropsRef.current = arrRemove(activeDropsRef.current, d);\r\n\r\n        container.select(\".circlet.\" + d.key).classed(\"active\", false);\r\n      } else {\r\n        aw.push(d.key);\r\n        activeDropsRef.current.push(d);\r\n\r\n        container.select(\".circlet.\" + d.key).classed(\"active\", true);\r\n      }\r\n      return [...aw];\r\n    });\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    setCurrentHoveredDrop({\r\n      id: d.key,\r\n      description: DESCRIPTIONS_DATA[d.key].desc,\r\n    });\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"gray\");\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    setCurrentHoveredDrop(null);\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"transparent\");\r\n  }\r\n\r\n  function changeToExamineView() {\r\n    setDisableCamAdjustments(true);\r\n\r\n    const { x, y, height } = activeDropsRef.current[0];\r\n\r\n    const newCamPos = [\r\n      x,\r\n      y - dropCenterCorrection({ height }),\r\n      camera.getZFromFarHeight(height * SPREAD_1_2 * 1.5),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    setState({ state: \"ExamineView\", transitionDuration });\r\n\r\n    const startOpacity = getOutlineOpacity(camera.curTransform.k);\r\n    fadeOutDrops(dropsMesh, scene, startOpacity, transitionDuration / 2);\r\n  }\r\n\r\n  function changeToCompareView() {\r\n    setDisableCamAdjustments(true);\r\n\r\n    const dropsMidpoint = avgCoords(\r\n      activeDropsRef.current.map((w) => [w.x, w.y])\r\n    );\r\n\r\n    const newCamPos = [\r\n      ...dropsMidpoint,\r\n      camera.getZFromFarHeight(\r\n        waterdrops.groups[0].height * 2 * SPREAD_1_2 * 0.75 * 2\r\n      ),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    setState({\r\n      state: \"CompareView\",\r\n      transitionDuration,\r\n      viewCenter: dropsMidpoint,\r\n    });\r\n\r\n    const startOpacity = getOutlineOpacity(camera.curTransform.k);\r\n    fadeOutDrops(dropsMesh, scene, startOpacity, transitionDuration / 5);\r\n  }\r\n\r\n  let examineBtn, compareBtn;\r\n\r\n  if (isState(state, \"WideView\") && activeWaterdrops.length) {\r\n    if (activeWaterdrops.length === 1) {\r\n      examineBtn = (\r\n        <button\r\n          onClick={handleClick}\r\n          className=\"wide-view-action-btn fancy-font\"\r\n        >\r\n          <BiCross />\r\n          <span>examine</span>\r\n        </button>\r\n      );\r\n    } else {\r\n      compareBtn = (\r\n        <button\r\n          onClick={handleClick}\r\n          className=\"wide-view-action-btn fancy-font\"\r\n        >\r\n          <BiNetworkChart />\r\n          <span>compare</span>\r\n        </button>\r\n      );\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div id=\"infobox\">\r\n        <svg id=\"minimap\"></svg>\r\n        {currentHoveredDrop && (\r\n          <div className=\"details\">\r\n            {!SPATIAL_FEATURES[currentHoveredDrop.id] && (\r\n              <p className=\"no-loc-data\">No Location Data</p>\r\n            )}\r\n            <p className=\"curDesc\">{currentHoveredDrop.description}</p>\r\n            <p className=\"curKey\">\r\n              id: <span> {currentHoveredDrop.id} </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n      {examineBtn}\r\n      {compareBtn}\r\n    </>\r\n  );\r\n}\r\n"],"names":["waterdrops","initWaterdrops","appWidth","window","innerWidth","appHeight","innerHeight","App","state","setState","stateRef","useStateRef","zoomCallbacks","setZoomCallbacks","zoomCallbacksRef","activeWaterdrops","setActiveWaterdrops","useState","goBack","setGoBack","disableCamAdjustments","setDisableCamAdjustments","disableCamAdjustmentsRef","goals","setGoals","goalMap","i","OBJECTIVE_IDS","length","getOutlineOpacity","useCallback","d3","domain","height","groups","range","clamp","useEffect","document","querySelector","appendChild","renderer","domElement","attr","camera","mount","node","select","setZoomFn","transform","current","dropsMesh","updateOutlineVisibility","k","cb","setSize","setAnimationLoop","render","scene","resetCamera","animated","arguments","undefined","callback","pos","getZFromFarHeight","start","zoomTo","callZoomFromWorldViewport","worldX","worldY","farHeight","xyz","interpolateZoomCamera","duration","t","elapsed","et","Math","min","callZoom","stop","addZoomHandler","cbs","_jsxs","AppContext","Provider","value","pointsMesh","children","className","_jsx","id","TutorialView","WideView","ExamineView","CompareView","onClick","console","time","createMesh","timeEnd","createContext","DEGREE_SWAY","LEVELS","LINE_WIDTH","BucketGlyph","_ref","levelInterp","colorInterp","interpolateWatercolorBlue","width","resolution","useId","svgSelector","useRef","liquidLevels","useMemo","ticksExact","map","d","prevLiquidLevels","usePrevious","useLayoutEffect","svgContainer","append","concat","bucketPath","split","liquids","selectAll","data","join","_","transition","ease","period","delay","attrTween","diff","abs","sin","PI","ref","e","getQuantileBins","unitsPerQuantile","numQuantiles","histBins","thresholds","ceil","binnedQuantiles","quantileBins","quantiles","b","y","push","x1","x0","count","filled","taper","bottomRight","bottomLeft","x","lineFunc","numericBins","maxQuantiles","bin","round","sum","Infinity","isEqualFunc","prev","NUM_CIRCLES","MARGIN","top","right","bottom","left","DOMAIN","MAX_DELIVS","WATERDROP_ICON","draw","context","size","moveTo","lineTo","arc","SQRT2","closePath","DotHistogram","goal","setGoal","shortForm","razorID","floor","random","razorAreaID","circles","dataRange","filter","style","call","scale","tickFormat","s","text","razor","ignoreFn","preventDefault","dragging","addEventListener","removeEventListener","target","max","offsetX","svgCircles","enter","WaterdropGlyph","_ref2","dropD","points","waterdropDeltaOutline","dropPath","DROP_RAD","DROP_HEIGHT","DESCRIPTIONS_DATA","async","objs","fetch","json","log","mapBy","SCEN_DIVISOR","SCENARIO_KEY_STRING","DELIV_KEY_STRING","OBJECTIVES_DATA","obj","scen","unord","v","Array","from","sort","a","name","Object","keys","SCENARIO_IDS","values","FLATTENED_DATA","DATA_GROUPINGS","flattenedData","dataGroupings","objective","scenario","means","idx","deliveries","orderedDataGroupings","criteria","objScens","key","ids","sortedObjScens","sorted","mean","flat","IDtoRank","j","rank","SPATIAL_DATA","SPATIAL_FEATURES","features","properties","CalLiteID","CALIFORNIA_OUTLINE","CALIFORNIA_CENTER","LOD_1_LEVELS","LOD_1_RAD_PX","LOD_1_MIN_LEV_VAL","LOD_1_SMALL_DROP_PAD_FACTOR","LOD_1_LARGE_DROP_PAD_FACTOR","GROUP_HOVER_AREA_FACTOR","SQRT1_2","SPREAD_1_2","THREE","background","WaterdropMesh","WaterdropSimplifiedMesh","Camera","fov","near","far","antialias","grouping","groupKeys","memberKeys","amtPerGroup","largeDropRad","sqrt","smallDropRad","largeNodesPhys","placeDropsUsingPhysics","p","r","tilt","largeNodesPos","smallNodesPhys","smallNodesPos","nodes","groupNodes","groupToNodes","nodeData","createInterpsFromDelivs","levs","w","groupID","memberID","groupRank","memberRank","localTilt","parentTilt","rotatedX","rotatedY","rotatePoint","maxLev","domLev","calcDomLev","dur","group","globalX","globalY","globalTilt","groupKey","getWaterdropGroups","keyArr","center","find","g","groupPositions","rad","n","angle","cos","smallDropUpdate","each","actI","this","dropBBox","getBBox","gradientInit","stops","forEach","smallDropInit","randId","genUUID","DROPLET_SHAPE","textUpdate","remove","wrap","display_name","line","largeDropInit","_ref3","largeDropUpdate","_ref4","_ref5","updateDropsSVG","container","waterdropGroups","transitionDelay","_ref6","onHover","onUnhover","_ref7","on","_ref8","calcLinesAndPositions","groupsObj","activeMinidropKey","positions","groupPos","dropCenterCorrection","lines","to","clipEnds","delivs","maxDelivs","circlet","valOffset","gradientUpdate","updateSmallDropSVG","waterdropGroup","classed","generateWaterdrop","delta","outer","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","reuse","shape","bounds","Matter","create","minX","maxX","minY","maxY","genX","genY","contains","generateRandoPoints","WIDTH_AREA","AREA","radsToDropWidth","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","nx","ny","circle","restitution","parts","quad","position","centre","vertices","isStatic","cage","setParts","setCentre","add","world","FPS","SECS","update","retVal","CIRC_RAD","toRadians","dist","y1","x2","y2","distSq","getCenterDomRect","domRect","_ref9","shortenBy","len","normed","_ref10","dropRadToDropHeight","avgCoords","c","deg","vec","applyEuler","rotatePoints","arr","newPoint","fn","newObjs","groupBy","sortBy","array","object","path","defaultValue","_object","part","get","pick","va","vb","val","_setState","curVal","isState","stateInfo","stateName","replace","arrRemove","item","splice","findIndex","indexOf","copyCoords","CIRC_HEIGHT","HAT_START","yToHalfWidth","trigX","acos","yToSpriteY","spriteYToY","sy","yStart","yEnd","subdivs","Y_DELTA","rightCoords","leftCoords","dx1","dy1","dx2","dy2","v1","v2","v3","v4","reverse","waterdropDelta","MeshGeometry","constructor","numPoints","color","threeGeom","triangleIdx","setAttribute","Float32Array","positionAttribute","getAttribute","colorAttribute","addMeshCoords","meshCoords","z","rotate","setXYZ","finish","setDrawRange","added","updateMeshes","initializeMeshes","outlineMesh","dropsGeometry","MAX_POINTS_DROPS","outlinePoints","outlineMeshCoords","rotOutline","dx","dy","vertexColors","transparent","opacity","setFromPoints","opac","material","needsUpdate","updateVisibility","MAX_POINTS_OUTLINE","vertToId","idToVert","mesh","initializeMesh","updateMesh","pointsGeometry","colors","t_color","pointsMaterial","sizeAttenuation","load","positionAttr","geometry","newX","newY","setXY","updatePoints","translations","dt","verts","setX","setY","verticesNeedUpdate","intersectObject","intersects","intersect","index","raycaster","zoomFn","zoom","curTransform","_THREEZoomHandler","_svgElement","view","translate","tan","getFarHeightFromZ","endx","endy","endz","interper","webglElement","svgElement","scaleExtent","getScaleFromZ","set","getZFromScale","camera_z_position","half_fov","half_fov_radians","fov_height","mouseX","mouseY","setFromCamera","showElems","elemStr","hideElems","removeElems","INTERP_COLOR","NUM_OPTS","demand","carryover","priority","regs","minflow","DEFAULT_OBJECTIVE","DEFAULT_SCENARIO","DEFAULT_DELIVS","serialize","COMP_OBJECTIVE","VARIATIONS","VARIATIONS_DELIVS","vars","VARIATIONS_INTERPERS","varDelivs","DEFAULT_INTERPER","BAR_CHART_WIDTH","BAR_CHART_HEIGHT","BAR_CHART_MARGIN","code","useTutorialState","userGoal","setUserGoal","bucketInterper","setBucketInterper","dropInterper","setDropInterper","variationInterpers","setVariationInterpers","useTutorialGraph","d3Refs","initGraphArea","svgGroup","dataDescending","yearlyData","placeFromLeft","year","padding","xaxis","tickSize","tickValues","initBars","bandwidth","condenseBars","newWidth","bars","end","useTutorialComparer","activeMinidrop","setActiveMinidrop","groupsRef","camCentersRef","textX","textY","smallTextSize","largeTextSize","slice","updateLabel","updateScenIndicators","initComparer","camMidpoint","camFirstDrop","firstDrop","midpoint","indicatorGroup","introDrop2","DROP_VARIATIONS","clas","desc","interactorsInit","textGroup","interactorsUpdate","dropTransform","updateLargeDropSVG","parentNode","drawMinimapSVG","minimap","proj","lineGeom","f","type","pointGeom","projection","coordinates","getFontSize","transformZoom","cameraHeight","waterdropsHeight","MAX_RAD","zoomRel","_d","fontSizer","transformInfo","tNode","posx","posy","getBoundingClientRect","dis","fadeOutDrops","startOpac","useContext","panels","setPanels","centerRef","mouseDownInfo","cameraChangeFlag","setCameraChangeFlag","getStyle","offsetY","startX","deltaX","deltaY","startY","oldOffsetX","oldOffsetY","viewCenter","transitionDuration","setTimeout","ox","oy","isLeft","centerX","centerY","correctionX","getIdealGroupPos","nodeID","fromNodes","_Fragment","onMouseDown","clientX","clientY","onPanelDragStart","newGoal","deserialize","scenStr","scenNum","parseInt","activeMinidropsRef","previewMinidropRef","addDetailPanel","dropId","removeDetailPanel","updateActiveMinidrops","includes","hoverDrop","unhoverDrop","minidrops","SceneSettings","settings","ABBREVS","FULLS","VAL_STEPS","maxSlideReachedRef","actions","onStepEnter","direction","src","alt","Scrollama","offset","Step","marginBottom","curScreenTransform","setCurScreenTransform","currentHoveredDrop","setCurrentHoveredDrop","enableZoomRef","activeDropsRef","cleanup","mouseListener","ti","registerEventListeners","cst","updateActiveDrops","wd","drawSVGGraphics","handleClick","willExamineDrop","willCompareDrops","newCamPos","startZoom","startOpacity","changeToExamineView","dropsMidpoint","changeToCompareView","aw","description","examineBtn","compareBtn","BiCross","BiNetworkChart"],"sourceRoot":""}