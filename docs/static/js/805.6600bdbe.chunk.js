"use strict";(self.webpackChunkcoeqwal_website=self.webpackChunkcoeqwal_website||[]).push([[805],{805:(t,e,s)=>{s.a(t,(async(t,n)=>{try{s.r(e),s.d(e,{default:()=>w});var r=s(437),a=s(43),o=s(96),i=s(956),c=s(251),l=s(313),h=s(621),d=s(293),u=s(68),p=s(579),g=t([c,l,h]);[c,l,h]=g.then?(await g)():g;const m=(0,c.c)("objective"),v=window.innerWidth,y=window.innerHeight;function w(){const[t,e,s]=(0,i.iJ)({}),[n,c,g]=(0,i.iJ)([]),[f,w]=(0,a.useState)([]),[x,b]=(0,a.useState)(null),[k,M,L]=(0,i.iJ)(!1),A=(0,a.useCallback)(r.m4Y().domain([y/m.height,y/m.groups[0].height]).range([.1,1]).clamp(!0),[]);(0,a.useEffect)((function(){document.querySelector("#mosaic-webgl").appendChild(u.Uk.domElement),r.Ltv("#mosaic-svg").attr("width",v).attr("height",y).append("g").attr("class","svg-trans"),u.UI.mount(r.Ltv(".bubbles-wrapper").node(),r.Ltv("#mosaic-svg").select(".svg-trans").node()),u.UI.setZoomFn((t=>{L.current||u.Q7.updateOutlineVisibility(A(t.k));for(const e of g.current)e(t)})),u.UI.setSize(v,y),u.Uk.setAnimationLoop((()=>{u.Uk.render(u.JH,u.UI.camera)})),C(!1),e({state:"WideView"})}),[]);const C=(0,a.useCallback)((function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;const s=[0,.08*-m.height,u.UI.getZFromFarHeight(m.height)];if(t){const{start:t}=j(s,e);t()}else u.UI.callZoomFromWorldViewport({worldX:s[0],worldY:-s[1],farHeight:m.height}),e&&e()}),[]),j=(0,a.useCallback)(((t,e)=>{const s=u.UI.interpolateZoomCamera(t),n=s.duration/2;return{start:()=>{const t=r.O1W((r=>{const a=Math.min(r/n,1);u.UI.callZoom(s(a)),1===a&&(t.stop(),e&&e())}))},duration:n}}),[]),B=(0,a.useCallback)((t=>{c((e=>[...e,t]))}),[]);return(0,p.jsxs)(o.B.Provider,{value:{appWidth:v,appHeight:y,state:t,setState:e,activeWaterdrops:f,setActiveWaterdrops:w,setDisableCamAdjustments:M,waterdrops:m,scene:u.JH,camera:u.UI,renderer:u.Uk,pointsMesh:u.XA,dropsMesh:u.Q7,setGoBack:b,zoomTo:j,resetCamera:C,getOutlineOpac:A,addZoomHandler:B},children:[(0,p.jsxs)("div",{className:"bubbles-wrapper",children:[(0,p.jsx)("div",{id:"mosaic-webgl"}),(0,p.jsx)("svg",{id:"mosaic-svg"})]}),(0,p.jsx)(l.A,{}),(0,p.jsx)(h.A,{}),(0,p.jsx)(d.A,{}),x&&(0,p.jsx)("button",{className:"go-back-btn",onClick:x,children:"\u2190"})]})}u.Uk.setSize(v,y),console.time("drops mesh creating"),u.Q7.createMesh(m),console.timeEnd("drops mesh creating"),n()}catch(f){n(f)}}))},96:(t,e,s)=>{s.d(e,{B:()=>n});const n=(0,s(43).createContext)({})},684:(t,e,s)=>{s.d(e,{YW:()=>a,kd:()=>r});var n=s(437);s(43);function r(t,e,s){return n.y17(s).map((n=>n/(s-1)*(e-t)+t))}const a=t=>n.dM(n.m4Y([.2,1])(t))},693:(t,e,s)=>{s.a(t,(async(t,n)=>{try{s.d(e,{R:()=>t});var r=s(956);const t=await async function(){const t=await(await fetch("./descriptions.json")).json();return console.log("DATA: loading descriptions data"),(0,r.Et)(t,(t=>{let{id:e}=t;return e}))}();n()}catch(a){n(a)}}),1)},58:(t,e,s)=>{s.a(t,(async(t,n)=>{try{s.d(e,{ZS:()=>d,pk:()=>i,uV:()=>u,vR:()=>p,wP:()=>g});var r=s(437),a=s(550),o=s(956);const t=1,i=1200,c="scens",l="delivs",h=await async function(){const t=await(await fetch("./objectives.json")).json();for(const e of t){e[c]=e[c];for(const t of e[c]){const e=t[l].map((t=>(0,a.qE)(t,0,i)));t[l]=Array.from(e).sort(((t,e)=>e-t))}e[c]=(0,o.Et)(e[c],(t=>{let{name:e}=t;return e}))}return console.log("DATA: loading objectives data"),(0,o.Et)(t,(t=>{let{obj:e}=t;return e}))}(),d=Object.keys(h),u=Object.keys(Object.values(h)[0][c]).filter(((e,s)=>s%t===0)),[p,g]=function(){const t=[],e={objective:{},scenario:{}},s=[];let n=0;for(const o of d)for(const a of u){e.objective[o]||(e.objective[o]=[]),e.scenario[a]||(e.scenario[a]=[]),e.objective[o].push(n),e.scenario[a].push(n);const i=h[o][c][a][l];t.push({id:n,objective:o,scenario:a,deliveries:i}),s.push(r.i2o(i)),n++}const a={};for(const o of Object.keys(e)){const n=[];for(const a of Object.keys(e[o])){const i=e[o][a],c=i.sort(((t,e)=>s[e]-s[t]));n.push({key:a,sorted:c,mean:r.i2o(i.map((e=>t[e].deliveries)).flat())})}const i=n.sort(((t,e)=>e.mean-t.mean));a[o]={};for(let t=0;t<i.length;t++){const{key:e,sorted:s}=i[t],n={};for(let t=0;t<s.length;t++)n[s[t]]=t;a[o][e]=n,a[o][e].rank=t}}return[t,a]}();n()}catch(i){n(i)}}),1)},385:(t,e,s)=>{s.d(e,{B0:()=>l,Kn:()=>n,N7:()=>h,h4:()=>a,iP:()=>i,pC:()=>c,sU:()=>o,w5:()=>r});const n=5,r=3,a=5,o=1,i=.1,c=1.3,l=1.2,h=1.1/(1+Math.SQRT1_2)},68:(t,e,s)=>{s.d(e,{JH:()=>a,Q7:()=>o,UI:()=>c,Uk:()=>l,XA:()=>i});var n=s(408),r=(s(437),s(972));const a=function(){const t=new n.Z58;return t.background=new n.Q1f(15724527),t}(),o=new r.e8,i=new r._9,c=new r.i7({fov:45,near:1,far:3e3}),l=new n.JeP({antialias:!0})},251:(t,e,s)=>{s.a(t,(async(t,n)=>{try{s.d(e,{c:()=>u});var r=s(684),a=s(385),o=s(58),i=s(152),c=s(550),l=s(956),h=t([o,i]);function u(t){const e="objective"===t?o.ZS:o.uV,s="objective"===t?o.uV:o.ZS,n=(e.length,s.length),h=Math.sqrt(n/Math.PI)*a.sU*2*a.pC*a.B0,d=a.sU*a.pC,u=(0,c.hh)(0,0,e.map(((t,e)=>({r:h,id:e})))),p=(0,l.Et)(u,(t=>{let{id:e}=t;return e})),g=(0,c.hh)(0,0,s.map(((t,e)=>({r:d,id:e})))),f=(0,l.Et)(g,(t=>{let{id:e}=t;return e})),m=[],v=[],y={};for(const c of o.vR){const{id:e,objective:s,scenario:n,deliveries:l}=c,h=(0,i.Dy)(l,o.pk),d=(0,r.kd)(0,1,a.h4+1).map((t=>h(t))).map(((t,e)=>Math.max(t,0==e?a.iP:0)*a.sU)),u="objective"===t?s:n,g="objective"===t?n:s,v=o.wP[t][u].rank,w=o.wP[t][u][e],x={id:e,levs:d,maxLev:a.sU,domLev:(0,i.Dq)(d),tilt:50*Math.random()-25,dur:100*Math.random()+400,x:f[w].x,y:f[w].y,group:u,key:g,globalX:p[v].x+f[w].x,globalY:p[v].y+f[w].y};m.push(x),y[u]||(y[u]=[]),y[u].push(x)}for(const r of e)v.push({x:p[o.wP[t][r].rank].x,y:p[o.wP[t][r].rank].y,tilt:50*Math.random()-25,key:r,height:g.height,nodes:y[r]});return{nodes:m,groups:v,height:u.height}}[o,i]=h.then?(await h)():h,n()}catch(d){n(d)}}))},152:(t,e,s)=>{s.a(t,(async(t,n)=>{try{s.d(e,{Dq:()=>h,Dy:()=>l});var r=s(437),a=s(684),o=s(58),i=t([o]);function l(t,e){return r.m4Y().domain((0,a.kd)(0,1,t.length)).range(t.map((t=>Math.min(1,t/e)))).clamp(!0)}function h(t){t=[1,...t,0];let e=0;for(let s=0;s<t.length-1;s++){e+=(t[s]-t[s+1])*(s-1)/(t.length+4)}return e}o=(i.then?(await i)():i)[0],n()}catch(c){n(c)}}))},550:(t,e,s)=>{s.d(e,{eh:()=>f,hh:()=>g,qE:()=>i});var n=s(437),r=s(783),a=s.n(r),o=s(972);function i(t,e,s){return Math.max(e,Math.min(s,t))}function c(t){const e=t/2,s=3*Math.PI/2/16,n=[{x:Math.cos(5*Math.PI/4)*e,y:Math.sin(5*Math.PI/4)*e},{x:0,y:-Math.SQRT2*e}];for(let r=0;r<=16;r++)n.push({x:Math.cos(r*s-Math.PI/4)*e,y:Math.sin(r*s-Math.PI/4)*e});return n}const l=function(){const t=c(3),e=c(1),s=[];for(let n=0;n<t.length-2;n++)s.push([t[n],t[n+(n<2?1:2)],e[n+(n<2?1:2)],e[n]]);return s}();let h,d,u,p;function g(t,e,s){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(r&&u&&s.length===p)return u;h&&s.length===d||(h=n.y17(4).map((()=>function(t,e){const s=a().Bounds.create(t),r=s.min.x,o=s.max.x,i=s.min.y,c=s.max.y,l=n.m4Y([r,o]),h=n.m4Y([i,c]),d=[];for(let n=0;n<e;n++)for(;;){const e=l(Math.random()),s=h(Math.random());if(a().Vertices.contains(t,{x:e,y:s})){d.push([e,s]);break}}return d}(c(1),d=s.length))));const i=function(t){const e=n.czq(t.map((t=>t**2*3.14)));return Math.floor(2*Math.sqrt(e/3.14)/2)}(s.map((t=>{let{r:e}=t;return e}))),g=h[Math.floor(Math.random()*h.length)].map((t=>{let[e,s]=t;return[e*i,s*i]})),f=a().Engine,m=a().Bodies,v=a().Composite,y=f.create(),w=g.sort(((t,e)=>e[1]-t[1])),x=s.map(((t,e)=>{let{r:s,id:n}=t;const[r,a]=w[e];return m.circle(r,a,s,{restitution:0,id:n})})),b=l.map((t=>a().Body.create({position:a().Vertices.centre(t),vertices:t,isStatic:!0}))),k=a().Body.create({isStatic:!0});a().Body.setParts(k,b),a().Body.setCentre(k,{x:0,y:0}),a().Body.scale(k,i,i),v.add(y.world,[...x,k]);for(let n=0,a=60,o=.1;n<a*o;n++)f.update(y,1e3/a);const M=x.map((s=>{let{position:n,id:r}=s;return{id:r,x:n.x+t,y:n.y+e}}));return M.height=i/2/o.Sz*o.IC,!r||u&&M.length===p||(u=M,p=M.length),M}function f(t){return t*Math.PI/180}},956:(t,e,s)=>{s.d(e,{Et:()=>r,Ul:()=>a,ad:()=>i,iJ:()=>o});var n=s(43);function r(t,e){const s=Object.groupBy(t,e);for(const n of Object.keys(s))s[n]=s[n][0];return s}function a(t,e){return e=function(t){return"string"===typeof t?e=>function(t,e,s){var n;const r=e.split(".");for(let a of r){if(!t)return s;t=t[a]}return null!==(n=t)&&void 0!==n?n:s}(e,t):t}(e),t.sort(((t,s)=>{const n=e(t),r=e(s);return n<r?-1:n>r?1:0}))}function o(t){const[e,s]=(0,n.useState)(t),r=(0,n.useRef)(t);(0,n.useEffect)((()=>{r.current=e}),[e]);const a=(0,n.useCallback)((t=>{s("function"===typeof t?e=>r.current=t(e):r.current=t)}),[]);return[e,a,r]}function i(t,e){return t&&t.state===e}},972:(t,e,s)=>{s.d(e,{IC:()=>p,Sz:()=>h,_9:()=>b,e8:()=>x,i7:()=>k,js:()=>l});var n=s(437),r=s(408),a=s(684),o=s(385),i=s(956),c=s(550);const l="M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z",h=Math.SQRT1_2,d=1,u=h+h,p=d+h,g=.75;function f(t){if(t>=g){return Math.SQRT1_2*(1-t)/(1-g)}const e=2*(1-t/(u/p))-1,s=Math.acos(e);return Math.sin(s)}function m(t){return(t-h/p)*(1+Math.SQRT2)}function v(t){return t/(1+Math.SQRT2)+h/p}function y(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(Math.abs(t-e)<.01)return[];const n=s/2/d*h,r=.1,a=[];let o,i,c,l;for(let h=1;h<=Math.ceil(10)&&(o=f(t+(h-1)*r),i=m(t+(h-1)*r),c=f(t+h*r),l=m(t+h*r),!(v(l)>=e));h++){const t=[-o*n,-i*n],e=[o*n,-i*n],s=[c*n,-l*n],r=[-c*n,-l*n];a.push([t,e,s]),a.push([t,s,r])}c=f(e),l=m(e);const u=[-o*n,-i*n],p=[o*n,-i*n],g=[c*n,-l*n],y=[-c*n,-l*n];return a.push([u,p,g]),a.push([u,g,y]),a}class w{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.threeGeom=new r.LoY,this.triangleIdx=0,this.threeGeom.setAttribute("position",new r.THS(new Float32Array(3*t),3)),e&&this.threeGeom.setAttribute("color",new r.THS(new Float32Array(3*t),3)),this.positionAttribute=this.threeGeom.getAttribute("position"),this.colorAttribute=this.threeGeom.getAttribute("color")}addMeshCoords(t,e,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(let r=0;r<t.length;r++){const[a,o,i]=t[r];this.positionAttribute.setXYZ(3*this.triangleIdx+0,e.x+a[0],e.y-a[1],n),this.positionAttribute.setXYZ(3*this.triangleIdx+1,e.x+o[0],e.y-o[1],n),this.positionAttribute.setXYZ(3*this.triangleIdx+2,e.x+i[0],e.y-i[1],n),s&&(this.colorAttribute.setXYZ(3*this.triangleIdx+0,s.r,s.g,s.b),this.colorAttribute.setXYZ(3*this.triangleIdx+1,s.r,s.g,s.b),this.colorAttribute.setXYZ(3*this.triangleIdx+2,s.r,s.g,s.b)),this.triangleIdx++}}finish(){this.threeGeom.setDrawRange(0,3*this.triangleIdx)}}class x{constructor(){this.added=!1}createMesh(t){this.dropsMesh?this.updateMeshes(t):this.initializeMeshes(t)}draw(t){this.added||(t.add(this.dropsMesh),t.add(this.outlineMesh),this.added=!0)}remove(t){this.added&&(t.remove(this.dropsMesh),t.remove(this.outlineMesh),this.added=!1)}initializeMeshes(t){const e=new w(x.MAX_POINTS_DROPS),s=[],n=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(Math.abs(t-e)<.01)return[];const n=s/2/d*h,r=.1,a=[],o=[];let i,c,l,u;for(let h=1;h<=Math.ceil(10)&&(i=f(t+(h-1)*r),c=m(t+(h-1)*r),l=f(t+h*r),u=m(t+h*r),!(v(u)>=e));h++){const t=[-i*n,-c*n],e=[i*n,-c*n],s=[l*n,-u*n],r=[-l*n,-u*n];a.push(e,s),o.push(t,r)}l=f(e),u=m(e);const p=[-i*n,-c*n],g=[i*n,-c*n],y=[l*n,-u*n],w=[-l*n,-u*n];return a.push(g,y),o.push(p,w),a.push(...o.reverse()),a}(0,1,2*o.sU*.975);for(let i=0;i<t.nodes.length;i++){const{id:c,globalX:l,globalY:h,levs:d,maxLev:u}=t.nodes[i];for(let t=d.length-1;t>=0;t--){const s=y((t!==d.length-1?d[t+1]:0)/u,d[t]/u,2*o.sU),n=new r.Q1f((0,a.YW)(t/o.h4));e.addMeshCoords(s,{x:l,y:-h},n,i%5/50+.02)}s.push(...n.map((t=>{let[e,s]=t;return new r.Pq0(l+e,-h-s,i%5/50+.01)})))}e.finish(),this.dropsMesh=new r.eaF(e.threeGeom,new r.V9B({vertexColors:!0,transparent:!0,opacity:1})),this.outlineMesh=new r.DXC((new r.LoY).setFromPoints(s),new r.mrM({color:13421772,transparent:!0,opacity:0}))}updateOutlineVisibility(t){this.outlineMesh&&(this.outlineMesh.material.opacity=t,this.outlineMesh.material.needsUpdate=!0)}updateVisibility(t){this.outlineMesh&&this.dropsMesh&&(this.outlineMesh.material.opacity=t,this.outlineMesh.material.needsUpdate=!0,this.dropsMesh.material.opacity=t,this.dropsMesh.material.needsUpdate=!0)}updateMeshes(t){}}x.MAX_POINTS_DROPS=78e5,x.MAX_POINTS_OUTLINE=52e5;class b{constructor(){this.added=!1,this.vertToId={},this.idToVert={}}draw(t){this.added||(t.add(this.mesh),this.added=!0)}remove(t){this.added&&(t.remove(this.mesh),this.added=!1)}createMesh(t){return this.mesh||this.initializeMesh(t),this.updateMesh(t),this.mesh}initializeMesh(t){const e=new r.LoY,s=[],n=[];for(let o=0;o<t.nodes.length;o++){const{id:e,globalX:i,globalY:c,levs:l,domLev:h}=t.nodes[o],d=h>0?(0,a.YW)(h):"white";s.push(i,-c,0);const u=new r.Q1f(d);n.push(u.r,u.g,u.b),this.vertToId[o]=e,this.idToVert[e]=o}const i=new r.BH$({size:2*o.sU,sizeAttenuation:!0,vertexColors:!0,map:(new r.Tap).load("drop.png"),transparent:!0});e.setAttribute("position",new r.THS(new Float32Array(s),3)),e.setAttribute("color",new r.THS(new Float32Array(n),3)),this.mesh=new r.ONl(e,i)}updateMesh(t){const e=this.mesh.geometry.getAttribute("position");for(let s=0;s<t.nodes.length;s++){const{id:n,globalX:r,globalY:a}=t.nodes[s],o=this.idToVert[n];e.setXY(o,r,-a)}e.needsUpdate=!0}updatePoints(t,e,s){const n=this.mesh.geometry.vertices;for(let r=0;r<t.nodes.length;r++){const{id:a}=t.nodes[r],o=this.idToVert[a],[i,c]=e[a],l=n[o].x,h=n[o].y;n[o].setX(l+s*i),n[o].setY(h-s*c)}this.mesh.geometry.verticesNeedUpdate=!0}intersectObject(t,e,s){const n=t.intersectObject(e,s,this.mesh);if(n[0]){const t=(0,i.Ul)(n,"distanceToRay")[0];return this.vertToId[t.index]}return null}}class k{constructor(t){let{fov:e,near:s,far:n}=t;this.raycaster=new r.tBo,this.fov=e,this.near=s,this.far=n}setZoomFn(t){this.zoom=n.s_O().on("zoom",(e=>{this.curTransform=e.transform,this._THREEZoomHandler(e.transform),n.Ltv(this._svgElement).attr("transform",e.transform),t&&t(e.transform)}))}callZoom(t){this.zoom.transform(this.view,n.GSI.translate(t.x,t.y).scale(t.k))}callZoomFromWorldViewport(t){let{worldX:e,worldY:s,farHeight:n}=t;const r=this.height/n,a=-e*r+this.width/2,o=s*r+this.height/2;this.callZoom({x:a,y:o,k:r})}getZFromFarHeight(t){return Math.tan((0,c.eh)(90-this.fov/2))*t/2}getFarHeightFromZ(t){return Math.tan((0,c.eh)(this.fov)/2)*t*2}interpolateZoomCamera(t){let[e,s,r]=t;const a=n.p7([this.camera.position.x,this.camera.position.y,this.height/this.curTransform.k],[e,-s,this.getFarHeightFromZ(r)]),o=t=>{const[e,s,n]=a(t),r=this.height/n;return{x:-e*r+this.width/2,y:s*r+this.height/2,k:r}};return o.duration=a.duration,o}mount(t,e){this.view=n.Ltv(t),this._svgElement=e}setSize(t,e){this.width=t,this.height=e,this.zoom=this.zoom.scaleExtent([this.getScaleFromZ(this.far),this.getScaleFromZ(this.near)]),this.camera=new r.ubm(this.fov,t/e,this.near,this.far+1),this.camera.position.set(0,0,this.far),this.view.call(this.zoom),this.zoom.transform(this.view,n.GSI.translate(this.width/2,this.height/2).scale(this.getScaleFromZ(this.far)))}_THREEZoomHandler(t){const e=t.k,s=-(t.x-this.width/2)/e,n=(t.y-this.height/2)/e,r=this.getZFromScale(e);this.camera.position.set(s,n,r)}getScaleFromZ(t){const e=this.fov/2,s=(0,c.eh)(e),n=2*(Math.tan(s)*t);return this.height/n}getZFromScale(t){const e=this.fov/2,s=(0,c.eh)(e);return this.height/t/(2*Math.tan(s))}intersectObject(t,e,s){return this.raycaster.setFromCamera({x:t,y:e},this.camera),this.raycaster.intersectObject(s)}}},293:(t,e,s)=>{s.d(e,{A:()=>h});var n=s(96),r=s(684),a=s(437),o=s(43),i=s(385),c=s(956),l=s(972);function h(){const{state:t,setState:e,setGoBack:s,camera:h,resetCamera:d,activeWaterdrops:u,waterdrops:p}=(0,o.useContext)(n.B),[g,f]=(0,o.useState)(),m=(0,o.useRef)();(0,o.useEffect)((()=>{if(g){const t=[];for(let n=0;n<m.current.groups.length;n++){const e=m.current.groups[n],s=m.current.groupPositions[n],r=e.nodes.find((t=>t.key===g));t.push([r.x*i.w5/i.pC+s[0],r.y*i.w5/i.pC+s[1]])}const e=[],s=2*i.sU;for(let n=0;n<t.length;n++){const r=Array.from(t[n]),a=Array.from(t[n+1==t.length?0:n+1]),o=Math.sqrt((r[0]-a[0])**2+(r[1]-a[1])**2),i=[(a[0]-r[0])/o,(a[1]-r[1])/o];r[0]+=i[0]*s,r[1]+=i[1]*s,a[0]-=i[0]*s,a[1]-=i[1]*s,e.push([r,a])}a.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compCirclet").data(t).join("circle").attr("class","compCirclet").attr("display","initial").style("pointer-events","none").attr("fill","transparent").attr("stroke","orange").attr("stroke-dasharray",3).attr("stroke-width",3).attr("vector-effect","non-scaling-stroke").attr("r",s/2*1.2).transition().duration(100).attr("cx",(t=>t[0])).attr("cy",(t=>t[1]-.08*s)),a.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compLines").data(e).join("path").attr("class","compLines").attr("stroke","orange").attr("stroke-dasharray",3).attr("opacity",.5).attr("stroke-width",1).attr("vector-effect","non-scaling-stroke").transition().duration(100).attr("d",(t=>a.n8j()(t)))}}),[g]),(0,o.useEffect)((function(){if((0,c.ad)(t,"CompareView")){return function(t,e,s,n){let{onClick:o,onHover:c,onUnhover:h}=n;t.selectAll(".compLargeDrop").data(e.groups).join((t=>t.append("g").attr("class","compLargeDrop").each((function(t){let{nodes:e}=t;a.Ltv(this).selectAll(".compSmallDrop").data(e).enter().append("g").attr("class","compSmallDrop").each((function(t){let{levs:e}=t;const s=a.Ltv(this);s.append("rect").attr("class","bbox").style("visibility","hidden");const n=Math.floor(1e9*Math.random()),o=a.Ltv(this).append("defs").append("linearGradient").attr("id","".concat(n)).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");o.append("stop").attr("stop-color","transparent"),o.append("stop").attr("stop-color","transparent"),e.forEach(((t,e)=>{o.append("stop").attr("stop-color",(0,r.YW)(e/i.Kn)),o.append("stop").attr("stop-color",(0,r.YW)(e/i.Kn))})),s.append("path").attr("d",l.js).attr("class","outline").attr("fill","none").attr("stroke","lightgray").attr("stroke-width",.05),s.append("path").attr("class","fill").attr("d",l.js).attr("fill","url(#".concat(n,")"))}))})))).attr("display","initial").attr("transform",((t,e)=>{let{x:s,y:n}=t;return"translate(".concat(s,", ").concat(n,")")})).each((function(t){let{nodes:e}=t;a.Ltv(this).selectAll(".compSmallDrop").data(e).attr("display","initial").attr("transform",(t=>{let{tilt:e,x:s,y:n}=t;return"translate(".concat(s,", ").concat(n,") rotate(",0,")")})).on("click",(function(t,e){o&&o(e)})).on("mouseenter",(function(t,e){c&&c(e)})).on("mouseleave",(function(t,e){h&&h(e)})).each((function(t,e){let{levs:s,maxLev:n,key:r}=t;const o=a.Ltv(this);o.select(".outline").attr("transform","scale(".concat(.95*i.sU,")")),o.select(".fill").attr("transform","scale(".concat(i.sU,")")),o.selectAll("stop").each((function(t,e){let r=Math.floor(e/2);0===e%2&&(r-=1),-1===r?a.Ltv(this).attr("offset","".concat(0,"%")):r===s.length?a.Ltv(this).attr("offset","100%"):a.Ltv(this).attr("offset","".concat(100*(1-s[r]/n),"%"))}));const c=o.select(".fill");o.select(".bbox").attr("x",c.node().getBBox().x).attr("y",c.node().getBBox().y).attr("width",c.node().getBBox().width).attr("height",c.node().getBBox().height)})).transition().delay(s).duration(1e3).attr("transform",(t=>{let{tilt:e,x:s,y:n}=t;return"translate(".concat(s*i.w5/i.pC,", ").concat(n*i.w5/i.pC,") rotate(",0,")")}))})).transition().delay(s).duration(1e3).attr("transform",((t,s)=>"translate(".concat(e.groupPositions[s][0],", ").concat(e.groupPositions[s][1],")")))}(a.Ltv("#mosaic-svg").select(".svg-trans"),m.current=function(t,e,s){const n=e.groups.filter((e=>t.includes(e.key))),r=[],a=n[0].height;for(let o=0,i=n.length;o<i;o++)r.push([s[0]+Math.cos(2*Math.PI/i*o)*a,s[1]+Math.sin(2*Math.PI/i*o)*a]);return{groups:n,groupPositions:r}}(u,p,t.avgCoord),t.transitionDuration/5,{onHover:t=>{f(t.key)}}),s((()=>()=>{e({state:"WideView"}),d()})),()=>{a.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compLargeDrop").remove(),a.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compCirclet").remove(),a.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compLines").remove(),s(null)}}}),[t])}},621:(t,e,s)=>{s.a(t,(async(t,n)=>{try{s.d(e,{A:()=>f});var r=s(437),a=s(43),o=s(96),i=s(956),c=s(385),l=s(684),h=s(972),d=s(58),u=s(579),p=t([d]);function f(){const{state:t,setState:e,setGoBack:s,camera:n,resetCamera:c,activeWaterdrops:l,waterdrops:h}=(0,a.useContext)(o.B);return(0,a.useEffect)((function(){}),[]),(0,a.useEffect)((function(){if((0,i.ad)(t,"ExamineView")){const n=t.transitionDuration;return v(r.Ltv("#mosaic-svg").select(".svg-trans"),m(h.groups.find((t=>t.key===l[0])).nodes.map((t=>t.id)),h.nodes),n/2,{}),s((()=>()=>{e({state:"WideView"}),c()})),()=>{r.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".smallDrop").attr("display","none"),s(null)}}}),[t]),(0,u.jsx)(u.Fragment,{})}function m(t,e){const s=[];for(const n of t){const{id:t,deliveries:r}=d.vR[n];s.push({...e[t]})}return s}function v(t,e,s,n){let{onClick:a,onHover:o,onUnhover:i}=n;t.selectAll(".smallDrop").data(e).join((t=>t.append("g").attr("class","smallDrop").each((function(t,e){let{levs:s}=t;const n=r.Ltv(this);n.append("rect").attr("class","bbox").style("visibility","hidden");const a=r.Ltv(this).append("defs").append("linearGradient").attr("id","drop-fill-".concat(e)).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");a.append("stop").attr("stop-color","transparent"),a.append("stop").attr("stop-color","transparent"),s.forEach(((t,e)=>{a.append("stop").attr("stop-color",(0,l.YW)(e/c.Kn)),a.append("stop").attr("stop-color",(0,l.YW)(e/c.Kn))})),n.append("path").attr("d",h.js).attr("class","outline").attr("fill","none").attr("stroke","lightgray").attr("stroke-width",.05),n.append("path").attr("class","fill").attr("d",h.js).attr("fill","url(#drop-fill-".concat(e,")")),n.append("g").attr("class","circlet").append("circle").attr("fill","transparent").attr("stroke","transparent").attr("stroke-dasharray",3).attr("stroke-width",3).attr("vector-effect","non-scaling-stroke").attr("r",1.5)})))).attr("display","initial").attr("transform",(t=>{let{globalX:e,globalY:s,tilt:n,x:r,y:a}=t;return"translate(".concat(e,", ").concat(s,") rotate(",0,")")})).each((function(t,e){let{levs:s,maxLev:n,key:a}=t;const o=r.Ltv(this);o.select(".outline").attr("transform","scale(".concat(.95*c.sU,")")),o.select(".fill").attr("transform","scale(".concat(c.sU,")")),o.select(".circlet").attr("class",null).attr("class","circlet "+a),o.selectAll("stop").each((function(t,e){let a=Math.floor(e/2);0===e%2&&(a-=1),-1===a?r.Ltv(this).attr("offset","".concat(0,"%")):a===s.length?r.Ltv(this).attr("offset","100%"):r.Ltv(this).attr("offset","".concat(100*(1-s[a]/n),"%"))}));const i=o.select(".fill");o.select(".bbox").attr("x",i.node().getBBox().x).attr("y",i.node().getBBox().y).attr("width",i.node().getBBox().width).attr("height",i.node().getBBox().height)})).on("click",(function(t,e){a&&a(e)})).on("mouseenter",(function(t,e){r.Ltv(this).select(".circlet").classed("active")||r.Ltv(this).select("circle").attr("stroke","orange"),o&&o(e)})).on("mouseleave",(function(t,e){r.Ltv(this).select(".circlet").classed("active")||r.Ltv(this).select("circle").attr("stroke","transparent"),i&&i(e)})).transition().delay(s).duration(1e3).attr("transform",(t=>{let{globalX:e,globalY:s,tilt:n,x:r,y:a}=t;return"translate(".concat(e+r*(c.w5/c.pC-1),", ").concat(s+a*(c.w5/c.pC-1),") rotate(",0,")")}))}d=(p.then?(await p)():p)[0],n()}catch(g){n(g)}}))},313:(t,e,s)=>{s.a(t,(async(t,n)=>{try{s.d(e,{A:()=>m});var r=s(437),a=s(43),o=s(96),i=s(385),c=s(68),l=s(956),h=s(128),d=s(693),u=s(579),p=t([d]);d=(p.then?(await p)():p)[0];const f=t=>t.replace(/(?![^\n]{1,15}$)([^\n]{1,15})\s/g,"$1\n");function m(){const{waterdrops:t,state:e,setState:s,camera:n,zoomTo:i,setActiveWaterdrops:d,activeWaterdrops:p,setDisableCamAdjustments:g,getOutlineOpac:f,addZoomHandler:m}=(0,a.useContext)(o.B),[y,w]=(0,a.useState)([]),[x,b,k]=(0,l.iJ)(!1),M=(0,a.useRef)(),L=(0,a.useRef)(1);(0,a.useEffect)((()=>{m((function(s){L.current=s.k,k.current&&r.Ltv("#mosaic-svg").select(".svg-trans").selectAll("text").each((function(s){const a=r.Ltv(this),o=a.node(),i=o.getBoundingClientRect().left+o.getBoundingClientRect().width/2,c=o.getBoundingClientRect().top+o.getBoundingClientRect().height/2,l=t([i,c],M.current)/L.current**2,h=o.getBBox().width*n.height/n.far*8,d=o.getBBox().height*n.height/n.far*10;a.attr("font-size",(l>5625?0:e(l))/L.current*3),r.Ltv(this.parentNode.parentNode).select("image").attr("x",-h/2).attr("y",-d/2).attr("width",h).attr("height",d)}))}));const t=(t,e)=>{let[s,n]=t,[r,a]=e;return(r-s)**2+(a-n)**2},e=r.m4Y().domain([5625,100]).range([.1,.2]).clamp(!0),s=s=>{M.current=[s.x,s.y],r.Ltv("#mosaic-svg").select(".svg-trans").selectAll("text").each((function(s){const a=r.Ltv(this),o=a.node(),i=o.getBoundingClientRect().left+o.getBoundingClientRect().width/2,c=o.getBoundingClientRect().top+o.getBoundingClientRect().height/2,l=t([i,c],M.current)/L.current**2,h=o.getBBox().width*n.height/n.far*8,d=o.getBBox().height*n.height/n.far*10;a.attr("font-size",(l>5625?0:e(l))/L.current*3),r.Ltv(this.parentNode.parentNode).select("image").attr("x",-h/2).attr("y",-d/2).attr("width",h).attr("height",d)}))};return window.addEventListener("mousemove",s),function(){window.removeEventListener("mousemove",s)}}),[]),(0,a.useEffect)((function(){if((0,l.ad)(e,"WideView")){b(!0);const{transitionDuration:s=2e3}=e;console.time("drawing"),c.Q7.draw(c.JH),console.timeEnd("drawing");const a=f(n.curTransform.k);c.Q7.updateVisibility(1),c.Q7.updateOutlineVisibility(a);const o=r.O1W((t=>{Math.min(1,t/(s/2))>=1&&o.stop()})),i=r.Ltv("#mosaic-svg").select(".svg-trans");v(i,t,{onClick:t=>{w((e=>{const s=e.findIndex((e=>e.key===t.key));return-1!==s?e.splice(s,1):e.push(t),[...e]})),d((e=>(e.includes(t.key)?(e.splice(e.indexOf(t.key),1),i.select(".circlet."+t.key).classed("active",!1)):(e.push(t.key),i.select(".circlet."+t.key).classed("active",!0)),[...e])))}});for(const t of y)i.select(".circlet."+t.key).classed("active",!0);return()=>{r.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".largeDrop").attr("display","none"),b(!1)}}}),[e]);const A=(0,a.useCallback)((()=>{if(1==y.length){const t=y[0],{start:e,duration:a}=i([t.x,t.y-.08*t.height,n.getZFromFarHeight(2*t.height)],(()=>{g(!1)}));e(),s({state:"ExamineView",transitionDuration:a});const o=f(n.curTransform.k);g(!0);const l=r.O1W((t=>{const e=Math.min(1,t/(a/2));c.Q7.updateVisibility(1-e),c.Q7.updateOutlineVisibility(o*(1-e)),e>=1&&(l.stop(),c.Q7.remove(c.JH))}))}else if(y.length>1){const e=y.map((t=>[t.x,t.y])),a=[r.i2o(e,(t=>t[0])),r.i2o(e,(t=>t[1]))],{start:o,duration:l}=i([a[0],a[1],n.getZFromFarHeight(2*t.groups[0].height*2)],(()=>{g(!1)}));o(),s({state:"CompareView",transitionDuration:l,avgCoord:a});const h=f(n.curTransform.k);g(!0);const d=r.O1W((t=>{const e=Math.min(1,t/(l/5));c.Q7.updateVisibility(1-e),c.Q7.updateOutlineVisibility(h*(1-e)),e>=1&&(d.stop(),c.Q7.remove(c.JH))}))}}),[y]);if((0,l.ad)(e,"WideView")&&p.length)return(0,u.jsxs)("button",{onClick:A,className:"wide-view-action-btn",children:[1==p.length?(0,u.jsx)(h.WEK,{}):(0,u.jsx)(h.IS1,{}),1==p.length?"examine":"compare"]})}function v(t,e,s){let{onClick:n,onHover:a,onUnhover:o}=s;console.log("updating svg"),t.selectAll(".largeDrop").data(e.groups).join((t=>t.append("g").attr("class","largeDrop").each((function(t){const e=r.Ltv(this);e.append("g").attr("class","circlet").append("circle").attr("fill","transparent").attr("stroke","transparent").attr("stroke-dasharray",3).attr("stroke-width",3).attr("vector-effect","non-scaling-stroke").attr("r",1);const s=e.append("g");s.append("g").append("image").attr("href","glow.png").attr("preserveAspectRatio","none").attr("opacity",.8),s.append("g").append("text").attr("class","fancy-font").attr("text-anchor","middle").attr("font-size",0)})))).each((function(t){r.Ltv(this).select(".circlet").attr("class",null).attr("class","circlet "+t.key);r.Ltv(this).select("text").call((e=>{e.selectAll("*").remove();const s=f(d.R[t.key].display_name||d.R[t.key].id).split("\n");s.forEach(((t,n)=>{e.append("tspan").attr("x",0).attr("y","".concat(-s.length/2+.5,"em")).attr("dy","".concat(n,"em")).text(t)}))})).node()})).attr("display","initial").attr("transform",(t=>{let{x:e,y:s,height:n}=t;return"translate(".concat(e,", ").concat(s-.08*n,") scale(").concat(n*i.N7,")")})).on("click",(function(t,e){n&&n(e)})).on("mouseenter",(function(t,e){r.Ltv(this).select(".circlet").classed("active")||r.Ltv(this).select("circle").attr("stroke","orange"),a&&a(e)})).on("mouseleave",(function(t,e){r.Ltv(this).select(".circlet").classed("active")||r.Ltv(this).select("circle").attr("stroke","transparent"),o&&o(e)}))}n()}catch(g){n(g)}}))}}]);
//# sourceMappingURL=805.6600bdbe.chunk.js.map