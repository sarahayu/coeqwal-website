{"version":3,"file":"static/js/805.c4a7e0ab.chunk.js","mappings":"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","sources":["App.jsx","AppContext.jsx","bucket-lib/bucket-glyph.js","bucket-lib/utils.js","components/BucketGlyph.jsx","bucket-lib/quantile-bins.js","components/DotHistogram.jsx","components/DropletGlyph.jsx","components/SceneSettingStickers.jsx","components/SceneSettingSubcard.jsx","data/descriptions-data.jsx","data/descriptions-tutorial-data.jsx","data/objectives-data.jsx","data/objectives-tutorial-data.jsx","data/spatial-data.jsx","hooks/useAppState.jsx","hooks/useCompareLargeDrops.jsx","hooks/useDataStory.jsx","hooks/useDataStoryVars.jsx","hooks/useDragPanels.jsx","settings.jsx","utils/three-utils.jsx","three-resources.jsx","utils/compareview-helpers.jsx","utils/data-story-anims.jsx","utils/data-utils.jsx","utils/examineview-helpers.jsx","utils/math-utils.jsx","utils/misc-utils.jsx","utils/render-utils.jsx","utils/story-scripts.jsx","utils/tutorialview-utils.jsx","utils/waterdrop-utils.jsx","utils/wideview-helpers.jsx","views/CompareView.jsx","views/ExamineView.jsx","views/TutorialView.jsx","views/WideView.jsx"],"sourcesContent":["import React from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport WideView from \"views/WideView\";\r\nimport ExamineView from \"views/ExamineView\";\r\nimport TutorialView from \"views/TutorialView\";\r\nimport CompareView from \"views/CompareView\";\r\n\r\nimport useAppState from \"hooks/useAppState\";\r\n\r\nexport default function App() {\r\n  const appState = useAppState();\r\n\r\n  return (\r\n    <AppContext.Provider value={appState}>\r\n      <div className=\"bubbles-wrapper\">\r\n        <div id=\"mosaic-webgl\"></div>\r\n        <svg id=\"mosaic-svg\">\r\n          <g className=\"svg-trans\"></g>\r\n        </svg>\r\n      </div>\r\n      <TutorialView />\r\n      <WideView />\r\n      <ExamineView />\r\n      <CompareView />\r\n      {appState.goBack && (\r\n        <button className=\"go-back-btn\" onClick={appState.goBack}>\r\n          ←\r\n        </button>\r\n      )}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n","import { createContext } from \"react\";\r\n\r\nexport const AppContext = createContext({});\r\n","import * as d3 from \"d3\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LINE_WIDTH = 3;\r\n\r\nlet maskCounter = 0;\r\n\r\n// ensures every mask id is unique\r\nfunction getMaskId() {\r\n  return maskCounter++;\r\n}\r\n\r\nfunction bucketGlyph(width, height, valueToLevelFn = d3.scaleLinear()) {\r\n  return function (data) {\r\n    return data.map((d) => ({\r\n      x: -width,\r\n      y: height - valueToLevelFn(d) * height - height / 2,\r\n      width: width * 2,\r\n      height: height * 2,\r\n    }));\r\n  };\r\n}\r\n\r\nfunction transitionSway(rects, multiplier = 1) {\r\n  // save previous value; we'll need it to calculate how much to sway between renders\r\n  rects.each(function (d) {\r\n    const s = d3.select(this);\r\n    const prevLevel = s.attr(\"cur-level\") || 0;\r\n\r\n    s.attr(\"prev-level\", prevLevel);\r\n    s.attr(\"cur-level\", d.y);\r\n  });\r\n\r\n  rects\r\n    .transition(\"liquidSway\")\r\n    .duration(2000)\r\n    .delay((_, i) => i * 10)\r\n    .ease(d3.easeQuad)\r\n    .attrTween(\"transform\", function (d, i) {\r\n      const s = d3.select(this);\r\n      const prevLiquidLevel = parseFloat(s.attr(\"prev-level\"));\r\n      const diff = (Math.abs(prevLiquidLevel - d.y) / 200) * multiplier;\r\n      return (t) =>\r\n        `rotate(${\r\n          Math.sin(\r\n            Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n          ) *\r\n          diff *\r\n          DEGREE_SWAY *\r\n          (1 - t)\r\n        }, ${0}, ${0})`;\r\n    });\r\n\r\n  const levelTransition = rects\r\n    .transition(\"liquidLevel\")\r\n    .ease(d3.easeElasticOut.period(0.6))\r\n    .delay((_, i) => i * (100 / rects.size()))\r\n    .duration(1000);\r\n\r\n  return levelTransition;\r\n}\r\n\r\nfunction bucketShape(\r\n  width,\r\n  height,\r\n  shapeFunc = drawBucketMask,\r\n  shapeOutlineFunc = shapeFunc\r\n) {\r\n  return function (s) {\r\n    const id = getMaskId();\r\n\r\n    s.append(\"defs\")\r\n      .attr(\"class\", \"clip-def\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    s.append(\"g\")\r\n      .attr(\"class\", \"masked-area\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${height / 2})`)\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${height / 2})`)\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n\r\n    s.call(\r\n      bucketShapeMask({\r\n        drawFunc: shapeFunc,\r\n        drawOutlineFunc: shapeOutlineFunc,\r\n        width,\r\n        height,\r\n      })\r\n    );\r\n  };\r\n}\r\n\r\nfunction bucketShapeMask({\r\n  drawFunc,\r\n  drawOutlineFunc = drawFunc,\r\n  width,\r\n  height,\r\n}) {\r\n  return function (s) {\r\n    const getPath = (fn) => {\r\n      const path = d3.path();\r\n      fn(path, width, height);\r\n      return path.toString();\r\n    };\r\n\r\n    s.select(\".bucket-mask-path\").attr(\"d\", getPath(drawFunc));\r\n    s.select(\".bucket-outline\").attr(\"d\", getPath(drawOutlineFunc));\r\n  };\r\n}\r\n\r\nfunction drawBucketMask(context, width, height) {\r\n  drawBucket(context, width, height, true);\r\n}\r\n\r\nfunction drawBucketOutline(context, width, height) {\r\n  drawBucket(context, width, height, false);\r\n}\r\n\r\nfunction drawBucket(context, width, height, closed) {\r\n  const taper = 0.8;\r\n  const bottomRight = (width * taper) / 2,\r\n    bottomLeft = -(width * taper) / 2;\r\n\r\n  context.moveTo(width / 2, -height / 2);\r\n  context.lineTo(bottomRight, height / 2);\r\n  context.lineTo(bottomLeft, height / 2);\r\n  context.lineTo(-width / 2, -height / 2);\r\n\r\n  if (closed) context.closePath();\r\n}\r\n\r\nfunction drawDroplet(context, width, height) {\r\n  const hypToRad = Math.SQRT2;\r\n\r\n  // dimensions in \"rad\" units\r\n  const dropHeight = 1 + 1 * hypToRad;\r\n\r\n  const radToHeight = 1 / dropHeight;\r\n\r\n  const rad = Math.min(width / 2, height * radToHeight);\r\n  const hyp = rad / (1 / hypToRad);\r\n  const heightActual = rad + hyp;\r\n\r\n  context.moveTo(0, -heightActual / 2);\r\n  context.lineTo(hyp / 2, -heightActual / 2 + hyp / 2);\r\n  context.arc(0, -heightActual / 2 + hyp, rad, -Math.PI / 4, (Math.PI * 5) / 4);\r\n  context.closePath();\r\n}\r\n\r\nexport {\r\n  bucketGlyph,\r\n  transitionSway,\r\n  bucketShape,\r\n  bucketShapeMask,\r\n  drawBucketMask,\r\n  drawBucketOutline,\r\n  drawDroplet,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport { drawBucketMask } from \"./bucket-glyph\";\r\n\r\nfunction distributeQuantiles(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\nconst interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n\r\nfunction levelToDropletLevel(p) {\r\n  p -= 0.0088;\r\n  return Math.min(\r\n    1,\r\n    Math.max(\r\n      0,\r\n      (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326\r\n    )\r\n  );\r\n}\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nfunction ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nfunction bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  const getPath = (fn) => {\r\n    const path = d3.path();\r\n    fn(path, width, height);\r\n    return path.toString();\r\n  };\r\n\r\n  return getPath(drawBucketMask);\r\n}\r\n\r\nfunction collideOffsetter(data, size) {\r\n  const isTooClose = (i) => {\r\n    if (i == 0) return false;\r\n    return Math.abs(data[i - 1].y - data[i].y) < size;\r\n  };\r\n\r\n  let curXOffset = 0;\r\n\r\n  const xOffset = (i) => {\r\n    if (isTooClose(i)) return ++curXOffset * -3;\r\n    return (curXOffset = 0);\r\n  };\r\n\r\n  return xOffset;\r\n}\r\n\r\nexport {\r\n  distributeQuantiles,\r\n  interpolateWatercolorBlue,\r\n  levelToDropletLevel,\r\n  WATERDROP_ICON,\r\n  ticksExact,\r\n  bucketPath,\r\n  collideOffsetter,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport { useLayoutEffect, useRef } from \"react\";\r\n\r\nimport {\r\n  bucketGlyph,\r\n  bucketShape,\r\n  drawBucketMask,\r\n  drawBucketOutline,\r\n  transitionSway,\r\n} from \"bucket-lib/bucket-glyph\";\r\nimport {\r\n  collideOffsetter,\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n} from \"bucket-lib/utils\";\r\n\r\nconst LEVELS = 10;\r\n\r\nconst PERCENTILE_LABELS = [\r\n  \"Maximum\",\r\n  \"75th Percentile\",\r\n  \"50th Percentile\",\r\n  \"25th Percentile\",\r\n  \"Minimum\",\r\n];\r\n\r\nexport default function BucketGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const LINE_WIDTH = 3;\r\n  const GLYPH_MARGIN = {\r\n    top: 30,\r\n    right: LINE_WIDTH / 2,\r\n    bottom: 30,\r\n    left: 180,\r\n  };\r\n\r\n  const svgElement = useRef();\r\n\r\n  useLayoutEffect(function initialize() {\r\n    const svgContainer = svgElement.current\r\n      .attr(\"width\", width + GLYPH_MARGIN.left + GLYPH_MARGIN.right)\r\n      .attr(\"height\", height + GLYPH_MARGIN.top + GLYPH_MARGIN.bottom)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${GLYPH_MARGIN.left},${GLYPH_MARGIN.top})`);\r\n\r\n    svgContainer.call(\r\n      bucketShape(width, height, drawBucketMask, drawBucketOutline)\r\n    );\r\n  }, []);\r\n\r\n  useLayoutEffect(\r\n    function onDataChange() {\r\n      const liquidLevels = ticksExact(0, 1, resolution + 1).map((d) =>\r\n        levelInterp(d)\r\n      );\r\n\r\n      const glyph = bucketGlyph(width, height);\r\n      const data = glyph(liquidLevels);\r\n\r\n      const liquids = svgElement.current\r\n        .select(\".masked-area\")\r\n        .selectAll(\".bucket-box\")\r\n        .data(data)\r\n        .join(\"rect\")\r\n        .attr(\"class\", \"bucket-box\")\r\n        .attr(\"width\", (d) => d.width)\r\n        .attr(\"height\", (d) => d.height)\r\n        .attr(\"x\", (d) => d.x)\r\n        .attr(\"fill\", (_, i) => colorInterp(i / resolution));\r\n\r\n      transitionSway(liquids, 200 / height).attr(\"y\", (d) => d.y);\r\n\r\n      // percentile labels that appear on the side\r\n      const reverseData = data.reverse();\r\n\r\n      const labelWidth = 170,\r\n        labelHeight = 30;\r\n\r\n      const xOffset = collideOffsetter(reverseData, labelHeight);\r\n\r\n      const tagElem = (s) =>\r\n        s.append(\"g\").call((s) => {\r\n          s.append(\"rect\");\r\n          s.append(\"text\");\r\n        });\r\n\r\n      const labels = svgElement.current\r\n        .select(\".graph-area\")\r\n        .selectAll(\".bucket-label\")\r\n        .data(reverseData)\r\n        .join(tagElem)\r\n        .attr(\"class\", \"bucket-label\")\r\n        .transition()\r\n        .attr(\r\n          \"transform\",\r\n          (d, i) =>\r\n            `translate(${-labelWidth / 2 - 3 + xOffset(i)}, ${\r\n              d.y + height / 2\r\n            })`\r\n        );\r\n\r\n      labels\r\n        .select(\"text\")\r\n        .text((_, i) => PERCENTILE_LABELS[data.length - 1 - i])\r\n        .style(\"fill\", (_, i) => (i > data.length / 2 ? \"black\" : \"white\"));\r\n\r\n      labels\r\n        .select(\"rect\")\r\n        .attr(\"width\", labelWidth)\r\n        .attr(\"height\", labelHeight)\r\n        .attr(\"x\", -labelWidth / 2)\r\n        .attr(\"y\", -labelHeight / 2)\r\n        .attr(\"rx\", 8)\r\n        .style(\"fill\", (_, i) =>\r\n          colorInterp((data.length - 1 - i) / resolution)\r\n        );\r\n    },\r\n    [levelInterp]\r\n  );\r\n\r\n  return (\r\n    <div className=\"bucket-wrapper\">\r\n      <svg ref={(e) => void (svgElement.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { distributeQuantiles } from \"./utils\";\r\n\r\n// inclusive\r\nfunction ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nfunction quantileBins(\r\n  width,\r\n  height,\r\n  unitsPerQuantile = undefined,\r\n  range = undefined\r\n) {\r\n  return function (data) {\r\n    unitsPerQuantile = unitsPerQuantile || 1;\r\n    range = range || d3.extent(data);\r\n\r\n    const numQuantiles = data.length / unitsPerQuantile;\r\n    const histBins = d3\r\n      .bin()\r\n      .value((d) => d)\r\n      .domain(range)\r\n      .thresholds(\r\n        ticksExact(...range, Math.ceil(width / (height / numQuantiles)))\r\n      )(data);\r\n\r\n    const binnedQuantiles = distributeQuantiles(\r\n      histBins,\r\n      unitsPerQuantile,\r\n      numQuantiles\r\n    );\r\n\r\n    const quantiles = [];\r\n\r\n    for (let b = 0; b < binnedQuantiles.length; b++) {\r\n      for (let y = 0; y < binnedQuantiles[b]; y++) {\r\n        quantiles.push([\r\n          (histBins[b].x1 + histBins[b].x0) / 2,\r\n          ((y + 0.5) / numQuantiles) * data.length,\r\n        ]);\r\n      }\r\n    }\r\n\r\n    return quantiles;\r\n  };\r\n}\r\n\r\nexport { quantileBins };\r\n","import * as d3 from \"d3\";\r\nimport { useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport { quantileBins } from \"bucket-lib/quantile-bins\";\r\n\r\nimport { clamp } from \"utils/math-utils\";\r\n\r\nconst NUM_CIRCLES = 20;\r\nconst MARGIN = { top: 20, right: 20, bottom: 45, left: 20 };\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport default function DotHistogram({\r\n  data,\r\n  range = [0, d3.max(data)],\r\n  goal,\r\n  setGoal,\r\n  width = 600,\r\n  height = 400,\r\n  shortForm = false,\r\n}) {\r\n  const razorElement = useRef();\r\n  const razorAreaElement = useRef();\r\n\r\n  const svgSelector = useRef();\r\n  const circles = useMemo(\r\n    () => quantileBins(width, height, data.length / NUM_CIRCLES, range)(data),\r\n    [data]\r\n  );\r\n\r\n  const dataRange = [0, data.length];\r\n  const x = d3.scaleLinear().domain(range).range([0, width]);\r\n  const y = d3.scaleLinear().domain(dataRange).range([height, 0]);\r\n  const count = circles.filter((d) => d[0] > goal).length;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width + MARGIN.left + MARGIN.right)\r\n      .attr(\"height\", height + MARGIN.top + MARGIN.bottom)\r\n      .style(\"pointer-events\", \"none\")\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${MARGIN.left},${MARGIN.top})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(\r\n        d3\r\n          .axisBottom()\r\n          .scale(d3.scaleLinear().domain(range).range([0, width]))\r\n          .ticks(8)\r\n          .tickFormat(d3.format(\".2s\"))\r\n      )\r\n      .call((s) => {\r\n        s.selectAll(\"line\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"path\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"text\").attr(\"fill\", \"gray\");\r\n      })\r\n      .append(\"text\")\r\n      .attr(\"fill\", \"black\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${40})`)\r\n      .text(\"Delivery (TAF)\");\r\n\r\n    razorElement.current.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(range)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n\r\n    const ignoreFn = (e) => e.preventDefault();\r\n    let dragging = false;\r\n\r\n    razorElement.current.addEventListener(\"mousedown\", () => {\r\n      dragging = true;\r\n      window.addEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", () => {\r\n      dragging = false;\r\n      window.removeEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    razorAreaElement.current.addEventListener(\"mousemove\", (e) => {\r\n      if (dragging && e.target === razorAreaElement.current) {\r\n        const razorPos = clamp(e.offsetX, MARGIN.left, MARGIN.left + width);\r\n        d3.select(razorElement.current).style(\r\n          \"transform\",\r\n          `translateX(${razorPos}px)`\r\n        );\r\n\r\n        setGoal(\r\n          d3\r\n            .scaleLinear()\r\n            .domain([MARGIN.left, width + MARGIN.left])\r\n            .range(range)\r\n            .clamp(true)(e.offsetX)\r\n        );\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  useLayoutEffect(() => {\r\n    const svgCircles = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".icons\")\r\n      .data(circles)\r\n      .join((enter) => enter.append(\"g\").call((s) => s.append(\"path\")))\r\n      .attr(\"class\", \"icons\")\r\n      .call((s) => {\r\n        s.selectAll(\"path\").attr(\r\n          \"d\",\r\n          d3.symbol(WATERDROP_ICON, height / NUM_CIRCLES)\r\n        );\r\n      });\r\n\r\n    svgCircles\r\n      .attr(\"transform\", (d) => `translate(${x(d[0])},${y(d[1])})`)\r\n      .attr(\"fill\", (d) => (d[0] > goal ? \"steelblue\" : \"black\"));\r\n\r\n    razorElement.current.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(range)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n  }, [goal, circles]);\r\n\r\n  return (\r\n    <div\r\n      className={`dot-histogram-wrapper`}\r\n      ref={(e) => (razorAreaElement.current = e)}\r\n    >\r\n      <div\r\n        className={`pdf-razor ` + (shortForm ? \"short-form\" : \"\")}\r\n        ref={(e) => (razorElement.current = e)}\r\n      >\r\n        <div>\r\n          <span>\r\n            <u>\r\n              {circles.length - count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL NOT meet demand\"}\r\n          </span>\r\n          <span>\r\n            <u>\r\n              {count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL meet demand\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useLayoutEffect, useRef } from \"react\";\r\n\r\nimport {\r\n  bucketGlyph,\r\n  bucketShape,\r\n  drawDroplet,\r\n  transitionSway,\r\n} from \"bucket-lib/bucket-glyph\";\r\nimport {\r\n  interpolateWatercolorBlue,\r\n  levelToDropletLevel,\r\n  ticksExact,\r\n} from \"bucket-lib/utils\";\r\n\r\nconst LEVELS = 10;\r\n\r\nexport default function DropletGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const LINE_WIDTH = 3;\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  const svgElement = useRef();\r\n\r\n  useLayoutEffect(function initialize() {\r\n    const svgContainer = svgElement.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"bucket\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer.call(bucketShape(innerWidth, innerHeight, drawDroplet));\r\n  }, []);\r\n\r\n  useLayoutEffect(\r\n    function onDataChange() {\r\n      const liquidLevels = ticksExact(0, 1, resolution + 1).map((d) =>\r\n        levelInterp(d)\r\n      );\r\n\r\n      const glyph = bucketGlyph(innerWidth, innerHeight, levelToDropletLevel);\r\n\r\n      const liquids = svgElement.current\r\n        .select(\".masked-area\")\r\n        .selectAll(\".bucket-box\")\r\n        .data(glyph(liquidLevels))\r\n        .join(\"rect\")\r\n        .attr(\"class\", \"bucket-box\")\r\n        .attr(\"width\", (d) => d.width)\r\n        .attr(\"height\", (d) => d.height)\r\n        .attr(\"x\", (d) => d.x)\r\n        .attr(\"fill\", (_, i) => colorInterp(i / resolution));\r\n\r\n      transitionSway(liquids, 200 / height).attr(\"y\", (d) => d.y);\r\n    },\r\n    [levelInterp]\r\n  );\r\n\r\n  return (\r\n    <div className=\"waterdrop-wrapper\">\r\n      <svg ref={(e) => void (svgElement.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport { SETT_DESC, SETT_NAME_FULL, SETT_VAL_STEPS } from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingStickers({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings comp-settings\">\r\n      {settings.map((v, i) => (\r\n        <div\r\n          className=\"full-card\"\r\n          onMouseEnter={() => setColorSetting(i)}\r\n          onMouseLeave={() => setColorSetting(null)}\r\n          key={i}\r\n          title={SETT_DESC[i]}\r\n        >\r\n          <span>{SETT_NAME_FULL[i]}</span>\r\n          <span>{SETT_VAL_STEPS[i][v]}</span>\r\n          <div className=\"sett-dot-wrapper\">\r\n            {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n              <span\r\n                className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport {\r\n  SETT_NAME_SHORT,\r\n  SETT_NAME_FULL,\r\n  SETT_VAL_STEPS,\r\n  SETT_DESC,\r\n} from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingSubcard({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings\">\r\n      <div className=\"condense\">\r\n        {settings.map((v, i) => (\r\n          <div className=\"sett-dot-wrapper\" key={i}>\r\n            <span>{SETT_NAME_SHORT[i]}</span>\r\n            {d3.range(v + 1).map((j) => (\r\n              <span\r\n                className=\"sett-dot\"\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"full\">\r\n        <div className=\"full-container\">\r\n          <span>The settings for this scenario are:</span>\r\n          {settings.map((v, i) => (\r\n            <div\r\n              className=\"full-card\"\r\n              onMouseEnter={() => setColorSetting(i)}\r\n              onMouseLeave={() => setColorSetting(null)}\r\n              key={i}\r\n              title={SETT_DESC[i]}\r\n            >\r\n              <span>{SETT_NAME_FULL[i]}</span>\r\n              <span>{SETT_VAL_STEPS[i][v]}</span>\r\n              <div className=\"sett-dot-wrapper\">\r\n                {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n                  <span\r\n                    className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                    key={j}\r\n                    style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n                  ></span>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initDescriptionsData() {\r\n  console.log(\"DATA: loading descriptions data\");\r\n\r\n  const objs = await (await fetch(\"./descriptions.json\")).json();\r\n\r\n  // any data preprocessing goes here. none for now.\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n}\r\n\r\nexport const descriptionsData = await initDescriptionsData();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initDescriptionsData() {\r\n  console.log(\"DATA: loading descriptions tutorial data\");\r\n\r\n  const objs = await (await fetch(\"./descriptions_tutorial.json\")).json();\r\n\r\n  // any data preprocessing goes here. none for now.\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n}\r\n\r\nexport const descriptionsData = await initDescriptionsData();\r\n","import * as d3 from \"d3\";\r\nimport { SETT_NUM_OPTS, deserialize } from \"utils/data-utils\";\r\n\r\nimport { shuffle } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst SCEN_DIVISOR = 1; // debugging purposes, don't render all scenarios to speed things up\r\n\r\nasync function initObjectivesData() {\r\n  const MAX_DELIVS = 1200;\r\n  const SCENARIO_KEY_STRING = \"scens\";\r\n  const DELIV_KEY_STRING = \"delivs\";\r\n  const BASELINE_SCEN = \"expl0000\";\r\n\r\n  const OBJECTIVES_DATA = await (async function load() {\r\n    console.log(\"DATA: loading objectives data\");\r\n\r\n    const objs = await (await fetch(\"./objectives_v3.json\")).json();\r\n\r\n    const chosenScenarios = objs[0][SCENARIO_KEY_STRING].filter(\r\n      (s, i) => i % SCEN_DIVISOR === 0 || s === \"expl0000\"\r\n    ).map(({ name }) => name);\r\n\r\n    for (const obj of objs) {\r\n      // shuffle so clusters of identical scenario results don't get processed deterministically\r\n      const shuffledScens = shuffle(obj[SCENARIO_KEY_STRING]);\r\n\r\n      // iterate backwards to remove unneeded scenarios\r\n      for (let i = shuffledScens.length - 1; i >= 0; i--) {\r\n        const scen = shuffledScens[i];\r\n\r\n        if (chosenScenarios.includes(scen.name)) {\r\n          // sort data since we'll be using ordered data for all our vizes\r\n          scen[DELIV_KEY_STRING].sort(d3.descending);\r\n        } else {\r\n          shuffledScens.splice(i, 1);\r\n        }\r\n      }\r\n\r\n      obj[SCENARIO_KEY_STRING] = mapBy(\r\n        obj[SCENARIO_KEY_STRING],\r\n        ({ name }) => name\r\n      );\r\n    }\r\n\r\n    return mapBy(objs, ({ obj }) => obj);\r\n  })();\r\n\r\n  const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\n  // set default goals to 0TAF, we may want to change this on a per-objective basis\r\n  const OBJECTIVE_GOALS_MAP = (function initDefaults() {\r\n    const goalMap = {};\r\n    for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n      goalMap[OBJECTIVE_IDS[i]] = 0;\r\n    return goalMap;\r\n  })();\r\n\r\n  const SCENARIO_IDS = Object.keys(\r\n    Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n  );\r\n\r\n  const KEY_SETTINGS_MAP = (function preprocessData() {\r\n    const map = {};\r\n    const optArr = Object.values(SETT_NUM_OPTS);\r\n\r\n    for (let i = 0; i < SCENARIO_IDS.length; i++) {\r\n      const key = SCENARIO_IDS[i];\r\n\r\n      map[key] = deserialize(key.slice(4)).map((v, i) => (v + 1) / optArr[i]);\r\n    }\r\n\r\n    return map;\r\n  })();\r\n\r\n  const MIN_MAXES = (function () {\r\n    const minmaxes = {};\r\n\r\n    for (const objective of OBJECTIVE_IDS) {\r\n      const baselineMax = d3.max(\r\n        OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][BASELINE_SCEN][\r\n          DELIV_KEY_STRING\r\n        ]\r\n      );\r\n\r\n      const scenariosMin = d3.min(\r\n        SCENARIO_IDS.map((scenario) =>\r\n          d3.min(\r\n            OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][scenario][\r\n              DELIV_KEY_STRING\r\n            ]\r\n          )\r\n        )\r\n      );\r\n\r\n      // minmaxes[objective] = [scenariosMin, baselineMax];\r\n      minmaxes[objective] = [0, baselineMax];\r\n    }\r\n\r\n    return minmaxes;\r\n  })();\r\n\r\n  // Flattening hierarchical data makes it more flexible for classifying.\r\n  // id conveniently corresponds to index.\r\n  // Also cache classifications (by objective and by scenario, for now).\r\n  // TODO: change flattened_data to an iterator type function?\r\n  const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n    const flattenedData = [];\r\n    const dataGroupings = {\r\n      objective: {},\r\n      scenario: {},\r\n    };\r\n\r\n    // for ordering later\r\n    const means = [];\r\n\r\n    let idx = 0;\r\n    for (const obj of OBJECTIVE_IDS) {\r\n      for (const scen of SCENARIO_IDS) {\r\n        if (!dataGroupings[\"objective\"][obj])\r\n          dataGroupings[\"objective\"][obj] = [];\r\n\r\n        if (!dataGroupings[\"scenario\"][scen])\r\n          dataGroupings[\"scenario\"][scen] = [];\r\n\r\n        dataGroupings[\"objective\"][obj].push(idx);\r\n        dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n        const deliveries =\r\n          OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n        flattenedData.push({\r\n          id: idx,\r\n          objective: obj,\r\n          scenario: scen,\r\n          deliveries,\r\n        });\r\n\r\n        means.push(d3.mean(deliveries));\r\n\r\n        idx++;\r\n      }\r\n    }\r\n\r\n    const orderedDataGroupings = {};\r\n\r\n    for (const criteria of Object.keys(dataGroupings)) {\r\n      const objScens = [];\r\n      for (const key of Object.keys(dataGroupings[criteria])) {\r\n        const ids = dataGroupings[criteria][key];\r\n        const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n        objScens.push({\r\n          key,\r\n          sorted: sortedObjScens,\r\n          mean: d3.mean(\r\n            ids\r\n              .map((id) => {\r\n                const deliveries = flattenedData[id].deliveries;\r\n                const maxVal = MIN_MAXES[flattenedData[id].objective][1];\r\n                return deliveries.map((delivery) => delivery / maxVal);\r\n              })\r\n              .flat()\r\n          ),\r\n        });\r\n      }\r\n\r\n      const sortedObjScens = objScens.sort((a, b) => b.mean - a.mean);\r\n\r\n      orderedDataGroupings[criteria] = {};\r\n\r\n      for (let i = 0; i < sortedObjScens.length; i++) {\r\n        const { key, sorted } = sortedObjScens[i];\r\n        const IDtoRank = {};\r\n\r\n        for (let j = 0; j < sorted.length; j++) {\r\n          IDtoRank[sorted[j]] = j;\r\n        }\r\n        orderedDataGroupings[criteria][key] = IDtoRank;\r\n        orderedDataGroupings[criteria][key].rank = i;\r\n      }\r\n    }\r\n\r\n    return [flattenedData, orderedDataGroupings];\r\n  })();\r\n\r\n  return {\r\n    MAX_DELIVS,\r\n    SCENARIO_KEY_STRING,\r\n    DELIV_KEY_STRING,\r\n    BASELINE_SCEN,\r\n    OBJECTIVES_DATA,\r\n    OBJECTIVE_IDS,\r\n    OBJECTIVE_GOALS_MAP,\r\n    SCENARIO_IDS,\r\n    KEY_SETTINGS_MAP,\r\n    MIN_MAXES,\r\n    FLATTENED_DATA,\r\n    DATA_GROUPINGS,\r\n  };\r\n}\r\n\r\nexport const objectivesData = await initObjectivesData();\r\n","import * as d3 from \"d3\";\r\nimport { SETT_NUM_OPTS, deserialize } from \"utils/data-utils\";\r\n\r\nimport { shuffle } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initObjectivesData() {\r\n  const MAX_DELIVS = 800;\r\n  const SCENARIO_KEY_STRING = \"scens\";\r\n  const DELIV_KEY_STRING = \"delivs\";\r\n  const BASELINE_YRLY_KEY_STRING = \"baseline_yearly\";\r\n  const BASELINE_SCEN = \"expl0000\";\r\n\r\n  const OBJECTIVES_DATA = await (async function load() {\r\n    console.log(\"DATA: loading objectives tutorial data\");\r\n\r\n    const objs = await (await fetch(\"./objectives_tutorial.json\")).json();\r\n\r\n    for (const obj of objs) {\r\n      // shuffle so clusters of identical scenario results don't get processed deterministically\r\n      for (const scen of shuffle(obj[SCENARIO_KEY_STRING])) {\r\n        // save the baseline yearly data, don't order it\r\n        if (scen[\"name\"] === BASELINE_SCEN) {\r\n          obj[BASELINE_YRLY_KEY_STRING] = Array.from(scen[DELIV_KEY_STRING]);\r\n        }\r\n\r\n        // sort data since we'll be using ordered data for all our vizes\r\n        scen[DELIV_KEY_STRING] = scen[DELIV_KEY_STRING].sort(d3.descending);\r\n      }\r\n      obj[SCENARIO_KEY_STRING] = mapBy(\r\n        obj[SCENARIO_KEY_STRING],\r\n        ({ name }) => name\r\n      );\r\n    }\r\n\r\n    return mapBy(objs, ({ obj }) => obj);\r\n  })();\r\n\r\n  const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\n  const OBJECTIVE_GOALS_MAP = (function initDefaults() {\r\n    const goalMap = {};\r\n    for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n      goalMap[OBJECTIVE_IDS[i]] = 200;\r\n    return goalMap;\r\n  })();\r\n\r\n  const SCENARIO_IDS = Object.keys(\r\n    Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n  );\r\n\r\n  const KEY_SETTINGS_MAP = (function preprocessData() {\r\n    const map = {};\r\n    const optArr = Object.values(SETT_NUM_OPTS);\r\n\r\n    for (let i = 0; i < SCENARIO_IDS.length; i++) {\r\n      const key = SCENARIO_IDS[i];\r\n\r\n      map[key] = deserialize(key.slice(4)).map((v, i) => (v + 1) / optArr[i]);\r\n    }\r\n\r\n    return map;\r\n  })();\r\n\r\n  const MIN_MAXES = (function () {\r\n    const minmaxes = {};\r\n\r\n    for (const objective of OBJECTIVE_IDS) {\r\n      const baselineMax = d3.max(\r\n        OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][BASELINE_SCEN][\r\n          DELIV_KEY_STRING\r\n        ]\r\n      );\r\n\r\n      const scenariosMin = d3.min(\r\n        SCENARIO_IDS.map((scenario) =>\r\n          d3.min(\r\n            OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][scenario][\r\n              DELIV_KEY_STRING\r\n            ]\r\n          )\r\n        )\r\n      );\r\n\r\n      // minmaxes[objective] = [scenariosMin, baselineMax];\r\n      minmaxes[objective] = [0, baselineMax];\r\n    }\r\n\r\n    return minmaxes;\r\n  })();\r\n\r\n  // Flattening hierarchical data makes it more flexible for classifying.\r\n  // id conveniently corresponds to index.\r\n  // Also cache classifications (by objective and by scenario, for now).\r\n  // TODO: change flattened_data to an iterator type function?\r\n  const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n    const flattenedData = [];\r\n    const dataGroupings = {\r\n      objective: {},\r\n      scenario: {},\r\n    };\r\n\r\n    // for ordering later\r\n    const means = [];\r\n\r\n    let idx = 0;\r\n    for (const obj of OBJECTIVE_IDS) {\r\n      for (const scen of SCENARIO_IDS) {\r\n        if (!dataGroupings[\"objective\"][obj])\r\n          dataGroupings[\"objective\"][obj] = [];\r\n\r\n        if (!dataGroupings[\"scenario\"][scen])\r\n          dataGroupings[\"scenario\"][scen] = [];\r\n\r\n        dataGroupings[\"objective\"][obj].push(idx);\r\n        dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n        const deliveries =\r\n          OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n        flattenedData.push({\r\n          id: idx,\r\n          objective: obj,\r\n          scenario: scen,\r\n          deliveries,\r\n        });\r\n\r\n        means.push(d3.mean(deliveries));\r\n\r\n        idx++;\r\n      }\r\n    }\r\n\r\n    const orderedDataGroupings = {};\r\n\r\n    for (const criteria of Object.keys(dataGroupings)) {\r\n      const objScens = [];\r\n      for (const key of Object.keys(dataGroupings[criteria])) {\r\n        const ids = dataGroupings[criteria][key];\r\n        const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n        objScens.push({\r\n          key,\r\n          sorted: sortedObjScens,\r\n          mean: d3.mean(ids.map((id) => flattenedData[id].deliveries).flat()),\r\n        });\r\n      }\r\n\r\n      const sortedObjScens = objScens.sort((a, b) => b.mean - a.mean);\r\n\r\n      orderedDataGroupings[criteria] = {};\r\n\r\n      for (let i = 0; i < sortedObjScens.length; i++) {\r\n        const { key, sorted } = sortedObjScens[i];\r\n        const IDtoRank = {};\r\n\r\n        for (let j = 0; j < sorted.length; j++) {\r\n          IDtoRank[sorted[j]] = j;\r\n        }\r\n        orderedDataGroupings[criteria][key] = IDtoRank;\r\n        orderedDataGroupings[criteria][key].rank = i;\r\n      }\r\n    }\r\n\r\n    return [flattenedData, orderedDataGroupings];\r\n  })();\r\n\r\n  return {\r\n    MAX_DELIVS,\r\n    SCENARIO_KEY_STRING,\r\n    DELIV_KEY_STRING,\r\n    BASELINE_YRLY_KEY_STRING,\r\n    BASELINE_SCEN,\r\n    OBJECTIVES_DATA,\r\n    OBJECTIVE_IDS,\r\n    OBJECTIVE_GOALS_MAP,\r\n    SCENARIO_IDS,\r\n    KEY_SETTINGS_MAP,\r\n    MIN_MAXES,\r\n    FLATTENED_DATA,\r\n    DATA_GROUPINGS,\r\n  };\r\n}\r\n\r\nexport const objectivesData = await initObjectivesData();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initSpatialData() {\r\n  const SPATIAL_DATA = await (async function load() {\r\n    console.log(\"DATA: loading callite spatial data\");\r\n\r\n    const objs = await (await fetch(\"./callite_spatial.json\")).json();\r\n\r\n    // any data preprocessing goes here. none for now.\r\n\r\n    return objs;\r\n  })();\r\n\r\n  const SPATIAL_FEATURES = (function () {\r\n    return mapBy(\r\n      SPATIAL_DATA.features,\r\n      ({ properties }) => properties.CalLiteID\r\n    );\r\n  })();\r\n\r\n  const CALIFORNIA_OUTLINE = await (async function load() {\r\n    console.log(\"DATA: loading california spatial data\");\r\n\r\n    const objs = await (await fetch(\"./california.json\")).json();\r\n\r\n    // any data preprocessing goes here. none for now.\r\n\r\n    return objs;\r\n  })();\r\n\r\n  const CALIFORNIA_CENTER = [-119, 37.7749];\r\n\r\n  return {\r\n    SPATIAL_DATA,\r\n    SPATIAL_FEATURES,\r\n    CALIFORNIA_OUTLINE,\r\n    CALIFORNIA_CENTER,\r\n  };\r\n}\r\n\r\nexport const spatialData = await initSpatialData();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { threeResources } from \"three-resources\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { initWaterdrops } from \"utils/waterdrop-utils\";\r\n\r\nconst appWidth = window.innerWidth,\r\n  appHeight = window.innerHeight;\r\nconst waterdrops = initWaterdrops(\r\n  objectivesData,\r\n  descriptionsData,\r\n  \"objective\"\r\n);\r\n\r\nexport default function useAppState() {\r\n  const [state, setState] = useState({});\r\n  const [activeWaterdrops, setActiveWaterdrops] = useState([]);\r\n  const [goBack, setGoBack] = useState(null);\r\n  const [goals, setGoals] = useState(objectivesData.OBJECTIVE_GOALS_MAP);\r\n\r\n  const zoomCallbacksRef = useRef([]);\r\n  const disableCamAdjustmentsRef = useRef(false);\r\n\r\n  useEffect(function initialize() {\r\n    threeResources.renderer.setSize(appWidth, appHeight);\r\n\r\n    console.time(\"drops mesh creating\");\r\n    threeResources.dropsMesh.createMesh(waterdrops);\r\n    console.timeEnd(\"drops mesh creating\");\r\n\r\n    document\r\n      .querySelector(\"#mosaic-webgl\")\r\n      .appendChild(threeResources.renderer.domElement);\r\n\r\n    d3.select(\"#mosaic-svg\").attr(\"width\", appWidth).attr(\"height\", appHeight);\r\n\r\n    const outlineOpacity = d3\r\n      .scaleLinear()\r\n      .domain([\r\n        appHeight / waterdrops.height,\r\n        appHeight / waterdrops.groups[0].height,\r\n      ])\r\n      .range([0.1, 1])\r\n      .clamp(true);\r\n\r\n    threeResources.camera.create({\r\n      width: appWidth,\r\n      height: appHeight,\r\n      webglElement: d3.select(\".bubbles-wrapper\").node(),\r\n      svgElement: d3.select(\"#mosaic-svg\").select(\".svg-trans\").node(),\r\n      zoomFn: (transform) => {\r\n        if (!disableCamAdjustmentsRef.current) {\r\n          threeResources.dropsMesh.updateOutlineVisibility(\r\n            outlineOpacity(transform.k)\r\n          );\r\n        }\r\n\r\n        for (const cb of zoomCallbacksRef.current) cb(transform);\r\n      },\r\n    });\r\n\r\n    threeResources.renderer.setAnimationLoop(() => {\r\n      threeResources.renderer.render(\r\n        threeResources.scene,\r\n        threeResources.camera.camera\r\n      );\r\n    });\r\n\r\n    // resetCamera();\r\n\r\n    setState({ state: \"TutorialView\" });\r\n  }, []);\r\n\r\n  const getOutlineOpacity = useCallback(\r\n    (val) =>\r\n      d3\r\n        .scaleLinear()\r\n        .domain([\r\n          appHeight / waterdrops.height,\r\n          appHeight / waterdrops.groups[0].height,\r\n        ])\r\n        .range([0.1, 1])\r\n        .clamp(true)(val),\r\n    []\r\n  );\r\n\r\n  const resetCamera = useCallback(function (animated = true, callback) {\r\n    const farHeight = waterdrops.height * 1.2;\r\n    const pos = [\r\n      0,\r\n      -waterdrops.height * 0.08,\r\n      threeResources.camera.getZFromFarHeight(farHeight),\r\n    ];\r\n\r\n    let transitionDuration = 0;\r\n\r\n    if (animated) {\r\n      const [start, dur] = zoomTo(pos, callback);\r\n      transitionDuration = dur;\r\n\r\n      start();\r\n    } else {\r\n      threeResources.camera.callZoomFromWorldViewport({\r\n        worldX: pos[0],\r\n        worldY: -pos[1],\r\n        farHeight,\r\n      });\r\n      callback && callback();\r\n    }\r\n\r\n    return transitionDuration;\r\n  }, []);\r\n\r\n  const zoomTo = useCallback(function (worldPos, callback) {\r\n    const i = threeResources.camera.interpolateZoomCamera(worldPos);\r\n\r\n    const duration = i.duration / 2;\r\n\r\n    const start = () => {\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(elapsed / duration, 1);\r\n        threeResources.camera.callZoom(i(et));\r\n\r\n        if (et === 1) {\r\n          t.stop();\r\n          callback && callback();\r\n        }\r\n      });\r\n    };\r\n\r\n    return [start, duration];\r\n  }, []);\r\n\r\n  const addZoomHandler = useCallback(function (cb) {\r\n    zoomCallbacksRef.current.push(cb);\r\n  }, []);\r\n\r\n  const setDisableCamAdjustments = useCallback(function (disable) {\r\n    disableCamAdjustmentsRef.current = disable;\r\n  });\r\n\r\n  return {\r\n    appWidth,\r\n    appHeight,\r\n    state,\r\n    setState,\r\n    activeWaterdrops,\r\n    setActiveWaterdrops,\r\n    setDisableCamAdjustments,\r\n    waterdrops,\r\n    goBack,\r\n    setGoBack,\r\n    zoomTo,\r\n    resetCamera,\r\n    getOutlineOpacity,\r\n    addZoomHandler,\r\n    goals,\r\n    setGoals,\r\n    ...threeResources,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { circlet, hideElems, showElems } from \"utils/render-utils\";\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\nimport { helpers as compareViewHelpers } from \"utils/compareview-helpers\";\r\n\r\n// TODO turn into component?\r\nexport function useCompareLargeDrops() {\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const groupsRef = useRef();\r\n  const camCentersRef = useRef({});\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines] = compareViewHelpers.calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop\r\n        );\r\n\r\n        updateLabel(avgCoords(positions));\r\n        updateScenIndicators(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  function initialize(waterdrops, camera) {\r\n    groupsRef.current = compareViewHelpers.getWaterdropGroups(\r\n      [constants.PAG_OBJECTIVE, constants.PRF_OBJECTIVE],\r\n      waterdrops,\r\n      [0, 0],\r\n      0.6\r\n    );\r\n\r\n    const farHeight = waterdrops.groups[0].height * 2 * settings.SPREAD_1_2 * 1;\r\n    const k = camera.height / farHeight;\r\n\r\n    let x = camera.width / 2;\r\n    let y = camera.height / 2;\r\n\r\n    const camMidpoint = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    x = -(groupsRef.current.groupPositions[0].x * k) + camera.width / 2;\r\n    y = groupsRef.current.groupPositions[0].y * k + camera.height / 2;\r\n\r\n    const camFirstDrop = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    camCentersRef.current.firstDrop = camFirstDrop;\r\n    camCentersRef.current.midpoint = camMidpoint;\r\n\r\n    const container = d3\r\n      .select(\"#comparer-graphics\")\r\n      .attr(\r\n        \"width\",\r\n        window.innerWidth - 20\r\n      ) /* leave room for scrollbar on side */\r\n      .attr(\"height\", window.innerHeight)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-group\")\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(camFirstDrop.x, camFirstDrop.y)\r\n          .scale(camFirstDrop.k)\r\n      );\r\n\r\n    compareViewHelpers.updateDropsSVG(container, groupsRef.current, 0, {\r\n      onHover: (d) => {\r\n        setActiveMinidrop(d.key);\r\n      },\r\n    });\r\n\r\n    const indicatorGroup = container\r\n      .append(\"g\")\r\n      .attr(\"class\", \"indicator-group\");\r\n\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-variable\");\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    setActiveMinidrop(constants.DEFAULT_SCENARIO);\r\n    hideElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  function updateLabel(pos) {\r\n    const [textX, textY] = pos;\r\n\r\n    const smallTextSize =\r\n      (groupsRef.current.groups[0].height * settings.SPREAD_1_2) / 15;\r\n    const largeTextSize =\r\n      (groupsRef.current.groups[0].height * settings.SPREAD_1_2) / 10;\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-label\")\r\n      .text(\"scenario\")\r\n      .attr(\"font-size\", smallTextSize)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-variable\")\r\n      .attr(\"font-size\", largeTextSize)\r\n      .text(activeMinidrop.slice(4))\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY);\r\n  }\r\n\r\n  function updateScenIndicators(positions, lines) {\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".circlet\")\r\n      .data(positions)\r\n      .join(\"circle\")\r\n      .attr(\"class\", \"circlet\")\r\n      .call(circlet)\r\n      .attr(\"r\", settings.LOD_1_RAD_PX * 1.5)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"cx\", (d) => d[0])\r\n      .attr(\"cy\", (d) => d[1]);\r\n\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".comp-line\")\r\n      .data(lines)\r\n      .join(\"path\")\r\n      .attr(\"class\", \"comp-line\")\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"d\", (d) => d3.line()(d));\r\n\r\n    // TODO why do i have to do this in order for circlets to appear on top of waterdrops?\r\n    d3.select(\"#comparer-graphics .indicator-group\").raise();\r\n  }\r\n\r\n  function showOtherDrop() {\r\n    const container = d3.select(\"#comparer-graphics\");\r\n\r\n    container\r\n      .select(\".svg-group\")\r\n      .transition()\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(\r\n            camCentersRef.current.midpoint.x,\r\n            camCentersRef.current.midpoint.y\r\n          )\r\n          .scale(camCentersRef.current.midpoint.k)\r\n      );\r\n\r\n    showElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  function hideOtherDrop() {\r\n    const container = d3.select(\"#comparer-graphics\");\r\n\r\n    container\r\n      .select(\".svg-group\")\r\n      .transition()\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(\r\n            camCentersRef.current.firstDrop.x,\r\n            camCentersRef.current.firstDrop.y\r\n          )\r\n          .scale(camCentersRef.current.firstDrop.k)\r\n      );\r\n\r\n    hideElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  return { initComparer: initialize, showOtherDrop, hideOtherDrop };\r\n}\r\n","import { useCallback, useState } from \"react\";\r\n\r\nimport { useCompareLargeDrops } from \"hooks/useCompareLargeDrops\";\r\nimport { useDataStoryVars } from \"hooks/useDataStoryVars\";\r\nimport { animations as anims } from \"utils/data-story-anims\";\r\nimport { scripts } from \"utils/story-scripts\";\r\n\r\nexport function useDataStory(waterdrops, camera) {\r\n  /*\r\n    slides = [\r\n        name: string,\r\n        animHandler: {\r\n            do: someFunctionToDoAnimation,\r\n            undo: someFunctionToReverseAnimation,\r\n        }\r\n    ]\r\n     */\r\n  const [slides, setSlides] = useState([]);\r\n\r\n  const storyVars = useDataStoryVars();\r\n  const largeDropComparer = useCompareLargeDrops();\r\n\r\n  const hookAnimations = useCallback(\r\n    function () {\r\n      largeDropComparer.initComparer(waterdrops, camera);\r\n      const context = {\r\n        deps: {\r\n          ...storyVars,\r\n          largeDropComparer,\r\n        },\r\n      };\r\n\r\n      const showLocationAnimGroup = anims.initShowLocationAnimGroup(context);\r\n      const chartAnimGroup = anims.initChartAnimGroup(context);\r\n      const bucketsFillAnim = anims.initBucketsFillAnim(context);\r\n      const moveBucketsAnim = anims.initMoveBucketsAnim(context);\r\n      const dropFillAnim = anims.initDropFillAnim(context);\r\n      const changeRealityAnim = anims.initChangeRealityAnim(context);\r\n      const fillVarDropsAnim = anims.initFillVarDropsAnim(context);\r\n      const showScenLabelAnim = anims.initShowScenLabelAnim(context);\r\n      const highlightBestAnim = anims.initHighlightBestAnim(context);\r\n      const showQuantilesAnim = anims.initShowQuantilesAnim(context);\r\n      const comparerAnimGroup = anims.initComparerAnimGroup(context);\r\n\r\n      const _slides = [\r\n        {\r\n          name: \"howMuchIntro\",\r\n          // no anims\r\n        },\r\n        {\r\n          name: \"norCal\",\r\n          animHandler: showLocationAnimGroup.showPAG,\r\n        },\r\n        {\r\n          name: \"soCal\",\r\n          animHandler: showLocationAnimGroup.showPRF,\r\n        },\r\n        {\r\n          name: \"barsExplain\",\r\n          animHandler: chartAnimGroup.barsAppear,\r\n        },\r\n        {\r\n          name: \"barsCondense\",\r\n          animHandler: chartAnimGroup.barsCondense,\r\n        },\r\n        {\r\n          name: \"bucketsFill\",\r\n          animHandler: bucketsFillAnim,\r\n        },\r\n        {\r\n          name: \"comparingTheTwo\",\r\n          animHandler: moveBucketsAnim,\r\n        },\r\n        {\r\n          name: \"forNowLetsFocus\",\r\n          animHandler: dropFillAnim,\r\n        },\r\n        {\r\n          name: \"ifChangeReality\",\r\n          animHandler: changeRealityAnim,\r\n        },\r\n        {\r\n          name: \"fortunateCanExplore\",\r\n          animHandler: fillVarDropsAnim,\r\n        },\r\n        {\r\n          name: \"theseVarsCalled\",\r\n          animHandler: showScenLabelAnim,\r\n        },\r\n        {\r\n          name: \"atAGlance\",\r\n          animHandler: highlightBestAnim,\r\n        },\r\n        {\r\n          name: \"tryMoveRed\",\r\n          animHandler: showQuantilesAnim,\r\n        },\r\n        {\r\n          name: \"soWhyNot\",\r\n          animHandler: comparerAnimGroup.showPAG,\r\n        },\r\n        {\r\n          name: \"letsBringRefuge\",\r\n          animHandler: comparerAnimGroup.showPRF,\r\n        },\r\n      ];\r\n\r\n      setSlides(_slides);\r\n    },\r\n    [waterdrops, camera]\r\n  );\r\n\r\n  const getFromTo = useCallback(\r\n    function (from, to) {\r\n      let idxFrom, idxTo;\r\n\r\n      for (let i = 0; i < slides.length; i++) {\r\n        if (slides[i].name === from) idxFrom = i;\r\n        else if (slides[i].name === to) {\r\n          idxTo = i;\r\n          break;\r\n        }\r\n      }\r\n\r\n      return attachScripts(slides.slice(idxFrom, idxTo + 1));\r\n    },\r\n    [slides]\r\n  );\r\n\r\n  return {\r\n    hookAnimations,\r\n    getSlidesInRange: getFromTo,\r\n    storyVars,\r\n  };\r\n}\r\n\r\nfunction attachScripts(slides) {\r\n  return slides.map((slide) => ({\r\n    ...slide,\r\n    script: scripts[slide.name],\r\n  }));\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useState } from \"react\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\n\r\nexport function useDataStoryVars() {\r\n  const [userGoal, setUserGoal] = useState(200);\r\n  const [bucketInterperPAG, setBucketInterperPAG] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [bucketInterperPRF, setBucketInterperPRF] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [dropInterper, setDropInterper] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [variationInterpers, setVariationInterpers] = useState(() =>\r\n    constants.VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n  );\r\n\r\n  return {\r\n    userGoal,\r\n    setUserGoal,\r\n    bucketInterperPAG,\r\n    setBucketInterperPAG,\r\n    bucketInterperPRF,\r\n    setBucketInterperPRF,\r\n    dropInterper,\r\n    setDropInterper,\r\n    variationInterpers,\r\n    setVariationInterpers,\r\n  };\r\n}\r\n","import { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { worldToScreen } from \"utils/render-utils\";\r\nimport { useStateRef } from \"utils/misc-utils\";\r\n\r\nexport function useDragPanels(viewTransform) {\r\n  const [panels, setPanels, panelsRef] = useStateRef([]);\r\n  const mouseDownInfo = useRef({});\r\n\r\n  useEffect(function initialize() {\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX !== undefined) {\r\n        mouseDownInfo.current = {};\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const onPanelDragStart = useCallback(function (e, { id }) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    e.preventDefault();\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }, []);\r\n\r\n  function getPanelStyle({ x, y, offsetX, offsetY }) {\r\n    const [screenX, screenY] = worldToScreen(x, y, viewTransform);\r\n    return {\r\n      left: `${screenX + offsetX}px`,\r\n      top: `${screenY + offsetY}px`,\r\n    };\r\n  }\r\n\r\n  return {\r\n    panels,\r\n    panelsRef,\r\n    setPanels,\r\n    onPanelDragStart,\r\n    getPanelStyle,\r\n  };\r\n}\r\n","function initSettings() {\r\n  const LOD_1_LEVELS = 4;\r\n  const LOD_1_RAD_PX = 1;\r\n  const LOD_1_MIN_LEV_VAL = 0.1;\r\n  const LOD_1_SMALL_DROP_PAD_FACTOR = 3;\r\n  const LOD_1_LARGE_DROP_PAD_FACTOR = 1.2;\r\n\r\n  const LOD_2_SMALL_DROP_PAD_FACTOR = 3;\r\n\r\n  const GROUP_HOVER_AREA_FACTOR = 1.1 / (1 + Math.SQRT1_2);\r\n  const SPREAD_1_2 = LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  return {\r\n    LOD_1_LEVELS,\r\n    LOD_1_RAD_PX,\r\n    LOD_1_MIN_LEV_VAL,\r\n    LOD_1_SMALL_DROP_PAD_FACTOR,\r\n    LOD_1_LARGE_DROP_PAD_FACTOR,\r\n    LOD_2_SMALL_DROP_PAD_FACTOR,\r\n    GROUP_HOVER_AREA_FACTOR,\r\n    SPREAD_1_2,\r\n  };\r\n}\r\n\r\nexport const settings = initSettings();\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport {\r\n  interpolateWatercolorBlue,\r\n  levelToDropletLevel,\r\n} from \"bucket-lib/utils\";\r\nimport { settings } from \"settings\";\r\nimport { copyCoords, sortBy } from \"utils/misc-utils\";\r\nimport { rotatePoints, toRadians } from \"utils/math-utils\";\r\nimport {\r\n  waterdropDeltaOutline,\r\n  waterdropDelta,\r\n  worldToScreen,\r\n  screenToWorld,\r\n} from \"utils/render-utils\";\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return {\r\n    x: (mouseX / width) * 2 - 1,\r\n    y: -(mouseY / height) * 2 + 1,\r\n  };\r\n}\r\n\r\nexport class WaterdropMesh {\r\n  static MAX_POINTS_DROPS = 60 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n  static MAX_POINTS_OUTLINE = 40 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n\r\n  dropsMesh;\r\n  outlineMesh;\r\n\r\n  added = false;\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.dropsMesh) {\r\n      this.initializeMeshes(waterdrops);\r\n    } else {\r\n      this.updateMeshes(waterdrops);\r\n    }\r\n  }\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.dropsMesh);\r\n      scene.add(this.outlineMesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.dropsMesh);\r\n      scene.remove(this.outlineMesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  // TODO optimize!\r\n  initializeMeshes(waterdrops) {\r\n    const dropsGeometry = new MeshGeometry(WaterdropMesh.MAX_POINTS_DROPS);\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = waterdropDeltaOutline(\r\n      0,\r\n      1,\r\n      settings.LOD_1_RAD_PX * 2 * 0.975\r\n    );\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const {\r\n        id,\r\n        globalX: x,\r\n        globalY: y,\r\n        levs,\r\n        maxLev,\r\n        globalTilt: tilt,\r\n      } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = waterdropDelta(\r\n          levelToDropletLevel(l1 / maxLev),\r\n          levelToDropletLevel(l2 / maxLev),\r\n          settings.LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / settings.LOD_1_LEVELS)\r\n        );\r\n\r\n        dropsGeometry.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y, rotate: tilt },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      const rotOutline = rotatePoints(copyCoords(outlineMeshCoords), tilt);\r\n\r\n      outlinePoints.push(\r\n        ...rotOutline.map(([dx, dy]) => {\r\n          return new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01);\r\n        })\r\n      );\r\n    }\r\n\r\n    dropsGeometry.finish();\r\n\r\n    this.dropsMesh = new THREE.Mesh(\r\n      dropsGeometry.threeGeom,\r\n      new THREE.MeshBasicMaterial({\r\n        vertexColors: true,\r\n        transparent: true,\r\n        opacity: 1,\r\n      })\r\n    );\r\n\r\n    this.outlineMesh = new THREE.LineSegments(\r\n      new THREE.BufferGeometry().setFromPoints(outlinePoints),\r\n      new THREE.LineBasicMaterial({\r\n        color: 13421772,\r\n        transparent: true,\r\n        opacity: 0,\r\n      })\r\n    );\r\n  }\r\n\r\n  updateOutlineVisibility(opac) {\r\n    if (!this.outlineMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateVisibility(opac) {\r\n    if (!this.outlineMesh || !this.dropsMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n    this.dropsMesh.material.opacity = opac;\r\n    this.dropsMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateMeshes(waterdrops) {\r\n    // TODO fix\r\n  }\r\n}\r\n\r\nexport class WaterdropSimplifiedMesh {\r\n  mesh;\r\n  added = false;\r\n\r\n  vertToId = {};\r\n  idToVert = {};\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.mesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.mesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.mesh) {\r\n      this.initializeMesh(waterdrops);\r\n    }\r\n\r\n    this.updateMesh(waterdrops);\r\n\r\n    return this.mesh;\r\n  }\r\n\r\n  initializeMesh(waterdrops) {\r\n    const pointsGeometry = new THREE.BufferGeometry();\r\n\r\n    const vertices = [];\r\n    const colors = [];\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, domLev } = waterdrops.nodes[i];\r\n\r\n      const color = domLev > 0 ? interpolateWatercolorBlue(domLev) : \"white\";\r\n\r\n      vertices.push(x, -y, 0);\r\n      const t_color = new THREE.Color(color);\r\n      colors.push(t_color.r, t_color.g, t_color.b);\r\n\r\n      this.vertToId[i] = id;\r\n      this.idToVert[id] = i;\r\n    }\r\n\r\n    const pointsMaterial = new THREE.PointsMaterial({\r\n      size: settings.LOD_1_RAD_PX * 2,\r\n      sizeAttenuation: true,\r\n      vertexColors: true,\r\n      map: new THREE.TextureLoader().load(\"drop.png\"),\r\n      transparent: true,\r\n    });\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(vertices), 3)\r\n    );\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"color\",\r\n      new THREE.BufferAttribute(new Float32Array(colors), 3)\r\n    );\r\n\r\n    this.mesh = new THREE.Points(pointsGeometry, pointsMaterial);\r\n  }\r\n\r\n  updateMesh(waterdrops) {\r\n    const positionAttr = this.mesh.geometry.getAttribute(\"position\");\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: newX, globalY: newY } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n      positionAttr.setXY(idx, newX, -newY);\r\n    }\r\n    positionAttr.needsUpdate = true;\r\n  }\r\n\r\n  updatePoints(waterdrops, translations, dt) {\r\n    const verts = this.mesh.geometry.vertices;\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n\r\n      const [dx, dy] = translations[id];\r\n\r\n      const x = verts[idx].x;\r\n      const y = verts[idx].y;\r\n\r\n      verts[idx].setX(x + dt * dx);\r\n      verts[idx].setY(y - dt * dy);\r\n    }\r\n\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n\r\n  intersectObject(camera, x, y) {\r\n    const intersects = camera.intersectObject(x, y, this.mesh);\r\n\r\n    if (intersects[0]) {\r\n      const intersect = sortBy(intersects, \"distanceToRay\")[0];\r\n      return this.vertToId[intersect.index];\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  webglView;\r\n  curTransform;\r\n\r\n  raycaster = new THREE.Raycaster();\r\n\r\n  svgView;\r\n\r\n  constructor({ fov, near, far }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n  }\r\n\r\n  create({ width, height, webglElement, svgElement, zoomFn }) {\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.webglView = d3.select(webglElement);\r\n    this.svgView = d3.select(svgElement);\r\n\r\n    this.zoom = d3.zoom().on(\"zoom\", (e) => {\r\n      this.curTransform = e.transform;\r\n\r\n      this.#THREEHandleZoom(e.transform);\r\n      this.svgView.attr(\"transform\", e.transform);\r\n\r\n      zoomFn && zoomFn(e.transform);\r\n    });\r\n\r\n    this.#finishCreate();\r\n  }\r\n\r\n  callZoom(transform) {\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity.translate(transform.x, transform.y).scale(transform.k)\r\n    );\r\n  }\r\n\r\n  callZoomFromWorldViewport({ worldX, worldY, farHeight }) {\r\n    const k = this.height / farHeight;\r\n\r\n    const x = -(worldX * k) + this.width / 2;\r\n    const y = worldY * k + this.height / 2;\r\n\r\n    this.callZoom({\r\n      x,\r\n      y,\r\n      k,\r\n    });\r\n  }\r\n\r\n  interpolateZoomCamera([endx, endy, endz]) {\r\n    const i = d3.interpolateZoom(\r\n      [\r\n        this.camera.position.x,\r\n        this.camera.position.y,\r\n        this.height / this.curTransform.k,\r\n      ],\r\n      [endx, -endy, this.getFarHeightFromZ(endz)]\r\n    );\r\n\r\n    const interper = (t) => {\r\n      const [worldX, worldY, farHeight] = i(t);\r\n\r\n      const k = this.height / farHeight;\r\n\r\n      const x = -(worldX * k) + this.width / 2;\r\n      const y = worldY * k + this.height / 2;\r\n\r\n      return {\r\n        x,\r\n        y,\r\n        k,\r\n      };\r\n    };\r\n\r\n    interper.duration = i.duration;\r\n\r\n    return interper;\r\n  }\r\n\r\n  getZFromFarHeight(farHeight) {\r\n    return (Math.tan(toRadians(90 - this.fov / 2)) * farHeight) / 2;\r\n  }\r\n\r\n  getFarHeightFromZ(z) {\r\n    return Math.tan(toRadians(this.fov) / 2) * z * 2;\r\n  }\r\n\r\n  getScaleFromZ(z) {\r\n    const farHeight = this.getFarHeightFromZ(z);\r\n    const scale = this.height / farHeight;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const scaleHeight = this.height / scale;\r\n    const z = this.getZFromFarHeight(scaleHeight);\r\n    return z;\r\n  }\r\n\r\n  intersectObject(mouseX, mouseY, mesh) {\r\n    this.raycaster.setFromCamera(\r\n      {\r\n        x: mouseX,\r\n        y: mouseY,\r\n      },\r\n      this.camera\r\n    );\r\n\r\n    return this.raycaster.intersectObject(mesh);\r\n  }\r\n\r\n  worldToScreen(x, y) {\r\n    return worldToScreen(x, y, this.curTransform);\r\n  }\r\n\r\n  screenToWorld(x, y) {\r\n    return screenToWorld(x, y, this.curTransform);\r\n  }\r\n\r\n  #finishCreate() {\r\n    this.zoom = this.zoom.scaleExtent([\r\n      this.getScaleFromZ(this.far),\r\n      this.getScaleFromZ(this.near),\r\n    ]);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      this.fov,\r\n      this.width / this.height,\r\n      this.near,\r\n      this.far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.webglView.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  #THREEHandleZoom(transform) {\r\n    const scale = transform.k;\r\n    const x = -(transform.x - this.width / 2) / scale;\r\n    const y = (transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n}\r\n\r\nclass MeshGeometry {\r\n  threeGeom = new THREE.BufferGeometry();\r\n  triangleIdx = 0;\r\n  positionAttribute;\r\n  colorAttribute;\r\n\r\n  constructor(numPoints, color = true) {\r\n    this.threeGeom.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n    );\r\n\r\n    if (color)\r\n      this.threeGeom.setAttribute(\r\n        \"color\",\r\n        new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n      );\r\n\r\n    this.positionAttribute = this.threeGeom.getAttribute(\"position\");\r\n    this.colorAttribute = this.threeGeom.getAttribute(\"color\");\r\n  }\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = rotatePoints(\r\n        copyCoords(meshCoords[j]),\r\n        transform.rotate\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 0,\r\n        transform.x + v1[0],\r\n        transform.y - v1[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 1,\r\n        transform.x + v2[0],\r\n        transform.y - v2[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 2,\r\n        transform.x + v3[0],\r\n        transform.y - v3[1],\r\n        z\r\n      );\r\n\r\n      if (color) {\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 0,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 1,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 2,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n      }\r\n\r\n      this.triangleIdx++;\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    this.threeGeom.setDrawRange(0, this.triangleIdx * 3);\r\n  }\r\n}\r\n","import * as THREE from \"three\";\r\n\r\nimport { WaterdropMesh, Camera } from \"utils/three-utils\";\r\n\r\nfunction initThreeResources() {\r\n  const scene = (function getScene() {\r\n    const s = new THREE.Scene();\r\n    s.background = new THREE.Color(0xefefef);\r\n    return s;\r\n  })();\r\n\r\n  const dropsMesh = new WaterdropMesh();\r\n\r\n  const camera = new Camera({\r\n    fov: 45,\r\n    near: 1,\r\n    far: 3000,\r\n  });\r\n\r\n  const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\r\n  return { scene, camera, renderer, dropsMesh };\r\n}\r\n\r\nexport const threeResources = initThreeResources();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { settings } from \"settings\";\r\n\r\nimport { clipEnds, dropCenterCorrection } from \"utils/math-utils\";\r\nimport {\r\n  DROPLET_SHAPE,\r\n  generateTSpan,\r\n  circlet,\r\n  gradientInit,\r\n  gradientUpdate,\r\n} from \"utils/render-utils\";\r\n\r\nfunction largeDropInit({ nodes, height, key }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"large-drop \" + key);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"stroke\", \"none\")\r\n      .attr(\"fill\", \"yellow\")\r\n      .attr(\"r\", settings.LOD_1_RAD_PX * 2);\r\n\r\n    s.append(\"g\")\r\n      .attr(\"class\", \"baseline-pointer\")\r\n      .call(function (s) {\r\n        s.append(\"path\");\r\n        s.append(\"text\").text(\"baseline\");\r\n      });\r\n\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * settings.SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"drop-label fancy-font large-gray-text\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate(\r\n  { nodes, height, display_name },\r\n  { isLeft, isBottom },\r\n  transitionDelay\r\n) {\r\n  return (s) => {\r\n    const getStartDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x}, ${y}) rotate(${tilt})`;\r\n    const getEndDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x * settings.SPREAD_1_2}, ${\r\n        y * settings.SPREAD_1_2\r\n      }) rotate(${tilt})`;\r\n\r\n    const baselinePos = {};\r\n\r\n    s.call(textUpdate(display_name, height))\r\n      .selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\"transform\", getStartDropLoc)\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n      })\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"transform\", getEndDropLoc);\r\n\r\n    s.select(\".highlight-circle\")\r\n      .attr(\"cx\", baselinePos.x)\r\n      .attr(\r\n        \"cy\",\r\n        baselinePos.y - dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n      )\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"cx\", baselinePos.x * settings.SPREAD_1_2)\r\n      .attr(\r\n        \"cy\",\r\n        baselinePos.y * settings.SPREAD_1_2 -\r\n          dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n      );\r\n\r\n    const circlePosX = baselinePos.x * settings.SPREAD_1_2,\r\n      circlePosY =\r\n        baselinePos.y * settings.SPREAD_1_2 -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX });\r\n\r\n    const textPosX = ((height * settings.SPREAD_1_2) / 2) * (isLeft ? -1 : 1),\r\n      textPosY = ((height * settings.SPREAD_1_2) / 2) * (isBottom ? 1 : -1);\r\n\r\n    const fontSize = height / 20;\r\n    const lineWidth = height / 100;\r\n\r\n    s.select(\".baseline-pointer path\")\r\n      .attr(\r\n        \"d\",\r\n        d3\r\n          .line()\r\n          .x((d) => d[0])\r\n          .y((d) => d[1])([\r\n          [circlePosX, circlePosY],\r\n          [textPosX, textPosY],\r\n        ])\r\n      )\r\n      .attr(\"stroke-width\", lineWidth);\r\n    s.select(\".baseline-pointer text\")\r\n      .attr(\"class\", \"fancy-font\")\r\n      .attr(\"font-size\", fontSize)\r\n      .attr(\"text-anchor\", isLeft ? \"end\" : \"start\")\r\n      .attr(\r\n        \"transform\",\r\n        `translate(${textPosX + fontSize * (isLeft ? -1 : 1)}, ${textPosY})`\r\n      );\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ levs, id }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const idStr = `compare-grad-${id}`;\r\n\r\n    s.call(gradientInit(levs, idStr));\r\n\r\n    s.append(\"path\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"class\", \"outline\")\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX * 0.95})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${idStr})`)\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX})`);\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction textUpdate(display_name, height) {\r\n  return (s) => {\r\n    s.select(\".drop-label\")\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", (height / 2) * settings.SPREAD_1_2 * 0.9)\r\n      .call(generateTSpan(display_name, 1.2, 30));\r\n  };\r\n}\r\n\r\nfunction updateDropsSVG(\r\n  container,\r\n  waterdropGroups,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartGroupLoc = ({ x, y, tilt }) =>\r\n    `translate(${x}, ${y}) rotate(${tilt})`;\r\n  const getEndGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i].x}, ${waterdropGroups.groupPositions[i].y})`;\r\n\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(largeDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartGroupLoc)\r\n    .each(function (node, i) {\r\n      const drops = d3\r\n        .select(this)\r\n        .call(\r\n          largeDropUpdate(\r\n            node,\r\n            waterdropGroups.groupPositions[i],\r\n            transitionDelay\r\n          )\r\n        )\r\n        .selectAll(\".small-drop\");\r\n\r\n      if (onClick) {\r\n        drops.on(\"click\", function (_, d) {\r\n          onClick(d);\r\n        });\r\n      }\r\n\r\n      if (onHover) {\r\n        drops.on(\"mouseenter\", function (_, d) {\r\n          d3.select(this.parentNode).raise();\r\n          onHover(d);\r\n        });\r\n      }\r\n\r\n      if (onUnhover) {\r\n        drops.on(\"mouseleave\", function (_, d) {\r\n          onUnhover(d);\r\n        });\r\n      }\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndGroupLoc);\r\n}\r\n\r\nfunction updateColorDrops(container, waterdropGroups, opacFn, color) {\r\n  const getGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i].x}, ${waterdropGroups.groupPositions[i].y})`;\r\n\r\n  container\r\n    .selectAll(\".color-drop-group\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function ({ nodes }) {\r\n        d3.select(this).call((s) => {\r\n          s.attr(\"class\", \"color-drop-group\")\r\n            .selectAll(\".color-drop\")\r\n            .data(nodes)\r\n            .join(\"circle\")\r\n            .attr(\"class\", \"color-drop\")\r\n            .attr(\"r\", settings.LOD_1_RAD_PX);\r\n        });\r\n      });\r\n    })\r\n    .attr(\"transform\", getGroupLoc)\r\n    .each(function () {\r\n      d3.select(this)\r\n        .selectAll(\".color-drop\")\r\n        .call((s) => {\r\n          s.attr(\"opacity\", ({ key }) => opacFn(key)).attr(\"fill\", color);\r\n        })\r\n        .attr(\"cx\", ({ x }) => x * settings.SPREAD_1_2)\r\n        .attr(\"cy\", ({ y }) => y * settings.SPREAD_1_2);\r\n    });\r\n}\r\n\r\nfunction getWaterdropGroups(keyArr, waterdrops, center, spacing = 0.75) {\r\n  const groups = keyArr.map((k) => waterdrops.groups.find((g) => g.key === k));\r\n\r\n  const groupPositions = [];\r\n  const rad = groups[0].height * settings.SPREAD_1_2 * spacing;\r\n\r\n  for (let i = 0, n = groups.length; i < n; i++) {\r\n    const angle = ((Math.PI * 2) / n) * (i - 0.5) - Math.PI / 2;\r\n    const x = center[0] + Math.cos(angle) * rad,\r\n      y = center[1] + Math.sin(angle) * rad,\r\n      isLeft = x < center[0],\r\n      isBottom = y > center[1];\r\n\r\n    groupPositions.push({\r\n      x,\r\n      y,\r\n      isLeft,\r\n      isBottom,\r\n    });\r\n  }\r\n\r\n  return {\r\n    groups,\r\n    groupPositions,\r\n  };\r\n}\r\n\r\nfunction calcLinesAndPositions(groupsObj, activeMinidropKey) {\r\n  const positions = [];\r\n  const nodes = [];\r\n  for (let i = 0; i < groupsObj.groups.length; i++) {\r\n    const group = groupsObj.groups[i];\r\n    const groupPos = groupsObj.groupPositions[i];\r\n\r\n    const node = group.nodes.find((n) => n.key === activeMinidropKey);\r\n\r\n    nodes.push(node);\r\n\r\n    positions.push([\r\n      node.x * settings.SPREAD_1_2 + groupPos.x,\r\n      node.y * settings.SPREAD_1_2 +\r\n        groupPos.y -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX }),\r\n    ]);\r\n  }\r\n\r\n  const lines = [];\r\n\r\n  for (let i = 0; i < positions.length; i++) {\r\n    const from = Array.from(positions[i]),\r\n      to = Array.from(positions[i + 1 == positions.length ? 0 : i + 1]);\r\n\r\n    clipEnds([from, to], settings.LOD_1_RAD_PX * 2);\r\n\r\n    lines.push([from, to]);\r\n  }\r\n\r\n  return [positions, lines, nodes];\r\n}\r\n\r\nfunction updateLabelSVG(pos, labelText, normedTextSize) {\r\n  const [textX, textY] = pos;\r\n\r\n  const smallTextSize = normedTextSize / 15;\r\n  const largeTextSize = normedTextSize / 10;\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-label\")\r\n    .text(\"scenario\")\r\n    .attr(\"font-size\", smallTextSize)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-variable\")\r\n    .attr(\"font-size\", largeTextSize)\r\n    .text(labelText)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY);\r\n}\r\n\r\nfunction updateScenIndicatorsSVG(positions, lines) {\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".circlet\")\r\n    .data(positions)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"circlet\")\r\n    .call(circlet)\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX * 1.5)\r\n    .raise()\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"cx\", (d) => d[0])\r\n    .attr(\"cy\", (d) => d[1]);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".comp-line\")\r\n    .data(lines)\r\n    .join(\"path\")\r\n    .attr(\"class\", \"comp-line\")\r\n    .raise()\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"d\", (d) => d3.line()(d));\r\n}\r\n\r\nexport const helpers = {\r\n  updateDropsSVG,\r\n  updateColorDrops,\r\n  getWaterdropGroups,\r\n  calcLinesAndPositions,\r\n  updateLabelSVG,\r\n  updateScenIndicatorsSVG,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\n\r\nimport { objectivesData } from \"data/objectives-tutorial-data\";\r\nimport { hideElems, showElems } from \"utils/render-utils\";\r\n\r\nfunction initAllAnims() {\r\n  function initShowLocationAnimGroup() {\r\n    function showPAGDo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n    }\r\n\r\n    function showPAGUndo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 1)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n    }\r\n\r\n    function showPRFDo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 1)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PRF_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n    }\r\n\r\n    function showPRFUndo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PRF_OBJECTIVE)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n    }\r\n\r\n    return {\r\n      showPAG: {\r\n        do: showPAGDo,\r\n        undo: showPAGUndo,\r\n      },\r\n      showPRF: {\r\n        do: showPRFDo,\r\n        undo: showPRFUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  function initChartAnimGroup() {\r\n    let _pagX;\r\n    let _prfX;\r\n    let _pagXAxis;\r\n    let _prfXAxis;\r\n    let _pagDataDescending;\r\n    let _prfDataDescending;\r\n\r\n    const BAR_CHART_MARGIN = { top: 40, right: 30, bottom: 40, left: 60 };\r\n\r\n    function prepareSVG() {\r\n      // PAG\r\n      {\r\n        const svgGroup = d3\r\n          .select(\"#pag-bar-graph\")\r\n          .attr(\r\n            \"width\",\r\n            constants.BAR_CHART_WIDTH +\r\n              BAR_CHART_MARGIN.left +\r\n              BAR_CHART_MARGIN.right\r\n          )\r\n          .attr(\r\n            \"height\",\r\n            constants.BAR_CHART_HEIGHT +\r\n              BAR_CHART_MARGIN.top +\r\n              BAR_CHART_MARGIN.bottom\r\n          )\r\n          .attr(\"opacity\", 1)\r\n          .append(\"g\")\r\n          .attr(\"class\", \"svg-group\")\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        const dataDescending = objectivesData.OBJECTIVES_DATA[\r\n          constants.PAG_OBJECTIVE\r\n        ][objectivesData.BASELINE_YRLY_KEY_STRING]\r\n          .map((val, placeFromLeft) => ({\r\n            val,\r\n            placeFromLeft,\r\n            year: placeFromLeft + 1,\r\n          }))\r\n          .sort(d3.descending);\r\n\r\n        const x = d3\r\n          .scaleBand()\r\n          .domain(dataDescending.map(({ year }) => year).sort(d3.ascending))\r\n          .range([0, constants.BAR_CHART_WIDTH])\r\n          .padding(0.4);\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        const xaxis = d3\r\n          .axisBottom(x)\r\n          .tickSize(0)\r\n          .tickFormat((d) => `year ${d}`)\r\n          .tickValues(\r\n            x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0)\r\n          );\r\n\r\n        svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n        svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .call(xaxis)\r\n          .selectAll(\"text\")\r\n          .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n          .style(\"text-anchor\", \"end\");\r\n        svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n        _pagX = x;\r\n        _pagXAxis = xaxis;\r\n        _pagDataDescending = dataDescending;\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const svgGroup = d3\r\n          .select(\"#prf-bar-graph\")\r\n          .attr(\r\n            \"width\",\r\n            constants.BAR_CHART_WIDTH +\r\n              BAR_CHART_MARGIN.left +\r\n              BAR_CHART_MARGIN.right\r\n          )\r\n          .attr(\r\n            \"height\",\r\n            constants.BAR_CHART_HEIGHT +\r\n              BAR_CHART_MARGIN.top +\r\n              BAR_CHART_MARGIN.bottom\r\n          )\r\n          .attr(\"opacity\", 1)\r\n          .append(\"g\")\r\n          .attr(\"class\", \"svg-group\")\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        const dataDescending = objectivesData.OBJECTIVES_DATA[\r\n          constants.PRF_OBJECTIVE\r\n        ][objectivesData.BASELINE_YRLY_KEY_STRING]\r\n          .map((val, placeFromLeft) => ({\r\n            val,\r\n            placeFromLeft,\r\n            year: placeFromLeft + 1,\r\n          }))\r\n          .sort(d3.descending);\r\n\r\n        const x = d3\r\n          .scaleBand()\r\n          .domain(dataDescending.map(({ year }) => year).sort(d3.ascending))\r\n          .range([0, constants.BAR_CHART_WIDTH])\r\n          .padding(0.4);\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        const xaxis = d3\r\n          .axisBottom(x)\r\n          .tickSize(0)\r\n          .tickFormat((d) => `year ${d}`)\r\n          .tickValues(\r\n            x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0)\r\n          );\r\n\r\n        svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n        svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .call(xaxis)\r\n          .selectAll(\"text\")\r\n          .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n          .style(\"text-anchor\", \"end\");\r\n        svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n        _prfX = x;\r\n        _prfXAxis = xaxis;\r\n        _prfDataDescending = dataDescending;\r\n      }\r\n    }\r\n\r\n    function barsAppearDo() {\r\n      // PAG\r\n      {\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        d3.select(\"#pag-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_pagDataDescending, (d) => d.placeFromLeft)\r\n          .join(\"rect\")\r\n          .attr(\"class\", \"bars\")\r\n          .attr(\"x\", (d) => _pagX(d.year))\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"width\", _pagX.bandwidth())\r\n          .attr(\"height\", 0)\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"fill\", \"steelblue\")\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => d.placeFromLeft * 10)\r\n          .attr(\"y\", (d) => y(d.val))\r\n          .attr(\"height\", (d) => constants.BAR_CHART_HEIGHT - y(d.val));\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        d3.select(\"#prf-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_prfDataDescending, (d) => d.placeFromLeft)\r\n          .join(\"rect\")\r\n          .attr(\"class\", \"bars\")\r\n          .attr(\"x\", (d) => _prfX(d.year))\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"width\", _prfX.bandwidth())\r\n          .attr(\"height\", 0)\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"fill\", \"steelblue\")\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => d.placeFromLeft * 10)\r\n          .attr(\"y\", (d) => y(d.val))\r\n          .attr(\"height\", (d) => constants.BAR_CHART_HEIGHT - y(d.val));\r\n      }\r\n    }\r\n\r\n    function barsAppearUndo() {\r\n      // PAG\r\n      {\r\n        d3.select(\"#pag-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_pagDataDescending, (d) => d.placeFromLeft)\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => (_pagDataDescending.length - d.placeFromLeft - 1) * 10)\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"height\", 0);\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        d3.select(\"#prf-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_prfDataDescending, (d) => d.placeFromLeft)\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => (_prfDataDescending.length - d.placeFromLeft - 1) * 10)\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"height\", 0);\r\n      }\r\n    }\r\n\r\n    async function barsCondenseDo() {\r\n      // PAG\r\n      {\r\n        const newWidth = constants.BAR_CHART_WIDTH / 8;\r\n        const svgGroup = d3.select(\"#pag-bar-graph .svg-group\");\r\n\r\n        svgGroup.select(\".anim-xaxis\").call(_pagXAxis.tickFormat(\"\"));\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        bars\r\n          .style(\"mix-blend-mode\", \"multiply\")\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 0.05)\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (1 - d.placeFromLeft / _pagDataDescending.length) ** 4) *\r\n                1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"width\", newWidth)\r\n          .attr(\"x\", constants.BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            svgGroup\r\n              .select(\".anim-xaxis\")\r\n              .transition()\r\n              .transition(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(0, ${constants.BAR_CHART_HEIGHT + 50})`\r\n              )\r\n              .attr(\"opacity\", 0);\r\n\r\n            bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n            svgGroup\r\n              .transition()\r\n              .delay(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(${\r\n                  BAR_CHART_MARGIN.left +\r\n                  constants.BAR_CHART_WIDTH / 2 -\r\n                  newWidth / 2\r\n                },${BAR_CHART_MARGIN.top})`\r\n              );\r\n          });\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const newWidth = constants.BAR_CHART_WIDTH / 8;\r\n        const svgGroup = d3.select(\"#prf-bar-graph .svg-group\");\r\n\r\n        svgGroup.select(\".anim-xaxis\").call(_prfXAxis.tickFormat(\"\"));\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        bars\r\n          .style(\"mix-blend-mode\", \"multiply\")\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 0.05)\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (1 - d.placeFromLeft / _prfDataDescending.length) ** 4) *\r\n                1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"width\", newWidth)\r\n          .attr(\"x\", constants.BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            svgGroup\r\n              .select(\".anim-xaxis\")\r\n              .transition()\r\n              .transition(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(0, ${constants.BAR_CHART_HEIGHT + 50})`\r\n              )\r\n              .attr(\"opacity\", 0);\r\n\r\n            bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n            svgGroup\r\n              .transition()\r\n              .delay(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(${\r\n                  BAR_CHART_MARGIN.left +\r\n                  constants.BAR_CHART_WIDTH / 2 -\r\n                  newWidth / 2\r\n                },${BAR_CHART_MARGIN.top})`\r\n              );\r\n          });\r\n      }\r\n    }\r\n\r\n    function barsCondenseUndo() {\r\n      // PAG\r\n      {\r\n        const svgGroup = d3.select(\"#pag-bar-graph .svg-group\");\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .transition()\r\n          .transition(500)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .attr(\"opacity\", 1);\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .call(_pagXAxis.tickFormat((d) => `year ${d}`));\r\n\r\n        svgGroup\r\n          .transition()\r\n          .delay(500)\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        bars\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (d.placeFromLeft / _pagDataDescending.length) ** 4) * 1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"x\", (d) => _prfX(d.year))\r\n          .attr(\"width\", _pagX.bandwidth())\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 1)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            bars.style(\"mix-blend-mode\", \"normal\");\r\n          });\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const svgGroup = d3.select(\"#prf-bar-graph .svg-group\");\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .transition()\r\n          .transition(500)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .attr(\"opacity\", 1);\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .call(_prfXAxis.tickFormat((d) => `year ${d}`));\r\n\r\n        svgGroup\r\n          .transition()\r\n          .delay(500)\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        bars\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (d.placeFromLeft / _prfDataDescending.length) ** 4) * 1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"x\", (d) => _prfX(d.year))\r\n          .attr(\"width\", _prfX.bandwidth())\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 1)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            bars.style(\"mix-blend-mode\", \"normal\");\r\n          });\r\n      }\r\n    }\r\n\r\n    prepareSVG();\r\n\r\n    return {\r\n      barsAppear: {\r\n        do: barsAppearDo,\r\n        undo: barsAppearUndo,\r\n      },\r\n      barsCondense: {\r\n        do: barsCondenseDo,\r\n        undo: barsCondenseUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  function initBucketsFillAnim({ deps }) {\r\n    function animDo() {\r\n      d3.selectAll(\".tut-graph-wrapper .bucket-wrapper\").style(\r\n        \"display\",\r\n        \"initial\"\r\n      );\r\n      d3.select(\"#pag-bar-graph\").attr(\"opacity\", 0);\r\n      d3.select(\"#prf-bar-graph\").attr(\"opacity\", 0);\r\n\r\n      deps.setBucketInterperPAG(() => constants.PAG_INTERPER);\r\n      deps.setBucketInterperPRF(() => constants.PRF_INTERPER);\r\n    }\r\n\r\n    function animUndo() {\r\n      deps.setBucketInterperPAG(() => d3.scaleLinear().range([0, 0]));\r\n      deps.setBucketInterperPRF(() => d3.scaleLinear().range([0, 0]));\r\n\r\n      d3.selectAll(\".tut-graph-wrapper .bucket-wrapper\").style(\r\n        \"display\",\r\n        \"none\"\r\n      );\r\n      d3.select(\"#pag-bar-graph\").transition().attr(\"opacity\", 1);\r\n      d3.select(\"#prf-bar-graph\").transition().attr(\"opacity\", 1);\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initMoveBucketsAnim({ deps }) {\r\n    function animDo() {\r\n      d3.select(\".tut-graph-wrapper\").classed(\"moved\", true);\r\n      // .style(\"transform\", \"translate(0, -50%)\")\r\n      // .style(\"right\", \"3em\");\r\n\r\n      showElems(\".explain-results\");\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.select(\".tut-graph-wrapper\").classed(\"moved\", false);\r\n      // .style(\"transform\", \"translate(50%, -50%)\")\r\n      // .style(\"right\", \"50%\");\r\n\r\n      hideElems(\".explain-results\");\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initDropFillAnim({ deps }) {\r\n    function animDo() {\r\n      deps.setDropInterper(() => constants.PAG_INTERPER_DROP);\r\n    }\r\n\r\n    function animUndo() {\r\n      deps.setDropInterper(() => d3.scaleLinear().range([0, 0]));\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initChangeRealityAnim() {\r\n    function animDo() {\r\n      d3.selectAll(\".vardrop\")\r\n        .style(\"display\", \"initial\")\r\n        .classed(\"hasarrow\", true);\r\n\r\n      hideElems(\r\n        \".main-waterdrop .objective-label, .main-waterdrop .volume-not-height, .waterdrop-explain-pag\"\r\n      );\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.selectAll(\".vardrop\")\r\n        .style(\"display\", \"none\")\r\n        .classed(\"hasarrow\", false);\r\n\r\n      showElems(\r\n        \".main-waterdrop .objective-label, .main-waterdrop .volume-not-height, .waterdrop-explain-pag\"\r\n      );\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initFillVarDropsAnim({ deps }) {\r\n    function animDo() {\r\n      d3.selectAll(\".vardrop path\").style(\"stroke-dasharray\", \"none\");\r\n      deps.setVariationInterpers(constants.VARIATIONS_INTERPERS);\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.selectAll(\".vardrop path\").style(\"stroke-dasharray\", \"10 10\");\r\n      deps.setVariationInterpers(\r\n        constants.VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n      );\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initShowScenLabelAnim() {\r\n    return {\r\n      do: function () {\r\n        d3.selectAll(\".var-scen-label\").style(\"display\", \"block\");\r\n      },\r\n      undo: function () {\r\n        d3.selectAll(\".var-scen-label\").style(\"display\", \"none\");\r\n      },\r\n    };\r\n  }\r\n\r\n  function initHighlightBestAnim() {\r\n    return {\r\n      do: function () {\r\n        d3.select(\".drop1\").classed(\"highlighted\", true);\r\n      },\r\n      undo: function () {\r\n        d3.select(\".drop1\").classed(\"highlighted\", false);\r\n      },\r\n    };\r\n  }\r\n\r\n  function initShowQuantilesAnim() {\r\n    function animDo() {\r\n      d3.select(\".drop1\").classed(\"highlighted\", false);\r\n      d3.selectAll(\".vardrop\").classed(\"hasarrow\", false);\r\n\r\n      d3.selectAll(\".var-scen-label\").style(\"opacity\", \"0.5\");\r\n      d3.selectAll(\".var-scen-label, .scen-number\").style(\"color\", \"gray\");\r\n\r\n      d3.select(\".main-waterdrop\")\r\n        .transition()\r\n        .style(\"transform\", \"translateY(-100px) scale(0.5)\");\r\n      // undo scaling of label due to shrinking div\r\n      d3.select(\".main-waterdrop .var-scen-label\")\r\n        .transition()\r\n        .style(\"transform\", \"scale(2)\");\r\n      d3.selectAll(\".drop1 .waterdrop-wrapper, .drop3 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"translate(-50px, 15px) scale(0.5)\");\r\n      d3.selectAll(\".drop2 .waterdrop-wrapper, .drop4 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"translate(50px, 15px) scale(0.5)\");\r\n\r\n      d3.select(\".main-histogram\").style(\"display\", \"initial\");\r\n      d3.selectAll(\".vardrop .dot-histogram-wrapper\").style(\"display\", \"flex\");\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.select(\".drop1\").classed(\"highlighted\", true);\r\n      d3.selectAll(\".vardrop\").classed(\"hasarrow\", true);\r\n\r\n      d3.selectAll(\".var-scen-label\").style(\"opacity\", \"1\");\r\n      d3.selectAll(\".var-scen-label\").style(\"color\", \"black\");\r\n      d3.selectAll(\".scen-number\").style(\"color\", \"orange\");\r\n\r\n      d3.select(\".main-waterdrop\").transition().style(\"transform\", \"none\");\r\n      // undo scaling of label due to shrinking div\r\n      d3.select(\".main-waterdrop .var-scen-label\")\r\n        .transition()\r\n        .style(\"transform\", \"scale(1)\");\r\n      d3.selectAll(\".drop1 .waterdrop-wrapper, .drop3 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"none\");\r\n      d3.selectAll(\".drop2 .waterdrop-wrapper, .drop4 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"none\");\r\n\r\n      d3.select(\".main-histogram\").style(\"display\", \"none\");\r\n      d3.selectAll(\".vardrop .dot-histogram-wrapper\").style(\"display\", \"none\");\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initComparerAnimGroup({ deps }) {\r\n    function showPAGAnimDo() {\r\n      hideElems(\".scrollama-compare-scenobjs .waterdrop-graphics-wrapper\");\r\n      showElems(\".scrollama-compare-scenobjs .tut-comparer-graphics-wrapper\");\r\n    }\r\n\r\n    function showPAGAnimUndo() {\r\n      showElems(\r\n        \".scrollama-compare-scenobjs .waterdrop-graphics-wrapper\",\r\n        d3,\r\n        \"grid\"\r\n      );\r\n      hideElems(\".scrollama-compare-scenobjs .tut-comparer-graphics-wrapper\");\r\n    }\r\n\r\n    function showPRFAnimDo() {\r\n      deps.largeDropComparer.showOtherDrop();\r\n      showElems(\".bigdrop-explain\");\r\n      d3.select(\".tut-comparer-graphics-wrapper #comparer-graphics\").style(\r\n        \"transform\",\r\n        `translateX(${-window.innerHeight * 0.25}px)`\r\n      );\r\n    }\r\n\r\n    function showPRFAnimUndo() {\r\n      deps.largeDropComparer.hideOtherDrop();\r\n      hideElems(\".bigdrop-explain\");\r\n      d3.select(\".tut-comparer-graphics-wrapper #comparer-graphics\").style(\r\n        \"transform\",\r\n        `none`\r\n      );\r\n    }\r\n\r\n    return {\r\n      showPAG: {\r\n        do: showPAGAnimDo,\r\n        undo: showPAGAnimUndo,\r\n      },\r\n      showPRF: {\r\n        do: showPRFAnimDo,\r\n        undo: showPRFAnimUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  return {\r\n    initShowLocationAnimGroup,\r\n    initChartAnimGroup,\r\n    initBucketsFillAnim,\r\n    initMoveBucketsAnim,\r\n    initDropFillAnim,\r\n    initChangeRealityAnim,\r\n    initFillVarDropsAnim,\r\n    initShowScenLabelAnim,\r\n    initHighlightBestAnim,\r\n    initShowQuantilesAnim,\r\n    initComparerAnimGroup,\r\n  };\r\n}\r\n\r\nexport const animations = initAllAnims();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\n\r\nexport function createInterpsFromDelivs(delivs, minDelivs, maxDelivs) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(\r\n      delivs.map((v) => Math.min(1, (v - minDelivs) / (maxDelivs - minDelivs)))\r\n    )\r\n    .clamp(true);\r\n}\r\n\r\n// TODO fix colors\r\nexport function calcDomLev(levs) {\r\n  levs = [1, ...levs, 0];\r\n\r\n  let mean = 0;\r\n  for (let i = 0; i < levs.length - 1; i++) {\r\n    const dif = levs[i] - levs[i + 1];\r\n    mean += (dif * (i - 1)) / (levs.length + 4);\r\n  }\r\n\r\n  return mean;\r\n}\r\n\r\n// TODO combine these arrays to just one array of objects\r\nexport const SETT_NAME_SHORT = [\"D\", \"C\", \"P\", \"R\", \"M\"];\r\nexport const SETT_NAME_FULL = [\r\n  \"Demand\",\r\n  \"Carryover\",\r\n  \"Priority\",\r\n  \"Regs.\",\r\n  \"Min. Flow\",\r\n];\r\nexport const SETT_VAL_STEPS = [\r\n  [1, 0.9, 0.8, 0.7, 0.6].reverse(), // demand\r\n  [1.0, 1.2, 1.3], // carryover\r\n  [0, 1], // priority\r\n  [1, 2, 3, 4], // regs\r\n  [0, 0.4, 0.6, 0.7, 0.8], // minflow\r\n];\r\n\r\nexport const SETT_NUM_OPTS = {\r\n  demand: SETT_VAL_STEPS[0].length,\r\n  carryover: SETT_VAL_STEPS[1].length,\r\n  priority: SETT_VAL_STEPS[2].length,\r\n  regs: SETT_VAL_STEPS[3].length,\r\n  minflow: SETT_VAL_STEPS[4].length,\r\n};\r\n\r\nexport const SETT_DESC = [\r\n  String.raw`Reduce total agriculture demands\r\n(1) Reduce 40%\r\n(2) Reduce 30%\r\n(3) Reduce 20%\r\n(4) Reduce 10%\r\n(5) Baseline`,\r\n\r\n  String.raw`Modify balance of reservoir storage and delivery\r\n(1) Baseline\r\n(2) Increase carryover (relative to delivery) 10%\r\n(3) Increase carryover to 20%`,\r\n\r\n  String.raw`Modify how CVP cuts are distributed during times of shortage\r\n(1) Baseline\r\n(2) Equal cuts`,\r\n\r\n  String.raw`Selective removal/activation of D1641 regulations\r\n(1) Baseline (all \"on\")\r\n(2) No NDO, Rio Vista min flows\r\n(3) No X2/salinity\r\n(4) Combined no NDO + no X2`,\r\n\r\n  String.raw`Modify/add minimum flow on Central Valley tributaries\r\n(1) Baseline\r\n(2) 40% unimpaired flow on main tributaries\r\n(3) 60% unimpaired flow\r\n(4) 70% unimpaired flow\r\n(5) 80% unimpaired flow`,\r\n];\r\n\r\nexport function deserialize(scenStr) {\r\n  let scenNum = parseInt(scenStr);\r\n\r\n  const minflow = scenNum % SETT_NUM_OPTS.minflow;\r\n  scenNum = (scenNum - minflow) / SETT_NUM_OPTS.minflow;\r\n\r\n  const regs = scenNum % SETT_NUM_OPTS.regs;\r\n  scenNum = (scenNum - regs) / SETT_NUM_OPTS.regs;\r\n\r\n  const priority = scenNum % SETT_NUM_OPTS.priority;\r\n  scenNum = (scenNum - priority) / SETT_NUM_OPTS.priority;\r\n\r\n  const carryover = scenNum % SETT_NUM_OPTS.carryover;\r\n  scenNum = (scenNum - carryover) / SETT_NUM_OPTS.carryover;\r\n\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demand = scenNum % SETT_NUM_OPTS.demand;\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n\r\n  return [demandReverse, carryover, priority, regs, minflow];\r\n}\r\n\r\nexport function serialize(demand, carryover, priority, regs, minflow) {\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n  let code = 0;\r\n  code += minflow;\r\n  code += SETT_NUM_OPTS.minflow * regs;\r\n  code += SETT_NUM_OPTS.regs * SETT_NUM_OPTS.minflow * priority;\r\n  code +=\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    carryover;\r\n  code +=\r\n    SETT_NUM_OPTS.carryover *\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    demandReverse;\r\n\r\n  const finalKey = `expl${d3.format(\"0>4\")(code)}`;\r\n\r\n  return finalKey;\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { settings } from \"settings\";\r\n\r\nimport { dropCenterCorrection } from \"utils/math-utils\";\r\nimport {\r\n  DROPLET_SHAPE,\r\n  circlet,\r\n  gradientInit,\r\n  gradientUpdate,\r\n} from \"utils/render-utils\";\r\n\r\nfunction smallDropInit({ levs, id }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"small-drop hover-capture\");\r\n\r\n    const idStr = `drop-fill-${id}`;\r\n\r\n    s.call(gradientInit(levs, idStr));\r\n\r\n    s.append(\"path\").attr(\"d\", DROPLET_SHAPE).attr(\"class\", \"outline\");\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${idStr})`);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"circlet interactive\")\r\n      .call(circlet)\r\n      .attr(\"cy\", -dropCenterCorrection({ rad: 1 }))\r\n      .attr(\"r\", 1.5);\r\n\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, id, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n    s.select(\".outline\").attr(\r\n      \"transform\",\r\n      `scale(${settings.LOD_1_RAD_PX * 0.95})`\r\n    );\r\n    s.select(\".fill\").attr(\"transform\", `scale(${settings.LOD_1_RAD_PX})`);\r\n\r\n    s.select(\".circlet\").attr(\"id\", `i${id}`);\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction updateSmallDropSVG(\r\n  container,\r\n  waterdropGroup,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartLoc = ({ globalX, globalY, globalTilt }) =>\r\n    `translate(${globalX}, ${globalY}) rotate(${globalTilt})`;\r\n  const getEndLoc = ({ x, y, tilt }) =>\r\n    `translate(${waterdropGroup.x + x * settings.SPREAD_1_2}, ${\r\n      waterdropGroup.y + y * settings.SPREAD_1_2\r\n    }) rotate(${tilt})`;\r\n\r\n  const baselinePos = {};\r\n\r\n  const drops = container\r\n    .selectAll(\".small-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartLoc)\r\n    .each(function (node) {\r\n      d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n    });\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n\r\n  drops\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndLoc);\r\n\r\n  const circlePosX = waterdropGroup.x + baselinePos.x * settings.SPREAD_1_2,\r\n    circlePosY =\r\n      waterdropGroup.y +\r\n      baselinePos.y * settings.SPREAD_1_2 -\r\n      dropCenterCorrection({ rad: settings.LOD_1_RAD_PX });\r\n\r\n  const textPosX =\r\n      waterdropGroup.x + (waterdropGroup.height * settings.SPREAD_1_2) / 2,\r\n    textPosY =\r\n      waterdropGroup.y - (waterdropGroup.height * settings.SPREAD_1_2) / 2;\r\n\r\n  const fontSize = waterdropGroup.height / 20;\r\n  const lineWidth = waterdropGroup.height / 100;\r\n\r\n  container\r\n    .select(\".highlight-circle\")\r\n    .attr(\"stroke\", \"none\")\r\n    .attr(\"fill\", \"yellow\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX * 2)\r\n    .attr(\"cx\", circlePosX)\r\n    .attr(\"cy\", circlePosY);\r\n\r\n  container\r\n    .select(\".baseline-pointer path\")\r\n    .attr(\r\n      \"d\",\r\n      d3\r\n        .line()\r\n        .x((d) => d[0])\r\n        .y((d) => d[1])([\r\n        [circlePosX, circlePosY],\r\n        [textPosX, textPosY],\r\n      ])\r\n    )\r\n    .attr(\"stroke-width\", lineWidth);\r\n  container\r\n    .select(\".baseline-pointer text\")\r\n    .attr(\"class\", \"fancy-font\")\r\n    .attr(\"font-size\", fontSize)\r\n    .attr(\"transform\", `translate(${textPosX + fontSize}, ${textPosY})`);\r\n}\r\n\r\nfunction updateColorDrops(container, waterdropGroup, opacFn, color) {\r\n  container\r\n    .selectAll(\".color-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"color-drop\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX)\r\n    .attr(\"opacity\", ({ key }) => opacFn(key))\r\n    .attr(\"fill\", color)\r\n    .attr(\"cx\", ({ x }) => waterdropGroup.x + x * settings.SPREAD_1_2)\r\n    .attr(\"cy\", ({ y }) => waterdropGroup.y + y * settings.SPREAD_1_2);\r\n}\r\n\r\nexport const helpers = {\r\n  updateSmallDropSVG,\r\n  updateColorDrops,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport Matter from \"matter-js\";\r\n\r\nimport { CIRC_RAD, DROP_HEIGHT } from \"./render-utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor(Math.sqrt(AREA / 3.14));\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(\r\n  x,\r\n  y,\r\n  nodes,\r\n  packingFactor = 1,\r\n  reuse = false\r\n) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r)) / packingFactor;\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport function interp(x, a, b) {\r\n  return x * (b - a) + a;\r\n}\r\n\r\nexport function revInterp(t, a, b) {\r\n  return (t - a) / (b - a);\r\n}\r\n\r\nexport function distSq([x1, y1], [x2, y2]) {\r\n  return (x2 - x1) ** 2 + (y2 - y1) ** 2;\r\n}\r\n\r\nexport function dist([x1, y1], [x2, y2]) {\r\n  return Math.sqrt(distSq([x1, y1], [x2, y2]));\r\n}\r\n\r\nexport function getCenterDomRect(domRect) {\r\n  return [domRect.left + domRect.width / 2, domRect.top + domRect.height / 2];\r\n}\r\n\r\nexport function clipEnds([from, to], shortenByStart, shortenByEnd) {\r\n  const len = Math.sqrt((from[0] - to[0]) ** 2 + (from[1] - to[1]) ** 2);\r\n  const normed = [(to[0] - from[0]) / len, (to[1] - from[1]) / len];\r\n\r\n  if (shortenByEnd === undefined) shortenByEnd = shortenByStart;\r\n\r\n  from[0] += normed[0] * shortenByStart;\r\n  from[1] += normed[1] * shortenByStart;\r\n  to[0] -= normed[0] * shortenByEnd;\r\n  to[1] -= normed[1] * shortenByEnd;\r\n\r\n  return [from, to];\r\n}\r\n\r\nexport function dropRadToDropHeight(rad) {\r\n  return (1 + Math.SQRT2) * rad;\r\n}\r\n\r\nexport function dropCenterCorrection({ rad, height }) {\r\n  if (rad !== undefined) return dropRadToDropHeight(rad) * 0.08;\r\n  return height * 0.08;\r\n}\r\n\r\nexport function avgCoords(coords) {\r\n  return [d3.mean(coords, (c) => c[0]), d3.mean(coords, (c) => c[1])];\r\n}\r\n\r\nexport function rotatePoint(x, y, deg) {\r\n  const vec = new THREE.Vector3(x, y, 0).applyEuler(\r\n    new THREE.Euler(0, 0, toRadians(deg))\r\n  );\r\n  return [vec.x, vec.y];\r\n}\r\n\r\n// modifies arr!\r\nexport function rotatePoints(arr, deg) {\r\n  for (const a of arr) {\r\n    const newPoint = rotatePoint(a[0], a[1], deg);\r\n    a[0] = newPoint[0];\r\n    a[1] = newPoint[1];\r\n  }\r\n  return arr;\r\n}\r\n\r\n// https://stackoverflow.com/a/2450976\r\nexport function shuffle(array) {\r\n  let currentIndex = array.length;\r\n\r\n  // While there remain elements to shuffle...\r\n  while (currentIndex != 0) {\r\n    // Pick a remaining element...\r\n    let randomIndex = Math.floor(Math.random() * currentIndex);\r\n    currentIndex--;\r\n\r\n    // And swap it with the current element.\r\n    [array[currentIndex], array[randomIndex]] = [\r\n      array[randomIndex],\r\n      array[currentIndex],\r\n    ];\r\n  }\r\n\r\n  return array;\r\n}\r\n","import { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\n// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    if (typeof v === \"function\")\r\n      _setState((curVal) => (stateRef.current = v(curVal)));\r\n    else _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n\r\nexport function isState(stateInfo, stateName) {\r\n  return stateInfo && stateInfo.state === stateName;\r\n}\r\n\r\nexport function wrap(s, len = 15) {\r\n  return s.replace(\r\n    new RegExp(`(?![^\\\\n]{1,${len}}$)([^\\\\n]{1,${len}})\\\\s`, \"g\"),\r\n    \"$1\\n\"\r\n  );\r\n}\r\n\r\nexport function genUUID() {\r\n  return Math.floor(Math.random() * 1e9);\r\n}\r\n\r\nexport function arrRemove(arr, item) {\r\n  let idx;\r\n  if (typeof item === \"function\") {\r\n    idx = arr.findIndex(item);\r\n  } else {\r\n    idx = arr.indexOf(item);\r\n  }\r\n  if (idx !== -1) arr.splice(idx, 1);\r\n  return arr;\r\n}\r\n\r\nexport function copyCoords(arr) {\r\n  return arr.map((a) => Array.from(a));\r\n}\r\n\r\n// https://www.geeksforgeeks.org/implement-search-box-with-debounce-in-javascript/\r\nexport const debounce = (fn, delay = 1000) => {\r\n  let timerId = null;\r\n  return (...args) => {\r\n    clearTimeout(timerId);\r\n    timerId = setTimeout(() => fn(...args), delay);\r\n  };\r\n};\r\n","import {\r\n  interpolateWatercolorBlue,\r\n  levelToDropletLevel,\r\n} from \"bucket-lib/utils\";\r\nimport * as d3 from \"d3\";\r\nimport { settings } from \"settings\";\r\nimport { wrap } from \"utils/misc-utils\";\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport const CIRC_RAD = Math.SQRT1_2;\r\nexport const DROP_RAD = 1;\r\nexport const CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nexport const DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = (CIRC_RAD + DROP_RAD / 2) / DROP_HEIGHT;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2, subdivs = 10) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 1 / subdivs;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function circlet(s) {\r\n  s.attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke\", \"orange\")\r\n    .attr(\"stroke-dasharray\", 3)\r\n    .attr(\"stroke-width\", 3)\r\n    .attr(\"vector-effect\", \"non-scaling-stroke\");\r\n}\r\n\r\nexport function showElems(elemStr, container, displayVal) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", displayVal || \"block\");\r\n}\r\n\r\nexport function hideElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", \"none\");\r\n}\r\n\r\nexport function removeElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).remove();\r\n}\r\n\r\nexport function gradientInit(levs, gradId) {\r\n  return (s) => {\r\n    const stops = s\r\n      .append(\"defs\")\r\n      .append(\"linearGradient\")\r\n      .attr(\"id\", gradId)\r\n      .attr(\"x1\", \"0%\")\r\n      .attr(\"x2\", \"0%\")\r\n      .attr(\"y1\", \"0%\")\r\n      .attr(\"y2\", \"100%\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n    levs.forEach((_, i) => {\r\n      for (let j = 0; j < 2; j++) {\r\n        stops\r\n          .append(\"stop\")\r\n          .attr(\r\n            \"stop-color\",\r\n            interpolateWatercolorBlue(i / settings.LOD_1_LEVELS)\r\n          );\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nexport function gradientUpdate(levs, maxLev) {\r\n  return (s) => {\r\n    s.selectAll(\"stop\").each(function (_, i) {\r\n      // first stop is at 0\r\n      if (i === 0) {\r\n        d3.select(this).attr(\"offset\", `0%`);\r\n        return;\r\n      }\r\n\r\n      // last stop is at 100\r\n      if (i === (levs.length + 1) * 2 - 1) {\r\n        d3.select(this).attr(\"offset\", `100%`);\r\n        return;\r\n      }\r\n\r\n      let valOffset = Math.floor((i - 1) / 2);\r\n\r\n      d3.select(this).attr(\r\n        \"offset\",\r\n        `${(1 - levelToDropletLevel(levs[valOffset] / maxLev)) * 100}%`\r\n      );\r\n    });\r\n  };\r\n}\r\n\r\nexport function worldToScreen(x, y, camTransform) {\r\n  return [\r\n    x * camTransform.k + camTransform.x,\r\n    y * camTransform.k + camTransform.y,\r\n  ];\r\n}\r\n\r\nexport function screenToWorld(x, y, camTransform) {\r\n  return [\r\n    (x - camTransform.x) / camTransform.k,\r\n    (y - camTransform.y) / camTransform.k,\r\n  ];\r\n}\r\n\r\nexport function generateTSpan(text, lineHeight = 1.2, len = 15) {\r\n  return (s) => {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = typeof text === \"string\" ? wrap(text, len).split(\"\\n\") : text;\r\n\r\n    const x = s.attr(\"x\");\r\n\r\n    lines.forEach((line) => {\r\n      s.append(\"tspan\").attr(\"x\", x).attr(\"dy\", `${lineHeight}em`).text(line);\r\n    });\r\n  };\r\n}\r\n","import React from \"react\";\r\n\r\nfunction initScripts() {\r\n  return {\r\n    howMuchIntro: (\r\n      <div className=\"tut-text-card hero\">\r\n        <em>How much water do the people of California get?</em> Let's focus on\r\n        two groups of people:\r\n      </div>\r\n    ),\r\n    norCal: (\r\n      <div className=\"tut-text-card\">the agriculture group in the north...</div>\r\n    ),\r\n    soCal: (\r\n      <div className=\"tut-text-card\">...and the refuge group in the south.</div>\r\n    ),\r\n    barsExplain: (\r\n      <div className=\"tut-text-card\">\r\n        Here, it is presented as bar graphs, with the bottom axis representing\r\n        the year and the side axis representing the amount of water delivered in\r\n        thousand acre-feet (TAF).\r\n      </div>\r\n    ),\r\n    barsCondense: (\r\n      <div className=\"tut-text-card\">\r\n        We'll condense each bar graph into a single bar with a filled gradient.\r\n      </div>\r\n    ),\r\n    bucketsFill: (\r\n      <div className=\"tut-text-card\">\r\n        What we get are buckets of water showing which water levels are most\r\n        likely, with the darker areas being the most likely water levels.\r\n        <span className=\"supplement-card-info\">\r\n          Visuals made using{\" \"}\r\n          <a href=\"https://sarahayu.github.io/bucket-glyph/\" target=\"_blank\">\r\n            Bucket-Glyph\r\n          </a>\r\n        </span>\r\n      </div>\r\n    ),\r\n    comparingTheTwo: <span></span>,\r\n    forNowLetsFocus: <span></span>,\r\n    ifChangeReality: (\r\n      <div className=\"tut-text-card\">\r\n        But what if we could <em>change reality</em>? What if we could increase\r\n        the likelihood of delivering as much water as possible by changing the\r\n        way we manage it?\r\n      </div>\r\n    ),\r\n    fortunateCanExplore: (\r\n      <div className=\"tut-text-card\">\r\n        Fortunately, we can explore those possibilities with the help of a\r\n        simulator called\r\n        <b> CalSim</b>.\r\n      </div>\r\n    ),\r\n    theseVarsCalled: (\r\n      <div className=\"tut-text-card\">\r\n        These variations are called <em>scenarios</em> and are labelled with\r\n        unique numbers. Our reality is a scenario with no variables changed,\r\n        labelled scenario 0000.\r\n      </div>\r\n    ),\r\n    atAGlance: (\r\n      <div className=\"tut-text-card\">\r\n        At a glance, we can easily see that scenario 0020 appears to be the best\r\n        scenario since the darker water levels reach higher than those of the\r\n        other scenarios. To more concretely compare these scenarios, however,\r\n        we'll use a different view.\r\n      </div>\r\n    ),\r\n    tryMoveRed: (\r\n      <div className=\"tut-text-card\">\r\n        Try moving the red line to change the minimum demand and see how well\r\n        each of these scenarios meet those demands.\r\n      </div>\r\n    ),\r\n    soWhyNot: (\r\n      <div className=\"tut-text-card\">\r\n        So why don't we just choose the best scenario? Well, it's because it's\r\n        not just this group that wants water. Other groups, which we call{\" \"}\r\n        <em>objectives</em>, want scenarios that best fit <em>them.</em>\r\n      </div>\r\n    ),\r\n    letsBringRefuge: <span></span>,\r\n  };\r\n}\r\n\r\nexport const scripts = initScripts();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact, levelToDropletLevel } from \"bucket-lib/utils\";\r\n\r\nimport { objectivesData } from \"data/objectives-tutorial-data\";\r\n\r\nfunction initConstants() {\r\n  const BAR_CHART_WIDTH = 500,\r\n    BAR_CHART_HEIGHT = 400;\r\n\r\n  const INTERP_COLOR = d3.interpolateRgbBasis([\r\n    \"#F2F5FB\",\r\n    \"#D0DDEB\",\r\n    \"#7B9BC0\",\r\n    \"#4F739F\",\r\n    \"#112A57\",\r\n  ]);\r\n\r\n  const PAG_OBJECTIVE = \"DEL_CVP_PAG_N\";\r\n  const PRF_OBJECTIVE = \"DEL_CVP_PRF_S\";\r\n\r\n  const PAG_COLOR = \"#008080\";\r\n  const PRF_COLOR = \"#ff6347\";\r\n\r\n  const DEFAULT_SCENARIO = \"expl0000\";\r\n\r\n  const PAG_DELIVS =\r\n    objectivesData.OBJECTIVES_DATA[PAG_OBJECTIVE][\r\n      objectivesData.SCENARIO_KEY_STRING\r\n    ][DEFAULT_SCENARIO][objectivesData.DELIV_KEY_STRING];\r\n  const PRF_DELIVS =\r\n    objectivesData.OBJECTIVES_DATA[PRF_OBJECTIVE][\r\n      objectivesData.SCENARIO_KEY_STRING\r\n    ][DEFAULT_SCENARIO][objectivesData.DELIV_KEY_STRING];\r\n\r\n  const VARIATIONS = [\r\n    \"expl0020\", // change priority\r\n    \"expl0080\", // increase carryover\r\n    \"expl0480\", // decrease demand\r\n    \"expl0004\", // increase minflow\r\n  ];\r\n\r\n  const VARIATIONS_DELIVS = VARIATIONS.map(\r\n    (vars) =>\r\n      objectivesData.OBJECTIVES_DATA[PAG_OBJECTIVE][\r\n        objectivesData.SCENARIO_KEY_STRING\r\n      ][vars][objectivesData.DELIV_KEY_STRING]\r\n  );\r\n\r\n  const VARIATIONS_INTERPERS = VARIATIONS_DELIVS.map(\r\n    (varDelivs) => (val) =>\r\n      levelToDropletLevel(\r\n        d3\r\n          .scaleLinear()\r\n          .domain(ticksExact(0, 1, varDelivs.length))\r\n          .range(\r\n            varDelivs\r\n              .map((v) => v / objectivesData.MAX_DELIVS)\r\n              .sort()\r\n              .reverse()\r\n          )\r\n          .clamp(true)(val)\r\n      )\r\n  );\r\n\r\n  const PAG_INTERPER = (val) =>\r\n    d3\r\n      .scaleLinear()\r\n      .domain(ticksExact(0, 1, PAG_DELIVS.length))\r\n      .range(\r\n        PAG_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n          .sort()\r\n          .reverse()\r\n      )\r\n      .clamp(true)(val);\r\n\r\n  const PAG_INTERPER_DROP = (val) =>\r\n    levelToDropletLevel(\r\n      d3\r\n        .scaleLinear()\r\n        .domain(ticksExact(0, 1, PAG_DELIVS.length))\r\n        .range(\r\n          PAG_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n            .sort()\r\n            .reverse()\r\n        )\r\n        .clamp(true)(val)\r\n    );\r\n\r\n  const PRF_INTERPER = (val) =>\r\n    d3\r\n      .scaleLinear()\r\n      .domain(ticksExact(0, 1, PRF_DELIVS.length))\r\n      .range(\r\n        PRF_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n          .sort()\r\n          .reverse()\r\n      )\r\n      .clamp(true)(val);\r\n\r\n  const DROP_VARIATIONS = [\r\n    {\r\n      idx: 0,\r\n      scen: \"0020\",\r\n      clas: \"drop1\",\r\n      desc: \"change priority\",\r\n    },\r\n    {\r\n      idx: 1,\r\n      scen: \"0080\",\r\n      clas: \"drop2\",\r\n      desc: \"increase carryover\",\r\n    },\r\n    {\r\n      idx: 2,\r\n      scen: \"0480\",\r\n      clas: \"drop3\",\r\n      desc: \"decrease demand\",\r\n    },\r\n    {\r\n      idx: 3,\r\n      scen: \"0004\",\r\n      clas: \"drop4\",\r\n      desc: \"increase minimum flow\",\r\n    },\r\n  ];\r\n\r\n  return {\r\n    BAR_CHART_WIDTH,\r\n    BAR_CHART_HEIGHT,\r\n    INTERP_COLOR,\r\n    PAG_OBJECTIVE,\r\n    PRF_OBJECTIVE,\r\n    PAG_COLOR,\r\n    PRF_COLOR,\r\n    DEFAULT_SCENARIO,\r\n    PAG_DELIVS,\r\n    PRF_DELIVS,\r\n    VARIATIONS,\r\n    VARIATIONS_DELIVS,\r\n    VARIATIONS_INTERPERS,\r\n    PAG_INTERPER,\r\n    PAG_INTERPER_DROP,\r\n    PRF_INTERPER,\r\n    DROP_VARIATIONS,\r\n  };\r\n}\r\n\r\nconst constants = initConstants();\r\n\r\nexport { constants };\r\n","import { ticksExact } from \"bucket-lib/utils\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { calcDomLev, createInterpsFromDelivs } from \"utils/data-utils\";\r\nimport { placeDropsUsingPhysics, rotatePoint } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\n// TODO optimize!!\r\nfunction initWaterdrops(objectivesData, descriptionsData, grouping) {\r\n  console.time(\"init waterdrops\");\r\n  const groupKeys =\r\n    grouping === \"objective\"\r\n      ? objectivesData.OBJECTIVE_IDS\r\n      : objectivesData.SCENARIO_IDS;\r\n  const memberKeys =\r\n    grouping === \"objective\"\r\n      ? objectivesData.SCENARIO_IDS\r\n      : objectivesData.OBJECTIVE_IDS;\r\n\r\n  const amtGroups = groupKeys.length;\r\n  const amtPerGroup = memberKeys.length;\r\n\r\n  const largeDropRad =\r\n    Math.sqrt(amtPerGroup / Math.PI) *\r\n    settings.LOD_1_RAD_PX *\r\n    2 *\r\n    settings.LOD_1_SMALL_DROP_PAD_FACTOR *\r\n    settings.LOD_1_LARGE_DROP_PAD_FACTOR;\r\n  const smallDropRad =\r\n    settings.LOD_1_RAD_PX * settings.LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  const largeNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    groupKeys.map((p, idx) => ({\r\n      r: largeDropRad,\r\n      id: idx,\r\n    })),\r\n    0.8\r\n  );\r\n\r\n  for (let i = 0; i < largeNodesPhys.length; i++) {\r\n    largeNodesPhys[i].tilt = Math.random() * 40 - 20;\r\n  }\r\n\r\n  const largeNodesPos = mapBy(largeNodesPhys, ({ id }) => id);\r\n\r\n  const smallNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    memberKeys.map((s, idx) => ({\r\n      r: smallDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const smallNodesPos = mapBy(smallNodesPhys, ({ id }) => id);\r\n\r\n  const nodes = [];\r\n  const groupNodes = [];\r\n\r\n  const groupToNodes = {};\r\n\r\n  let idx = 0;\r\n\r\n  for (const nodeData of objectivesData.FLATTENED_DATA) {\r\n    const { id, objective, scenario, deliveries } = nodeData;\r\n\r\n    const [delivMin, delivMax] = objectivesData.MIN_MAXES[objective];\r\n\r\n    const i = createInterpsFromDelivs(deliveries, delivMin, delivMax);\r\n    const wds = ticksExact(0, 1, settings.LOD_1_LEVELS + 1).map((d) => i(d));\r\n\r\n    const levs = wds.map(\r\n      (w, i) =>\r\n        Math.max(w, i == 0 ? settings.LOD_1_MIN_LEV_VAL : 0) *\r\n        settings.LOD_1_RAD_PX\r\n    );\r\n\r\n    const groupID = grouping === \"objective\" ? objective : scenario;\r\n    const memberID = grouping === \"objective\" ? scenario : objective;\r\n\r\n    const groupRank = objectivesData.DATA_GROUPINGS[grouping][groupID].rank;\r\n    const memberRank = objectivesData.DATA_GROUPINGS[grouping][groupID][id];\r\n\r\n    const localTilt = Math.random() * 50 - 25;\r\n    const parentTilt = largeNodesPos[groupRank].tilt;\r\n\r\n    const { x, y } = smallNodesPos[memberRank];\r\n    const [rotatedX, rotatedY] = rotatePoint(x, y, parentTilt);\r\n\r\n    const node = {\r\n      id,\r\n      levs,\r\n      maxLev: settings.LOD_1_RAD_PX,\r\n      domLev: calcDomLev(levs),\r\n      tilt: localTilt,\r\n      dur: Math.random() * 100 + 400,\r\n      x,\r\n      y,\r\n      group: groupID,\r\n      key: memberID,\r\n      globalX: largeNodesPos[groupRank].x + rotatedX,\r\n      globalY: largeNodesPos[groupRank].y + rotatedY,\r\n      globalTilt: parentTilt + localTilt,\r\n    };\r\n\r\n    nodes.push(node);\r\n\r\n    if (!groupToNodes[groupID]) groupToNodes[groupID] = [];\r\n\r\n    groupToNodes[groupID].push(node);\r\n  }\r\n\r\n  for (const groupKey of groupKeys) {\r\n    const { x, y, tilt } =\r\n      largeNodesPos[objectivesData.DATA_GROUPINGS[grouping][groupKey].rank];\r\n    groupNodes.push({\r\n      x,\r\n      y,\r\n      tilt,\r\n      key: groupKey,\r\n      height: smallNodesPhys.height,\r\n      nodes: groupToNodes[groupKey],\r\n      display_name: descriptionsData[groupKey].display_name || groupKey,\r\n    });\r\n  }\r\n\r\n  console.timeEnd(\"init waterdrops\");\r\n\r\n  return {\r\n    nodes: nodes,\r\n    groups: groupNodes,\r\n    height: largeNodesPhys.height,\r\n  };\r\n}\r\n\r\nexport { initWaterdrops };\r\n","import * as d3 from \"d3\";\r\n\r\nimport { spatialData } from \"data/spatial-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { dist, dropCenterCorrection, getCenterDomRect } from \"utils/math-utils\";\r\nimport { wrap } from \"utils/misc-utils\";\r\nimport { circlet } from \"utils/render-utils\";\r\n\r\nfunction interactorsInit() {\r\n  const s = d3.select(this);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"hover-capture\")\r\n    .attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke-width\", 0)\r\n    .attr(\"r\", 0.8);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"circlet interactive\")\r\n    .call(circlet)\r\n    .attr(\"r\", 1);\r\n\r\n  const textGroup = s.append(\"g\").attr(\"pointer-events\", \"none\");\r\n  textGroup\r\n    .append(\"image\")\r\n    .attr(\"href\", \"glow.png\")\r\n    .attr(\"preserveAspectRatio\", \"none\")\r\n    .attr(\"opacity\", 0.8);\r\n  textGroup\r\n    .append(\"text\")\r\n    .attr(\"class\", \"fancy-font cloud-text\")\r\n    .attr(\"text-anchor\", \"middle\")\r\n    .attr(\"font-size\", 0);\r\n}\r\n\r\nfunction interactorsUpdate(d) {\r\n  d3.select(this).select(\".circlet\").attr(\"id\", `b${d.key}`);\r\n  d3.select(this).select(\"text\").call(textUpdate(d));\r\n}\r\n\r\nfunction textUpdate(d) {\r\n  return function (s) {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = wrap(d.display_name).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      s.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", `${-lines.length / 2 + 0.5}em`)\r\n        .attr(\"dy\", `${i}em`)\r\n        .text(line);\r\n    });\r\n  };\r\n}\r\n\r\nfunction dropTransform({ x, y, height }) {\r\n  return `translate(${x}, ${y - dropCenterCorrection({ height })}) scale(${\r\n    height * settings.GROUP_HOVER_AREA_FACTOR\r\n  })`;\r\n}\r\n\r\nfunction getFontSize(d, transformZoom, cameraHeight, waterdropsHeight) {\r\n  const MAX_RAD = window.innerHeight / 9;\r\n\r\n  const zoomRel = cameraHeight / waterdropsHeight / transformZoom;\r\n\r\n  const absFontSize = (_d) =>\r\n    _d > MAX_RAD\r\n      ? 0\r\n      : d3.scaleLinear().domain([0, MAX_RAD]).range([1, 0.4]).clamp(true)(_d);\r\n\r\n  return absFontSize(d * zoomRel) * Math.min(zoomRel, 0.4);\r\n}\r\n\r\nfunction drawMinimapSVG() {\r\n  const width = 250,\r\n    height = 300;\r\n\r\n  const minimap = d3\r\n    .select(\"#minimap\")\r\n    .attr(\"width\", width)\r\n    .attr(\"height\", height);\r\n\r\n  const proj = d3\r\n    .geoMercator()\r\n    .scale(1000)\r\n    .center(spatialData.CALIFORNIA_CENTER)\r\n    .translate([width / 2, height / 2]);\r\n\r\n  const lineGeom = [\r\n    ...spatialData.SPATIAL_DATA.features.filter(\r\n      (f) => f.geometry.type === \"MultiPolygon\"\r\n    ),\r\n    spatialData.CALIFORNIA_OUTLINE,\r\n  ];\r\n  const pointGeom = spatialData.SPATIAL_DATA.features.filter(\r\n    (f) => f.geometry.type === \"MultiPoint\"\r\n  );\r\n\r\n  minimap\r\n    .selectAll(\"path\")\r\n    .data(lineGeom)\r\n    .join(\"path\")\r\n    .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"stroke\", (d) => (d.properties.CalLiteID ? \"transparent\" : \"gray\"))\r\n    .attr(\"stroke-width\", 1)\r\n    .attr(\"fill\", \"transparent\");\r\n\r\n  minimap\r\n    .selectAll(\"circle\")\r\n    .data(pointGeom)\r\n    .join(\"circle\")\r\n    .each(function (d) {\r\n      const s = d3.select(this);\r\n\r\n      const [x, y] = proj(d.geometry.coordinates[0]);\r\n\r\n      s.attr(\"cx\", x);\r\n      s.attr(\"cy\", y);\r\n    })\r\n    .attr(\"r\", 2)\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"fill\", \"transparent\");\r\n}\r\n\r\nfunction updateLargeDropSVG(\r\n  container,\r\n  waterdrops,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const drops = container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdrops.groups, ({ key }) => key)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(interactorsInit);\r\n    })\r\n    .each(interactorsUpdate)\r\n    .attr(\"transform\", dropTransform)\r\n    .select(\".hover-capture\");\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      d3.select(this.parentNode).raise();\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n}\r\n\r\nfunction fontSizer(transformInfo, camera, waterdropsHeight) {\r\n  return function () {\r\n    const tNode = d3.select(this).node();\r\n\r\n    const [posx, posy] = getCenterDomRect(tNode.getBoundingClientRect());\r\n\r\n    const width = ((tNode.getBBox().width * camera.height) / camera.far) * 8,\r\n      height = ((tNode.getBBox().height * camera.height) / camera.far) * 10;\r\n\r\n    const dis = dist(\r\n      [posx, posy],\r\n      [transformInfo.mouseX, transformInfo.mouseY]\r\n    );\r\n\r\n    d3.select(this).attr(\r\n      \"font-size\",\r\n      getFontSize(dis, transformInfo.zoom, camera.height, waterdropsHeight)\r\n    );\r\n\r\n    d3.select(this.parentNode.parentNode)\r\n      .select(\"image\")\r\n      .attr(\"x\", -width / 2)\r\n      .attr(\"y\", -height / 2)\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n  };\r\n}\r\n\r\nfunction fadeOutDrops(dropsMesh, scene, startOpac, duration) {\r\n  const t = d3.timer((elapsed) => {\r\n    const et = Math.min(1, elapsed / duration);\r\n\r\n    dropsMesh.updateVisibility(1 - et);\r\n    dropsMesh.updateOutlineVisibility(startOpac * (1 - et));\r\n\r\n    if (et >= 1) {\r\n      t.stop();\r\n      dropsMesh.remove(scene);\r\n    }\r\n  });\r\n}\r\n\r\nexport const helpers = {\r\n  drawMinimapSVG,\r\n  updateLargeDropSVG,\r\n  fontSizer,\r\n  fadeOutDrops,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingStickers from \"components/SceneSettingStickers\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { hideElems, removeElems, showElems } from \"utils/render-utils\";\r\nimport { createInterpsFromDelivs, deserialize } from \"utils/data-utils\";\r\nimport { helpers } from \"utils/compareview-helpers\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\nimport DropletGlyph from \"components/DropletGlyph\";\r\n\r\nexport default function CompareView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n\r\n  const groupsRef = useRef();\r\n  const centerRef = useRef();\r\n\r\n  const getScreenDropHeight = () =>\r\n    groupsRef.current.groups[0].height * settings.SPREAD_1_2;\r\n\r\n  useEffect(function initialize() {\r\n    const container = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"compare-group\");\r\n\r\n    container.append(\"text\").attr(\"id\", \"member-variable\");\r\n    container.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    appCtx.addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"CompareView\")) {\r\n        const container = d3.select(\"#compare-group\");\r\n\r\n        const { viewCenter, transitionDuration = 0 } = appCtx.state;\r\n\r\n        centerRef.current = viewCenter;\r\n\r\n        groupsRef.current = helpers.getWaterdropGroups(\r\n          appCtx.activeWaterdrops,\r\n          appCtx.waterdrops,\r\n          viewCenter\r\n        );\r\n\r\n        helpers.updateDropsSVG(\r\n          container,\r\n          groupsRef.current,\r\n          transitionDuration / 5,\r\n          {\r\n            onHover: (d) => {\r\n              setActiveMinidrop({ key: d.key });\r\n            },\r\n          }\r\n        );\r\n\r\n        hideElems(\r\n          \".large-gray-text, .baseline-pointer, .circlet, .comp-line, .highlight-circle\",\r\n          container\r\n        );\r\n\r\n        setTimeout(() => {\r\n          setActiveMinidrop({ key: groupsRef.current.groups[0].nodes[0].key });\r\n          showElems(\r\n            \"#member-variable, #member-label, .large-gray-text, .baseline-pointer, .circlet, .comp-line, .highlight-circle\",\r\n            container\r\n          );\r\n          showElems(\".comp-settings\", d3, \"flex\");\r\n        }, transitionDuration + 500);\r\n\r\n        appCtx.setGoBack(() => () => {\r\n          const transitionDuration = appCtx.resetCamera();\r\n\r\n          appCtx.setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(appCtx.camera.curTransform);\r\n\r\n        return function exitState() {\r\n          removeElems(\".large-drop, .circlet, .comp-line\", container);\r\n\r\n          hideElems(\r\n            \"#member-variable, #member-label, .baseline-pointer\",\r\n            container\r\n          );\r\n          hideElems(\".comp-settings\");\r\n\r\n          setPanels([]);\r\n          appCtx.setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines, nodes] = helpers.calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop.key\r\n        );\r\n\r\n        setPanels(makePanelsFromNodes(nodes));\r\n        helpers.updateLabelSVG(\r\n          avgCoords(positions),\r\n          activeMinidrop.key.slice(4),\r\n          getScreenDropHeight()\r\n        );\r\n        helpers.updateScenIndicatorsSVG(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#compare-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop-group\", container);\r\n        showElems(\".large-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return objectivesData.KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      helpers.updateColorDrops(\r\n        container,\r\n        groupsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop-group\", container);\r\n      hideElems(\".large-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function makePanelsFromNodes(nodes) {\r\n    return (p) => {\r\n      return nodes.map((n, i) => {\r\n        let ox = 0,\r\n          oy = 0;\r\n\r\n        if (p[i]) {\r\n          ox = p[i].offsetX;\r\n          oy = p[i].offsetY;\r\n        }\r\n\r\n        const [x, y, isLeft] = getIdealGroupPos(\r\n          groupsRef.current.groupPositions[i]\r\n        );\r\n\r\n        return {\r\n          text: n.key,\r\n          x,\r\n          y,\r\n          id: groupsRef.current.groups[i].key,\r\n          nodeID: n.id,\r\n          isLeft,\r\n          offsetX: ox,\r\n          offsetY: oy,\r\n        };\r\n      });\r\n    };\r\n  }\r\n\r\n  function getIdealGroupPos({ x, y, isLeft }) {\r\n    let newX = x,\r\n      newY = y;\r\n\r\n    const correctionX =\r\n      groupsRef.current.groups[0].height * settings.SPREAD_1_2;\r\n\r\n    if (isLeft) newX -= correctionX;\r\n    else newX += correctionX;\r\n\r\n    return [newX, newY, isLeft];\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {activeMinidrop && (\r\n        <SceneSettingStickers\r\n          settings={deserialize(activeMinidrop.key.slice(4))}\r\n          setColorSetting={setColorSetting}\r\n        />\r\n      )}\r\n      {panels.map(({ x, y, id, isLeft, offsetX, offsetY, nodeID }, i) => {\r\n        const { objective } = objectivesData.FLATTENED_DATA[nodeID];\r\n        const delivs = objectivesData.FLATTENED_DATA[nodeID].deliveries;\r\n\r\n        const [delivMin, delivMax] = objectivesData.MIN_MAXES[objective];\r\n        const interper = createInterpsFromDelivs(delivs, delivMin, delivMax);\r\n\r\n        return (\r\n          <div\r\n            className={\"panel compare-panel\" + (isLeft ? \" left\" : \"\")}\r\n            key={i}\r\n            style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n            onMouseDown={(e) => onPanelDragStart(e, { id })}\r\n          >\r\n            <div className=\"panel-main-container\">\r\n              <DotHistogram\r\n                width={420}\r\n                height={280}\r\n                data={delivs}\r\n                range={[delivMin, delivMax]}\r\n                goal={appCtx.goals[id]}\r\n                setGoal={(newGoal) => {\r\n                  appCtx.setGoals((g) => {\r\n                    g[id] = newGoal;\r\n                    return { ...g };\r\n                  });\r\n                }}\r\n              />\r\n              <DropletGlyph\r\n                levelInterp={interper}\r\n                height={200}\r\n                resolution={4}\r\n              />\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingSubcard from \"components/SceneSettingSubcard\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport {\r\n  generateTSpan,\r\n  hideElems,\r\n  removeElems,\r\n  showElems,\r\n} from \"utils/render-utils\";\r\nimport { createInterpsFromDelivs, deserialize } from \"utils/data-utils\";\r\nimport { clipEnds, dist } from \"utils/math-utils\";\r\nimport { radToDeg } from \"three/src/math/MathUtils\";\r\nimport { helpers } from \"utils/examineview-helpers\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\nimport DropletGlyph from \"components/DropletGlyph\";\r\n\r\nexport default function ExamineView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const activeMinidropsRef = useRef([]);\r\n  const curMinidropsRef = useRef(null);\r\n\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, panelsRef, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n  const [hoveredCard, setHoveredCard] = useState(null);\r\n  const removePreviewRef = useRef(null);\r\n\r\n  useEffect(function initialize() {\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"examine-group\");\r\n\r\n    svgGroup\r\n      .append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"opacity\", 0);\r\n\r\n    svgGroup\r\n      .append(\"g\")\r\n      .attr(\"class\", \"baseline-pointer\")\r\n      .call(function (s) {\r\n        s.append(\"path\");\r\n        s.append(\"text\").text(\"baseline\");\r\n      })\r\n      .attr(\"opacity\", 0);\r\n\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"instruction-text large-gray-text fancy-font\");\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"large-drop-label large-gray-text fancy-font\");\r\n\r\n    appCtx.addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"ExamineView\")) {\r\n        const { transitionDuration = 0 } = appCtx.state;\r\n        const container = d3.select(\"#examine-group\");\r\n        curMinidropsRef.current = appCtx.waterdrops.groups.find(\r\n          (g) => g.key === appCtx.activeWaterdrops[0]\r\n        );\r\n\r\n        helpers.updateSmallDropSVG(\r\n          container,\r\n          curMinidropsRef.current,\r\n          transitionDuration / 2,\r\n          {\r\n            onClick: updateActiveMinidrops,\r\n            onHover: hoverDrop,\r\n            onUnhover: unhoverDrop,\r\n          }\r\n        );\r\n\r\n        setTimeout(showAdditionalInfo, transitionDuration * 1.2);\r\n\r\n        appCtx.setGoBack(() => () => {\r\n          const transitionDuration = appCtx.resetCamera();\r\n\r\n          appCtx.setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(appCtx.camera.curTransform);\r\n        showElems(\"#examine-group\");\r\n\r\n        return function exitState() {\r\n          removeElems(\".small-drop, .circlet\", container);\r\n          hideElems(\"#examine-group\");\r\n          d3.selectAll(\r\n            \"#examine-group .instruction-text, #examine-group .large-drop-label, #examine-group .highlight-circle, #examine-group .baseline-pointer\"\r\n          ).attr(\"opacity\", 0);\r\n\r\n          setPanels([]);\r\n          activeMinidropsRef.current = [];\r\n          curMinidropsRef.current = null;\r\n          appCtx.setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#examine-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop\", container);\r\n        showElems(\".small-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return objectivesData.KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      helpers.updateColorDrops(\r\n        container,\r\n        curMinidropsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop\", container);\r\n      hideElems(\".small-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function showAdditionalInfo() {\r\n    const instrFontSize =\r\n      (curMinidropsRef.current.height * settings.SPREAD_1_2) / 20;\r\n\r\n    d3.select(\"#examine-group .instruction-text\")\r\n      .attr(\r\n        \"x\",\r\n        curMinidropsRef.current.x -\r\n          curMinidropsRef.current.height * settings.SPREAD_1_2 * 0.8\r\n      )\r\n      .attr(\"y\", curMinidropsRef.current.y - instrFontSize)\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", instrFontSize)\r\n      .call(\r\n        generateTSpan(\r\n          [\"click to keep panels open.\", \"you can drag panels.\"],\r\n          1.6\r\n        )\r\n      )\r\n      .call((s) => {\r\n        s.transition().attr(\"opacity\", 1);\r\n      })\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * instrFontSize);\r\n      });\r\n\r\n    const labelFontSize =\r\n      (curMinidropsRef.current.height * settings.SPREAD_1_2) / 15;\r\n\r\n    d3.select(\"#examine-group .large-drop-label\")\r\n      .attr(\"x\", curMinidropsRef.current.x)\r\n      .attr(\r\n        \"y\",\r\n        curMinidropsRef.current.y +\r\n          (curMinidropsRef.current.height / 2) * settings.SPREAD_1_2 * 0.9\r\n      )\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"font-size\", labelFontSize)\r\n      .call(generateTSpan(curMinidropsRef.current.display_name, 1.2, 30))\r\n      .transition()\r\n      .attr(\"opacity\", 1);\r\n\r\n    d3.selectAll(\r\n      \"#examine-group .highlight-circle, #examine-group .baseline-pointer\"\r\n    )\r\n      .attr(\"opacity\", 0)\r\n      .transition()\r\n      .attr(\"opacity\", 1);\r\n  }\r\n\r\n  function addDetailPanel(dropId, preview = false, forceReplace = false) {\r\n    const { x: groupX, y: groupY } = curMinidropsRef.current;\r\n    const { x, y, id, key } = appCtx.waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      if (p.findIndex(({ id: pid }) => id === pid) !== -1) {\r\n        if (!forceReplace) return p;\r\n\r\n        arrRemove(p, (_p) => _p.id === id);\r\n      }\r\n      const newPanel = {\r\n        text: key.slice(4),\r\n        x: groupX + x * settings.SPREAD_1_2,\r\n        y: groupY + y * settings.SPREAD_1_2,\r\n        offsetX: 20,\r\n        offsetY: 40,\r\n        id,\r\n        preview,\r\n        panelKey: preview ? -1 : dropId,\r\n      };\r\n\r\n      return [...p, newPanel];\r\n    });\r\n  }\r\n\r\n  function removeDetailPanel(dropId) {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ id }) => dropId === id);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function removePreviewPanel() {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ panelKey }) => panelKey === -1);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function updateActiveMinidrops(d) {\r\n    const container = d3.select(\"#examine-group\");\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      arrRemove(activeMinidropsRef.current, d.id);\r\n      container.select(`.circlet#i${d.id}`).classed(\"active\", false);\r\n      removeDetailPanel(d.id);\r\n      setHoveredCard(null);\r\n    } else {\r\n      removeDetailPanel(d.id);\r\n      activeMinidropsRef.current.push(d.id);\r\n      container.select(`.circlet#i${d.id}`).classed(\"active\", true);\r\n      addDetailPanel(d.id);\r\n      setHoveredCard(d.id);\r\n    }\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      d3.select(`.examine-panel#p${d.id}`).style(\"z-index\", 100);\r\n      setHoveredCard(d.id);\r\n    } else {\r\n      if (removePreviewRef.current) {\r\n        clearTimeout(removePreviewRef.current);\r\n        removePreviewPanel();\r\n      }\r\n      addDetailPanel(d.id, true);\r\n    }\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    if (!activeMinidropsRef.current.includes(d.id)) {\r\n      removePreviewRef.current = setTimeout(() => {\r\n        removeDetailPanel(d.id);\r\n        removePreviewRef.current = null;\r\n      }, 100);\r\n    }\r\n\r\n    setHoveredCard((hc) => (hc === d.id ? null : hc));\r\n    d3.select(`.examine-panel#p${d.id}`).style(\"z-index\", 0);\r\n  }\r\n\r\n  function drawLineConnect(id) {\r\n    if (panelsRef.current.findIndex(({ id: pid }) => id === pid) === -1) return;\r\n\r\n    const { x: circleX, y: circleY } = panelsRef.current.find(\r\n      (p) => p.id === id\r\n    );\r\n\r\n    const [cx, cy] = appCtx.camera.worldToScreen(circleX, circleY);\r\n\r\n    const panelBox = d3\r\n      .select(`.examine-panel#p${id}`)\r\n      .node()\r\n      .getBoundingClientRect();\r\n    const [px, py] = [\r\n      panelBox.left + panelBox.width / 2,\r\n      panelBox.top + panelBox.height / 2,\r\n    ];\r\n\r\n    const diffX = px - cx;\r\n    const diffY = py - cy;\r\n\r\n    let left, top;\r\n    const margin = 5;\r\n\r\n    if (Math.abs(diffX) > Math.abs(diffY)) {\r\n      top = 0;\r\n      left = (diffX < 0 ? 1 : -1) * (panelBox.width / 2 - margin);\r\n    } else {\r\n      left = 0;\r\n      top = (diffY < 0 ? 1 : -1) * (panelBox.height / 2 - margin);\r\n    }\r\n\r\n    const line = clipEnds(\r\n      [\r\n        [cx, cy],\r\n        [px + left, py + top],\r\n      ],\r\n      8,\r\n      0\r\n    );\r\n\r\n    return line;\r\n  }\r\n\r\n  if (isState(appCtx.state, \"ExamineView\")) {\r\n    return (\r\n      <>\r\n        {panels.map(\r\n          ({ text, x, y, id, offsetX, offsetY, panelKey, preview }) => {\r\n            const { objective, scenario } = objectivesData.FLATTENED_DATA[id];\r\n            const delivs = objectivesData.FLATTENED_DATA[id].deliveries;\r\n\r\n            const [delivMin, delivMax] = objectivesData.MIN_MAXES[objective];\r\n            const interper = createInterpsFromDelivs(\r\n              delivs,\r\n              delivMin,\r\n              delivMax\r\n            );\r\n\r\n            return (\r\n              <div\r\n                className={`panel examine-panel ${preview ? \"preview\" : \"\"}`}\r\n                id={`p${id}`}\r\n                key={preview ? -1 : id}\r\n                style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n                onMouseDown={(e) => !preview && onPanelDragStart(e, { id })}\r\n                onMouseEnter={() => !preview && hoverDrop({ id })}\r\n                onMouseLeave={() => !preview && unhoverDrop({ id })}\r\n              >\r\n                <div className=\"panel-tab\">\r\n                  scenario <span>{text}</span>\r\n                </div>\r\n                <div className=\"panel-main-container\">\r\n                  <DotHistogram\r\n                    width={480}\r\n                    height={320}\r\n                    data={delivs}\r\n                    range={[delivMin, delivMax]}\r\n                    goal={appCtx.goals[appCtx.activeWaterdrops[0]]}\r\n                    setGoal={(newGoal) => {\r\n                      appCtx.setGoals((g) => {\r\n                        g[appCtx.activeWaterdrops[0]] = newGoal;\r\n                        return { ...g };\r\n                      });\r\n                    }}\r\n                  />\r\n                  <DropletGlyph\r\n                    levelInterp={interper}\r\n                    height={200}\r\n                    resolution={4}\r\n                  />\r\n                </div>\r\n                <SceneSettingSubcard\r\n                  settings={deserialize(text)}\r\n                  setColorSetting={setColorSetting}\r\n                />\r\n              </div>\r\n            );\r\n          }\r\n        )}\r\n        {hoveredCard && (\r\n          <ConnectLine connectLine={drawLineConnect(hoveredCard)} />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nfunction ConnectLine({ connectLine }) {\r\n  return (\r\n    <div className=\"connect-line\" style={getConnectStyle(...connectLine)}>\r\n      <div className=\"connect-line-container\"></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getConnectStyle(from, to) {\r\n  const width = dist(from, to);\r\n  const rot = radToDeg(Math.atan2(to[1] - from[1], to[0] - from[0]));\r\n  return {\r\n    left: `${from[0]}px`,\r\n    top: `${from[1]}px`,\r\n    width: `${width}px`,\r\n    rotate: `${rot}deg`,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, {\r\n  forwardRef,\r\n  useContext,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  useRef,\r\n} from \"react\";\r\nimport { Scrollama, Step } from \"react-scrollama\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { isState } from \"utils/misc-utils\";\r\n\r\nimport BucketGlyph from \"components/BucketGlyph\";\r\nimport DropletGlyph from \"components/DropletGlyph\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\n\r\nimport { hideElems } from \"utils/render-utils\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\nimport { useDataStory } from \"hooks/useDataStory\";\r\n\r\nimport { descriptionsData } from \"data/descriptions-tutorial-data\";\r\nimport { spatialData } from \"data/spatial-data\";\r\nimport { initWaterdrops } from \"utils/waterdrop-utils\";\r\nimport { objectivesData } from \"data/objectives-tutorial-data\";\r\n\r\nconst tutorialWaterdrops = initWaterdrops(\r\n  objectivesData,\r\n  descriptionsData,\r\n  \"objective\"\r\n);\r\n\r\nexport default function TutorialView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const { hookAnimations, getSlidesInRange, storyVars } = useDataStory(\r\n    tutorialWaterdrops,\r\n    appCtx.camera\r\n  );\r\n\r\n  useLayoutEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"TutorialView\")) {\r\n        hideElems(\r\n          \".bucket-wrapper, .vardrop, .var-scen-label, .vardrop .dot-histogram-wrapper, .main-histogram, .tut-comparer-graphics-wrapper\"\r\n        );\r\n\r\n        hookAnimations();\r\n\r\n        return function exitState() {\r\n          appCtx.resetCamera(false);\r\n          hideElems(\".tutorial-view\");\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  if (!isState(appCtx.state, \"TutorialView\")) return;\r\n\r\n  return (\r\n    <div className=\"tutorial-view\">\r\n      <div className=\"tut-hero\">\r\n        <h1>\r\n          Watering <br /> the Future\r\n        </h1>\r\n        <MapCalifornia />\r\n        <p>\r\n          Water is limited in California, yet everyone needs it. So how can we\r\n          deal with the agricultural, environmental, urban, and other water\r\n          demands of California?\r\n        </p>\r\n        <p>\r\n          To start off, we'll focus on two groups: the{\" \"}\r\n          <span id=\"ag-group\">agriculture group in the north</span> and the{\" \"}\r\n          <span id=\"ref-group\">refuge group in the south.</span>\r\n        </p>\r\n        <p>Scroll through this page to explore!</p>\r\n        <SkipBtn onClick={() => appCtx.setState({ state: \"WideView\" })} />\r\n      </div>\r\n      <PointGroups />\r\n      <div className=\"scrollama scrollama-create-buckets\">\r\n        <div className=\"create-buckets-section\">\r\n          <h2>From Bar Graphs to Buckets</h2>\r\n          <p>\r\n            This is the average yearly amount of water each group receives,\r\n            specifically from the <b>Central Valley Project</b>, one of two\r\n            water municipalities in California.\r\n          </p>\r\n          <div className=\"explain-results\">\r\n            <p>\r\n              Comparing the two, we see that the maximum water level for the\r\n              agriculture group is more than the refuge group. Additionally, the\r\n              refuge group's water level is more consistent than that of the\r\n              agriculture group, with the most likely water levels hovering at\r\n              around 1/3 maximum capacity.\r\n            </p>\r\n            <p>\r\n              But the agriculture group has some chances of reaching higher than\r\n              the refuge group's most likely water level, judging from the light\r\n              blue levels that are situated above the 1/3 mark.\r\n            </p>\r\n            <p>\r\n              Overall, if we want a reliable supply we would want the refuge\r\n              group's deliveries, but if we want a chance at higher supplies of\r\n              water however with more inconsistent results, we would want the\r\n              agriculture group's deliveries.\r\n            </p>\r\n          </div>\r\n          <CompareBucketCreationsGraphics\r\n            storyVars={storyVars}\r\n            size={appCtx.appHeight * 0.4}\r\n          />\r\n        </div>\r\n        <DataStoryScrollama>\r\n          {getSlidesInRange(\"barsExplain\", \"comparingTheTwo\").map(\r\n            (slide, i) => (\r\n              <Step key={i} data={slide}>\r\n                <CardBBox>{slide.script}</CardBBox>\r\n              </Step>\r\n            )\r\n          )}\r\n        </DataStoryScrollama>\r\n      </div>\r\n      <div className=\"scrollama scrollama-compare-scenobjs scenarios-section\">\r\n        <CompareScenariosGraphics\r\n          storyVars={storyVars}\r\n          size={appCtx.appHeight * 0.4}\r\n        />\r\n        <CompareBigDroplets />\r\n        <DataStoryScrollama>\r\n          {getSlidesInRange(\"forNowLetsFocus\", \"letsBringRefuge\").map(\r\n            (slide, i) => (\r\n              <Step key={i} data={slide}>\r\n                <CardBBox>{slide.script}</CardBBox>\r\n              </Step>\r\n            )\r\n          )}\r\n        </DataStoryScrollama>\r\n      </div>\r\n      <CallToExploreCard\r\n        onClick={() => appCtx.setState({ state: \"WideView\" })}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nconst CardBBox = forwardRef(function CardBBox({ children }, ref) {\r\n  return (\r\n    <div ref={ref} className=\"tut-text-card-wrapper\">\r\n      {children}\r\n    </div>\r\n  );\r\n});\r\n\r\nfunction DataStoryScrollama({ children }) {\r\n  const onStepEnter = async ({ data, direction, element }) => {\r\n    if (direction === \"up\") return;\r\n    data.animHandler?.do();\r\n  };\r\n\r\n  const onStepExit = async ({ data, direction, element }) => {\r\n    if (direction === \"down\") return;\r\n    data.animHandler?.undo();\r\n  };\r\n\r\n  const onStepProgress = async ({ data, direction, element, progress }) => {\r\n    const whiteness = d3\r\n      .scaleLinear()\r\n      .domain([0, 0.4, 0.8, 1])\r\n      .range([100, 255, 255, 200])(progress);\r\n\r\n    d3.select(element)\r\n      .select(\"div\")\r\n      .style(\r\n        \"transform\",\r\n        `perspective(800px) rotateX(${d3\r\n          .scaleLinear()\r\n          .domain([0, 0.4, 0.8, 1])\r\n          .range([-90, 0, 0, 90])(progress)}deg) `\r\n      )\r\n      .style(\r\n        \"background-color\",\r\n        `rgb(${whiteness}, ${whiteness}, ${whiteness}) `\r\n      );\r\n  };\r\n\r\n  return (\r\n    <Scrollama\r\n      offset={0.8}\r\n      onStepEnter={onStepEnter}\r\n      onStepExit={onStepExit}\r\n      onStepProgress={onStepProgress}\r\n      threshold={1}\r\n    >\r\n      {children}\r\n    </Scrollama>\r\n  );\r\n}\r\n\r\nfunction MapCalifornia({}) {\r\n  useEffect(function initialize() {\r\n    const height = window.innerHeight,\r\n      width = height * 0.9;\r\n\r\n    const drawnRegions = [constants.PAG_OBJECTIVE, constants.PRF_OBJECTIVE];\r\n\r\n    const minimap = d3\r\n      .select(\"#tut-map-california\")\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n\r\n    const proj = d3\r\n      .geoMercator()\r\n      .scale((3000 * height) / 800)\r\n      .center(spatialData.CALIFORNIA_CENTER)\r\n      .translate([width / 2, height / 2]);\r\n\r\n    const lineGeom = [\r\n      ...spatialData.SPATIAL_DATA.features.filter((f) =>\r\n        drawnRegions.includes(f.properties.CalLiteID)\r\n      ),\r\n      spatialData.CALIFORNIA_OUTLINE,\r\n    ];\r\n\r\n    minimap\r\n      .selectAll(\"path\")\r\n      .data(lineGeom)\r\n      .join(\"path\")\r\n      .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\r\n      .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n      .attr(\"stroke\", (d) => (d.properties.CalLiteID ? \"transparent\" : \"gray\"))\r\n      .attr(\"stroke-width\", 1)\r\n      .style(\"transform-origin\", (d) => {\r\n        const [x, y] = proj(d.geometry.coordinates[0][0][0]);\r\n\r\n        return `${x}px ${y}px`;\r\n      })\r\n      .attr(\"fill\", \"none\");\r\n\r\n    minimap\r\n      .select(`.${constants.PAG_OBJECTIVE}`)\r\n      .attr(\"fill\", constants.PAG_COLOR);\r\n    minimap\r\n      .select(`.${constants.PRF_OBJECTIVE}`)\r\n      .attr(\"fill\", constants.PRF_COLOR);\r\n  }, []);\r\n\r\n  return <svg className=\"tut-map-california\" id=\"tut-map-california\"></svg>;\r\n}\r\n\r\nfunction PointGroups() {\r\n  useEffect(function initialize() {\r\n    const width =\r\n        window.innerWidth * 0.9 /* leave room for scrollbar on the right */,\r\n      height = window.innerHeight;\r\n    const overlaySVG = d3\r\n      .select(\"#tut-point-groups\")\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .style(\"z-index\", -1);\r\n\r\n    const startPAG = d3\r\n        .select(`.${constants.PAG_OBJECTIVE}`)\r\n        .node()\r\n        .getBoundingClientRect(),\r\n      endPAG = d3.select(\"#ag-group\").node().getBoundingClientRect();\r\n    const startPRF = d3\r\n        .select(`.${constants.PRF_OBJECTIVE}`)\r\n        .node()\r\n        .getBoundingClientRect(),\r\n      endPRF = d3.select(\"#ref-group\").node().getBoundingClientRect();\r\n\r\n    const pagLine = [\r\n      [startPAG.x + startPAG.width / 2, startPAG.y + startPAG.height / 2],\r\n      [endPAG.x + endPAG.width / 2, endPAG.y + endPAG.height / 2],\r\n    ];\r\n    const prfLine = [\r\n      [startPRF.x + startPRF.width / 2, startPRF.y + startPRF.height / 2],\r\n      [endPRF.x + endPRF.width / 2, endPRF.y + endPRF.height / 2],\r\n    ];\r\n\r\n    const pagPointer = [\r\n      pagLine[0],\r\n      [\r\n        (pagLine[0][0] + pagLine[1][0]) / 2,\r\n        (pagLine[0][1] + pagLine[1][1]) / 2 - height / 10,\r\n      ],\r\n      pagLine[1],\r\n    ];\r\n\r\n    const prfPointer = [\r\n      prfLine[0],\r\n      [\r\n        (prfLine[0][0] + prfLine[1][0]) / 2,\r\n        (prfLine[0][1] + prfLine[1][1]) / 2 - height / 10,\r\n      ],\r\n      prfLine[1],\r\n    ];\r\n\r\n    overlaySVG\r\n      .append(\"path\")\r\n      .attr(\r\n        \"d\",\r\n        d3\r\n          .line()\r\n          .x((d) => d[0])\r\n          .y((d) => d[1])\r\n          .curve(d3.curveBasis)(pagPointer)\r\n      )\r\n      .attr(\"stroke\", constants.PAG_COLOR)\r\n      .attr(\"stroke-dasharray\", \"5 5\")\r\n      .attr(\"fill\", \"transparent\");\r\n\r\n    overlaySVG\r\n      .append(\"path\")\r\n      .attr(\r\n        \"d\",\r\n        d3\r\n          .line()\r\n          .x((d) => d[0])\r\n          .y((d) => d[1])\r\n          .curve(d3.curveBasis)(prfPointer)\r\n      )\r\n      .attr(\"stroke\", constants.PRF_COLOR)\r\n      .attr(\"stroke-dasharray\", \"5 5\")\r\n      .attr(\"fill\", \"transparent\");\r\n  }, []);\r\n\r\n  return <svg id=\"tut-point-groups\"></svg>;\r\n}\r\n\r\nfunction SkipBtn({ onClick }) {\r\n  useEffect(function mountFadeOutEffect() {\r\n    const startPos = document.documentElement.scrollTop;\r\n    const buffer = 50;\r\n\r\n    window.addEventListener(\"scroll\", function () {\r\n      const curPos = document.documentElement.scrollTop;\r\n      const opac = Math.max(0, 1 - (curPos - startPos) / buffer);\r\n\r\n      d3.select(\".skip-btn\").style(\"opacity\", opac);\r\n    });\r\n  }, []);\r\n  return (\r\n    <button className=\"skip-btn\" onClick={onClick}>\r\n      Skip intro\r\n    </button>\r\n  );\r\n}\r\n\r\nfunction CallToExploreCard({ onClick }) {\r\n  return (\r\n    <div className=\"cte\">\r\n      Thus, tradeoffs must often be made when managing California's water\r\n      supply. What are the ways we can manage California's water, and how do\r\n      their outcomes compare? Go to the next step to find out!\r\n      <button className=\"fancy-font\" onClick={onClick}>\r\n        click to explore!\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CompareBucketCreationsGraphics({ storyVars }) {\r\n  return (\r\n    <div className=\"tut-graph-wrapper\">\r\n      <BucketCreationGraphics\r\n        id={\"pag-bar-graph\"}\r\n        label={descriptionsData[constants.PAG_OBJECTIVE].display_name}\r\n        bucketInterper={storyVars.bucketInterperPAG}\r\n      />\r\n      <BucketCreationGraphics\r\n        id={\"prf-bar-graph\"}\r\n        label={descriptionsData[constants.PRF_OBJECTIVE].display_name}\r\n        bucketInterper={storyVars.bucketInterperPRF}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CompareScenariosGraphics({ storyVars, size }) {\r\n  return (\r\n    <div className=\"tut-drop-graphics-wrapper\">\r\n      <h2>Seeing Scenarios</h2>\r\n      <div className=\"waterdrop-graphics-wrapper\">\r\n        <div className=\"waterdrop-explain-pag\">\r\n          <p>\r\n            For now, let's focus on the agriculture group. Here it is as a drop\r\n            of water. We see here that the lightest color reaches approximately\r\n            the midpoint of the maximum capacity, meaning that there is a chance\r\n            600 TAF of water will be delivered to this group.\r\n          </p>\r\n          <p>\r\n            The darker colors, however, indicate that it's more likely that\r\n            slightly less than 600 TAF of water will be delivered — around 500\r\n            TAF. As we'll later see, this is not a lot compared to other areas\r\n            of California.\r\n          </p>\r\n        </div>\r\n        <MainWaterdropGraphics\r\n          objectiveLabel={\r\n            descriptionsData[constants.PAG_OBJECTIVE].display_name\r\n          }\r\n          dropInterper={storyVars.dropInterper}\r\n          histData={constants.PAG_DELIVS}\r\n          histRange={[0, objectivesData.MIN_MAXES[constants.PAG_OBJECTIVE][1]]}\r\n          goal={storyVars.userGoal}\r\n          setGoal={(newGoal) => {\r\n            storyVars.setUserGoal(newGoal);\r\n          }}\r\n          size={size}\r\n        />\r\n        <VariationWaterdropGraphics\r\n          variations={constants.DROP_VARIATIONS.map((variation) => ({\r\n            ...variation,\r\n            interper: storyVars.variationInterpers[variation.idx],\r\n            histData: constants.VARIATIONS_DELIVS[variation.idx],\r\n          }))}\r\n          goal={storyVars.userGoal}\r\n          setGoal={(newGoal) => {\r\n            storyVars.setUserGoal(newGoal);\r\n          }}\r\n          histRange={[0, objectivesData.MIN_MAXES[constants.PAG_OBJECTIVE][1]]}\r\n          size={size}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CompareBigDroplets() {\r\n  return (\r\n    <div className=\"tut-comparer-graphics-wrapper\">\r\n      <p className=\"bigdrop-describe\">\r\n        These are all possible scenarios sorted bottom-to-top by decreasing\r\n        average deliveries.\r\n      </p>\r\n      <p className=\"bigdrop-explain\">\r\n        Let's bring back the refuge group. The scenarios that benefit the\r\n        agriculture group do not always benefit the refuge group, and vice\r\n        versa. Hover over the waterdrops to see how the same scenarios place for\r\n        each objective. (Can you find a scenario that benefits both?)\r\n      </p>\r\n      <svg id=\"comparer-graphics\"></svg>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction MainWaterdropGraphics({\r\n  objectiveLabel,\r\n  dropInterper,\r\n  histData,\r\n  histRange,\r\n  goal,\r\n  setGoal,\r\n  size,\r\n}) {\r\n  return (\r\n    <>\r\n      <div className=\"main-waterdrop\">\r\n        <DropletGlyph\r\n          levelInterp={dropInterper}\r\n          width={size}\r\n          height={size}\r\n          resolution={4}\r\n        />\r\n        <p className=\"var-scen-label\">\r\n          scenario <span className=\"scen-number\">{\"0000\"}</span>\r\n        </p>\r\n        <p className=\"fancy-font objective-label\">{objectiveLabel}</p>\r\n        <p className=\"volume-not-height\">\r\n          Water supply represented by volume of water inside droplet, not height\r\n          of water level\r\n        </p>\r\n      </div>\r\n      <div className=\"main-histogram\">\r\n        <DotHistogram\r\n          width={size}\r\n          height={(size * 2) / 3}\r\n          data={histData}\r\n          range={histRange}\r\n          goal={goal}\r\n          setGoal={setGoal}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction VariationWaterdropGraphics({\r\n  variations,\r\n  goal,\r\n  setGoal,\r\n  histRange,\r\n  size,\r\n}) {\r\n  return variations.map(({ idx, scen, clas, desc, interper, histData }) => (\r\n    <div className={`vardrop ${clas}`} key={idx} desc={desc}>\r\n      <DropletGlyph\r\n        levelInterp={interper}\r\n        width={size * 0.7}\r\n        height={size * 0.7}\r\n        resolution={4}\r\n      />\r\n      <p className=\"var-scen-label\">\r\n        scenario <span className=\"scen-number\">{scen}</span>\r\n      </p>\r\n      <DotHistogram\r\n        shortForm\r\n        width={size}\r\n        height={(size * 2) / 3}\r\n        data={histData}\r\n        range={histRange}\r\n        goal={goal}\r\n        setGoal={setGoal}\r\n      />\r\n    </div>\r\n  ));\r\n}\r\n\r\nfunction BucketCreationGraphics({ id, bucketInterper, label }) {\r\n  return (\r\n    <div className=\"tut-graph\">\r\n      <svg id={id}></svg>\r\n      <BucketGlyph\r\n        levelInterp={bucketInterper}\r\n        width={300}\r\n        height={constants.BAR_CHART_HEIGHT}\r\n        resolution={4}\r\n      />\r\n      <p className=\"fancy-font objective-label\">{label}</p>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { BiCross, BiNetworkChart } from \"react-icons/bi\";\r\nimport fuzzysort from \"fuzzysort\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { spatialData } from \"data/spatial-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { avgCoords, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport { generateTSpan, hideElems, showElems } from \"utils/render-utils\";\r\nimport { helpers } from \"utils/wideview-helpers\";\r\n\r\nexport default function WideView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const [curScreenTransform, setCurScreenTransform] = useState({\r\n    zoom: 1,\r\n    mouseX: 0,\r\n    mouseY: 0,\r\n  });\r\n\r\n  const [currentHoveredDrop, setCurrentHoveredDrop] = useState(null);\r\n  const [searchPrompt, setSearchPrompt] = useState(null);\r\n\r\n  const enableZoomRef = useRef(false);\r\n  const activeDropsRef = useRef([]);\r\n\r\n  useEffect(function initialize() {\r\n    initSVGGraphics();\r\n\r\n    const cleanup = registerEventListeners();\r\n\r\n    helpers.drawMinimapSVG();\r\n\r\n    return cleanup;\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"WideView\")) {\r\n        const { transitionDuration = 0 } = appCtx.state;\r\n        d3.select(\"body\").style(\"overflow\", \"hidden\");\r\n\r\n        enableZoomRef.current = true;\r\n        setCurScreenTransform((cst) => ({\r\n          ...cst,\r\n          zoom: appCtx.camera.curTransform.k,\r\n        }));\r\n\r\n        drawTHREEGraphics();\r\n        drawSVGGraphics();\r\n\r\n        showElems(\"#infobox, #mosaic-webgl, #mosaic-svg, #wide-group\");\r\n\r\n        return function exitState() {\r\n          hideElems(\"#infobox, #wide-group\");\r\n\r\n          enableZoomRef.current = false;\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateFontSizes() {\r\n      if (enableZoomRef.current) {\r\n        d3.select(\"#wide-group\")\r\n          .selectAll(\".cloud-text\")\r\n          .each(\r\n            helpers.fontSizer(\r\n              curScreenTransform,\r\n              appCtx.camera,\r\n              appCtx.waterdrops.height\r\n            )\r\n          );\r\n      }\r\n    },\r\n    [curScreenTransform]\r\n  );\r\n\r\n  const handleClickExamine = useCallback(function () {\r\n    appCtx.setDisableCamAdjustments(true);\r\n\r\n    const { x, y, height } = activeDropsRef.current[0];\r\n\r\n    const newCamPos = [\r\n      x,\r\n      y,\r\n      appCtx.camera.getZFromFarHeight(height * settings.SPREAD_1_2 * 1.5),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = appCtx.zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        appCtx.setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    appCtx.setState({ state: \"ExamineView\", transitionDuration });\r\n\r\n    const startOpacity = appCtx.getOutlineOpacity(appCtx.camera.curTransform.k);\r\n    helpers.fadeOutDrops(\r\n      appCtx.dropsMesh,\r\n      appCtx.scene,\r\n      startOpacity,\r\n      transitionDuration / 2\r\n    );\r\n  }, []);\r\n\r\n  const handleClickCompare = useCallback(function () {\r\n    appCtx.setDisableCamAdjustments(true);\r\n\r\n    const dropsMidpoint = avgCoords(\r\n      activeDropsRef.current.map((w) => [w.x, w.y])\r\n    );\r\n\r\n    const newCamPos = [\r\n      ...dropsMidpoint,\r\n      appCtx.camera.getZFromFarHeight(\r\n        appCtx.waterdrops.groups[0].height * 2 * settings.SPREAD_1_2 * 0.75 * 2\r\n      ),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = appCtx.zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        appCtx.setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    appCtx.setState({\r\n      state: \"CompareView\",\r\n      transitionDuration,\r\n      viewCenter: dropsMidpoint,\r\n    });\r\n\r\n    const startOpacity = appCtx.getOutlineOpacity(appCtx.camera.curTransform.k);\r\n    helpers.fadeOutDrops(\r\n      appCtx.dropsMesh,\r\n      appCtx.scene,\r\n      startOpacity,\r\n      transitionDuration / 5\r\n    );\r\n  }, []);\r\n\r\n  const handleClickDeselectAll = useCallback(function () {\r\n    appCtx.setActiveWaterdrops([]);\r\n    activeDropsRef.current = [];\r\n    d3.selectAll(\"#wide-group .circlet\").classed(\"active\", false);\r\n  }, []);\r\n\r\n  function initSVGGraphics() {\r\n    hideElems(\"#infobox, #mosaic-webgl, #mosaic-svg\");\r\n\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"wide-group\");\r\n\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"instruction-text large-gray-text fancy-font\")\r\n      .attr(\"x\", 0 - appCtx.waterdrops.height * 0.6);\r\n  }\r\n\r\n  function registerEventListeners() {\r\n    const cameraListener = (transform) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        zoom: transform.k,\r\n      }));\r\n    };\r\n\r\n    const mouseListener = (e) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        mouseX: e.x,\r\n        mouseY: e.y,\r\n      }));\r\n    };\r\n\r\n    appCtx.addZoomHandler(cameraListener);\r\n    window.addEventListener(\"mousemove\", mouseListener);\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener(\"mousemove\", mouseListener);\r\n    };\r\n  }\r\n\r\n  function drawTHREEGraphics() {\r\n    console.time(\"drawing\");\r\n    appCtx.dropsMesh.draw(appCtx.scene);\r\n    console.timeEnd(\"drawing\");\r\n\r\n    appCtx.dropsMesh.updateVisibility(1);\r\n    appCtx.dropsMesh.updateOutlineVisibility(\r\n      appCtx.getOutlineOpacity(appCtx.camera.curTransform.k)\r\n    );\r\n  }\r\n\r\n  function drawSVGGraphics() {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    helpers.updateLargeDropSVG(container, appCtx.waterdrops, {\r\n      onClick: updateActiveDrops,\r\n      onHover: hoverDrop,\r\n      onUnhover: unhoverDrop,\r\n    });\r\n\r\n    for (const wd of activeDropsRef.current) {\r\n      container.select(`.circlet#b${wd.key}`).classed(\"active\", true);\r\n    }\r\n\r\n    const fontSize =\r\n      (40 * appCtx.camera.getZFromFarHeight(appCtx.waterdrops.height)) /\r\n      appCtx.camera.height;\r\n    container\r\n      .select(\".instruction-text\")\r\n      .attr(\"y\", -fontSize * 5)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", fontSize)\r\n      .call(\r\n        generateTSpan(\r\n          [\"click to interact.\", \"scroll to zoom.\", \"drag to pan.\"],\r\n          2\r\n        )\r\n      )\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * fontSize);\r\n      });\r\n  }\r\n\r\n  function updateActiveDrops(d) {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    appCtx.setActiveWaterdrops((aw) => {\r\n      if (aw.includes(d.key)) {\r\n        aw = arrRemove(aw, d.key);\r\n        activeDropsRef.current = arrRemove(activeDropsRef.current, d);\r\n\r\n        container.select(`.circlet#b${d.key}`).classed(\"active\", false);\r\n      } else {\r\n        aw.push(d.key);\r\n        activeDropsRef.current.push(d);\r\n\r\n        container.select(`.circlet#b${d.key}`).classed(\"active\", true);\r\n      }\r\n      return [...aw];\r\n    });\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    setCurrentHoveredDrop({\r\n      id: d.key,\r\n      description: descriptionsData[d.key]?.desc || d.key,\r\n    });\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"gray\");\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    setCurrentHoveredDrop(null);\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"transparent\");\r\n  }\r\n\r\n  const searchResults = useMemo(() => {\r\n    if (searchPrompt === null) return [];\r\n\r\n    return fuzzysort.go(searchPrompt, appCtx.waterdrops.groups, {\r\n      keys: [\r\n        (obj) => descriptionsData[obj.key].id,\r\n        (obj) => descriptionsData[obj.key].display_name,\r\n        (obj) => descriptionsData[obj.key].desc,\r\n      ],\r\n      limit: 10,\r\n      all: true,\r\n    });\r\n  }, [searchPrompt, appCtx.waterdrops]);\r\n\r\n  return (\r\n    <>\r\n      <div id=\"infobox\">\r\n        <svg id=\"minimap\"></svg>\r\n        {currentHoveredDrop && (\r\n          <div className=\"details\">\r\n            {!spatialData.SPATIAL_FEATURES[currentHoveredDrop.id] && (\r\n              <p className=\"no-loc-data\">No Location Data</p>\r\n            )}\r\n            <p className=\"curDesc\">{currentHoveredDrop.description}</p>\r\n            <p className=\"curKey\">\r\n              id: <span> {currentHoveredDrop.id} </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n        {!currentHoveredDrop && (\r\n          <div className=\"searchbox\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"search\"\r\n              value={searchPrompt || \"\"}\r\n              onChange={(e) => setSearchPrompt(e.target.value)}\r\n              onFocus={() => {\r\n                setSearchPrompt(\"\");\r\n                d3.select(\".results\").style(\"display\", \"flex\");\r\n              }}\r\n              onBlur={() => {\r\n                setTimeout(() => {\r\n                  setSearchPrompt(null);\r\n                  d3.select(\".results\").style(\"display\", \"none\");\r\n                }, 100);\r\n              }}\r\n            ></input>\r\n            <div className=\"results\" style={{ display: \"none\" }}>\r\n              {searchResults.map(({ obj: wd }) => (\r\n                <button key={wd.key} onClick={() => updateActiveDrops(wd)}>\r\n                  {wd.display_name}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"action-btn-wrapper\">\r\n        <ActionButtons\r\n          appCtx={appCtx}\r\n          handleClickExamine={handleClickExamine}\r\n          handleClickDeselectAll={handleClickDeselectAll}\r\n          handleClickCompare={handleClickCompare}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction ActionButtons({\r\n  appCtx,\r\n  handleClickExamine,\r\n  handleClickDeselectAll,\r\n  handleClickCompare,\r\n}) {\r\n  let examineBtn, compareBtn;\r\n\r\n  if (isState(appCtx.state, \"WideView\") && appCtx.activeWaterdrops.length) {\r\n    if (appCtx.activeWaterdrops.length === 1) {\r\n      examineBtn = (\r\n        <button\r\n          onClick={handleClickExamine}\r\n          className=\"wide-view-action-btn fancy-font\"\r\n        >\r\n          <BiCross />\r\n          <span>examine</span>\r\n        </button>\r\n      );\r\n    } else {\r\n      compareBtn = (\r\n        <>\r\n          <button\r\n            onClick={handleClickCompare}\r\n            className=\"wide-view-action-btn fancy-font\"\r\n          >\r\n            <BiNetworkChart />\r\n            <span>compare</span>\r\n          </button>\r\n          <button\r\n            onClick={handleClickDeselectAll}\r\n            className=\"fancy-font supplement-btn\"\r\n          >\r\n            <span>deselect all</span>\r\n          </button>\r\n        </>\r\n      );\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {examineBtn}\r\n      {compareBtn}\r\n    </>\r\n  );\r\n}\r\n"],"names":["App","appState","useAppState","_jsxs","AppContext","Provider","value","children","className","_jsx","id","TutorialView","WideView","ExamineView","CompareView","goBack","onClick","createContext","DEGREE_SWAY","LINE_WIDTH","maskCounter","bucketGlyph","width","height","valueToLevelFn","arguments","length","undefined","d3","data","map","d","x","y","transitionSway","rects","multiplier","each","s","this","prevLevel","attr","transition","duration","delay","_","i","ease","attrTween","prevLiquidLevel","parseFloat","diff","Math","abs","t","concat","sin","min","PI","period","size","bucketShape","shapeFunc","drawBucketMask","shapeOutlineFunc","append","call","_ref","drawFunc","drawOutlineFunc","getPath","fn","path","toString","select","bucketShapeMask","context","drawBucket","drawBucketOutline","closed","bottomRight","bottomLeft","moveTo","lineTo","closePath","drawDroplet","hypToRad","SQRT2","radToHeight","rad","hyp","heightActual","arc","distributeQuantiles","numericBins","unitsPerQuantile","maxQuantiles","quantileBins","bin","round","sum","Infinity","interpolateWatercolorBlue","levelToDropletLevel","p","max","ticksExact","start","stop","count","collideOffsetter","curXOffset","isTooClose","LEVELS","PERCENTILE_LABELS","BucketGlyph","levelInterp","colorInterp","resolution","GLYPH_MARGIN","svgElement","useRef","useLayoutEffect","current","liquidLevels","glyph","liquids","selectAll","join","reverseData","reverse","xOffset","labels","text","style","ref","e","range","numQuantiles","histBins","domain","thresholds","ceil","binnedQuantiles","quantiles","b","push","x1","x0","NUM_CIRCLES","MARGIN","top","right","bottom","left","WATERDROP_ICON","draw","DotHistogram","goal","setGoal","shortForm","razorElement","razorAreaElement","svgSelector","circles","useMemo","dataRange","filter","scale","ticks","tickFormat","transform","clamp","ignoreFn","preventDefault","dragging","addEventListener","window","document","removeEventListener","target","razorPos","offsetX","enter","DropletGlyph","innerWidth","innerHeight","SceneSettingStickers","settings","setColorSetting","v","onMouseEnter","onMouseLeave","title","SETT_DESC","SETT_NAME_FULL","SETT_VAL_STEPS","j","opacity","SceneSettingSubcard","SETT_NAME_SHORT","async","initDescriptionsData","console","log","objs","fetch","json","mapBy","descriptionsData","SCEN_DIVISOR","initObjectivesData","SCENARIO_KEY_STRING","DELIV_KEY_STRING","BASELINE_SCEN","OBJECTIVES_DATA","chosenScenarios","name","obj","shuffledScens","shuffle","scen","includes","sort","splice","_ref2","_ref3","OBJECTIVE_IDS","Object","keys","OBJECTIVE_GOALS_MAP","goalMap","SCENARIO_IDS","values","KEY_SETTINGS_MAP","optArr","SETT_NUM_OPTS","key","deserialize","slice","MIN_MAXES","minmaxes","objective","baselineMax","scenario","FLATTENED_DATA","DATA_GROUPINGS","flattenedData","dataGroupings","means","idx","deliveries","orderedDataGroupings","criteria","objScens","ids","sortedObjScens","a","sorted","mean","maxVal","delivery","flat","IDtoRank","rank","MAX_DELIVS","objectivesData","BASELINE_YRLY_KEY_STRING","Array","from","initSpatialData","SPATIAL_DATA","SPATIAL_FEATURES","features","properties","CalLiteID","CALIFORNIA_OUTLINE","CALIFORNIA_CENTER","spatialData","appWidth","appHeight","waterdrops","initWaterdrops","state","setState","useState","activeWaterdrops","setActiveWaterdrops","setGoBack","goals","setGoals","zoomCallbacksRef","disableCamAdjustmentsRef","useEffect","threeResources","renderer","setSize","time","dropsMesh","createMesh","timeEnd","querySelector","appendChild","domElement","outlineOpacity","groups","camera","create","webglElement","node","zoomFn","updateOutlineVisibility","k","cb","setAnimationLoop","render","scene","getOutlineOpacity","useCallback","val","resetCamera","animated","callback","farHeight","pos","getZFromFarHeight","transitionDuration","dur","zoomTo","callZoomFromWorldViewport","worldX","worldY","worldPos","interpolateZoomCamera","elapsed","et","callZoom","addZoomHandler","setDisableCamAdjustments","disable","useCompareLargeDrops","activeMinidrop","setActiveMinidrop","groupsRef","camCentersRef","positions","lines","compareViewHelpers","calcLinesAndPositions","textX","textY","smallTextSize","SPREAD_1_2","largeTextSize","updateLabel","avgCoords","circlet","LOD_1_RAD_PX","raise","updateScenIndicators","initComparer","getWaterdropGroups","constants","PAG_OBJECTIVE","PRF_OBJECTIVE","camMidpoint","groupPositions","camFirstDrop","firstDrop","midpoint","container","translate","updateDropsSVG","onHover","indicatorGroup","DEFAULT_SCENARIO","hideElems","showOtherDrop","showElems","hideOtherDrop","useDataStory","slides","setSlides","storyVars","useDataStoryVars","largeDropComparer","hookAnimations","deps","showLocationAnimGroup","anims","initShowLocationAnimGroup","chartAnimGroup","initChartAnimGroup","bucketsFillAnim","initBucketsFillAnim","moveBucketsAnim","initMoveBucketsAnim","dropFillAnim","initDropFillAnim","changeRealityAnim","initChangeRealityAnim","fillVarDropsAnim","initFillVarDropsAnim","showScenLabelAnim","initShowScenLabelAnim","highlightBestAnim","initHighlightBestAnim","showQuantilesAnim","initShowQuantilesAnim","comparerAnimGroup","initComparerAnimGroup","_slides","animHandler","showPAG","showPRF","barsAppear","barsCondense","getSlidesInRange","to","idxFrom","idxTo","attachScripts","slide","script","scripts","userGoal","setUserGoal","bucketInterperPAG","setBucketInterperPAG","bucketInterperPRF","setBucketInterperPRF","dropInterper","setDropInterper","variationInterpers","setVariationInterpers","VARIATIONS","useDragPanels","viewTransform","panels","setPanels","panelsRef","useStateRef","mouseDownInfo","startX","deltaX","deltaY","startY","f","find","oldOffsetX","offsetY","oldOffsetY","onPanelDragStart","clientX","clientY","getPanelStyle","screenX","screenY","worldToScreen","LOD_1_LEVELS","LOD_1_MIN_LEV_VAL","LOD_1_SMALL_DROP_PAD_FACTOR","LOD_1_LARGE_DROP_PAD_FACTOR","LOD_2_SMALL_DROP_PAD_FACTOR","GROUP_HOVER_AREA_FACTOR","SQRT1_2","WaterdropMesh","constructor","added","updateMeshes","initializeMeshes","add","outlineMesh","remove","dropsGeometry","MeshGeometry","MAX_POINTS_DROPS","outlinePoints","outlineMeshCoords","waterdropDeltaOutline","nodes","globalX","globalY","levs","maxLev","globalTilt","tilt","l1","l2","meshCoords","waterdropDelta","color","THREE","addMeshCoords","rotate","rotOutline","rotatePoints","copyCoords","dx","dy","finish","threeGeom","vertexColors","transparent","setFromPoints","opac","material","needsUpdate","updateVisibility","MAX_POINTS_OUTLINE","_finishCreate","_classPrivateFieldLooseKey","_THREEHandleZoom","Camera","fov","near","far","defineProperty","_THREEHandleZoom2","_finishCreate2","raycaster","webglView","svgView","zoom","on","curTransform","_classPrivateFieldLooseBase","_ref4","_ref5","endx","endy","endz","position","getFarHeightFromZ","interper","tan","toRadians","z","getScaleFromZ","getZFromScale","scaleHeight","intersectObject","mouseX","mouseY","mesh","setFromCamera","screenToWorld","scaleExtent","set","numPoints","triangleIdx","setAttribute","Float32Array","positionAttribute","getAttribute","colorAttribute","v1","v2","v3","setXYZ","r","g","setDrawRange","background","antialias","initThreeResources","largeDropInit","_ref6","idStr","gradientInit","DROPLET_SHAPE","smallDropInit","largeDropUpdate","transitionDelay","display_name","isLeft","isBottom","baselinePos","generateTSpan","textUpdate","_ref7","gradientUpdate","dropBBox","getBBox","smallDropUpdate","dropCenterCorrection","circlePosX","circlePosY","textPosX","textPosY","fontSize","lineWidth","helpers","waterdropGroups","_ref8","onUnhover","_ref9","drops","parentNode","getEndGroupLoc","updateColorDrops","opacFn","_ref10","getGroupLoc","_ref11","_ref12","_ref13","keyArr","center","spacing","n","angle","cos","groupsObj","activeMinidropKey","group","groupPos","clipEnds","updateLabelSVG","labelText","normedTextSize","updateScenIndicatorsSVG","animations","do","undo","_pagX","_prfX","_pagXAxis","_prfXAxis","_pagDataDescending","_prfDataDescending","BAR_CHART_MARGIN","svgGroup","BAR_CHART_WIDTH","BAR_CHART_HEIGHT","dataDescending","placeFromLeft","year","padding","xaxis","tickSize","tickValues","prepareSVG","bandwidth","newWidth","bars","end","catch","then","PAG_INTERPER","PRF_INTERPER","classed","PAG_INTERPER_DROP","VARIATIONS_INTERPERS","createInterpsFromDelivs","delivs","minDelivs","maxDelivs","calcDomLev","demand","carryover","priority","regs","minflow","String","raw","_templateObject","_taggedTemplateLiteral","_templateObject2","_templateObject3","_templateObject4","_templateObject5","scenStr","scenNum","parseInt","updateSmallDropSVG","waterdropGroup","generateWaterdrop","delta","outer","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","placeDropsUsingPhysics","packingFactor","reuse","shape","bounds","Matter","minX","maxX","minY","maxY","genX","genY","points","random","contains","generateRandoPoints","WIDTH_AREA","AREA","floor","sqrt","radsToDropWidth","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","nx","ny","circle","restitution","parts","quad","centre","vertices","isStatic","cage","setParts","setCentre","world","FPS","SECS","update","retVal","CIRC_RAD","DROP_HEIGHT","dist","y1","x2","y2","distSq","getCenterDomRect","domRect","shortenByStart","shortenByEnd","len","normed","dropRadToDropHeight","c","rotatePoint","deg","vec","applyEuler","arr","newPoint","array","currentIndex","randomIndex","newObjs","groupBy","_setState","stateRef","curVal","isState","stateInfo","stateName","wrap","replace","RegExp","arrRemove","item","findIndex","indexOf","DROP_RAD","CIRC_HEIGHT","HAT_START","yToHalfWidth","trigX","acos","yToSpriteY","spriteYToY","sy","yStart","yEnd","subdivs","Y_DELTA","rightCoords","leftCoords","dx1","dy1","dx2","dy2","v4","elemStr","displayVal","removeElems","gradId","stops","forEach","valOffset","camTransform","lineHeight","split","line","howMuchIntro","norCal","soCal","barsExplain","bucketsFill","href","comparingTheTwo","forNowLetsFocus","ifChangeReality","fortunateCanExplore","theseVarsCalled","atAGlance","tryMoveRed","soWhyNot","letsBringRefuge","initConstants","INTERP_COLOR","PAG_DELIVS","PRF_DELIVS","VARIATIONS_DELIVS","vars","varDelivs","PAG_COLOR","PRF_COLOR","DROP_VARIATIONS","clas","desc","grouping","groupKeys","memberKeys","amtPerGroup","largeDropRad","smallDropRad","largeNodesPhys","largeNodesPos","smallNodesPhys","smallNodesPos","groupNodes","groupToNodes","nodeData","delivMin","delivMax","w","groupID","memberID","groupRank","memberRank","localTilt","parentTilt","rotatedX","rotatedY","domLev","groupKey","interactorsInit","textGroup","interactorsUpdate","dropTransform","getFontSize","transformZoom","cameraHeight","waterdropsHeight","MAX_RAD","zoomRel","_d","drawMinimapSVG","minimap","proj","lineGeom","geometry","type","pointGeom","projection","coordinates","updateLargeDropSVG","fontSizer","transformInfo","tNode","posx","posy","getBoundingClientRect","dis","fadeOutDrops","startOpac","appCtx","useContext","colorSetting","setCamTransform","centerRef","viewCenter","setTimeout","ox","oy","newX","newY","correctionX","getIdealGroupPos","nodeID","makePanelsFromNodes","_Fragment","onMouseDown","newGoal","activeMinidropsRef","curMinidropsRef","hoveredCard","setHoveredCard","removePreviewRef","showAdditionalInfo","instrFontSize","labelFontSize","addDetailPanel","dropId","preview","forceReplace","groupX","groupY","pid","_p","newPanel","panelKey","removeDetailPanel","updateActiveMinidrops","hoverDrop","clearTimeout","unhoverDrop","hc","ConnectLine","connectLine","circleX","circleY","cx","cy","panelBox","px","py","diffX","diffY","drawLineConnect","getConnectStyle","rot","radToDeg","atan2","tutorialWaterdrops","MapCalifornia","SkipBtn","PointGroups","CompareBucketCreationsGraphics","DataStoryScrollama","Step","CardBBox","CompareScenariosGraphics","CompareBigDroplets","CallToExploreCard","forwardRef","Scrollama","offset","onStepEnter","_data$animHandler","direction","element","onStepExit","_data$animHandler2","onStepProgress","progress","whiteness","threshold","drawnRegions","overlaySVG","startPAG","endPAG","startPRF","endPRF","pagLine","prfLine","pagPointer","prfPointer","curve","startPos","documentElement","scrollTop","curPos","BucketCreationGraphics","label","bucketInterper","MainWaterdropGraphics","objectiveLabel","histData","histRange","VariationWaterdropGraphics","variations","variation","_ref14","curScreenTransform","setCurScreenTransform","currentHoveredDrop","setCurrentHoveredDrop","searchPrompt","setSearchPrompt","enableZoomRef","activeDropsRef","initSVGGraphics","cleanup","cameraListener","ti","mouseListener","registerEventListeners","cst","updateActiveDrops","wd","drawSVGGraphics","handleClickExamine","newCamPos","startZoom","startOpacity","handleClickCompare","dropsMidpoint","handleClickDeselectAll","aw","_descriptionsData$d$k","description","searchResults","fuzzysort","limit","all","placeholder","onChange","onFocus","onBlur","display","ActionButtons","examineBtn","compareBtn","BiCross","BiNetworkChart"],"sourceRoot":""}