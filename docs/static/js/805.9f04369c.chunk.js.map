{"version":3,"file":"static/js/805.9f04369c.chunk.js","mappings":"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","sources":["App.jsx","AppContext.jsx","bucket-lib/BucketGlyph.jsx","bucket-lib/quantile-histogram.js","bucket-lib/utils.js","components/DotHistogram.jsx","components/SceneSettingStickers.jsx","components/SceneSettingSubcard.jsx","components/WaterdropGlyph.jsx","data/descriptions-data.jsx","data/objectives-data.jsx","data/spatial-data.jsx","hooks/useDragPanels.jsx","hooks/useTutorialComparer.jsx","hooks/useTutorialGraph.jsx","hooks/useTutorialState.jsx","settings.jsx","utils/three-utils.jsx","three-resources.jsx","utils/app-utils.jsx","utils/compareview-utils.jsx","utils/data-utils.jsx","utils/examineview-utils.jsx","utils/math-utils.jsx","utils/misc-utils.jsx","utils/render-utils.jsx","utils/tutorialview-utils.jsx","utils/wideview-utils.jsx","views/CompareView.jsx","views/ExamineView.jsx","views/TutorialView.jsx","views/WideView.jsx"],"sourcesContent":["import * as d3 from \"d3\";\r\n\r\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { initWaterdrops } from \"utils/app-utils\";\r\n\r\nimport WideView from \"views/WideView\";\r\nimport ExamineView from \"views/ExamineView\";\r\nimport TutorialView from \"views/TutorialView\";\r\nimport CompareView from \"views/CompareView\";\r\n\r\nimport { scene, camera, renderer, dropsMesh } from \"three-resources\";\r\nimport { OBJECTIVE_GOALS_MAP } from \"data/objectives-data\";\r\n\r\n// pre-calculate these so we don't lag later\r\nconst waterdrops = initWaterdrops(\"objective\");\r\n\r\nconst appWidth = window.innerWidth,\r\n  appHeight = window.innerHeight;\r\n\r\nrenderer.setSize(appWidth, appHeight);\r\n\r\nconsole.time(\"drops mesh creating\");\r\ndropsMesh.createMesh(waterdrops);\r\nconsole.timeEnd(\"drops mesh creating\");\r\n\r\nexport default function App() {\r\n  const [state, setState] = useState({});\r\n  const [activeWaterdrops, setActiveWaterdrops] = useState([]);\r\n  const [goBack, setGoBack] = useState(null);\r\n  const [goals, setGoals] = useState(OBJECTIVE_GOALS_MAP);\r\n\r\n  const zoomCallbacksRef = useRef([]);\r\n  const disableCamAdjustmentsRef = useRef(false);\r\n\r\n  const getOutlineOpacity = useCallback(\r\n    d3\r\n      .scaleLinear()\r\n      .domain([\r\n        appHeight / waterdrops.height,\r\n        appHeight / waterdrops.groups[0].height,\r\n      ])\r\n      .range([0.1, 1])\r\n      .clamp(true),\r\n    []\r\n  );\r\n\r\n  useEffect(function initialize() {\r\n    document.querySelector(\"#mosaic-webgl\").appendChild(renderer.domElement);\r\n\r\n    d3.select(\"#mosaic-svg\").attr(\"width\", appWidth).attr(\"height\", appHeight);\r\n\r\n    camera.create({\r\n      width: appWidth,\r\n      height: appHeight,\r\n      webglElement: d3.select(\".bubbles-wrapper\").node(),\r\n      svgElement: d3.select(\"#mosaic-svg\").select(\".svg-trans\").node(),\r\n      zoomFn: (transform) => {\r\n        if (!disableCamAdjustmentsRef.current) {\r\n          dropsMesh.updateOutlineVisibility(getOutlineOpacity(transform.k));\r\n        }\r\n\r\n        for (const cb of zoomCallbacksRef.current) cb(transform);\r\n      },\r\n    });\r\n\r\n    renderer.setAnimationLoop(() => {\r\n      renderer.render(scene, camera.camera);\r\n    });\r\n\r\n    resetCamera(false);\r\n    setState({ state: \"TutorialView\" });\r\n  }, []);\r\n\r\n  const resetCamera = useCallback(function (animated = true, callback) {\r\n    const pos = [\r\n      0,\r\n      -waterdrops.height * 0.08,\r\n      camera.getZFromFarHeight(waterdrops.height),\r\n    ];\r\n\r\n    let transitionDuration = 0;\r\n\r\n    if (animated) {\r\n      const [start, dur] = zoomTo(pos, callback);\r\n      transitionDuration = dur;\r\n\r\n      start();\r\n    } else {\r\n      camera.callZoomFromWorldViewport({\r\n        worldX: pos[0],\r\n        worldY: -pos[1],\r\n        farHeight: waterdrops.height,\r\n      });\r\n      callback && callback();\r\n    }\r\n\r\n    return transitionDuration;\r\n  }, []);\r\n\r\n  const zoomTo = useCallback(function (xyz, callback) {\r\n    const i = camera.interpolateZoomCamera(xyz);\r\n\r\n    const duration = i.duration / 2;\r\n\r\n    const start = () => {\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(elapsed / duration, 1);\r\n        camera.callZoom(i(et));\r\n\r\n        if (et === 1) {\r\n          t.stop();\r\n          callback && callback();\r\n        }\r\n      });\r\n    };\r\n\r\n    return [start, duration];\r\n  }, []);\r\n\r\n  const addZoomHandler = useCallback(function (cb) {\r\n    zoomCallbacksRef.current.push(cb);\r\n  }, []);\r\n\r\n  const setDisableCamAdjustments = useCallback(function (disable) {\r\n    disableCamAdjustmentsRef.current = disable;\r\n  });\r\n\r\n  return (\r\n    <AppContext.Provider\r\n      value={{\r\n        appWidth,\r\n        appHeight,\r\n        state,\r\n        setState,\r\n        activeWaterdrops,\r\n        setActiveWaterdrops,\r\n        setDisableCamAdjustments,\r\n        waterdrops,\r\n        scene,\r\n        camera,\r\n        renderer,\r\n        dropsMesh,\r\n        setGoBack,\r\n        zoomTo,\r\n        resetCamera,\r\n        getOutlineOpacity,\r\n        addZoomHandler,\r\n        goals,\r\n        setGoals,\r\n      }}\r\n    >\r\n      <div className=\"bubbles-wrapper\">\r\n        <div id=\"mosaic-webgl\"></div>\r\n        <svg id=\"mosaic-svg\">\r\n          <g className=\"svg-trans\"></g>\r\n        </svg>\r\n      </div>\r\n      <TutorialView />\r\n      <WideView />\r\n      <ExamineView />\r\n      <CompareView />\r\n      {goBack && (\r\n        <button className=\"go-back-btn\" onClick={goBack}>\r\n          \r\n        </button>\r\n      )}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n","import { createContext } from \"react\";\r\n\r\nexport const AppContext = createContext({});\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  bucketPath,\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"./utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nexport default function BucketGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () =>\r\n      ticksExact(0, 1 - 1 / resolution, resolution).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    svgContainer\r\n      .select(\".bucket-mask-path\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight));\r\n\r\n    svgContainer\r\n      .select(\".bucket-outline\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight).split(\"z\")[0]);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / (resolution - 1)));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"bucket-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { quantileBins, ticksExact } from \"./utils\";\r\n\r\nexport function getQuantileBins(data, domain, unitsPerQuantile, width, height) {\r\n  const numQuantiles = data.length / unitsPerQuantile;\r\n  let histBins = d3\r\n    .histogram()\r\n    .value((d) => d)\r\n    .domain(domain)\r\n    .thresholds(\r\n      ticksExact(...domain, Math.ceil(width / (height / numQuantiles)))\r\n    )(data);\r\n\r\n  let binnedQuantiles = quantileBins(histBins, unitsPerQuantile, numQuantiles);\r\n\r\n  let quantiles = [];\r\n\r\n  for (let b = 0; b < binnedQuantiles.length; b++) {\r\n    for (let y = 0; y < binnedQuantiles[b]; y++) {\r\n      quantiles.push([\r\n        (histBins[b].x1 + histBins[b].x0) / 2,\r\n        ((y + 0.5) / numQuantiles) * data.length,\r\n      ]);\r\n    }\r\n  }\r\n\r\n  return quantiles;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\n// inclusive\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n\r\nexport const interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useMemo, useRef } from \"react\";\r\nimport { getQuantileBins } from \"bucket-lib/quantile-histogram\";\r\n\r\nimport { MAX_DELIVS } from \"data/objectives-data\";\r\n\r\nconst NUM_CIRCLES = 20;\r\nconst MARGIN = { top: 10, right: 10, bottom: 20, left: 10 };\r\nconst DOMAIN = [0, MAX_DELIVS];\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport default function DotHistogram({\r\n  data,\r\n  goal,\r\n  setGoal,\r\n  width = 600,\r\n  height = 400,\r\n  shortForm = false,\r\n}) {\r\n  const { current: razorID } = useRef(Math.floor(Math.random() * 1e9));\r\n  const { current: razorAreaID } = useRef(Math.floor(Math.random() * 1e9));\r\n\r\n  const svgSelector = useRef();\r\n  const circles = useMemo(\r\n    () =>\r\n      getQuantileBins(data, DOMAIN, data.length / NUM_CIRCLES, width, height),\r\n    [data]\r\n  );\r\n\r\n  const dataRange = [0, data.length];\r\n  const x = d3.scaleLinear().domain(DOMAIN).range([0, width]);\r\n  const y = d3.scaleLinear().domain(dataRange).range([height, 0]);\r\n  const count = circles.filter((d) => d[0] > goal).length;\r\n\r\n  useEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width + MARGIN.left + MARGIN.right)\r\n      .attr(\"height\", height + MARGIN.top + MARGIN.bottom)\r\n      .style(\"pointer-events\", \"none\")\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${MARGIN.left},${MARGIN.top})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(\r\n        d3\r\n          .axisBottom()\r\n          .scale(d3.scaleLinear().domain(DOMAIN).range([0, width]))\r\n          .tickFormat(d3.format(\".2s\"))\r\n      )\r\n      .call((s) => {\r\n        s.selectAll(\"line\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"path\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"text\").attr(\"fill\", \"gray\");\r\n      })\r\n      .append(\"text\")\r\n      .attr(\"fill\", \"black\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${30})`)\r\n      .text(\"Delivery (TAF)\");\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n\r\n    const ignoreFn = (e) => e.preventDefault();\r\n    let dragging = false;\r\n\r\n    document.querySelector(`#i${razorID}`).addEventListener(\"mousedown\", () => {\r\n      dragging = true;\r\n      window.addEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", () => {\r\n      dragging = false;\r\n      window.removeEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document\r\n      .querySelector(`#i${razorAreaID}`)\r\n      .addEventListener(\"mousemove\", (e) => {\r\n        if (dragging && e.target.id === `i${razorAreaID}`) {\r\n          razor.style.transform = `translateX(${Math.min(\r\n            Math.max(e.offsetX, MARGIN.left),\r\n            MARGIN.left + width\r\n          )}px)\r\n            `;\r\n\r\n          setGoal(\r\n            d3\r\n              .scaleLinear()\r\n              .domain([MARGIN.left, width + MARGIN.left])\r\n              .range(DOMAIN)\r\n              .clamp(true)(e.offsetX)\r\n          );\r\n        }\r\n      });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const svgCircles = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".icons\")\r\n      .data(circles)\r\n      .join((enter) => enter.append(\"g\").call((s) => s.append(\"path\")))\r\n      .attr(\"class\", \"icons\")\r\n      .call((s) => {\r\n        s.selectAll(\"path\").attr(\r\n          \"d\",\r\n          d3.symbol(WATERDROP_ICON, height / NUM_CIRCLES)\r\n        );\r\n      });\r\n\r\n    svgCircles.attr(\"transform\", (d) => `translate(${x(d[0])},${y(d[1])})`);\r\n\r\n    svgCircles.attr(\"fill\", (d) => (d[0] > goal ? \"steelblue\" : \"black\"));\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n  }, [goal, circles]);\r\n\r\n  return (\r\n    <div\r\n      className={`dot-${razorAreaID} dot-histogram-wrapper`}\r\n      id={`i${razorAreaID}`}\r\n    >\r\n      <div\r\n        className={`pdf-razor ` + (shortForm ? \"short-form\" : \"\")}\r\n        id={`i${razorID}`}\r\n      >\r\n        <div>\r\n          <span>\r\n            <u>\r\n              {circles.length - count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL NOT meet demand\"}\r\n          </span>\r\n          <span>\r\n            <u>\r\n              {count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL meet demand\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport { SETT_NAME_FULL, SETT_VAL_STEPS } from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingStickers({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings comp-settings\">\r\n      {settings.map((v, i) => (\r\n        <div\r\n          className=\"full-card\"\r\n          onMouseEnter={() => setColorSetting(i)}\r\n          onMouseLeave={() => setColorSetting(null)}\r\n          key={i}\r\n        >\r\n          <span>{SETT_NAME_FULL[i]}</span>\r\n          <span>{SETT_VAL_STEPS[i][v]}</span>\r\n          <div className=\"sett-dot-wrapper\">\r\n            {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n              <span\r\n                className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport {\r\n  SETT_NAME_SHORT,\r\n  SETT_NAME_FULL,\r\n  SETT_VAL_STEPS,\r\n} from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingSubcard({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings\">\r\n      <div className=\"condense\">\r\n        {settings.map((v, i) => (\r\n          <div className=\"sett-dot-wrapper\" key={i}>\r\n            <span>{SETT_NAME_SHORT[i]}</span>\r\n            {d3.range(v + 1).map((j) => (\r\n              <span\r\n                className=\"sett-dot\"\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"full\">\r\n        <div className=\"full-container\">\r\n          <span>The settings for this scenario are:</span>\r\n          {settings.map((v, i) => (\r\n            <div\r\n              className=\"full-card\"\r\n              onMouseEnter={() => setColorSetting(i)}\r\n              onMouseLeave={() => setColorSetting(null)}\r\n              key={i}\r\n            >\r\n              <span>{SETT_NAME_FULL[i]}</span>\r\n              <span>{SETT_VAL_STEPS[i][v]}</span>\r\n              <div className=\"sett-dot-wrapper\">\r\n                {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n                  <span\r\n                    className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                    key={j}\r\n                    style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n                  ></span>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"bucket-lib/utils\";\r\nimport {\r\n  DROP_HEIGHT,\r\n  DROP_RAD,\r\n  waterdropDeltaOutline,\r\n} from \"utils/render-utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nfunction dropPath(height, [x, y]) {\r\n  const points = waterdropDeltaOutline(0, 1, height, 20);\r\n\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d[0] + x;\r\n    })\r\n    .y(function (d) {\r\n      return d[1] + y;\r\n    });\r\n  return lineFunc(points) + \"z\";\r\n}\r\n\r\nexport default function WaterdropGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () =>\r\n      ticksExact(0, 1 - 1 / resolution, resolution).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    const dropD = dropPath((innerHeight * (DROP_RAD * 2)) / DROP_HEIGHT, [\r\n      width / 2,\r\n      (height * DROP_RAD) / DROP_HEIGHT,\r\n    ]);\r\n\r\n    svgContainer.select(\".bucket-mask-path\").attr(\"d\", dropD);\r\n    svgContainer.select(\".bucket-outline\").attr(\"d\", dropD);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / (resolution - 1)));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"waterdrop-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const DESCRIPTIONS_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./descriptions.json\")).json();\r\n\r\n  console.log(\"DATA: loading descriptions data\");\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n})();\r\n","import * as d3 from \"d3\";\r\nimport { SETT_NUM_OPTS, deserialize } from \"utils/data-utils\";\r\n\r\nimport { clamp, shuffle } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst SCEN_DIVISOR = 1; // debugging purposes, don't render all scenarios to speed things up\r\n\r\nexport const MAX_DELIVS = 1200;\r\nexport const SCENARIO_KEY_STRING = \"scens\";\r\nexport const DELIV_KEY_STRING = \"delivs\";\r\n\r\nexport const OBJECTIVES_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./objectives.json\")).json();\r\n\r\n  for (const obj of objs) {\r\n    // shuffle so clusters of identical scenario results don't get processed deterministically\r\n    for (const scen of shuffle(obj[SCENARIO_KEY_STRING])) {\r\n      // data cleanup, clamping\r\n      const unord = scen[DELIV_KEY_STRING].map((v) => clamp(v, 0, MAX_DELIVS));\r\n\r\n      scen[DELIV_KEY_STRING] = unord.sort((a, b) => b - a);\r\n    }\r\n    obj[SCENARIO_KEY_STRING] = mapBy(\r\n      obj[SCENARIO_KEY_STRING],\r\n      ({ name }) => name\r\n    );\r\n  }\r\n\r\n  console.log(\"DATA: loading objectives data\");\r\n\r\n  return mapBy(objs, ({ obj }) => obj);\r\n})();\r\n\r\nexport const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\nexport const OBJECTIVE_GOALS_MAP = (function initDefaults() {\r\n  const goalMap = {};\r\n  for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n    goalMap[OBJECTIVE_IDS[i]] = 200;\r\n  return goalMap;\r\n})();\r\n\r\nconst _SCENARIO_IDS = Object.keys(\r\n  Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n);\r\n\r\nexport const SCENARIO_IDS = _SCENARIO_IDS.filter(\r\n  (s, i) => i % SCEN_DIVISOR === 0 || s === \"expl0000\"\r\n);\r\n\r\nexport const KEY_SETTINGS_MAP = (function preprocessData() {\r\n  const map = {};\r\n  const optArr = Object.values(SETT_NUM_OPTS);\r\n\r\n  for (let i = 0; i < SCENARIO_IDS.length; i++) {\r\n    const key = SCENARIO_IDS[i];\r\n\r\n    map[key] = deserialize(key.slice(4)).map((v, i) => (v + 1) / optArr[i]);\r\n  }\r\n\r\n  return map;\r\n})();\r\n\r\n// Flattening hierarchical data makes it more flexible for classifying\r\n// (from experience). id conveniently corresponds to index.\r\n// Also cache classifications (by objective and by scenario, for now)\r\nexport const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n  const flattenedData = [];\r\n  const dataGroupings = {\r\n    objective: {},\r\n    scenario: {},\r\n  };\r\n\r\n  // for ordering later\r\n  const means = [];\r\n\r\n  let idx = 0;\r\n  for (const obj of OBJECTIVE_IDS) {\r\n    for (const scen of SCENARIO_IDS) {\r\n      if (!dataGroupings[\"objective\"][obj])\r\n        dataGroupings[\"objective\"][obj] = [];\r\n\r\n      if (!dataGroupings[\"scenario\"][scen])\r\n        dataGroupings[\"scenario\"][scen] = [];\r\n\r\n      dataGroupings[\"objective\"][obj].push(idx);\r\n      dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n      const deliveries =\r\n        OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n      flattenedData.push({\r\n        id: idx,\r\n        objective: obj,\r\n        scenario: scen,\r\n        deliveries,\r\n      });\r\n\r\n      means.push(d3.mean(deliveries));\r\n\r\n      idx++;\r\n    }\r\n  }\r\n\r\n  const orderedDataGroupings = {};\r\n\r\n  for (const criteria of Object.keys(dataGroupings)) {\r\n    const objScens = [];\r\n    for (const key of Object.keys(dataGroupings[criteria])) {\r\n      const ids = dataGroupings[criteria][key];\r\n      const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n      objScens.push({\r\n        key,\r\n        sorted: sortedObjScens,\r\n        mean: d3.mean(ids.map((id) => flattenedData[id].deliveries).flat()),\r\n      });\r\n    }\r\n\r\n    const sortedObjScens = objScens.sort((a, b) => b.mean - a.mean);\r\n\r\n    orderedDataGroupings[criteria] = {};\r\n\r\n    for (let i = 0; i < sortedObjScens.length; i++) {\r\n      const { key, sorted } = sortedObjScens[i];\r\n      const IDtoRank = {};\r\n\r\n      for (let j = 0; j < sorted.length; j++) {\r\n        IDtoRank[sorted[j]] = j;\r\n      }\r\n      orderedDataGroupings[criteria][key] = IDtoRank;\r\n      orderedDataGroupings[criteria][key].rank = i;\r\n    }\r\n  }\r\n\r\n  return [flattenedData, orderedDataGroupings];\r\n})();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const SPATIAL_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./callite_spatial.json\")).json();\r\n\r\n  console.log(\"DATA: loading callite spatial data\");\r\n\r\n  return objs;\r\n})();\r\n\r\nexport const SPATIAL_FEATURES = (function () {\r\n  return mapBy(SPATIAL_DATA.features, ({ properties }) => properties.CalLiteID);\r\n})();\r\n\r\nexport const CALIFORNIA_OUTLINE = await (async function load() {\r\n  const objs = await (await fetch(\"./california.json\")).json();\r\n\r\n  console.log(\"DATA: loading california spatial data\");\r\n\r\n  return objs;\r\n})();\r\n\r\nexport const CALIFORNIA_CENTER = [-119, 37.7749];\r\n","import { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { worldToScreen } from \"utils/render-utils\";\r\nimport { useStateRef } from \"utils/misc-utils\";\r\n\r\nexport function useDragPanels(viewTransform) {\r\n  const [panels, setPanels, panelsRef] = useStateRef([]);\r\n  const mouseDownInfo = useRef({});\r\n\r\n  useEffect(function initialize() {\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX !== undefined) {\r\n        mouseDownInfo.current = {};\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const onPanelDragStart = useCallback(function (e, { id }) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    e.preventDefault();\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }, []);\r\n\r\n  function getPanelStyle({ x, y, offsetX, offsetY }) {\r\n    const [screenX, screenY] = worldToScreen(x, y, viewTransform);\r\n    return {\r\n      left: `${screenX + offsetX}px`,\r\n      top: `${screenY + offsetY}px`,\r\n    };\r\n  }\r\n\r\n  return {\r\n    panels,\r\n    panelsRef,\r\n    setPanels,\r\n    onPanelDragStart,\r\n    getPanelStyle,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { SPREAD_1_2, LOD_1_RAD_PX } from \"settings\";\r\n\r\nimport { circlet, hideElems, showElems } from \"utils/render-utils\";\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport {\r\n  calcLinesAndPositions,\r\n  getWaterdropGroups,\r\n} from \"utils/compareview-utils\";\r\nimport {\r\n  DEFAULT_SCENARIO,\r\n  DEFAULT_OBJECTIVE,\r\n  COMP_OBJECTIVE,\r\n  updateDropsSVG,\r\n} from \"utils/tutorialview-utils\";\r\n\r\nexport function useTutorialComparer() {\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const groupsRef = useRef();\r\n  const camCentersRef = useRef({});\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines] = calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop\r\n        );\r\n\r\n        updateLabel(avgCoords(positions));\r\n        updateScenIndicators(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  function initComparer(waterdrops, camera) {\r\n    groupsRef.current = getWaterdropGroups(\r\n      [DEFAULT_OBJECTIVE, COMP_OBJECTIVE],\r\n      waterdrops,\r\n      [0, 0]\r\n    );\r\n\r\n    const farHeight = waterdrops.groups[0].height * 2 * SPREAD_1_2 * 0.75;\r\n    const k = camera.height / farHeight;\r\n\r\n    let x = camera.width / 2;\r\n    let y = camera.height / 2;\r\n\r\n    const camMidpoint = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    x = -(groupsRef.current.groupPositions[0][0] * k) + camera.width / 2;\r\n    y = groupsRef.current.groupPositions[0][1] * k + camera.height / 2;\r\n\r\n    const camFirstDrop = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    camCentersRef.current.firstDrop = camFirstDrop;\r\n    camCentersRef.current.midpoint = camMidpoint;\r\n\r\n    const container = d3\r\n      .select(\"#comparer-graphics\")\r\n      .attr(\"width\", window.innerWidth)\r\n      .attr(\"height\", window.innerHeight)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-group\")\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(camFirstDrop.x, camFirstDrop.y)\r\n          .scale(camFirstDrop.k)\r\n      );\r\n\r\n    const indicatorGroup = container\r\n      .append(\"g\")\r\n      .attr(\"class\", \"indicator-group\");\r\n\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-variable\");\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    updateDropsSVG(container, groupsRef.current, {\r\n      onHover: (d) => {\r\n        setActiveMinidrop(d.key);\r\n      },\r\n    });\r\n\r\n    setActiveMinidrop(DEFAULT_SCENARIO);\r\n    hideElems(`.large-drop.${COMP_OBJECTIVE}, .indicator-group`, container);\r\n  }\r\n\r\n  function updateLabel(pos) {\r\n    const [textX, textY] = pos;\r\n\r\n    const smallTextSize =\r\n      (groupsRef.current.groups[0].height * SPREAD_1_2) / 15;\r\n    const largeTextSize =\r\n      (groupsRef.current.groups[0].height * SPREAD_1_2) / 10;\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-label\")\r\n      .text(\"scenario\")\r\n      .attr(\"font-size\", smallTextSize)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-variable\")\r\n      .attr(\"font-size\", largeTextSize)\r\n      .text(activeMinidrop.slice(4))\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY);\r\n  }\r\n\r\n  function updateScenIndicators(positions, lines) {\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".circlet\")\r\n      .data(positions)\r\n      .join(\"circle\")\r\n      .attr(\"class\", \"circlet\")\r\n      .call(circlet)\r\n      .attr(\"r\", LOD_1_RAD_PX * 1.5)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"cx\", (d) => d[0])\r\n      .attr(\"cy\", (d) => d[1]);\r\n\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".comp-line\")\r\n      .data(lines)\r\n      .join(\"path\")\r\n      .attr(\"class\", \"comp-line\")\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"d\", (d) => d3.line()(d));\r\n  }\r\n\r\n  function introDrop2() {\r\n    const container = d3.select(\"#comparer-graphics\");\r\n\r\n    container\r\n      .select(\".svg-group\")\r\n      .transition()\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(\r\n            camCentersRef.current.midpoint.x,\r\n            camCentersRef.current.midpoint.y\r\n          )\r\n          .scale(camCentersRef.current.midpoint.k)\r\n      );\r\n\r\n    showElems(`.large-drop.${COMP_OBJECTIVE}, .indicator-group`, container);\r\n  }\r\n\r\n  return { initComparer, introDrop2 };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\nimport { MAX_DELIVS } from \"data/objectives-data\";\r\nimport yearlyData from \"data/yearly.json\";\r\nimport {\r\n  DEFAULT_OBJECTIVE,\r\n  COMP_OBJECTIVE,\r\n  BAR_CHART_WIDTH,\r\n  BAR_CHART_HEIGHT,\r\n} from \"utils/tutorialview-utils\";\r\n\r\nconst BAR_CHART_MARGIN = { top: 40, right: 30, bottom: 40, left: 60 };\r\n\r\nexport function useTutorialGraph() {\r\n  const pagRefs = useRef({});\r\n  const prfRefs = useRef({});\r\n\r\n  function initGraphArea() {\r\n    initPAG();\r\n    initPRF();\r\n  }\r\n\r\n  function initPAG() {\r\n    const svgGroup = d3\r\n      .select(\"#pag-bar-graph\")\r\n      .attr(\r\n        \"width\",\r\n        BAR_CHART_WIDTH + BAR_CHART_MARGIN.left + BAR_CHART_MARGIN.right\r\n      )\r\n      .attr(\r\n        \"height\",\r\n        BAR_CHART_HEIGHT + BAR_CHART_MARGIN.top + BAR_CHART_MARGIN.bottom\r\n      )\r\n      .attr(\"opacity\", 1)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-group\")\r\n      .attr(\r\n        \"transform\",\r\n        `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n      );\r\n\r\n    const dataDescending = yearlyData[DEFAULT_OBJECTIVE].map(\r\n      (val, placeFromLeft) => ({\r\n        val,\r\n        placeFromLeft,\r\n        year: placeFromLeft + 1,\r\n      })\r\n    ).sort((a, b) => b.val - a.val);\r\n\r\n    const x = d3\r\n      .scaleBand()\r\n      .domain(dataDescending.map(({ year }) => year).sort((a, b) => a - b))\r\n      .range([0, BAR_CHART_WIDTH])\r\n      .padding(0.4);\r\n    const y = d3\r\n      .scaleLinear()\r\n      .domain([0, MAX_DELIVS])\r\n      .range([BAR_CHART_HEIGHT, 0]);\r\n\r\n    const xaxis = d3\r\n      .axisBottom(x)\r\n      .tickSize(0)\r\n      .tickFormat((d) => `year ${d}`)\r\n      .tickValues(x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0));\r\n\r\n    svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n    svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n    svgGroup\r\n      .select(\".anim-xaxis\")\r\n      .attr(\"opacity\", 1)\r\n      .attr(\"transform\", `translate(0, ${BAR_CHART_HEIGHT})`)\r\n      .call(xaxis)\r\n      .selectAll(\"text\")\r\n      .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n      .style(\"text-anchor\", \"end\");\r\n    svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n    pagRefs.current = { x, xaxis, dataDescending };\r\n  }\r\n\r\n  function initPRF() {\r\n    const svgGroup = d3\r\n      .select(\"#prf-bar-graph\")\r\n      .attr(\r\n        \"width\",\r\n        BAR_CHART_WIDTH + BAR_CHART_MARGIN.left + BAR_CHART_MARGIN.right\r\n      )\r\n      .attr(\r\n        \"height\",\r\n        BAR_CHART_HEIGHT + BAR_CHART_MARGIN.top + BAR_CHART_MARGIN.bottom\r\n      )\r\n      .attr(\"opacity\", 1)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-group\")\r\n      .attr(\r\n        \"transform\",\r\n        `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n      );\r\n\r\n    const dataDescending = yearlyData[COMP_OBJECTIVE].map(\r\n      (val, placeFromLeft) => ({\r\n        val,\r\n        placeFromLeft,\r\n        year: placeFromLeft + 1,\r\n      })\r\n    ).sort((a, b) => b.val - a.val);\r\n\r\n    const x = d3\r\n      .scaleBand()\r\n      .domain(dataDescending.map(({ year }) => year).sort((a, b) => a - b))\r\n      .range([0, BAR_CHART_WIDTH])\r\n      .padding(0.4);\r\n    const y = d3\r\n      .scaleLinear()\r\n      .domain([0, MAX_DELIVS])\r\n      .range([BAR_CHART_HEIGHT, 0]);\r\n\r\n    const xaxis = d3\r\n      .axisBottom(x)\r\n      .tickSize(0)\r\n      .tickFormat((d) => `year ${d}`)\r\n      .tickValues(x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0));\r\n\r\n    svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n    svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n    svgGroup\r\n      .select(\".anim-xaxis\")\r\n      .attr(\"opacity\", 1)\r\n      .attr(\"transform\", `translate(0, ${BAR_CHART_HEIGHT})`)\r\n      .call(xaxis)\r\n      .selectAll(\"text\")\r\n      .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n      .style(\"text-anchor\", \"end\");\r\n    svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n    prfRefs.current = { x, xaxis, dataDescending };\r\n  }\r\n\r\n  function initBars() {\r\n    initBarsPAG();\r\n    initBarsPRF();\r\n  }\r\n\r\n  function initBarsPAG() {\r\n    const { x, dataDescending } = pagRefs.current;\r\n    const y = d3\r\n      .scaleLinear()\r\n      .domain([0, MAX_DELIVS])\r\n      .range([BAR_CHART_HEIGHT, 0]);\r\n\r\n    d3.select(\"#pag-bar-graph .svg-group\")\r\n      .selectAll(\".bars\")\r\n      .data(dataDescending, (d) => d.placeFromLeft)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bars\")\r\n      .attr(\"x\", (d) => x(d.year))\r\n      .attr(\"y\", BAR_CHART_HEIGHT)\r\n      .attr(\"width\", x.bandwidth())\r\n      .attr(\"height\", 0)\r\n      .attr(\"opacity\", 1)\r\n      .attr(\"fill\", \"steelblue\")\r\n      .transition()\r\n      .duration(500)\r\n      .delay((d) => d.placeFromLeft * 10)\r\n      .attr(\"y\", (d) => y(d.val))\r\n      .attr(\"height\", (d) => BAR_CHART_HEIGHT - y(d.val));\r\n  }\r\n\r\n  function initBarsPRF() {\r\n    const { x, dataDescending } = prfRefs.current;\r\n    const y = d3\r\n      .scaleLinear()\r\n      .domain([0, MAX_DELIVS])\r\n      .range([BAR_CHART_HEIGHT, 0]);\r\n\r\n    d3.select(\"#prf-bar-graph .svg-group\")\r\n      .selectAll(\".bars\")\r\n      .data(dataDescending, (d) => d.placeFromLeft)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bars\")\r\n      .attr(\"x\", (d) => x(d.year))\r\n      .attr(\"y\", BAR_CHART_HEIGHT)\r\n      .attr(\"width\", x.bandwidth())\r\n      .attr(\"height\", 0)\r\n      .attr(\"opacity\", 1)\r\n      .attr(\"fill\", \"steelblue\")\r\n      .transition()\r\n      .duration(500)\r\n      .delay((d) => d.placeFromLeft * 10)\r\n      .attr(\"y\", (d) => y(d.val))\r\n      .attr(\"height\", (d) => BAR_CHART_HEIGHT - y(d.val));\r\n  }\r\n\r\n  function condenseBars() {\r\n    condensePAG();\r\n    condensePRF();\r\n  }\r\n\r\n  async function condensePAG() {\r\n    const { x, xaxis, dataDescending } = pagRefs.current;\r\n    const newWidth = BAR_CHART_WIDTH / 8;\r\n    const svgGroup = d3.select(\"#pag-bar-graph .svg-group\");\r\n\r\n    svgGroup.select(\".anim-xaxis\").call(xaxis.tickFormat(\"\"));\r\n\r\n    const bars = svgGroup.selectAll(\".bars\");\r\n\r\n    await bars\r\n      .style(\"mix-blend-mode\", \"multiply\")\r\n      .transition()\r\n      .duration(500)\r\n      .attr(\"opacity\", 0.05)\r\n      .transition()\r\n      .delay(\r\n        (d) =>\r\n          100 + (1 - (1 - d.placeFromLeft / dataDescending.length) ** 4) * 1000\r\n      )\r\n      .duration(500)\r\n      .attr(\"width\", newWidth)\r\n      .attr(\"x\", BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n      .end();\r\n\r\n    svgGroup\r\n      .select(\".anim-xaxis\")\r\n      .transition()\r\n      .transition(500)\r\n      .attr(\"transform\", `translate(0, ${BAR_CHART_HEIGHT + 50})`)\r\n      .attr(\"opacity\", 0);\r\n\r\n    bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n    svgGroup\r\n      .transition()\r\n      .delay(500)\r\n      .attr(\r\n        \"transform\",\r\n        `translate(${\r\n          BAR_CHART_MARGIN.left + BAR_CHART_WIDTH / 2 - newWidth / 2\r\n        },${BAR_CHART_MARGIN.top})`\r\n      );\r\n  }\r\n\r\n  async function condensePRF() {\r\n    const { x, xaxis, dataDescending } = prfRefs.current;\r\n    const newWidth = BAR_CHART_WIDTH / 8;\r\n    const svgGroup = d3.select(\"#prf-bar-graph .svg-group\");\r\n\r\n    svgGroup.select(\".anim-xaxis\").call(xaxis.tickFormat(\"\"));\r\n\r\n    const bars = svgGroup.selectAll(\".bars\");\r\n\r\n    await bars\r\n      .style(\"mix-blend-mode\", \"multiply\")\r\n      .transition()\r\n      .duration(500)\r\n      .attr(\"opacity\", 0.05)\r\n      .transition()\r\n      .delay(\r\n        (d) =>\r\n          100 + (1 - (1 - d.placeFromLeft / dataDescending.length) ** 4) * 1000\r\n      )\r\n      .duration(500)\r\n      .attr(\"width\", newWidth)\r\n      .attr(\"x\", BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n      .end();\r\n\r\n    svgGroup\r\n      .select(\".anim-xaxis\")\r\n      .transition()\r\n      .transition(500)\r\n      .attr(\"transform\", `translate(0, ${BAR_CHART_HEIGHT + 50})`)\r\n      .attr(\"opacity\", 0);\r\n\r\n    bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n    svgGroup\r\n      .transition()\r\n      .delay(500)\r\n      .attr(\r\n        \"transform\",\r\n        `translate(${\r\n          BAR_CHART_MARGIN.left + BAR_CHART_WIDTH / 2 - newWidth / 2\r\n        },${BAR_CHART_MARGIN.top})`\r\n      );\r\n  }\r\n\r\n  return {\r\n    initGraphArea,\r\n    initBars,\r\n    condenseBars,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useState } from \"react\";\r\nimport { VARIATIONS } from \"utils/tutorialview-utils\";\r\n\r\nexport function useTutorialState() {\r\n  const [userGoal, setUserGoal] = useState(200);\r\n  const [bucketInterperPAG, setBucketInterperPAG] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [bucketInterperPRF, setBucketInterperPRF] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [dropInterper, setDropInterper] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [variationInterpers, setVariationInterpers] = useState(() =>\r\n    VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n  );\r\n\r\n  return {\r\n    userGoal,\r\n    setUserGoal,\r\n    bucketInterperPAG,\r\n    setBucketInterperPAG,\r\n    bucketInterperPRF,\r\n    setBucketInterperPRF,\r\n    dropInterper,\r\n    setDropInterper,\r\n    variationInterpers,\r\n    setVariationInterpers,\r\n  };\r\n}\r\n","export const LOD_1_LEVELS = 5;\r\nexport const LOD_1_RAD_PX = 1;\r\nexport const LOD_1_MIN_LEV_VAL = 0.1;\r\nexport const LOD_1_SMALL_DROP_PAD_FACTOR = 1.3;\r\nexport const LOD_1_LARGE_DROP_PAD_FACTOR = 1.2;\r\n\r\nexport const LOD_2_SMALL_DROP_PAD_FACTOR = 3;\r\n\r\nexport const GROUP_HOVER_AREA_FACTOR = 1.1 / (1 + Math.SQRT1_2);\r\nexport const SPREAD_1_2 =\r\n  LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\nimport { LOD_1_LEVELS } from \"settings\";\r\nimport { copyCoords, sortBy } from \"./misc-utils\";\r\nimport { rotatePoints, toRadians } from \"./math-utils\";\r\nimport {\r\n  waterdropDeltaOutline,\r\n  waterdropDelta,\r\n  worldToScreen,\r\n  screenToWorld,\r\n} from \"./render-utils\";\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return {\r\n    x: (mouseX / width) * 2 - 1,\r\n    y: -(mouseY / height) * 2 + 1,\r\n  };\r\n}\r\n\r\nexport class WaterdropMesh {\r\n  static MAX_POINTS_DROPS = 60 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n  static MAX_POINTS_OUTLINE = 40 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n\r\n  dropsMesh;\r\n  outlineMesh;\r\n\r\n  added = false;\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.dropsMesh) {\r\n      this.initializeMeshes(waterdrops);\r\n    } else {\r\n      this.updateMeshes(waterdrops);\r\n    }\r\n  }\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.dropsMesh);\r\n      scene.add(this.outlineMesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.dropsMesh);\r\n      scene.remove(this.outlineMesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  // TODO optimize!\r\n  initializeMeshes(waterdrops) {\r\n    const dropsGeometry = new MeshGeometry(WaterdropMesh.MAX_POINTS_DROPS);\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = waterdropDeltaOutline(\r\n      0,\r\n      1,\r\n      LOD_1_RAD_PX * 2 * 0.975\r\n    );\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const {\r\n        id,\r\n        globalX: x,\r\n        globalY: y,\r\n        levs,\r\n        maxLev,\r\n        globalTilt: tilt,\r\n      } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = waterdropDelta(\r\n          l1 / maxLev,\r\n          l2 / maxLev,\r\n          LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / LOD_1_LEVELS)\r\n        );\r\n\r\n        dropsGeometry.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y, rotate: tilt },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      const rotOutline = rotatePoints(copyCoords(outlineMeshCoords), tilt);\r\n\r\n      outlinePoints.push(\r\n        ...rotOutline.map(([dx, dy]) => {\r\n          return new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01);\r\n        })\r\n      );\r\n    }\r\n\r\n    dropsGeometry.finish();\r\n\r\n    this.dropsMesh = new THREE.Mesh(\r\n      dropsGeometry.threeGeom,\r\n      new THREE.MeshBasicMaterial({\r\n        vertexColors: true,\r\n        transparent: true,\r\n        opacity: 1,\r\n      })\r\n    );\r\n\r\n    this.outlineMesh = new THREE.LineSegments(\r\n      new THREE.BufferGeometry().setFromPoints(outlinePoints),\r\n      new THREE.LineBasicMaterial({\r\n        color: 13421772,\r\n        transparent: true,\r\n        opacity: 0,\r\n      })\r\n    );\r\n  }\r\n\r\n  updateOutlineVisibility(opac) {\r\n    if (!this.outlineMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateVisibility(opac) {\r\n    if (!this.outlineMesh || !this.dropsMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n    this.dropsMesh.material.opacity = opac;\r\n    this.dropsMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateMeshes(waterdrops) {\r\n    // TODO fix\r\n  }\r\n}\r\n\r\nexport class WaterdropSimplifiedMesh {\r\n  mesh;\r\n  added = false;\r\n\r\n  vertToId = {};\r\n  idToVert = {};\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.mesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.mesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.mesh) {\r\n      this.initializeMesh(waterdrops);\r\n    }\r\n\r\n    this.updateMesh(waterdrops);\r\n\r\n    return this.mesh;\r\n  }\r\n\r\n  initializeMesh(waterdrops) {\r\n    const pointsGeometry = new THREE.BufferGeometry();\r\n\r\n    const vertices = [];\r\n    const colors = [];\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, domLev } = waterdrops.nodes[i];\r\n\r\n      const color = domLev > 0 ? interpolateWatercolorBlue(domLev) : \"white\";\r\n\r\n      vertices.push(x, -y, 0);\r\n      const t_color = new THREE.Color(color);\r\n      colors.push(t_color.r, t_color.g, t_color.b);\r\n\r\n      this.vertToId[i] = id;\r\n      this.idToVert[id] = i;\r\n    }\r\n\r\n    const pointsMaterial = new THREE.PointsMaterial({\r\n      size: LOD_1_RAD_PX * 2,\r\n      sizeAttenuation: true,\r\n      vertexColors: true,\r\n      map: new THREE.TextureLoader().load(\"drop.png\"),\r\n      transparent: true,\r\n    });\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(vertices), 3)\r\n    );\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"color\",\r\n      new THREE.BufferAttribute(new Float32Array(colors), 3)\r\n    );\r\n\r\n    this.mesh = new THREE.Points(pointsGeometry, pointsMaterial);\r\n  }\r\n\r\n  updateMesh(waterdrops) {\r\n    const positionAttr = this.mesh.geometry.getAttribute(\"position\");\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: newX, globalY: newY } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n      positionAttr.setXY(idx, newX, -newY);\r\n    }\r\n    positionAttr.needsUpdate = true;\r\n  }\r\n\r\n  updatePoints(waterdrops, translations, dt) {\r\n    const verts = this.mesh.geometry.vertices;\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n\r\n      const [dx, dy] = translations[id];\r\n\r\n      const x = verts[idx].x;\r\n      const y = verts[idx].y;\r\n\r\n      verts[idx].setX(x + dt * dx);\r\n      verts[idx].setY(y - dt * dy);\r\n    }\r\n\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n\r\n  intersectObject(camera, x, y) {\r\n    const intersects = camera.intersectObject(x, y, this.mesh);\r\n\r\n    if (intersects[0]) {\r\n      const intersect = sortBy(intersects, \"distanceToRay\")[0];\r\n      return this.vertToId[intersect.index];\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  webglView;\r\n  curTransform;\r\n\r\n  raycaster = new THREE.Raycaster();\r\n\r\n  svgView;\r\n\r\n  constructor({ fov, near, far }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n  }\r\n\r\n  create({ width, height, webglElement, svgElement, zoomFn }) {\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.webglView = d3.select(webglElement);\r\n    this.svgView = d3.select(svgElement);\r\n\r\n    this.zoom = d3.zoom().on(\"zoom\", (e) => {\r\n      this.curTransform = e.transform;\r\n\r\n      this.#THREEHandleZoom(e.transform);\r\n      this.svgView.attr(\"transform\", e.transform);\r\n\r\n      zoomFn && zoomFn(e.transform);\r\n    });\r\n\r\n    this.#finishCreate();\r\n  }\r\n\r\n  callZoom(transform) {\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity.translate(transform.x, transform.y).scale(transform.k)\r\n    );\r\n  }\r\n\r\n  callZoomFromWorldViewport({ worldX, worldY, farHeight }) {\r\n    const k = this.height / farHeight;\r\n\r\n    const x = -(worldX * k) + this.width / 2;\r\n    const y = worldY * k + this.height / 2;\r\n\r\n    this.callZoom({\r\n      x,\r\n      y,\r\n      k,\r\n    });\r\n  }\r\n\r\n  interpolateZoomCamera([endx, endy, endz]) {\r\n    const i = d3.interpolateZoom(\r\n      [\r\n        this.camera.position.x,\r\n        this.camera.position.y,\r\n        this.height / this.curTransform.k,\r\n      ],\r\n      [endx, -endy, this.getFarHeightFromZ(endz)]\r\n    );\r\n\r\n    const interper = (t) => {\r\n      const [worldX, worldY, farHeight] = i(t);\r\n\r\n      const k = this.height / farHeight;\r\n\r\n      const x = -(worldX * k) + this.width / 2;\r\n      const y = worldY * k + this.height / 2;\r\n\r\n      return {\r\n        x,\r\n        y,\r\n        k,\r\n      };\r\n    };\r\n\r\n    interper.duration = i.duration;\r\n\r\n    return interper;\r\n  }\r\n\r\n  getZFromFarHeight(farHeight) {\r\n    return (Math.tan(toRadians(90 - this.fov / 2)) * farHeight) / 2;\r\n  }\r\n\r\n  getFarHeightFromZ(z) {\r\n    return Math.tan(toRadians(this.fov) / 2) * z * 2;\r\n  }\r\n\r\n  getScaleFromZ(z) {\r\n    const farHeight = this.getFarHeightFromZ(z);\r\n    const scale = this.height / farHeight;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const scaleHeight = this.height / scale;\r\n    const z = this.getZFromFarHeight(scaleHeight);\r\n    return z;\r\n  }\r\n\r\n  intersectObject(mouseX, mouseY, mesh) {\r\n    this.raycaster.setFromCamera(\r\n      {\r\n        x: mouseX,\r\n        y: mouseY,\r\n      },\r\n      this.camera\r\n    );\r\n\r\n    return this.raycaster.intersectObject(mesh);\r\n  }\r\n\r\n  worldToScreen(x, y) {\r\n    return worldToScreen(x, y, this.curTransform);\r\n  }\r\n\r\n  screenToWorld(x, y) {\r\n    return screenToWorld(x, y, this.curTransform);\r\n  }\r\n\r\n  #finishCreate() {\r\n    this.zoom = this.zoom.scaleExtent([\r\n      this.getScaleFromZ(this.far),\r\n      this.getScaleFromZ(this.near),\r\n    ]);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      this.fov,\r\n      this.width / this.height,\r\n      this.near,\r\n      this.far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.webglView.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  #THREEHandleZoom(transform) {\r\n    const scale = transform.k;\r\n    const x = -(transform.x - this.width / 2) / scale;\r\n    const y = (transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n}\r\n\r\nclass MeshGeometry {\r\n  threeGeom = new THREE.BufferGeometry();\r\n  triangleIdx = 0;\r\n  positionAttribute;\r\n  colorAttribute;\r\n\r\n  constructor(numPoints, color = true) {\r\n    this.threeGeom.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n    );\r\n\r\n    if (color)\r\n      this.threeGeom.setAttribute(\r\n        \"color\",\r\n        new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n      );\r\n\r\n    this.positionAttribute = this.threeGeom.getAttribute(\"position\");\r\n    this.colorAttribute = this.threeGeom.getAttribute(\"color\");\r\n  }\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = rotatePoints(\r\n        copyCoords(meshCoords[j]),\r\n        transform.rotate\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 0,\r\n        transform.x + v1[0],\r\n        transform.y - v1[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 1,\r\n        transform.x + v2[0],\r\n        transform.y - v2[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 2,\r\n        transform.x + v3[0],\r\n        transform.y - v3[1],\r\n        z\r\n      );\r\n\r\n      if (color) {\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 0,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 1,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 2,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n      }\r\n\r\n      this.triangleIdx++;\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    this.threeGeom.setDrawRange(0, this.triangleIdx * 3);\r\n  }\r\n}\r\n","import * as THREE from \"three\";\r\n\r\nimport { WaterdropMesh, Camera } from \"utils/three-utils\";\r\n\r\nconst scene = (function getScene() {\r\n  const s = new THREE.Scene();\r\n  s.background = new THREE.Color(0xefefef);\r\n  return s;\r\n})();\r\n\r\nconst dropsMesh = new WaterdropMesh();\r\n\r\nconst camera = new Camera({\r\n  fov: 45,\r\n  near: 1,\r\n  far: 3000,\r\n});\r\n\r\nconst renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\r\nexport { scene, camera, renderer, dropsMesh };\r\n","import { ticksExact } from \"bucket-lib/utils\";\r\nimport {\r\n  LOD_1_LARGE_DROP_PAD_FACTOR,\r\n  LOD_1_LEVELS,\r\n  LOD_1_MIN_LEV_VAL,\r\n  LOD_1_RAD_PX,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\n\r\nimport {\r\n  DATA_GROUPINGS,\r\n  FLATTENED_DATA,\r\n  MAX_DELIVS,\r\n  OBJECTIVE_IDS,\r\n  SCENARIO_IDS,\r\n} from \"data/objectives-data\";\r\n\r\nimport { calcDomLev, createInterpsFromDelivs } from \"utils/data-utils\";\r\nimport { placeDropsUsingPhysics, rotatePoint } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\n// TODO optimize!!\r\nexport function initWaterdrops(grouping) {\r\n  const groupKeys = grouping === \"objective\" ? OBJECTIVE_IDS : SCENARIO_IDS;\r\n  const memberKeys = grouping === \"objective\" ? SCENARIO_IDS : OBJECTIVE_IDS;\r\n\r\n  const amtGroups = groupKeys.length;\r\n  const amtPerGroup = memberKeys.length;\r\n\r\n  const largeDropRad =\r\n    Math.sqrt(amtPerGroup / Math.PI) *\r\n    LOD_1_RAD_PX *\r\n    2 *\r\n    LOD_1_SMALL_DROP_PAD_FACTOR *\r\n    LOD_1_LARGE_DROP_PAD_FACTOR;\r\n  const smallDropRad = LOD_1_RAD_PX * LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  const largeNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    groupKeys.map((p, idx) => ({\r\n      r: largeDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  for (let i = 0; i < largeNodesPhys.length; i++) {\r\n    largeNodesPhys[i].tilt = Math.random() * 50 - 25;\r\n  }\r\n\r\n  const largeNodesPos = mapBy(largeNodesPhys, ({ id }) => id);\r\n\r\n  const smallNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    memberKeys.map((s, idx) => ({\r\n      r: smallDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const smallNodesPos = mapBy(smallNodesPhys, ({ id }) => id);\r\n\r\n  const nodes = [];\r\n  const groupNodes = [];\r\n\r\n  const groupToNodes = {};\r\n\r\n  let idx = 0;\r\n\r\n  for (const nodeData of FLATTENED_DATA) {\r\n    const { id, objective, scenario, deliveries } = nodeData;\r\n\r\n    const i = createInterpsFromDelivs(deliveries, MAX_DELIVS);\r\n    const wds = ticksExact(0, 1, LOD_1_LEVELS + 1).map((d) => i(d));\r\n\r\n    const levs = wds.map(\r\n      (w, i) => Math.max(w, i == 0 ? LOD_1_MIN_LEV_VAL : 0) * LOD_1_RAD_PX\r\n    );\r\n\r\n    const groupID = grouping === \"objective\" ? objective : scenario;\r\n    const memberID = grouping === \"objective\" ? scenario : objective;\r\n\r\n    const groupRank = DATA_GROUPINGS[grouping][groupID].rank;\r\n    const memberRank = DATA_GROUPINGS[grouping][groupID][id];\r\n\r\n    const localTilt = Math.random() * 50 - 25;\r\n    const parentTilt = largeNodesPos[groupRank].tilt;\r\n\r\n    const { x, y } = smallNodesPos[memberRank];\r\n    const [rotatedX, rotatedY] = rotatePoint(x, y, parentTilt);\r\n\r\n    const node = {\r\n      id,\r\n      levs,\r\n      maxLev: LOD_1_RAD_PX,\r\n      domLev: calcDomLev(levs),\r\n      tilt: localTilt,\r\n      dur: Math.random() * 100 + 400,\r\n      x,\r\n      y,\r\n      group: groupID,\r\n      key: memberID,\r\n      globalX: largeNodesPos[groupRank].x + rotatedX,\r\n      globalY: largeNodesPos[groupRank].y + rotatedY,\r\n      globalTilt: parentTilt + localTilt,\r\n    };\r\n\r\n    nodes.push(node);\r\n\r\n    if (!groupToNodes[groupID]) groupToNodes[groupID] = [];\r\n\r\n    groupToNodes[groupID].push(node);\r\n  }\r\n\r\n  for (const groupKey of groupKeys) {\r\n    const { x, y, tilt } =\r\n      largeNodesPos[DATA_GROUPINGS[grouping][groupKey].rank];\r\n    groupNodes.push({\r\n      x,\r\n      y,\r\n      tilt,\r\n      key: groupKey,\r\n      height: smallNodesPhys.height,\r\n      nodes: groupToNodes[groupKey],\r\n    });\r\n  }\r\n\r\n  return {\r\n    nodes: nodes,\r\n    groups: groupNodes,\r\n    height: largeNodesPhys.height,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\n\r\nimport { LOD_1_LEVELS, LOD_1_RAD_PX, SPREAD_1_2 } from \"settings\";\r\n\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { clipEnds, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { genUUID, wrap } from \"utils/misc-utils\";\r\nimport { DROPLET_SHAPE, generateTSpan } from \"utils/render-utils\";\r\nimport { circlet, gradientInit, gradientUpdate } from \"./render-utils\";\r\n\r\nexport function updateDropsSVG(\r\n  container,\r\n  waterdropGroups,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartGroupLoc = ({ x, y, tilt }) =>\r\n    `translate(${x}, ${y}) rotate(${tilt})`;\r\n  const getEndGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`;\r\n\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(largeDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartGroupLoc)\r\n    .each(function (node) {\r\n      const drops = d3\r\n        .select(this)\r\n        .call(largeDropUpdate(node, transitionDelay))\r\n        .selectAll(\".small-drop\");\r\n\r\n      if (onClick) {\r\n        drops.on(\"click\", function (_, d) {\r\n          onClick(d);\r\n        });\r\n      }\r\n\r\n      if (onHover) {\r\n        drops.on(\"mouseenter\", function (_, d) {\r\n          d3.select(this.parentNode).raise();\r\n          onHover(d);\r\n        });\r\n      }\r\n\r\n      if (onUnhover) {\r\n        drops.on(\"mouseleave\", function (_, d) {\r\n          onUnhover(d);\r\n        });\r\n      }\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndGroupLoc);\r\n}\r\n\r\nexport function updateColorDrops(container, waterdropGroups, opacFn, color) {\r\n  const getGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`;\r\n\r\n  container\r\n    .selectAll(\".color-drop-group\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function ({ nodes }) {\r\n        d3.select(this).call((s) => {\r\n          s.attr(\"class\", \"color-drop-group\")\r\n            .selectAll(\".color-drop\")\r\n            .data(nodes)\r\n            .join(\"circle\")\r\n            .attr(\"class\", \"color-drop\")\r\n            .attr(\"r\", LOD_1_RAD_PX);\r\n        });\r\n      });\r\n    })\r\n    .attr(\"transform\", getGroupLoc)\r\n    .each(function () {\r\n      d3.select(this)\r\n        .selectAll(\".color-drop\")\r\n        .call((s) => {\r\n          s.attr(\"opacity\", ({ key }) => opacFn(key)).attr(\"fill\", color);\r\n        })\r\n        .attr(\"cx\", ({ x }) => x * SPREAD_1_2)\r\n        .attr(\"cy\", ({ y }) => y * SPREAD_1_2);\r\n    });\r\n}\r\n\r\nexport function getWaterdropGroups(keyArr, waterdrops, center) {\r\n  const groups = keyArr.map((k) => waterdrops.groups.find((g) => g.key === k));\r\n\r\n  const groupPositions = [];\r\n  const rad = groups[0].height * SPREAD_1_2 * 0.75;\r\n\r\n  for (let i = 0, n = groups.length; i < n; i++) {\r\n    const angle = ((Math.PI * 2) / n) * (i - 0.5) - Math.PI / 2;\r\n    groupPositions.push([\r\n      center[0] + Math.cos(angle) * rad,\r\n      center[1] + Math.sin(angle) * rad,\r\n    ]);\r\n  }\r\n\r\n  return {\r\n    groups,\r\n    groupPositions,\r\n  };\r\n}\r\n\r\nexport function calcLinesAndPositions(groupsObj, activeMinidropKey) {\r\n  const positions = [];\r\n  const nodes = [];\r\n  for (let i = 0; i < groupsObj.groups.length; i++) {\r\n    const group = groupsObj.groups[i];\r\n    const groupPos = groupsObj.groupPositions[i];\r\n\r\n    const node = group.nodes.find((n) => n.key === activeMinidropKey);\r\n\r\n    nodes.push(node);\r\n\r\n    positions.push([\r\n      node.x * SPREAD_1_2 + groupPos[0],\r\n      node.y * SPREAD_1_2 +\r\n        groupPos[1] -\r\n        dropCenterCorrection({ rad: LOD_1_RAD_PX }),\r\n    ]);\r\n  }\r\n\r\n  const lines = [];\r\n\r\n  for (let i = 0; i < positions.length; i++) {\r\n    const from = Array.from(positions[i]),\r\n      to = Array.from(positions[i + 1 == positions.length ? 0 : i + 1]);\r\n\r\n    clipEnds([from, to], LOD_1_RAD_PX * 2);\r\n\r\n    lines.push([from, to]);\r\n  }\r\n\r\n  return [positions, lines, nodes];\r\n}\r\n\r\nexport function updateLabelSVG(pos, labelText, normedTextSize) {\r\n  const [textX, textY] = pos;\r\n\r\n  const smallTextSize = normedTextSize / 15;\r\n  const largeTextSize = normedTextSize / 10;\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-label\")\r\n    .text(\"scenario\")\r\n    .attr(\"font-size\", smallTextSize)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-variable\")\r\n    .attr(\"font-size\", largeTextSize)\r\n    .text(labelText)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY);\r\n}\r\n\r\nexport function updateScenIndicatorsSVG(positions, lines) {\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".circlet\")\r\n    .data(positions)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"circlet\")\r\n    .call(circlet)\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\"r\", LOD_1_RAD_PX * 1.5)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"cx\", (d) => d[0])\r\n    .attr(\"cy\", (d) => d[1]);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".comp-line\")\r\n    .data(lines)\r\n    .join(\"path\")\r\n    .attr(\"class\", \"comp-line\")\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"d\", (d) => d3.line()(d));\r\n}\r\n\r\nfunction largeDropInit({ nodes, height }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"large-drop\");\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"stroke\", \"none\")\r\n      .attr(\"fill\", \"yellow\")\r\n      .attr(\"r\", LOD_1_RAD_PX * 2);\r\n\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"fancy-font large-gray-text\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate({ nodes, key, height }, transitionDelay) {\r\n  return (s) => {\r\n    const getStartDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x}, ${y}) rotate(${tilt})`;\r\n    const getEndDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x * SPREAD_1_2}, ${y * SPREAD_1_2}) rotate(${tilt})`;\r\n\r\n    const baselinePos = {};\r\n\r\n    s.call(textUpdate(key, height))\r\n      .selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\"transform\", getStartDropLoc)\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n      })\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"transform\", getEndDropLoc);\r\n\r\n    s.select(\".highlight-circle\")\r\n      .attr(\"cx\", baselinePos.x)\r\n      .attr(\r\n        \"cy\",\r\n\r\n        baselinePos.y - dropCenterCorrection({ rad: LOD_1_RAD_PX })\r\n      )\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"cx\", baselinePos.x * SPREAD_1_2)\r\n      .attr(\r\n        \"cy\",\r\n\r\n        baselinePos.y * SPREAD_1_2 - dropCenterCorrection({ rad: LOD_1_RAD_PX })\r\n      );\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ levs }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const randId = `compare-grad-${genUUID()}`;\r\n\r\n    s.call(gradientInit(levs, randId));\r\n\r\n    s.append(\"path\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"class\", \"outline\")\r\n      .attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${randId})`)\r\n      .attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction textUpdate(key, height) {\r\n  return (s) => {\r\n    s.select(\"text\")\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", (height / 2) * SPREAD_1_2 * 0.9)\r\n      .call(\r\n        generateTSpan(\r\n          DESCRIPTIONS_DATA[key].display_name || DESCRIPTIONS_DATA[key].id\r\n        )\r\n      );\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\n\r\nimport { SCENARIO_KEY_STRING, DELIV_KEY_STRING } from \"data/objectives-data\";\r\n\r\nexport function createInterps(obj_name, scen_name, data, maxDelivs) {\r\n  const delivs =\r\n    data[obj_name][SCENARIO_KEY_STRING][scen_name][DELIV_KEY_STRING];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\nexport function createInterpsFromDelivs(delivs, maxDelivs) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\n// TODO fix colors\r\nexport function calcDomLev(levs) {\r\n  levs = [1, ...levs, 0];\r\n\r\n  let mean = 0;\r\n  for (let i = 0; i < levs.length - 1; i++) {\r\n    const dif = levs[i] - levs[i + 1];\r\n    mean += (dif * (i - 1)) / (levs.length + 4);\r\n  }\r\n\r\n  return mean;\r\n}\r\n\r\nexport const SETT_NAME_SHORT = [\"D\", \"C\", \"P\", \"R\", \"M\"];\r\nexport const SETT_NAME_FULL = [\r\n  \"Demand\",\r\n  \"Carryover\",\r\n  \"Priority\",\r\n  \"Regs.\",\r\n  \"Min. Flow\",\r\n];\r\nexport const SETT_VAL_STEPS = [\r\n  [1, 0.9, 0.8, 0.7, 0.6].reverse(), // demand\r\n  [1.0, 1.2, 1.3], // carryover\r\n  [0, 1], // priority\r\n  [1, 2, 3, 4], // regs\r\n  [0, 0.4, 0.6, 0.7, 0.8], // minflow\r\n];\r\n\r\nexport const SETT_NUM_OPTS = {\r\n  demand: SETT_VAL_STEPS[0].length,\r\n  carryover: SETT_VAL_STEPS[1].length,\r\n  priority: SETT_VAL_STEPS[2].length,\r\n  regs: SETT_VAL_STEPS[3].length,\r\n  minflow: SETT_VAL_STEPS[4].length,\r\n};\r\n\r\nexport function deserialize(scenStr) {\r\n  let scenNum = parseInt(scenStr);\r\n\r\n  const minflow = scenNum % SETT_NUM_OPTS.minflow;\r\n  scenNum = (scenNum - minflow) / SETT_NUM_OPTS.minflow;\r\n\r\n  const regs = scenNum % SETT_NUM_OPTS.regs;\r\n  scenNum = (scenNum - regs) / SETT_NUM_OPTS.regs;\r\n\r\n  const priority = scenNum % SETT_NUM_OPTS.priority;\r\n  scenNum = (scenNum - priority) / SETT_NUM_OPTS.priority;\r\n\r\n  const carryover = scenNum % SETT_NUM_OPTS.carryover;\r\n  scenNum = (scenNum - carryover) / SETT_NUM_OPTS.carryover;\r\n\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demand = scenNum % SETT_NUM_OPTS.demand;\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n\r\n  return [demandReverse, carryover, priority, regs, minflow];\r\n}\r\n\r\nexport function serialize(demand, carryover, priority, regs, minflow) {\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n  let code = 0;\r\n  code += minflow;\r\n  code += SETT_NUM_OPTS.minflow * regs;\r\n  code += SETT_NUM_OPTS.regs * SETT_NUM_OPTS.minflow * priority;\r\n  code +=\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    carryover;\r\n  code +=\r\n    SETT_NUM_OPTS.carryover *\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    demandReverse;\r\n\r\n  const finalKey = `expl${d3.format(\"0>4\")(code)}`;\r\n\r\n  return finalKey;\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\n\r\nimport { LOD_1_LEVELS, LOD_1_RAD_PX, SPREAD_1_2 } from \"settings\";\r\n\r\nimport { dropCenterCorrection } from \"utils/math-utils\";\r\nimport { DROPLET_SHAPE, circlet } from \"utils/render-utils\";\r\nimport { gradientInit, gradientUpdate } from \"./render-utils\";\r\n\r\nexport function updateSmallDropSVG(\r\n  container,\r\n  waterdropGroup,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartLoc = ({ globalX, globalY, globalTilt }) =>\r\n    `translate(${globalX}, ${globalY}) rotate(${globalTilt})`;\r\n  const getEndLoc = ({ x, y, tilt }) =>\r\n    `translate(${waterdropGroup.x + x * SPREAD_1_2}, ${\r\n      waterdropGroup.y + y * SPREAD_1_2\r\n    }) rotate(${tilt})`;\r\n\r\n  const baselinePos = {};\r\n\r\n  const drops = container\r\n    .selectAll(\".small-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node, i) {\r\n        d3.select(this).call(smallDropInit(node, i));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartLoc)\r\n    .each(function (node) {\r\n      d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n    });\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n\r\n  drops\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndLoc);\r\n\r\n  container\r\n    .select(\".highlight-circle\")\r\n    .attr(\"stroke\", \"none\")\r\n    .attr(\"fill\", \"yellow\")\r\n    .attr(\"r\", LOD_1_RAD_PX * 2)\r\n    .attr(\"cx\", waterdropGroup.x + baselinePos.x)\r\n    .attr(\r\n      \"cy\",\r\n      waterdropGroup.y +\r\n        baselinePos.y -\r\n        dropCenterCorrection({ rad: LOD_1_RAD_PX })\r\n    )\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"cx\", waterdropGroup.x + baselinePos.x * SPREAD_1_2)\r\n    .attr(\r\n      \"cy\",\r\n      waterdropGroup.y +\r\n        baselinePos.y * SPREAD_1_2 -\r\n        dropCenterCorrection({ rad: LOD_1_RAD_PX })\r\n    );\r\n}\r\n\r\nexport function updateColorDrops(container, waterdropGroup, opacFn, color) {\r\n  container\r\n    .selectAll(\".color-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"color-drop\")\r\n    .attr(\"r\", LOD_1_RAD_PX)\r\n    .attr(\"opacity\", ({ key }) => opacFn(key))\r\n    .attr(\"fill\", color)\r\n    .attr(\"cx\", ({ x }) => waterdropGroup.x + x * SPREAD_1_2)\r\n    .attr(\"cy\", ({ y }) => waterdropGroup.y + y * SPREAD_1_2);\r\n}\r\n\r\nfunction smallDropInit({ levs }, i) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"small-drop hover-capture\");\r\n\r\n    s.call(gradientInit(levs, `drop-fill-${i}`));\r\n\r\n    s.append(\"path\").attr(\"d\", DROPLET_SHAPE).attr(\"class\", \"outline\");\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#drop-fill-${i})`);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"circlet interactive\")\r\n      .call(circlet)\r\n      .attr(\"cy\", -dropCenterCorrection({ rad: 1 }))\r\n      .attr(\"r\", 1.5);\r\n\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, id, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n    s.select(\".outline\").attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n    s.select(\".fill\").attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n\r\n    s.select(\".circlet\")\r\n      .attr(\"class\", null)\r\n      // TODO find better way to toggle i1234, prob with id\r\n      .attr(\"class\", \"circlet interactive i\" + id);\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport Matter from \"matter-js\";\r\n\r\nimport { CIRC_RAD, DROP_HEIGHT } from \"./render-utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor((Math.sqrt(AREA / 3.14) * 2) / 2);\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes, reuse = false) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r));\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\nexport function percentToRatioFilled(p) {\r\n  p -= 0.0088;\r\n  return clamp(\r\n    (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326,\r\n    0,\r\n    1\r\n  );\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport function interp(x, a, b) {\r\n  return x * (b - a) + a;\r\n}\r\n\r\nexport function revInterp(t, a, b) {\r\n  return (t - a) / (b - a);\r\n}\r\n\r\nexport function distSq([x1, y1], [x2, y2]) {\r\n  return (x2 - x1) ** 2 + (y2 - y1) ** 2;\r\n}\r\n\r\nexport function dist([x1, y1], [x2, y2]) {\r\n  return Math.sqrt(distSq([x1, y1], [x2, y2]));\r\n}\r\n\r\nexport function getCenterDomRect(domRect) {\r\n  return [domRect.left + domRect.width / 2, domRect.top + domRect.height / 2];\r\n}\r\n\r\nexport function clipEnds([from, to], shortenByStart, shortenByEnd) {\r\n  const len = Math.sqrt((from[0] - to[0]) ** 2 + (from[1] - to[1]) ** 2);\r\n  const normed = [(to[0] - from[0]) / len, (to[1] - from[1]) / len];\r\n\r\n  if (shortenByEnd === undefined) shortenByEnd = shortenByStart;\r\n\r\n  from[0] += normed[0] * shortenByStart;\r\n  from[1] += normed[1] * shortenByStart;\r\n  to[0] -= normed[0] * shortenByEnd;\r\n  to[1] -= normed[1] * shortenByEnd;\r\n\r\n  return [from, to];\r\n}\r\n\r\nexport function dropRadToDropHeight(rad) {\r\n  return (1 + Math.SQRT2) * rad;\r\n}\r\n\r\nexport function dropCenterCorrection({ rad, height }) {\r\n  if (rad !== undefined) return dropRadToDropHeight(rad) * 0.08;\r\n  return height * 0.08;\r\n}\r\n\r\nexport function avgCoords(coords) {\r\n  return [d3.mean(coords, (c) => c[0]), d3.mean(coords, (c) => c[1])];\r\n}\r\n\r\nexport function rotatePoint(x, y, deg) {\r\n  const vec = new THREE.Vector3(x, y, 0).applyEuler(\r\n    new THREE.Euler(0, 0, toRadians(deg))\r\n  );\r\n  return [vec.x, vec.y];\r\n}\r\n\r\n// modifies arr!\r\nexport function rotatePoints(arr, deg) {\r\n  for (const a of arr) {\r\n    const newPoint = rotatePoint(a[0], a[1], deg);\r\n    a[0] = newPoint[0];\r\n    a[1] = newPoint[1];\r\n  }\r\n  return arr;\r\n}\r\n\r\n// https://stackoverflow.com/a/2450976\r\nexport function shuffle(array) {\r\n  let currentIndex = array.length;\r\n\r\n  // While there remain elements to shuffle...\r\n  while (currentIndex != 0) {\r\n    // Pick a remaining element...\r\n    let randomIndex = Math.floor(Math.random() * currentIndex);\r\n    currentIndex--;\r\n\r\n    // And swap it with the current element.\r\n    [array[currentIndex], array[randomIndex]] = [\r\n      array[randomIndex],\r\n      array[currentIndex],\r\n    ];\r\n  }\r\n\r\n  return array;\r\n}\r\n","// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    if (typeof v === \"function\")\r\n      _setState((curVal) => (stateRef.current = v(curVal)));\r\n    else _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n\r\nexport function isState(stateInfo, stateName) {\r\n  return stateInfo && stateInfo.state === stateName;\r\n}\r\n\r\nexport function wrap(s) {\r\n  return s.replace(/(?![^\\n]{1,15}$)([^\\n]{1,15})\\s/g, \"$1\\n\");\r\n}\r\n\r\nexport function genUUID() {\r\n  return Math.floor(Math.random() * 1e9);\r\n}\r\n\r\nexport function arrRemove(arr, item) {\r\n  let idx;\r\n  if (typeof item === \"function\") {\r\n    idx = arr.findIndex(item);\r\n  } else {\r\n    idx = arr.indexOf(item);\r\n  }\r\n  if (idx !== -1) arr.splice(idx, 1);\r\n  return arr;\r\n}\r\n\r\nexport function copyCoords(arr) {\r\n  return arr.map((a) => Array.from(a));\r\n}\r\n","import { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport * as d3 from \"d3\";\r\nimport { LOD_1_LEVELS } from \"settings\";\r\nimport { wrap } from \"./misc-utils\";\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport const CIRC_RAD = Math.SQRT1_2;\r\nexport const DROP_RAD = 1;\r\nexport const CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nexport const DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = (CIRC_RAD + DROP_RAD / 2) / DROP_HEIGHT;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2, subdivs = 10) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 1 / subdivs;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function circlet(s) {\r\n  s.attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke\", \"orange\")\r\n    .attr(\"stroke-dasharray\", 3)\r\n    .attr(\"stroke-width\", 3)\r\n    .attr(\"vector-effect\", \"non-scaling-stroke\");\r\n}\r\n\r\nexport function showElems(elemStr, container, displayVal) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", displayVal || \"block\");\r\n}\r\n\r\nexport function hideElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", \"none\");\r\n}\r\n\r\nexport function removeElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).remove();\r\n}\r\n\r\nexport function gradientInit(levs, id) {\r\n  return (s) => {\r\n    const stops = s\r\n      .append(\"defs\")\r\n      .append(\"linearGradient\")\r\n      .attr(\"id\", id)\r\n      .attr(\"x1\", \"0%\")\r\n      .attr(\"x2\", \"0%\")\r\n      .attr(\"y1\", \"0%\")\r\n      .attr(\"y2\", \"100%\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n    levs.forEach((_, i) => {\r\n      for (let j = 0; j < 2; j++) {\r\n        stops\r\n          .append(\"stop\")\r\n          .attr(\"stop-color\", interpolateWatercolorBlue(i / LOD_1_LEVELS));\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nexport function gradientUpdate(levs, maxLev) {\r\n  return (s) => {\r\n    s.selectAll(\"stop\").each(function (_, i) {\r\n      // first stop is at 0\r\n      if (i === 0) {\r\n        d3.select(this).attr(\"offset\", `0%`);\r\n        return;\r\n      }\r\n\r\n      // last stop is at 100\r\n      if (i === (levs.length + 1) * 2 - 1) {\r\n        d3.select(this).attr(\"offset\", `100%`);\r\n        return;\r\n      }\r\n\r\n      let valOffset = Math.floor((i - 1) / 2);\r\n\r\n      d3.select(this).attr(\r\n        \"offset\",\r\n        `${(1 - levs[valOffset] / maxLev) * 100}%`\r\n      );\r\n    });\r\n  };\r\n}\r\n\r\nexport function worldToScreen(x, y, camTransform) {\r\n  return [\r\n    x * camTransform.k + camTransform.x,\r\n    y * camTransform.k + camTransform.y,\r\n  ];\r\n}\r\n\r\nexport function screenToWorld(x, y, camTransform) {\r\n  return [\r\n    (x - camTransform.x) / camTransform.k,\r\n    (y - camTransform.y) / camTransform.k,\r\n  ];\r\n}\r\n\r\nexport function generateTSpan(text, lineHeight = 1.2) {\r\n  return (s) => {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = typeof text === \"string\" ? wrap(text).split(\"\\n\") : text;\r\n\r\n    const x = s.attr(\"x\");\r\n\r\n    lines.forEach((line) => {\r\n      s.append(\"tspan\").attr(\"x\", x).attr(\"dy\", `${lineHeight}em`).text(line);\r\n    });\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\nimport {\r\n  DELIV_KEY_STRING,\r\n  MAX_DELIVS,\r\n  OBJECTIVES_DATA,\r\n  SCENARIO_KEY_STRING,\r\n} from \"data/objectives-data\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { SPREAD_1_2 } from \"settings\";\r\nimport { DROPLET_SHAPE, generateTSpan } from \"./render-utils\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\nimport { dropCenterCorrection } from \"./math-utils\";\r\nimport { genUUID, wrap } from \"./misc-utils\";\r\nimport { gradientUpdate } from \"./render-utils\";\r\nimport { gradientInit } from \"./render-utils\";\r\n\r\nexport const BAR_CHART_WIDTH = 500,\r\n  BAR_CHART_HEIGHT = 400;\r\n\r\nexport const INTERP_COLOR = d3.interpolateRgbBasis([\r\n  \"#F2F5FB\",\r\n  \"#D0DDEB\",\r\n  \"#7B9BC0\",\r\n  \"#4F739F\",\r\n  \"#112A57\",\r\n]);\r\n\r\nexport const DEFAULT_OBJECTIVE = \"DEL_CVP_PAG_N\";\r\nexport const COMP_OBJECTIVE = \"DEL_CVP_PRF_S\";\r\nexport const DEFAULT_SCENARIO = \"expl0000\";\r\nexport const PAG_DELIVS =\r\n  OBJECTIVES_DATA[DEFAULT_OBJECTIVE][SCENARIO_KEY_STRING][DEFAULT_SCENARIO][\r\n    DELIV_KEY_STRING\r\n  ];\r\nexport const PRF_DELIVS =\r\n  OBJECTIVES_DATA[COMP_OBJECTIVE][SCENARIO_KEY_STRING][DEFAULT_SCENARIO][\r\n    DELIV_KEY_STRING\r\n  ];\r\n\r\nexport const VARIATIONS = [\r\n  \"expl0020\", // change priority\r\n  \"expl0080\", // increase carryover\r\n  \"expl0480\", // decrease demand\r\n  \"expl0004\", // increase minflow\r\n];\r\n\r\nexport const VARIATIONS_DELIVS = VARIATIONS.map(\r\n  (vars) =>\r\n    OBJECTIVES_DATA[DEFAULT_OBJECTIVE][SCENARIO_KEY_STRING][vars][\r\n      DELIV_KEY_STRING\r\n    ]\r\n);\r\n\r\nexport const VARIATIONS_INTERPERS = VARIATIONS_DELIVS.map((varDelivs) =>\r\n  d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, varDelivs.length))\r\n    .range(\r\n      varDelivs\r\n        .map((v) => v / MAX_DELIVS)\r\n        .sort()\r\n        .reverse()\r\n    )\r\n    .clamp(true)\r\n);\r\n\r\nexport const PAG_INTERPER = d3\r\n  .scaleLinear()\r\n  .domain(ticksExact(0, 1, PAG_DELIVS.length))\r\n  .range(\r\n    PAG_DELIVS.map((v) => v / MAX_DELIVS)\r\n      .sort()\r\n      .reverse()\r\n  )\r\n  .clamp(true);\r\n\r\nexport const PRF_INTERPER = d3\r\n  .scaleLinear()\r\n  .domain(ticksExact(0, 1, PRF_DELIVS.length))\r\n  .range(\r\n    PRF_DELIVS.map((v) => v / MAX_DELIVS)\r\n      .sort()\r\n      .reverse()\r\n  )\r\n  .clamp(true);\r\n\r\nexport const DROP_VARIATIONS = [\r\n  {\r\n    idx: 0,\r\n    scen: \"0020\",\r\n    clas: \"drop1\",\r\n    desc: \"change priority\",\r\n  },\r\n  {\r\n    idx: 1,\r\n    scen: \"0080\",\r\n    clas: \"drop2\",\r\n    desc: \"increase carryover\",\r\n  },\r\n  {\r\n    idx: 2,\r\n    scen: \"0480\",\r\n    clas: \"drop3\",\r\n    desc: \"decrease demand\",\r\n  },\r\n  {\r\n    idx: 3,\r\n    scen: \"0004\",\r\n    clas: \"drop4\",\r\n    desc: \"increase minimum flow\",\r\n  },\r\n];\r\n\r\nexport function updateDropsSVG(container, waterdropGroups, { onHover }) {\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (group, i) {\r\n        d3.select(this).call(\r\n          largeDropInit(group, waterdropGroups.groupPositions[i])\r\n        );\r\n      });\r\n    })\r\n    .attr(\"transform\", (_, i) => {\r\n      const groupPos = waterdropGroups.groupPositions[i];\r\n      return `translate(${groupPos[0]}, ${groupPos[1]})`;\r\n    })\r\n    .each(function (group) {\r\n      d3.select(this)\r\n        .call(largeDropUpdate(group))\r\n        .selectAll(\".small-drop\")\r\n        .on(\"mouseenter\", function (e, d) {\r\n          onHover && onHover(d);\r\n        });\r\n    });\r\n}\r\n\r\nfunction largeDropInit({ nodes, height, key }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"large-drop \" + key);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"stroke\", \"none\")\r\n      .attr(\"fill\", \"yellow\")\r\n      .attr(\"r\", LOD_1_RAD_PX * 2);\r\n\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"fancy-font large-gray-text\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ key, levs, x, y }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const randId = `tut-grad-${genUUID()}`;\r\n\r\n    s.call(gradientInit(levs, randId));\r\n\r\n    if (key === \"expl0000\") {\r\n      d3.select(s.node().parentNode)\r\n        .select(\".highlight-circle\")\r\n        .attr(\"cx\", x * SPREAD_1_2)\r\n        .attr(\r\n          \"cy\",\r\n          y * SPREAD_1_2 - dropCenterCorrection({ rad: LOD_1_RAD_PX })\r\n        );\r\n    }\r\n\r\n    s.append(\"path\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"class\", \"outline\")\r\n      .attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${randId})`)\r\n      .attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate({ nodes, key, height }) {\r\n  return (s) => {\r\n    s.select(\"text\")\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", (height / 2) * SPREAD_1_2 * 0.8)\r\n      .call(\r\n        generateTSpan(\r\n          DESCRIPTIONS_DATA[key].display_name || DESCRIPTIONS_DATA[key].id\r\n        )\r\n      );\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\r\n        \"transform\",\r\n        ({ x, y }) => `translate(${x * SPREAD_1_2}, ${y * SPREAD_1_2})`\r\n      )\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ levs, maxLev }) {\r\n  return (s) => {\r\n    s.call(gradientUpdate(levs, maxLev));\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport {\r\n  CALIFORNIA_CENTER,\r\n  CALIFORNIA_OUTLINE,\r\n  SPATIAL_DATA,\r\n} from \"data/spatial-data\";\r\nimport { GROUP_HOVER_AREA_FACTOR } from \"settings\";\r\n\r\nimport { dist, dropCenterCorrection, getCenterDomRect } from \"utils/math-utils\";\r\nimport { wrap } from \"utils/misc-utils\";\r\nimport { circlet, generateTSpan } from \"utils/render-utils\";\r\n\r\nexport function drawMinimapSVG() {\r\n  const width = 200,\r\n    height = 250;\r\n\r\n  const minimap = d3\r\n    .select(\"#minimap\")\r\n    .attr(\"width\", width)\r\n    .attr(\"height\", height);\r\n\r\n  const proj = d3\r\n    .geoMercator()\r\n    .scale(1000)\r\n    .center(CALIFORNIA_CENTER)\r\n    .translate([width / 2, height / 2]);\r\n\r\n  const lineGeom = [\r\n    ...SPATIAL_DATA.features.filter((f) => f.geometry.type === \"MultiPolygon\"),\r\n    CALIFORNIA_OUTLINE,\r\n  ];\r\n  const pointGeom = SPATIAL_DATA.features.filter(\r\n    (f) => f.geometry.type === \"MultiPoint\"\r\n  );\r\n\r\n  minimap\r\n    .selectAll(\"path\")\r\n    .data(lineGeom)\r\n    .join(\"path\")\r\n    .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"stroke\", (d) =>\r\n      d.properties.CalLiteID ? \"transparent\" : \"lightgray\"\r\n    )\r\n    .attr(\"stroke-width\", 1)\r\n    .attr(\"fill\", \"transparent\");\r\n\r\n  minimap\r\n    .selectAll(\"circle\")\r\n    .data(pointGeom)\r\n    .join(\"circle\")\r\n    .each(function (d) {\r\n      const s = d3.select(this);\r\n\r\n      const [x, y] = proj(d.geometry.coordinates[0]);\r\n\r\n      s.attr(\"cx\", x);\r\n      s.attr(\"cy\", y);\r\n    })\r\n    .attr(\"r\", 2)\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"fill\", \"transparent\");\r\n}\r\n\r\nexport function updateLargeDropSVG(\r\n  container,\r\n  waterdrops,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const drops = container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdrops.groups, ({ key }) => key)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(interactorsInit);\r\n    })\r\n    .each(interactorsUpdate)\r\n    .attr(\"transform\", dropTransform)\r\n    .select(\".hover-capture\");\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      d3.select(this.parentNode).raise();\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n}\r\n\r\nexport function fontSizer(transformInfo, camera, waterdropsHeight) {\r\n  return function () {\r\n    const tNode = d3.select(this).node();\r\n\r\n    const [posx, posy] = getCenterDomRect(tNode.getBoundingClientRect());\r\n\r\n    const width = ((tNode.getBBox().width * camera.height) / camera.far) * 8,\r\n      height = ((tNode.getBBox().height * camera.height) / camera.far) * 10;\r\n\r\n    const dis = dist(\r\n      [posx, posy],\r\n      [transformInfo.mouseX, transformInfo.mouseY]\r\n    );\r\n\r\n    d3.select(this).attr(\r\n      \"font-size\",\r\n      getFontSize(dis, transformInfo.zoom, camera.height, waterdropsHeight)\r\n    );\r\n\r\n    d3.select(this.parentNode.parentNode)\r\n      .select(\"image\")\r\n      .attr(\"x\", -width / 2)\r\n      .attr(\"y\", -height / 2)\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n  };\r\n}\r\n\r\nexport function fadeOutDrops(dropsMesh, scene, startOpac, duration) {\r\n  const t = d3.timer((elapsed) => {\r\n    const et = Math.min(1, elapsed / duration);\r\n\r\n    dropsMesh.updateVisibility(1 - et);\r\n    dropsMesh.updateOutlineVisibility(startOpac * (1 - et));\r\n\r\n    if (et >= 1) {\r\n      t.stop();\r\n      dropsMesh.remove(scene);\r\n    }\r\n  });\r\n}\r\n\r\nfunction interactorsInit() {\r\n  const s = d3.select(this);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"hover-capture\")\r\n    .attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke-width\", 0)\r\n    .attr(\"r\", 0.8);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"circlet interactive\")\r\n    .call(circlet)\r\n    .attr(\"r\", 1);\r\n\r\n  const textGroup = s.append(\"g\").attr(\"pointer-events\", \"none\");\r\n  textGroup\r\n    .append(\"image\")\r\n    .attr(\"href\", \"glow.png\")\r\n    .attr(\"preserveAspectRatio\", \"none\")\r\n    .attr(\"opacity\", 0.8);\r\n  textGroup\r\n    .append(\"text\")\r\n    .attr(\"class\", \"fancy-font cloud-text\")\r\n    .attr(\"text-anchor\", \"middle\")\r\n    .attr(\"font-size\", 0);\r\n}\r\n\r\nfunction interactorsUpdate(d) {\r\n  d3.select(this)\r\n    .select(\".circlet\")\r\n    .attr(\"class\", null)\r\n    // TODO find better way than disabling class\r\n    .attr(\"class\", \"circlet interactive \" + d.key);\r\n  d3.select(this).select(\"text\").call(textUpdate(d));\r\n}\r\n\r\nfunction textUpdate(d) {\r\n  return function (s) {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = wrap(\r\n      DESCRIPTIONS_DATA[d.key].display_name || DESCRIPTIONS_DATA[d.key].id\r\n    ).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      s.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", `${-lines.length / 2 + 0.5}em`)\r\n        .attr(\"dy\", `${i}em`)\r\n        .text(line);\r\n    });\r\n  };\r\n}\r\n\r\nfunction dropTransform({ x, y, height }) {\r\n  return `translate(${x}, ${y - dropCenterCorrection({ height })}) scale(${\r\n    height * GROUP_HOVER_AREA_FACTOR\r\n  })`;\r\n}\r\n\r\nfunction getFontSize(d, transformZoom, cameraHeight, waterdropsHeight) {\r\n  const MAX_RAD = window.innerHeight / 9;\r\n\r\n  const zoomRel = cameraHeight / waterdropsHeight / transformZoom;\r\n\r\n  const absFontSize = (_d) =>\r\n    _d > MAX_RAD\r\n      ? 0\r\n      : d3.scaleLinear().domain([0, MAX_RAD]).range([1, 0.4]).clamp(true)(_d);\r\n\r\n  return absFontSize(d * zoomRel) * Math.min(zoomRel, 0.4);\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingStickers from \"components/SceneSettingStickers\";\r\nimport { FLATTENED_DATA, KEY_SETTINGS_MAP } from \"data/objectives-data\";\r\nimport { SPREAD_1_2 } from \"settings\";\r\n\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { hideElems, removeElems, showElems } from \"utils/render-utils\";\r\n\r\nimport {\r\n  calcLinesAndPositions,\r\n  getWaterdropGroups,\r\n  updateColorDrops,\r\n  updateDropsSVG,\r\n  updateLabelSVG,\r\n  updateScenIndicatorsSVG,\r\n} from \"utils/compareview-utils\";\r\nimport { deserialize } from \"utils/data-utils\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\n\r\nexport default function CompareView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n    camera,\r\n    goals,\r\n    setGoals,\r\n    addZoomHandler,\r\n  } = useContext(AppContext);\r\n\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n\r\n  const groupsRef = useRef();\r\n  const centerRef = useRef();\r\n\r\n  const getScreenDropHeight = () =>\r\n    groupsRef.current.groups[0].height * SPREAD_1_2;\r\n\r\n  useEffect(function initialize() {\r\n    const container = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"compare-group\");\r\n\r\n    container.append(\"text\").attr(\"id\", \"member-variable\");\r\n    container.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"CompareView\")) {\r\n        const container = d3.select(\"#compare-group\");\r\n\r\n        const { viewCenter, transitionDuration = 0 } = state;\r\n\r\n        centerRef.current = viewCenter;\r\n\r\n        groupsRef.current = getWaterdropGroups(\r\n          activeWaterdrops,\r\n          waterdrops,\r\n          viewCenter\r\n        );\r\n\r\n        updateDropsSVG(container, groupsRef.current, transitionDuration / 5, {\r\n          onHover: (d) => {\r\n            setActiveMinidrop({ key: d.key });\r\n          },\r\n        });\r\n\r\n        hideElems(\".large-gray-text\", container);\r\n\r\n        setTimeout(() => {\r\n          setActiveMinidrop({ key: groupsRef.current.groups[0].nodes[0].key });\r\n          showElems(\r\n            \"#member-variable, #member-label, .large-gray-text\",\r\n            container\r\n          );\r\n          showElems(\".comp-settings\", d3, \"flex\");\r\n        }, transitionDuration + 500);\r\n\r\n        setGoBack(() => () => {\r\n          const transitionDuration = resetCamera();\r\n\r\n          setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(camera.curTransform);\r\n\r\n        return function exitState() {\r\n          removeElems(\".large-drop, .circlet, .comp-line\", container);\r\n\r\n          hideElems(\"#member-variable, #member-label\", container);\r\n          hideElems(\".comp-settings\");\r\n\r\n          setPanels([]);\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines, nodes] = calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop.key\r\n        );\r\n\r\n        setPanels(makePanelsFromNodes(nodes));\r\n        updateLabelSVG(\r\n          avgCoords(positions),\r\n          activeMinidrop.key.slice(4),\r\n          getScreenDropHeight()\r\n        );\r\n        updateScenIndicatorsSVG(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#compare-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop-group\", container);\r\n        showElems(\".large-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      updateColorDrops(\r\n        container,\r\n        groupsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop-group\", container);\r\n      hideElems(\".large-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function makePanelsFromNodes(nodes) {\r\n    return (p) => {\r\n      return nodes.map((n, i) => {\r\n        let ox = 0,\r\n          oy = 0;\r\n\r\n        if (p[i]) {\r\n          ox = p[i].offsetX;\r\n          oy = p[i].offsetY;\r\n        }\r\n\r\n        const [x, y, isLeft] = getIdealGroupPos(\r\n          groupsRef.current.groupPositions[i],\r\n          centerRef.current\r\n        );\r\n\r\n        return {\r\n          text: n.key,\r\n          x,\r\n          y,\r\n          id: groupsRef.current.groups[i].key,\r\n          nodeID: n.id,\r\n          isLeft,\r\n          offsetX: ox,\r\n          offsetY: oy,\r\n        };\r\n      });\r\n    };\r\n  }\r\n\r\n  function getIdealGroupPos([x, y], [centerX, centerY]) {\r\n    let newX = x,\r\n      newY = y;\r\n\r\n    const correctionX = groupsRef.current.groups[0].height * 2;\r\n\r\n    if (newX < centerX) newX -= correctionX;\r\n    else newX += correctionX;\r\n\r\n    return [newX, newY, newX < centerX];\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {activeMinidrop && (\r\n        <SceneSettingStickers\r\n          settings={deserialize(activeMinidrop.key.slice(4))}\r\n          setColorSetting={setColorSetting}\r\n        />\r\n      )}\r\n      {panels.map(({ x, y, id, isLeft, offsetX, offsetY, nodeID }, i) => (\r\n        <div\r\n          className={\"panel compare-panel\" + (isLeft ? \" left\" : \"\")}\r\n          key={i}\r\n          style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n          onMouseDown={(e) => onPanelDragStart(e, { id })}\r\n        >\r\n          <DotHistogram\r\n            width={300}\r\n            height={200}\r\n            data={FLATTENED_DATA[nodeID].deliveries}\r\n            goal={goals[id]}\r\n            setGoal={(newGoal) => {\r\n              setGoals((g) => {\r\n                g[id] = newGoal;\r\n                return { ...g };\r\n              });\r\n            }}\r\n          />\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingSubcard from \"components/SceneSettingSubcard\";\r\nimport { FLATTENED_DATA, KEY_SETTINGS_MAP } from \"data/objectives-data\";\r\nimport { SPREAD_1_2 } from \"settings\";\r\n\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { updateColorDrops, updateSmallDropSVG } from \"utils/examineview-utils\";\r\nimport { arrRemove, isState, useStateRef } from \"utils/misc-utils\";\r\nimport {\r\n  generateTSpan,\r\n  hideElems,\r\n  removeElems,\r\n  screenToWorld,\r\n  showElems,\r\n  worldToScreen,\r\n} from \"utils/render-utils\";\r\nimport { deserialize } from \"utils/data-utils\";\r\nimport { clipEnds, dist } from \"utils/math-utils\";\r\nimport { radToDeg } from \"three/src/math/MathUtils\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\n\r\nexport default function ExamineView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n    camera,\r\n    addZoomHandler,\r\n    goals,\r\n    setGoals,\r\n  } = useContext(AppContext);\r\n\r\n  const activeMinidropsRef = useRef([]);\r\n  const curMinidropsRef = useRef(null);\r\n\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform, camTransformRef] = useStateRef(\r\n    d3.zoomIdentity\r\n  );\r\n  const { panels, panelsRef, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n  const [hoveredCard, setHoveredCard] = useState(null);\r\n  const removePreviewRef = useRef(null);\r\n\r\n  useEffect(function initialize() {\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"examine-group\");\r\n\r\n    svgGroup.append(\"circle\").attr(\"class\", \"highlight-circle\");\r\n\r\n    svgGroup.append(\"path\").attr(\"class\", \"connect-line\");\r\n\r\n    svgGroup.append(\"text\").attr(\"class\", \"instruction-text large-gray-text\");\r\n    svgGroup.append(\"text\").attr(\"class\", \"large-drop-label large-gray-text\");\r\n\r\n    addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"ExamineView\")) {\r\n        const { transitionDuration = 0 } = state;\r\n        const container = d3.select(\"#examine-group\");\r\n        curMinidropsRef.current = waterdrops.groups.find(\r\n          (g) => g.key === activeWaterdrops[0]\r\n        );\r\n\r\n        updateSmallDropSVG(\r\n          container,\r\n          curMinidropsRef.current,\r\n          transitionDuration / 2,\r\n          {\r\n            onClick: updateActiveMinidrops,\r\n            onHover: hoverDrop,\r\n            onUnhover: unhoverDrop,\r\n          }\r\n        );\r\n\r\n        setTimeout(positionTexts, transitionDuration * 1.2);\r\n\r\n        setGoBack(() => () => {\r\n          const transitionDuration = resetCamera();\r\n\r\n          setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(camera.curTransform);\r\n        showElems(\"#examine-group\");\r\n\r\n        return function exitState() {\r\n          removeElems(\".small-drop, .circlet\", container);\r\n          hideElems(\"#examine-group\");\r\n          d3.selectAll(\r\n            \"#examine-group .instruction-text, #examine-group .large-drop-label\"\r\n          ).attr(\"opacity\", 0);\r\n\r\n          setPanels([]);\r\n          activeMinidropsRef.current = [];\r\n          curMinidropsRef.current = null;\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#examine-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop\", container);\r\n        showElems(\".small-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      updateColorDrops(\r\n        container,\r\n        curMinidropsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop\", container);\r\n      hideElems(\".small-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function positionTexts() {\r\n    const instrFontSize =\r\n      (16 / camera.height) *\r\n      camera.getZFromFarHeight(\r\n        curMinidropsRef.current.height * SPREAD_1_2 * 1.5\r\n      );\r\n\r\n    d3.select(\"#examine-group .instruction-text\")\r\n      .attr(\r\n        \"x\",\r\n        curMinidropsRef.current.x -\r\n          curMinidropsRef.current.height * SPREAD_1_2 * 0.8\r\n      )\r\n      .attr(\"y\", curMinidropsRef.current.y - instrFontSize)\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", instrFontSize)\r\n      .call(\r\n        generateTSpan([\"click to show panels.\", \"you can drag panels.\"], 1.6)\r\n      )\r\n      .call((s) => {\r\n        s.transition().attr(\"opacity\", 1);\r\n      })\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * 3);\r\n      });\r\n\r\n    const labelFontSize =\r\n      (20 / camera.height) *\r\n      camera.getZFromFarHeight(\r\n        curMinidropsRef.current.height * SPREAD_1_2 * 1.5\r\n      );\r\n    const margin = labelFontSize;\r\n\r\n    const [worldX, worldY] = camera.screenToWorld(0, 0);\r\n\r\n    d3.select(\"#examine-group .large-drop-label\")\r\n      .attr(\"x\", worldX + margin)\r\n      .attr(\"y\", worldY + margin)\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"start\")\r\n      .attr(\"font-size\", labelFontSize)\r\n      .call(\r\n        generateTSpan(\r\n          DESCRIPTIONS_DATA[activeWaterdrops[0]].display_name ||\r\n            DESCRIPTIONS_DATA[activeWaterdrops[0]].id,\r\n          1.2\r\n        )\r\n      )\r\n      .transition()\r\n      .attr(\"opacity\", 1);\r\n  }\r\n\r\n  function addDetailPanel(dropId, preview = false, forceReplace = false) {\r\n    const { x: groupX, y: groupY } = curMinidropsRef.current;\r\n    const { x, y, id, key } = waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      if (p.findIndex(({ id: pid }) => id === pid) !== -1) {\r\n        if (!forceReplace) return p;\r\n\r\n        arrRemove(p, (_p) => _p.id === id);\r\n      }\r\n      const newPanel = {\r\n        text: key.slice(4),\r\n        x: groupX + x * SPREAD_1_2,\r\n        y: groupY + y * SPREAD_1_2,\r\n        offsetX: 20,\r\n        offsetY: 40,\r\n        id,\r\n        preview,\r\n        panelKey: preview ? -1 : dropId,\r\n      };\r\n\r\n      return [...p, newPanel];\r\n    });\r\n  }\r\n\r\n  function removeDetailPanel(dropId) {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ id }) => dropId === id);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function removePreviewPanel() {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ panelKey }) => panelKey === -1);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function updateActiveMinidrops(d) {\r\n    const container = d3.select(\"#examine-group\");\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      arrRemove(activeMinidropsRef.current, d.id);\r\n      container.select(\".circlet.i\" + d.id).classed(\"active\", false);\r\n      removeDetailPanel(d.id);\r\n      setHoveredCard(null);\r\n    } else {\r\n      removeDetailPanel(d.id);\r\n      activeMinidropsRef.current.push(d.id);\r\n      container.select(\".circlet.i\" + d.id).classed(\"active\", true);\r\n      addDetailPanel(d.id);\r\n      setHoveredCard(d.id);\r\n    }\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      d3.select(`.examine-panel.p${d.id}`).style(\"z-index\", 100);\r\n      setHoveredCard(d.id);\r\n    } else {\r\n      if (removePreviewRef.current) {\r\n        clearTimeout(removePreviewRef.current);\r\n        removePreviewPanel();\r\n      }\r\n      addDetailPanel(d.id, true);\r\n    }\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    if (!activeMinidropsRef.current.includes(d.id)) {\r\n      removePreviewRef.current = setTimeout(() => {\r\n        removeDetailPanel(d.id);\r\n        removePreviewRef.current = null;\r\n      }, 100);\r\n    }\r\n\r\n    setHoveredCard((hc) => (hc === d.id ? null : hc));\r\n    d3.select(`.examine-panel.p${d.id}`).style(\"z-index\", 0);\r\n  }\r\n\r\n  function drawLineConnect(id) {\r\n    if (panelsRef.current.findIndex(({ id: pid }) => id === pid) === -1) return;\r\n\r\n    const { x: circleX, y: circleY } = panelsRef.current.find(\r\n      (p) => p.id === id\r\n    );\r\n\r\n    const [cx, cy] = camera.worldToScreen(circleX, circleY);\r\n\r\n    const panelBox = d3\r\n      .select(`.examine-panel.p${id}`)\r\n      .node()\r\n      .getBoundingClientRect();\r\n    const [px, py] = [\r\n      panelBox.left + panelBox.width / 2,\r\n      panelBox.top + panelBox.height / 2,\r\n    ];\r\n\r\n    const diffX = px - cx;\r\n    const diffY = py - cy;\r\n\r\n    let left, top;\r\n    const margin = 5;\r\n\r\n    if (Math.abs(diffX) > Math.abs(diffY)) {\r\n      top = 0;\r\n      left = (diffX < 0 ? 1 : -1) * (panelBox.width / 2 - margin);\r\n    } else {\r\n      left = 0;\r\n      top = (diffY < 0 ? 1 : -1) * (panelBox.height / 2 - margin);\r\n    }\r\n\r\n    const line = clipEnds(\r\n      [\r\n        [cx, cy],\r\n        [px + left, py + top],\r\n      ],\r\n      8,\r\n      0\r\n    );\r\n\r\n    return line;\r\n  }\r\n\r\n  if (isState(state, \"ExamineView\")) {\r\n    return (\r\n      <>\r\n        {panels.map(\r\n          ({ text, x, y, id, offsetX, offsetY, panelKey, preview }) => (\r\n            <div\r\n              className={`panel examine-panel p${id} ${\r\n                preview ? \"preview\" : \"\"\r\n              }`}\r\n              key={preview ? -1 : id}\r\n              style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n              onMouseDown={(e) => !preview && onPanelDragStart(e, { id })}\r\n              onMouseEnter={() => !preview && hoverDrop({ id })}\r\n              onMouseLeave={() => !preview && unhoverDrop({ id })}\r\n            >\r\n              <div className=\"panel-tab\">\r\n                scenario <span>{text}</span>\r\n              </div>\r\n              <DotHistogram\r\n                width={300}\r\n                height={200}\r\n                data={FLATTENED_DATA[id].deliveries}\r\n                goal={goals[activeWaterdrops[0]]}\r\n                setGoal={(newGoal) => {\r\n                  setGoals((g) => {\r\n                    g[activeWaterdrops[0]] = newGoal;\r\n                    return { ...g };\r\n                  });\r\n                }}\r\n              />\r\n              <SceneSettingSubcard\r\n                settings={deserialize(text)}\r\n                setColorSetting={setColorSetting}\r\n              />\r\n            </div>\r\n          )\r\n        )}\r\n        {hoveredCard && (\r\n          <ConnectLine connectLine={drawLineConnect(hoveredCard)} />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nfunction ConnectLine({ connectLine }) {\r\n  return (\r\n    <div className=\"connect-line\" style={getConnectStyle(...connectLine)}>\r\n      <div className=\"connect-line-container\"></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getConnectStyle(from, to) {\r\n  const width = dist(from, to);\r\n  const rot = radToDeg(Math.atan2(to[1] - from[1], to[0] - from[0]));\r\n  return {\r\n    left: `${from[0]}px`,\r\n    top: `${from[1]}px`,\r\n    width: `${width}px`,\r\n    rotate: `${rot}deg`,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport { Scrollama, Step } from \"react-scrollama\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { isState } from \"utils/misc-utils\";\r\n\r\nimport BucketGlyph from \"bucket-lib/BucketGlyph\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport WaterdropGlyph from \"components/WaterdropGlyph\";\r\nimport { hideElems, showElems } from \"utils/render-utils\";\r\nimport {\r\n  PAG_DELIVS,\r\n  PAG_INTERPER,\r\n  INTERP_COLOR,\r\n  VARIATIONS_DELIVS,\r\n  VARIATIONS_INTERPERS,\r\n  DROP_VARIATIONS,\r\n  PRF_INTERPER,\r\n  BAR_CHART_HEIGHT,\r\n  DEFAULT_OBJECTIVE,\r\n  COMP_OBJECTIVE,\r\n} from \"utils/tutorialview-utils\";\r\nimport { useTutorialState } from \"hooks/useTutorialState\";\r\nimport { useTutorialComparer } from \"hooks/useTutorialComparer\";\r\nimport { useTutorialGraph } from \"hooks/useTutorialGraph\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\n\r\nexport default function TutorialView() {\r\n  const { state, setState, waterdrops, camera } = useContext(AppContext);\r\n\r\n  const {\r\n    userGoal,\r\n    setUserGoal,\r\n    bucketInterperPAG,\r\n    setBucketInterperPAG,\r\n    bucketInterperPRF,\r\n    setBucketInterperPRF,\r\n    dropInterper,\r\n    setDropInterper,\r\n    variationInterpers,\r\n    setVariationInterpers,\r\n  } = useTutorialState();\r\n\r\n  const { initGraphArea, initBars, condenseBars } = useTutorialGraph();\r\n  const { initComparer, introDrop2 } = useTutorialComparer();\r\n\r\n  const maxSlideReachedRef = useRef(-1);\r\n\r\n  useLayoutEffect(\r\n    function enterState() {\r\n      if (isState(state, \"TutorialView\")) {\r\n        hideElems(\r\n          \".bucket-wrapper, .vardrop, .var-scen-label, .vardrop .dot-histogram-wrapper, .main-histogram, .tut-comparer-graphics-wrapper\"\r\n        );\r\n\r\n        initGraphArea();\r\n        initComparer(waterdrops, camera);\r\n\r\n        return function exitState() {\r\n          hideElems(\".tutorial-view\");\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  const actions = useMemo(\r\n    () => ({\r\n      2: () => {\r\n        initBars();\r\n      },\r\n\r\n      4: () => {\r\n        condenseBars();\r\n      },\r\n\r\n      5: () => {\r\n        d3.selectAll(\".tut-graph-wrapper .bucket-wrapper\").style(\r\n          \"display\",\r\n          \"initial\"\r\n        );\r\n        d3.select(\"#pag-bar-graph\").attr(\"opacity\", 0);\r\n        d3.select(\"#prf-bar-graph\").attr(\"opacity\", 0);\r\n\r\n        setBucketInterperPAG(() => PAG_INTERPER);\r\n        setBucketInterperPRF(() => PRF_INTERPER);\r\n      },\r\n\r\n      9: () => {\r\n        setDropInterper(() => PAG_INTERPER);\r\n      },\r\n\r\n      11: () => {\r\n        d3.selectAll(\".vardrop\")\r\n          .style(\"display\", \"initial\")\r\n          .classed(\"hasarrow\", true);\r\n\r\n        hideElems(\".main-waterdrop .objective-label\");\r\n      },\r\n\r\n      12: () => {\r\n        d3.selectAll(\".vardrop path\").style(\"stroke-dasharray\", \"none\");\r\n        setVariationInterpers(VARIATIONS_INTERPERS);\r\n      },\r\n\r\n      13: () => {\r\n        d3.selectAll(\".var-scen-label\").style(\"display\", \"block\");\r\n      },\r\n\r\n      14: () => {\r\n        d3.select(\".drop1\").classed(\"highlighted\", true);\r\n      },\r\n\r\n      15: () => {\r\n        d3.select(\".drop1\").classed(\"highlighted\", false);\r\n        d3.selectAll(\".vardrop\").classed(\"hasarrow\", false);\r\n\r\n        d3.selectAll(\".var-scen-label\").style(\"opacity\", \"0.5\");\r\n        d3.selectAll(\".var-scen-label, .scen-number\").style(\"color\", \"gray\");\r\n\r\n        d3.select(\".main-waterdrop\")\r\n          .transition()\r\n          .style(\"transform\", \"translateY(-100px) scale(0.5)\");\r\n        // undo scaling of label due to shrinking div\r\n        d3.select(\".main-waterdrop .var-scen-label\")\r\n          .transition()\r\n          .style(\"transform\", \"scale(2)\");\r\n        d3.selectAll(\".drop1 .waterdrop-wrapper, .drop3 .waterdrop-wrapper\")\r\n          .transition()\r\n          .style(\"transform\", \"translate(-50px, 15px) scale(0.5)\");\r\n        d3.selectAll(\".drop2 .waterdrop-wrapper, .drop4 .waterdrop-wrapper\")\r\n          .transition()\r\n          .style(\"transform\", \"translate(50px, 15px) scale(0.5)\");\r\n\r\n        d3.select(\".main-histogram\").style(\"display\", \"initial\");\r\n        d3.selectAll(\".vardrop .dot-histogram-wrapper\").style(\r\n          \"display\",\r\n          \"initial\"\r\n        );\r\n      },\r\n\r\n      16: () => {\r\n        hideElems(\".scrollama-2 .tut-drop-graphics-wrapper\");\r\n        showElems(\".scrollama-2 .tut-comparer-graphics-wrapper\");\r\n      },\r\n\r\n      18: () => {\r\n        introDrop2();\r\n      },\r\n    }),\r\n    []\r\n  );\r\n\r\n  const onStepEnter = async ({ data, direction }) => {\r\n    if (direction === \"up\") return;\r\n\r\n    if (data > maxSlideReachedRef.current) {\r\n      maxSlideReachedRef.current = data;\r\n      if (actions[data]) actions[data]();\r\n    }\r\n  };\r\n\r\n  if (!isState(state, \"TutorialView\")) return;\r\n\r\n  return (\r\n    <div className=\"tutorial-view\">\r\n      <div className=\"card1\">\r\n        <p>\r\n          <em>How much water do the people of California get?</em> Let's focus\r\n          on two groups of people: the agriculture group in the north, and the\r\n          refuge group in the south.\r\n        </p>\r\n        <img\r\n          src=\"./northdelta.png\"\r\n          alt=\"Map of California with northern delta area highlighted\"\r\n        />\r\n        <button\r\n          className=\"skip-btn\"\r\n          onClick={() => setState({ state: \"WideView\" })}\r\n        >\r\n          Skip intro\r\n        </button>\r\n      </div>\r\n      <div className=\"scrollama scrollama-1\">\r\n        <div className=\"tut-graph-wrapper\">\r\n          <div className=\"tut-graph\">\r\n            <svg id=\"pag-bar-graph\"></svg>\r\n            <BucketGlyph\r\n              levelInterp={bucketInterperPAG}\r\n              width={300}\r\n              height={BAR_CHART_HEIGHT}\r\n              colorInterp={INTERP_COLOR}\r\n            />\r\n            <p className=\"fancy-font objective-label\">\r\n              {DESCRIPTIONS_DATA[DEFAULT_OBJECTIVE].display_name}\r\n            </p>\r\n          </div>\r\n          <div className=\"tut-graph\">\r\n            <svg id=\"prf-bar-graph\"></svg>\r\n            <BucketGlyph\r\n              levelInterp={bucketInterperPRF}\r\n              width={300}\r\n              height={BAR_CHART_HEIGHT}\r\n              colorInterp={INTERP_COLOR}\r\n            />\r\n            <p className=\"fancy-font objective-label\">\r\n              {DESCRIPTIONS_DATA[COMP_OBJECTIVE].display_name}\r\n            </p>\r\n          </div>\r\n        </div>\r\n        <Scrollama offset={0.5} onStepEnter={onStepEnter}>\r\n          <Step data={2}>\r\n            <div className=\"tut-text-card\">\r\n              This is the average yearly amount of water each group receives,\r\n              specifically from the <b>Central Valley Project</b>, one of two\r\n              water municipalities in California.\r\n            </div>\r\n          </Step>\r\n          <Step data={3}>\r\n            <div className=\"tut-text-card\">\r\n              Here, it is presented as bar graphs, with the bottom axis\r\n              representing the year and the side axis representing the amount of\r\n              water delivered in thousand acre-feet (TAF).\r\n            </div>\r\n          </Step>\r\n          <Step data={4}>\r\n            <div className=\"tut-text-card\">\r\n              We'll condense each bar graph into a single bar with a filled\r\n              gradient.\r\n            </div>\r\n          </Step>\r\n          <Step data={5}>\r\n            <div className=\"tut-text-card\">\r\n              What we get are buckets of water showing which water levels are\r\n              most likely, with the darker areas being the most likely water\r\n              levels.\r\n            </div>\r\n          </Step>\r\n          <Step data={6}>\r\n            <div className=\"tut-text-card\">\r\n              Comparing the two, we see that the maximum water level for the\r\n              refuge group is more than the agriculture group. Additionally, the\r\n              refuge group's water level is more consistent than that of the\r\n              agriculture group, with 1/3 maximum capacity being the most likely\r\n              water level.\r\n            </div>\r\n          </Step>\r\n          <Step data={7}>\r\n            <div className=\"tut-text-card\">\r\n              But the agriculture group has some chances of reaching higher than\r\n              the refuge group's most likely water level, judging from the light\r\n              blue levels that are situated above the 1/3 mark.\r\n            </div>\r\n          </Step>\r\n          <Step data={8}>\r\n            <div className=\"tut-text-card\" style={{ marginBottom: \"80vh\" }}>\r\n              Overall, if we want a reliable supply we would want the refuge\r\n              group's deliveries, but if we want a chance at higher supplies of\r\n              water albeit with more inconsistent results, we would want the\r\n              agriculture group's deliveries.\r\n            </div>\r\n          </Step>\r\n        </Scrollama>\r\n      </div>\r\n      <div className=\"scrollama scrollama-2\">\r\n        <div className=\"tut-drop-graphics-wrapper\">\r\n          <div className=\"main-waterdrop\">\r\n            <WaterdropGlyph\r\n              levelInterp={dropInterper}\r\n              width={400}\r\n              height={BAR_CHART_HEIGHT}\r\n              colorInterp={INTERP_COLOR}\r\n            />\r\n            <p className=\"var-scen-label\">\r\n              scenario <span className=\"scen-number\">{\"0000\"}</span>\r\n            </p>\r\n            <p className=\"fancy-font objective-label\">\r\n              {DESCRIPTIONS_DATA[DEFAULT_OBJECTIVE].display_name}\r\n            </p>\r\n          </div>\r\n          <div className=\"main-histogram\">\r\n            <DotHistogram\r\n              width={210}\r\n              height={140}\r\n              data={PAG_DELIVS}\r\n              goal={userGoal}\r\n              setGoal={(newGoal) => {\r\n                setUserGoal(newGoal);\r\n              }}\r\n            />\r\n          </div>\r\n          {DROP_VARIATIONS.map(({ idx, scen, clas, desc }) => (\r\n            <div className={`vardrop ${clas}`} key={idx} desc={desc}>\r\n              <WaterdropGlyph\r\n                levelInterp={variationInterpers[idx]}\r\n                width={400}\r\n                height={(BAR_CHART_HEIGHT * 2) / 3}\r\n                colorInterp={INTERP_COLOR}\r\n              />\r\n              <p className=\"var-scen-label\">\r\n                scenario <span className=\"scen-number\">{scen}</span>\r\n              </p>\r\n              <DotHistogram\r\n                shortForm\r\n                width={210}\r\n                height={140}\r\n                data={VARIATIONS_DELIVS[idx]}\r\n                goal={userGoal}\r\n                setGoal={(newGoal) => {\r\n                  setUserGoal(newGoal);\r\n                }}\r\n              />\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <div className=\"tut-comparer-graphics-wrapper\">\r\n          <svg id=\"comparer-graphics\"></svg>\r\n        </div>\r\n        <Scrollama offset={0.5} onStepEnter={onStepEnter}>\r\n          <Step data={9}>\r\n            <div className=\"tut-text-card\">\r\n              For now, let's focus on the agriculture group. Here it is as a\r\n              drop of water. We see here that the lightest color reaches the\r\n              midpoint of the maximum water possible, meaning that there is a\r\n              chance 600 TAF of water will be delivered to this group.\r\n            </div>\r\n          </Step>\r\n          <Step data={10}>\r\n            <div className=\"tut-text-card\">\r\n              The darker colors, however, indicate that it's more likely that\r\n              less than a quarter of the maximum, or around 300 TAF, will be\r\n              delivered. As we'll later see, this is not a lot compared to other\r\n              areas of California.\r\n            </div>\r\n          </Step>\r\n          <Step data={11}>\r\n            <div className=\"tut-text-card\">\r\n              But what if we could <em>change reality</em>? What if we could\r\n              increase the likelihood of delivering as much water as possible by\r\n              changing the way we manage it?\r\n            </div>\r\n          </Step>\r\n          <Step data={12}>\r\n            <div className=\"tut-text-card\">\r\n              Fortunately, we can explore those possibilities with the help of a\r\n              simulator called\r\n              <b> CalSim</b>.\r\n            </div>\r\n          </Step>\r\n          <Step data={13}>\r\n            <div className=\"tut-text-card\">\r\n              These variations are called <em>scenarios</em> and are labelled\r\n              with unique numbers. Our reality is a scenario with no variables\r\n              changed, labelled scenario 0000.\r\n            </div>\r\n          </Step>\r\n          <Step data={14}>\r\n            <div className=\"tut-text-card\">\r\n              At a glance, we can easily see that scenario 0020 appears to be\r\n              the best scenario since the darker water levels reach higher than\r\n              those of the other scenarios. To more concretely compare these\r\n              scenarios, however, we'll use a different view.\r\n            </div>\r\n          </Step>\r\n          <Step data={15}>\r\n            <div className=\"tut-text-card\" style={{ marginBottom: \"120vh\" }}>\r\n              Try moving the red line to change the minimum demand and see how\r\n              well each of these scenarios meet those demands.\r\n            </div>\r\n          </Step>\r\n          <Step data={16}>\r\n            <div className=\"tut-text-card\">\r\n              We'll collect all the possible scenarios and sort them by their\r\n              average deliveries.\r\n            </div>\r\n          </Step>\r\n          <Step data={17}>\r\n            <div className=\"tut-text-card\">\r\n              So why don't we just choose the best scenario? Well, it's because\r\n              it's not just this group that wants water. Other groups, which we\r\n              call <em>objectives</em>, want scenarios that best fit{\" \"}\r\n              <em>them.</em>\r\n            </div>\r\n          </Step>\r\n          <Step data={18}>\r\n            <div className=\"tut-text-card\" style={{ marginBottom: \"120vh\" }}>\r\n              Let's bring back the refuge group. The scenarios that benefit the\r\n              agriculture group do not always benefit the refuge group, and vice\r\n              versa. Hover over the waterdrops to see how the same scenarios\r\n              place for each objective. (Can you find a scenario that benefits\r\n              both?)\r\n            </div>\r\n          </Step>\r\n        </Scrollama>\r\n      </div>\r\n      <div>\r\n        <div className=\"tut-text-card\">\r\n          Thus, tradeoffs must often be made when managing California's water\r\n          supply. What are the ways we can manage California's water, and how do\r\n          their outcomes compare? Go to the next step to find out!\r\n          <button\r\n            className=\"fancy-font\"\r\n            onClick={() => setState({ state: \"WideView\" })}\r\n          >\r\n            click to explore!\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useCallback, useContext, useEffect, useRef, useState } from \"react\";\r\nimport { BiCross, BiNetworkChart } from \"react-icons/bi\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { SPATIAL_FEATURES } from \"data/spatial-data\";\r\nimport { SPREAD_1_2 } from \"settings\";\r\nimport { dropsMesh, scene } from \"three-resources\";\r\n\r\nimport { avgCoords, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport {\r\n  drawMinimapSVG,\r\n  fadeOutDrops,\r\n  fontSizer,\r\n  updateLargeDropSVG,\r\n} from \"utils/wideview-utils\";\r\nimport { generateTSpan, hideElems, showElems } from \"utils/render-utils\";\r\n\r\nexport default function WideView() {\r\n  const {\r\n    waterdrops,\r\n    state,\r\n    setState,\r\n    camera,\r\n    zoomTo,\r\n    setActiveWaterdrops,\r\n    activeWaterdrops,\r\n    setDisableCamAdjustments,\r\n    getOutlineOpacity,\r\n    addZoomHandler,\r\n  } = useContext(AppContext);\r\n\r\n  const [curScreenTransform, setCurScreenTransform] = useState({\r\n    zoom: 1,\r\n    mouseX: 0,\r\n    mouseY: 0,\r\n  });\r\n\r\n  const [currentHoveredDrop, setCurrentHoveredDrop] = useState(null);\r\n\r\n  const enableZoomRef = useRef(false);\r\n  const activeDropsRef = useRef([]);\r\n\r\n  useEffect(function initialize() {\r\n    initSVGGraphics();\r\n\r\n    const cleanup = registerEventListeners();\r\n\r\n    drawMinimapSVG();\r\n\r\n    return cleanup;\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"WideView\")) {\r\n        const { transitionDuration = 0 } = state;\r\n        d3.select(\"body\").style(\"overflow\", \"hidden\");\r\n\r\n        enableZoomRef.current = true;\r\n        setCurScreenTransform((cst) => ({\r\n          ...cst,\r\n          zoom: camera.curTransform.k,\r\n        }));\r\n\r\n        drawTHREEGraphics();\r\n        drawSVGGraphics();\r\n\r\n        showElems(\"#infobox, #mosaic-webgl, #mosaic-svg, #wide-group\");\r\n\r\n        return function exitState() {\r\n          hideElems(\"#infobox, #wide-group\");\r\n\r\n          enableZoomRef.current = false;\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateFontSizes() {\r\n      if (enableZoomRef.current) {\r\n        d3.select(\"#wide-group\")\r\n          .selectAll(\".cloud-text\")\r\n          .each(fontSizer(curScreenTransform, camera, waterdrops.height));\r\n      }\r\n    },\r\n    [curScreenTransform]\r\n  );\r\n\r\n  const handleClickExamine = useCallback(function () {\r\n    setDisableCamAdjustments(true);\r\n\r\n    const { x, y, height } = activeDropsRef.current[0];\r\n\r\n    const newCamPos = [\r\n      x,\r\n      y - dropCenterCorrection({ height }),\r\n      camera.getZFromFarHeight(height * SPREAD_1_2 * 1.5),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    setState({ state: \"ExamineView\", transitionDuration });\r\n\r\n    const startOpacity = getOutlineOpacity(camera.curTransform.k);\r\n    fadeOutDrops(dropsMesh, scene, startOpacity, transitionDuration / 2);\r\n  }, []);\r\n\r\n  const handleClickCompare = useCallback(function () {\r\n    setDisableCamAdjustments(true);\r\n\r\n    const dropsMidpoint = avgCoords(\r\n      activeDropsRef.current.map((w) => [w.x, w.y])\r\n    );\r\n\r\n    const newCamPos = [\r\n      ...dropsMidpoint,\r\n      camera.getZFromFarHeight(\r\n        waterdrops.groups[0].height * 2 * SPREAD_1_2 * 0.75 * 2\r\n      ),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    setState({\r\n      state: \"CompareView\",\r\n      transitionDuration,\r\n      viewCenter: dropsMidpoint,\r\n    });\r\n\r\n    const startOpacity = getOutlineOpacity(camera.curTransform.k);\r\n    fadeOutDrops(dropsMesh, scene, startOpacity, transitionDuration / 5);\r\n  }, []);\r\n\r\n  const handleClickDeselectAll = useCallback(function () {\r\n    setActiveWaterdrops([]);\r\n    activeDropsRef.current = [];\r\n    d3.selectAll(\"#wide-group .circlet\").classed(\"active\", false);\r\n  }, []);\r\n\r\n  function initSVGGraphics() {\r\n    hideElems(\"#infobox, #mosaic-webgl, #mosaic-svg\");\r\n\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"wide-group\");\r\n\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"instruction-text large-gray-text\")\r\n      .attr(\"x\", 0 - waterdrops.height * 0.6);\r\n  }\r\n\r\n  function registerEventListeners() {\r\n    const cameraListener = (transform) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        zoom: transform.k,\r\n      }));\r\n    };\r\n\r\n    const mouseListener = (e) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        mouseX: e.x,\r\n        mouseY: e.y,\r\n      }));\r\n    };\r\n\r\n    addZoomHandler(cameraListener);\r\n    window.addEventListener(\"mousemove\", mouseListener);\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener(\"mousemove\", mouseListener);\r\n    };\r\n  }\r\n\r\n  function drawTHREEGraphics() {\r\n    console.time(\"drawing\");\r\n    dropsMesh.draw(scene);\r\n    console.timeEnd(\"drawing\");\r\n\r\n    dropsMesh.updateVisibility(1);\r\n    dropsMesh.updateOutlineVisibility(getOutlineOpacity(camera.curTransform.k));\r\n  }\r\n\r\n  function drawSVGGraphics() {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    updateLargeDropSVG(container, waterdrops, {\r\n      onClick: updateActiveDrops,\r\n      onHover: hoverDrop,\r\n      onUnhover: unhoverDrop,\r\n    });\r\n\r\n    for (const wd of activeDropsRef.current) {\r\n      container.select(\".circlet.\" + wd.key).classed(\"active\", true);\r\n    }\r\n\r\n    const fontSize =\r\n      (20 / camera.height) * camera.getZFromFarHeight(waterdrops.height);\r\n    container\r\n      .select(\".instruction-text\")\r\n      .attr(\"y\", -fontSize * 5)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", fontSize)\r\n      .call(\r\n        generateTSpan(\r\n          [\"click to interact.\", \"scroll to zoom.\", \"drag to pan.\"],\r\n          2\r\n        )\r\n      )\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * 5);\r\n      });\r\n  }\r\n\r\n  function updateActiveDrops(d) {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    setActiveWaterdrops((aw) => {\r\n      if (aw.includes(d.key)) {\r\n        aw = arrRemove(aw, d.key);\r\n        activeDropsRef.current = arrRemove(activeDropsRef.current, d);\r\n\r\n        container.select(\".circlet.\" + d.key).classed(\"active\", false);\r\n      } else {\r\n        aw.push(d.key);\r\n        activeDropsRef.current.push(d);\r\n\r\n        container.select(\".circlet.\" + d.key).classed(\"active\", true);\r\n      }\r\n      return [...aw];\r\n    });\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    setCurrentHoveredDrop({\r\n      id: d.key,\r\n      description: DESCRIPTIONS_DATA[d.key].desc,\r\n    });\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"gray\");\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    setCurrentHoveredDrop(null);\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"transparent\");\r\n  }\r\n\r\n  let examineBtn, compareBtn;\r\n\r\n  if (isState(state, \"WideView\") && activeWaterdrops.length) {\r\n    if (activeWaterdrops.length === 1) {\r\n      examineBtn = (\r\n        <button\r\n          onClick={handleClickExamine}\r\n          className=\"wide-view-action-btn fancy-font\"\r\n        >\r\n          <BiCross />\r\n          <span>examine</span>\r\n        </button>\r\n      );\r\n    } else {\r\n      compareBtn = (\r\n        <>\r\n          <button\r\n            onClick={handleClickDeselectAll}\r\n            className=\"fancy-font supplement-btn\"\r\n          >\r\n            <span>deselect all</span>\r\n          </button>\r\n          <button\r\n            onClick={handleClickCompare}\r\n            className=\"wide-view-action-btn fancy-font\"\r\n          >\r\n            <BiNetworkChart />\r\n            <span>compare</span>\r\n          </button>\r\n        </>\r\n      );\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div id=\"infobox\">\r\n        <svg id=\"minimap\"></svg>\r\n        {currentHoveredDrop && (\r\n          <div className=\"details\">\r\n            {!SPATIAL_FEATURES[currentHoveredDrop.id] && (\r\n              <p className=\"no-loc-data\">No Location Data</p>\r\n            )}\r\n            <p className=\"curDesc\">{currentHoveredDrop.description}</p>\r\n            <p className=\"curKey\">\r\n              id: <span> {currentHoveredDrop.id} </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"action-btn-wrapper\">\r\n        {examineBtn}\r\n        {compareBtn}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":["waterdrops","initWaterdrops","appWidth","window","innerWidth","appHeight","innerHeight","App","state","setState","useState","activeWaterdrops","setActiveWaterdrops","goBack","setGoBack","goals","setGoals","OBJECTIVE_GOALS_MAP","zoomCallbacksRef","useRef","disableCamAdjustmentsRef","getOutlineOpacity","useCallback","d3","domain","height","groups","range","clamp","useEffect","document","querySelector","appendChild","renderer","domElement","attr","camera","create","width","webglElement","node","svgElement","select","zoomFn","transform","current","dropsMesh","updateOutlineVisibility","k","cb","setAnimationLoop","render","scene","resetCamera","animated","arguments","length","undefined","callback","pos","getZFromFarHeight","transitionDuration","start","dur","zoomTo","callZoomFromWorldViewport","worldX","worldY","farHeight","xyz","i","interpolateZoomCamera","duration","t","elapsed","et","Math","min","callZoom","stop","addZoomHandler","push","setDisableCamAdjustments","disable","_jsxs","AppContext","Provider","value","children","className","_jsx","id","TutorialView","WideView","ExamineView","CompareView","onClick","setSize","console","time","createMesh","timeEnd","createContext","DEGREE_SWAY","LEVELS","LINE_WIDTH","BucketGlyph","_ref","levelInterp","colorInterp","interpolateWatercolorBlue","resolution","useId","svgSelector","liquidLevels","useMemo","ticksExact","map","d","prevLiquidLevels","usePrevious","useLayoutEffect","svgContainer","append","concat","bucketPath","split","liquids","selectAll","data","join","_","transition","ease","period","delay","attrTween","diff","abs","sin","PI","ref","e","getQuantileBins","unitsPerQuantile","numQuantiles","histBins","thresholds","ceil","binnedQuantiles","quantileBins","quantiles","b","y","x1","x0","count","filled","taper","bottomRight","bottomLeft","x","lineFunc","numericBins","maxQuantiles","bin","round","sum","Infinity","isEqualFunc","prev","NUM_CIRCLES","MARGIN","top","right","bottom","left","DOMAIN","MAX_DELIVS","WATERDROP_ICON","draw","context","size","moveTo","lineTo","arc","SQRT2","closePath","DotHistogram","goal","setGoal","shortForm","razorID","floor","random","razorAreaID","circles","dataRange","filter","style","call","scale","tickFormat","s","text","razor","ignoreFn","preventDefault","dragging","addEventListener","removeEventListener","target","max","offsetX","svgCircles","enter","SceneSettingStickers","settings","setColorSetting","v","onMouseEnter","onMouseLeave","SETT_NAME_FULL","SETT_VAL_STEPS","j","opacity","SceneSettingSubcard","SETT_NAME_SHORT","WaterdropGlyph","_ref2","dropD","points","waterdropDeltaOutline","dropPath","DROP_RAD","DROP_HEIGHT","DESCRIPTIONS_DATA","async","objs","fetch","json","log","mapBy","SCEN_DIVISOR","SCENARIO_KEY_STRING","DELIV_KEY_STRING","OBJECTIVES_DATA","obj","scen","shuffle","unord","sort","a","name","OBJECTIVE_IDS","Object","keys","goalMap","SCENARIO_IDS","values","KEY_SETTINGS_MAP","optArr","SETT_NUM_OPTS","key","deserialize","slice","FLATTENED_DATA","DATA_GROUPINGS","flattenedData","dataGroupings","objective","scenario","means","idx","deliveries","orderedDataGroupings","criteria","objScens","ids","sortedObjScens","sorted","mean","flat","IDtoRank","rank","SPATIAL_DATA","SPATIAL_FEATURES","features","properties","CalLiteID","CALIFORNIA_OUTLINE","CALIFORNIA_CENTER","useDragPanels","viewTransform","panels","setPanels","panelsRef","useStateRef","mouseDownInfo","startX","deltaX","deltaY","startY","p","f","find","oldOffsetX","offsetY","oldOffsetY","onPanelDragStart","clientX","clientY","getPanelStyle","screenX","screenY","worldToScreen","useTutorialComparer","activeMinidrop","setActiveMinidrop","groupsRef","camCentersRef","positions","lines","calcLinesAndPositions","textX","textY","smallTextSize","SPREAD_1_2","largeTextSize","updateLabel","avgCoords","circlet","LOD_1_RAD_PX","updateScenIndicators","initComparer","getWaterdropGroups","DEFAULT_OBJECTIVE","COMP_OBJECTIVE","camMidpoint","groupPositions","camFirstDrop","firstDrop","midpoint","container","translate","indicatorGroup","updateDropsSVG","onHover","DEFAULT_SCENARIO","hideElems","introDrop2","showElems","BAR_CHART_MARGIN","useTutorialGraph","pagRefs","prfRefs","initGraphArea","svgGroup","BAR_CHART_WIDTH","BAR_CHART_HEIGHT","dataDescending","yearlyData","val","placeFromLeft","year","padding","xaxis","tickSize","tickValues","initPAG","initPRF","initBars","bandwidth","initBarsPAG","initBarsPRF","condenseBars","newWidth","bars","end","condensePAG","condensePRF","useTutorialState","userGoal","setUserGoal","bucketInterperPAG","setBucketInterperPAG","bucketInterperPRF","setBucketInterperPRF","dropInterper","setDropInterper","variationInterpers","setVariationInterpers","VARIATIONS","LOD_1_LEVELS","LOD_1_MIN_LEV_VAL","LOD_1_SMALL_DROP_PAD_FACTOR","LOD_1_LARGE_DROP_PAD_FACTOR","GROUP_HOVER_AREA_FACTOR","SQRT1_2","WaterdropMesh","constructor","added","this","updateMeshes","initializeMeshes","add","outlineMesh","remove","dropsGeometry","MeshGeometry","MAX_POINTS_DROPS","outlinePoints","outlineMeshCoords","nodes","globalX","globalY","levs","maxLev","globalTilt","tilt","l1","l2","meshCoords","waterdropDelta","color","THREE","addMeshCoords","rotate","rotOutline","rotatePoints","copyCoords","dx","dy","finish","threeGeom","vertexColors","transparent","setFromPoints","opac","material","needsUpdate","updateVisibility","MAX_POINTS_OUTLINE","_finishCreate","_classPrivateFieldLooseKey","_THREEHandleZoom","_finishCreate2","zoom","scaleExtent","getScaleFromZ","far","near","fov","position","set","webglView","_THREEHandleZoom2","z","getZFromScale","numPoints","triangleIdx","setAttribute","Float32Array","positionAttribute","getAttribute","colorAttribute","v1","v2","v3","setXYZ","r","g","setDrawRange","background","defineProperty","raycaster","_ref3","svgView","on","curTransform","_classPrivateFieldLooseBase","_ref4","_ref5","endx","endy","endz","getFarHeightFromZ","interper","tan","toRadians","scaleHeight","intersectObject","mouseX","mouseY","mesh","setFromCamera","screenToWorld","antialias","grouping","groupKeys","memberKeys","amtPerGroup","largeDropRad","sqrt","smallDropRad","largeNodesPhys","placeDropsUsingPhysics","largeNodesPos","smallNodesPhys","smallNodesPos","groupNodes","groupToNodes","nodeData","createInterpsFromDelivs","w","groupID","memberID","groupRank","memberRank","localTilt","parentTilt","rotatedX","rotatedY","rotatePoint","domLev","calcDomLev","group","groupKey","waterdropGroups","transitionDelay","onUnhover","each","largeDropInit","drops","largeDropUpdate","parentNode","raise","getEndGroupLoc","updateColorDrops","opacFn","getGroupLoc","_ref6","keyArr","center","rad","n","angle","cos","groupsObj","activeMinidropKey","groupPos","dropCenterCorrection","from","Array","to","clipEnds","updateLabelSVG","labelText","normedTextSize","updateScenIndicatorsSVG","_ref7","smallDropInit","_ref8","baselinePos","textUpdate","_ref9","smallDropUpdate","_ref10","_ref11","randId","genUUID","gradientInit","DROPLET_SHAPE","_ref12","gradientUpdate","dropBBox","getBBox","generateTSpan","display_name","delivs","maxDelivs","reverse","demand","carryover","priority","regs","minflow","scenStr","scenNum","parseInt","updateSmallDropSVG","waterdropGroup","generateWaterdrop","delta","outer","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","reuse","shape","bounds","Matter","minX","maxX","minY","maxY","genX","genY","contains","generateRandoPoints","WIDTH_AREA","AREA","radsToDropWidth","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","nx","ny","circle","restitution","parts","quad","centre","vertices","isStatic","cage","setParts","setCentre","world","FPS","SECS","update","retVal","CIRC_RAD","dist","y1","x2","y2","distSq","getCenterDomRect","domRect","shortenByStart","shortenByEnd","len","normed","dropRadToDropHeight","c","deg","vec","applyEuler","arr","newPoint","array","currentIndex","randomIndex","fn","newObjs","groupBy","_setState","stateRef","curVal","isState","stateInfo","stateName","wrap","replace","arrRemove","item","findIndex","indexOf","splice","CIRC_HEIGHT","HAT_START","yToHalfWidth","trigX","acos","yToSpriteY","spriteYToY","sy","yStart","yEnd","subdivs","Y_DELTA","rightCoords","leftCoords","dx1","dy1","dx2","dy2","v4","elemStr","displayVal","removeElems","stops","forEach","valOffset","camTransform","lineHeight","line","INTERP_COLOR","PAG_DELIVS","PRF_DELIVS","VARIATIONS_DELIVS","vars","VARIATIONS_INTERPERS","varDelivs","PAG_INTERPER","PRF_INTERPER","DROP_VARIATIONS","clas","desc","drawMinimapSVG","minimap","proj","lineGeom","geometry","type","pointGeom","projection","coordinates","updateLargeDropSVG","interactorsInit","interactorsUpdate","dropTransform","fontSizer","transformInfo","waterdropsHeight","tNode","posx","posy","getBoundingClientRect","dis","getFontSize","fadeOutDrops","startOpac","textGroup","transformZoom","cameraHeight","MAX_RAD","zoomRel","_d","useContext","colorSetting","setCamTransform","centerRef","viewCenter","setTimeout","ox","oy","isLeft","centerX","centerY","newX","newY","correctionX","getIdealGroupPos","nodeID","makePanelsFromNodes","_Fragment","onMouseDown","newGoal","activeMinidropsRef","curMinidropsRef","camTransformRef","hoveredCard","setHoveredCard","removePreviewRef","positionTexts","instrFontSize","labelFontSize","margin","addDetailPanel","dropId","preview","forceReplace","groupX","groupY","pid","_p","newPanel","panelKey","removeDetailPanel","updateActiveMinidrops","includes","classed","hoverDrop","clearTimeout","unhoverDrop","hc","ConnectLine","connectLine","circleX","circleY","cx","cy","panelBox","px","py","diffX","diffY","drawLineConnect","getConnectStyle","rot","radToDeg","atan2","maxSlideReachedRef","actions","onStepEnter","direction","src","alt","Scrollama","offset","Step","marginBottom","curScreenTransform","setCurScreenTransform","currentHoveredDrop","setCurrentHoveredDrop","enableZoomRef","activeDropsRef","initSVGGraphics","cleanup","mouseListener","ti","registerEventListeners","cst","updateActiveDrops","wd","fontSize","drawSVGGraphics","handleClickExamine","newCamPos","startZoom","startOpacity","handleClickCompare","dropsMidpoint","handleClickDeselectAll","aw","description","examineBtn","compareBtn","BiCross","BiNetworkChart"],"sourceRoot":""}