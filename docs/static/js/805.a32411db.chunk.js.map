{"version":3,"file":"static/js/805.a32411db.chunk.js","mappings":"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","sources":["App.jsx","AppContext.jsx","bucket-lib/BucketGlyph.jsx","bucket-lib/quantile-histogram.js","bucket-lib/utils.js","components/DotHistogram.jsx","components/SceneSettingStickers.jsx","components/SceneSettingSubcard.jsx","components/WaterdropGlyph.jsx","data/descriptions-data.jsx","data/objectives-data.jsx","data/spatial-data.jsx","settings.jsx","utils/three-utils.jsx","three-resources.jsx","utils/app-utils.jsx","utils/compareview-utils.jsx","utils/data-utils.jsx","utils/drag-panels.jsx","utils/examineview-utils.jsx","utils/math-utils.jsx","utils/misc-utils.jsx","utils/render-utils.jsx","utils/tutorialview-utils.jsx","utils/wideview-utils.jsx","views/CompareView.jsx","views/ExamineView.jsx","views/TutorialView.jsx","views/WideView.jsx"],"sourcesContent":["import * as d3 from \"d3\";\r\n\r\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { initWaterdrops } from \"utils/app-utils\";\r\n\r\nimport WideView from \"views/WideView\";\r\nimport ExamineView from \"views/ExamineView\";\r\nimport TutorialView from \"views/TutorialView\";\r\nimport CompareView from \"views/CompareView\";\r\n\r\nimport { scene, camera, renderer, dropsMesh } from \"three-resources\";\r\nimport { OBJECTIVE_GOALS_MAP } from \"data/objectives-data\";\r\n\r\n// pre-calculate these so we don't lag later\r\nconst waterdrops = initWaterdrops(\"objective\");\r\n\r\nconst appWidth = window.innerWidth,\r\n  appHeight = window.innerHeight;\r\n\r\nrenderer.setSize(appWidth, appHeight);\r\n\r\nconsole.time(\"drops mesh creating\");\r\ndropsMesh.createMesh(waterdrops);\r\nconsole.timeEnd(\"drops mesh creating\");\r\n\r\nexport default function App() {\r\n  const [state, setState] = useState({});\r\n  const [activeWaterdrops, setActiveWaterdrops] = useState([]);\r\n  const [goBack, setGoBack] = useState(null);\r\n  const [goals, setGoals] = useState(OBJECTIVE_GOALS_MAP);\r\n\r\n  const zoomCallbacksRef = useRef([]);\r\n  const disableCamAdjustmentsRef = useRef(false);\r\n\r\n  const getOutlineOpacity = useCallback(\r\n    d3\r\n      .scaleLinear()\r\n      .domain([\r\n        appHeight / waterdrops.height,\r\n        appHeight / waterdrops.groups[0].height,\r\n      ])\r\n      .range([0.1, 1])\r\n      .clamp(true),\r\n    []\r\n  );\r\n\r\n  useEffect(function initialize() {\r\n    document.querySelector(\"#mosaic-webgl\").appendChild(renderer.domElement);\r\n\r\n    d3.select(\"#mosaic-svg\").attr(\"width\", appWidth).attr(\"height\", appHeight);\r\n\r\n    camera.mount(\r\n      d3.select(\".bubbles-wrapper\").node(),\r\n      d3.select(\"#mosaic-svg\").select(\".svg-trans\").node()\r\n    );\r\n    camera.setZoomFn((transform) => {\r\n      if (!disableCamAdjustmentsRef.current) {\r\n        dropsMesh.updateOutlineVisibility(getOutlineOpacity(transform.k));\r\n      }\r\n\r\n      for (const cb of zoomCallbacksRef.current) cb(transform);\r\n    });\r\n    camera.setSize(appWidth, appHeight);\r\n\r\n    renderer.setAnimationLoop(() => {\r\n      renderer.render(scene, camera.camera);\r\n    });\r\n\r\n    resetCamera(false);\r\n    setState({ state: \"TutorialView\" });\r\n  }, []);\r\n\r\n  const resetCamera = useCallback(function (animated = true, callback) {\r\n    const pos = [\r\n      0,\r\n      -waterdrops.height * 0.08,\r\n      camera.getZFromFarHeight(waterdrops.height),\r\n    ];\r\n    if (animated) {\r\n      const [start] = zoomTo(pos, callback);\r\n      start();\r\n    } else {\r\n      camera.callZoomFromWorldViewport({\r\n        worldX: pos[0],\r\n        worldY: -pos[1],\r\n        farHeight: waterdrops.height,\r\n      });\r\n      callback && callback();\r\n    }\r\n  }, []);\r\n\r\n  const zoomTo = useCallback(function (xyz, callback) {\r\n    const i = camera.interpolateZoomCamera(xyz);\r\n\r\n    const duration = i.duration / 2;\r\n\r\n    const start = () => {\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(elapsed / duration, 1);\r\n        camera.callZoom(i(et));\r\n\r\n        if (et === 1) {\r\n          t.stop();\r\n          callback && callback();\r\n        }\r\n      });\r\n    };\r\n\r\n    return [start, duration];\r\n  }, []);\r\n\r\n  const addZoomHandler = useCallback(function (cb) {\r\n    zoomCallbacksRef.current.push(cb);\r\n  }, []);\r\n\r\n  const setDisableCamAdjustments = useCallback(function (disable) {\r\n    disableCamAdjustmentsRef.current = disable;\r\n  });\r\n\r\n  return (\r\n    <AppContext.Provider\r\n      value={{\r\n        appWidth,\r\n        appHeight,\r\n        state,\r\n        setState,\r\n        activeWaterdrops,\r\n        setActiveWaterdrops,\r\n        setDisableCamAdjustments,\r\n        waterdrops,\r\n        scene,\r\n        camera,\r\n        renderer,\r\n        dropsMesh,\r\n        setGoBack,\r\n        zoomTo,\r\n        resetCamera,\r\n        getOutlineOpacity,\r\n        addZoomHandler,\r\n        goals,\r\n        setGoals,\r\n      }}\r\n    >\r\n      <div className=\"bubbles-wrapper\">\r\n        <div id=\"mosaic-webgl\"></div>\r\n        <svg id=\"mosaic-svg\">\r\n          <g className=\"svg-trans\"></g>\r\n        </svg>\r\n      </div>\r\n      <TutorialView />\r\n      <WideView />\r\n      <ExamineView />\r\n      <CompareView />\r\n      {goBack && (\r\n        <button className=\"go-back-btn\" onClick={goBack}>\r\n          ←\r\n        </button>\r\n      )}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n","import { createContext } from \"react\";\r\n\r\nexport const AppContext = createContext({});\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  bucketPath,\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"./utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nexport default function BucketGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () =>\r\n      ticksExact(0, 1 - 1 / resolution, resolution).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    svgContainer\r\n      .select(\".bucket-mask-path\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight));\r\n\r\n    svgContainer\r\n      .select(\".bucket-outline\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight).split(\"z\")[0]);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / (resolution - 1)));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"bucket-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { quantileBins, ticksExact } from \"./utils\";\r\n\r\nexport function getQuantileBins(data, domain, unitsPerQuantile, width, height) {\r\n  const numQuantiles = data.length / unitsPerQuantile;\r\n  let histBins = d3\r\n    .histogram()\r\n    .value((d) => d)\r\n    .domain(domain)\r\n    .thresholds(\r\n      ticksExact(...domain, Math.ceil(width / (height / numQuantiles)))\r\n    )(data);\r\n\r\n  let binnedQuantiles = quantileBins(histBins, unitsPerQuantile, numQuantiles);\r\n\r\n  let quantiles = [];\r\n\r\n  for (let b = 0; b < binnedQuantiles.length; b++) {\r\n    for (let y = 0; y < binnedQuantiles[b]; y++) {\r\n      quantiles.push([\r\n        (histBins[b].x1 + histBins[b].x0) / 2,\r\n        ((y + 0.5) / numQuantiles) * data.length,\r\n      ]);\r\n    }\r\n  }\r\n\r\n  return quantiles;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\n// inclusive\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n\r\nexport const interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useMemo, useRef } from \"react\";\r\nimport { getQuantileBins } from \"bucket-lib/quantile-histogram\";\r\n\r\nimport { MAX_DELIVS } from \"data/objectives-data\";\r\n\r\nconst NUM_CIRCLES = 20;\r\nconst MARGIN = { top: 10, right: 10, bottom: 20, left: 10 };\r\nconst DOMAIN = [0, MAX_DELIVS];\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport default function DotHistogram({\r\n  data,\r\n  goal,\r\n  setGoal,\r\n  width = 600,\r\n  height = 400,\r\n  shortForm = false,\r\n}) {\r\n  const { current: razorID } = useRef(Math.floor(Math.random() * 1e9));\r\n  const { current: razorAreaID } = useRef(Math.floor(Math.random() * 1e9));\r\n\r\n  const svgSelector = useRef();\r\n  const circles = useMemo(\r\n    () =>\r\n      getQuantileBins(data, DOMAIN, data.length / NUM_CIRCLES, width, height),\r\n    [data]\r\n  );\r\n\r\n  const dataRange = [0, data.length];\r\n  const x = d3.scaleLinear().domain(DOMAIN).range([0, width]);\r\n  const y = d3.scaleLinear().domain(dataRange).range([height, 0]);\r\n  const count = circles.filter((d) => d[0] > goal).length;\r\n\r\n  useEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width + MARGIN.left + MARGIN.right)\r\n      .attr(\"height\", height + MARGIN.top + MARGIN.bottom)\r\n      .style(\"pointer-events\", \"none\")\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${MARGIN.left},${MARGIN.top})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(\r\n        d3\r\n          .axisBottom()\r\n          .scale(d3.scaleLinear().domain(DOMAIN).range([0, width]))\r\n          .tickFormat(d3.format(\".2s\"))\r\n      )\r\n      .call((s) => {\r\n        s.selectAll(\"line\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"path\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"text\").attr(\"fill\", \"gray\");\r\n      })\r\n      .append(\"text\")\r\n      .attr(\"fill\", \"black\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${30})`)\r\n      .text(\"Delivery (TAF)\");\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n\r\n    const ignoreFn = (e) => e.preventDefault();\r\n    let dragging = false;\r\n\r\n    document.querySelector(`#i${razorID}`).addEventListener(\"mousedown\", () => {\r\n      dragging = true;\r\n      window.addEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", () => {\r\n      dragging = false;\r\n      window.removeEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document\r\n      .querySelector(`#i${razorAreaID}`)\r\n      .addEventListener(\"mousemove\", (e) => {\r\n        if (dragging && e.target.id === `i${razorAreaID}`) {\r\n          razor.style.transform = `translateX(${Math.min(\r\n            Math.max(e.offsetX, MARGIN.left),\r\n            MARGIN.left + width\r\n          )}px)\r\n            `;\r\n\r\n          setGoal(\r\n            d3\r\n              .scaleLinear()\r\n              .domain([MARGIN.left, width + MARGIN.left])\r\n              .range(DOMAIN)\r\n              .clamp(true)(e.offsetX)\r\n          );\r\n        }\r\n      });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const svgCircles = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".icons\")\r\n      .data(circles)\r\n      .join((enter) => enter.append(\"g\").call((s) => s.append(\"path\")))\r\n      .attr(\"class\", \"icons\")\r\n      .call((s) => {\r\n        s.selectAll(\"path\").attr(\r\n          \"d\",\r\n          d3.symbol(WATERDROP_ICON, height / NUM_CIRCLES)\r\n        );\r\n      });\r\n\r\n    svgCircles.attr(\"transform\", (d) => `translate(${x(d[0])},${y(d[1])})`);\r\n\r\n    svgCircles.attr(\"fill\", (d) => (d[0] > goal ? \"steelblue\" : \"black\"));\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n  }, [goal, circles]);\r\n\r\n  return (\r\n    <div\r\n      className={`dot-${razorAreaID} dot-histogram-wrapper`}\r\n      id={`i${razorAreaID}`}\r\n    >\r\n      <div\r\n        className={`pdf-razor ` + (shortForm ? \"short-form\" : \"\")}\r\n        id={`i${razorID}`}\r\n      >\r\n        <div>\r\n          <span>\r\n            <u>\r\n              {circles.length - count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL NOT meet demand\"}\r\n          </span>\r\n          <span>\r\n            <u>\r\n              {count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL meet demand\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport { SETT_NAME_FULL, SETT_VAL_STEPS } from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingStickers({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings comp-settings\">\r\n      {settings.map((v, i) => (\r\n        <div\r\n          className=\"full-card\"\r\n          onMouseEnter={() => setColorSetting(i)}\r\n          onMouseLeave={() => setColorSetting(null)}\r\n          key={i}\r\n        >\r\n          <span>{SETT_NAME_FULL[i]}</span>\r\n          <span>{SETT_VAL_STEPS[i][v]}</span>\r\n          <div className=\"sett-dot-wrapper\">\r\n            {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n              <span\r\n                className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport {\r\n  SETT_NAME_SHORT,\r\n  SETT_NAME_FULL,\r\n  SETT_VAL_STEPS,\r\n} from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingSubcard({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings\">\r\n      <div className=\"condense\">\r\n        {settings.map((v, i) => (\r\n          <div className=\"sett-dot-wrapper\" key={i}>\r\n            <span>{SETT_NAME_SHORT[i]}</span>\r\n            {d3.range(v + 1).map((j) => (\r\n              <span\r\n                className=\"sett-dot\"\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"full\">\r\n        <div className=\"full-container\">\r\n          <span>The settings for this scenario are:</span>\r\n          {settings.map((v, i) => (\r\n            <div\r\n              className=\"full-card\"\r\n              onMouseEnter={() => setColorSetting(i)}\r\n              onMouseLeave={() => setColorSetting(null)}\r\n              key={i}\r\n            >\r\n              <span>{SETT_NAME_FULL[i]}</span>\r\n              <span>{SETT_VAL_STEPS[i][v]}</span>\r\n              <div className=\"sett-dot-wrapper\">\r\n                {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n                  <span\r\n                    className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                    key={j}\r\n                    style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n                  ></span>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"bucket-lib/utils\";\r\nimport {\r\n  DROP_HEIGHT,\r\n  DROP_RAD,\r\n  waterdropDeltaOutline,\r\n} from \"utils/render-utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nfunction dropPath(height, [x, y]) {\r\n  const points = waterdropDeltaOutline(0, 1, height, 20);\r\n\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d[0] + x;\r\n    })\r\n    .y(function (d) {\r\n      return d[1] + y;\r\n    });\r\n  return lineFunc(points) + \"z\";\r\n}\r\n\r\nexport default function WaterdropGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () =>\r\n      ticksExact(0, 1 - 1 / resolution, resolution).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    const dropD = dropPath((innerHeight * (DROP_RAD * 2)) / DROP_HEIGHT, [\r\n      width / 2,\r\n      (height * DROP_RAD) / DROP_HEIGHT,\r\n    ]);\r\n\r\n    svgContainer.select(\".bucket-mask-path\").attr(\"d\", dropD);\r\n    svgContainer.select(\".bucket-outline\").attr(\"d\", dropD);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / (resolution - 1)));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"waterdrop-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const DESCRIPTIONS_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./descriptions.json\")).json();\r\n\r\n  console.log(\"DATA: loading descriptions data\");\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n})();\r\n","import * as d3 from \"d3\";\r\nimport { SETT_NUM_OPTS, deserialize } from \"utils/data-utils\";\r\n\r\nimport { clamp, shuffle } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst SCEN_DIVISOR = 1; // debugging purposes, don't render all scenarios to speed things up\r\n\r\nexport const MAX_DELIVS = 1200;\r\nexport const SCENARIO_KEY_STRING = \"scens\";\r\nexport const DELIV_KEY_STRING = \"delivs\";\r\n\r\nexport const OBJECTIVES_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./objectives.json\")).json();\r\n\r\n  for (const obj of objs) {\r\n    // shuffle so clusters of identical scenario results don't get processed deterministically\r\n    for (const scen of shuffle(obj[SCENARIO_KEY_STRING])) {\r\n      // data cleanup, clamping\r\n      const unord = scen[DELIV_KEY_STRING].map((v) => clamp(v, 0, MAX_DELIVS));\r\n\r\n      scen[DELIV_KEY_STRING] = unord.sort((a, b) => b - a);\r\n    }\r\n    obj[SCENARIO_KEY_STRING] = mapBy(\r\n      obj[SCENARIO_KEY_STRING],\r\n      ({ name }) => name\r\n    );\r\n  }\r\n\r\n  console.log(\"DATA: loading objectives data\");\r\n\r\n  return mapBy(objs, ({ obj }) => obj);\r\n})();\r\n\r\nexport const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\nexport const OBJECTIVE_GOALS_MAP = (function initDefaults() {\r\n  const goalMap = {};\r\n  for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n    goalMap[OBJECTIVE_IDS[i]] = 200;\r\n  return goalMap;\r\n})();\r\n\r\nconst _SCENARIO_IDS = Object.keys(\r\n  Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n);\r\n\r\nexport const SCENARIO_IDS = _SCENARIO_IDS.filter(\r\n  (_, i) => i % SCEN_DIVISOR === 0\r\n);\r\n\r\nexport const KEY_SETTINGS_MAP = (function preprocessData() {\r\n  const map = {};\r\n  const optArr = Object.values(SETT_NUM_OPTS);\r\n\r\n  for (let i = 0; i < SCENARIO_IDS.length; i++) {\r\n    const key = SCENARIO_IDS[i];\r\n\r\n    map[key] = deserialize(key.slice(4)).map((v, i) => (v + 1) / optArr[i]);\r\n  }\r\n\r\n  return map;\r\n})();\r\n\r\n// Flattening hierarchical data makes it more flexible for classifying\r\n// (from experience). id conveniently corresponds to index.\r\n// Also cache classifications (by objective and by scenario, for now)\r\nexport const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n  const flattenedData = [];\r\n  const dataGroupings = {\r\n    objective: {},\r\n    scenario: {},\r\n  };\r\n\r\n  // for ordering later\r\n  const means = [];\r\n\r\n  let idx = 0;\r\n  for (const obj of OBJECTIVE_IDS) {\r\n    for (const scen of SCENARIO_IDS) {\r\n      if (!dataGroupings[\"objective\"][obj])\r\n        dataGroupings[\"objective\"][obj] = [];\r\n\r\n      if (!dataGroupings[\"scenario\"][scen])\r\n        dataGroupings[\"scenario\"][scen] = [];\r\n\r\n      dataGroupings[\"objective\"][obj].push(idx);\r\n      dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n      const deliveries =\r\n        OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n      flattenedData.push({\r\n        id: idx,\r\n        objective: obj,\r\n        scenario: scen,\r\n        deliveries,\r\n      });\r\n\r\n      means.push(d3.mean(deliveries));\r\n\r\n      idx++;\r\n    }\r\n  }\r\n\r\n  const orderedDataGroupings = {};\r\n\r\n  for (const criteria of Object.keys(dataGroupings)) {\r\n    const objScens = [];\r\n    for (const key of Object.keys(dataGroupings[criteria])) {\r\n      const ids = dataGroupings[criteria][key];\r\n      const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n      objScens.push({\r\n        key,\r\n        sorted: sortedObjScens,\r\n        mean: d3.mean(ids.map((id) => flattenedData[id].deliveries).flat()),\r\n      });\r\n    }\r\n\r\n    const sortedObjScens = objScens.sort((a, b) => b.mean - a.mean);\r\n\r\n    orderedDataGroupings[criteria] = {};\r\n\r\n    for (let i = 0; i < sortedObjScens.length; i++) {\r\n      const { key, sorted } = sortedObjScens[i];\r\n      const IDtoRank = {};\r\n\r\n      for (let j = 0; j < sorted.length; j++) {\r\n        IDtoRank[sorted[j]] = j;\r\n      }\r\n      orderedDataGroupings[criteria][key] = IDtoRank;\r\n      orderedDataGroupings[criteria][key].rank = i;\r\n    }\r\n  }\r\n\r\n  return [flattenedData, orderedDataGroupings];\r\n})();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nexport const SPATIAL_DATA = await (async function load() {\r\n  const objs = await (await fetch(\"./callite_spatial.json\")).json();\r\n\r\n  console.log(\"DATA: loading callite spatial data\");\r\n\r\n  return objs;\r\n})();\r\n\r\nexport const SPATIAL_FEATURES = (function () {\r\n  return mapBy(SPATIAL_DATA.features, ({ properties }) => properties.CalLiteID);\r\n})();\r\n\r\nexport const CALIFORNIA_OUTLINE = await (async function load() {\r\n  const objs = await (await fetch(\"./california.json\")).json();\r\n\r\n  console.log(\"DATA: loading california spatial data\");\r\n\r\n  return objs;\r\n})();\r\n\r\nexport const CALIFORNIA_CENTER = [-119, 37.7749];\r\n","export const LOD_1_LEVELS = 5;\r\nexport const LOD_1_RAD_PX = 1;\r\nexport const LOD_1_MIN_LEV_VAL = 0.1;\r\nexport const LOD_1_SMALL_DROP_PAD_FACTOR = 1.3;\r\nexport const LOD_1_LARGE_DROP_PAD_FACTOR = 1.2;\r\n\r\nexport const LOD_2_SMALL_DROP_PAD_FACTOR = 3;\r\n\r\nexport const GROUP_HOVER_AREA_FACTOR = 1.1 / (1 + Math.SQRT1_2);\r\nexport const SPREAD_1_2 =\r\n  LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\nimport { LOD_1_LEVELS } from \"settings\";\r\nimport { copyCoords, sortBy } from \"./misc-utils\";\r\nimport { rotatePoints, toRadians } from \"./math-utils\";\r\nimport { waterdropDeltaOutline, waterdropDelta } from \"./render-utils\";\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return {\r\n    x: (mouseX / width) * 2 - 1,\r\n    y: -(mouseY / height) * 2 + 1,\r\n  };\r\n}\r\n\r\nexport class WaterdropMesh {\r\n  static MAX_POINTS_DROPS = 60 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n  static MAX_POINTS_OUTLINE = 40 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n\r\n  dropsMesh;\r\n  outlineMesh;\r\n\r\n  added = false;\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.dropsMesh) {\r\n      this.initializeMeshes(waterdrops);\r\n    } else {\r\n      this.updateMeshes(waterdrops);\r\n    }\r\n  }\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.dropsMesh);\r\n      scene.add(this.outlineMesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.dropsMesh);\r\n      scene.remove(this.outlineMesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  // TODO optimize!\r\n  initializeMeshes(waterdrops) {\r\n    const dropsGeometry = new MeshGeometry(WaterdropMesh.MAX_POINTS_DROPS);\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = waterdropDeltaOutline(\r\n      0,\r\n      1,\r\n      LOD_1_RAD_PX * 2 * 0.975\r\n    );\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const {\r\n        id,\r\n        globalX: x,\r\n        globalY: y,\r\n        levs,\r\n        maxLev,\r\n        globalTilt: tilt,\r\n      } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = waterdropDelta(\r\n          l1 / maxLev,\r\n          l2 / maxLev,\r\n          LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / LOD_1_LEVELS)\r\n        );\r\n\r\n        dropsGeometry.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y, rotate: tilt },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      const rotOutline = rotatePoints(copyCoords(outlineMeshCoords), tilt);\r\n\r\n      outlinePoints.push(\r\n        ...rotOutline.map(([dx, dy]) => {\r\n          return new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01);\r\n        })\r\n      );\r\n    }\r\n\r\n    dropsGeometry.finish();\r\n\r\n    this.dropsMesh = new THREE.Mesh(\r\n      dropsGeometry.threeGeom,\r\n      new THREE.MeshBasicMaterial({\r\n        vertexColors: true,\r\n        transparent: true,\r\n        opacity: 1,\r\n      })\r\n    );\r\n\r\n    this.outlineMesh = new THREE.LineSegments(\r\n      new THREE.BufferGeometry().setFromPoints(outlinePoints),\r\n      new THREE.LineBasicMaterial({\r\n        color: 13421772,\r\n        transparent: true,\r\n        opacity: 0,\r\n      })\r\n    );\r\n  }\r\n\r\n  updateOutlineVisibility(opac) {\r\n    if (!this.outlineMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateVisibility(opac) {\r\n    if (!this.outlineMesh || !this.dropsMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n    this.dropsMesh.material.opacity = opac;\r\n    this.dropsMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateMeshes(waterdrops) {\r\n    // TODO fix\r\n  }\r\n}\r\n\r\nexport class WaterdropSimplifiedMesh {\r\n  mesh;\r\n  added = false;\r\n\r\n  vertToId = {};\r\n  idToVert = {};\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.mesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.mesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.mesh) {\r\n      this.initializeMesh(waterdrops);\r\n    }\r\n\r\n    this.updateMesh(waterdrops);\r\n\r\n    return this.mesh;\r\n  }\r\n\r\n  initializeMesh(waterdrops) {\r\n    const pointsGeometry = new THREE.BufferGeometry();\r\n\r\n    const vertices = [];\r\n    const colors = [];\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, domLev } = waterdrops.nodes[i];\r\n\r\n      const color = domLev > 0 ? interpolateWatercolorBlue(domLev) : \"white\";\r\n\r\n      vertices.push(x, -y, 0);\r\n      const t_color = new THREE.Color(color);\r\n      colors.push(t_color.r, t_color.g, t_color.b);\r\n\r\n      this.vertToId[i] = id;\r\n      this.idToVert[id] = i;\r\n    }\r\n\r\n    const pointsMaterial = new THREE.PointsMaterial({\r\n      size: LOD_1_RAD_PX * 2,\r\n      sizeAttenuation: true,\r\n      vertexColors: true,\r\n      map: new THREE.TextureLoader().load(\"drop.png\"),\r\n      transparent: true,\r\n    });\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(vertices), 3)\r\n    );\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"color\",\r\n      new THREE.BufferAttribute(new Float32Array(colors), 3)\r\n    );\r\n\r\n    this.mesh = new THREE.Points(pointsGeometry, pointsMaterial);\r\n  }\r\n\r\n  updateMesh(waterdrops) {\r\n    const positionAttr = this.mesh.geometry.getAttribute(\"position\");\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: newX, globalY: newY } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n      positionAttr.setXY(idx, newX, -newY);\r\n    }\r\n    positionAttr.needsUpdate = true;\r\n  }\r\n\r\n  updatePoints(waterdrops, translations, dt) {\r\n    const verts = this.mesh.geometry.vertices;\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n\r\n      const [dx, dy] = translations[id];\r\n\r\n      const x = verts[idx].x;\r\n      const y = verts[idx].y;\r\n\r\n      verts[idx].setX(x + dt * dx);\r\n      verts[idx].setY(y - dt * dy);\r\n    }\r\n\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n\r\n  intersectObject(camera, x, y) {\r\n    const intersects = camera.intersectObject(x, y, this.mesh);\r\n\r\n    if (intersects[0]) {\r\n      const intersect = sortBy(intersects, \"distanceToRay\")[0];\r\n      return this.vertToId[intersect.index];\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  view;\r\n  curTransform;\r\n\r\n  raycaster = new THREE.Raycaster();\r\n\r\n  _svgElement;\r\n\r\n  constructor({ fov, near, far }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n  }\r\n\r\n  setZoomFn(zoomFn) {\r\n    this.zoom = d3.zoom().on(\"zoom\", (e) => {\r\n      this.curTransform = e.transform;\r\n\r\n      this._THREEZoomHandler(e.transform);\r\n      d3.select(this._svgElement).attr(\"transform\", e.transform);\r\n\r\n      zoomFn && zoomFn(e.transform);\r\n    });\r\n  }\r\n\r\n  callZoom(transform) {\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity.translate(transform.x, transform.y).scale(transform.k)\r\n    );\r\n  }\r\n\r\n  callZoomFromWorldViewport({ worldX, worldY, farHeight }) {\r\n    const k = this.height / farHeight;\r\n\r\n    const x = -(worldX * k) + this.width / 2;\r\n    const y = worldY * k + this.height / 2;\r\n\r\n    this.callZoom({\r\n      x,\r\n      y,\r\n      k,\r\n    });\r\n  }\r\n\r\n  getZFromFarHeight(farHeight) {\r\n    return (Math.tan(toRadians(90 - this.fov / 2)) * farHeight) / 2;\r\n  }\r\n\r\n  getFarHeightFromZ(z) {\r\n    return Math.tan(toRadians(this.fov) / 2) * z * 2;\r\n  }\r\n\r\n  interpolateZoomCamera([endx, endy, endz]) {\r\n    const i = d3.interpolateZoom(\r\n      [\r\n        this.camera.position.x,\r\n        this.camera.position.y,\r\n        this.height / this.curTransform.k,\r\n      ],\r\n      [endx, -endy, this.getFarHeightFromZ(endz)]\r\n    );\r\n\r\n    const interper = (t) => {\r\n      const [worldX, worldY, farHeight] = i(t);\r\n\r\n      const k = this.height / farHeight;\r\n\r\n      const x = -(worldX * k) + this.width / 2;\r\n      const y = worldY * k + this.height / 2;\r\n\r\n      return {\r\n        x,\r\n        y,\r\n        k,\r\n      };\r\n    };\r\n\r\n    interper.duration = i.duration;\r\n\r\n    return interper;\r\n  }\r\n\r\n  mount(webglElement, svgElement) {\r\n    this.view = d3.select(webglElement);\r\n    this._svgElement = svgElement;\r\n  }\r\n\r\n  setSize(width, height) {\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.zoom = this.zoom.scaleExtent([\r\n      this.getScaleFromZ(this.far),\r\n      this.getScaleFromZ(this.near),\r\n    ]);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      this.fov,\r\n      width / height,\r\n      this.near,\r\n      this.far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.view.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  _THREEZoomHandler(transform) {\r\n    const scale = transform.k;\r\n    const x = -(transform.x - this.width / 2) / scale;\r\n    const y = (transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n\r\n  getScaleFromZ(camera_z_position) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const half_fov_height = Math.tan(half_fov_radians) * camera_z_position;\r\n    const fov_height = half_fov_height * 2;\r\n    const scale = this.height / fov_height;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const scale_height = this.height / scale;\r\n    const camera_z_position = scale_height / (2 * Math.tan(half_fov_radians));\r\n    return camera_z_position;\r\n  }\r\n\r\n  intersectObject(mouseX, mouseY, mesh) {\r\n    this.raycaster.setFromCamera(\r\n      {\r\n        x: mouseX,\r\n        y: mouseY,\r\n      },\r\n      this.camera\r\n    );\r\n\r\n    return this.raycaster.intersectObject(mesh);\r\n  }\r\n}\r\n\r\nclass MeshGeometry {\r\n  threeGeom = new THREE.BufferGeometry();\r\n  triangleIdx = 0;\r\n  positionAttribute;\r\n  colorAttribute;\r\n\r\n  constructor(numPoints, color = true) {\r\n    this.threeGeom.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n    );\r\n\r\n    if (color)\r\n      this.threeGeom.setAttribute(\r\n        \"color\",\r\n        new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n      );\r\n\r\n    this.positionAttribute = this.threeGeom.getAttribute(\"position\");\r\n    this.colorAttribute = this.threeGeom.getAttribute(\"color\");\r\n  }\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = rotatePoints(\r\n        copyCoords(meshCoords[j]),\r\n        transform.rotate\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 0,\r\n        transform.x + v1[0],\r\n        transform.y - v1[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 1,\r\n        transform.x + v2[0],\r\n        transform.y - v2[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 2,\r\n        transform.x + v3[0],\r\n        transform.y - v3[1],\r\n        z\r\n      );\r\n\r\n      if (color) {\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 0,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 1,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 2,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n      }\r\n\r\n      this.triangleIdx++;\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    this.threeGeom.setDrawRange(0, this.triangleIdx * 3);\r\n  }\r\n}\r\n","import * as THREE from \"three\";\r\n\r\nimport { WaterdropMesh, Camera } from \"utils/three-utils\";\r\n\r\nconst scene = (function getScene() {\r\n  const s = new THREE.Scene();\r\n  s.background = new THREE.Color(0xefefef);\r\n  return s;\r\n})();\r\n\r\nconst dropsMesh = new WaterdropMesh();\r\n\r\nconst camera = new Camera({\r\n  fov: 45,\r\n  near: 1,\r\n  far: 3000,\r\n});\r\n\r\nconst renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\r\nexport { scene, camera, renderer, dropsMesh };\r\n","import { ticksExact } from \"bucket-lib/utils\";\r\nimport {\r\n  LOD_1_LARGE_DROP_PAD_FACTOR,\r\n  LOD_1_LEVELS,\r\n  LOD_1_MIN_LEV_VAL,\r\n  LOD_1_RAD_PX,\r\n  LOD_1_SMALL_DROP_PAD_FACTOR,\r\n} from \"settings\";\r\n\r\nimport {\r\n  DATA_GROUPINGS,\r\n  FLATTENED_DATA,\r\n  MAX_DELIVS,\r\n  OBJECTIVE_IDS,\r\n  SCENARIO_IDS,\r\n} from \"data/objectives-data\";\r\n\r\nimport { calcDomLev, createInterpsFromDelivs } from \"utils/data-utils\";\r\nimport { placeDropsUsingPhysics, rotatePoint } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\n// TODO optimize!!\r\nexport function initWaterdrops(grouping) {\r\n  const groupKeys = grouping === \"objective\" ? OBJECTIVE_IDS : SCENARIO_IDS;\r\n  const memberKeys = grouping === \"objective\" ? SCENARIO_IDS : OBJECTIVE_IDS;\r\n\r\n  const amtGroups = groupKeys.length;\r\n  const amtPerGroup = memberKeys.length;\r\n\r\n  const largeDropRad =\r\n    Math.sqrt(amtPerGroup / Math.PI) *\r\n    LOD_1_RAD_PX *\r\n    2 *\r\n    LOD_1_SMALL_DROP_PAD_FACTOR *\r\n    LOD_1_LARGE_DROP_PAD_FACTOR;\r\n  const smallDropRad = LOD_1_RAD_PX * LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  const largeNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    groupKeys.map((p, idx) => ({\r\n      r: largeDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  for (let i = 0; i < largeNodesPhys.length; i++) {\r\n    largeNodesPhys[i].tilt = Math.random() * 50 - 25;\r\n  }\r\n\r\n  const largeNodesPos = mapBy(largeNodesPhys, ({ id }) => id);\r\n\r\n  const smallNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    memberKeys.map((s, idx) => ({\r\n      r: smallDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const smallNodesPos = mapBy(smallNodesPhys, ({ id }) => id);\r\n\r\n  const nodes = [];\r\n  const groupNodes = [];\r\n\r\n  const groupToNodes = {};\r\n\r\n  let idx = 0;\r\n\r\n  for (const nodeData of FLATTENED_DATA) {\r\n    const { id, objective, scenario, deliveries } = nodeData;\r\n\r\n    const i = createInterpsFromDelivs(deliveries, MAX_DELIVS);\r\n    const wds = ticksExact(0, 1, LOD_1_LEVELS + 1).map((d) => i(d));\r\n\r\n    const levs = wds.map(\r\n      (w, i) => Math.max(w, i == 0 ? LOD_1_MIN_LEV_VAL : 0) * LOD_1_RAD_PX\r\n    );\r\n\r\n    const groupID = grouping === \"objective\" ? objective : scenario;\r\n    const memberID = grouping === \"objective\" ? scenario : objective;\r\n\r\n    const groupRank = DATA_GROUPINGS[grouping][groupID].rank;\r\n    const memberRank = DATA_GROUPINGS[grouping][groupID][id];\r\n\r\n    const localTilt = Math.random() * 50 - 25;\r\n    const parentTilt = largeNodesPos[groupRank].tilt;\r\n\r\n    const { x, y } = smallNodesPos[memberRank];\r\n    const [rotatedX, rotatedY] = rotatePoint(x, y, parentTilt);\r\n\r\n    const node = {\r\n      id,\r\n      levs,\r\n      maxLev: LOD_1_RAD_PX,\r\n      domLev: calcDomLev(levs),\r\n      tilt: localTilt,\r\n      dur: Math.random() * 100 + 400,\r\n      x,\r\n      y,\r\n      group: groupID,\r\n      key: memberID,\r\n      globalX: largeNodesPos[groupRank].x + rotatedX,\r\n      globalY: largeNodesPos[groupRank].y + rotatedY,\r\n      globalTilt: parentTilt + localTilt,\r\n    };\r\n\r\n    nodes.push(node);\r\n\r\n    if (!groupToNodes[groupID]) groupToNodes[groupID] = [];\r\n\r\n    groupToNodes[groupID].push(node);\r\n  }\r\n\r\n  for (const groupKey of groupKeys) {\r\n    const { x, y, tilt } =\r\n      largeNodesPos[DATA_GROUPINGS[grouping][groupKey].rank];\r\n    groupNodes.push({\r\n      x,\r\n      y,\r\n      tilt,\r\n      key: groupKey,\r\n      height: smallNodesPhys.height,\r\n      nodes: groupToNodes[groupKey],\r\n    });\r\n  }\r\n\r\n  return {\r\n    nodes: nodes,\r\n    groups: groupNodes,\r\n    height: largeNodesPhys.height,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\n\r\nimport { LOD_1_LEVELS, LOD_1_RAD_PX, SPREAD_1_2 } from \"settings\";\r\n\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { clipEnds, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { genUUID, wrap } from \"utils/misc-utils\";\r\nimport { DROPLET_SHAPE } from \"utils/render-utils\";\r\nimport { circlet, gradientInit, gradientUpdate } from \"./render-utils\";\r\n\r\nexport function updateDropsSVG(\r\n  container,\r\n  waterdropGroups,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartGroupLoc = ({ x, y, tilt }) =>\r\n    `translate(${x}, ${y}) rotate(${tilt})`;\r\n  const getEndGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`;\r\n\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(largeDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartGroupLoc)\r\n    .each(function (node) {\r\n      d3.select(this)\r\n        .call(largeDropUpdate(node, transitionDelay))\r\n        .selectAll(\".small-drop\")\r\n        .on(\"click\", function (_, d) {\r\n          onClick && onClick(d);\r\n        })\r\n        .on(\"mouseenter\", function (_, d) {\r\n          onHover && onHover(d);\r\n        })\r\n        .on(\"mouseleave\", function (_, d) {\r\n          onUnhover && onUnhover(d);\r\n        });\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndGroupLoc);\r\n}\r\n\r\nexport function updateColorDrops(container, waterdropGroups, opacFn, color) {\r\n  const getGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`;\r\n\r\n  container\r\n    .selectAll(\".color-drop-group\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function ({ nodes }) {\r\n        d3.select(this).call((s) => {\r\n          s.attr(\"class\", \"color-drop-group\")\r\n            .selectAll(\".color-drop\")\r\n            .data(nodes)\r\n            .join(\"circle\")\r\n            .attr(\"class\", \"color-drop\")\r\n            .attr(\"r\", LOD_1_RAD_PX);\r\n        });\r\n      });\r\n    })\r\n    .attr(\"transform\", getGroupLoc)\r\n    .each(function () {\r\n      d3.select(this)\r\n        .selectAll(\".color-drop\")\r\n        .call((s) => {\r\n          s.attr(\"opacity\", ({ key }) => opacFn(key)).attr(\"fill\", color);\r\n        })\r\n        .attr(\"cx\", ({ x }) => x * SPREAD_1_2)\r\n        .attr(\"cy\", ({ y }) => y * SPREAD_1_2);\r\n    });\r\n}\r\n\r\nexport function getWaterdropGroups(keyArr, waterdrops, center) {\r\n  const groups = keyArr.map((k) => waterdrops.groups.find((g) => g.key === k));\r\n\r\n  const groupPositions = [];\r\n  const rad = groups[0].height * SPREAD_1_2 * 0.75;\r\n\r\n  for (let i = 0, n = groups.length; i < n; i++) {\r\n    const angle = ((Math.PI * 2) / n) * (i - 0.5) - Math.PI / 2;\r\n    groupPositions.push([\r\n      center[0] + Math.cos(angle) * rad,\r\n      center[1] + Math.sin(angle) * rad,\r\n    ]);\r\n  }\r\n\r\n  return {\r\n    groups,\r\n    groupPositions,\r\n  };\r\n}\r\n\r\nexport function calcLinesAndPositions(groupsObj, activeMinidropKey) {\r\n  const positions = [];\r\n  const nodes = [];\r\n  for (let i = 0; i < groupsObj.groups.length; i++) {\r\n    const group = groupsObj.groups[i];\r\n    const groupPos = groupsObj.groupPositions[i];\r\n\r\n    const node = group.nodes.find((n) => n.key === activeMinidropKey);\r\n\r\n    nodes.push(node);\r\n\r\n    positions.push([\r\n      node.x * SPREAD_1_2 + groupPos[0],\r\n      node.y * SPREAD_1_2 +\r\n        groupPos[1] -\r\n        dropCenterCorrection({ rad: LOD_1_RAD_PX }),\r\n    ]);\r\n  }\r\n\r\n  const lines = [];\r\n\r\n  for (let i = 0; i < positions.length; i++) {\r\n    const from = Array.from(positions[i]),\r\n      to = Array.from(positions[i + 1 == positions.length ? 0 : i + 1]);\r\n\r\n    clipEnds([from, to], LOD_1_RAD_PX * 2);\r\n\r\n    lines.push([from, to]);\r\n  }\r\n\r\n  return [positions, lines, nodes];\r\n}\r\n\r\nexport function updateLabelSVG(pos, labelText, normedTextSize) {\r\n  const [textX, textY] = pos;\r\n\r\n  const smallTextSize = normedTextSize / 15;\r\n  const largeTextSize = normedTextSize / 10;\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-label\")\r\n    .text(\"scenario\")\r\n    .attr(\"font-size\", smallTextSize)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-variable\")\r\n    .attr(\"font-size\", largeTextSize)\r\n    .text(labelText)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY);\r\n}\r\n\r\nexport function updateScenIndicatorsSVG(positions, lines) {\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".circlet\")\r\n    .data(positions)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"circlet\")\r\n    .call(circlet)\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\"r\", LOD_1_RAD_PX * 1.5)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"cx\", (d) => d[0])\r\n    .attr(\"cy\", (d) => d[1]);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".comp-line\")\r\n    .data(lines)\r\n    .join(\"path\")\r\n    .attr(\"class\", \"comp-line\")\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"d\", (d) => d3.line()(d));\r\n}\r\n\r\nfunction largeDropInit({ nodes, height }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"large-drop\");\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"stroke\", \"none\")\r\n      .attr(\"fill\", \"yellow\")\r\n      .attr(\"r\", LOD_1_RAD_PX * 2);\r\n\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"fancy-font water-group-label\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate({ nodes, key, height }, transitionDelay) {\r\n  return (s) => {\r\n    const getStartDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x}, ${y}) rotate(${tilt})`;\r\n    const getEndDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x * SPREAD_1_2}, ${y * SPREAD_1_2}) rotate(${tilt})`;\r\n\r\n    const baselinePos = {};\r\n\r\n    s.call(textUpdate(key, height))\r\n      .selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\"transform\", getStartDropLoc)\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n      })\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"transform\", getEndDropLoc);\r\n\r\n    s.select(\".highlight-circle\")\r\n      .attr(\"cx\", baselinePos.x)\r\n      .attr(\r\n        \"cy\",\r\n\r\n        baselinePos.y - dropCenterCorrection({ rad: LOD_1_RAD_PX })\r\n      )\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"cx\", baselinePos.x * SPREAD_1_2)\r\n      .attr(\r\n        \"cy\",\r\n\r\n        baselinePos.y * SPREAD_1_2 - dropCenterCorrection({ rad: LOD_1_RAD_PX })\r\n      );\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ levs }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const randId = `compare-grad-${genUUID()}`;\r\n\r\n    s.call(gradientInit(levs, randId));\r\n\r\n    s.append(\"path\").attr(\"d\", DROPLET_SHAPE).attr(\"class\", \"outline\");\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${randId})`);\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n    s.select(\".outline\").attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n    s.select(\".fill\").attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction textUpdate(key, height) {\r\n  return (s) => {\r\n    const t = s.select(\"text\");\r\n\r\n    t.selectAll(\"*\").remove();\r\n    const lines = wrap(\r\n      DESCRIPTIONS_DATA[key].display_name || DESCRIPTIONS_DATA[key].id\r\n    ).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      t.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", (height / 2) * SPREAD_1_2)\r\n        .attr(\"dy\", `${i * 1.2}em`)\r\n        .text(line);\r\n    });\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\n\r\nimport { SCENARIO_KEY_STRING, DELIV_KEY_STRING } from \"data/objectives-data\";\r\n\r\nexport function createInterps(obj_name, scen_name, data, maxDelivs) {\r\n  const delivs =\r\n    data[obj_name][SCENARIO_KEY_STRING][scen_name][DELIV_KEY_STRING];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\nexport function createInterpsFromDelivs(delivs, maxDelivs) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\n// TODO fix colors\r\nexport function calcDomLev(levs) {\r\n  levs = [1, ...levs, 0];\r\n\r\n  let mean = 0;\r\n  for (let i = 0; i < levs.length - 1; i++) {\r\n    const dif = levs[i] - levs[i + 1];\r\n    mean += (dif * (i - 1)) / (levs.length + 4);\r\n  }\r\n\r\n  return mean;\r\n}\r\n\r\nexport const SETT_NAME_SHORT = [\"D\", \"C\", \"P\", \"R\", \"M\"];\r\nexport const SETT_NAME_FULL = [\r\n  \"Demand\",\r\n  \"Carryover\",\r\n  \"Priority\",\r\n  \"Regs.\",\r\n  \"Min. Flow\",\r\n];\r\nexport const SETT_VAL_STEPS = [\r\n  [1, 0.9, 0.8, 0.7, 0.6].reverse(), // demand\r\n  [1.0, 1.2, 1.3], // carryover\r\n  [0, 1], // priority\r\n  [1, 2, 3, 4], // regs\r\n  [0, 0.4, 0.6, 0.7, 0.8], // minflow\r\n];\r\n\r\nexport const SETT_NUM_OPTS = {\r\n  demand: SETT_VAL_STEPS[0].length,\r\n  carryover: SETT_VAL_STEPS[1].length,\r\n  priority: SETT_VAL_STEPS[2].length,\r\n  regs: SETT_VAL_STEPS[3].length,\r\n  minflow: SETT_VAL_STEPS[4].length,\r\n};\r\n\r\nexport function deserialize(scenStr) {\r\n  let scenNum = parseInt(scenStr);\r\n\r\n  const minflow = scenNum % SETT_NUM_OPTS.minflow;\r\n  scenNum = (scenNum - minflow) / SETT_NUM_OPTS.minflow;\r\n\r\n  const regs = scenNum % SETT_NUM_OPTS.regs;\r\n  scenNum = (scenNum - regs) / SETT_NUM_OPTS.regs;\r\n\r\n  const priority = scenNum % SETT_NUM_OPTS.priority;\r\n  scenNum = (scenNum - priority) / SETT_NUM_OPTS.priority;\r\n\r\n  const carryover = scenNum % SETT_NUM_OPTS.carryover;\r\n  scenNum = (scenNum - carryover) / SETT_NUM_OPTS.carryover;\r\n\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demand = scenNum % SETT_NUM_OPTS.demand;\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n\r\n  return [demandReverse, carryover, priority, regs, minflow];\r\n}\r\n\r\nexport function serialize(demand, carryover, priority, regs, minflow) {\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n  let code = 0;\r\n  code += minflow;\r\n  code += SETT_NUM_OPTS.minflow * regs;\r\n  code += SETT_NUM_OPTS.regs * SETT_NUM_OPTS.minflow * priority;\r\n  code +=\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    carryover;\r\n  code +=\r\n    SETT_NUM_OPTS.carryover *\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    demandReverse;\r\n\r\n  const finalKey = `expl${d3.format(\"0>4\")(code)}`;\r\n\r\n  return finalKey;\r\n}\r\n","import { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { worldToScreen } from \"./render-utils\";\r\nimport { useStateRef } from \"./misc-utils\";\r\n\r\nexport function useDragPanels(viewTransform) {\r\n  const [panels, setPanels, panelsRef] = useStateRef([]);\r\n  const mouseDownInfo = useRef({});\r\n\r\n  useEffect(function initialize() {\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX !== undefined) {\r\n        mouseDownInfo.current = {};\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const onPanelDragStart = useCallback(function (e, { id }) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    e.preventDefault();\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }, []);\r\n\r\n  function getPanelStyle({ x, y, offsetX, offsetY }) {\r\n    const [screenX, screenY] = worldToScreen(x, y, viewTransform);\r\n    return {\r\n      left: `${screenX + offsetX}px`,\r\n      top: `${screenY + offsetY}px`,\r\n    };\r\n  }\r\n\r\n  return {\r\n    panels,\r\n    panelsRef,\r\n    setPanels,\r\n    onPanelDragStart,\r\n    getPanelStyle,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\n\r\nimport { LOD_1_LEVELS, LOD_1_RAD_PX, SPREAD_1_2 } from \"settings\";\r\n\r\nimport { dropCenterCorrection } from \"utils/math-utils\";\r\nimport { DROPLET_SHAPE, circlet } from \"utils/render-utils\";\r\nimport { gradientInit, gradientUpdate } from \"./render-utils\";\r\n\r\nexport function updateSmallDropSVG(\r\n  container,\r\n  waterdropGroup,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartLoc = ({ globalX, globalY, globalTilt }) =>\r\n    `translate(${globalX}, ${globalY}) rotate(${globalTilt})`;\r\n  const getEndLoc = ({ x, y, tilt }) =>\r\n    `translate(${waterdropGroup.x + x * SPREAD_1_2}, ${\r\n      waterdropGroup.y + y * SPREAD_1_2\r\n    }) rotate(${tilt})`;\r\n\r\n  const baselinePos = {};\r\n\r\n  container\r\n    .selectAll(\".small-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node, i) {\r\n        d3.select(this).call(smallDropInit(node, i));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartLoc)\r\n    .each(function (node) {\r\n      d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n    })\r\n    .on(\"click\", function (_, d) {\r\n      onClick && onClick(d);\r\n    })\r\n    .on(\"mouseenter\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\".circlet\").attr(\"display\", \"initial\");\r\n      onHover && onHover(d);\r\n    })\r\n    .on(\"mouseleave\", function (_, d) {\r\n      if (!d3.select(this).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this).select(\".circlet\").attr(\"display\", \"none\");\r\n      onUnhover && onUnhover(d);\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndLoc);\r\n\r\n  container\r\n    .select(\".highlight-circle\")\r\n    .attr(\"stroke\", \"none\")\r\n    .attr(\"fill\", \"yellow\")\r\n    .attr(\"r\", LOD_1_RAD_PX * 2)\r\n    .attr(\"cx\", waterdropGroup.x + baselinePos.x)\r\n    .attr(\r\n      \"cy\",\r\n      waterdropGroup.y +\r\n        baselinePos.y -\r\n        dropCenterCorrection({ rad: LOD_1_RAD_PX })\r\n    )\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"cx\", waterdropGroup.x + baselinePos.x * SPREAD_1_2)\r\n    .attr(\r\n      \"cy\",\r\n      waterdropGroup.y +\r\n        baselinePos.y * SPREAD_1_2 -\r\n        dropCenterCorrection({ rad: LOD_1_RAD_PX })\r\n    );\r\n}\r\n\r\nexport function updateColorDrops(container, waterdropGroup, opacFn, color) {\r\n  container\r\n    .selectAll(\".color-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"color-drop\")\r\n    .attr(\"r\", LOD_1_RAD_PX)\r\n    .attr(\"opacity\", ({ key }) => opacFn(key))\r\n    .attr(\"fill\", color)\r\n    .attr(\"cx\", ({ x }) => waterdropGroup.x + x * SPREAD_1_2)\r\n    .attr(\"cy\", ({ y }) => waterdropGroup.y + y * SPREAD_1_2);\r\n}\r\n\r\nfunction smallDropInit({ levs }, i) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"small-drop\");\r\n\r\n    s.call(gradientInit(levs, `drop-fill-${i}`));\r\n\r\n    s.append(\"path\").attr(\"d\", DROPLET_SHAPE).attr(\"class\", \"outline\");\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#drop-fill-${i})`);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"circlet\")\r\n      .call(circlet)\r\n      .attr(\"display\", \"none\")\r\n      .attr(\"cy\", -dropCenterCorrection({ rad: 1 }))\r\n      .attr(\"r\", 1.5);\r\n\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, id, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n    s.select(\".outline\").attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n    s.select(\".fill\").attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n\r\n    s.select(\".circlet\")\r\n      .attr(\"class\", null)\r\n      .attr(\"class\", \"circlet i\" + id);\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport Matter from \"matter-js\";\r\n\r\nimport { CIRC_RAD, DROP_HEIGHT } from \"./render-utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor((Math.sqrt(AREA / 3.14) * 2) / 2);\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes, reuse = false) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r));\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\nexport function percentToRatioFilled(p) {\r\n  p -= 0.0088;\r\n  return clamp(\r\n    (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326,\r\n    0,\r\n    1\r\n  );\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport function interp(x, a, b) {\r\n  return x * (b - a) + a;\r\n}\r\n\r\nexport function revInterp(t, a, b) {\r\n  return (t - a) / (b - a);\r\n}\r\n\r\nexport function distSq([x1, y1], [x2, y2]) {\r\n  return (x2 - x1) ** 2 + (y2 - y1) ** 2;\r\n}\r\n\r\nexport function dist([x1, y1], [x2, y2]) {\r\n  return Math.sqrt(distSq([x1, y1], [x2, y2]));\r\n}\r\n\r\nexport function getCenterDomRect(domRect) {\r\n  return [domRect.left + domRect.width / 2, domRect.top + domRect.height / 2];\r\n}\r\n\r\nexport function clipEnds([from, to], shortenByStart, shortenByEnd) {\r\n  const len = Math.sqrt((from[0] - to[0]) ** 2 + (from[1] - to[1]) ** 2);\r\n  const normed = [(to[0] - from[0]) / len, (to[1] - from[1]) / len];\r\n\r\n  if (shortenByEnd === undefined) shortenByEnd = shortenByStart;\r\n\r\n  from[0] += normed[0] * shortenByStart;\r\n  from[1] += normed[1] * shortenByStart;\r\n  to[0] -= normed[0] * shortenByEnd;\r\n  to[1] -= normed[1] * shortenByEnd;\r\n\r\n  return [from, to];\r\n}\r\n\r\nexport function dropRadToDropHeight(rad) {\r\n  return (1 + Math.SQRT2) * rad;\r\n}\r\n\r\nexport function dropCenterCorrection({ rad, height }) {\r\n  if (rad !== undefined) return dropRadToDropHeight(rad) * 0.08;\r\n  return height * 0.08;\r\n}\r\n\r\nexport function avgCoords(coords) {\r\n  return [d3.mean(coords, (c) => c[0]), d3.mean(coords, (c) => c[1])];\r\n}\r\n\r\nexport function rotatePoint(x, y, deg) {\r\n  const vec = new THREE.Vector3(x, y, 0).applyEuler(\r\n    new THREE.Euler(0, 0, toRadians(deg))\r\n  );\r\n  return [vec.x, vec.y];\r\n}\r\n\r\n// modifies arr!\r\nexport function rotatePoints(arr, deg) {\r\n  for (const a of arr) {\r\n    const newPoint = rotatePoint(a[0], a[1], deg);\r\n    a[0] = newPoint[0];\r\n    a[1] = newPoint[1];\r\n  }\r\n  return arr;\r\n}\r\n\r\n// https://stackoverflow.com/a/2450976\r\nexport function shuffle(array) {\r\n  let currentIndex = array.length;\r\n\r\n  // While there remain elements to shuffle...\r\n  while (currentIndex != 0) {\r\n    // Pick a remaining element...\r\n    let randomIndex = Math.floor(Math.random() * currentIndex);\r\n    currentIndex--;\r\n\r\n    // And swap it with the current element.\r\n    [array[currentIndex], array[randomIndex]] = [\r\n      array[randomIndex],\r\n      array[currentIndex],\r\n    ];\r\n  }\r\n\r\n  return array;\r\n}\r\n","// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    if (typeof v === \"function\")\r\n      _setState((curVal) => (stateRef.current = v(curVal)));\r\n    else _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n\r\nexport function isState(stateInfo, stateName) {\r\n  return stateInfo && stateInfo.state === stateName;\r\n}\r\n\r\nexport function wrap(s) {\r\n  return s.replace(/(?![^\\n]{1,15}$)([^\\n]{1,15})\\s/g, \"$1\\n\");\r\n}\r\n\r\nexport function genUUID() {\r\n  return Math.floor(Math.random() * 1e9);\r\n}\r\n\r\nexport function arrRemove(arr, item) {\r\n  let idx;\r\n  if (typeof item === \"function\") {\r\n    idx = arr.findIndex(item);\r\n  } else {\r\n    idx = arr.indexOf(item);\r\n  }\r\n  if (idx !== -1) arr.splice(idx, 1);\r\n  return arr;\r\n}\r\n\r\nexport function copyCoords(arr) {\r\n  return arr.map((a) => Array.from(a));\r\n}\r\n","import { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport * as d3 from \"d3\";\r\nimport { LOD_1_LEVELS } from \"settings\";\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport const CIRC_RAD = Math.SQRT1_2;\r\nexport const DROP_RAD = 1;\r\nexport const CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nexport const DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = (CIRC_RAD + DROP_RAD / 2) / DROP_HEIGHT;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2, subdivs = 10) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 1 / subdivs;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function circlet(s) {\r\n  s.attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke\", \"orange\")\r\n    .attr(\"stroke-dasharray\", 3)\r\n    .attr(\"stroke-width\", 3)\r\n    .attr(\"vector-effect\", \"non-scaling-stroke\");\r\n}\r\n\r\nexport function showElems(elemStr, container, displayVal) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", displayVal || \"block\");\r\n}\r\n\r\nexport function hideElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", \"none\");\r\n}\r\n\r\nexport function removeElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).remove();\r\n}\r\n\r\nexport function gradientInit(levs, id) {\r\n  return (s) => {\r\n    const stops = s\r\n      .append(\"defs\")\r\n      .append(\"linearGradient\")\r\n      .attr(\"id\", id)\r\n      .attr(\"x1\", \"0%\")\r\n      .attr(\"x2\", \"0%\")\r\n      .attr(\"y1\", \"0%\")\r\n      .attr(\"y2\", \"100%\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n    levs.forEach((_, i) => {\r\n      for (let j = 0; j < 2; j++) {\r\n        stops\r\n          .append(\"stop\")\r\n          .attr(\"stop-color\", interpolateWatercolorBlue(i / LOD_1_LEVELS));\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nexport function gradientUpdate(levs, maxLev) {\r\n  return (s) => {\r\n    s.selectAll(\"stop\").each(function (_, i) {\r\n      // first stop is at 0\r\n      if (i === 0) {\r\n        d3.select(this).attr(\"offset\", `0%`);\r\n        return;\r\n      }\r\n\r\n      // last stop is at 100\r\n      if (i === (levs.length + 1) * 2 - 1) {\r\n        d3.select(this).attr(\"offset\", `100%`);\r\n        return;\r\n      }\r\n\r\n      let valOffset = Math.floor((i - 1) / 2);\r\n\r\n      d3.select(this).attr(\r\n        \"offset\",\r\n        `${(1 - levs[valOffset] / maxLev) * 100}%`\r\n      );\r\n    });\r\n  };\r\n}\r\n\r\nexport function worldToScreen(x, y, camTransform) {\r\n  return [\r\n    x * camTransform.k + camTransform.x,\r\n    y * camTransform.k + camTransform.y,\r\n  ];\r\n}\r\n\r\nexport function screenToWorld(x, y, camTransform) {\r\n  return [\r\n    (x - camTransform.x) / camTransform.k,\r\n    (y - camTransform.y) / camTransform.k,\r\n  ];\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\n\r\nimport { interpolateWatercolorBlue, ticksExact } from \"bucket-lib/utils\";\r\nimport {\r\n  DELIV_KEY_STRING,\r\n  MAX_DELIVS,\r\n  OBJECTIVES_DATA,\r\n  SCENARIO_KEY_STRING,\r\n} from \"data/objectives-data\";\r\nimport yearlyData from \"data/yearly.json\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { LOD_1_LEVELS } from \"settings\";\r\nimport { SPREAD_1_2 } from \"settings\";\r\nimport { DROPLET_SHAPE, circlet, hideElems, showElems } from \"./render-utils\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\nimport { avgCoords, dropCenterCorrection } from \"./math-utils\";\r\nimport { calcLinesAndPositions, getWaterdropGroups } from \"./compareview-utils\";\r\nimport { genUUID, wrap } from \"./misc-utils\";\r\nimport { deserialize, serialize } from \"./data-utils\";\r\nimport { gradientUpdate } from \"./render-utils\";\r\nimport { gradientInit } from \"./render-utils\";\r\n\r\nexport const DATE_START = 1921;\r\nexport const INTERP_COLOR = d3.interpolateRgbBasis([\r\n  \"#F2F5FB\",\r\n  \"#D0DDEB\",\r\n  \"#7B9BC0\",\r\n  \"#4F739F\",\r\n  \"#112A57\",\r\n]);\r\n\r\nexport const DEFAULT_OBJECTIVE = \"DEL_CVP_PAG_N\";\r\nexport const DEFAULT_SCENARIO = deserialize(\"0000\");\r\nexport const DEFAULT_DELIVS =\r\n  OBJECTIVES_DATA[DEFAULT_OBJECTIVE][SCENARIO_KEY_STRING][\r\n    serialize(...DEFAULT_SCENARIO)\r\n  ][DELIV_KEY_STRING];\r\n\r\nexport const COMP_OBJECTIVE = \"DEL_CVP_PRF_S\";\r\n\r\nexport const VARIATIONS = [\r\n  deserialize(\"0020\"), // change priority\r\n  deserialize(\"0080\"), // increase carryover\r\n  deserialize(\"0480\"), // decrease demand\r\n  deserialize(\"0004\"), // increase minflow\r\n];\r\n\r\nexport const VARIATIONS_DELIVS = VARIATIONS.map(\r\n  (vars) =>\r\n    OBJECTIVES_DATA[DEFAULT_OBJECTIVE][SCENARIO_KEY_STRING][serialize(...vars)][\r\n      DELIV_KEY_STRING\r\n    ]\r\n);\r\n\r\nexport const VARIATIONS_INTERPERS = VARIATIONS_DELIVS.map((varDelivs) =>\r\n  d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, varDelivs.length))\r\n    .range(\r\n      varDelivs\r\n        .map((v) => v / MAX_DELIVS)\r\n        .sort()\r\n        .reverse()\r\n    )\r\n    .clamp(true)\r\n);\r\n\r\nexport const DEFAULT_INTERPER = d3\r\n  .scaleLinear()\r\n  .domain(ticksExact(0, 1, DEFAULT_DELIVS.length))\r\n  .range(\r\n    DEFAULT_DELIVS.map((v) => v / MAX_DELIVS)\r\n      .sort()\r\n      .reverse()\r\n  )\r\n  .clamp(true);\r\n\r\nexport const BAR_CHART_WIDTH = 800,\r\n  BAR_CHART_HEIGHT = 400;\r\n\r\nexport const BAR_CHART_MARGIN = { top: 40, right: 30, bottom: 40, left: 60 };\r\n\r\nexport function useTutorialState() {\r\n  const [userGoal, setUserGoal] = useState(200);\r\n  const [bucketInterper, setBucketInterper] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [dropInterper, setDropInterper] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [variationInterpers, setVariationInterpers] = useState(() =>\r\n    VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n  );\r\n\r\n  return {\r\n    userGoal,\r\n    setUserGoal,\r\n    bucketInterper,\r\n    setBucketInterper,\r\n    dropInterper,\r\n    setDropInterper,\r\n    variationInterpers,\r\n    setVariationInterpers,\r\n  };\r\n}\r\n\r\nexport function useTutorialGraph() {\r\n  const d3Refs = useRef({});\r\n\r\n  function initGraphArea() {\r\n    const svgGroup = d3\r\n      .select(\"#tut-bar-graph\")\r\n      .attr(\r\n        \"width\",\r\n        BAR_CHART_WIDTH + BAR_CHART_MARGIN.left + BAR_CHART_MARGIN.right\r\n      )\r\n      .attr(\r\n        \"height\",\r\n        BAR_CHART_HEIGHT + BAR_CHART_MARGIN.top + BAR_CHART_MARGIN.bottom\r\n      )\r\n      .attr(\"opacity\", 1)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-group\")\r\n      .attr(\r\n        \"transform\",\r\n        `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n      );\r\n\r\n    const dataDescending = yearlyData[DEFAULT_OBJECTIVE].map(\r\n      (val, placeFromLeft) => ({\r\n        val,\r\n        placeFromLeft,\r\n        year: placeFromLeft + 1,\r\n      })\r\n    ).sort((a, b) => b.val - a.val);\r\n\r\n    const x = d3\r\n      .scaleBand()\r\n      .domain(dataDescending.map(({ year }) => year).sort((a, b) => a - b))\r\n      .range([0, BAR_CHART_WIDTH])\r\n      .padding(0.4);\r\n    const y = d3\r\n      .scaleLinear()\r\n      .domain([0, MAX_DELIVS])\r\n      .range([BAR_CHART_HEIGHT, 0]);\r\n\r\n    const xaxis = d3\r\n      .axisBottom(x)\r\n      .tickSize(0)\r\n      .tickFormat((d) => `year ${d}`)\r\n      .tickValues(x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0));\r\n\r\n    svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n    svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n    svgGroup\r\n      .select(\".anim-xaxis\")\r\n      .attr(\"opacity\", 1)\r\n      .attr(\"transform\", `translate(0, ${BAR_CHART_HEIGHT})`)\r\n      .call(xaxis)\r\n      .selectAll(\"text\")\r\n      .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n      .style(\"text-anchor\", \"end\");\r\n    svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n    d3Refs.current = { x, xaxis, dataDescending };\r\n  }\r\n\r\n  function initBars() {\r\n    const { x, dataDescending } = d3Refs.current;\r\n    const y = d3\r\n      .scaleLinear()\r\n      .domain([0, MAX_DELIVS])\r\n      .range([BAR_CHART_HEIGHT, 0]);\r\n\r\n    d3.select(\"#tut-bar-graph .svg-group\")\r\n      .selectAll(\".bars\")\r\n      .data(dataDescending, (d) => d.placeFromLeft)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bars\")\r\n      .attr(\"x\", (d) => x(d.year))\r\n      .attr(\"y\", BAR_CHART_HEIGHT)\r\n      .attr(\"width\", x.bandwidth())\r\n      .attr(\"height\", 0)\r\n      .attr(\"opacity\", 1)\r\n      .attr(\"fill\", \"steelblue\")\r\n      .transition()\r\n      .duration(500)\r\n      .delay((d) => d.placeFromLeft * 10)\r\n      .attr(\"y\", (d) => y(d.val))\r\n      .attr(\"height\", (d) => BAR_CHART_HEIGHT - y(d.val));\r\n  }\r\n\r\n  async function condenseBars() {\r\n    const { x, xaxis, dataDescending } = d3Refs.current;\r\n    const newWidth = BAR_CHART_WIDTH / 8;\r\n    const svgGroup = d3.select(\"#tut-bar-graph .svg-group\");\r\n\r\n    svgGroup.select(\".anim-xaxis\").call(xaxis.tickFormat(\"\"));\r\n\r\n    const bars = svgGroup.selectAll(\".bars\");\r\n\r\n    await bars\r\n      .style(\"mix-blend-mode\", \"multiply\")\r\n      .transition()\r\n      .duration(500)\r\n      .attr(\"opacity\", 0.05)\r\n      .transition()\r\n      .delay(\r\n        (d) =>\r\n          100 + (1 - (1 - d.placeFromLeft / dataDescending.length) ** 4) * 1000\r\n      )\r\n      .duration(500)\r\n      .attr(\"width\", newWidth)\r\n      .attr(\"x\", BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n      .end();\r\n\r\n    svgGroup\r\n      .select(\".anim-xaxis\")\r\n      .transition()\r\n      .transition(500)\r\n      .attr(\"transform\", `translate(0, ${BAR_CHART_HEIGHT + 50})`)\r\n      .attr(\"opacity\", 0);\r\n\r\n    bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n    svgGroup\r\n      .transition()\r\n      .delay(500)\r\n      .attr(\r\n        \"transform\",\r\n        `translate(${\r\n          BAR_CHART_MARGIN.left + BAR_CHART_WIDTH / 2 - newWidth / 2\r\n        },${BAR_CHART_MARGIN.top})`\r\n      );\r\n  }\r\n\r\n  return {\r\n    initGraphArea,\r\n    initBars,\r\n    condenseBars,\r\n  };\r\n}\r\n\r\nexport function useTutorialComparer() {\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const groupsRef = useRef();\r\n  const camCentersRef = useRef({});\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines] = calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop\r\n        );\r\n\r\n        updateLabel(avgCoords(positions));\r\n        updateScenIndicators(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  function initComparer(waterdrops, camera) {\r\n    groupsRef.current = getWaterdropGroups(\r\n      [DEFAULT_OBJECTIVE, COMP_OBJECTIVE],\r\n      waterdrops,\r\n      [0, 0]\r\n    );\r\n\r\n    const farHeight = waterdrops.groups[0].height * 2 * SPREAD_1_2 * 0.75;\r\n    const k = camera.height / farHeight;\r\n\r\n    let x = camera.width / 2;\r\n    let y = camera.height / 2;\r\n\r\n    const camMidpoint = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    x = -(groupsRef.current.groupPositions[0][0] * k) + camera.width / 2;\r\n    y = groupsRef.current.groupPositions[0][1] * k + camera.height / 2;\r\n\r\n    const camFirstDrop = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    camCentersRef.current.firstDrop = camFirstDrop;\r\n    camCentersRef.current.midpoint = camMidpoint;\r\n\r\n    const container = d3\r\n      .select(\"#comparer-graphics\")\r\n      .attr(\"width\", window.innerWidth)\r\n      .attr(\"height\", window.innerHeight)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-group\")\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(camFirstDrop.x, camFirstDrop.y)\r\n          .scale(camFirstDrop.k)\r\n      );\r\n\r\n    const indicatorGroup = container\r\n      .append(\"g\")\r\n      .attr(\"class\", \"indicator-group\");\r\n\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-variable\");\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    updateDropsSVG(container, groupsRef.current, {\r\n      onHover: (d) => {\r\n        setActiveMinidrop(d.key);\r\n      },\r\n    });\r\n\r\n    setActiveMinidrop(\"expl0000\");\r\n    hideElems(`.large-drop.${COMP_OBJECTIVE}, .indicator-group`, container);\r\n  }\r\n\r\n  function updateLabel(pos) {\r\n    const [textX, textY] = pos;\r\n\r\n    const smallTextSize =\r\n      (groupsRef.current.groups[0].height * SPREAD_1_2) / 15;\r\n    const largeTextSize =\r\n      (groupsRef.current.groups[0].height * SPREAD_1_2) / 10;\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-label\")\r\n      .text(\"scenario\")\r\n      .attr(\"font-size\", smallTextSize)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-variable\")\r\n      .attr(\"font-size\", largeTextSize)\r\n      .text(activeMinidrop.slice(4))\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY);\r\n  }\r\n\r\n  function updateScenIndicators(positions, lines) {\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".circlet\")\r\n      .data(positions)\r\n      .join(\"circle\")\r\n      .attr(\"class\", \"circlet\")\r\n      .call(circlet)\r\n      .attr(\"r\", LOD_1_RAD_PX * 1.5)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"cx\", (d) => d[0])\r\n      .attr(\"cy\", (d) => d[1]);\r\n\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".comp-line\")\r\n      .data(lines)\r\n      .join(\"path\")\r\n      .attr(\"class\", \"comp-line\")\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"d\", (d) => d3.line()(d));\r\n  }\r\n\r\n  function introDrop2() {\r\n    const container = d3.select(\"#comparer-graphics\");\r\n\r\n    container\r\n      .select(\".svg-group\")\r\n      .transition()\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(\r\n            camCentersRef.current.midpoint.x,\r\n            camCentersRef.current.midpoint.y\r\n          )\r\n          .scale(camCentersRef.current.midpoint.k)\r\n      );\r\n\r\n    showElems(`.large-drop.${COMP_OBJECTIVE}, .indicator-group`, container);\r\n  }\r\n\r\n  return { initComparer, introDrop2 };\r\n}\r\n\r\nexport const DROP_VARIATIONS = [\r\n  {\r\n    idx: 0,\r\n    scen: \"0020\",\r\n    clas: \"drop1\",\r\n    desc: \"change priority\",\r\n  },\r\n  {\r\n    idx: 1,\r\n    scen: \"0080\",\r\n    clas: \"drop2\",\r\n    desc: \"increase carryover\",\r\n  },\r\n  {\r\n    idx: 2,\r\n    scen: \"0480\",\r\n    clas: \"drop3\",\r\n    desc: \"decrease demand\",\r\n  },\r\n  {\r\n    idx: 3,\r\n    scen: \"0004\",\r\n    clas: \"drop4\",\r\n    desc: \"increase minimum flow\",\r\n  },\r\n];\r\n\r\nfunction updateDropsSVG(container, waterdropGroups, { onHover }) {\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (group, i) {\r\n        d3.select(this).call(\r\n          largeDropInit(group, waterdropGroups.groupPositions[i])\r\n        );\r\n      });\r\n    })\r\n    .attr(\"transform\", (_, i) => {\r\n      const groupPos = waterdropGroups.groupPositions[i];\r\n      return `translate(${groupPos[0]}, ${groupPos[1]})`;\r\n    })\r\n    .each(function (group) {\r\n      d3.select(this)\r\n        .call(largeDropUpdate(group))\r\n        .selectAll(\".small-drop\")\r\n        .on(\"mouseenter\", function (e, d) {\r\n          onHover && onHover(d);\r\n        });\r\n    });\r\n}\r\n\r\nfunction largeDropInit({ nodes, height, key }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"large-drop \" + key);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"stroke\", \"none\")\r\n      .attr(\"fill\", \"yellow\")\r\n      .attr(\"r\", LOD_1_RAD_PX * 2);\r\n\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"fancy-font water-group-label\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ key, levs, x, y }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const randId = `tut-grad-${genUUID()}`;\r\n\r\n    s.call(gradientInit(levs, randId));\r\n\r\n    if (key === \"expl0000\") {\r\n      d3.select(s.node().parentNode)\r\n        .select(\".highlight-circle\")\r\n        .attr(\"cx\", x * SPREAD_1_2)\r\n        .attr(\r\n          \"cy\",\r\n          y * SPREAD_1_2 - dropCenterCorrection({ rad: LOD_1_RAD_PX })\r\n        );\r\n    }\r\n\r\n    s.append(\"path\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"class\", \"outline\")\r\n      .attr(\"transform\", `scale(${LOD_1_RAD_PX * 0.95})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${randId})`)\r\n      .attr(\"transform\", `scale(${LOD_1_RAD_PX})`);\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate({ nodes, key, height }) {\r\n  return (s) => {\r\n    const t = s.select(\"text\");\r\n\r\n    t.selectAll(\"*\").remove();\r\n\r\n    const lines = wrap(\r\n      DESCRIPTIONS_DATA[key].display_name || DESCRIPTIONS_DATA[key].id\r\n    ).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      t.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", (height / 2) * SPREAD_1_2)\r\n        .attr(\"dy\", `${i}em`)\r\n        .text(line);\r\n    });\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\r\n        \"transform\",\r\n        ({ x, y }) => `translate(${x * SPREAD_1_2}, ${y * SPREAD_1_2})`\r\n      )\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ levs, maxLev }) {\r\n  return (s) => {\r\n    s.call(gradientUpdate(levs, maxLev));\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport {\r\n  CALIFORNIA_CENTER,\r\n  CALIFORNIA_OUTLINE,\r\n  SPATIAL_DATA,\r\n} from \"data/spatial-data\";\r\nimport { GROUP_HOVER_AREA_FACTOR } from \"settings\";\r\n\r\nimport { dist, dropCenterCorrection, getCenterDomRect } from \"utils/math-utils\";\r\nimport { wrap } from \"utils/misc-utils\";\r\nimport { circlet } from \"utils/render-utils\";\r\n\r\nexport function drawMinimapSVG() {\r\n  const width = 200,\r\n    height = 250;\r\n\r\n  const minimap = d3\r\n    .select(\"#minimap\")\r\n    .attr(\"width\", width)\r\n    .attr(\"height\", height);\r\n\r\n  const proj = d3\r\n    .geoMercator()\r\n    .scale(1000)\r\n    .center(CALIFORNIA_CENTER)\r\n    .translate([width / 2, height / 2]);\r\n\r\n  const lineGeom = [\r\n    ...SPATIAL_DATA.features.filter((f) => f.geometry.type === \"MultiPolygon\"),\r\n    CALIFORNIA_OUTLINE,\r\n  ];\r\n  const pointGeom = SPATIAL_DATA.features.filter(\r\n    (f) => f.geometry.type === \"MultiPoint\"\r\n  );\r\n\r\n  minimap\r\n    .selectAll(\"path\")\r\n    .data(lineGeom)\r\n    .join(\"path\")\r\n    .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"stroke\", (d) =>\r\n      d.properties.CalLiteID ? \"transparent\" : \"lightgray\"\r\n    )\r\n    .attr(\"stroke-width\", 1)\r\n    .attr(\"fill\", \"transparent\");\r\n\r\n  minimap\r\n    .selectAll(\"circle\")\r\n    .data(pointGeom)\r\n    .join(\"circle\")\r\n    .each(function (d) {\r\n      const s = d3.select(this);\r\n\r\n      const [x, y] = proj(d.geometry.coordinates[0]);\r\n\r\n      s.attr(\"cx\", x);\r\n      s.attr(\"cy\", y);\r\n    })\r\n    .attr(\"r\", 2)\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"fill\", \"transparent\");\r\n}\r\n\r\nexport function updateLargeDropSVG(\r\n  container,\r\n  waterdrops,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdrops.groups)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(interactorsInit);\r\n    })\r\n    .each(interactorsUpdate)\r\n    .style(\"display\", \"initial\")\r\n    .attr(\"transform\", dropTransform)\r\n    .select(\".hover-capture\")\r\n    .on(\"click\", function (_, d) {\r\n      onClick && onClick(d);\r\n    })\r\n    .on(\"mouseenter\", function (_, d) {\r\n      if (!d3.select(this.parentNode).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this.parentNode).select(\"circle\").attr(\"display\", \"initial\");\r\n      onHover && onHover(d);\r\n    })\r\n    .on(\"mouseleave\", function (_, d) {\r\n      if (!d3.select(this.parentNode).select(\".circlet\").classed(\"active\"))\r\n        d3.select(this.parentNode).select(\"circle\").attr(\"display\", \"none\");\r\n      onUnhover && onUnhover(d);\r\n    });\r\n}\r\n\r\nexport function fontSizer(transformInfo, camera, waterdropsHeight) {\r\n  return function () {\r\n    const tNode = d3.select(this).node();\r\n\r\n    const [posx, posy] = getCenterDomRect(tNode.getBoundingClientRect());\r\n\r\n    const width = ((tNode.getBBox().width * camera.height) / camera.far) * 8,\r\n      height = ((tNode.getBBox().height * camera.height) / camera.far) * 10;\r\n\r\n    const dis = dist(\r\n      [posx, posy],\r\n      [transformInfo.mouseX, transformInfo.mouseY]\r\n    );\r\n\r\n    d3.select(this).attr(\r\n      \"font-size\",\r\n      getFontSize(dis, transformInfo.zoom, camera.height, waterdropsHeight)\r\n    );\r\n\r\n    d3.select(this.parentNode.parentNode)\r\n      .select(\"image\")\r\n      .attr(\"x\", -width / 2)\r\n      .attr(\"y\", -height / 2)\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n  };\r\n}\r\n\r\nexport function fadeOutDrops(dropsMesh, scene, startOpac, duration) {\r\n  const t = d3.timer((elapsed) => {\r\n    const et = Math.min(1, elapsed / duration);\r\n\r\n    dropsMesh.updateVisibility(1 - et);\r\n    dropsMesh.updateOutlineVisibility(startOpac * (1 - et));\r\n\r\n    if (et >= 1) {\r\n      t.stop();\r\n      dropsMesh.remove(scene);\r\n    }\r\n  });\r\n}\r\n\r\nfunction interactorsInit() {\r\n  const s = d3.select(this);\r\n\r\n  s.append(\"g\")\r\n    .attr(\"class\", \"circlet\")\r\n    .append(\"circle\")\r\n    .call(circlet)\r\n    .attr(\"display\", \"none\")\r\n    .attr(\"r\", 1);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"hover-capture\")\r\n    .attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke-width\", 0)\r\n    .attr(\"r\", 0.8);\r\n\r\n  const textGroup = s.append(\"g\").attr(\"pointer-events\", \"none\");\r\n  textGroup\r\n    .append(\"image\")\r\n    .attr(\"href\", \"glow.png\")\r\n    .attr(\"preserveAspectRatio\", \"none\")\r\n    .attr(\"opacity\", 0.8);\r\n  textGroup\r\n    .append(\"text\")\r\n    .attr(\"class\", \"fancy-font\")\r\n    .attr(\"text-anchor\", \"middle\")\r\n    .attr(\"font-size\", 0);\r\n}\r\n\r\nfunction interactorsUpdate(d) {\r\n  d3.select(this)\r\n    .select(\".circlet\")\r\n    .attr(\"class\", null)\r\n    .attr(\"class\", \"circlet \" + d.key);\r\n  d3.select(this).select(\"text\").call(textUpdate(d));\r\n}\r\n\r\nfunction textUpdate(d) {\r\n  return function (s) {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = wrap(\r\n      DESCRIPTIONS_DATA[d.key].display_name || DESCRIPTIONS_DATA[d.key].id\r\n    ).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      s.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", `${-lines.length / 2 + 0.5}em`)\r\n        .attr(\"dy\", `${i}em`)\r\n        .text(line);\r\n    });\r\n  };\r\n}\r\n\r\nfunction dropTransform({ x, y, height }) {\r\n  return `translate(${x}, ${y - dropCenterCorrection({ height })}) scale(${\r\n    height * GROUP_HOVER_AREA_FACTOR\r\n  })`;\r\n}\r\n\r\nfunction getFontSize(d, transformZoom, cameraHeight, waterdropsHeight) {\r\n  const MAX_RAD = window.innerHeight / 9;\r\n\r\n  const zoomRel = cameraHeight / waterdropsHeight / transformZoom;\r\n\r\n  const absFontSize = (_d) =>\r\n    _d > MAX_RAD\r\n      ? 0\r\n      : d3.scaleLinear().domain([0, MAX_RAD]).range([1, 0.4]).clamp(true)(_d);\r\n\r\n  return absFontSize(d * zoomRel) * Math.min(zoomRel, 0.4);\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingStickers from \"components/SceneSettingStickers\";\r\nimport { FLATTENED_DATA, KEY_SETTINGS_MAP } from \"data/objectives-data\";\r\nimport { SPREAD_1_2 } from \"settings\";\r\n\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { hideElems, removeElems, showElems } from \"utils/render-utils\";\r\n\r\nimport {\r\n  calcLinesAndPositions,\r\n  getWaterdropGroups,\r\n  updateColorDrops,\r\n  updateDropsSVG,\r\n  updateLabelSVG,\r\n  updateScenIndicatorsSVG,\r\n} from \"utils/compareview-utils\";\r\nimport { deserialize } from \"utils/data-utils\";\r\nimport { useDragPanels } from \"utils/drag-panels\";\r\n\r\nexport default function CompareView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n    camera,\r\n    goals,\r\n    setGoals,\r\n    addZoomHandler,\r\n  } = useContext(AppContext);\r\n\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n\r\n  const groupsRef = useRef();\r\n  const centerRef = useRef();\r\n\r\n  const getScreenDropHeight = () =>\r\n    groupsRef.current.groups[0].height * SPREAD_1_2;\r\n\r\n  useEffect(function initialize() {\r\n    const container = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"compare-group\");\r\n\r\n    container.append(\"text\").attr(\"id\", \"member-variable\");\r\n    container.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"CompareView\")) {\r\n        const container = d3.select(\"#compare-group\");\r\n\r\n        const { viewCenter, transitionDuration } = state;\r\n\r\n        centerRef.current = viewCenter;\r\n\r\n        groupsRef.current = getWaterdropGroups(\r\n          activeWaterdrops,\r\n          waterdrops,\r\n          viewCenter\r\n        );\r\n\r\n        updateDropsSVG(container, groupsRef.current, transitionDuration / 5, {\r\n          onHover: (d) => {\r\n            setActiveMinidrop({ key: d.key });\r\n          },\r\n        });\r\n\r\n        hideElems(\".water-group-label\");\r\n\r\n        setTimeout(() => {\r\n          setActiveMinidrop({ key: groupsRef.current.groups[0].nodes[0].key });\r\n          showElems(\r\n            \"#member-variable, #member-label, .water-group-label\",\r\n            container\r\n          );\r\n          showElems(\".comp-settings\", d3, \"flex\");\r\n        }, transitionDuration + 500);\r\n\r\n        setGoBack(() => () => {\r\n          setState({ state: \"WideView\" });\r\n\r\n          resetCamera();\r\n        });\r\n\r\n        setCamTransform(camera.curTransform);\r\n\r\n        return function exitState() {\r\n          removeElems(\".large-drop, .circlet, .comp-line\", container);\r\n\r\n          hideElems(\"#member-variable, #member-label\", container);\r\n          hideElems(\".comp-settings\");\r\n\r\n          setPanels([]);\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines, nodes] = calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop.key\r\n        );\r\n\r\n        setPanels(makePanelsFromNodes(nodes));\r\n        updateLabelSVG(\r\n          avgCoords(positions),\r\n          activeMinidrop.key.slice(4),\r\n          getScreenDropHeight()\r\n        );\r\n        updateScenIndicatorsSVG(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#compare-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop-group\", container);\r\n        showElems(\".large-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      updateColorDrops(\r\n        container,\r\n        groupsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop-group\", container);\r\n      hideElems(\".large-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function makePanelsFromNodes(nodes) {\r\n    return (p) => {\r\n      return nodes.map((n, i) => {\r\n        let ox = 0,\r\n          oy = 0;\r\n\r\n        if (p[i]) {\r\n          ox = p[i].offsetX;\r\n          oy = p[i].offsetY;\r\n        }\r\n\r\n        const [x, y, isLeft] = getIdealGroupPos(\r\n          groupsRef.current.groupPositions[i],\r\n          centerRef.current\r\n        );\r\n\r\n        return {\r\n          text: n.key,\r\n          x,\r\n          y,\r\n          id: groupsRef.current.groups[i].key,\r\n          nodeID: n.id,\r\n          isLeft,\r\n          offsetX: ox,\r\n          offsetY: oy,\r\n        };\r\n      });\r\n    };\r\n  }\r\n\r\n  function getIdealGroupPos([x, y], [centerX, centerY]) {\r\n    let newX = x,\r\n      newY = y;\r\n\r\n    const correctionX = groupsRef.current.groups[0].height * 2;\r\n\r\n    if (newX < centerX) newX -= correctionX;\r\n    else newX += correctionX;\r\n\r\n    return [newX, newY, newX < centerX];\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {activeMinidrop && (\r\n        <SceneSettingStickers\r\n          settings={deserialize(activeMinidrop.key.slice(4))}\r\n          setColorSetting={setColorSetting}\r\n        />\r\n      )}\r\n      {panels.map(({ x, y, id, isLeft, offsetX, offsetY, nodeID }, i) => (\r\n        <div\r\n          className={\"panel compare-panel\" + (isLeft ? \" left\" : \"\")}\r\n          key={i}\r\n          style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n          onMouseDown={(e) => onPanelDragStart(e, { id })}\r\n        >\r\n          <DotHistogram\r\n            width={300}\r\n            height={200}\r\n            data={FLATTENED_DATA[nodeID].deliveries}\r\n            goal={goals[id]}\r\n            setGoal={(newGoal) => {\r\n              setGoals((g) => {\r\n                g[id] = newGoal;\r\n                return { ...g };\r\n              });\r\n            }}\r\n          />\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingSubcard from \"components/SceneSettingSubcard\";\r\nimport { FLATTENED_DATA, KEY_SETTINGS_MAP } from \"data/objectives-data\";\r\nimport { SPREAD_1_2 } from \"settings\";\r\n\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { updateColorDrops, updateSmallDropSVG } from \"utils/examineview-utils\";\r\nimport { arrRemove, isState, useStateRef } from \"utils/misc-utils\";\r\nimport {\r\n  hideElems,\r\n  removeElems,\r\n  screenToWorld,\r\n  showElems,\r\n  worldToScreen,\r\n} from \"utils/render-utils\";\r\nimport { deserialize } from \"utils/data-utils\";\r\nimport { useDragPanels } from \"utils/drag-panels\";\r\nimport { clipEnds, dist } from \"utils/math-utils\";\r\nimport { radToDeg } from \"three/src/math/MathUtils\";\r\nimport { LOD_1_RAD_PX } from \"settings\";\r\n\r\nexport default function ExamineView() {\r\n  const {\r\n    state,\r\n    setState,\r\n    setGoBack,\r\n    resetCamera,\r\n    activeWaterdrops,\r\n    waterdrops,\r\n    camera,\r\n    addZoomHandler,\r\n    goals,\r\n    setGoals,\r\n  } = useContext(AppContext);\r\n\r\n  const activeMinidropsRef = useRef([]);\r\n  const curMinidropsRef = useRef(null);\r\n\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform, camTransformRef] = useStateRef(\r\n    d3.zoomIdentity\r\n  );\r\n  const { panels, panelsRef, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n  const [hoveredCard, setHoveredCard] = useState(null);\r\n  const removePreviewRef = useRef(null);\r\n\r\n  useEffect(function initialize() {\r\n    const svgArea = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"examine-group\");\r\n\r\n    svgArea.append(\"circle\").attr(\"class\", \"highlight-circle\");\r\n\r\n    svgArea.append(\"path\").attr(\"class\", \"connect-line\");\r\n\r\n    addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"ExamineView\")) {\r\n        const transitionDelay = state.transitionDuration;\r\n        const container = d3.select(\"#examine-group\");\r\n        curMinidropsRef.current = waterdrops.groups.find(\r\n          (g) => g.key === activeWaterdrops[0]\r\n        );\r\n\r\n        updateSmallDropSVG(\r\n          container,\r\n          curMinidropsRef.current,\r\n          transitionDelay / 2,\r\n          {\r\n            onClick: updateActiveMinidrops,\r\n            onHover: hoverDrop,\r\n            onUnhover: unhoverDrop,\r\n          }\r\n        );\r\n\r\n        setGoBack(() => () => {\r\n          setState({ state: \"WideView\" });\r\n\r\n          resetCamera();\r\n        });\r\n\r\n        setCamTransform(camera.curTransform);\r\n        showElems(\"#examine-group\");\r\n\r\n        return function exitState() {\r\n          removeElems(\".small-drop, .circlet\", container);\r\n          hideElems(\"#examine-group\");\r\n\r\n          setPanels([]);\r\n          activeMinidropsRef.current = [];\r\n          curMinidropsRef.current = null;\r\n          setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#examine-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop\", container);\r\n        showElems(\".small-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      updateColorDrops(\r\n        container,\r\n        curMinidropsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop\", container);\r\n      hideElems(\".small-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function addDetailPanel(dropId, preview = false, forceReplace = false) {\r\n    const { x: groupX, y: groupY } = curMinidropsRef.current;\r\n    const { x, y, id, key } = waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      if (p.findIndex(({ id: pid }) => id === pid) !== -1) {\r\n        if (!forceReplace) return p;\r\n\r\n        arrRemove(p, (_p) => _p.id === id);\r\n      }\r\n      const newPanel = {\r\n        text: key.slice(4),\r\n        x: groupX + x * SPREAD_1_2,\r\n        y: groupY + y * SPREAD_1_2,\r\n        offsetX: 20,\r\n        offsetY: 40,\r\n        id,\r\n        preview,\r\n        panelKey: preview ? -1 : dropId,\r\n      };\r\n\r\n      return [...p, newPanel];\r\n    });\r\n  }\r\n\r\n  function removeDetailPanel(dropId) {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ id }) => dropId === id);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function removePreviewPanel() {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ panelKey }) => panelKey === -1);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function updateActiveMinidrops(d) {\r\n    const container = d3.select(\"#examine-group\");\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      arrRemove(activeMinidropsRef.current, d.id);\r\n      container.select(\".circlet.i\" + d.id).classed(\"active\", false);\r\n      removeDetailPanel(d.id);\r\n      setHoveredCard(null);\r\n    } else {\r\n      removeDetailPanel(d.id);\r\n      activeMinidropsRef.current.push(d.id);\r\n      container.select(\".circlet.i\" + d.id).classed(\"active\", true);\r\n      addDetailPanel(d.id);\r\n      setHoveredCard(d.id);\r\n    }\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      d3.select(`.examine-panel.p${d.id}`).style(\"z-index\", 100);\r\n      setHoveredCard(d.id);\r\n    } else {\r\n      if (removePreviewRef.current) {\r\n        clearTimeout(removePreviewRef.current);\r\n        removePreviewPanel();\r\n      }\r\n      addDetailPanel(d.id, true);\r\n    }\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    if (!activeMinidropsRef.current.includes(d.id)) {\r\n      removePreviewRef.current = setTimeout(() => {\r\n        removeDetailPanel(d.id);\r\n        removePreviewRef.current = null;\r\n      }, 100);\r\n    }\r\n\r\n    setHoveredCard((hc) => (hc === d.id ? null : hc));\r\n    d3.select(`.examine-panel.p${d.id}`).style(\"z-index\", 0);\r\n  }\r\n\r\n  function drawLineConnect(id) {\r\n    if (panelsRef.current.findIndex(({ id: pid }) => id === pid) === -1) return;\r\n\r\n    const { x: circleX, y: circleY } = panelsRef.current.find(\r\n      (p) => p.id === id\r\n    );\r\n\r\n    const [cx, cy] = worldToScreen(circleX, circleY, camTransformRef.current);\r\n\r\n    const panelBox = d3\r\n      .select(`.examine-panel.p${id}`)\r\n      .node()\r\n      .getBoundingClientRect();\r\n    const [px, py] = [\r\n      panelBox.left + panelBox.width / 2,\r\n      panelBox.top + panelBox.height / 2,\r\n    ];\r\n\r\n    const diffX = px - cx;\r\n    const diffY = py - cy;\r\n\r\n    let left, top;\r\n    const margin = 5;\r\n\r\n    if (Math.abs(diffX) > Math.abs(diffY)) {\r\n      top = 0;\r\n      left = (diffX < 0 ? 1 : -1) * (panelBox.width / 2 - margin);\r\n    } else {\r\n      left = 0;\r\n      top = (diffY < 0 ? 1 : -1) * (panelBox.height / 2 - margin);\r\n    }\r\n\r\n    const line = clipEnds(\r\n      [\r\n        [cx, cy],\r\n        [px + left, py + top],\r\n      ],\r\n      8,\r\n      0\r\n    );\r\n\r\n    return line;\r\n  }\r\n\r\n  if (isState(state, \"ExamineView\")) {\r\n    return (\r\n      <>\r\n        <h1 className=\"examine-large-label\">\r\n          {DESCRIPTIONS_DATA[activeWaterdrops[0]].display_name ||\r\n            DESCRIPTIONS_DATA[activeWaterdrops[0]].id}\r\n        </h1>\r\n        {panels.map(\r\n          ({ text, x, y, id, offsetX, offsetY, panelKey, preview }) => (\r\n            <div\r\n              className={`panel examine-panel p${id} ${\r\n                preview ? \"preview\" : \"\"\r\n              }`}\r\n              key={preview ? -1 : id}\r\n              style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n              onMouseDown={(e) => !preview && onPanelDragStart(e, { id })}\r\n              onMouseEnter={() => !preview && hoverDrop({ id })}\r\n              onMouseLeave={() => !preview && unhoverDrop({ id })}\r\n            >\r\n              <div className=\"panel-tab\">\r\n                scenario <span>{text}</span>\r\n              </div>\r\n              <DotHistogram\r\n                width={300}\r\n                height={200}\r\n                data={FLATTENED_DATA[id].deliveries}\r\n                goal={goals[activeWaterdrops[0]]}\r\n                setGoal={(newGoal) => {\r\n                  setGoals((g) => {\r\n                    g[activeWaterdrops[0]] = newGoal;\r\n                    return { ...g };\r\n                  });\r\n                }}\r\n              />\r\n              <SceneSettingSubcard\r\n                settings={deserialize(text)}\r\n                setColorSetting={setColorSetting}\r\n              />\r\n            </div>\r\n          )\r\n        )}\r\n        {hoveredCard && (\r\n          <ConnectLine connectLine={drawLineConnect(hoveredCard)} />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nfunction ConnectLine({ connectLine }) {\r\n  return (\r\n    <div className=\"connect-line\" style={getConnectStyle(...connectLine)}>\r\n      <div className=\"connect-line-container\"></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getConnectStyle(from, to) {\r\n  const width = dist(from, to);\r\n  const rot = radToDeg(Math.atan2(to[1] - from[1], to[0] - from[0]));\r\n  return {\r\n    left: `${from[0]}px`,\r\n    top: `${from[1]}px`,\r\n    width: `${width}px`,\r\n    rotate: `${rot}deg`,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport { Scrollama, Step } from \"react-scrollama\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { isState } from \"utils/misc-utils\";\r\n\r\nimport BucketGlyph from \"bucket-lib/BucketGlyph\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport WaterdropGlyph from \"components/WaterdropGlyph\";\r\nimport { hideElems, showElems } from \"utils/render-utils\";\r\nimport {\r\n  BAR_CHART_HEIGHT,\r\n  DEFAULT_DELIVS,\r\n  DEFAULT_INTERPER,\r\n  INTERP_COLOR,\r\n  VARIATIONS_DELIVS,\r\n  VARIATIONS_INTERPERS,\r\n  useTutorialGraph,\r\n  useTutorialState,\r\n  useTutorialComparer,\r\n  DROP_VARIATIONS,\r\n} from \"utils/tutorialview-utils\";\r\n\r\nexport default function TutorialView() {\r\n  const { state, setState, waterdrops, camera } = useContext(AppContext);\r\n\r\n  const {\r\n    userGoal,\r\n    setUserGoal,\r\n    bucketInterper,\r\n    setBucketInterper,\r\n    dropInterper,\r\n    setDropInterper,\r\n    variationInterpers,\r\n    setVariationInterpers,\r\n  } = useTutorialState();\r\n\r\n  const { initGraphArea, initBars, condenseBars } = useTutorialGraph();\r\n  const { initComparer, introDrop2 } = useTutorialComparer();\r\n\r\n  const maxSlideReachedRef = useRef(-1);\r\n\r\n  useLayoutEffect(\r\n    function enterState() {\r\n      if (isState(state, \"TutorialView\")) {\r\n        hideElems(\r\n          \".bucket-wrapper, .vardrop, .vardroplabel, .vardrop .dot-histogram-wrapper, .main-histogram, .tut-comparer-graphics-wrapper\"\r\n        );\r\n\r\n        initGraphArea();\r\n        initComparer(waterdrops, camera);\r\n\r\n        return function exitState() {\r\n          hideElems(\".tutorial-view\");\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  const actions = useMemo(\r\n    () => ({\r\n      2: () => {\r\n        initBars();\r\n      },\r\n\r\n      4: () => {\r\n        condenseBars();\r\n      },\r\n\r\n      5: () => {\r\n        d3.select(\".bucket-wrapper\").style(\"display\", \"initial\");\r\n        d3.select(\"#tut-bar-graph\").attr(\"opacity\", 0);\r\n\r\n        setBucketInterper(() => DEFAULT_INTERPER);\r\n      },\r\n\r\n      6: () => {\r\n        setDropInterper(() => DEFAULT_INTERPER);\r\n      },\r\n\r\n      8: () => {\r\n        d3.selectAll(\".vardrop\")\r\n          .style(\"display\", \"initial\")\r\n          .classed(\"hasarrow\", true);\r\n      },\r\n\r\n      9: () => {\r\n        d3.selectAll(\".vardrop path\").style(\"stroke-dasharray\", \"none\");\r\n        setVariationInterpers(VARIATIONS_INTERPERS);\r\n      },\r\n\r\n      10: () => {\r\n        d3.selectAll(\".vardroplabel\").style(\"display\", \"block\");\r\n      },\r\n\r\n      11: () => {\r\n        d3.select(\".drop1\").classed(\"highlighted\", true);\r\n      },\r\n\r\n      12: () => {\r\n        d3.select(\".drop1\").classed(\"highlighted\", false);\r\n        d3.selectAll(\".vardrop\").classed(\"hasarrow\", false);\r\n\r\n        d3.selectAll(\".vardroplabel\").style(\"opacity\", \"0.5\");\r\n        d3.selectAll(\".vardroplabel, .scen-number\").style(\"color\", \"gray\");\r\n\r\n        d3.select(\".main-waterdrop\")\r\n          .transition()\r\n          .style(\"transform\", \"translateY(-100px) scale(0.5)\");\r\n        // undo scaling of label due to shrinking div\r\n        d3.select(\".main-waterdrop .vardroplabel\")\r\n          .transition()\r\n          .style(\"transform\", \"scale(2)\");\r\n        d3.selectAll(\".drop1 .waterdrop-wrapper, .drop3 .waterdrop-wrapper\")\r\n          .transition()\r\n          .style(\"transform\", \"translate(-50px, 15px) scale(0.5)\");\r\n        d3.selectAll(\".drop2 .waterdrop-wrapper, .drop4 .waterdrop-wrapper\")\r\n          .transition()\r\n          .style(\"transform\", \"translate(50px, 15px) scale(0.5)\");\r\n\r\n        d3.select(\".main-histogram\").style(\"display\", \"initial\");\r\n        d3.selectAll(\".vardrop .dot-histogram-wrapper\").style(\r\n          \"display\",\r\n          \"initial\"\r\n        );\r\n      },\r\n\r\n      13: () => {\r\n        hideElems(\".scrollama-2 .tut-drop-graphics-wrapper\");\r\n        showElems(\".scrollama-2 .tut-comparer-graphics-wrapper\");\r\n      },\r\n\r\n      15: () => {\r\n        introDrop2();\r\n      },\r\n    }),\r\n    []\r\n  );\r\n\r\n  const onStepEnter = async ({ data, direction }) => {\r\n    if (direction === \"up\") return;\r\n\r\n    if (data > maxSlideReachedRef.current) {\r\n      maxSlideReachedRef.current = data;\r\n      if (actions[data]) actions[data]();\r\n    }\r\n  };\r\n\r\n  if (!isState(state, \"TutorialView\")) return;\r\n\r\n  return (\r\n    <div className=\"tutorial-view\">\r\n      <div className=\"card1\">\r\n        <p>\r\n          <em>How much water do the people of California get?</em> For starters,\r\n          let's focus on the agriculture sector north of the delta.\r\n        </p>\r\n        <img\r\n          src=\"./northdelta.png\"\r\n          alt=\"Map of California with northern delta area highlighted\"\r\n        />\r\n        <button\r\n          className=\"skip-btn\"\r\n          onClick={() => setState({ state: \"WideView\" })}\r\n        >\r\n          Skip tutorial\r\n        </button>\r\n      </div>\r\n      <div className=\"scrollama scrollama-1\">\r\n        <div className=\"tut-graph-wrapper\">\r\n          <svg id=\"tut-bar-graph\"></svg>\r\n          <BucketGlyph\r\n            levelInterp={bucketInterper}\r\n            width={300}\r\n            height={BAR_CHART_HEIGHT}\r\n            colorInterp={INTERP_COLOR}\r\n          />\r\n        </div>\r\n        <Scrollama offset={0.5} onStepEnter={onStepEnter}>\r\n          <Step data={2}>\r\n            <div className=\"tut-text-card\">\r\n              This is the average yearly amount of water this group receives,\r\n              specifically from the <b>Central Valley Project</b>, one of two\r\n              water municipalities in California.\r\n            </div>\r\n          </Step>\r\n          <Step data={3}>\r\n            <div className=\"tut-text-card\">\r\n              Here, it is presented as a bar graph, with the bottom axis\r\n              representing the year and the side axis representing the amount of\r\n              water delivered in thousand acre-feet (TAF).\r\n            </div>\r\n          </Step>\r\n          <Step data={4}>\r\n            <div className=\"tut-text-card\">\r\n              We'll condense this bar graph into a single bar with a filled\r\n              gradient.\r\n            </div>\r\n          </Step>\r\n          <Step data={5}>\r\n            <div className=\"tut-text-card\" style={{ marginBottom: \"80vh\" }}>\r\n              What we get is a bucket of water showing which water levels are\r\n              most likely, with the darker areas being the most likely water\r\n              levels.\r\n            </div>\r\n          </Step>\r\n        </Scrollama>\r\n      </div>\r\n      <div className=\"scrollama scrollama-2\">\r\n        <div className=\"tut-drop-graphics-wrapper\">\r\n          <div className=\"main-waterdrop\">\r\n            <WaterdropGlyph\r\n              levelInterp={dropInterper}\r\n              width={400}\r\n              height={BAR_CHART_HEIGHT}\r\n              colorInterp={INTERP_COLOR}\r\n            />\r\n            <p className=\"vardroplabel\">\r\n              scenario <span className=\"scen-number\">{\"0000\"}</span>\r\n            </p>\r\n          </div>\r\n          <div className=\"main-histogram\">\r\n            <DotHistogram\r\n              width={210}\r\n              height={140}\r\n              data={DEFAULT_DELIVS}\r\n              goal={userGoal}\r\n              setGoal={(newGoal) => {\r\n                setUserGoal(newGoal);\r\n              }}\r\n            />\r\n          </div>\r\n          {DROP_VARIATIONS.map(({ idx, scen, clas, desc }) => (\r\n            <div className={`vardrop ${clas}`} key={idx} desc={desc}>\r\n              <WaterdropGlyph\r\n                levelInterp={variationInterpers[idx]}\r\n                width={400}\r\n                height={(BAR_CHART_HEIGHT * 2) / 3}\r\n                colorInterp={INTERP_COLOR}\r\n              />\r\n              <p className=\"vardroplabel\">\r\n                scenario <span className=\"scen-number\">{scen}</span>\r\n              </p>\r\n              <DotHistogram\r\n                shortForm\r\n                width={210}\r\n                height={140}\r\n                data={VARIATIONS_DELIVS[idx]}\r\n                goal={userGoal}\r\n                setGoal={(newGoal) => {\r\n                  setUserGoal(newGoal);\r\n                }}\r\n              />\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <div className=\"tut-comparer-graphics-wrapper\">\r\n          <svg id=\"comparer-graphics\"></svg>\r\n        </div>\r\n        <Scrollama offset={0.5} onStepEnter={onStepEnter}>\r\n          <Step data={6}>\r\n            <div className=\"tut-text-card\">\r\n              Here it is as a drop of water. We see here that the lightest color\r\n              reaches the midpoint of the maximum water possible, meaning that\r\n              there is a chance 600 TAF of water will be delivered to this\r\n              group.\r\n            </div>\r\n          </Step>\r\n          <Step data={7}>\r\n            <div className=\"tut-text-card\">\r\n              The darker colors, however, indicate that it's more likely that\r\n              less than a quarter of the maximum, or around 300 TAF, will be\r\n              delivered. As we'll later see, this is not a lot compared to other\r\n              areas of California.\r\n            </div>\r\n          </Step>\r\n          <Step data={8}>\r\n            <div className=\"tut-text-card\">\r\n              But what if we could <em>change reality</em>? What if we could\r\n              increase the likelihood of delivering as much water as possible by\r\n              changing the way we manage it?\r\n            </div>\r\n          </Step>\r\n          <Step data={9}>\r\n            <div className=\"tut-text-card\">\r\n              Fortunately, we can explore those possibilities with the help of a\r\n              simulator called\r\n              <b> CalSim</b>.\r\n            </div>\r\n          </Step>\r\n          <Step data={10}>\r\n            <div className=\"tut-text-card\">\r\n              These variations are called <em>scenarios</em> and are labelled\r\n              with unique numbers. Our reality is a scenario with no variables\r\n              changed, labelled scenario 0000.\r\n            </div>\r\n          </Step>\r\n          <Step data={11}>\r\n            <div className=\"tut-text-card\">\r\n              At a glance, we can easily see that scenario 0020 appears to be\r\n              the best scenario since the darker water levels reach higher than\r\n              those of the other scenarios. To more concretely compare these\r\n              scenarios, however, we'll use a different view.\r\n            </div>\r\n          </Step>\r\n          <Step data={12}>\r\n            <div className=\"tut-text-card\" style={{ marginBottom: \"120vh\" }}>\r\n              Try moving the red line to change the minimum demand and see how\r\n              well each of these scenarios meet those demands.\r\n            </div>\r\n          </Step>\r\n          <Step data={13}>\r\n            <div className=\"tut-text-card\">\r\n              We'll collect all the possible scenarios and sort them by their\r\n              average deliveries.\r\n            </div>\r\n          </Step>\r\n          <Step data={14}>\r\n            <div className=\"tut-text-card\">\r\n              So why don't we just choose the best scenario? Well, it's because\r\n              it's not just this group that wants water. Other groups, which we\r\n              call <em>objectives</em>, want scenarios that best fit{\" \"}\r\n              <em>them.</em>\r\n            </div>\r\n          </Step>\r\n          <Step data={15}>\r\n            <div className=\"tut-text-card\" style={{ marginBottom: \"120vh\" }}>\r\n              For example, the refuge group south of the delta. The scenarios\r\n              that benefit the agriculture group do not always benefit the\r\n              refuge group, and vice versa. Hover over the waterdrops to see how\r\n              the same scenarios place for each objective. (Can you find a\r\n              scenario that benefits both?)\r\n            </div>\r\n          </Step>\r\n        </Scrollama>\r\n      </div>\r\n      <div>\r\n        <div className=\"tut-text-card\">\r\n          Thus, tradeoffs must often be made when managing California's water\r\n          supply. What are the ways we can manage California's water, and how do\r\n          their outcomes compare? Go to the next step to find out!\r\n          <button\r\n            className=\"fancy-font\"\r\n            onClick={() => setState({ state: \"WideView\" })}\r\n          >\r\n            click to explore!\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useCallback, useContext, useEffect, useRef, useState } from \"react\";\r\nimport { BiCross, BiNetworkChart } from \"react-icons/bi\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport { DESCRIPTIONS_DATA } from \"data/descriptions-data\";\r\nimport { SPATIAL_FEATURES } from \"data/spatial-data\";\r\nimport { SPREAD_1_2 } from \"settings\";\r\nimport { dropsMesh, scene } from \"three-resources\";\r\n\r\nimport { avgCoords, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport {\r\n  drawMinimapSVG,\r\n  fadeOutDrops,\r\n  fontSizer,\r\n  updateLargeDropSVG,\r\n} from \"utils/wideview-utils\";\r\nimport { hideElems, showElems } from \"utils/render-utils\";\r\n\r\nexport default function WideView() {\r\n  const {\r\n    waterdrops,\r\n    state,\r\n    setState,\r\n    camera,\r\n    zoomTo,\r\n    setActiveWaterdrops,\r\n    activeWaterdrops,\r\n    setDisableCamAdjustments,\r\n    getOutlineOpacity,\r\n    addZoomHandler,\r\n  } = useContext(AppContext);\r\n\r\n  const [curScreenTransform, setCurScreenTransform] = useState({\r\n    zoom: 1,\r\n    mouseX: 0,\r\n    mouseY: 0,\r\n  });\r\n\r\n  const [currentHoveredDrop, setCurrentHoveredDrop] = useState(null);\r\n\r\n  const enableZoomRef = useRef(false);\r\n  const activeDropsRef = useRef([]);\r\n\r\n  useEffect(function initialize() {\r\n    initSVGGraphics();\r\n\r\n    const cleanup = registerEventListeners();\r\n\r\n    drawMinimapSVG();\r\n\r\n    return cleanup;\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(state, \"WideView\")) {\r\n        d3.select(\"body\").style(\"overflow\", \"hidden\");\r\n\r\n        enableZoomRef.current = true;\r\n        setCurScreenTransform((cst) => ({\r\n          ...cst,\r\n          zoom: camera.curTransform.k,\r\n        }));\r\n\r\n        drawTHREEGraphics();\r\n        drawSVGGraphics();\r\n\r\n        showElems(\"#infobox, #mosaic-webgl, #mosaic-svg\");\r\n\r\n        return function exitState() {\r\n          hideElems(\"#infobox, #wide-group .large-drop\");\r\n\r\n          enableZoomRef.current = false;\r\n        };\r\n      }\r\n    },\r\n    [state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateFontSizes() {\r\n      if (enableZoomRef.current) {\r\n        d3.select(\"#wide-group\")\r\n          .selectAll(\"text\")\r\n          .each(fontSizer(curScreenTransform, camera, waterdrops.height));\r\n      }\r\n    },\r\n    [curScreenTransform]\r\n  );\r\n\r\n  const handleClick = useCallback(function () {\r\n    const willExamineDrop = activeDropsRef.current.length === 1;\r\n    const willCompareDrops = activeDropsRef.current.length > 1;\r\n\r\n    if (willExamineDrop) {\r\n      changeToExamineView();\r\n    } else if (willCompareDrops) {\r\n      changeToCompareView();\r\n    }\r\n  }, []);\r\n\r\n  function initSVGGraphics() {\r\n    hideElems(\"#infobox, #mosaic-webgl, #mosaic-svg\");\r\n\r\n    d3.select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"wide-group\");\r\n  }\r\n\r\n  function registerEventListeners() {\r\n    const cameraListener = (transform) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        zoom: transform.k,\r\n      }));\r\n    };\r\n\r\n    const mouseListener = (e) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        mouseX: e.x,\r\n        mouseY: e.y,\r\n      }));\r\n    };\r\n\r\n    addZoomHandler(cameraListener);\r\n    window.addEventListener(\"mousemove\", mouseListener);\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener(\"mousemove\", mouseListener);\r\n    };\r\n  }\r\n\r\n  function drawTHREEGraphics() {\r\n    console.time(\"drawing\");\r\n    dropsMesh.draw(scene);\r\n    console.timeEnd(\"drawing\");\r\n\r\n    dropsMesh.updateVisibility(1);\r\n    dropsMesh.updateOutlineVisibility(getOutlineOpacity(camera.curTransform.k));\r\n  }\r\n\r\n  function drawSVGGraphics() {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    updateLargeDropSVG(container, waterdrops, {\r\n      onClick: updateActiveDrops,\r\n      onHover: hoverDrop,\r\n      onUnhover: unhoverDrop,\r\n    });\r\n\r\n    for (const wd of activeDropsRef.current) {\r\n      container.select(\".circlet.\" + wd.key).classed(\"active\", true);\r\n    }\r\n  }\r\n\r\n  function updateActiveDrops(d) {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    setActiveWaterdrops((aw) => {\r\n      if (aw.includes(d.key)) {\r\n        aw = arrRemove(aw, d.key);\r\n        activeDropsRef.current = arrRemove(activeDropsRef.current, d);\r\n\r\n        container.select(\".circlet.\" + d.key).classed(\"active\", false);\r\n      } else {\r\n        aw.push(d.key);\r\n        activeDropsRef.current.push(d);\r\n\r\n        container.select(\".circlet.\" + d.key).classed(\"active\", true);\r\n      }\r\n      return [...aw];\r\n    });\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    setCurrentHoveredDrop({\r\n      id: d.key,\r\n      description: DESCRIPTIONS_DATA[d.key].desc,\r\n    });\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"gray\");\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    setCurrentHoveredDrop(null);\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"transparent\");\r\n  }\r\n\r\n  function changeToExamineView() {\r\n    setDisableCamAdjustments(true);\r\n\r\n    const { x, y, height } = activeDropsRef.current[0];\r\n\r\n    const newCamPos = [\r\n      x,\r\n      y - dropCenterCorrection({ height }),\r\n      camera.getZFromFarHeight(height * SPREAD_1_2 * 1.5),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    setState({ state: \"ExamineView\", transitionDuration });\r\n\r\n    const startOpacity = getOutlineOpacity(camera.curTransform.k);\r\n    fadeOutDrops(dropsMesh, scene, startOpacity, transitionDuration / 2);\r\n  }\r\n\r\n  function changeToCompareView() {\r\n    setDisableCamAdjustments(true);\r\n\r\n    const dropsMidpoint = avgCoords(\r\n      activeDropsRef.current.map((w) => [w.x, w.y])\r\n    );\r\n\r\n    const newCamPos = [\r\n      ...dropsMidpoint,\r\n      camera.getZFromFarHeight(\r\n        waterdrops.groups[0].height * 2 * SPREAD_1_2 * 0.75 * 2\r\n      ),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    setState({\r\n      state: \"CompareView\",\r\n      transitionDuration,\r\n      viewCenter: dropsMidpoint,\r\n    });\r\n\r\n    const startOpacity = getOutlineOpacity(camera.curTransform.k);\r\n    fadeOutDrops(dropsMesh, scene, startOpacity, transitionDuration / 5);\r\n  }\r\n\r\n  let examineBtn, compareBtn;\r\n\r\n  if (isState(state, \"WideView\") && activeWaterdrops.length) {\r\n    if (activeWaterdrops.length === 1) {\r\n      examineBtn = (\r\n        <button\r\n          onClick={handleClick}\r\n          className=\"wide-view-action-btn fancy-font\"\r\n        >\r\n          <BiCross />\r\n          <span>examine</span>\r\n        </button>\r\n      );\r\n    } else {\r\n      compareBtn = (\r\n        <button\r\n          onClick={handleClick}\r\n          className=\"wide-view-action-btn fancy-font\"\r\n        >\r\n          <BiNetworkChart />\r\n          <span>compare</span>\r\n        </button>\r\n      );\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div id=\"infobox\">\r\n        <svg id=\"minimap\"></svg>\r\n        {currentHoveredDrop && (\r\n          <div className=\"details\">\r\n            {!SPATIAL_FEATURES[currentHoveredDrop.id] && (\r\n              <p className=\"no-loc-data\">No Location Data</p>\r\n            )}\r\n            <p className=\"curDesc\">{currentHoveredDrop.description}</p>\r\n            <p className=\"curKey\">\r\n              id: <span> {currentHoveredDrop.id} </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n      {examineBtn}\r\n      {compareBtn}\r\n    </>\r\n  );\r\n}\r\n"],"names":["waterdrops","initWaterdrops","appWidth","window","innerWidth","appHeight","innerHeight","App","state","setState","useState","activeWaterdrops","setActiveWaterdrops","goBack","setGoBack","goals","setGoals","OBJECTIVE_GOALS_MAP","zoomCallbacksRef","useRef","disableCamAdjustmentsRef","getOutlineOpacity","useCallback","d3","domain","height","groups","range","clamp","useEffect","document","querySelector","appendChild","renderer","domElement","attr","camera","mount","node","select","setZoomFn","transform","current","dropsMesh","updateOutlineVisibility","k","cb","setSize","setAnimationLoop","render","scene","resetCamera","animated","arguments","length","undefined","callback","pos","getZFromFarHeight","start","zoomTo","callZoomFromWorldViewport","worldX","worldY","farHeight","xyz","i","interpolateZoomCamera","duration","t","elapsed","et","Math","min","callZoom","stop","addZoomHandler","push","setDisableCamAdjustments","disable","_jsxs","AppContext","Provider","value","children","className","_jsx","id","TutorialView","WideView","ExamineView","CompareView","onClick","console","time","createMesh","timeEnd","createContext","DEGREE_SWAY","LEVELS","LINE_WIDTH","BucketGlyph","_ref","levelInterp","colorInterp","interpolateWatercolorBlue","width","resolution","useId","svgSelector","liquidLevels","useMemo","ticksExact","map","d","prevLiquidLevels","usePrevious","useLayoutEffect","svgContainer","append","concat","bucketPath","split","liquids","selectAll","data","join","_","transition","ease","period","delay","attrTween","diff","abs","sin","PI","ref","e","getQuantileBins","unitsPerQuantile","numQuantiles","histBins","thresholds","ceil","binnedQuantiles","quantileBins","quantiles","b","y","x1","x0","count","filled","taper","bottomRight","bottomLeft","x","lineFunc","numericBins","maxQuantiles","bin","round","sum","Infinity","isEqualFunc","prev","NUM_CIRCLES","MARGIN","top","right","bottom","left","DOMAIN","MAX_DELIVS","WATERDROP_ICON","draw","context","size","moveTo","lineTo","arc","SQRT2","closePath","DotHistogram","goal","setGoal","shortForm","razorID","floor","random","razorAreaID","circles","dataRange","filter","style","call","scale","tickFormat","s","text","razor","ignoreFn","preventDefault","dragging","addEventListener","removeEventListener","target","max","offsetX","svgCircles","enter","SceneSettingStickers","settings","setColorSetting","v","onMouseEnter","onMouseLeave","SETT_NAME_FULL","SETT_VAL_STEPS","j","opacity","SceneSettingSubcard","SETT_NAME_SHORT","WaterdropGlyph","_ref2","dropD","points","waterdropDeltaOutline","dropPath","DROP_RAD","DROP_HEIGHT","DESCRIPTIONS_DATA","async","objs","fetch","json","log","mapBy","SCEN_DIVISOR","SCENARIO_KEY_STRING","DELIV_KEY_STRING","OBJECTIVES_DATA","obj","scen","shuffle","unord","sort","a","name","OBJECTIVE_IDS","Object","keys","goalMap","SCENARIO_IDS","values","KEY_SETTINGS_MAP","optArr","SETT_NUM_OPTS","key","deserialize","slice","FLATTENED_DATA","DATA_GROUPINGS","flattenedData","dataGroupings","objective","scenario","means","idx","deliveries","orderedDataGroupings","criteria","objScens","ids","sortedObjScens","sorted","mean","flat","IDtoRank","rank","SPATIAL_DATA","SPATIAL_FEATURES","features","properties","CalLiteID","CALIFORNIA_OUTLINE","CALIFORNIA_CENTER","LOD_1_LEVELS","LOD_1_RAD_PX","LOD_1_MIN_LEV_VAL","LOD_1_SMALL_DROP_PAD_FACTOR","LOD_1_LARGE_DROP_PAD_FACTOR","GROUP_HOVER_AREA_FACTOR","SQRT1_2","SPREAD_1_2","WaterdropMesh","constructor","added","this","updateMeshes","initializeMeshes","add","outlineMesh","remove","dropsGeometry","MeshGeometry","MAX_POINTS_DROPS","outlinePoints","outlineMeshCoords","nodes","globalX","globalY","levs","maxLev","globalTilt","tilt","l1","l2","meshCoords","waterdropDelta","color","THREE","addMeshCoords","rotate","rotOutline","rotatePoints","copyCoords","dx","dy","finish","threeGeom","vertexColors","transparent","setFromPoints","opac","material","needsUpdate","updateVisibility","MAX_POINTS_OUTLINE","numPoints","triangleIdx","setAttribute","Float32Array","positionAttribute","getAttribute","colorAttribute","z","v1","v2","v3","setXYZ","r","g","setDrawRange","background","fov","near","far","raycaster","zoomFn","zoom","on","curTransform","_THREEZoomHandler","_svgElement","view","translate","_ref3","tan","toRadians","getFarHeightFromZ","_ref4","endx","endy","endz","position","interper","webglElement","svgElement","scaleExtent","getScaleFromZ","set","getZFromScale","camera_z_position","half_fov","half_fov_radians","fov_height","intersectObject","mouseX","mouseY","mesh","setFromCamera","antialias","grouping","groupKeys","memberKeys","amtPerGroup","largeDropRad","sqrt","smallDropRad","largeNodesPhys","placeDropsUsingPhysics","p","largeNodesPos","smallNodesPhys","smallNodesPos","groupNodes","groupToNodes","nodeData","createInterpsFromDelivs","w","groupID","memberID","groupRank","memberRank","localTilt","parentTilt","rotatedX","rotatedY","rotatePoint","domLev","calcDomLev","dur","group","groupKey","updateDropsSVG","container","waterdropGroups","transitionDelay","onHover","onUnhover","each","largeDropInit","largeDropUpdate","getEndGroupLoc","groupPositions","updateColorDrops","opacFn","getGroupLoc","_ref5","_ref6","getWaterdropGroups","keyArr","center","find","rad","n","angle","cos","calcLinesAndPositions","groupsObj","activeMinidropKey","positions","groupPos","dropCenterCorrection","lines","from","Array","to","clipEnds","updateLabelSVG","labelText","normedTextSize","textX","textY","smallTextSize","largeTextSize","updateScenIndicatorsSVG","circlet","_ref7","smallDropInit","_ref8","baselinePos","textUpdate","_ref9","smallDropUpdate","_ref10","_ref11","randId","genUUID","gradientInit","DROPLET_SHAPE","_ref12","gradientUpdate","dropBBox","getBBox","wrap","display_name","forEach","line","delivs","maxDelivs","reverse","demand","carryover","priority","regs","minflow","scenStr","scenNum","parseInt","serialize","demandReverse","code","useDragPanels","viewTransform","panels","setPanels","panelsRef","useStateRef","mouseDownInfo","startX","deltaX","deltaY","startY","f","oldOffsetX","offsetY","oldOffsetY","onPanelDragStart","clientX","clientY","getPanelStyle","screenX","screenY","worldToScreen","updateSmallDropSVG","waterdropGroup","classed","generateWaterdrop","delta","outer","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","reuse","shape","bounds","Matter","create","minX","maxX","minY","maxY","genX","genY","contains","generateRandoPoints","WIDTH_AREA","AREA","radsToDropWidth","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","nx","ny","circle","restitution","parts","quad","centre","vertices","isStatic","cage","setParts","setCentre","world","FPS","SECS","update","retVal","CIRC_RAD","dist","y1","x2","y2","distSq","getCenterDomRect","domRect","shortenByStart","shortenByEnd","len","normed","dropRadToDropHeight","avgCoords","c","deg","vec","applyEuler","arr","newPoint","array","currentIndex","randomIndex","fn","newObjs","groupBy","val","_setState","stateRef","curVal","isState","stateInfo","stateName","replace","arrRemove","item","findIndex","indexOf","splice","CIRC_HEIGHT","HAT_START","yToHalfWidth","trigX","acos","yToSpriteY","spriteYToY","sy","yStart","yEnd","subdivs","Y_DELTA","rightCoords","leftCoords","dx1","dy1","dx2","dy2","v4","showElems","elemStr","displayVal","hideElems","removeElems","stops","valOffset","camTransform","INTERP_COLOR","DEFAULT_OBJECTIVE","DEFAULT_SCENARIO","DEFAULT_DELIVS","COMP_OBJECTIVE","VARIATIONS","VARIATIONS_DELIVS","vars","VARIATIONS_INTERPERS","varDelivs","DEFAULT_INTERPER","BAR_CHART_WIDTH","BAR_CHART_HEIGHT","BAR_CHART_MARGIN","useTutorialState","userGoal","setUserGoal","bucketInterper","setBucketInterper","dropInterper","setDropInterper","variationInterpers","setVariationInterpers","useTutorialGraph","d3Refs","initGraphArea","svgGroup","dataDescending","yearlyData","placeFromLeft","year","padding","xaxis","tickSize","tickValues","initBars","bandwidth","condenseBars","newWidth","bars","end","useTutorialComparer","activeMinidrop","setActiveMinidrop","groupsRef","camCentersRef","updateLabel","updateScenIndicators","initComparer","camMidpoint","camFirstDrop","firstDrop","midpoint","indicatorGroup","introDrop2","DROP_VARIATIONS","clas","desc","parentNode","drawMinimapSVG","minimap","proj","lineGeom","geometry","type","pointGeom","projection","coordinates","updateLargeDropSVG","interactorsInit","interactorsUpdate","dropTransform","fontSizer","transformInfo","waterdropsHeight","tNode","posx","posy","getBoundingClientRect","dis","getFontSize","fadeOutDrops","startOpac","textGroup","transformZoom","cameraHeight","MAX_RAD","zoomRel","_d","useContext","colorSetting","setCamTransform","centerRef","viewCenter","transitionDuration","setTimeout","ox","oy","isLeft","centerX","centerY","newX","newY","correctionX","getIdealGroupPos","nodeID","makePanelsFromNodes","_Fragment","onMouseDown","newGoal","activeMinidropsRef","curMinidropsRef","camTransformRef","hoveredCard","setHoveredCard","removePreviewRef","addDetailPanel","dropId","preview","forceReplace","groupX","groupY","pid","_p","newPanel","panelKey","removeDetailPanel","updateActiveMinidrops","includes","hoverDrop","clearTimeout","unhoverDrop","hc","svgArea","ConnectLine","connectLine","circleX","circleY","cx","cy","panelBox","px","py","diffX","diffY","drawLineConnect","getConnectStyle","rot","radToDeg","atan2","maxSlideReachedRef","actions","onStepEnter","direction","src","alt","Scrollama","offset","Step","marginBottom","curScreenTransform","setCurScreenTransform","currentHoveredDrop","setCurrentHoveredDrop","enableZoomRef","activeDropsRef","cleanup","mouseListener","ti","registerEventListeners","cst","updateActiveDrops","wd","drawSVGGraphics","handleClick","willExamineDrop","willCompareDrops","newCamPos","startZoom","startOpacity","changeToExamineView","dropsMidpoint","changeToCompareView","aw","description","examineBtn","compareBtn","BiCross","BiNetworkChart"],"sourceRoot":""}