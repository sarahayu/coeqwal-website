{"version":3,"file":"static/js/805.3f9e046a.chunk.js","mappings":"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","sources":["App.jsx","AppContext.jsx","bucket-lib/bucket-glyph.js","bucket-lib/utils.js","components/ActionButtons.jsx","components/BottleGlyph.jsx","components/BucketCreationGraphics.jsx","components/CallToExploreSection.jsx","components/CardBBox.jsx","components/CompareBucketCreationsBackground.jsx","components/CompareBucketCreationsGraphics.jsx","components/CompareBucketCreationsText.jsx","components/CompareScenariosGraphics.jsx","components/ConnectLine.jsx","components/DataStoryScrollama.jsx","bucket-lib/quantile-bins.js","components/DotHistogram.jsx","components/MainWaterdropGraphics.jsx","components/MapCalifornia.jsx","components/SceneSettingStickers.jsx","components/SceneSettingSubcard.jsx","components/SkipBtn.jsx","components/TaggedBottleGlyph.jsx","components/TutHero.jsx","components/VariationWaterdropGraphics.jsx","data/descriptions-data.jsx","data/descriptions-tutorial-data.jsx","data/objectives-data.jsx","data/objectives-tutorial-data.jsx","data/spatial-data.jsx","hooks/useAppState.jsx","hooks/useCompareLargeDrops.jsx","hooks/useDataStory.jsx","hooks/useDataStoryVars.jsx","hooks/useDragPanels.jsx","settings.jsx","utils/three-utils.jsx","three-resources.jsx","utils/compareview-helpers.jsx","utils/data-story-anims.jsx","utils/data-utils.jsx","utils/examineview-helpers.jsx","utils/math-utils.jsx","utils/misc-utils.jsx","utils/render-utils.jsx","utils/story-scripts.jsx","utils/tutorialview-utils.jsx","utils/waterdrop-utils.jsx","utils/wideview-helpers.jsx","views/CompareView.jsx","views/ExamineView.jsx","views/TutorialView.jsx","views/WideView.jsx"],"sourcesContent":["import React from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport WideView from \"views/WideView\";\r\nimport ExamineView from \"views/ExamineView\";\r\nimport TutorialView from \"views/TutorialView\";\r\nimport CompareView from \"views/CompareView\";\r\n\r\nimport useAppState from \"hooks/useAppState\";\r\n\r\nexport default function App() {\r\n  const appState = useAppState();\r\n\r\n  return (\r\n    <AppContext.Provider value={appState}>\r\n      <div className=\"bubbles-wrapper\">\r\n        <div id=\"mosaic-webgl\"></div>\r\n        <svg id=\"mosaic-svg\">\r\n          <g className=\"svg-trans\"></g>\r\n        </svg>\r\n      </div>\r\n      <dialog>Page was resized, please reload the page!</dialog>\r\n      <TutorialView />\r\n      <WideView />\r\n      <ExamineView />\r\n      <CompareView />\r\n      {appState.goBack && (\r\n        <button className=\"go-back-btn\" onClick={appState.goBack}>\r\n          <span></span>\r\n        </button>\r\n      )}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n","import { createContext } from \"react\";\r\n\r\nexport const AppContext = createContext({});\r\n","import * as d3 from \"d3\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LINE_WIDTH = 3;\r\n\r\nlet maskCounter = 0;\r\n\r\n// ensures every mask id is unique\r\nfunction getMaskId() {\r\n  return maskCounter++;\r\n}\r\n\r\nfunction bucketGlyph(width, height, valueToLevelFn = d3.scaleLinear()) {\r\n  return function (data) {\r\n    return data.map((d) => ({\r\n      x: -width,\r\n      y: height - valueToLevelFn(d) * height - height / 2,\r\n      width: width * 2,\r\n      height: height * 2,\r\n    }));\r\n  };\r\n}\r\n\r\nfunction transitionSway(rects, multiplier = 1) {\r\n  // save previous value; we'll need it to calculate how much to sway between renders\r\n  rects.each(function (d) {\r\n    const s = d3.select(this);\r\n    const prevLevel = s.attr(\"cur-level\") || 0;\r\n\r\n    s.attr(\"prev-level\", prevLevel);\r\n    s.attr(\"cur-level\", d.y);\r\n  });\r\n\r\n  rects\r\n    .transition(\"liquidSway\")\r\n    .duration(2000)\r\n    .delay((_, i) => i * 10)\r\n    .ease(d3.easeQuad)\r\n    .attrTween(\"transform\", function (d, i) {\r\n      const s = d3.select(this);\r\n      const prevLiquidLevel = parseFloat(s.attr(\"prev-level\"));\r\n      const diff = (Math.abs(prevLiquidLevel - d.y) / 200) * multiplier;\r\n      return (t) =>\r\n        `rotate(${\r\n          Math.sin(\r\n            Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n          ) *\r\n          diff *\r\n          DEGREE_SWAY *\r\n          (1 - t)\r\n        }, ${0}, ${0})`;\r\n    });\r\n\r\n  const levelTransition = rects\r\n    .transition(\"liquidLevel\")\r\n    .ease(d3.easeElasticOut.period(0.6))\r\n    .delay((_, i) => i * (100 / rects.size()))\r\n    .duration(1000);\r\n\r\n  return levelTransition;\r\n}\r\n\r\nfunction bucketShape(\r\n  width,\r\n  height,\r\n  shapeFunc = drawBucketMask,\r\n  shapeOutlineFunc = shapeFunc\r\n) {\r\n  return function (s) {\r\n    const id = getMaskId();\r\n\r\n    s.append(\"defs\")\r\n      .attr(\"class\", \"clip-def\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    s.append(\"g\")\r\n      .attr(\"class\", \"masked-area\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${height / 2})`)\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${height / 2})`)\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n\r\n    s.call(\r\n      bucketShapeMask({\r\n        drawFunc: shapeFunc,\r\n        drawOutlineFunc: shapeOutlineFunc,\r\n        width,\r\n        height,\r\n      })\r\n    );\r\n  };\r\n}\r\n\r\nfunction bucketShapeMask({\r\n  drawFunc,\r\n  drawOutlineFunc = drawFunc,\r\n  width,\r\n  height,\r\n}) {\r\n  return function (s) {\r\n    const getPath = (fn) => {\r\n      const path = d3.path();\r\n      fn(path, width, height);\r\n      return path.toString();\r\n    };\r\n\r\n    s.select(\".bucket-mask-path\").attr(\"d\", getPath(drawFunc));\r\n    s.select(\".bucket-outline\").attr(\"d\", getPath(drawOutlineFunc));\r\n  };\r\n}\r\n\r\nfunction drawBucketMask(context, width, height) {\r\n  drawBucket(context, width, height, true);\r\n}\r\n\r\nfunction drawBucketOutline(context, width, height) {\r\n  drawBucket(context, width, height, false);\r\n}\r\n\r\nfunction drawBucket(context, width, height, closed) {\r\n  const taper = 0.8;\r\n  const bottomRight = (width * taper) / 2,\r\n    bottomLeft = -(width * taper) / 2;\r\n\r\n  context.moveTo(width / 2, -height / 2);\r\n  context.lineTo(bottomRight, height / 2);\r\n  context.lineTo(bottomLeft, height / 2);\r\n  context.lineTo(-width / 2, -height / 2);\r\n\r\n  if (closed) context.closePath();\r\n}\r\n\r\nfunction drawDroplet(context, width, height) {\r\n  const hypToRad = Math.SQRT2;\r\n\r\n  // dimensions in \"rad\" units\r\n  const dropHeight = 1 + 1 * hypToRad;\r\n\r\n  const radToHeight = 1 / dropHeight;\r\n\r\n  const rad = Math.min(width / 2, height * radToHeight);\r\n  const hyp = rad / (1 / hypToRad);\r\n  const heightActual = rad + hyp;\r\n\r\n  context.moveTo(0, -heightActual / 2);\r\n  context.lineTo(hyp / 2, -heightActual / 2 + hyp / 2);\r\n  context.arc(0, -heightActual / 2 + hyp, rad, -Math.PI / 4, (Math.PI * 5) / 4);\r\n  context.closePath();\r\n}\r\n\r\nexport {\r\n  bucketGlyph,\r\n  transitionSway,\r\n  bucketShape,\r\n  bucketShapeMask,\r\n  drawBucketMask,\r\n  drawBucketOutline,\r\n  drawDroplet,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport { drawBucketMask } from \"./bucket-glyph\";\r\n\r\nfunction distributeQuantiles(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\nconst interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n\r\nfunction levelToDropletLevel(p) {\r\n  p -= 0.0088;\r\n  return Math.min(\r\n    1,\r\n    Math.max(\r\n      0,\r\n      (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326\r\n    )\r\n  );\r\n}\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nfunction ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nfunction bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  const getPath = (fn) => {\r\n    const path = d3.path();\r\n    fn(path, width, height);\r\n    return path.toString();\r\n  };\r\n\r\n  return getPath(drawBucketMask);\r\n}\r\n\r\nfunction collideOffsetter(data, size) {\r\n  const isTooClose = (i) => {\r\n    if (i == 0) return false;\r\n    return Math.abs(data[i - 1].y - data[i].y) < size;\r\n  };\r\n\r\n  let curXOffset = 0;\r\n\r\n  const xOffset = (i) => {\r\n    if (isTooClose(i)) return ++curXOffset * -3;\r\n    return (curXOffset = 0);\r\n  };\r\n\r\n  return xOffset;\r\n}\r\n\r\nexport {\r\n  distributeQuantiles,\r\n  interpolateWatercolorBlue,\r\n  levelToDropletLevel,\r\n  WATERDROP_ICON,\r\n  ticksExact,\r\n  bucketPath,\r\n  collideOffsetter,\r\n};\r\n","import { BiCross, BiFilter, BiNetworkChart } from \"react-icons/bi\";\nimport { isState } from \"utils/misc-utils\";\n\nexport function ActionButtons({\n  appCtx,\n  handleClickFilter,\n  handleClickExamine,\n  handleClickDeselectAll,\n  handleClickCompare,\n}) {\n  let filterBtn, examineBtn, compareBtn;\n\n  if (isState(appCtx.state, \"WideView\")) {\n    filterBtn = (\n      <button\n        onClick={handleClickFilter}\n        className=\"wide-view-action-btn fancy-font\"\n      >\n        <BiFilter />\n        <span>Filter</span>\n      </button>\n    );\n    if (appCtx.activeWaterdrops.length === 1) {\n      examineBtn = (\n        <button\n          onClick={handleClickExamine}\n          className=\"wide-view-action-btn fancy-font\"\n        >\n          <BiCross />\n          <span>examine</span>\n        </button>\n      );\n    } else if (appCtx.activeWaterdrops.length) {\n      compareBtn = (\n        <>\n          <button\n            onClick={handleClickCompare}\n            className=\"wide-view-action-btn fancy-font\"\n          >\n            <BiNetworkChart />\n            <span>compare</span>\n          </button>\n          <button\n            onClick={handleClickDeselectAll}\n            className=\"fancy-font supplement-btn\"\n          >\n            <span>deselect all</span>\n          </button>\n        </>\n      );\n    }\n  }\n\n  return (\n    <>\n      {filterBtn}\n      {examineBtn}\n      {compareBtn}\n    </>\n  );\n}\n","import * as d3 from \"d3\";\nimport { useLayoutEffect, useRef } from \"react\";\n\nimport {\n  bucketGlyph,\n  bucketShape,\n  drawDroplet,\n  transitionSway,\n} from \"bucket-lib/bucket-glyph\";\nimport {\n  interpolateWatercolorBlue,\n  levelToDropletLevel,\n  ticksExact,\n} from \"bucket-lib/utils\";\n\nconst LEVELS = 10;\n\nfunction drawBottle(context, width, height) {\n  const bottleWidth = height / 2;\n  const capWidth = (bottleWidth * 2) / 3;\n  const capHeight = capWidth / 2;\n  const cornerRad = capHeight / 3;\n  const capCornerRad = cornerRad / 2;\n\n  context.moveTo(capWidth / 2, -height / 2);\n  context.lineTo(-bottleWidth / 2 + cornerRad, -height / 2);\n  context.arc(\n    -bottleWidth / 2 + cornerRad,\n    -height / 2 + cornerRad,\n    cornerRad,\n    (Math.PI * 3) / 2,\n    Math.PI,\n    true\n  );\n  context.lineTo(-bottleWidth / 2, height / 2 - cornerRad);\n  context.arc(\n    -bottleWidth / 2 + cornerRad,\n    height / 2 - cornerRad,\n    cornerRad,\n    Math.PI,\n    Math.PI / 2,\n    true\n  );\n  context.lineTo(bottleWidth / 2 - cornerRad, height / 2);\n  context.arc(\n    bottleWidth / 2 - cornerRad,\n    height / 2 - cornerRad,\n    cornerRad,\n    Math.PI / 2,\n    0,\n    true\n  );\n  context.lineTo(bottleWidth / 2, -height / 2 + cornerRad);\n  context.arc(\n    bottleWidth / 2 - cornerRad,\n    -height / 2 + cornerRad,\n    cornerRad,\n    0,\n    (Math.PI * 3) / 2,\n    true\n  );\n  context.lineTo(capWidth / 2, -height / 2);\n  context.lineTo(capWidth / 2, -height / 2 - capHeight + capCornerRad);\n  context.arc(\n    capWidth / 2 - capCornerRad,\n    -height / 2 - capHeight + capCornerRad,\n    capCornerRad,\n    0,\n    (Math.PI * 3) / 2,\n    true\n  );\n  context.lineTo(-capWidth / 2 + capCornerRad, -height / 2 - capHeight);\n  context.arc(\n    -capWidth / 2 + capCornerRad,\n    -height / 2 - capHeight + capCornerRad,\n    capCornerRad,\n    (Math.PI * 3) / 2,\n    Math.PI,\n    true\n  );\n  context.lineTo(-capWidth / 2, -height / 2);\n}\n\nfunction drawBottleCap(context, width, bottleHeight) {\n  const bottleWidth = bottleHeight / 2;\n  const capWidth = (bottleWidth * 2) / 3;\n  const capHeight = capWidth / 2;\n  const cornerRad = capHeight / 3;\n  const capCornerRad = cornerRad / 2;\n\n  context.moveTo(capWidth / 2, -bottleHeight / 2);\n  context.lineTo(capWidth / 2, -bottleHeight / 2 - capHeight + capCornerRad);\n  context.arc(\n    capWidth / 2 - capCornerRad,\n    -bottleHeight / 2 - capHeight + capCornerRad,\n    capCornerRad,\n    0,\n    (Math.PI * 3) / 2,\n    true\n  );\n  context.lineTo(-capWidth / 2 + capCornerRad, -bottleHeight / 2 - capHeight);\n  context.arc(\n    -capWidth / 2 + capCornerRad,\n    -bottleHeight / 2 - capHeight + capCornerRad,\n    capCornerRad,\n    (Math.PI * 3) / 2,\n    Math.PI,\n    true\n  );\n  context.lineTo(-capWidth / 2, -bottleHeight / 2);\n  context.closePath();\n}\n\nexport default function BottleGlyph({\n  levelInterp,\n  maxValue = 100,\n  colorInterp = interpolateWatercolorBlue,\n  width = 200,\n  height = 400,\n  resolution = LEVELS,\n}) {\n  const LINE_WIDTH = 3;\n  const GLYPH_MARGIN = {\n    top: LINE_WIDTH / 2 + height / 6,\n    right: LINE_WIDTH / 2,\n    bottom: LINE_WIDTH / 2,\n    left: LINE_WIDTH / 2,\n  };\n\n  const svgElement = useRef();\n\n  useLayoutEffect(function initialize() {\n    const svgContainer = svgElement.current\n      .attr(\"width\", width + GLYPH_MARGIN.left + GLYPH_MARGIN.right)\n      .attr(\"height\", height + GLYPH_MARGIN.top + GLYPH_MARGIN.bottom)\n      .append(\"g\")\n      .attr(\"class\", \"bucket\")\n      .attr(\"transform\", `translate(${GLYPH_MARGIN.left},${GLYPH_MARGIN.top})`);\n\n    svgContainer.call(bucketShape(width, height, drawBottle));\n\n    const path = d3.path();\n    drawBottleCap(path, width, height);\n\n    svgContainer\n      .append(\"path\")\n      .attr(\"class\", \"bottlecap\")\n      .attr(\"transform\", `translate(${width / 2}, ${height / 2})`)\n      .attr(\"stroke\", \"none\")\n      .attr(\"fill\", \"lightgray\")\n      .attr(\"d\", path.toString());\n\n    svgContainer\n      .append(\"g\")\n      .attr(\"class\", \"bottle-axis\")\n      .attr(\"transform\", `translate(${width / 2 - height / 8}, ${height / 2})`);\n  }, []);\n\n  useLayoutEffect(\n    function onDataChange() {\n      const maxHeight = 0.95;\n      const liquidLevels = ticksExact(0, 1, resolution + 1).map(\n        (d) => levelInterp(d) * maxHeight\n      );\n\n      const glyph = bucketGlyph(width, height);\n\n      const x = d3\n        .scaleLinear()\n        .domain([maxValue * 0.05, maxValue])\n        .range([\n          height / 2 - height * maxHeight * 0.05,\n          height / 2 - height * maxHeight,\n        ]);\n\n      svgElement.current\n        .select(\".bottle-axis\")\n        .call(\n          d3.axisRight(x).ticks(4).tickSize(12).tickFormat(d3.format(\".2s\"))\n        );\n\n      const liquids = svgElement.current\n        .select(\".masked-area\")\n        .selectAll(\".bucket-box\")\n        .data(glyph(liquidLevels))\n        .join(\"rect\")\n        .attr(\"class\", \"bucket-box\")\n        .attr(\"width\", (d) => d.width)\n        .attr(\"height\", (d) => d.height)\n        .attr(\"x\", (d) => d.x)\n        .attr(\"fill\", (_, i) => colorInterp(i / resolution));\n\n      transitionSway(liquids, 200 / height).attr(\"y\", (d) => d.y);\n    },\n    [levelInterp]\n  );\n\n  return (\n    <div className=\"bottle-wrapper\">\n      <svg ref={(e) => void (svgElement.current = d3.select(e))}></svg>\n    </div>\n  );\n}\n","import { constants } from \"utils/tutorialview-utils\";\r\nimport TaggedBottleGlyph from \"./TaggedBottleGlyph\";\r\n\r\nexport function BucketCreationGraphics({ id, bucketInterper, label }) {\r\n  return (\r\n    <div className=\"tut-graph\">\r\n      <svg id={id}></svg>\r\n      <TaggedBottleGlyph\r\n        levelInterp={bucketInterper}\r\n        maxValue={constants.MAX_DELIVS}\r\n        width={300}\r\n        height={constants.BAR_CHART_HEIGHT}\r\n        resolution={4}\r\n      />\r\n      <p className=\"fancy-font objective-label\">{label}</p>\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\n\nexport function CallToExploreSection({ onClick }) {\n  return (\n    <div className=\"cte\" id=\"cte\">\n      <div className=\"cte-container\">\n        Thus, tradeoffs must often be made when managing California's water\n        supply. What are the ways we can manage California's water, and how do\n        their outcomes compare? Go to the next step to find out!\n        <button className=\"fancy-font\" onClick={onClick}>\n          click to explore!\n        </button>\n      </div>\n    </div>\n  );\n}\n","import React, { forwardRef } from \"react\";\n\nexport const CardBBox = forwardRef(function CardBBox({ id, children }, ref) {\n  return (\n    <div id={id} ref={ref} className=\"tut-text-card-wrapper\">\n      <div className=\"tut-text-card\">\n        <div className=\"tut-text-card-container\">{children}</div>\n      </div>\n    </div>\n  );\n});\n","import React from \"react\";\nimport { CompareBucketCreationsGraphics } from \"components/CompareBucketCreationsGraphics\";\nimport { CompareBucketCreationsText } from \"components/CompareBucketCreationsText\";\n\nexport function CompareBucketCreationsBackground({ appCtx, storyVars }) {\n    return (\n        <>\n            <div className=\"create-buckets-section\">\n                <CompareBucketCreationsText />\n                <CompareBucketCreationsGraphics\n                    storyVars={storyVars}\n                    size={appCtx.appHeight * 0.4} />\n            </div>\n        </>\n    );\n}\n","import React from \"react\";\nimport { constants } from \"utils/tutorialview-utils\";\nimport { descriptionsData } from \"data/descriptions-tutorial-data\";\nimport { BucketCreationGraphics } from \"components/BucketCreationGraphics\";\n\nexport function CompareBucketCreationsGraphics({ storyVars }) {\n    return (\n        <div className=\"tut-graph-wrapper\">\n            <BucketCreationGraphics\n                id={\"pag-bar-graph\"}\n                label={descriptionsData[constants.PAG_OBJECTIVE].display_name}\n                bucketInterper={storyVars.bucketInterperPAG} />\n            <BucketCreationGraphics\n                id={\"prf-bar-graph\"}\n                label={descriptionsData[constants.PRF_OBJECTIVE].display_name}\n                bucketInterper={storyVars.bucketInterperPRF} />\n        </div>\n    );\n}\n","import React from \"react\";\n\nexport function CompareBucketCreationsText() {\n  return (\n    <>\n      <h2>From Bar Graphs to Bottles</h2>\n      <p>\n        This is the average yearly amount of water each group receives,\n        specifically from the <b>Central Valley Project</b>, one of two water\n        municipalities in California.\n      </p>\n      <ul className=\"ag-annot\">\n        <li>higher water supply</li>\n        <li>but more likely to be around 300-500 TAF</li>\n      </ul>\n      <ul className=\"ref-annot\">\n        <li>consistently lower water supply</li>\n      </ul>\n    </>\n  );\n}\n","import React from \"react\";\nimport { constants } from \"utils/tutorialview-utils\";\nimport { descriptionsData } from \"data/descriptions-tutorial-data\";\nimport { objectivesData } from \"data/objectives-tutorial-data\";\nimport { VariationWaterdropGraphics } from \"components/VariationWaterdropGraphics\";\nimport { MainWaterdropGraphics } from \"components/MainWaterdropGraphics\";\n\nexport function CompareScenariosGraphics({ storyVars, size }) {\n  return (\n    <div className=\"tut-drop-graphics-wrapper\">\n      <h2>Seeing Scenarios</h2>\n      <div className=\"waterdrop-graphics-wrapper\">\n        <MainWaterdropGraphics\n          objectiveLabel={\n            descriptionsData[constants.PAG_OBJECTIVE].display_name\n          }\n          dropInterper={storyVars.dropInterper}\n          histData={constants.PAG_DELIVS}\n          histRange={[0, objectivesData.MAX_DELIVS]}\n          goal={storyVars.userGoal}\n          setGoal={(newGoal) => {\n            storyVars.setUserGoal(newGoal);\n          }}\n          size={size}\n        />\n        <VariationWaterdropGraphics\n          variations={constants.DROP_VARIATIONS.map((variation) => ({\n            ...variation,\n            interper: storyVars.variationInterpers[variation.idx],\n            histData: constants.VARIATIONS_DELIVS[variation.idx],\n          }))}\n          goal={storyVars.userGoal}\n          setGoal={(newGoal) => {\n            storyVars.setUserGoal(newGoal);\n          }}\n          histRange={[0, objectivesData.MAX_DELIVS]}\n          size={size}\n        />\n      </div>\n      <div className=\"tut-comparer-graphics-wrapper\">\n        <p className=\"bigdrop-describe\">\n          These are all 600 possible scenarios sorted bottom-to-top by\n          decreasing average deliveries.\n        </p>\n        <svg id=\"comparer-graphics\"></svg>\n      </div>\n    </div>\n  );\n}\n","import React from \"react\";\nimport { getConnectStyle } from \"utils/render-utils\";\n\nexport function ConnectLine({ connectLine }) {\n  if (!connectLine) return;\n\n  return (\n    <div className=\"connect-line\" style={getConnectStyle(...connectLine)}>\n      <div className=\"connect-line-container\"></div>\n    </div>\n  );\n}\n","import * as d3 from \"d3\";\nimport React from \"react\";\nimport { Scrollama } from \"react-scrollama\";\n\nexport function DataStoryScrollama({ onSlideEnter, onSlideExit, children }) {\n  const onStepEnter = async (args) => {\n    onSlideEnter(args);\n    if (args.direction === \"up\") return;\n    args.data.animHandler?.do();\n  };\n\n  const onStepExit = async (args) => {\n    onSlideExit(args);\n    if (args.direction === \"down\") return;\n    args.data.animHandler?.undo();\n  };\n\n  const onStepProgress = async ({ data, direction, element, progress }) => {\n    d3.select(element)\n      .select(\"div\")\n      .style(\n        \"transform\",\n        `translateY(${d3\n          .scaleLinear()\n          .domain([0, 0.2, 0.8, 1])\n          .range([200, 0, 0, 200])(progress)}%)`\n      )\n      .style(\n        \"opacity\",\n        `${d3.scaleLinear().domain([0, 0.2, 0.8, 1]).range([0, 1, 1, 0])(\n          progress\n        )}`\n      );\n  };\n\n  return (\n    <Scrollama\n      offset={0.8}\n      onStepEnter={onStepEnter}\n      onStepExit={onStepExit}\n      onStepProgress={onStepProgress}\n      threshold={1}\n    >\n      {children}\n    </Scrollama>\n  );\n}\n","import * as d3 from \"d3\";\r\nimport { distributeQuantiles } from \"./utils\";\r\n\r\n// inclusive\r\nfunction ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nfunction quantileBins(\r\n  width,\r\n  height,\r\n  unitsPerQuantile = undefined,\r\n  range = undefined\r\n) {\r\n  return function (data) {\r\n    unitsPerQuantile = unitsPerQuantile || 1;\r\n    range = range || d3.extent(data);\r\n\r\n    const numQuantiles = data.length / unitsPerQuantile;\r\n    const histBins = d3\r\n      .bin()\r\n      .value((d) => d)\r\n      .domain(range)\r\n      .thresholds(\r\n        ticksExact(...range, Math.ceil(width / (height / numQuantiles)))\r\n      )(data);\r\n\r\n    const binnedQuantiles = distributeQuantiles(\r\n      histBins,\r\n      unitsPerQuantile,\r\n      numQuantiles\r\n    );\r\n\r\n    const quantiles = [];\r\n\r\n    for (let b = 0; b < binnedQuantiles.length; b++) {\r\n      for (let y = 0; y < binnedQuantiles[b]; y++) {\r\n        quantiles.push([\r\n          (histBins[b].x1 + histBins[b].x0) / 2,\r\n          ((y + 0.5) / numQuantiles) * data.length,\r\n        ]);\r\n      }\r\n    }\r\n\r\n    return quantiles;\r\n  };\r\n}\r\n\r\nexport { quantileBins };\r\n","import * as d3 from \"d3\";\r\nimport { useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport { quantileBins } from \"bucket-lib/quantile-bins\";\r\n\r\nimport { clamp } from \"utils/math-utils\";\r\n\r\nconst NUM_CIRCLES = 20;\r\nconst MARGIN = { top: 20, right: 20, bottom: 45, left: 20 };\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport default function DotHistogram({\r\n  data,\r\n  range = [0, d3.max(data)],\r\n  goal,\r\n  setGoal,\r\n  width = 600,\r\n  height = 400,\r\n  shortForm = false,\r\n}) {\r\n  const razorElement = useRef();\r\n  const razorAreaElement = useRef();\r\n\r\n  const svgSelector = useRef();\r\n  const circles = useMemo(\r\n    () => quantileBins(width, height, data.length / NUM_CIRCLES, range)(data),\r\n    [data]\r\n  );\r\n\r\n  const dataRange = [0, data.length];\r\n  const x = d3.scaleLinear().domain(range).range([0, width]);\r\n  const y = d3.scaleLinear().domain(dataRange).range([height, 0]);\r\n  const count = circles.filter((d) => d[0] > goal).length;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width + MARGIN.left + MARGIN.right)\r\n      .attr(\"height\", height + MARGIN.top + MARGIN.bottom)\r\n      .style(\"pointer-events\", \"none\")\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${MARGIN.left},${MARGIN.top})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(\r\n        d3\r\n          .axisBottom()\r\n          .scale(d3.scaleLinear().domain(range).range([0, width]))\r\n          .ticks(8)\r\n          .tickFormat(d3.format(\".2s\"))\r\n      )\r\n      .call((s) => {\r\n        s.selectAll(\"line\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"path\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"text\").attr(\"fill\", \"gray\");\r\n      })\r\n      .append(\"text\")\r\n      .attr(\"fill\", \"black\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${40})`)\r\n      .text(\"Delivery (TAF)\");\r\n\r\n    razorElement.current.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(range)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n\r\n    const ignoreFn = (e) => e.preventDefault();\r\n    let dragging = false;\r\n\r\n    razorElement.current.addEventListener(\"mousedown\", () => {\r\n      dragging = true;\r\n      window.addEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", () => {\r\n      dragging = false;\r\n      window.removeEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    razorAreaElement.current.addEventListener(\"mousemove\", (e) => {\r\n      if (dragging && e.target === razorAreaElement.current) {\r\n        const razorPos = clamp(e.offsetX, MARGIN.left, MARGIN.left + width);\r\n        d3.select(razorElement.current).style(\r\n          \"transform\",\r\n          `translateX(${razorPos}px)`\r\n        );\r\n\r\n        setGoal(\r\n          d3\r\n            .scaleLinear()\r\n            .domain([MARGIN.left, width + MARGIN.left])\r\n            .range(range)\r\n            .clamp(true)(e.offsetX)\r\n        );\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  useLayoutEffect(() => {\r\n    const svgCircles = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".icons\")\r\n      .data(circles)\r\n      .join((enter) => enter.append(\"g\").call((s) => s.append(\"path\")))\r\n      .attr(\"class\", \"icons\")\r\n      .call((s) => {\r\n        s.selectAll(\"path\").attr(\r\n          \"d\",\r\n          d3.symbol(WATERDROP_ICON, height / NUM_CIRCLES)\r\n        );\r\n      });\r\n\r\n    svgCircles\r\n      .attr(\"transform\", (d) => `translate(${x(d[0])},${y(d[1])})`)\r\n      .attr(\"fill\", (d) => (d[0] > goal ? \"steelblue\" : \"black\"));\r\n\r\n    razorElement.current.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(range)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n  }, [goal, circles]);\r\n\r\n  return (\r\n    <div\r\n      className={`dot-histogram-wrapper`}\r\n      ref={(e) => (razorAreaElement.current = e)}\r\n    >\r\n      <div\r\n        className={`pdf-razor ` + (shortForm ? \"short-form\" : \"\")}\r\n        ref={(e) => (razorElement.current = e)}\r\n      >\r\n        <div>\r\n          <span>\r\n            <u>\r\n              {circles.length - count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL NOT meet demand\"}\r\n          </span>\r\n          <span>\r\n            <u>\r\n              {count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL meet demand\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\nimport DropletGlyph from \"components/DropletGlyph\";\nimport DotHistogram from \"components/DotHistogram\";\nimport BottleGlyph from \"./BottleGlyph\";\n\nexport function MainWaterdropGraphics({\n  objectiveLabel,\n  dropInterper,\n  histData,\n  histRange,\n  goal,\n  setGoal,\n  size,\n}) {\n  return (\n    <>\n      <div className=\"main-waterdrop\">\n        <BottleGlyph\n          levelInterp={dropInterper}\n          maxValue={histRange[1]}\n          width={size}\n          height={size}\n          resolution={4}\n        />\n        <p className=\"var-scen-label\">\n          scenario <span className=\"scen-number\">{\"0000\"}</span>\n        </p>\n        <p className=\"fancy-font objective-label\">{objectiveLabel}</p>\n      </div>\n      <div className=\"main-histogram\">\n        <DotHistogram\n          width={size}\n          height={(size * 2) / 3}\n          data={histData}\n          range={histRange}\n          goal={goal}\n          setGoal={setGoal}\n        />\n      </div>\n    </>\n  );\n}\n","import * as d3 from \"d3\";\nimport React, { useEffect } from \"react\";\nimport { constants } from \"utils/tutorialview-utils\";\nimport { spatialData } from \"data/spatial-data\";\n\nexport function MapCalifornia({ }) {\n    useEffect(function initialize() {\n        const height = window.innerHeight, width = height * 0.9;\n\n        const drawnRegions = [constants.PAG_OBJECTIVE, constants.PRF_OBJECTIVE];\n\n        const minimap = d3\n            .select(\"#tut-map-california\")\n            .attr(\"width\", width)\n            .attr(\"height\", height);\n\n        const proj = d3\n            .geoMercator()\n            .scale((3000 * height) / 800)\n            .center(spatialData.CALIFORNIA_CENTER)\n            .translate([width / 2, height / 2]);\n\n        const lineGeom = [\n            ...spatialData.SPATIAL_DATA.features.filter((f) => drawnRegions.includes(f.properties.CalLiteID)\n            ),\n            spatialData.CALIFORNIA_OUTLINE,\n        ];\n\n        minimap\n            .selectAll(\"path\")\n            .data(lineGeom)\n            .join(\"path\")\n            .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\n            .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\n            .attr(\"stroke\", 'transparent')\n            .attr(\"stroke-width\", 1)\n            .style(\"transform-origin\", (d) => {\n                const [x, y] = proj(d.geometry.coordinates[0][0][0]);\n\n                return `${x}px ${y}px`;\n            })\n            .attr(\"fill\", \"#EFEBE0\")\n            .style('filter', 'drop-shadow(6px 6px 18px rgba(0, 0, 0, 0.3))');\n\n        minimap\n            .select(`.${constants.PAG_OBJECTIVE}`)\n            .attr(\"fill\", constants.PAG_COLOR)\n            .raise();\n        minimap\n            .select(`.${constants.PRF_OBJECTIVE}`)\n            .attr(\"fill\", constants.PRF_COLOR).raise();\n    }, []);\n\n    return <svg className=\"tut-map-california\" id=\"tut-map-california\"></svg>;\n}\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport { SETT_DESC, SETT_NAME_FULL, SETT_VAL_STEPS } from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingStickers({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings comp-settings\">\r\n      {settings.map((v, i) => (\r\n        <div\r\n          className=\"full-card\"\r\n          onMouseEnter={() => setColorSetting(i)}\r\n          onMouseLeave={() => setColorSetting(null)}\r\n          key={i}\r\n          title={SETT_DESC[i]}\r\n        >\r\n          <span>{SETT_NAME_FULL[i]}</span>\r\n          <span>{SETT_VAL_STEPS[i][v]}</span>\r\n          <div className=\"sett-dot-wrapper\">\r\n            {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n              <span\r\n                className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport {\r\n  SETT_NAME_SHORT,\r\n  SETT_NAME_FULL,\r\n  SETT_VAL_STEPS,\r\n  SETT_DESC,\r\n} from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingSubcard({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings\">\r\n      <div className=\"condense\">\r\n        {settings.map((v, i) => (\r\n          <div className=\"sett-dot-wrapper\" key={i}>\r\n            <span>{SETT_NAME_SHORT[i]}</span>\r\n            {d3.range(v + 1).map((j) => (\r\n              <span\r\n                className=\"sett-dot\"\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"full\">\r\n        <div className=\"full-container\">\r\n          <span>The settings for this scenario are:</span>\r\n          {settings.map((v, i) => (\r\n            <div\r\n              className=\"full-card\"\r\n              onMouseEnter={() => setColorSetting(i)}\r\n              onMouseLeave={() => setColorSetting(null)}\r\n              key={i}\r\n              title={SETT_DESC[i]}\r\n            >\r\n              <span>{SETT_NAME_FULL[i]}</span>\r\n              <span>{SETT_VAL_STEPS[i][v]}</span>\r\n              <div className=\"sett-dot-wrapper\">\r\n                {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n                  <span\r\n                    className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                    key={j}\r\n                    style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n                  ></span>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\nimport React, { useEffect } from \"react\";\n\nexport function SkipBtn({ onClick }) {\n    useEffect(function mountFadeOutEffect() {\n        const startPos = document.documentElement.scrollTop;\n        const buffer = 50;\n\n        window.addEventListener(\"scroll\", function () {\n            const curPos = document.documentElement.scrollTop;\n            const opac = Math.max(0, 1 - (curPos - startPos) / buffer);\n\n            d3.select(\".skip-btn\").style(\"opacity\", opac);\n        });\n    }, []);\n    return (\n        <button className=\"skip-btn\" onClick={onClick}>\n            Skip intro\n        </button>\n    );\n}\n","import * as d3 from \"d3\";\nimport { useLayoutEffect, useRef } from \"react\";\n\nimport {\n  bucketGlyph,\n  bucketShape,\n  drawDroplet,\n  transitionSway,\n} from \"bucket-lib/bucket-glyph\";\nimport {\n  collideOffsetter,\n  interpolateWatercolorBlue,\n  levelToDropletLevel,\n  ticksExact,\n} from \"bucket-lib/utils\";\n\nconst LEVELS = 10;\n\nfunction drawBottle(context, width, height) {\n  const bottleWidth = height / 2;\n  const capWidth = (bottleWidth * 2) / 3;\n  const capHeight = capWidth / 2;\n  const cornerRad = capHeight / 3;\n  const capCornerRad = cornerRad / 2;\n\n  context.moveTo(capWidth / 2, -height / 2);\n  context.lineTo(-bottleWidth / 2 + cornerRad, -height / 2);\n  context.arc(\n    -bottleWidth / 2 + cornerRad,\n    -height / 2 + cornerRad,\n    cornerRad,\n    (Math.PI * 3) / 2,\n    Math.PI,\n    true\n  );\n  context.lineTo(-bottleWidth / 2, height / 2 - cornerRad);\n  context.arc(\n    -bottleWidth / 2 + cornerRad,\n    height / 2 - cornerRad,\n    cornerRad,\n    Math.PI,\n    Math.PI / 2,\n    true\n  );\n  context.lineTo(bottleWidth / 2 - cornerRad, height / 2);\n  context.arc(\n    bottleWidth / 2 - cornerRad,\n    height / 2 - cornerRad,\n    cornerRad,\n    Math.PI / 2,\n    0,\n    true\n  );\n  context.lineTo(bottleWidth / 2, -height / 2 + cornerRad);\n  context.arc(\n    bottleWidth / 2 - cornerRad,\n    -height / 2 + cornerRad,\n    cornerRad,\n    0,\n    (Math.PI * 3) / 2,\n    true\n  );\n  context.lineTo(capWidth / 2, -height / 2);\n  context.lineTo(capWidth / 2, -height / 2 - capHeight + capCornerRad);\n  context.arc(\n    capWidth / 2 - capCornerRad,\n    -height / 2 - capHeight + capCornerRad,\n    capCornerRad,\n    0,\n    (Math.PI * 3) / 2,\n    true\n  );\n  context.lineTo(-capWidth / 2 + capCornerRad, -height / 2 - capHeight);\n  context.arc(\n    -capWidth / 2 + capCornerRad,\n    -height / 2 - capHeight + capCornerRad,\n    capCornerRad,\n    (Math.PI * 3) / 2,\n    Math.PI,\n    true\n  );\n  context.lineTo(-capWidth / 2, -height / 2);\n}\n\nfunction drawBottleCap(context, width, bottleHeight) {\n  const bottleWidth = bottleHeight / 2;\n  const capWidth = (bottleWidth * 2) / 3;\n  const capHeight = capWidth / 2;\n  const cornerRad = capHeight / 3;\n  const capCornerRad = cornerRad / 2;\n\n  context.moveTo(capWidth / 2, -bottleHeight / 2);\n  context.lineTo(capWidth / 2, -bottleHeight / 2 - capHeight + capCornerRad);\n  context.arc(\n    capWidth / 2 - capCornerRad,\n    -bottleHeight / 2 - capHeight + capCornerRad,\n    capCornerRad,\n    0,\n    (Math.PI * 3) / 2,\n    true\n  );\n  context.lineTo(-capWidth / 2 + capCornerRad, -bottleHeight / 2 - capHeight);\n  context.arc(\n    -capWidth / 2 + capCornerRad,\n    -bottleHeight / 2 - capHeight + capCornerRad,\n    capCornerRad,\n    (Math.PI * 3) / 2,\n    Math.PI,\n    true\n  );\n  context.lineTo(-capWidth / 2, -bottleHeight / 2);\n  context.closePath();\n}\n\nconst PERCENTILE_LABELS = [\n  \"Maximum\",\n  \"75th Percentile\",\n  \"50th Percentile\",\n  \"25th Percentile\",\n  \"Minimum\",\n];\n\nexport default function TaggedBottleGlyph({\n  levelInterp,\n  maxValue = 100,\n  colorInterp = interpolateWatercolorBlue,\n  width = 200,\n  height = 400,\n  resolution = LEVELS,\n}) {\n  const LINE_WIDTH = 3;\n  const GLYPH_MARGIN = {\n    top: LINE_WIDTH / 2 + height / 6,\n    right: LINE_WIDTH / 2,\n    bottom: LINE_WIDTH / 2 + 20,\n    left: 180,\n  };\n\n  const svgElement = useRef();\n\n  useLayoutEffect(function initialize() {\n    const svgContainer = svgElement.current\n      .attr(\"width\", width + GLYPH_MARGIN.left + GLYPH_MARGIN.right)\n      .attr(\"height\", height + GLYPH_MARGIN.top + GLYPH_MARGIN.bottom)\n      .append(\"g\")\n      .attr(\"class\", \"bucket\")\n      .attr(\"transform\", `translate(${GLYPH_MARGIN.left},${GLYPH_MARGIN.top})`);\n\n    svgContainer.call(bucketShape(width, height, drawBottle));\n\n    const path = d3.path();\n    drawBottleCap(path, width, height);\n\n    svgContainer\n      .append(\"path\")\n      .attr(\"class\", \"bottlecap\")\n      .attr(\"transform\", `translate(${width / 2}, ${height / 2})`)\n      .attr(\"stroke\", \"none\")\n      .attr(\"fill\", \"lightgray\")\n      .attr(\"d\", path.toString());\n\n    svgContainer\n      .append(\"g\")\n      .attr(\"class\", \"bottle-axis\")\n      .attr(\"transform\", `translate(${width / 2 - height / 8}, ${height / 2})`);\n  }, []);\n\n  useLayoutEffect(\n    function onDataChange() {\n      const maxHeight = 0.95;\n      const liquidLevels = ticksExact(0, 1, resolution + 1).map(\n        (d) => levelInterp(d) * maxHeight\n      );\n\n      const glyph = bucketGlyph(width, height);\n      const data = glyph(liquidLevels);\n\n      const x = d3\n        .scaleLinear()\n        .domain([maxValue * 0.05, maxValue])\n        .range([\n          height / 2 - height * maxHeight * 0.05,\n          height / 2 - height * maxHeight,\n        ]);\n\n      svgElement.current\n        .select(\".bottle-axis\")\n        .call(\n          d3.axisRight(x).ticks(4).tickSize(12).tickFormat(d3.format(\".2s\"))\n        );\n\n      const liquids = svgElement.current\n        .select(\".masked-area\")\n        .selectAll(\".bucket-box\")\n        .data(data)\n        .join(\"rect\")\n        .attr(\"class\", \"bucket-box\")\n        .attr(\"width\", (d) => d.width)\n        .attr(\"height\", (d) => d.height)\n        .attr(\"x\", (d) => d.x)\n        .attr(\"fill\", (_, i) => colorInterp(i / resolution));\n\n      transitionSway(liquids, 200 / height).attr(\"y\", (d) => d.y);\n\n      // percentile labels that appear on the side\n      const reverseData = data.reverse();\n\n      const labelWidth = 170,\n        labelHeight = 30;\n\n      const xOffset = collideOffsetter(reverseData, labelHeight);\n\n      const tagElem = (s) =>\n        s.append(\"g\").call((s) => {\n          s.append(\"rect\");\n          s.append(\"text\");\n        });\n\n      const labels = svgElement.current\n        .select(\".bucket\")\n        .selectAll(\".bucket-label\")\n        .data(reverseData)\n        .join(tagElem)\n        .attr(\"class\", \"bucket-label\")\n        .transition()\n        .attr(\n          \"transform\",\n          (d, i) =>\n            `translate(${-labelWidth / 2 - 3 + xOffset(i)}, ${\n              d.y + height / 2\n            })`\n        );\n\n      labels\n        .select(\"text\")\n        .text((_, i) => PERCENTILE_LABELS[data.length - 1 - i])\n        .style(\"fill\", (_, i) => (i > data.length / 2 ? \"black\" : \"white\"));\n\n      labels\n        .select(\"rect\")\n        .attr(\"width\", labelWidth)\n        .attr(\"height\", labelHeight)\n        .attr(\"x\", -labelWidth / 2)\n        .attr(\"y\", -labelHeight / 2)\n        .attr(\"rx\", 8)\n        .style(\"fill\", (_, i) =>\n          colorInterp((data.length - 1 - i) / resolution)\n        );\n    },\n    [levelInterp]\n  );\n\n  return (\n    <div className=\"bottle-wrapper\">\n      <svg ref={(e) => void (svgElement.current = d3.select(e))}></svg>\n    </div>\n  );\n}\n","import React from \"react\";\nimport { SkipBtn } from \"components/SkipBtn\";\nimport { MapCalifornia } from \"components/MapCalifornia\";\n\nexport function TutHero({ appCtx }) {\n  return (\n    <div className=\"tut-hero\" id=\"tut-hero\">\n      <div className=\"tut-hero-container\">\n        <h1>\n          Watering <br /> the Future\n        </h1>\n        <MapCalifornia />\n        <p>\n          Water is limited in California, yet everyone needs it. So how can we\n          deal with the agricultural, environmental, urban, and other water\n          demands of California?\n        </p>\n        <p>\n          To start off, we'll focus on two groups: the{\" \"}\n          <span id=\"ag-group\">agriculture group in the north</span> and the{\" \"}\n          <span id=\"ref-group\">refuge group in the south.</span>\n        </p>\n        <p>\n          Click on the green button on the bottom-right, or scroll through this\n          page, to explore!\n        </p>\n        <SkipBtn onClick={() => appCtx.setState({ state: \"WideView\" })} />\n      </div>\n    </div>\n  );\n}\n","import React from \"react\";\nimport DropletGlyph from \"components/DropletGlyph\";\nimport DotHistogram from \"components/DotHistogram\";\nimport BottleGlyph from \"./BottleGlyph\";\n\nexport function VariationWaterdropGraphics({\n  variations,\n  goal,\n  setGoal,\n  histRange,\n  size,\n}) {\n  return variations.map(({ idx, scen, clas, desc, interper, histData }) => (\n    <div className={`vardrop ${clas}`} key={idx} desc={desc}>\n      <BottleGlyph\n        levelInterp={interper}\n        maxValue={histRange[1]}\n        width={size * 0.7}\n        height={size * 0.7}\n        resolution={4}\n      />\n      <p className=\"var-scen-label\">\n        scenario <span className=\"scen-number\">{scen}</span>\n      </p>\n      <DotHistogram\n        shortForm\n        width={size}\n        height={(size * 2) / 3}\n        data={histData}\n        range={histRange}\n        goal={goal}\n        setGoal={setGoal}\n      />\n    </div>\n  ));\n}\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initDescriptionsData() {\r\n  console.log(\"DATA: loading descriptions data\");\r\n\r\n  const objs = await (await fetch(\"./descriptions.json\")).json();\r\n\r\n  // any data preprocessing goes here. none for now.\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n}\r\n\r\nexport const descriptionsData = await initDescriptionsData();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initDescriptionsData() {\r\n  console.log(\"DATA: loading descriptions tutorial data\");\r\n\r\n  const objs = await (await fetch(\"./descriptions_tutorial.json\")).json();\r\n\r\n  // any data preprocessing goes here. none for now.\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n}\r\n\r\nexport const descriptionsData = await initDescriptionsData();\r\n","import * as d3 from \"d3\";\r\nimport { SETT_NUM_OPTS, deserialize } from \"utils/data-utils\";\r\n\r\nimport { shuffle } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst SCEN_DIVISOR = 1; // debugging purposes, don't render all scenarios to speed things up\r\n\r\nasync function initObjectivesData() {\r\n  const MAX_DELIVS = 1200;\r\n  const SCENARIO_KEY_STRING = \"scens\";\r\n  const DELIV_KEY_STRING = \"delivs\";\r\n  const BASELINE_SCEN = \"expl0000\";\r\n\r\n  const OBJECTIVES_DATA = await (async function load() {\r\n    console.log(\"DATA: loading objectives data\");\r\n\r\n    const objs = await (await fetch(\"./objectives_v3.json\")).json();\r\n\r\n    const chosenScenarios = objs[0][SCENARIO_KEY_STRING].filter(\r\n      (s, i) => i % SCEN_DIVISOR === 0 || s === \"expl0000\"\r\n    ).map(({ name }) => name);\r\n\r\n    for (const obj of objs) {\r\n      // shuffle so clusters of identical scenario results don't get processed deterministically\r\n      const shuffledScens = shuffle(obj[SCENARIO_KEY_STRING]);\r\n\r\n      // iterate backwards to remove unneeded scenarios\r\n      for (let i = shuffledScens.length - 1; i >= 0; i--) {\r\n        const scen = shuffledScens[i];\r\n\r\n        if (chosenScenarios.includes(scen.name)) {\r\n          // sort data since we'll be using ordered data for all our vizes\r\n          scen[DELIV_KEY_STRING].sort(d3.descending);\r\n        } else {\r\n          shuffledScens.splice(i, 1);\r\n        }\r\n      }\r\n\r\n      obj[SCENARIO_KEY_STRING] = mapBy(\r\n        obj[SCENARIO_KEY_STRING],\r\n        ({ name }) => name\r\n      );\r\n    }\r\n\r\n    return mapBy(objs, ({ obj }) => obj);\r\n  })();\r\n\r\n  const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\n  // set default goals to 0TAF, we may want to change this on a per-objective basis\r\n  const OBJECTIVE_GOALS_MAP = (function initDefaults() {\r\n    const goalMap = {};\r\n    for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n      goalMap[OBJECTIVE_IDS[i]] = 0;\r\n    return goalMap;\r\n  })();\r\n\r\n  const SCENARIO_IDS = Object.keys(\r\n    Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n  );\r\n\r\n  const KEY_SETTINGS_MAP = (function preprocessData() {\r\n    const map = {};\r\n    const optArr = Object.values(SETT_NUM_OPTS);\r\n\r\n    for (let i = 0; i < SCENARIO_IDS.length; i++) {\r\n      const key = SCENARIO_IDS[i];\r\n\r\n      map[key] = deserialize(key.slice(4)).map((v, i) => (v + 1) / optArr[i]);\r\n    }\r\n\r\n    return map;\r\n  })();\r\n\r\n  const MIN_MAXES = (function () {\r\n    const minmaxes = {};\r\n\r\n    for (const objective of OBJECTIVE_IDS) {\r\n      const baselineMax = d3.max(\r\n        OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][BASELINE_SCEN][\r\n          DELIV_KEY_STRING\r\n        ]\r\n      );\r\n\r\n      const scenariosMin = d3.min(\r\n        SCENARIO_IDS.map((scenario) =>\r\n          d3.min(\r\n            OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][scenario][\r\n              DELIV_KEY_STRING\r\n            ]\r\n          )\r\n        )\r\n      );\r\n\r\n      // minmaxes[objective] = [scenariosMin, baselineMax];\r\n      minmaxes[objective] = [0, baselineMax];\r\n\r\n      for (const scenario of SCENARIO_IDS) {\r\n        minmaxes[objective][scenario] = d3.extent(\r\n          OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][scenario][\r\n            DELIV_KEY_STRING\r\n          ]\r\n        );\r\n      }\r\n    }\r\n\r\n    return minmaxes;\r\n  })();\r\n\r\n  const RANGE_OF_MINS = (function () {\r\n    const minmaxes = {};\r\n\r\n    for (const objective of OBJECTIVE_IDS) {\r\n      minmaxes[objective] = d3.extent(\r\n        SCENARIO_IDS.map((scenario) =>\r\n          d3.min(\r\n            OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][scenario][\r\n              DELIV_KEY_STRING\r\n            ]\r\n          )\r\n        )\r\n      );\r\n    }\r\n\r\n    return minmaxes;\r\n  })();\r\n\r\n  // Flattening hierarchical data makes it more flexible for classifying.\r\n  // id conveniently corresponds to index.\r\n  // Also cache classifications (by objective and by scenario, for now).\r\n  // TODO: change flattened_data to an iterator type function?\r\n  const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n    const flattenedData = [];\r\n    const dataGroupings = {\r\n      objective: {},\r\n    };\r\n\r\n    // for ordering later\r\n    const means = [];\r\n\r\n    let idx = 0;\r\n    for (const obj of OBJECTIVE_IDS) {\r\n      for (const scen of SCENARIO_IDS) {\r\n        if (!dataGroupings[\"objective\"][obj])\r\n          dataGroupings[\"objective\"][obj] = [];\r\n\r\n        dataGroupings[\"objective\"][obj].push(idx);\r\n\r\n        const deliveries =\r\n          OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n        const minmax = d3.range(deliveries);\r\n\r\n        flattenedData.push({\r\n          id: idx,\r\n          objective: obj,\r\n          scenario: scen,\r\n          deliveries,\r\n          minmax,\r\n        });\r\n\r\n        means.push(d3.mean(deliveries));\r\n\r\n        idx++;\r\n      }\r\n    }\r\n\r\n    const orderedDataGroupings = {};\r\n\r\n    for (const criteria of Object.keys(dataGroupings)) {\r\n      const objScens = [];\r\n      for (const key of Object.keys(dataGroupings[criteria])) {\r\n        const ids = dataGroupings[criteria][key];\r\n        const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n        objScens.push({\r\n          key,\r\n          sorted: sortedObjScens,\r\n          mean: d3.mean(\r\n            ids\r\n              .map((id) => {\r\n                const deliveries = flattenedData[id].deliveries;\r\n                const maxVal = MIN_MAXES[flattenedData[id].objective][1];\r\n                return deliveries.map((delivery) => delivery / maxVal);\r\n              })\r\n              .flat()\r\n          ),\r\n        });\r\n      }\r\n\r\n      const sortedObjScens = objScens.sort((a, b) => b.mean - a.mean);\r\n\r\n      orderedDataGroupings[criteria] = {};\r\n\r\n      for (let i = 0; i < sortedObjScens.length; i++) {\r\n        const { key, sorted } = sortedObjScens[i];\r\n        const keyToRank = {};\r\n\r\n        for (let j = 0; j < sorted.length; j++) {\r\n          keyToRank[flattenedData[sorted[j]].scenario] = j;\r\n        }\r\n        orderedDataGroupings[criteria][key] = keyToRank;\r\n        orderedDataGroupings[criteria][key].rank = i;\r\n      }\r\n    }\r\n\r\n    return [flattenedData, orderedDataGroupings];\r\n  })();\r\n\r\n  return {\r\n    MAX_DELIVS,\r\n    SCENARIO_KEY_STRING,\r\n    DELIV_KEY_STRING,\r\n    BASELINE_SCEN,\r\n    OBJECTIVES_DATA,\r\n    OBJECTIVE_IDS,\r\n    OBJECTIVE_GOALS_MAP,\r\n    SCENARIO_IDS,\r\n    KEY_SETTINGS_MAP,\r\n    MIN_MAXES,\r\n    RANGE_OF_MINS,\r\n    FLATTENED_DATA,\r\n    DATA_GROUPINGS,\r\n  };\r\n}\r\n\r\nexport const objectivesData = await initObjectivesData();\r\n","import * as d3 from \"d3\";\r\nimport { SETT_NUM_OPTS, deserialize } from \"utils/data-utils\";\r\n\r\nimport { shuffle } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initObjectivesData() {\r\n  const MAX_DELIVS = 800;\r\n  const SCENARIO_KEY_STRING = \"scens\";\r\n  const DELIV_KEY_STRING = \"delivs\";\r\n  const BASELINE_YRLY_KEY_STRING = \"baseline_yearly\";\r\n  const BASELINE_SCEN = \"expl0000\";\r\n\r\n  const OBJECTIVES_DATA = await (async function load() {\r\n    console.log(\"DATA: loading objectives tutorial data\");\r\n\r\n    const objs = await (await fetch(\"./objectives_tutorial.json\")).json();\r\n\r\n    for (const obj of objs) {\r\n      // shuffle so clusters of identical scenario results don't get processed deterministically\r\n      for (const scen of shuffle(obj[SCENARIO_KEY_STRING])) {\r\n        // save the baseline yearly data, don't order it\r\n        if (scen[\"name\"] === BASELINE_SCEN) {\r\n          obj[BASELINE_YRLY_KEY_STRING] = Array.from(scen[DELIV_KEY_STRING]);\r\n        }\r\n\r\n        // sort data since we'll be using ordered data for all our vizes\r\n        scen[DELIV_KEY_STRING] = scen[DELIV_KEY_STRING].sort(d3.descending);\r\n      }\r\n      obj[SCENARIO_KEY_STRING] = mapBy(\r\n        obj[SCENARIO_KEY_STRING],\r\n        ({ name }) => name\r\n      );\r\n    }\r\n\r\n    return mapBy(objs, ({ obj }) => obj);\r\n  })();\r\n\r\n  const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\n  const OBJECTIVE_GOALS_MAP = (function initDefaults() {\r\n    const goalMap = {};\r\n    for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n      goalMap[OBJECTIVE_IDS[i]] = 200;\r\n    return goalMap;\r\n  })();\r\n\r\n  const SCENARIO_IDS = Object.keys(\r\n    Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n  );\r\n\r\n  const KEY_SETTINGS_MAP = (function preprocessData() {\r\n    const map = {};\r\n    const optArr = Object.values(SETT_NUM_OPTS);\r\n\r\n    for (let i = 0; i < SCENARIO_IDS.length; i++) {\r\n      const key = SCENARIO_IDS[i];\r\n\r\n      map[key] = deserialize(key.slice(4)).map((v, i) => (v + 1) / optArr[i]);\r\n    }\r\n\r\n    return map;\r\n  })();\r\n\r\n  const MIN_MAXES = (function () {\r\n    const minmaxes = {};\r\n\r\n    for (const objective of OBJECTIVE_IDS) {\r\n      const baselineMax = d3.max(\r\n        OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][BASELINE_SCEN][\r\n          DELIV_KEY_STRING\r\n        ]\r\n      );\r\n\r\n      const scenariosMin = d3.min(\r\n        SCENARIO_IDS.map((scenario) =>\r\n          d3.min(\r\n            OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][scenario][\r\n              DELIV_KEY_STRING\r\n            ]\r\n          )\r\n        )\r\n      );\r\n\r\n      // minmaxes[objective] = [scenariosMin, baselineMax];\r\n      minmaxes[objective] = [0, baselineMax];\r\n    }\r\n\r\n    return minmaxes;\r\n  })();\r\n\r\n  // Flattening hierarchical data makes it more flexible for classifying.\r\n  // id conveniently corresponds to index.\r\n  // Also cache classifications (by objective and by scenario, for now).\r\n  // TODO: change flattened_data to an iterator type function?\r\n  const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n    const flattenedData = [];\r\n    const dataGroupings = {\r\n      objective: {},\r\n    };\r\n\r\n    // for ordering later\r\n    const means = [];\r\n\r\n    let idx = 0;\r\n    for (const obj of OBJECTIVE_IDS) {\r\n      for (const scen of SCENARIO_IDS) {\r\n        if (!dataGroupings[\"objective\"][obj])\r\n          dataGroupings[\"objective\"][obj] = [];\r\n\r\n        dataGroupings[\"objective\"][obj].push(idx);\r\n\r\n        const deliveries =\r\n          OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n        flattenedData.push({\r\n          id: idx,\r\n          objective: obj,\r\n          scenario: scen,\r\n          deliveries,\r\n        });\r\n\r\n        means.push(d3.mean(deliveries));\r\n\r\n        idx++;\r\n      }\r\n    }\r\n\r\n    const orderedDataGroupings = {};\r\n\r\n    for (const criteria of Object.keys(dataGroupings)) {\r\n      const objScens = [];\r\n      for (const key of Object.keys(dataGroupings[criteria])) {\r\n        const ids = dataGroupings[criteria][key];\r\n        const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n        objScens.push({\r\n          key,\r\n          sorted: sortedObjScens,\r\n          mean: d3.mean(\r\n            ids\r\n              .map((id) => {\r\n                const deliveries = flattenedData[id].deliveries;\r\n                const maxVal = MIN_MAXES[flattenedData[id].objective][1];\r\n                return deliveries.map((delivery) => delivery / maxVal);\r\n              })\r\n              .flat()\r\n          ),\r\n        });\r\n      }\r\n\r\n      const sortedObjScens = objScens.sort((a, b) => b.mean - a.mean);\r\n\r\n      orderedDataGroupings[criteria] = {};\r\n\r\n      for (let i = 0; i < sortedObjScens.length; i++) {\r\n        const { key, sorted } = sortedObjScens[i];\r\n        const keyToRank = {};\r\n\r\n        for (let j = 0; j < sorted.length; j++) {\r\n          keyToRank[flattenedData[sorted[j]].scenario] = j;\r\n        }\r\n        orderedDataGroupings[criteria][key] = keyToRank;\r\n        orderedDataGroupings[criteria][key].rank = i;\r\n      }\r\n    }\r\n\r\n    return [flattenedData, orderedDataGroupings];\r\n  })();\r\n\r\n  return {\r\n    MAX_DELIVS,\r\n    SCENARIO_KEY_STRING,\r\n    DELIV_KEY_STRING,\r\n    BASELINE_YRLY_KEY_STRING,\r\n    BASELINE_SCEN,\r\n    OBJECTIVES_DATA,\r\n    OBJECTIVE_IDS,\r\n    OBJECTIVE_GOALS_MAP,\r\n    SCENARIO_IDS,\r\n    KEY_SETTINGS_MAP,\r\n    MIN_MAXES,\r\n    FLATTENED_DATA,\r\n    DATA_GROUPINGS,\r\n  };\r\n}\r\n\r\nexport const objectivesData = await initObjectivesData();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initSpatialData() {\r\n  const SPATIAL_DATA = await (async function load() {\r\n    console.log(\"DATA: loading callite spatial data\");\r\n\r\n    const objs = await (await fetch(\"./callite_spatial.json\")).json();\r\n\r\n    // any data preprocessing goes here. none for now.\r\n\r\n    return objs;\r\n  })();\r\n\r\n  const SPATIAL_FEATURES = (function () {\r\n    return mapBy(\r\n      SPATIAL_DATA.features,\r\n      ({ properties }) => properties.CalLiteID\r\n    );\r\n  })();\r\n\r\n  const CALIFORNIA_OUTLINE = await (async function load() {\r\n    console.log(\"DATA: loading california spatial data\");\r\n\r\n    const objs = await (await fetch(\"./california.json\")).json();\r\n\r\n    // any data preprocessing goes here. none for now.\r\n\r\n    return objs;\r\n  })();\r\n\r\n  const CALIFORNIA_CENTER = [-119, 37.7749];\r\n\r\n  return {\r\n    SPATIAL_DATA,\r\n    SPATIAL_FEATURES,\r\n    CALIFORNIA_OUTLINE,\r\n    CALIFORNIA_CENTER,\r\n  };\r\n}\r\n\r\nexport const spatialData = await initSpatialData();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { threeResources } from \"three-resources\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { initWaterdrops } from \"utils/waterdrop-utils\";\r\n\r\nconst appWidth = window.innerWidth,\r\n  appHeight = window.innerHeight;\r\n\r\nexport default function useAppState() {\r\n  const [state, setState] = useState({});\r\n  const [activeWaterdrops, setActiveWaterdrops] = useState([]);\r\n  const [waterdrops, setWaterdrops] = useState({});\r\n  const [goBack, setGoBack] = useState(null);\r\n  const [goals, setGoals] = useState(objectivesData.OBJECTIVE_GOALS_MAP);\r\n\r\n  const zoomCallbacksRef = useRef([]);\r\n  const disableCamAdjustmentsRef = useRef(false);\r\n\r\n  useEffect(function initialize() {\r\n    const waterdrops = initWaterdrops(objectivesData, descriptionsData);\r\n\r\n    threeResources.renderer.setSize(appWidth, appHeight);\r\n\r\n    console.time(\"drops mesh creating\");\r\n    threeResources.dropsMesh.createMesh(waterdrops);\r\n    console.timeEnd(\"drops mesh creating\");\r\n\r\n    document\r\n      .querySelector(\"#mosaic-webgl\")\r\n      .appendChild(threeResources.renderer.domElement);\r\n\r\n    d3.select(\"#mosaic-svg\").attr(\"width\", appWidth).attr(\"height\", appHeight);\r\n\r\n    const outlineOpacity = d3\r\n      .scaleLinear()\r\n      .domain([\r\n        appHeight / waterdrops.height,\r\n        appHeight / waterdrops.groups[0].height,\r\n      ])\r\n      .range([0.1, 1])\r\n      .clamp(true);\r\n\r\n    threeResources.camera.create({\r\n      width: appWidth,\r\n      height: appHeight,\r\n      webglElement: d3.select(\".bubbles-wrapper\").node(),\r\n      svgElement: d3.select(\"#mosaic-svg\").select(\".svg-trans\").node(),\r\n      zoomFn: (transform) => {\r\n        if (!disableCamAdjustmentsRef.current) {\r\n          threeResources.dropsMesh.updateOutlineVisibility(\r\n            outlineOpacity(transform.k)\r\n          );\r\n        }\r\n\r\n        for (const cb of zoomCallbacksRef.current) cb(transform);\r\n      },\r\n    });\r\n\r\n    threeResources.renderer.setAnimationLoop(() => {\r\n      threeResources.renderer.render(\r\n        threeResources.scene,\r\n        threeResources.camera.camera\r\n      );\r\n    });\r\n\r\n    // resetCamera();\r\n\r\n    setWaterdrops(waterdrops);\r\n    setState({ state: \"TutorialView\" });\r\n\r\n    window.addEventListener(\"resize\", () => {\r\n      document.querySelector(\"dialog\").showModal();\r\n      d3.select(document.body)\r\n        .style(\"height\", \"100%\")\r\n        .style(\"overflow\", \"hidden\");\r\n    });\r\n  }, []);\r\n\r\n  const updateWaterdrops = useCallback(function (settings) {\r\n    const waterdrops = initWaterdrops(\r\n      objectivesData,\r\n      descriptionsData,\r\n      settings\r\n    );\r\n\r\n    threeResources.dropsMesh.updateMeshes(waterdrops);\r\n\r\n    setWaterdrops(waterdrops);\r\n  }, []);\r\n\r\n  const realignCamera = useCallback(\r\n    function () {\r\n      const outlineOpacity = d3\r\n        .scaleLinear()\r\n        .domain([\r\n          appHeight / waterdrops.height,\r\n          appHeight / waterdrops.groups[0].height,\r\n        ])\r\n        .range([0.1, 1])\r\n        .clamp(true);\r\n\r\n      threeResources.camera.setZoomFn((transform) => {\r\n        if (!disableCamAdjustmentsRef.current) {\r\n          threeResources.dropsMesh.updateOutlineVisibility(\r\n            outlineOpacity(transform.k)\r\n          );\r\n        }\r\n\r\n        for (const cb of zoomCallbacksRef.current) cb(transform);\r\n      });\r\n    },\r\n    [waterdrops]\r\n  );\r\n\r\n  const getOutlineOpacity = useCallback(\r\n    (val) =>\r\n      d3\r\n        .scaleLinear()\r\n        .domain([\r\n          appHeight / waterdrops.height,\r\n          appHeight / waterdrops.groups[0].height,\r\n        ])\r\n        .range([0.1, 1])\r\n        .clamp(true)(val),\r\n    [waterdrops]\r\n  );\r\n\r\n  const resetCamera = useCallback(\r\n    function (animated = true, callback) {\r\n      const farHeight = waterdrops.height * 1.2;\r\n      const pos = [\r\n        0,\r\n        -waterdrops.height * 0.08,\r\n        threeResources.camera.getZFromFarHeight(farHeight),\r\n      ];\r\n\r\n      let transitionDuration = 0;\r\n\r\n      if (animated) {\r\n        const [start, dur] = zoomTo(pos, callback);\r\n        transitionDuration = dur;\r\n\r\n        start();\r\n      } else {\r\n        threeResources.camera.callZoomFromWorldViewport({\r\n          worldX: pos[0],\r\n          worldY: -pos[1],\r\n          farHeight,\r\n        });\r\n        callback && callback();\r\n      }\r\n\r\n      return transitionDuration;\r\n    },\r\n    [waterdrops]\r\n  );\r\n\r\n  const zoomTo = useCallback(function (worldPos, callback) {\r\n    const i = threeResources.camera.interpolateZoomCamera(worldPos);\r\n\r\n    const duration = i.duration / 2;\r\n\r\n    if (duration === 0) {\r\n      callback && callback();\r\n\r\n      return [() => {}, 0];\r\n    }\r\n\r\n    const start = () => {\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(elapsed / duration, 1);\r\n        threeResources.camera.callZoom(i(et));\r\n\r\n        if (et === 1) {\r\n          t.stop();\r\n          callback && callback();\r\n        }\r\n      });\r\n    };\r\n\r\n    return [start, duration];\r\n  }, []);\r\n\r\n  const addZoomHandler = useCallback(function (cb) {\r\n    zoomCallbacksRef.current.push(cb);\r\n  }, []);\r\n\r\n  const setDisableCamAdjustments = useCallback(function (disable) {\r\n    disableCamAdjustmentsRef.current = disable;\r\n  });\r\n\r\n  return {\r\n    appWidth,\r\n    appHeight,\r\n    state,\r\n    setState,\r\n    activeWaterdrops,\r\n    setActiveWaterdrops,\r\n    setDisableCamAdjustments,\r\n    waterdrops,\r\n    goBack,\r\n    setGoBack,\r\n    zoomTo,\r\n    resetCamera,\r\n    getOutlineOpacity,\r\n    addZoomHandler,\r\n    goals,\r\n    setGoals,\r\n    updateWaterdrops,\r\n    realignCamera,\r\n    ...threeResources,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { circlet, hideElems, showElems } from \"utils/render-utils\";\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\nimport { helpers as compareViewHelpers } from \"utils/compareview-helpers\";\r\n\r\n// TODO turn into component?\r\nexport function useCompareLargeDrops() {\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const groupsRef = useRef();\r\n  const camCentersRef = useRef({});\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines] = compareViewHelpers.calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop\r\n        );\r\n\r\n        updateLabel(avgCoords(positions));\r\n        updateScenIndicators(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  function initialize(waterdrops, camera) {\r\n    groupsRef.current = compareViewHelpers.getWaterdropGroups(\r\n      [constants.PAG_OBJECTIVE, constants.PRF_OBJECTIVE],\r\n      waterdrops,\r\n      [0, 0],\r\n      0.6\r\n    );\r\n\r\n    const farHeight = waterdrops.groups[0].height * settings.SPREAD_1_2 * 1.5;\r\n    const k = camera.height / farHeight;\r\n\r\n    let x = camera.width / 2;\r\n    let y = camera.height / 2;\r\n\r\n    const camMidpoint = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    x = -(groupsRef.current.groupPositions[0].x * k) + camera.width / 2;\r\n    y = groupsRef.current.groupPositions[0].y * k + camera.height / 2;\r\n\r\n    const camFirstDrop = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    camCentersRef.current.firstDrop = camFirstDrop;\r\n    camCentersRef.current.midpoint = camMidpoint;\r\n\r\n    const container = d3\r\n      .select(\"#comparer-graphics\")\r\n      .attr(\r\n        \"width\",\r\n        window.innerWidth - 20\r\n      ) /* leave room for scrollbar on side */\r\n      .attr(\"height\", window.innerHeight)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-group\")\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(camFirstDrop.x, camFirstDrop.y)\r\n          .scale(camFirstDrop.k)\r\n      );\r\n\r\n    compareViewHelpers.updateDropsSVG(container, groupsRef.current, 0, {\r\n      onHover: (d) => {\r\n        setActiveMinidrop(d.key);\r\n      },\r\n    });\r\n\r\n    const indicatorGroup = container\r\n      .append(\"g\")\r\n      .attr(\"class\", \"indicator-group\");\r\n\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-variable\");\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    setActiveMinidrop(constants.DEFAULT_SCENARIO);\r\n    hideElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  function updateLabel(pos) {\r\n    const [textX, textY] = pos;\r\n\r\n    const smallTextSize =\r\n      (groupsRef.current.groups[0].height * settings.SPREAD_1_2) / 15;\r\n    const largeTextSize =\r\n      (groupsRef.current.groups[0].height * settings.SPREAD_1_2) / 10;\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-label\")\r\n      .text(\"scenario\")\r\n      .attr(\"font-size\", smallTextSize)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-variable\")\r\n      .attr(\"font-size\", largeTextSize)\r\n      .text(activeMinidrop.slice(4))\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY);\r\n  }\r\n\r\n  function updateScenIndicators(positions, lines) {\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".circlet\")\r\n      .data(positions)\r\n      .join(\"circle\")\r\n      .attr(\"class\", \"circlet\")\r\n      .call(circlet)\r\n      .attr(\"r\", settings.LOD_1_RAD_PX * 1.5)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"cx\", (d) => d[0])\r\n      .attr(\"cy\", (d) => d[1]);\r\n\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".comp-line\")\r\n      .data(lines)\r\n      .join(\"path\")\r\n      .attr(\"class\", \"comp-line\")\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"d\", (d) => d3.line()(d));\r\n\r\n    // TODO why do i have to do this in order for circlets to appear on top of waterdrops?\r\n    d3.select(\"#comparer-graphics .indicator-group\").raise();\r\n  }\r\n\r\n  function showOtherDrop() {\r\n    const container = d3.select(\"#comparer-graphics\");\r\n\r\n    container\r\n      .select(\".svg-group\")\r\n      .transition()\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(\r\n            camCentersRef.current.midpoint.x,\r\n            camCentersRef.current.midpoint.y\r\n          )\r\n          .scale(camCentersRef.current.midpoint.k)\r\n      );\r\n\r\n    showElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  function hideOtherDrop() {\r\n    const container = d3.select(\"#comparer-graphics\");\r\n\r\n    container\r\n      .select(\".svg-group\")\r\n      .transition()\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(\r\n            camCentersRef.current.firstDrop.x,\r\n            camCentersRef.current.firstDrop.y\r\n          )\r\n          .scale(camCentersRef.current.firstDrop.k)\r\n      );\r\n\r\n    hideElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  return { initComparer: initialize, showOtherDrop, hideOtherDrop };\r\n}\r\n","import { useCallback, useState } from \"react\";\r\n\r\nimport { useCompareLargeDrops } from \"hooks/useCompareLargeDrops\";\r\nimport { useDataStoryVars } from \"hooks/useDataStoryVars\";\r\nimport { animations as anims } from \"utils/data-story-anims\";\r\nimport { scripts } from \"utils/story-scripts\";\r\n\r\nexport function useDataStory(waterdrops, camera) {\r\n  /*\r\n    slides = [\r\n        name: string,\r\n        animHandler: {\r\n            do: someFunctionToDoAnimation,\r\n            undo: someFunctionToReverseAnimation,\r\n        }\r\n    ]\r\n     */\r\n  const [slides, setSlides] = useState([]);\r\n  const [index, setIndex] = useState(0);\r\n\r\n  const storyVars = useDataStoryVars();\r\n  const largeDropComparer = useCompareLargeDrops();\r\n\r\n  const hookAnimations = useCallback(\r\n    function () {\r\n      largeDropComparer.initComparer(waterdrops, camera);\r\n      const context = {\r\n        deps: {\r\n          ...storyVars,\r\n          largeDropComparer,\r\n        },\r\n      };\r\n\r\n      const showLocationAnimGroup = anims.initShowLocationAnimGroup(context);\r\n      const chartAnimGroup = anims.initChartAnimGroup(context);\r\n      const bucketsFillAnim = anims.initBucketsFillAnim(context);\r\n      const moveBucketsAnim = anims.initMoveBucketsAnim(context);\r\n      const dropFillAnim = anims.initDropFillAnim(context);\r\n      const changeRealityAnim = anims.initChangeRealityAnim(context);\r\n      const fillVarDropsAnim = anims.initFillVarDropsAnim(context);\r\n      const showScenLabelAnim = anims.initShowScenLabelAnim(context);\r\n      const highlightBestAnim = anims.initHighlightBestAnim(context);\r\n      const showQuantilesAnim = anims.initShowQuantilesAnim(context);\r\n      const comparerAnimGroup = anims.initComparerAnimGroup(context);\r\n\r\n      const _slides = [\r\n        {\r\n          name: \"barsExplain\",\r\n          animHandler: chartAnimGroup.barsAppear,\r\n        },\r\n        {\r\n          name: \"barsCondense\",\r\n          animHandler: chartAnimGroup.barsCondense,\r\n        },\r\n        {\r\n          name: \"bucketsFill\",\r\n          animHandler: bucketsFillAnim,\r\n        },\r\n        {\r\n          name: \"comparingTheTwo\",\r\n          animHandler: moveBucketsAnim,\r\n        },\r\n        {\r\n          name: \"forNowLetsFocus\",\r\n          animHandler: dropFillAnim,\r\n        },\r\n        {\r\n          name: \"ifChangeReality\",\r\n          animHandler: changeRealityAnim,\r\n        },\r\n        {\r\n          name: \"fortunateCanExplore\",\r\n          animHandler: fillVarDropsAnim,\r\n        },\r\n        {\r\n          name: \"theseVarsCalled\",\r\n          animHandler: showScenLabelAnim,\r\n        },\r\n        {\r\n          name: \"atAGlance\",\r\n          animHandler: highlightBestAnim,\r\n        },\r\n        {\r\n          name: \"tryMoveRed\",\r\n          animHandler: showQuantilesAnim,\r\n        },\r\n        {\r\n          name: \"soWhyNot\",\r\n          animHandler: comparerAnimGroup.showPAG,\r\n        },\r\n        {\r\n          name: \"letsBringRefuge\",\r\n          animHandler: comparerAnimGroup.showPRF,\r\n        },\r\n      ];\r\n\r\n      setSlides(_slides.map((s, i) => ({ ...s, idx: i })));\r\n    },\r\n    [waterdrops, camera]\r\n  );\r\n\r\n  const getFromTo = useCallback(\r\n    function (from, to) {\r\n      let idxFrom, idxTo;\r\n\r\n      for (let i = 0; i < slides.length; i++) {\r\n        if (slides[i].name === from) idxFrom = i;\r\n        else if (slides[i].name === to) {\r\n          idxTo = i;\r\n          break;\r\n        }\r\n      }\r\n\r\n      return attachScripts(slides.slice(idxFrom, idxTo + 1));\r\n    },\r\n    [slides]\r\n  );\r\n\r\n  return {\r\n    hookAnimations,\r\n    getSlidesInRange: getFromTo,\r\n    storyVars,\r\n    index,\r\n    setIndex,\r\n  };\r\n}\r\n\r\nfunction attachScripts(slides) {\r\n  return slides.map((slide) => ({\r\n    ...slide,\r\n    script: scripts[slide.name],\r\n  }));\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useState } from \"react\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\n\r\nexport function useDataStoryVars() {\r\n  const [userGoal, setUserGoal] = useState(200);\r\n  const [bucketInterperPAG, setBucketInterperPAG] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [bucketInterperPRF, setBucketInterperPRF] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [dropInterper, setDropInterper] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [variationInterpers, setVariationInterpers] = useState(() =>\r\n    constants.VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n  );\r\n\r\n  return {\r\n    userGoal,\r\n    setUserGoal,\r\n    bucketInterperPAG,\r\n    setBucketInterperPAG,\r\n    bucketInterperPRF,\r\n    setBucketInterperPRF,\r\n    dropInterper,\r\n    setDropInterper,\r\n    variationInterpers,\r\n    setVariationInterpers,\r\n  };\r\n}\r\n","import { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { worldToScreen } from \"utils/render-utils\";\r\nimport { useStateRef } from \"utils/misc-utils\";\r\n\r\nexport function useDragPanels(viewTransform) {\r\n  const [panels, setPanels, panelsRef] = useStateRef([]);\r\n  const mouseDownInfo = useRef({});\r\n\r\n  useEffect(function initialize() {\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX !== undefined) {\r\n        mouseDownInfo.current = {};\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const onPanelDragStart = useCallback(function (e, { id }) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    e.preventDefault();\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }, []);\r\n\r\n  function getPanelStyle({ x, y, offsetX, offsetY }) {\r\n    const [screenX, screenY] = worldToScreen(x, y, viewTransform);\r\n    return {\r\n      left: `${screenX + offsetX}px`,\r\n      top: `${screenY + offsetY}px`,\r\n    };\r\n  }\r\n\r\n  return {\r\n    panels,\r\n    panelsRef,\r\n    setPanels,\r\n    onPanelDragStart,\r\n    getPanelStyle,\r\n  };\r\n}\r\n","function initSettings() {\r\n  const LOD_1_LEVELS = 4;\r\n  const LOD_1_RAD_PX = 1;\r\n  const LOD_1_MIN_LEV_VAL = 0.1;\r\n  const LOD_1_SMALL_DROP_PAD_FACTOR = 3;\r\n  const LOD_1_LARGE_DROP_PAD_FACTOR = 1.2;\r\n\r\n  const LOD_2_SMALL_DROP_PAD_FACTOR = 3;\r\n\r\n  const GROUP_HOVER_AREA_FACTOR = 1.1 / (1 + Math.SQRT1_2);\r\n  const SPREAD_1_2 = LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  return {\r\n    LOD_1_LEVELS,\r\n    LOD_1_RAD_PX,\r\n    LOD_1_MIN_LEV_VAL,\r\n    LOD_1_SMALL_DROP_PAD_FACTOR,\r\n    LOD_1_LARGE_DROP_PAD_FACTOR,\r\n    LOD_2_SMALL_DROP_PAD_FACTOR,\r\n    GROUP_HOVER_AREA_FACTOR,\r\n    SPREAD_1_2,\r\n  };\r\n}\r\n\r\nexport const settings = initSettings();\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport {\r\n  interpolateWatercolorBlue,\r\n  levelToDropletLevel,\r\n} from \"bucket-lib/utils\";\r\nimport { settings } from \"settings\";\r\nimport { copyCoords, sortBy } from \"utils/misc-utils\";\r\nimport { rotatePoints, toRadians } from \"utils/math-utils\";\r\nimport {\r\n  waterdropOutline,\r\n  waterdropPartial,\r\n  worldToScreen,\r\n  screenToWorld,\r\n  bottleOutline,\r\n  bottlePartial,\r\n} from \"utils/render-utils\";\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return {\r\n    x: (mouseX / width) * 2 - 1,\r\n    y: -(mouseY / height) * 2 + 1,\r\n  };\r\n}\r\n\r\nexport class WaterdropMesh {\r\n  static MAX_POINTS_DROPS = 30 * 6600; // approx num verts per droplet * approx num droplets on screen\r\n  static MAX_POINTS_OUTLINE = 16 * 6600; // approx num verts per droplet * approx num droplets on screen\r\n\r\n  dropsMesh;\r\n  dropsGeom;\r\n  outlineMesh;\r\n  outlineGeom;\r\n\r\n  added = false;\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.dropsMesh) {\r\n      this.initializeMeshes(waterdrops);\r\n    } else {\r\n      this.updateMeshes(waterdrops);\r\n    }\r\n  }\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.dropsMesh);\r\n      scene.add(this.outlineMesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.dropsMesh);\r\n      scene.remove(this.outlineMesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  // TODO optimize!\r\n  initializeMeshes(waterdrops) {\r\n    const dropsGeometry = new MeshGeometry(WaterdropMesh.MAX_POINTS_DROPS);\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = bottleOutline(settings.LOD_1_RAD_PX * 2 * 0.975);\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const {\r\n        id,\r\n        globalX: x,\r\n        globalY: y,\r\n        levs,\r\n        maxLev,\r\n        globalTilt: tilt,\r\n      } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = bottlePartial(\r\n          levelToDropletLevel(l1 / maxLev),\r\n          levelToDropletLevel(l2 / maxLev),\r\n          settings.LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / settings.LOD_1_LEVELS)\r\n        );\r\n\r\n        dropsGeometry.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y, rotate: tilt },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      const rotOutline = rotatePoints(copyCoords(outlineMeshCoords), tilt);\r\n\r\n      outlinePoints.push(\r\n        ...rotOutline.map(([dx, dy]) => {\r\n          return new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01);\r\n        })\r\n      );\r\n    }\r\n\r\n    dropsGeometry.finish();\r\n\r\n    this.dropsMesh = new THREE.Mesh(\r\n      dropsGeometry.threeGeom,\r\n      new THREE.MeshBasicMaterial({\r\n        vertexColors: true,\r\n        transparent: true,\r\n        opacity: 1,\r\n      })\r\n    );\r\n\r\n    let outlineGeometry = new THREE.BufferGeometry().setFromPoints(\r\n      outlinePoints\r\n    );\r\n\r\n    this.outlineMesh = new THREE.LineSegments(\r\n      outlineGeometry,\r\n      new THREE.LineBasicMaterial({\r\n        color: 13421772,\r\n        transparent: true,\r\n        opacity: 0,\r\n      })\r\n    );\r\n\r\n    this.dropsGeom = dropsGeometry;\r\n    this.outlineGeom = outlineGeometry;\r\n  }\r\n\r\n  updateOutlineVisibility(opac) {\r\n    if (!this.outlineMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateVisibility(opac) {\r\n    if (!this.outlineMesh || !this.dropsMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n    this.dropsMesh.material.opacity = opac;\r\n    this.dropsMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateMeshes(waterdrops) {\r\n    this.dropsGeom.clearMesh();\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = bottleOutline(settings.LOD_1_RAD_PX * 2 * 0.975);\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const {\r\n        id,\r\n        globalX: x,\r\n        globalY: y,\r\n        levs,\r\n        maxLev,\r\n        globalTilt: tilt,\r\n      } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = bottlePartial(\r\n          levelToDropletLevel(l1 / maxLev),\r\n          levelToDropletLevel(l2 / maxLev),\r\n          settings.LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / settings.LOD_1_LEVELS)\r\n        );\r\n\r\n        this.dropsGeom.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y, rotate: tilt },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      const rotOutline = rotatePoints(copyCoords(outlineMeshCoords), tilt);\r\n\r\n      outlinePoints.push(\r\n        ...rotOutline.map(([dx, dy]) => {\r\n          return new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01);\r\n        })\r\n      );\r\n    }\r\n\r\n    this.dropsGeom.finish();\r\n    this.outlineGeom\r\n      .setFromPoints(outlinePoints)\r\n      .setDrawRange(0, outlinePoints.length);\r\n    this.outlineMesh.geometry.attributes.position.needsUpdate = true;\r\n    this.dropsMesh.geometry.attributes.position.needsUpdate = true;\r\n  }\r\n}\r\n\r\nexport class WaterdropSimplifiedMesh {\r\n  mesh;\r\n  added = false;\r\n\r\n  vertToId = {};\r\n  idToVert = {};\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.mesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.mesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.mesh) {\r\n      this.initializeMesh(waterdrops);\r\n    }\r\n\r\n    this.updateMesh(waterdrops);\r\n\r\n    return this.mesh;\r\n  }\r\n\r\n  initializeMesh(waterdrops) {\r\n    const pointsGeometry = new THREE.BufferGeometry();\r\n\r\n    const vertices = [];\r\n    const colors = [];\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, domLev } = waterdrops.nodes[i];\r\n\r\n      const color = domLev > 0 ? interpolateWatercolorBlue(domLev) : \"white\";\r\n\r\n      vertices.push(x, -y, 0);\r\n      const t_color = new THREE.Color(color);\r\n      colors.push(t_color.r, t_color.g, t_color.b);\r\n\r\n      this.vertToId[i] = id;\r\n      this.idToVert[id] = i;\r\n    }\r\n\r\n    const pointsMaterial = new THREE.PointsMaterial({\r\n      size: settings.LOD_1_RAD_PX * 2,\r\n      sizeAttenuation: true,\r\n      vertexColors: true,\r\n      map: new THREE.TextureLoader().load(\"drop.png\"),\r\n      transparent: true,\r\n    });\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(vertices), 3)\r\n    );\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"color\",\r\n      new THREE.BufferAttribute(new Float32Array(colors), 3)\r\n    );\r\n\r\n    this.mesh = new THREE.Points(pointsGeometry, pointsMaterial);\r\n  }\r\n\r\n  updateMesh(waterdrops) {\r\n    const positionAttr = this.mesh.geometry.getAttribute(\"position\");\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: newX, globalY: newY } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n      positionAttr.setXY(idx, newX, -newY);\r\n    }\r\n    positionAttr.needsUpdate = true;\r\n  }\r\n\r\n  updatePoints(waterdrops, translations, dt) {\r\n    const verts = this.mesh.geometry.vertices;\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n\r\n      const [dx, dy] = translations[id];\r\n\r\n      const x = verts[idx].x;\r\n      const y = verts[idx].y;\r\n\r\n      verts[idx].setX(x + dt * dx);\r\n      verts[idx].setY(y - dt * dy);\r\n    }\r\n\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n\r\n  intersectObject(camera, x, y) {\r\n    const intersects = camera.intersectObject(x, y, this.mesh);\r\n\r\n    if (intersects[0]) {\r\n      const intersect = sortBy(intersects, \"distanceToRay\")[0];\r\n      return this.vertToId[intersect.index];\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  webglView;\r\n  curTransform;\r\n\r\n  raycaster = new THREE.Raycaster();\r\n\r\n  svgView;\r\n\r\n  constructor({ fov, near, far }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n  }\r\n\r\n  create({ width, height, webglElement, svgElement, zoomFn }) {\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      this.fov,\r\n      this.width / this.height,\r\n      this.near,\r\n      this.far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.webglView = d3.select(webglElement);\r\n    this.svgView = d3.select(svgElement);\r\n\r\n    this.setZoomFn(zoomFn);\r\n\r\n    this.webglView.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  setZoomFn(zoomFn) {\r\n    this.zoom = d3\r\n      .zoom()\r\n      .on(\"zoom\", (e) => {\r\n        this.curTransform = e.transform;\r\n\r\n        this.#THREEHandleZoom(e.transform);\r\n        this.svgView.attr(\"transform\", e.transform);\r\n\r\n        zoomFn && zoomFn(e.transform);\r\n      })\r\n      .scaleExtent([\r\n        this.getScaleFromZ(this.far),\r\n        this.getScaleFromZ(this.near),\r\n      ]);\r\n  }\r\n\r\n  callZoom(transform) {\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity.translate(transform.x, transform.y).scale(transform.k)\r\n    );\r\n  }\r\n\r\n  callZoomFromWorldViewport({ worldX, worldY, farHeight }) {\r\n    const k = this.height / farHeight;\r\n\r\n    const x = -(worldX * k) + this.width / 2;\r\n    const y = worldY * k + this.height / 2;\r\n\r\n    this.callZoom({\r\n      x,\r\n      y,\r\n      k,\r\n    });\r\n  }\r\n\r\n  interpolateZoomCamera([endx, endy, endz]) {\r\n    const i = d3.interpolateZoom(\r\n      [\r\n        this.camera.position.x,\r\n        this.camera.position.y,\r\n        this.height / this.curTransform.k,\r\n      ],\r\n      [endx, -endy, this.getFarHeightFromZ(endz)]\r\n    );\r\n\r\n    const interper = (t) => {\r\n      const [worldX, worldY, farHeight] = i(t);\r\n\r\n      const k = this.height / farHeight;\r\n\r\n      const x = -(worldX * k) + this.width / 2;\r\n      const y = worldY * k + this.height / 2;\r\n\r\n      return {\r\n        x,\r\n        y,\r\n        k,\r\n      };\r\n    };\r\n\r\n    interper.duration = i.duration;\r\n\r\n    if (interper.duration < 0.01) return { duration: 0 };\r\n\r\n    return interper;\r\n  }\r\n\r\n  getZFromFarHeight(farHeight) {\r\n    return (Math.tan(toRadians(90 - this.fov / 2)) * farHeight) / 2;\r\n  }\r\n\r\n  getFarHeightFromZ(z) {\r\n    return Math.tan(toRadians(this.fov) / 2) * z * 2;\r\n  }\r\n\r\n  getScaleFromZ(z) {\r\n    const farHeight = this.getFarHeightFromZ(z);\r\n    const scale = this.height / farHeight;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const scaleHeight = this.height / scale;\r\n    const z = this.getZFromFarHeight(scaleHeight);\r\n    return z;\r\n  }\r\n\r\n  intersectObject(mouseX, mouseY, mesh) {\r\n    this.raycaster.setFromCamera(\r\n      {\r\n        x: mouseX,\r\n        y: mouseY,\r\n      },\r\n      this.camera\r\n    );\r\n\r\n    return this.raycaster.intersectObject(mesh);\r\n  }\r\n\r\n  worldToScreen(x, y) {\r\n    return worldToScreen(x, y, this.curTransform);\r\n  }\r\n\r\n  screenToWorld(x, y) {\r\n    return screenToWorld(x, y, this.curTransform);\r\n  }\r\n\r\n  #THREEHandleZoom(transform) {\r\n    const scale = transform.k;\r\n    const x = -(transform.x - this.width / 2) / scale;\r\n    const y = (transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n}\r\n\r\nclass MeshGeometry {\r\n  threeGeom = new THREE.BufferGeometry();\r\n  triangleIdx = 0;\r\n  positionAttribute;\r\n  colorAttribute;\r\n\r\n  constructor(numPoints, color = true) {\r\n    this.threeGeom.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n    );\r\n\r\n    if (color)\r\n      this.threeGeom.setAttribute(\r\n        \"color\",\r\n        new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n      );\r\n\r\n    this.positionAttribute = this.threeGeom.getAttribute(\"position\");\r\n    this.colorAttribute = this.threeGeom.getAttribute(\"color\");\r\n  }\r\n\r\n  clearMesh() {\r\n    this.triangleIdx = 0;\r\n  }\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = rotatePoints(\r\n        copyCoords(meshCoords[j]),\r\n        transform.rotate\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 0,\r\n        transform.x + v1[0],\r\n        transform.y - v1[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 1,\r\n        transform.x + v2[0],\r\n        transform.y - v2[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 2,\r\n        transform.x + v3[0],\r\n        transform.y - v3[1],\r\n        z\r\n      );\r\n\r\n      if (color) {\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 0,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 1,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 2,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n      }\r\n\r\n      this.triangleIdx++;\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    this.threeGeom.setDrawRange(0, this.triangleIdx * 3);\r\n  }\r\n}\r\n","import * as THREE from \"three\";\r\n\r\nimport { WaterdropMesh, Camera } from \"utils/three-utils\";\r\n\r\nfunction initThreeResources() {\r\n  const scene = (function getScene() {\r\n    const s = new THREE.Scene();\r\n    s.background = new THREE.Color(0xEFEBE0);\r\n    return s;\r\n  })();\r\n\r\n  const dropsMesh = new WaterdropMesh();\r\n\r\n  const camera = new Camera({\r\n    fov: 45,\r\n    near: 1,\r\n    far: 3000,\r\n  });\r\n\r\n  const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\r\n  return { scene, camera, renderer, dropsMesh };\r\n}\r\n\r\nexport const threeResources = initThreeResources();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { settings } from \"settings\";\r\n\r\nimport { clipEnds, dropCenterCorrection } from \"utils/math-utils\";\r\nimport {\r\n  generateTSpan,\r\n  circlet,\r\n  gradientInit,\r\n  gradientUpdate,\r\n  BOTTLE_SHAPE_FULL,\r\n  BOTTLE_SHAPE_BODY,\r\n} from \"utils/render-utils\";\r\n\r\nfunction largeDropInit({ nodes, height, key }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"large-drop \" + key);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"stroke\", \"none\")\r\n      .attr(\"fill\", \"yellow\")\r\n      .attr(\"r\", settings.LOD_1_RAD_PX * 2);\r\n\r\n    s.append(\"g\")\r\n      .attr(\"class\", \"baseline-pointer\")\r\n      .call(function (s) {\r\n        s.append(\"path\");\r\n        s.append(\"text\").text(\"baseline\");\r\n      });\r\n\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * settings.SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"drop-label fancy-font\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate(\r\n  { nodes, height, display_name },\r\n  { isLeft, isBottom },\r\n  transitionDelay\r\n) {\r\n  return (s) => {\r\n    const getStartDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x}, ${y}) rotate(${tilt})`;\r\n    const getEndDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x * settings.SPREAD_1_2}, ${\r\n        y * settings.SPREAD_1_2\r\n      }) rotate(${tilt})`;\r\n\r\n    const baselinePos = {};\r\n\r\n    s.call(textUpdate(display_name, height))\r\n      .selectAll(\".small-drop\")\r\n      .data(nodes, (d) => d.id)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\"transform\", getStartDropLoc)\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n      })\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"transform\", getEndDropLoc);\r\n\r\n    if (baselinePos.x === undefined) {\r\n      s.selectAll(\".highlight-circle, .baseline-pointer\").style(\r\n        \"visibility\",\r\n        \"hidden\"\r\n      );\r\n      return;\r\n    }\r\n\r\n    s.selectAll(\".highlight-circle, .baseline-pointer\").style(\r\n      \"visibility\",\r\n      \"visible\"\r\n    );\r\n\r\n    s.select(\".highlight-circle\")\r\n      .attr(\"cx\", baselinePos.x)\r\n      .attr(\r\n        \"cy\",\r\n        baselinePos.y - dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n      )\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"cx\", baselinePos.x * settings.SPREAD_1_2)\r\n      .attr(\r\n        \"cy\",\r\n        baselinePos.y * settings.SPREAD_1_2 -\r\n          dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n      );\r\n\r\n    const circlePosX = baselinePos.x * settings.SPREAD_1_2,\r\n      circlePosY =\r\n        baselinePos.y * settings.SPREAD_1_2 -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX });\r\n\r\n    const textPosX = ((height * settings.SPREAD_1_2) / 2) * (isLeft ? -1 : 1),\r\n      textPosY = ((height * settings.SPREAD_1_2) / 2) * (isBottom ? 1 : -1);\r\n\r\n    const fontSize = height / 20;\r\n    const lineWidth = height / 100;\r\n\r\n    s.select(\".baseline-pointer path\")\r\n      .attr(\r\n        \"d\",\r\n        d3\r\n          .line()\r\n          .x((d) => d[0])\r\n          .y((d) => d[1])([\r\n          [circlePosX, circlePosY],\r\n          [textPosX, textPosY],\r\n        ])\r\n      )\r\n      .attr(\"stroke-width\", lineWidth);\r\n    s.select(\".baseline-pointer text\")\r\n      .attr(\"class\", \"fancy-font\")\r\n      .attr(\"font-size\", fontSize)\r\n      .attr(\"text-anchor\", isLeft ? \"end\" : \"start\")\r\n      .attr(\r\n        \"transform\",\r\n        `translate(${textPosX + fontSize * (isLeft ? -1 : 1)}, ${textPosY})`\r\n      );\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ levs, id }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const idStr = `compare-grad-${id}`;\r\n\r\n    s.call(gradientInit(levs, idStr));\r\n\r\n    s.append(\"path\")\r\n      .attr(\"d\", BOTTLE_SHAPE_FULL)\r\n      .attr(\"class\", \"outline\")\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX * 0.95})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", BOTTLE_SHAPE_BODY)\r\n      .attr(\"fill\", `url(#${idStr})`)\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX})`);\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction textUpdate(display_name, height) {\r\n  return (s) => {\r\n    s.select(\".drop-label\")\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", (height / 2) * settings.SPREAD_1_2 * 0.9)\r\n      .call(generateTSpan(display_name, 1.2, 30));\r\n  };\r\n}\r\n\r\nfunction updateDropsSVG(\r\n  container,\r\n  waterdropGroups,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartGroupLoc = ({ x, y, tilt }) =>\r\n    `translate(${x}, ${y}) rotate(${tilt})`;\r\n  const getEndGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i].x}, ${waterdropGroups.groupPositions[i].y})`;\r\n\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(largeDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartGroupLoc)\r\n    .each(function (node, i) {\r\n      const drops = d3\r\n        .select(this)\r\n        .call(\r\n          largeDropUpdate(\r\n            node,\r\n            waterdropGroups.groupPositions[i],\r\n            transitionDelay\r\n          )\r\n        )\r\n        .selectAll(\".small-drop\");\r\n\r\n      if (onClick) {\r\n        drops.on(\"click\", function (_, d) {\r\n          onClick(d);\r\n        });\r\n      }\r\n\r\n      if (onHover) {\r\n        drops.on(\"mouseenter\", function (_, d) {\r\n          d3.select(this.parentNode).raise();\r\n          onHover(d);\r\n        });\r\n      }\r\n\r\n      if (onUnhover) {\r\n        drops.on(\"mouseleave\", function (_, d) {\r\n          onUnhover(d);\r\n        });\r\n      }\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndGroupLoc);\r\n}\r\n\r\nfunction updateColorDrops(container, waterdropGroups, opacFn, color) {\r\n  const getGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i].x}, ${waterdropGroups.groupPositions[i].y})`;\r\n\r\n  container\r\n    .selectAll(\".color-drop-group\")\r\n    .data(waterdropGroups.groups, (g) => g.key + \"-\" + g.nodes.length)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function ({ nodes }) {\r\n        d3.select(this).call((s) => {\r\n          s.attr(\"class\", \"color-drop-group\")\r\n            .selectAll(\".color-drop\")\r\n            .data(nodes)\r\n            .join(\"circle\")\r\n            .attr(\"class\", \"color-drop\")\r\n            .attr(\"r\", settings.LOD_1_RAD_PX);\r\n        });\r\n      });\r\n    })\r\n    .attr(\"transform\", getGroupLoc)\r\n    .each(function () {\r\n      d3.select(this)\r\n        .selectAll(\".color-drop\")\r\n        .call((s) => {\r\n          s.attr(\"opacity\", ({ key }) => opacFn(key)).attr(\"fill\", color);\r\n        })\r\n        .attr(\"cx\", ({ x }) => x * settings.SPREAD_1_2)\r\n        .attr(\"cy\", ({ y }) => y * settings.SPREAD_1_2);\r\n    });\r\n}\r\n\r\nfunction getWaterdropGroups(keyArr, waterdrops, center, spacing = 0.75) {\r\n  const groups = keyArr.map((k) => waterdrops.groups.find((g) => g.key === k));\r\n\r\n  const groupPositions = [];\r\n  const rad = groups[0].height * settings.SPREAD_1_2 * spacing;\r\n\r\n  for (let i = 0, n = groups.length; i < n; i++) {\r\n    const angle = ((Math.PI * 2) / n) * (i - 0.5) - Math.PI / 2;\r\n    const x = center[0] + Math.cos(angle) * rad,\r\n      y = center[1] + Math.sin(angle) * rad,\r\n      isLeft = x < center[0],\r\n      isBottom = y > center[1];\r\n\r\n    groupPositions.push({\r\n      x,\r\n      y,\r\n      isLeft,\r\n      isBottom,\r\n    });\r\n  }\r\n\r\n  return {\r\n    groups,\r\n    groupPositions,\r\n  };\r\n}\r\n\r\nfunction calcLinesAndPositions(groupsObj, activeMinidropKey) {\r\n  const positions = [];\r\n  const nodes = [];\r\n  for (let i = 0; i < groupsObj.groups.length; i++) {\r\n    const group = groupsObj.groups[i];\r\n    const groupPos = groupsObj.groupPositions[i];\r\n\r\n    const node = group.nodes.find((n) => n.key === activeMinidropKey);\r\n\r\n    nodes.push(node);\r\n\r\n    positions.push([\r\n      node.x * settings.SPREAD_1_2 + groupPos.x,\r\n      node.y * settings.SPREAD_1_2 +\r\n        groupPos.y -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX }),\r\n    ]);\r\n  }\r\n\r\n  const lines = [];\r\n\r\n  for (let i = 0; i < positions.length; i++) {\r\n    const from = Array.from(positions[i]),\r\n      to = Array.from(positions[i + 1 == positions.length ? 0 : i + 1]);\r\n\r\n    clipEnds([from, to], settings.LOD_1_RAD_PX * 2);\r\n\r\n    lines.push([from, to]);\r\n  }\r\n\r\n  return [positions, lines, nodes];\r\n}\r\n\r\nfunction updateLabelSVG(pos, labelText, normedTextSize) {\r\n  const [textX, textY] = pos;\r\n\r\n  const smallTextSize = normedTextSize / 15;\r\n  const largeTextSize = normedTextSize / 10;\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-label\")\r\n    .text(\"scenario\")\r\n    .attr(\"font-size\", smallTextSize)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-variable\")\r\n    .attr(\"font-size\", largeTextSize)\r\n    .text(labelText)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY);\r\n}\r\n\r\nfunction updateScenIndicatorsSVG(positions, lines) {\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".circlet\")\r\n    .data(positions)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"circlet\")\r\n    .call(circlet)\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX * 1.5)\r\n    .raise()\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"cx\", (d) => d[0])\r\n    .attr(\"cy\", (d) => d[1]);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".comp-line\")\r\n    .data(lines)\r\n    .join(\"path\")\r\n    .attr(\"class\", \"comp-line\")\r\n    .raise()\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"d\", (d) => d3.line()(d));\r\n}\r\n\r\nexport const helpers = {\r\n  updateDropsSVG,\r\n  updateColorDrops,\r\n  getWaterdropGroups,\r\n  calcLinesAndPositions,\r\n  updateLabelSVG,\r\n  updateScenIndicatorsSVG,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\n\r\nimport { objectivesData } from \"data/objectives-tutorial-data\";\r\nimport { hideElems, showElems } from \"utils/render-utils\";\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\n\r\nfunction initAllAnims() {\r\n  function initShowLocationAnimGroup() {\r\n    function showPAGDo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n    }\r\n\r\n    function showPAGUndo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 1)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n    }\r\n\r\n    function showPRFDo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 1)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PRF_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n    }\r\n\r\n    function showPRFUndo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PRF_OBJECTIVE)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n    }\r\n\r\n    return {\r\n      showPAG: {\r\n        do: showPAGDo,\r\n        undo: showPAGUndo,\r\n      },\r\n      showPRF: {\r\n        do: showPRFDo,\r\n        undo: showPRFUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  function initChartAnimGroup() {\r\n    let _pagX;\r\n    let _prfX;\r\n    let _pagXAxis;\r\n    let _prfXAxis;\r\n    let _pagDataDescending;\r\n    let _prfDataDescending;\r\n\r\n    const BAR_CHART_MARGIN = { top: 40, right: 30, bottom: 40, left: 60 };\r\n\r\n    function prepareSVG() {\r\n      // PAG\r\n      {\r\n        const svgGroup = d3\r\n          .select(\"#pag-bar-graph\")\r\n          .attr(\r\n            \"width\",\r\n            constants.BAR_CHART_WIDTH +\r\n              BAR_CHART_MARGIN.left +\r\n              BAR_CHART_MARGIN.right\r\n          )\r\n          .attr(\r\n            \"height\",\r\n            constants.BAR_CHART_HEIGHT +\r\n              BAR_CHART_MARGIN.top +\r\n              BAR_CHART_MARGIN.bottom\r\n          )\r\n          .attr(\"opacity\", 1)\r\n          .append(\"g\")\r\n          .attr(\"class\", \"svg-group\")\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        const dataDescending = objectivesData.OBJECTIVES_DATA[\r\n          constants.PAG_OBJECTIVE\r\n        ][objectivesData.BASELINE_YRLY_KEY_STRING]\r\n          .map((val, placeFromLeft) => ({\r\n            val,\r\n            placeFromLeft,\r\n            year: placeFromLeft + 1,\r\n          }))\r\n          .sort((a, b) => b.val - a.val);\r\n\r\n        const x = d3\r\n          .scaleBand()\r\n          .domain(dataDescending.map(({ year }) => year).sort(d3.ascending))\r\n          .range([0, constants.BAR_CHART_WIDTH])\r\n          .padding(0.4);\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        const xaxis = d3\r\n          .axisBottom(x)\r\n          .tickSize(0)\r\n          .tickFormat((d) => `year ${d}`)\r\n          .tickValues(\r\n            x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0)\r\n          );\r\n\r\n        svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n        svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .call(xaxis)\r\n          .selectAll(\"text\")\r\n          .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n          .style(\"text-anchor\", \"end\");\r\n        svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n        _pagX = x;\r\n        _pagXAxis = xaxis;\r\n        _pagDataDescending = dataDescending;\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const svgGroup = d3\r\n          .select(\"#prf-bar-graph\")\r\n          .attr(\r\n            \"width\",\r\n            constants.BAR_CHART_WIDTH +\r\n              BAR_CHART_MARGIN.left +\r\n              BAR_CHART_MARGIN.right\r\n          )\r\n          .attr(\r\n            \"height\",\r\n            constants.BAR_CHART_HEIGHT +\r\n              BAR_CHART_MARGIN.top +\r\n              BAR_CHART_MARGIN.bottom\r\n          )\r\n          .attr(\"opacity\", 1)\r\n          .append(\"g\")\r\n          .attr(\"class\", \"svg-group\")\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        const dataDescending = objectivesData.OBJECTIVES_DATA[\r\n          constants.PRF_OBJECTIVE\r\n        ][objectivesData.BASELINE_YRLY_KEY_STRING]\r\n          .map((val, placeFromLeft) => ({\r\n            val,\r\n            placeFromLeft,\r\n            year: placeFromLeft + 1,\r\n          }))\r\n          .sort((a, b) => b.val - a.val);\r\n\r\n        const x = d3\r\n          .scaleBand()\r\n          .domain(dataDescending.map(({ year }) => year).sort(d3.ascending))\r\n          .range([0, constants.BAR_CHART_WIDTH])\r\n          .padding(0.4);\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        const xaxis = d3\r\n          .axisBottom(x)\r\n          .tickSize(0)\r\n          .tickFormat((d) => `year ${d}`)\r\n          .tickValues(\r\n            x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0)\r\n          );\r\n\r\n        svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n        svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .call(xaxis)\r\n          .selectAll(\"text\")\r\n          .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n          .style(\"text-anchor\", \"end\");\r\n        svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n        _prfX = x;\r\n        _prfXAxis = xaxis;\r\n        _prfDataDescending = dataDescending;\r\n      }\r\n    }\r\n\r\n    function barsAppearDo() {\r\n      // PAG\r\n      {\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        d3.select(\"#pag-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_pagDataDescending, (d) => d.placeFromLeft)\r\n          .join(\"rect\")\r\n          .attr(\"class\", \"bars\")\r\n          .attr(\"x\", (d) => _pagX(d.year))\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"width\", _pagX.bandwidth())\r\n          .attr(\"height\", 0)\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"fill\", \"steelblue\")\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => d.placeFromLeft * 10)\r\n          .attr(\"y\", (d) => y(d.val))\r\n          .attr(\"height\", (d) => constants.BAR_CHART_HEIGHT - y(d.val));\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        d3.select(\"#prf-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_prfDataDescending, (d) => d.placeFromLeft)\r\n          .join(\"rect\")\r\n          .attr(\"class\", \"bars\")\r\n          .attr(\"x\", (d) => _prfX(d.year))\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"width\", _prfX.bandwidth())\r\n          .attr(\"height\", 0)\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"fill\", \"steelblue\")\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => d.placeFromLeft * 10)\r\n          .attr(\"y\", (d) => y(d.val))\r\n          .attr(\"height\", (d) => constants.BAR_CHART_HEIGHT - y(d.val));\r\n      }\r\n    }\r\n\r\n    function barsAppearUndo() {\r\n      // PAG\r\n      {\r\n        d3.select(\"#pag-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_pagDataDescending, (d) => d.placeFromLeft)\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => (_pagDataDescending.length - d.placeFromLeft - 1) * 10)\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"height\", 0);\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        d3.select(\"#prf-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_prfDataDescending, (d) => d.placeFromLeft)\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => (_prfDataDescending.length - d.placeFromLeft - 1) * 10)\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"height\", 0);\r\n      }\r\n    }\r\n\r\n    async function barsCondenseDo() {\r\n      const x = d3\r\n        .scaleBand()\r\n        .domain(d3.range(_pagDataDescending.length))\r\n        .range([0, constants.BAR_CHART_WIDTH])\r\n        .padding(0.4);\r\n\r\n      // PAG\r\n      {\r\n        const newWidth = constants.BAR_CHART_WIDTH / 8;\r\n        const svgGroup = d3.select(\"#pag-bar-graph .svg-group\");\r\n\r\n        svgGroup.select(\".anim-xaxis\").call(_pagXAxis.tickFormat(\"\"));\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        bars\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"x\", (d, i) => x(i))\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"fill\", (d, i) =>\r\n            interpolateWatercolorBlue(i / (_pagDataDescending.length - 1))\r\n          )\r\n          .transition()\r\n          .delay(\r\n            (d, i) =>\r\n              100 + (1 - (1 - i / _pagDataDescending.length) ** 4) * 1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"width\", newWidth)\r\n          .attr(\"x\", constants.BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            svgGroup\r\n              .select(\".anim-xaxis\")\r\n              .transition()\r\n              .transition(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(0, ${constants.BAR_CHART_HEIGHT + 50})`\r\n              )\r\n              .attr(\"opacity\", 0);\r\n\r\n            bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n            svgGroup\r\n              .transition()\r\n              .delay(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(${\r\n                  BAR_CHART_MARGIN.left +\r\n                  constants.BAR_CHART_WIDTH / 2 -\r\n                  newWidth / 2\r\n                },${BAR_CHART_MARGIN.top})`\r\n              );\r\n          });\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const newWidth = constants.BAR_CHART_WIDTH / 8;\r\n        const svgGroup = d3.select(\"#prf-bar-graph .svg-group\");\r\n\r\n        svgGroup.select(\".anim-xaxis\").call(_prfXAxis.tickFormat(\"\"));\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        bars\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"x\", (d, i) => x(i))\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"fill\", (d, i) =>\r\n            interpolateWatercolorBlue(i / (_prfDataDescending.length - 1))\r\n          )\r\n          .transition()\r\n          .delay(\r\n            (d, i) =>\r\n              100 + (1 - (1 - i / _prfDataDescending.length) ** 4) * 1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"width\", newWidth)\r\n          .attr(\"x\", constants.BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            svgGroup\r\n              .select(\".anim-xaxis\")\r\n              .transition()\r\n              .transition(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(0, ${constants.BAR_CHART_HEIGHT + 50})`\r\n              )\r\n              .attr(\"opacity\", 0);\r\n\r\n            bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n            svgGroup\r\n              .transition()\r\n              .delay(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(${\r\n                  BAR_CHART_MARGIN.left +\r\n                  constants.BAR_CHART_WIDTH / 2 -\r\n                  newWidth / 2\r\n                },${BAR_CHART_MARGIN.top})`\r\n              );\r\n          });\r\n      }\r\n    }\r\n\r\n    function barsCondenseUndo() {\r\n      const x = d3\r\n        .scaleBand()\r\n        .domain(d3.range(_pagDataDescending.length))\r\n        .range([0, constants.BAR_CHART_WIDTH])\r\n        .padding(0.4);\r\n\r\n      // PAG\r\n      {\r\n        const svgGroup = d3.select(\"#pag-bar-graph .svg-group\");\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .transition()\r\n          .transition(500)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .attr(\"opacity\", 1);\r\n\r\n        svgGroup\r\n          .transition()\r\n          .delay(500)\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        bars\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"x\", (d, i) => x(i))\r\n          .attr(\"width\", _pagX.bandwidth())\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 1)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            bars\r\n              .transition()\r\n              .duration(500)\r\n              .attr(\"fill\", \"steelblue\")\r\n              .transition()\r\n              .delay(\r\n                (d, i) =>\r\n                  100 + (1 - (i / _pagDataDescending.length) ** 4) * 1000\r\n              )\r\n              .duration(500)\r\n              .attr(\"x\", (d) => _prfX(d.year))\r\n              .end()\r\n              .catch(() => {})\r\n              .then(() => {\r\n                svgGroup\r\n                  .select(\".anim-xaxis\")\r\n                  .call(_pagXAxis.tickFormat((d) => `year ${d}`));\r\n              });\r\n          });\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const svgGroup = d3.select(\"#prf-bar-graph .svg-group\");\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .transition()\r\n          .transition(500)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .attr(\"opacity\", 1);\r\n\r\n        svgGroup\r\n          .transition()\r\n          .delay(500)\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        bars\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"x\", (d, i) => x(i))\r\n          .attr(\"width\", _prfX.bandwidth())\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 1)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            bars\r\n              .transition()\r\n              .duration(500)\r\n              .attr(\"fill\", \"steelblue\")\r\n              .transition()\r\n              .delay(\r\n                (d, i) =>\r\n                  100 + (1 - (i / _prfDataDescending.length) ** 4) * 1000\r\n              )\r\n              .duration(500)\r\n              .attr(\"x\", (d) => _prfX(d.year))\r\n              .end()\r\n              .catch(() => {})\r\n              .then(() => {\r\n                svgGroup\r\n                  .select(\".anim-xaxis\")\r\n                  .call(_prfXAxis.tickFormat((d) => `year ${d}`));\r\n              });\r\n          });\r\n      }\r\n    }\r\n\r\n    prepareSVG();\r\n\r\n    return {\r\n      barsAppear: {\r\n        do: barsAppearDo,\r\n        undo: barsAppearUndo,\r\n      },\r\n      barsCondense: {\r\n        do: barsCondenseDo,\r\n        undo: barsCondenseUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  function initBucketsFillAnim({ deps }) {\r\n    function animDo() {\r\n      d3.selectAll(\".tut-graph-wrapper .bottle-wrapper\").style(\r\n        \"display\",\r\n        \"initial\"\r\n      );\r\n      d3.select(\"#pag-bar-graph\").attr(\"opacity\", 0);\r\n      d3.select(\"#prf-bar-graph\").attr(\"opacity\", 0);\r\n\r\n      deps.setBucketInterperPAG(() => constants.PAG_INTERPER);\r\n      deps.setBucketInterperPRF(() => constants.PRF_INTERPER);\r\n    }\r\n\r\n    function animUndo() {\r\n      deps.setBucketInterperPAG(() => d3.scaleLinear().range([0, 0]));\r\n      deps.setBucketInterperPRF(() => d3.scaleLinear().range([0, 0]));\r\n\r\n      d3.selectAll(\".tut-graph-wrapper .bottle-wrapper\").style(\r\n        \"display\",\r\n        \"none\"\r\n      );\r\n      d3.select(\"#pag-bar-graph\").transition().attr(\"opacity\", 1);\r\n      d3.select(\"#prf-bar-graph\").transition().attr(\"opacity\", 1);\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initMoveBucketsAnim({ deps }) {\r\n    function animDo() {\r\n      showElems(\".ag-annot, .ref-annot\");\r\n    }\r\n\r\n    function animUndo() {\r\n      hideElems(\".ag-annot, .ref-annot\");\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initDropFillAnim({ deps }) {\r\n    function animDo() {\r\n      deps.setDropInterper(() => constants.PAG_INTERPER_DROP);\r\n    }\r\n\r\n    function animUndo() {\r\n      deps.setDropInterper(() => d3.scaleLinear().range([0, 0]));\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initChangeRealityAnim() {\r\n    function animDo() {\r\n      d3.selectAll(\".vardrop\")\r\n        .style(\"display\", \"initial\")\r\n        .classed(\"hasarrow\", true);\r\n\r\n      hideElems(\r\n        \".main-waterdrop .objective-label, .main-waterdrop .volume-not-height, .waterdrop-explain-pag\"\r\n      );\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.selectAll(\".vardrop\")\r\n        .style(\"display\", \"none\")\r\n        .classed(\"hasarrow\", false);\r\n\r\n      showElems(\r\n        \".main-waterdrop .objective-label, .main-waterdrop .volume-not-height, .waterdrop-explain-pag\"\r\n      );\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initFillVarDropsAnim({ deps }) {\r\n    function animDo() {\r\n      d3.selectAll(\".vardrop .bucket-outline\").style(\r\n        \"stroke-dasharray\",\r\n        \"none\"\r\n      );\r\n      deps.setVariationInterpers(constants.VARIATIONS_INTERPERS);\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.selectAll(\".vardrop .bucket-outline\").style(\r\n        \"stroke-dasharray\",\r\n        \"10 10\"\r\n      );\r\n      deps.setVariationInterpers(\r\n        constants.VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n      );\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initShowScenLabelAnim() {\r\n    return {\r\n      do: function () {\r\n        d3.selectAll(\".var-scen-label\").style(\"display\", \"block\");\r\n      },\r\n      undo: function () {\r\n        d3.selectAll(\".var-scen-label\").style(\"display\", \"none\");\r\n      },\r\n    };\r\n  }\r\n\r\n  function initHighlightBestAnim() {\r\n    return {\r\n      do: function () {\r\n        d3.select(\".drop1\").classed(\"highlighted\", true);\r\n      },\r\n      undo: function () {\r\n        d3.select(\".drop1\").classed(\"highlighted\", false);\r\n      },\r\n    };\r\n  }\r\n\r\n  function initShowQuantilesAnim() {\r\n    function animDo() {\r\n      d3.select(\".drop1\").classed(\"highlighted\", false);\r\n      d3.selectAll(\".vardrop\").classed(\"hasarrow\", false);\r\n\r\n      d3.selectAll(\".var-scen-label\").style(\"opacity\", \"0.5\");\r\n      d3.selectAll(\".var-scen-label, .scen-number\").style(\"color\", \"gray\");\r\n\r\n      d3.select(\".main-waterdrop\")\r\n        .transition()\r\n        .style(\"transform\", \"translateY(-100px) scale(0.5)\");\r\n      // undo scaling of label due to shrinking div\r\n      d3.select(\".main-waterdrop .var-scen-label\")\r\n        .transition()\r\n        .style(\"transform\", \"scale(2)\");\r\n      d3.selectAll(\".drop1 .bottle-wrapper, .drop3 .bottle-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"translate(-50px, 15px) scale(0.5)\");\r\n      d3.selectAll(\".drop2 .bottle-wrapper, .drop4 .bottle-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"translate(50px, 15px) scale(0.5)\");\r\n\r\n      d3.select(\".main-histogram\").style(\"display\", \"initial\");\r\n      d3.selectAll(\".vardrop .dot-histogram-wrapper\").style(\"display\", \"flex\");\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.select(\".drop1\").classed(\"highlighted\", true);\r\n      d3.selectAll(\".vardrop\").classed(\"hasarrow\", true);\r\n\r\n      d3.selectAll(\".var-scen-label\").style(\"opacity\", \"1\");\r\n      d3.selectAll(\".var-scen-label\").style(\"color\", \"black\");\r\n      d3.selectAll(\".scen-number\").style(\"color\", \"#CC8F43\");\r\n\r\n      d3.select(\".main-waterdrop\").transition().style(\"transform\", \"none\");\r\n      // undo scaling of label due to shrinking div\r\n      d3.select(\".main-waterdrop .var-scen-label\")\r\n        .transition()\r\n        .style(\"transform\", \"scale(1)\");\r\n      d3.selectAll(\".drop1 .bottle-wrapper, .drop3 .bottle-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"none\");\r\n      d3.selectAll(\".drop2 .bottle-wrapper, .drop4 .bottle-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"none\");\r\n\r\n      d3.select(\".main-histogram\").style(\"display\", \"none\");\r\n      d3.selectAll(\".vardrop .dot-histogram-wrapper\").style(\"display\", \"none\");\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initComparerAnimGroup({ deps }) {\r\n    function showPAGAnimDo() {\r\n      hideElems(\".scrollama-compare-scenobjs .waterdrop-graphics-wrapper\");\r\n      showElems(\".scrollama-compare-scenobjs .tut-comparer-graphics-wrapper\");\r\n    }\r\n\r\n    function showPAGAnimUndo() {\r\n      showElems(\r\n        \".scrollama-compare-scenobjs .waterdrop-graphics-wrapper\",\r\n        d3,\r\n        \"grid\"\r\n      );\r\n      hideElems(\".scrollama-compare-scenobjs .tut-comparer-graphics-wrapper\");\r\n    }\r\n\r\n    function showPRFAnimDo() {\r\n      deps.largeDropComparer.showOtherDrop();\r\n    }\r\n\r\n    function showPRFAnimUndo() {\r\n      deps.largeDropComparer.hideOtherDrop();\r\n    }\r\n\r\n    return {\r\n      showPAG: {\r\n        do: showPAGAnimDo,\r\n        undo: showPAGAnimUndo,\r\n      },\r\n      showPRF: {\r\n        do: showPRFAnimDo,\r\n        undo: showPRFAnimUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  return {\r\n    initShowLocationAnimGroup,\r\n    initChartAnimGroup,\r\n    initBucketsFillAnim,\r\n    initMoveBucketsAnim,\r\n    initDropFillAnim,\r\n    initChangeRealityAnim,\r\n    initFillVarDropsAnim,\r\n    initShowScenLabelAnim,\r\n    initHighlightBestAnim,\r\n    initShowQuantilesAnim,\r\n    initComparerAnimGroup,\r\n  };\r\n}\r\n\r\nexport const animations = initAllAnims();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\n\r\nexport function createInterpsFromDelivs(delivs, minDelivs, maxDelivs) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(\r\n      delivs.map((v) => Math.min(1, (v - minDelivs) / (maxDelivs - minDelivs)))\r\n    )\r\n    .clamp(true);\r\n}\r\n\r\n// TODO fix colors\r\nexport function calcDomLev(levs) {\r\n  levs = [1, ...levs, 0];\r\n\r\n  let mean = 0;\r\n  for (let i = 0; i < levs.length - 1; i++) {\r\n    const dif = levs[i] - levs[i + 1];\r\n    mean += (dif * (i - 1)) / (levs.length + 4);\r\n  }\r\n\r\n  return mean;\r\n}\r\n\r\n// TODO combine these arrays to just one array of objects\r\nexport const SETT_NAME_SHORT = [\"D\", \"C\", \"P\", \"R\", \"M\"];\r\nexport const SETT_NAME_FULL = [\r\n  \"Demand\",\r\n  \"Carryover\",\r\n  \"Priority\",\r\n  \"Regs.\",\r\n  \"Min. Flow\",\r\n];\r\nexport const SETT_VAL_STEPS = [\r\n  [1, 0.9, 0.8, 0.7, 0.6].reverse(), // demand\r\n  [1.0, 1.2, 1.3], // carryover\r\n  [0, 1], // priority\r\n  [1, 2, 3, 4], // regs\r\n  [0, 0.4, 0.6, 0.7, 0.8], // minflow\r\n];\r\n\r\nexport const SETT_NUM_OPTS = {\r\n  demand: SETT_VAL_STEPS[0].length,\r\n  carryover: SETT_VAL_STEPS[1].length,\r\n  priority: SETT_VAL_STEPS[2].length,\r\n  regs: SETT_VAL_STEPS[3].length,\r\n  minflow: SETT_VAL_STEPS[4].length,\r\n};\r\n\r\nexport const SETT_DESC = [\r\n  String.raw`Reduce total agriculture demands\r\n(1) Reduce 40%\r\n(2) Reduce 30%\r\n(3) Reduce 20%\r\n(4) Reduce 10%\r\n(5) Baseline`,\r\n\r\n  String.raw`Modify balance of reservoir storage and delivery\r\n(1) Baseline\r\n(2) Increase carryover (relative to delivery) 10%\r\n(3) Increase carryover to 20%`,\r\n\r\n  String.raw`Modify how CVP cuts are distributed during times of shortage\r\n(1) Baseline\r\n(2) Equal cuts`,\r\n\r\n  String.raw`Selective removal/activation of D1641 regulations\r\n(1) Baseline (all \"on\")\r\n(2) No NDO, Rio Vista min flows\r\n(3) No X2/salinity\r\n(4) Combined no NDO + no X2`,\r\n\r\n  String.raw`Modify/add minimum flow on Central Valley tributaries\r\n(1) Baseline\r\n(2) 40% unimpaired flow on main tributaries\r\n(3) 60% unimpaired flow\r\n(4) 70% unimpaired flow\r\n(5) 80% unimpaired flow`,\r\n];\r\n\r\nexport function deserialize(scenStr) {\r\n  let scenNum = parseInt(scenStr);\r\n\r\n  const minflow = scenNum % SETT_NUM_OPTS.minflow;\r\n  scenNum = (scenNum - minflow) / SETT_NUM_OPTS.minflow;\r\n\r\n  const regs = scenNum % SETT_NUM_OPTS.regs;\r\n  scenNum = (scenNum - regs) / SETT_NUM_OPTS.regs;\r\n\r\n  const priority = scenNum % SETT_NUM_OPTS.priority;\r\n  scenNum = (scenNum - priority) / SETT_NUM_OPTS.priority;\r\n\r\n  const carryover = scenNum % SETT_NUM_OPTS.carryover;\r\n  scenNum = (scenNum - carryover) / SETT_NUM_OPTS.carryover;\r\n\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demand = scenNum % SETT_NUM_OPTS.demand;\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n\r\n  return [demandReverse, carryover, priority, regs, minflow];\r\n}\r\n\r\nexport function serialize(demand, carryover, priority, regs, minflow) {\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n  let code = 0;\r\n  code += minflow;\r\n  code += SETT_NUM_OPTS.minflow * regs;\r\n  code += SETT_NUM_OPTS.regs * SETT_NUM_OPTS.minflow * priority;\r\n  code +=\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    carryover;\r\n  code +=\r\n    SETT_NUM_OPTS.carryover *\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    demandReverse;\r\n\r\n  const finalKey = `expl${d3.format(\"0>4\")(code)}`;\r\n\r\n  return finalKey;\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { settings } from \"settings\";\r\n\r\nimport { dropCenterCorrection } from \"utils/math-utils\";\r\nimport {\r\n  BOTTLE_SHAPE_BODY,\r\n  BOTTLE_SHAPE_FULL,\r\n  circlet,\r\n  gradientInit,\r\n  gradientUpdate,\r\n} from \"utils/render-utils\";\r\n\r\nfunction smallDropInit({ levs, id }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"small-drop hover-capture\");\r\n\r\n    const idStr = `drop-fill-${id}`;\r\n\r\n    s.call(gradientInit(levs, idStr));\r\n\r\n    s.append(\"path\").attr(\"d\", BOTTLE_SHAPE_FULL).attr(\"class\", \"outline\");\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", BOTTLE_SHAPE_BODY)\r\n      .attr(\"fill\", `url(#${idStr})`);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"circlet interactive\")\r\n      .call(circlet)\r\n      .attr(\"cy\", -dropCenterCorrection({ rad: 1 }))\r\n      .attr(\"r\", 1.5);\r\n\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, id, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n    s.select(\".outline\").attr(\r\n      \"transform\",\r\n      `scale(${settings.LOD_1_RAD_PX * 0.95})`\r\n    );\r\n    s.select(\".fill\").attr(\"transform\", `scale(${settings.LOD_1_RAD_PX})`);\r\n\r\n    s.select(\".circlet\").attr(\"id\", `i${id}`);\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction updateSmallDropSVG(\r\n  container,\r\n  waterdropGroup,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartLoc = ({ globalX, globalY, globalTilt }) =>\r\n    `translate(${globalX}, ${globalY}) rotate(${globalTilt})`;\r\n  const getEndLoc = ({ x, y, tilt }) =>\r\n    `translate(${waterdropGroup.x + x * settings.SPREAD_1_2}, ${\r\n      waterdropGroup.y + y * settings.SPREAD_1_2\r\n    }) rotate(${tilt})`;\r\n\r\n  const baselinePos = {};\r\n\r\n  const drops = container\r\n    .selectAll(\".small-drop\")\r\n    .data(waterdropGroup.nodes, (d) => d.id)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartLoc)\r\n    .each(function (node) {\r\n      d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n    });\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n\r\n  drops\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndLoc);\r\n\r\n  if (baselinePos.x === undefined) {\r\n    container\r\n      .selectAll(\".highlight-circle, .baseline-pointer\")\r\n      .attr(\"display\", \"none\");\r\n    return;\r\n  }\r\n\r\n  container\r\n    .selectAll(\".highlight-circle, .baseline-pointer\")\r\n    .attr(\"display\", \"initial\");\r\n\r\n  const circlePosX = waterdropGroup.x + baselinePos.x * settings.SPREAD_1_2,\r\n    circlePosY =\r\n      waterdropGroup.y +\r\n      baselinePos.y * settings.SPREAD_1_2 -\r\n      dropCenterCorrection({ rad: settings.LOD_1_RAD_PX });\r\n\r\n  const textPosX =\r\n      waterdropGroup.x + (waterdropGroup.height * settings.SPREAD_1_2) / 2,\r\n    textPosY =\r\n      waterdropGroup.y - (waterdropGroup.height * settings.SPREAD_1_2) / 2;\r\n\r\n  const fontSize = waterdropGroup.height / 20;\r\n  const lineWidth = waterdropGroup.height / 100;\r\n\r\n  container\r\n    .select(\".highlight-circle\")\r\n    .attr(\"stroke\", \"none\")\r\n    .attr(\"fill\", \"yellow\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX * 2)\r\n    .attr(\"cx\", circlePosX)\r\n    .attr(\"cy\", circlePosY);\r\n\r\n  container\r\n    .select(\".baseline-pointer path\")\r\n    .attr(\r\n      \"d\",\r\n      d3\r\n        .line()\r\n        .x((d) => d[0])\r\n        .y((d) => d[1])([\r\n        [circlePosX, circlePosY],\r\n        [textPosX, textPosY],\r\n      ])\r\n    )\r\n    .attr(\"stroke-width\", lineWidth);\r\n  container\r\n    .select(\".baseline-pointer text\")\r\n    .attr(\"class\", \"fancy-font\")\r\n    .attr(\"font-size\", fontSize)\r\n    .attr(\"transform\", `translate(${textPosX + fontSize}, ${textPosY})`);\r\n}\r\n\r\nfunction updateColorDrops(container, waterdropGroup, opacFn, color) {\r\n  container\r\n    .selectAll(\".color-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"color-drop\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX)\r\n    .attr(\"opacity\", ({ key }) => opacFn(key))\r\n    .attr(\"fill\", color)\r\n    .attr(\"cx\", ({ x }) => waterdropGroup.x + x * settings.SPREAD_1_2)\r\n    .attr(\"cy\", ({ y }) => waterdropGroup.y + y * settings.SPREAD_1_2);\r\n}\r\n\r\nexport const helpers = {\r\n  updateSmallDropSVG,\r\n  updateColorDrops,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport Matter from \"matter-js\";\r\n\r\nimport { CIRC_RAD, DROP_HEIGHT } from \"./render-utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor(Math.sqrt(AREA / 3.14));\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(\r\n  x,\r\n  y,\r\n  nodes,\r\n  packingFactor = 1,\r\n  reuse = false\r\n) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r)) / packingFactor;\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport function interp(x, a, b) {\r\n  return x * (b - a) + a;\r\n}\r\n\r\nexport function revInterp(t, a, b) {\r\n  return (t - a) / (b - a);\r\n}\r\n\r\nexport function distSq([x1, y1], [x2, y2]) {\r\n  return (x2 - x1) ** 2 + (y2 - y1) ** 2;\r\n}\r\n\r\nexport function dist([x1, y1], [x2, y2]) {\r\n  return Math.sqrt(distSq([x1, y1], [x2, y2]));\r\n}\r\n\r\nexport function getCenterDomRect(domRect) {\r\n  return [domRect.left + domRect.width / 2, domRect.top + domRect.height / 2];\r\n}\r\n\r\nexport function clipEnds([from, to], shortenByStart, shortenByEnd) {\r\n  const len = Math.sqrt((from[0] - to[0]) ** 2 + (from[1] - to[1]) ** 2);\r\n  const normed = [(to[0] - from[0]) / len, (to[1] - from[1]) / len];\r\n\r\n  if (shortenByEnd === undefined) shortenByEnd = shortenByStart;\r\n\r\n  from[0] += normed[0] * shortenByStart;\r\n  from[1] += normed[1] * shortenByStart;\r\n  to[0] -= normed[0] * shortenByEnd;\r\n  to[1] -= normed[1] * shortenByEnd;\r\n\r\n  return [from, to];\r\n}\r\n\r\nexport function dropRadToDropHeight(rad) {\r\n  return (1 + Math.SQRT2) * rad;\r\n}\r\n\r\nexport function dropCenterCorrection({ rad, height }) {\r\n  if (rad !== undefined) return dropRadToDropHeight(rad) * 0.08;\r\n  return height * 0.08;\r\n}\r\n\r\nexport function avgCoords(coords) {\r\n  return [d3.mean(coords, (c) => c[0]), d3.mean(coords, (c) => c[1])];\r\n}\r\n\r\nexport function rotatePoint(x, y, deg) {\r\n  const vec = new THREE.Vector3(x, y, 0).applyEuler(\r\n    new THREE.Euler(0, 0, toRadians(deg))\r\n  );\r\n  return [vec.x, vec.y];\r\n}\r\n\r\n// modifies arr!\r\nexport function rotatePoints(arr, deg) {\r\n  for (const a of arr) {\r\n    const newPoint = rotatePoint(a[0], a[1], deg);\r\n    a[0] = newPoint[0];\r\n    a[1] = newPoint[1];\r\n  }\r\n  return arr;\r\n}\r\n\r\n// https://stackoverflow.com/a/2450976\r\nexport function shuffle(array) {\r\n  let currentIndex = array.length;\r\n\r\n  // While there remain elements to shuffle...\r\n  while (currentIndex != 0) {\r\n    // Pick a remaining element...\r\n    let randomIndex = Math.floor(Math.random() * currentIndex);\r\n    currentIndex--;\r\n\r\n    // And swap it with the current element.\r\n    [array[currentIndex], array[randomIndex]] = [\r\n      array[randomIndex],\r\n      array[currentIndex],\r\n    ];\r\n  }\r\n\r\n  return array;\r\n}\r\n","import { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\n// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    if (typeof v === \"function\")\r\n      _setState((curVal) => (stateRef.current = v(curVal)));\r\n    else _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n\r\nexport function isState(stateInfo, stateName) {\r\n  return stateInfo && stateInfo.state === stateName;\r\n}\r\n\r\nexport function wrap(s, len = 15) {\r\n  return s.replace(\r\n    new RegExp(`(?![^\\\\n]{1,${len}}$)([^\\\\n]{1,${len}})\\\\s`, \"g\"),\r\n    \"$1\\n\"\r\n  );\r\n}\r\n\r\nexport function genUUID() {\r\n  return Math.floor(Math.random() * 1e9);\r\n}\r\n\r\nexport function arrRemove(arr, item) {\r\n  let idx;\r\n  if (typeof item === \"function\") {\r\n    idx = arr.findIndex(item);\r\n  } else {\r\n    idx = arr.indexOf(item);\r\n  }\r\n  if (idx !== -1) arr.splice(idx, 1);\r\n  return arr;\r\n}\r\n\r\nexport function copyCoords(arr) {\r\n  return arr.map((a) => Array.from(a));\r\n}\r\n\r\n// https://www.geeksforgeeks.org/implement-search-box-with-debounce-in-javascript/\r\nexport const debounce = (fn, delay = 1000) => {\r\n  let timerId = null;\r\n  return (...args) => {\r\n    clearTimeout(timerId);\r\n    timerId = setTimeout(() => fn(...args), delay);\r\n  };\r\n};\r\n","import {\r\n  interpolateWatercolorBlue,\r\n  levelToDropletLevel,\r\n} from \"bucket-lib/utils\";\r\nimport * as d3 from \"d3\";\r\nimport { settings } from \"settings\";\r\nimport { radToDeg } from \"three/src/math/MathUtils\";\r\nimport { wrap } from \"utils/misc-utils\";\r\nimport { clamp, dist } from \"utils/math-utils\";\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nconst BOTTLE_ICON = {\r\n  draw: function (context, size) {\r\n    const bottleWidth = size / 2;\r\n    const capWidth = (bottleWidth * 2) / 3;\r\n    const capHeight = capWidth / 2;\r\n    context.moveTo(capWidth / 2, -size / 2);\r\n    context.lineTo(-bottleWidth / 2, -size / 2);\r\n    context.lineTo(-bottleWidth / 2, size / 2);\r\n    context.lineTo(bottleWidth / 2, size / 2);\r\n    context.lineTo(bottleWidth / 2, -size / 2);\r\n    context.lineTo(capWidth / 2, -size / 2);\r\n    context.lineTo(capWidth / 2, -size / 2 - capHeight);\r\n    context.lineTo(-capWidth / 2, -size / 2 - capHeight);\r\n    context.lineTo(-capWidth / 2, -size / 2);\r\n  },\r\n};\r\n\r\nexport const BOTTLE_SHAPE_FULL =\r\n  \"M0.333,-1L-0.389,-1A0.111,0.111,0,0,0,-0.5,-0.889L-0.5,0.889A0.111,0.111,0,0,0,-0.389,1L0.389,1A0.111,0.111,0,0,0,0.5,0.889L0.5,-0.889A0.111,0.111,0,0,0,0.389,-1L0.333,-1L0.333,-1.222A0.111,0.111,0,0,0,0.222,-1.333L-0.222,-1.333A0.111,0.111,0,0,0,-0.333,-1.222L-0.333,-1\";\r\n\r\nexport const BOTTLE_SHAPE_BODY =\r\n  \"M0.333,-1L-0.389,-1A0.111,0.111,0,0,0,-0.5,-0.889L-0.5,0.889A0.111,0.111,0,0,0,-0.389,1L0.389,1A0.111,0.111,0,0,0,0.5,0.889L0.5,-0.889A0.111,0.111,0,0,0,0.389,-1Z\";\r\n\r\nexport const CIRC_RAD = Math.SQRT1_2;\r\nexport const DROP_RAD = 1;\r\nexport const CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nexport const DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\n\r\nexport function bottleOutline(size = 2) {\r\n  const bottleWidth = size / 2;\r\n  const capWidth = (bottleWidth * 2) / 3;\r\n  const capHeight = capWidth / 2;\r\n\r\n  return [\r\n    [capWidth / 2, -size / 2],\r\n    [-bottleWidth / 2, -size / 2],\r\n    [-bottleWidth / 2, -size / 2],\r\n    [-bottleWidth / 2, size / 2],\r\n    [-bottleWidth / 2, size / 2],\r\n    [bottleWidth / 2, size / 2],\r\n    [bottleWidth / 2, size / 2],\r\n    [bottleWidth / 2, -size / 2],\r\n    [bottleWidth / 2, -size / 2],\r\n    [capWidth / 2, -size / 2],\r\n    [capWidth / 2, -size / 2],\r\n    [capWidth / 2, -size / 2 - capHeight],\r\n    [capWidth / 2, -size / 2 - capHeight],\r\n    [-capWidth / 2, -size / 2 - capHeight],\r\n    [-capWidth / 2, -size / 2 - capHeight],\r\n    [-capWidth / 2, -size / 2],\r\n  ];\r\n}\r\n\r\nexport function bottlePartial(yStart, yEnd, size = 2) {\r\n  const bottleWidth = size / 2;\r\n  const v1 = [-bottleWidth / 2, size / 2 - yStart * size],\r\n    v2 = [bottleWidth / 2, size / 2 - yStart * size],\r\n    v3 = [bottleWidth / 2, size / 2 - yEnd * size],\r\n    v4 = [-bottleWidth / 2, size / 2 - yEnd * size];\r\n\r\n  return [\r\n    [v1, v2, v3],\r\n    [v1, v3, v4],\r\n  ];\r\n}\r\n\r\nexport function circlet(s) {\r\n  s.attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke\", \"#CC8F43\")\r\n    .attr(\"stroke-dasharray\", 3)\r\n    .attr(\"stroke-width\", 3)\r\n    .attr(\"vector-effect\", \"non-scaling-stroke\");\r\n}\r\n\r\nexport function showElems(elemStr, container, displayVal) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", displayVal || \"block\");\r\n}\r\n\r\nexport function hideElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", \"none\");\r\n}\r\n\r\nexport function removeElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).remove();\r\n}\r\n\r\nexport function gradientInit(levs, gradId) {\r\n  return (s) => {\r\n    const stops = s\r\n      .append(\"defs\")\r\n      .append(\"linearGradient\")\r\n      .attr(\"id\", gradId)\r\n      .attr(\"x1\", \"0%\")\r\n      .attr(\"x2\", \"0%\")\r\n      .attr(\"y1\", \"0%\")\r\n      .attr(\"y2\", \"100%\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n    levs.forEach((_, i) => {\r\n      for (let j = 0; j < 2; j++) {\r\n        stops\r\n          .append(\"stop\")\r\n          .attr(\r\n            \"stop-color\",\r\n            interpolateWatercolorBlue(i / settings.LOD_1_LEVELS)\r\n          );\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nexport function gradientUpdate(levs, maxLev) {\r\n  return (s) => {\r\n    s.selectAll(\"stop\").each(function (_, i) {\r\n      // first stop is at 0\r\n      if (i === 0) {\r\n        d3.select(this).attr(\"offset\", `0%`);\r\n        return;\r\n      }\r\n\r\n      // last stop is at 100\r\n      if (i === (levs.length + 1) * 2 - 1) {\r\n        d3.select(this).attr(\"offset\", `100%`);\r\n        return;\r\n      }\r\n\r\n      let valOffset = Math.floor((i - 1) / 2);\r\n\r\n      d3.select(this).attr(\r\n        \"offset\",\r\n        `${(1 - clamp(levs[valOffset] / maxLev, 0, 1)) * 100}%`\r\n      );\r\n    });\r\n  };\r\n}\r\n\r\nexport function worldToScreen(x, y, camTransform) {\r\n  return [\r\n    x * camTransform.k + camTransform.x,\r\n    y * camTransform.k + camTransform.y,\r\n  ];\r\n}\r\n\r\nexport function screenToWorld(x, y, camTransform) {\r\n  return [\r\n    (x - camTransform.x) / camTransform.k,\r\n    (y - camTransform.y) / camTransform.k,\r\n  ];\r\n}\r\n\r\nexport function generateTSpan(text, lineHeight = 1.2, len = 15) {\r\n  return (s) => {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = typeof text === \"string\" ? wrap(text, len).split(\"\\n\") : text;\r\n\r\n    const x = s.attr(\"x\");\r\n\r\n    lines.forEach((line) => {\r\n      s.append(\"tspan\").attr(\"x\", x).attr(\"dy\", `${lineHeight}em`).text(line);\r\n    });\r\n  };\r\n}\r\n\r\nexport function getConnectStyle(from, to) {\r\n  const width = dist(from, to);\r\n  const rot = radToDeg(Math.atan2(to[1] - from[1], to[0] - from[0]));\r\n  return {\r\n    left: `${from[0]}px`,\r\n    top: `${from[1]}px`,\r\n    width: `${width}px`,\r\n    rotate: `${rot}deg`,\r\n  };\r\n}\r\n","import React from \"react\";\r\n\r\nfunction initScripts() {\r\n  return {\r\n    barsExplain: (\r\n      <>\r\n        Here, the data is presented as bar graphs, with the bottom axis\r\n        representing the year and the side axis representing the amount of water\r\n        delivered in thousand acre-feet (TAF).\r\n      </>\r\n    ),\r\n    barsCondense: (\r\n      <>\r\n        We'll condense each bar graph into a single bar with a filled gradient.\r\n      </>\r\n    ),\r\n    bucketsFill: (\r\n      <>\r\n        What we get are containers of water showing which water levels are most\r\n        likely, with the darker areas being the most likely water levels.\r\n        <span className=\"supplement-card-info\">\r\n          Visuals made using{\" \"}\r\n          <a href=\"https://sarahayu.github.io/bucket-glyph/\" target=\"_blank\">\r\n            Bucket-Glyph\r\n          </a>\r\n        </span>\r\n      </>\r\n    ),\r\n    comparingTheTwo: (\r\n      <>\r\n        If we want a reliable supply we would want the refuge group's\r\n        deliveries, but if we want a chance at higher supplies of water however\r\n        with more inconsistent results, we would want the agriculture group's\r\n        deliveries.\r\n      </>\r\n    ),\r\n    forNowLetsFocus: (\r\n      <>\r\n        There is a chance 600 TAF of water will be delivered to this group. The\r\n        darker colors, however, indicate that it's more likely that slightly\r\n        less than 600 TAF of water will be delivered  around 500 TAF. As we'll\r\n        later see, this is not a lot compared to other areas of California.\r\n      </>\r\n    ),\r\n    ifChangeReality: (\r\n      <>\r\n        But what if we could <em>change reality</em>? What if we could increase\r\n        the likelihood of delivering as much water as possible by changing the\r\n        way we manage it?\r\n      </>\r\n    ),\r\n    fortunateCanExplore: (\r\n      <>\r\n        Fortunately, we can explore those possibilities with the help of a\r\n        simulator called\r\n        <b> CalSim</b>.\r\n      </>\r\n    ),\r\n    theseVarsCalled: (\r\n      <>\r\n        These variations are called <em>scenarios</em> and are labelled with\r\n        unique numbers. Our reality is a scenario with no variables changed,\r\n        labelled scenario 0000.\r\n      </>\r\n    ),\r\n    atAGlance: (\r\n      <>\r\n        At a glance, we can easily see that scenario 0020 appears to be the best\r\n        scenario since the darker water levels reach higher than those of the\r\n        other scenarios. To more concretely compare these scenarios, however,\r\n        we'll use a different view.\r\n      </>\r\n    ),\r\n    tryMoveRed: (\r\n      <>\r\n        Try moving the dotted line to change the minimum demand and see how well\r\n        each of these scenarios meet those demands.\r\n      </>\r\n    ),\r\n    soWhyNot: (\r\n      <>\r\n        So why don't we just choose the best scenario? Well, it's because it's\r\n        not just this group that wants water. Other groups, which we call{\" \"}\r\n        <em>objectives</em>, want scenarios that best fit <em>them.</em>\r\n      </>\r\n    ),\r\n    letsBringRefuge: (\r\n      <>\r\n        The scenarios that benefit one objective do not always benefit another.\r\n        Hover over the waterdrops to see how the same scenarios place for each\r\n        objective. (Can you find a scenario that benefits both?)\r\n      </>\r\n    ),\r\n  };\r\n}\r\n\r\nexport const scripts = initScripts();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact, levelToDropletLevel } from \"bucket-lib/utils\";\r\n\r\nimport { objectivesData } from \"data/objectives-tutorial-data\";\r\n\r\nfunction initConstants() {\r\n  const BAR_CHART_WIDTH = 500,\r\n    BAR_CHART_HEIGHT = 400;\r\n\r\n  const INTERP_COLOR = d3.interpolateRgbBasis([\r\n    \"#F2F5FB\",\r\n    \"#D0DDEB\",\r\n    \"#7B9BC0\",\r\n    \"#4F739F\",\r\n    \"#112A57\",\r\n  ]);\r\n\r\n  const PAG_OBJECTIVE = \"DEL_CVP_PAG_N\";\r\n  const PRF_OBJECTIVE = \"DEL_CVP_PRF_S\";\r\n\r\n  const PAG_COLOR = \"#808C54\";\r\n  const PRF_COLOR = \"#60A4BF\";\r\n\r\n  const DEFAULT_SCENARIO = \"expl0000\";\r\n\r\n  const PAG_DELIVS =\r\n    objectivesData.OBJECTIVES_DATA[PAG_OBJECTIVE][\r\n      objectivesData.SCENARIO_KEY_STRING\r\n    ][DEFAULT_SCENARIO][objectivesData.DELIV_KEY_STRING];\r\n  const PRF_DELIVS =\r\n    objectivesData.OBJECTIVES_DATA[PRF_OBJECTIVE][\r\n      objectivesData.SCENARIO_KEY_STRING\r\n    ][DEFAULT_SCENARIO][objectivesData.DELIV_KEY_STRING];\r\n\r\n  const VARIATIONS = [\r\n    \"expl0020\", // change priority\r\n    \"expl0080\", // increase carryover\r\n    \"expl0480\", // decrease demand\r\n    \"expl0004\", // increase minflow\r\n  ];\r\n\r\n  const VARIATIONS_DELIVS = VARIATIONS.map(\r\n    (vars) =>\r\n      objectivesData.OBJECTIVES_DATA[PAG_OBJECTIVE][\r\n        objectivesData.SCENARIO_KEY_STRING\r\n      ][vars][objectivesData.DELIV_KEY_STRING]\r\n  );\r\n\r\n  const VARIATIONS_INTERPERS = VARIATIONS_DELIVS.map(\r\n    (varDelivs) => (val) =>\r\n      levelToDropletLevel(\r\n        d3\r\n          .scaleLinear()\r\n          .domain(ticksExact(0, 1, varDelivs.length))\r\n          .range(\r\n            varDelivs\r\n              .map((v) => v / objectivesData.MAX_DELIVS)\r\n              .sort()\r\n              .reverse()\r\n          )\r\n          .clamp(true)(val)\r\n      )\r\n  );\r\n\r\n  const PAG_INTERPER = (val) =>\r\n    d3\r\n      .scaleLinear()\r\n      .domain(ticksExact(0, 1, PAG_DELIVS.length))\r\n      .range(\r\n        PAG_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n          .sort()\r\n          .reverse()\r\n      )\r\n      .clamp(true)(val);\r\n\r\n  const PAG_INTERPER_DROP = (val) =>\r\n    levelToDropletLevel(\r\n      d3\r\n        .scaleLinear()\r\n        .domain(ticksExact(0, 1, PAG_DELIVS.length))\r\n        .range(\r\n          PAG_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n            .sort()\r\n            .reverse()\r\n        )\r\n        .clamp(true)(val)\r\n    );\r\n\r\n  const PRF_INTERPER = (val) =>\r\n    d3\r\n      .scaleLinear()\r\n      .domain(ticksExact(0, 1, PRF_DELIVS.length))\r\n      .range(\r\n        PRF_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n          .sort()\r\n          .reverse()\r\n      )\r\n      .clamp(true)(val);\r\n\r\n  const DROP_VARIATIONS = [\r\n    {\r\n      idx: 0,\r\n      scen: \"0020\",\r\n      clas: \"drop1\",\r\n      desc: \"change priority\",\r\n    },\r\n    {\r\n      idx: 1,\r\n      scen: \"0080\",\r\n      clas: \"drop2\",\r\n      desc: \"increase carryover\",\r\n    },\r\n    {\r\n      idx: 2,\r\n      scen: \"0480\",\r\n      clas: \"drop3\",\r\n      desc: \"decrease demand\",\r\n    },\r\n    {\r\n      idx: 3,\r\n      scen: \"0004\",\r\n      clas: \"drop4\",\r\n      desc: \"increase minimum flow\",\r\n    },\r\n  ];\r\n\r\n  const MAX_DELIVS = objectivesData.MAX_DELIVS;\r\n\r\n  return {\r\n    BAR_CHART_WIDTH,\r\n    BAR_CHART_HEIGHT,\r\n    INTERP_COLOR,\r\n    PAG_OBJECTIVE,\r\n    PRF_OBJECTIVE,\r\n    PAG_COLOR,\r\n    PRF_COLOR,\r\n    DEFAULT_SCENARIO,\r\n    PAG_DELIVS,\r\n    PRF_DELIVS,\r\n    VARIATIONS,\r\n    VARIATIONS_DELIVS,\r\n    VARIATIONS_INTERPERS,\r\n    PAG_INTERPER,\r\n    PAG_INTERPER_DROP,\r\n    PRF_INTERPER,\r\n    DROP_VARIATIONS,\r\n    MAX_DELIVS,\r\n  };\r\n}\r\n\r\nconst constants = initConstants();\r\n\r\nexport { constants };\r\n","import { ticksExact } from \"bucket-lib/utils\";\r\nimport { settings as appSettings } from \"settings\";\r\n\r\nimport { calcDomLev, createInterpsFromDelivs } from \"utils/data-utils\";\r\nimport { placeDropsUsingPhysics, rotatePoint } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\nimport * as d3 from \"d3\";\r\n\r\n// TODO optimize!!\r\nfunction initWaterdrops(objectivesData, descriptionsData, settings) {\r\n  console.time(\"init waterdrops\");\r\n\r\n  const groupKeys = objectivesData.OBJECTIVE_IDS;\r\n  const memberKeys = settings\r\n    ? objectivesData.SCENARIO_IDS.filter(\r\n        (scenario) =>\r\n          objectivesData.MIN_MAXES[settings.egoObjective][scenario][0] >=\r\n          settings.minDelivery\r\n      )\r\n    : objectivesData.SCENARIO_IDS;\r\n\r\n  const amtGroups = groupKeys.length;\r\n  const amtPerGroup = memberKeys.length;\r\n\r\n  const largeDropRad =\r\n    Math.sqrt(amtPerGroup / Math.PI) *\r\n    appSettings.LOD_1_RAD_PX *\r\n    2 *\r\n    appSettings.LOD_1_SMALL_DROP_PAD_FACTOR *\r\n    appSettings.LOD_1_LARGE_DROP_PAD_FACTOR;\r\n  const smallDropRad =\r\n    appSettings.LOD_1_RAD_PX * appSettings.LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  const largeNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    groupKeys.map((p, idx) => ({\r\n      r: largeDropRad,\r\n      id: idx,\r\n    })),\r\n    0.8\r\n  );\r\n\r\n  for (let i = 0; i < largeNodesPhys.length; i++) {\r\n    largeNodesPhys[i].tilt = Math.random() * 40 - 20;\r\n  }\r\n\r\n  const largeNodesPos = mapBy(largeNodesPhys, ({ id }) => id);\r\n\r\n  const smallNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    memberKeys.map((s, idx) => ({\r\n      r: smallDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const smallNodesPos = mapBy(smallNodesPhys, ({ id }) => id);\r\n\r\n  const nodes = [];\r\n  const nodeKeyToIdx = [];\r\n  const groupNodes = [];\r\n\r\n  const groupToNodes = {};\r\n  const groupKeyToIdx = {};\r\n\r\n  const rankCache = {};\r\n\r\n  let idx = 0;\r\n\r\n  for (const nodeData of objectivesData.FLATTENED_DATA) {\r\n    const { id, objective, scenario, deliveries } = nodeData;\r\n\r\n    if (!memberKeys.includes(scenario)) continue;\r\n\r\n    const [delivMin, delivMax] = objectivesData.MIN_MAXES[objective];\r\n\r\n    const i = createInterpsFromDelivs(deliveries, delivMin, delivMax);\r\n    const wds = ticksExact(0, 1, appSettings.LOD_1_LEVELS + 1).map((d) => i(d));\r\n\r\n    const levs = wds.map(\r\n      (w, i) =>\r\n        Math.max(w, i == 0 ? appSettings.LOD_1_MIN_LEV_VAL : 0) *\r\n        appSettings.LOD_1_RAD_PX\r\n    );\r\n\r\n    const groupID = objective;\r\n    const memberID = scenario;\r\n\r\n    if (rankCache[groupID] === undefined) {\r\n      let arrRanks = [];\r\n      for (let mkey of memberKeys) {\r\n        arrRanks.push(\r\n          objectivesData.DATA_GROUPINGS[\"objective\"][groupID][mkey]\r\n        );\r\n      }\r\n\r\n      let rankMap = {};\r\n\r\n      arrRanks.sort(d3.ascending);\r\n\r\n      for (let i = 0; i < arrRanks.length; i++) {\r\n        rankMap[arrRanks[i]] = i;\r\n      }\r\n\r\n      rankCache[groupID] = rankMap;\r\n    }\r\n\r\n    const groupRank = objectivesData.DATA_GROUPINGS[\"objective\"][groupID].rank;\r\n    const memberRank =\r\n      rankCache[groupID][\r\n        objectivesData.DATA_GROUPINGS[\"objective\"][groupID][memberID]\r\n      ];\r\n\r\n    const localTilt = Math.random() * 50 - 25;\r\n    const parentTilt = largeNodesPos[groupRank].tilt;\r\n\r\n    const { x, y } = smallNodesPos[memberRank];\r\n    const [rotatedX, rotatedY] = rotatePoint(x, y, parentTilt);\r\n\r\n    const node = {\r\n      id,\r\n      levs,\r\n      maxLev: appSettings.LOD_1_RAD_PX,\r\n      domLev: calcDomLev(levs),\r\n      tilt: localTilt,\r\n      dur: Math.random() * 100 + 400,\r\n      x,\r\n      y,\r\n      group: groupID,\r\n      key: memberID,\r\n      globalX: largeNodesPos[groupRank].x + rotatedX,\r\n      globalY: largeNodesPos[groupRank].y + rotatedY,\r\n      globalTilt: parentTilt + localTilt,\r\n    };\r\n\r\n    nodes.push(node);\r\n\r\n    if (!groupToNodes[groupID]) groupToNodes[groupID] = [];\r\n\r\n    groupToNodes[groupID].push(node);\r\n    nodeKeyToIdx[id] = idx++;\r\n  }\r\n\r\n  idx = 0;\r\n\r\n  for (const groupKey of groupKeys) {\r\n    const { x, y, tilt } =\r\n      largeNodesPos[objectivesData.DATA_GROUPINGS[\"objective\"][groupKey].rank];\r\n    groupNodes.push({\r\n      x,\r\n      y,\r\n      tilt,\r\n      key: groupKey,\r\n      height: smallNodesPhys.height,\r\n      nodes: groupToNodes[groupKey],\r\n      display_name: descriptionsData[groupKey]?.display_name || groupKey,\r\n    });\r\n\r\n    groupKeyToIdx[groupKey] = idx++;\r\n  }\r\n\r\n  console.timeEnd(\"init waterdrops\");\r\n\r\n  return {\r\n    nodes: nodes,\r\n    groups: groupNodes,\r\n    height: largeNodesPhys.height,\r\n    groupKeyToIdx,\r\n    nodeKeyToIdx,\r\n  };\r\n}\r\n\r\nexport { initWaterdrops };\r\n","import * as d3 from \"d3\";\r\n\r\nimport { spatialData } from \"data/spatial-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { dist, dropCenterCorrection, getCenterDomRect } from \"utils/math-utils\";\r\nimport { wrap } from \"utils/misc-utils\";\r\nimport { circlet } from \"utils/render-utils\";\r\n\r\nfunction interactorsInit() {\r\n  const s = d3.select(this);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"hover-capture\")\r\n    .attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke-width\", 0)\r\n    .attr(\"r\", 0.8);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"circlet interactive\")\r\n    .call(circlet)\r\n    .attr(\"r\", 1);\r\n\r\n  const textGroup = s.append(\"g\").attr(\"pointer-events\", \"none\");\r\n  textGroup\r\n    .append(\"image\")\r\n    .attr(\"href\", \"glow.png\")\r\n    .attr(\"preserveAspectRatio\", \"none\")\r\n    .attr(\"opacity\", 0.8);\r\n  textGroup\r\n    .append(\"text\")\r\n    .attr(\"class\", \"fancy-font cloud-text\")\r\n    .attr(\"text-anchor\", \"middle\")\r\n    .attr(\"font-size\", 0);\r\n}\r\n\r\nfunction interactorsUpdate(d) {\r\n  d3.select(this).select(\".circlet\").attr(\"id\", `b${d.key}`);\r\n  d3.select(this).select(\"text\").call(textUpdate(d));\r\n}\r\n\r\nfunction textUpdate(d) {\r\n  return function (s) {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = wrap(d.display_name).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      s.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", `${-lines.length / 2 + 0.5}em`)\r\n        .attr(\"dy\", `${i}em`)\r\n        .text(line);\r\n    });\r\n  };\r\n}\r\n\r\nfunction dropTransform({ x, y, height }) {\r\n  return `translate(${x}, ${y - dropCenterCorrection({ height })}) scale(${\r\n    height * settings.GROUP_HOVER_AREA_FACTOR\r\n  })`;\r\n}\r\n\r\nfunction getFontSize(d, transformZoom, cameraHeight, waterdropsHeight) {\r\n  const MAX_RAD = window.innerHeight / 9;\r\n\r\n  const zoomRel = cameraHeight / waterdropsHeight / transformZoom;\r\n\r\n  const absFontSize = (_d) =>\r\n    _d > MAX_RAD\r\n      ? 0\r\n      : d3.scaleLinear().domain([0, MAX_RAD]).range([1, 0.4]).clamp(true)(_d);\r\n\r\n  return absFontSize(d * zoomRel) * Math.min(zoomRel, 0.4);\r\n}\r\n\r\nfunction drawMinimapSVG() {\r\n  const width = 250,\r\n    height = 300;\r\n\r\n  const minimap = d3\r\n    .select(\"#minimap\")\r\n    .attr(\"width\", width)\r\n    .attr(\"height\", height);\r\n\r\n  const proj = d3\r\n    .geoMercator()\r\n    .scale(1000)\r\n    .center(spatialData.CALIFORNIA_CENTER)\r\n    .translate([width / 2, height / 2]);\r\n\r\n  const lineGeom = [\r\n    ...spatialData.SPATIAL_DATA.features.filter(\r\n      (f) => f.geometry.type === \"MultiPolygon\"\r\n    ),\r\n    spatialData.CALIFORNIA_OUTLINE,\r\n  ];\r\n  const pointGeom = spatialData.SPATIAL_DATA.features.filter(\r\n    (f) => f.geometry.type === \"MultiPoint\"\r\n  );\r\n\r\n  minimap\r\n    .selectAll(\"path\")\r\n    .data(lineGeom)\r\n    .join(\"path\")\r\n    .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"stroke\", \"transparent\")\r\n    .attr(\"stroke-width\", 1)\r\n    .attr(\"fill\", (d) => (d.properties.CalLiteID ? \"transparent\" : \"white\"))\r\n    .style(\"filter\", (d) =>\r\n      d.properties.CalLiteID\r\n        ? \"none\"\r\n        : \"drop-shadow(6px 6px 18px rgba(0, 0, 0, 0.1))\"\r\n    );\r\n\r\n  minimap\r\n    .selectAll(\"circle\")\r\n    .data(pointGeom)\r\n    .join(\"circle\")\r\n    .each(function (d) {\r\n      const s = d3.select(this);\r\n\r\n      const [x, y] = proj(d.geometry.coordinates[0]);\r\n\r\n      s.attr(\"cx\", x);\r\n      s.attr(\"cy\", y);\r\n    })\r\n    .attr(\"r\", 2)\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"fill\", \"transparent\");\r\n}\r\n\r\nfunction updateLargeDropSVG(\r\n  container,\r\n  waterdrops,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const drops = container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdrops.groups, ({ key }) => key)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(interactorsInit);\r\n    })\r\n    .each(interactorsUpdate)\r\n    .attr(\"transform\", dropTransform)\r\n    .select(\".hover-capture\");\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      d3.select(this.parentNode).raise();\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n}\r\n\r\nfunction fontSizer(transformInfo, camera, waterdropsHeight) {\r\n  return function () {\r\n    const tNode = d3.select(this).node();\r\n\r\n    const [posx, posy] = getCenterDomRect(tNode.getBoundingClientRect());\r\n\r\n    const width = ((tNode.getBBox().width * camera.height) / camera.far) * 8,\r\n      height = ((tNode.getBBox().height * camera.height) / camera.far) * 10;\r\n\r\n    const dis = dist(\r\n      [posx, posy],\r\n      [transformInfo.mouseX, transformInfo.mouseY]\r\n    );\r\n\r\n    d3.select(this).attr(\r\n      \"font-size\",\r\n      getFontSize(dis, transformInfo.zoom, camera.height, waterdropsHeight)\r\n    );\r\n\r\n    d3.select(this.parentNode.parentNode)\r\n      .select(\"image\")\r\n      .attr(\"x\", -width / 2)\r\n      .attr(\"y\", -height / 2)\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n  };\r\n}\r\n\r\nfunction fadeOutDrops(dropsMesh, scene, startOpac, duration) {\r\n  const t = d3.timer((elapsed) => {\r\n    const et = Math.min(1, elapsed / duration);\r\n\r\n    dropsMesh.updateVisibility(1 - et);\r\n    dropsMesh.updateOutlineVisibility(startOpac * (1 - et));\r\n\r\n    if (et >= 1) {\r\n      t.stop();\r\n      dropsMesh.remove(scene);\r\n    }\r\n  });\r\n}\r\n\r\nexport const helpers = {\r\n  drawMinimapSVG,\r\n  updateLargeDropSVG,\r\n  fontSizer,\r\n  fadeOutDrops,\r\n};\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingStickers from \"components/SceneSettingStickers\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { hideElems, removeElems, showElems } from \"utils/render-utils\";\r\nimport { createInterpsFromDelivs, deserialize } from \"utils/data-utils\";\r\nimport { helpers } from \"utils/compareview-helpers\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\nimport DropletGlyph from \"components/DropletGlyph\";\r\nimport BottleGlyph from \"components/BottleGlyph\";\r\n\r\nexport default function CompareView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n\r\n  const groupsRef = useRef();\r\n  const centerRef = useRef();\r\n\r\n  const getScreenDropHeight = () =>\r\n    groupsRef.current.groups[0].height * settings.SPREAD_1_2;\r\n\r\n  useEffect(function initialize() {\r\n    const container = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"compare-group\");\r\n\r\n    container.append(\"text\").attr(\"id\", \"member-variable\");\r\n    container.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    appCtx.addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"CompareView\")) {\r\n        const container = d3.select(\"#compare-group\");\r\n\r\n        const { viewCenter, transitionDuration = 0 } = appCtx.state;\r\n\r\n        centerRef.current = viewCenter;\r\n\r\n        groupsRef.current = helpers.getWaterdropGroups(\r\n          appCtx.activeWaterdrops,\r\n          appCtx.waterdrops,\r\n          viewCenter\r\n        );\r\n\r\n        helpers.updateDropsSVG(\r\n          container,\r\n          groupsRef.current,\r\n          transitionDuration / 5,\r\n          {\r\n            onHover: (d) => {\r\n              setActiveMinidrop({ key: d.key });\r\n            },\r\n          }\r\n        );\r\n\r\n        hideElems(\r\n          \".large-green-text, .baseline-pointer, .circlet, .comp-line, .highlight-circle\",\r\n          container\r\n        );\r\n\r\n        setTimeout(() => {\r\n          setActiveMinidrop({ key: groupsRef.current.groups[0].nodes[0].key });\r\n          showElems(\r\n            \"#member-variable, #member-label, .large-green-text, .baseline-pointer, .circlet, .comp-line, .highlight-circle\",\r\n            container\r\n          );\r\n          showElems(\".comp-settings\", d3, \"flex\");\r\n        }, transitionDuration + 500);\r\n\r\n        appCtx.setGoBack(() => () => {\r\n          const transitionDuration = appCtx.resetCamera();\r\n\r\n          appCtx.setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(appCtx.camera.curTransform);\r\n\r\n        return function exitState() {\r\n          removeElems(\".large-drop, .circlet, .comp-line\", container);\r\n\r\n          hideElems(\r\n            \"#member-variable, #member-label, .baseline-pointer\",\r\n            container\r\n          );\r\n          hideElems(\".comp-settings\");\r\n\r\n          setPanels([]);\r\n          appCtx.setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines, nodes] = helpers.calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop.key\r\n        );\r\n\r\n        setPanels(makePanelsFromNodes(nodes));\r\n        helpers.updateLabelSVG(\r\n          avgCoords(positions),\r\n          activeMinidrop.key.slice(4),\r\n          getScreenDropHeight()\r\n        );\r\n        helpers.updateScenIndicatorsSVG(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#compare-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop-group\", container);\r\n        showElems(\".large-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return objectivesData.KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      helpers.updateColorDrops(\r\n        container,\r\n        groupsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop-group\", container);\r\n      hideElems(\".large-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function makePanelsFromNodes(nodes) {\r\n    return (p) => {\r\n      return nodes.map((n, i) => {\r\n        let ox = 0,\r\n          oy = 0;\r\n\r\n        if (p[i]) {\r\n          ox = p[i].offsetX;\r\n          oy = p[i].offsetY;\r\n        }\r\n\r\n        const [x, y, isLeft] = getIdealGroupPos(\r\n          groupsRef.current.groupPositions[i]\r\n        );\r\n\r\n        return {\r\n          text: n.key,\r\n          x,\r\n          y,\r\n          id: groupsRef.current.groups[i].key,\r\n          nodeID: n.id,\r\n          isLeft,\r\n          offsetX: ox,\r\n          offsetY: oy,\r\n        };\r\n      });\r\n    };\r\n  }\r\n\r\n  function getIdealGroupPos({ x, y, isLeft }) {\r\n    let newX = x,\r\n      newY = y;\r\n\r\n    const correctionX =\r\n      groupsRef.current.groups[0].height * settings.SPREAD_1_2;\r\n\r\n    if (isLeft) newX -= correctionX;\r\n    else newX += correctionX;\r\n\r\n    return [newX, newY, isLeft];\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {activeMinidrop && (\r\n        <SceneSettingStickers\r\n          settings={deserialize(activeMinidrop.key.slice(4))}\r\n          setColorSetting={setColorSetting}\r\n        />\r\n      )}\r\n      {panels.map(({ x, y, id, isLeft, offsetX, offsetY, nodeID }, i) => {\r\n        const { objective } = objectivesData.FLATTENED_DATA[nodeID];\r\n        const delivs = objectivesData.FLATTENED_DATA[nodeID].deliveries;\r\n\r\n        const [delivMin, delivMax] = objectivesData.MIN_MAXES[objective];\r\n        const interper = createInterpsFromDelivs(delivs, delivMin, delivMax);\r\n\r\n        return (\r\n          <div\r\n            className={\"panel compare-panel\" + (isLeft ? \" left\" : \" right\")}\r\n            key={i}\r\n            style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n            onMouseDown={(e) => onPanelDragStart(e, { id })}\r\n          >\r\n            <div className=\"panel-main-container\">\r\n              <DotHistogram\r\n                width={420}\r\n                height={280}\r\n                data={delivs}\r\n                range={[delivMin, delivMax]}\r\n                goal={appCtx.goals[id]}\r\n                setGoal={(newGoal) => {\r\n                  appCtx.setGoals((g) => {\r\n                    g[id] = newGoal;\r\n                    return { ...g };\r\n                  });\r\n                }}\r\n              />\r\n              <BottleGlyph\r\n                maxValue={delivMax}\r\n                levelInterp={interper}\r\n                height={200}\r\n                resolution={4}\r\n              />\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingSubcard from \"components/SceneSettingSubcard\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport {\r\n  generateTSpan,\r\n  hideElems,\r\n  removeElems,\r\n  showElems,\r\n} from \"utils/render-utils\";\r\nimport { createInterpsFromDelivs, deserialize } from \"utils/data-utils\";\r\nimport { clipEnds, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { helpers } from \"utils/examineview-helpers\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\nimport DropletGlyph from \"components/DropletGlyph\";\r\nimport { ConnectLine } from \"components/ConnectLine\";\r\nimport BottleGlyph from \"components/BottleGlyph\";\r\n\r\nexport default function ExamineView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const activeMinidropsRef = useRef([]);\r\n  const curMinidropsRef = useRef(null);\r\n\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, panelsRef, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n  const panelCountRef = useRef(0);\r\n  const [hoveredCard, setHoveredCard] = useState(null);\r\n  const removePreviewRef = useRef(null);\r\n\r\n  useEffect(function initialize() {\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"examine-group\");\r\n\r\n    svgGroup\r\n      .append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"opacity\", 0);\r\n\r\n    svgGroup\r\n      .append(\"g\")\r\n      .attr(\"class\", \"baseline-pointer\")\r\n      .call(function (s) {\r\n        s.append(\"path\");\r\n        s.append(\"text\").text(\"baseline\");\r\n      })\r\n      .attr(\"opacity\", 0);\r\n\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"instruction-text large-green-text fancy-font\");\r\n    svgGroup.append(\"text\").attr(\"class\", \"drop-label fancy-font\");\r\n\r\n    appCtx.addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"ExamineView\")) {\r\n        const { transitionDuration = 0 } = appCtx.state;\r\n        const container = d3.select(\"#examine-group\");\r\n        curMinidropsRef.current = appCtx.waterdrops.groups.find(\r\n          (g) => g.key === appCtx.activeWaterdrops[0]\r\n        );\r\n\r\n        helpers.updateSmallDropSVG(\r\n          container,\r\n          curMinidropsRef.current,\r\n          transitionDuration / 2,\r\n          {\r\n            onClick: updateActiveMinidrops,\r\n            onHover: hoverDrop,\r\n            onUnhover: unhoverDrop,\r\n          }\r\n        );\r\n\r\n        setTimeout(showAdditionalInfo, transitionDuration * 1.2);\r\n\r\n        appCtx.setGoBack(() => () => {\r\n          const transitionDuration = appCtx.resetCamera();\r\n\r\n          appCtx.setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(appCtx.camera.curTransform);\r\n        showElems(\"#examine-group\");\r\n\r\n        panelCountRef.current = 0;\r\n\r\n        return function exitState() {\r\n          removeElems(\".small-drop, .circlet\", container);\r\n          hideElems(\"#examine-group\");\r\n\r\n          d3.selectAll(\r\n            \"#examine-group .instruction-text, #examine-group .drop-label, #examine-group .highlight-circle, #examine-group .baseline-pointer\"\r\n          ).attr(\"opacity\", 0);\r\n\r\n          setPanels([]);\r\n          activeMinidropsRef.current = [];\r\n          curMinidropsRef.current = null;\r\n          appCtx.setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#examine-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop\", container);\r\n        showElems(\".small-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return objectivesData.KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      helpers.updateColorDrops(\r\n        container,\r\n        curMinidropsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop\", container);\r\n      hideElems(\".small-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function showAdditionalInfo() {\r\n    const instrFontSize =\r\n      (curMinidropsRef.current.height * settings.SPREAD_1_2) / 20;\r\n\r\n    d3.select(\"#examine-group .instruction-text\")\r\n      .attr(\r\n        \"x\",\r\n        curMinidropsRef.current.x -\r\n          curMinidropsRef.current.height * settings.SPREAD_1_2 * 0.8\r\n      )\r\n      .attr(\"y\", curMinidropsRef.current.y - instrFontSize)\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", instrFontSize)\r\n      .call(\r\n        generateTSpan([\"click to keep panels open\", \"you can drag panels\"], 1.6)\r\n      )\r\n      .call((s) => {\r\n        s.transition().attr(\"opacity\", 1);\r\n      })\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * instrFontSize);\r\n      });\r\n\r\n    const labelFontSize =\r\n      (curMinidropsRef.current.height * settings.SPREAD_1_2) / 15;\r\n\r\n    d3.select(\"#examine-group .drop-label\")\r\n      .attr(\"x\", curMinidropsRef.current.x)\r\n      .attr(\r\n        \"y\",\r\n        curMinidropsRef.current.y +\r\n          (curMinidropsRef.current.height / 2) * settings.SPREAD_1_2 * 0.9\r\n      )\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"font-size\", labelFontSize)\r\n      .call(generateTSpan(curMinidropsRef.current.display_name, 1.2, 30))\r\n      .transition()\r\n      .attr(\"opacity\", 1);\r\n\r\n    d3.selectAll(\r\n      \"#examine-group .highlight-circle, #examine-group .baseline-pointer\"\r\n    )\r\n      .attr(\"opacity\", 0)\r\n      .transition()\r\n      .attr(\"opacity\", 1);\r\n  }\r\n\r\n  function addDetailPanel(dropId, preview = false, forceReplace = false) {\r\n    const {\r\n      x: groupX,\r\n      y: groupY,\r\n      height: groupHeight,\r\n    } = curMinidropsRef.current;\r\n    const { x, y, id, key } =\r\n      appCtx.waterdrops.nodes[appCtx.waterdrops.nodeKeyToIdx[dropId]];\r\n    setPanels((p) => {\r\n      if (p.findIndex(({ id: pid }) => id === pid) !== -1) {\r\n        if (!forceReplace) return p;\r\n\r\n        arrRemove(p, (_p) => _p.id === id);\r\n      }\r\n\r\n      let offsetCount = preview\r\n        ? panelCountRef.current + 1\r\n        : ++panelCountRef.current;\r\n\r\n      const offset =\r\n        (dropCenterCorrection({ height: groupHeight }) * settings.SPREAD_1_2) /\r\n        4;\r\n\r\n      const newPanel = {\r\n        text: key.slice(4),\r\n        x:\r\n          groupX +\r\n          (groupHeight * settings.SPREAD_1_2) / 2 +\r\n          offset * offsetCount,\r\n        y:\r\n          groupY -\r\n          dropCenterCorrection({ height: groupHeight }) * settings.SPREAD_1_2 +\r\n          offset * offsetCount,\r\n        offsetX: 0,\r\n        offsetY: 0,\r\n        circleX: groupX + x * settings.SPREAD_1_2,\r\n        circleY: groupY + y * settings.SPREAD_1_2,\r\n        id,\r\n        preview,\r\n        panelKey: preview ? -1 : dropId,\r\n      };\r\n\r\n      return [...p, newPanel];\r\n    });\r\n  }\r\n\r\n  function removeDetailPanel(dropId) {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ id }) => dropId === id);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function removePreviewPanel() {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ panelKey }) => panelKey === -1);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function updateActiveMinidrops(d) {\r\n    const container = d3.select(\"#examine-group\");\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      arrRemove(activeMinidropsRef.current, d.id);\r\n      container.select(`.circlet#i${d.id}`).classed(\"active\", false);\r\n      removeDetailPanel(d.id);\r\n      setHoveredCard(null);\r\n    } else {\r\n      removeDetailPanel(d.id);\r\n      activeMinidropsRef.current.push(d.id);\r\n      container.select(`.circlet#i${d.id}`).classed(\"active\", true);\r\n      addDetailPanel(d.id);\r\n      setHoveredCard(d.id);\r\n    }\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      d3.select(`.examine-panel#p${d.id}`).style(\"z-index\", 100);\r\n      setHoveredCard(d.id);\r\n    } else {\r\n      if (removePreviewRef.current) {\r\n        clearTimeout(removePreviewRef.current);\r\n        removePreviewPanel();\r\n      }\r\n      addDetailPanel(d.id, true);\r\n    }\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    if (!activeMinidropsRef.current.includes(d.id)) {\r\n      removePreviewRef.current = setTimeout(() => {\r\n        removeDetailPanel(d.id);\r\n        removePreviewRef.current = null;\r\n      }, 100);\r\n    }\r\n\r\n    setHoveredCard((hc) => (hc === d.id ? null : hc));\r\n    d3.select(`.examine-panel#p${d.id}`).style(\"z-index\", 0);\r\n  }\r\n\r\n  function drawLineConnect(id) {\r\n    if (panelsRef.current.findIndex(({ id: pid }) => id === pid) === -1) return;\r\n\r\n    const { circleX, circleY } = panelsRef.current.find((p) => p.id === id);\r\n\r\n    const [cx, cy] = appCtx.camera.worldToScreen(circleX, circleY);\r\n\r\n    const panelNode = d3.select(`.examine-panel#p${id}`).node();\r\n\r\n    // panel might not have been created\r\n    if (!panelNode) return;\r\n\r\n    const panelBox = panelNode.getBoundingClientRect();\r\n    const [px, py] = [\r\n      panelBox.left + panelBox.width / 2,\r\n      panelBox.top + panelBox.height / 2,\r\n    ];\r\n\r\n    const diffX = px - cx;\r\n    const diffY = py - cy;\r\n\r\n    let left, top;\r\n    const margin = 5;\r\n\r\n    if (Math.abs(diffX) > Math.abs(diffY)) {\r\n      top = 0;\r\n      left = (diffX < 0 ? 1 : -1) * (panelBox.width / 2 - margin);\r\n    } else {\r\n      left = 0;\r\n      top = (diffY < 0 ? 1 : -1) * (panelBox.height / 2 - margin);\r\n    }\r\n\r\n    const line = clipEnds(\r\n      [\r\n        [cx, cy],\r\n        [px + left, py + top],\r\n      ],\r\n      8,\r\n      0\r\n    );\r\n\r\n    return line;\r\n  }\r\n\r\n  if (isState(appCtx.state, \"ExamineView\")) {\r\n    return (\r\n      <>\r\n        {panels.map(\r\n          ({ text, x, y, id, offsetX, offsetY, panelKey, preview }) => {\r\n            const { objective, scenario } = objectivesData.FLATTENED_DATA[id];\r\n            const delivs = objectivesData.FLATTENED_DATA[id].deliveries;\r\n\r\n            const [delivMin, delivMax] = objectivesData.MIN_MAXES[objective];\r\n            const interper = createInterpsFromDelivs(\r\n              delivs,\r\n              delivMin,\r\n              delivMax\r\n            );\r\n\r\n            return (\r\n              <div\r\n                className={`panel examine-panel ${preview ? \"preview\" : \"\"}`}\r\n                id={`p${id}`}\r\n                key={preview ? -1 : id}\r\n                style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n                onMouseDown={(e) => !preview && onPanelDragStart(e, { id })}\r\n                onMouseEnter={() => !preview && hoverDrop({ id })}\r\n                onMouseLeave={() => !preview && unhoverDrop({ id })}\r\n              >\r\n                <div className=\"panel-tab\">\r\n                  scenario <span>{text}</span>\r\n                </div>\r\n                {!preview && hoveredCard == id && (\r\n                  <button\r\n                    className=\"exit-btn\"\r\n                    onClick={() => updateActiveMinidrops({ id })}\r\n                  >\r\n                    \r\n                  </button>\r\n                )}\r\n                <div className=\"panel-main-container\">\r\n                  <DotHistogram\r\n                    width={480}\r\n                    height={320}\r\n                    data={delivs}\r\n                    range={[delivMin, delivMax]}\r\n                    goal={appCtx.goals[appCtx.activeWaterdrops[0]]}\r\n                    setGoal={(newGoal) => {\r\n                      appCtx.setGoals((g) => {\r\n                        g[appCtx.activeWaterdrops[0]] = newGoal;\r\n                        return { ...g };\r\n                      });\r\n                    }}\r\n                  />\r\n                  <BottleGlyph\r\n                    levelInterp={interper}\r\n                    maxValue={delivMax}\r\n                    height={200}\r\n                    resolution={4}\r\n                  />\r\n                </div>\r\n                <SceneSettingSubcard\r\n                  settings={deserialize(text)}\r\n                  setColorSetting={setColorSetting}\r\n                />\r\n              </div>\r\n            );\r\n          }\r\n        )}\r\n        {hoveredCard && (\r\n          <ConnectLine connectLine={drawLineConnect(hoveredCard)} />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { useContext, useLayoutEffect, useState } from \"react\";\r\nimport { Step } from \"react-scrollama\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { useDataStory } from \"hooks/useDataStory\";\r\nimport { hideElems } from \"utils/render-utils\";\r\n\r\nimport { CallToExploreSection } from \"components/CallToExploreSection\";\r\nimport { CardBBox } from \"components/CardBBox\";\r\nimport { CompareBigDroplets } from \"components/CompareBigDroplets\";\r\nimport { CompareBucketCreationsBackground } from \"components/CompareBucketCreationsBackground\";\r\nimport { CompareScenariosGraphics } from \"components/CompareScenariosGraphics\";\r\nimport { DataStoryScrollama } from \"components/DataStoryScrollama\";\r\nimport { PointGroups } from \"components/PointGroups\";\r\nimport { TutHero } from \"components/TutHero\";\r\nimport { descriptionsData } from \"data/descriptions-tutorial-data\";\r\nimport { objectivesData } from \"data/objectives-tutorial-data\";\r\nimport { initWaterdrops } from \"utils/waterdrop-utils\";\r\nimport { BiSkipPrevious } from \"react-icons/bi\";\r\n\r\nconst tutorialWaterdrops = initWaterdrops(objectivesData, descriptionsData);\r\n\r\nexport default function TutorialView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const { hookAnimations, getSlidesInRange, storyVars, index, setIndex } =\r\n    useDataStory(tutorialWaterdrops, appCtx.camera);\r\n\r\n  useLayoutEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"TutorialView\")) {\r\n        hideElems(\r\n          \".tut-graph .bottle-wrapper, .vardrop, .var-scen-label, .vardrop .dot-histogram-wrapper, .main-histogram, .tut-comparer-graphics-wrapper\"\r\n        );\r\n\r\n        hookAnimations();\r\n\r\n        setIndex(-1);\r\n\r\n        return function exitState() {\r\n          appCtx.resetCamera(false);\r\n          hideElems(\".tutorial-view\");\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  const [hasEnteredCTE, setHasEnteredCTE] = useState(false);\r\n\r\n  if (!isState(appCtx.state, \"TutorialView\")) return;\r\n\r\n  return (\r\n    <div className=\"tutorial-view\">\r\n      <div className=\"tutorial-btns\">\r\n        {index !== -1 && (\r\n          <button\r\n            className=\"scrollama-prev\"\r\n            title=\"go to previous slide\"\r\n            onClick={() => {\r\n              if (hasEnteredCTE) {\r\n                document\r\n                  .getElementById(`card-${index}`)\r\n                  .scrollIntoView({ behavior: \"smooth\" });\r\n              } else {\r\n                let elem = document.getElementById(`card-${index - 1}`);\r\n\r\n                if (!elem) {\r\n                  elem = document.getElementById(\"tut-hero\");\r\n                }\r\n\r\n                elem.scrollIntoView({ behavior: \"smooth\" });\r\n              }\r\n            }}\r\n          >\r\n            <BiSkipPrevious />\r\n          </button>\r\n        )}\r\n        {!hasEnteredCTE && (\r\n          <button\r\n            className=\"scrollama-next\"\r\n            onClick={() => {\r\n              let elem = document.getElementById(`card-${index + 1}`);\r\n\r\n              if (!elem) {\r\n                elem = document.getElementById(\"cte\");\r\n              }\r\n\r\n              elem.scrollIntoView({ behavior: \"smooth\" });\r\n            }}\r\n          >\r\n            Click Here or Scroll to Continue\r\n          </button>\r\n        )}\r\n      </div>\r\n      <TutHero appCtx={appCtx} />\r\n      <div className=\"scrollama scrollama-create-buckets\">\r\n        <CompareBucketCreationsBackground\r\n          appCtx={appCtx}\r\n          storyVars={storyVars}\r\n        />\r\n        <DataStoryScrollama\r\n          onSlideEnter={({ data }) => {\r\n            setIndex(data.idx);\r\n          }}\r\n          onSlideExit={({ data, direction }) => {\r\n            if (direction === \"up\") setIndex(data.idx - 1);\r\n            else if (!document.getElementById(`card-${index + 1}`))\r\n              setHasEnteredCTE(true);\r\n          }}\r\n        >\r\n          {getSlidesInRange(\"barsExplain\", \"comparingTheTwo\").map(\r\n            (slide, i) => (\r\n              <Step key={i} data={slide}>\r\n                <CardBBox id={`card-${slide.idx}`}>{slide.script}</CardBBox>\r\n              </Step>\r\n            )\r\n          )}\r\n        </DataStoryScrollama>\r\n      </div>\r\n      <div className=\"scrollama scrollama-compare-scenobjs scenarios-section\">\r\n        <CompareScenariosGraphics\r\n          storyVars={storyVars}\r\n          size={appCtx.appHeight * 0.4}\r\n        />\r\n        <DataStoryScrollama\r\n          onSlideEnter={({ data }) => {\r\n            setHasEnteredCTE(false);\r\n            setIndex(data.idx);\r\n          }}\r\n          onSlideExit={({ data, direction }) => {\r\n            if (direction === \"up\") setIndex(data.idx - 1);\r\n            else if (!document.getElementById(`card-${index + 1}`))\r\n              setHasEnteredCTE(true);\r\n          }}\r\n        >\r\n          {getSlidesInRange(\"forNowLetsFocus\", \"letsBringRefuge\").map(\r\n            (slide, i) => (\r\n              <Step key={i} data={slide}>\r\n                <CardBBox id={`card-${slide.idx}`}>{slide.script}</CardBBox>\r\n              </Step>\r\n            )\r\n          )}\r\n        </DataStoryScrollama>\r\n      </div>\r\n      <CallToExploreSection\r\n        onClick={() => appCtx.setState({ state: \"WideView\" })}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport fuzzysort from \"fuzzysort\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { spatialData } from \"data/spatial-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport { generateTSpan, hideElems, showElems } from \"utils/render-utils\";\r\nimport { helpers } from \"utils/wideview-helpers\";\r\nimport { ActionButtons } from \"components/ActionButtons\";\r\nimport { BiCheck } from \"react-icons/bi\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\n\r\nexport default function WideView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const [curScreenTransform, setCurScreenTransform] = useState({\r\n    zoom: 1,\r\n    mouseX: 0,\r\n    mouseY: 0,\r\n  });\r\n\r\n  const firstStateEnterRef = useRef(true);\r\n  const [currentHoveredDrop, setCurrentHoveredDrop] = useState(null);\r\n  const [searchPrompt, setSearchPrompt] = useState(null);\r\n  const [filterIsVisible, setFilterIsVisible] = useState(false);\r\n  const [egoObjective, setEgoObjective] = useState(null);\r\n  const [minDelivery, setMinDelivery] = useState(0);\r\n  const [menuEgoObjective, setMenuEgoObjective] = useState(null);\r\n  const [menuMinDelivery, setMenuMinDelivery] = useState(0);\r\n\r\n  const enableZoomRef = useRef(false);\r\n\r\n  useEffect(function initialize() {\r\n    initSVGGraphics();\r\n\r\n    const cleanup = registerEventListeners();\r\n\r\n    helpers.drawMinimapSVG();\r\n\r\n    return cleanup;\r\n  }, []);\r\n\r\n  useEffect(\r\n    function initializeEgoObjective() {\r\n      if (appCtx.waterdrops.groups && !egoObjective) {\r\n        const obj = appCtx.waterdrops.groups[0].key;\r\n        setEgoObjective(obj);\r\n        setMinDelivery(objectivesData.RANGE_OF_MINS[obj][0]);\r\n      }\r\n    },\r\n    [appCtx.waterdrops, egoObjective]\r\n  );\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"WideView\")) {\r\n        d3.select(\"body\").style(\"overflow\", \"hidden\");\r\n\r\n        enableZoomRef.current = true;\r\n        setCurScreenTransform((cst) => ({\r\n          ...cst,\r\n          zoom: appCtx.camera.curTransform.k,\r\n        }));\r\n\r\n        drawTHREEGraphics();\r\n        drawSVGGraphics();\r\n\r\n        showElems(\"#infobox, #mosaic-webgl, #mosaic-svg, #wide-group\");\r\n\r\n        firstStateEnterRef.current = false;\r\n\r\n        return function exitState() {\r\n          hideElems(\"#infobox, #wide-group\");\r\n\r\n          enableZoomRef.current = false;\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateFontSizes() {\r\n      if (enableZoomRef.current) {\r\n        d3.select(\"#wide-group\")\r\n          .selectAll(\".cloud-text\")\r\n          .each(\r\n            helpers.fontSizer(\r\n              curScreenTransform,\r\n              appCtx.camera,\r\n              appCtx.waterdrops.height\r\n            )\r\n          );\r\n      }\r\n    },\r\n    [curScreenTransform]\r\n  );\r\n\r\n  useEffect(\r\n    function updateVisibleScenarios() {\r\n      if (!egoObjective || firstStateEnterRef.current) return;\r\n\r\n      appCtx.updateWaterdrops({\r\n        egoObjective: egoObjective,\r\n        minDelivery: minDelivery,\r\n      });\r\n    },\r\n    [egoObjective, minDelivery]\r\n  );\r\n\r\n  useEffect(\r\n    function updateMenuMinDelivery() {\r\n      if (menuEgoObjective)\r\n        setMenuMinDelivery(objectivesData.RANGE_OF_MINS[menuEgoObjective][0]);\r\n    },\r\n    [menuEgoObjective]\r\n  );\r\n\r\n  useEffect(\r\n    function resetCam() {\r\n      if (firstStateEnterRef.current) return;\r\n\r\n      const transitionDuration = appCtx.resetCamera();\r\n\r\n      appCtx.setState({ state: \"WideView\", transitionDuration });\r\n    },\r\n    [appCtx.waterdrops]\r\n  );\r\n\r\n  const handleClickFilter = useCallback(\r\n    function () {\r\n      setMenuEgoObjective(egoObjective);\r\n      setMenuMinDelivery(minDelivery);\r\n      setFilterIsVisible(true);\r\n    },\r\n    [appCtx.waterdrops, egoObjective, minDelivery]\r\n  );\r\n\r\n  const handleClickDone = useCallback(\r\n    function () {\r\n      setFilterIsVisible(false);\r\n      setEgoObjective(menuEgoObjective);\r\n      setMinDelivery(menuMinDelivery);\r\n    },\r\n    [menuEgoObjective, menuMinDelivery]\r\n  );\r\n\r\n  const handleClickExamine = useCallback(\r\n    function () {\r\n      appCtx.setDisableCamAdjustments(true);\r\n\r\n      const { x, y, height } =\r\n        appCtx.waterdrops.groups[\r\n          appCtx.waterdrops.groupKeyToIdx[appCtx.activeWaterdrops[0]]\r\n        ];\r\n\r\n      const newCamPos = [\r\n        x,\r\n        y,\r\n        appCtx.camera.getZFromFarHeight(height * settings.SPREAD_1_2 * 1.5),\r\n      ];\r\n\r\n      const [startZoom, transitionDuration] = appCtx.zoomTo(\r\n        newCamPos,\r\n        function onFinish() {\r\n          appCtx.setDisableCamAdjustments(false);\r\n        }\r\n      );\r\n\r\n      startZoom();\r\n\r\n      appCtx.setState({ state: \"ExamineView\", transitionDuration });\r\n\r\n      const startOpacity = appCtx.getOutlineOpacity(\r\n        appCtx.camera.curTransform.k\r\n      );\r\n      helpers.fadeOutDrops(\r\n        appCtx.dropsMesh,\r\n        appCtx.scene,\r\n        startOpacity,\r\n        transitionDuration / 2\r\n      );\r\n    },\r\n    [appCtx.getOutlineOpacity, appCtx.activeWaterdrops]\r\n  );\r\n\r\n  const handleClickCompare = useCallback(\r\n    function () {\r\n      appCtx.setDisableCamAdjustments(true);\r\n\r\n      const dropsMidpoint = avgCoords(\r\n        appCtx.activeWaterdrops.map((wkey) => {\r\n          let wd =\r\n            appCtx.waterdrops.groups[appCtx.waterdrops.groupKeyToIdx[wkey]];\r\n          return [wd.x, wd.y];\r\n        })\r\n      );\r\n\r\n      const newCamPos = [\r\n        ...dropsMidpoint,\r\n        appCtx.camera.getZFromFarHeight(\r\n          appCtx.waterdrops.groups[0].height *\r\n            2 *\r\n            settings.SPREAD_1_2 *\r\n            0.75 *\r\n            2\r\n        ),\r\n      ];\r\n\r\n      const [startZoom, transitionDuration] = appCtx.zoomTo(\r\n        newCamPos,\r\n        function onFinish() {\r\n          appCtx.setDisableCamAdjustments(false);\r\n        }\r\n      );\r\n\r\n      startZoom();\r\n\r\n      appCtx.setState({\r\n        state: \"CompareView\",\r\n        transitionDuration,\r\n        viewCenter: dropsMidpoint,\r\n      });\r\n\r\n      const startOpacity = appCtx.getOutlineOpacity(\r\n        appCtx.camera.curTransform.k\r\n      );\r\n      helpers.fadeOutDrops(\r\n        appCtx.dropsMesh,\r\n        appCtx.scene,\r\n        startOpacity,\r\n        transitionDuration / 5\r\n      );\r\n    },\r\n    [appCtx.getOutlineOpacity, appCtx.activeWaterdrops]\r\n  );\r\n\r\n  const handleClickDeselectAll = useCallback(function () {\r\n    appCtx.setActiveWaterdrops([]);\r\n    d3.selectAll(\"#wide-group .circlet\").classed(\"active\", false);\r\n  }, []);\r\n\r\n  function initSVGGraphics() {\r\n    hideElems(\"#infobox, #mosaic-webgl, #mosaic-svg\");\r\n\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"wide-group\");\r\n\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"instruction-text large-green-text fancy-font\");\r\n  }\r\n\r\n  function registerEventListeners() {\r\n    const cameraListener = (transform) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        zoom: transform.k,\r\n      }));\r\n    };\r\n\r\n    const mouseListener = (e) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        mouseX: e.x,\r\n        mouseY: e.y,\r\n      }));\r\n    };\r\n\r\n    appCtx.addZoomHandler(cameraListener);\r\n    window.addEventListener(\"mousemove\", mouseListener);\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener(\"mousemove\", mouseListener);\r\n    };\r\n  }\r\n\r\n  function drawTHREEGraphics() {\r\n    console.time(\"drawing\");\r\n    appCtx.dropsMesh.draw(appCtx.scene);\r\n    console.timeEnd(\"drawing\");\r\n\r\n    appCtx.dropsMesh.updateVisibility(1);\r\n    appCtx.dropsMesh.updateOutlineVisibility(\r\n      appCtx.getOutlineOpacity(appCtx.camera.curTransform.k)\r\n    );\r\n  }\r\n\r\n  function drawSVGGraphics() {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    helpers.updateLargeDropSVG(container, appCtx.waterdrops, {\r\n      onClick: updateActiveDrops,\r\n      onHover: hoverDrop,\r\n      onUnhover: unhoverDrop,\r\n    });\r\n\r\n    for (const wd of appCtx.activeWaterdrops) {\r\n      container.select(`.circlet#b${wd}`).classed(\"active\", true);\r\n    }\r\n\r\n    const fontSize =\r\n      (40 * appCtx.camera.getZFromFarHeight(appCtx.waterdrops.height)) /\r\n      appCtx.camera.height;\r\n    container\r\n      .select(\".instruction-text\")\r\n      .attr(\"x\", 0 - appCtx.waterdrops.height * 0.6)\r\n      .attr(\"y\", -fontSize * 5)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", fontSize)\r\n      .call(\r\n        generateTSpan([\"click to interact\", \"scroll to zoom\", \"drag to pan\"], 2)\r\n      )\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * fontSize);\r\n      });\r\n  }\r\n\r\n  function updateActiveDrops(d) {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    appCtx.setActiveWaterdrops((aw) => {\r\n      if (aw.includes(d.key)) {\r\n        aw = arrRemove(aw, d.key);\r\n\r\n        container.select(`.circlet#b${d.key}`).classed(\"active\", false);\r\n      } else {\r\n        aw.push(d.key);\r\n\r\n        container.select(`.circlet#b${d.key}`).classed(\"active\", true);\r\n      }\r\n      return [...aw];\r\n    });\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    setCurrentHoveredDrop({\r\n      id: d.key,\r\n      description: descriptionsData[d.key]?.desc || d.key,\r\n    });\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"gray\");\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    setCurrentHoveredDrop(null);\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"transparent\");\r\n  }\r\n\r\n  const searchResults = useMemo(() => {\r\n    if (searchPrompt === null) return [];\r\n\r\n    return fuzzysort.go(searchPrompt, appCtx.waterdrops.groups, {\r\n      keys: [\r\n        (obj) => descriptionsData[obj.key].id,\r\n        (obj) => descriptionsData[obj.key].display_name,\r\n        (obj) => descriptionsData[obj.key].desc,\r\n      ],\r\n      limit: 10,\r\n      all: true,\r\n    });\r\n  }, [searchPrompt, appCtx.waterdrops]);\r\n\r\n  return (\r\n    <>\r\n      <div id=\"infobox\">\r\n        <svg id=\"minimap\"></svg>\r\n        {currentHoveredDrop && (\r\n          <div className=\"details\">\r\n            {!spatialData.SPATIAL_FEATURES[currentHoveredDrop.id] && (\r\n              <p className=\"no-loc-data\">No Location Data</p>\r\n            )}\r\n            <p className=\"curDesc\">{currentHoveredDrop.description}</p>\r\n            <p className=\"curKey\">\r\n              id: <span> {currentHoveredDrop.id} </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n        {!currentHoveredDrop && (\r\n          <div\r\n            className=\"searchbox\"\r\n            tabIndex={-1}\r\n            onBlur={(e) => {\r\n              // https://stackoverflow.com/a/71530515\r\n              const currentTarget = e.currentTarget;\r\n\r\n              // Give browser time to focus the next element\r\n              requestAnimationFrame(() => {\r\n                // Check if the new focused element is a child of the original container\r\n                if (!currentTarget.contains(document.activeElement)) {\r\n                  setSearchPrompt(null);\r\n                  d3.select(\".results\").style(\"display\", \"none\");\r\n                }\r\n              });\r\n            }}\r\n          >\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"search\"\r\n              value={searchPrompt || \"\"}\r\n              onChange={(e) => setSearchPrompt(e.target.value)}\r\n              onFocus={() => {\r\n                setSearchPrompt(\"\");\r\n                d3.select(\".results\").style(\"display\", \"flex\");\r\n              }}\r\n            ></input>\r\n            <div className=\"results\" style={{ display: \"none\" }}>\r\n              {searchResults.map(({ obj: wd }) => (\r\n                <button\r\n                  key={wd.key}\r\n                  onClick={() => {\r\n                    updateActiveDrops(wd);\r\n\r\n                    setSearchPrompt(null);\r\n                    d3.select(\".results\").style(\"display\", \"none\");\r\n                  }}\r\n                >\r\n                  {wd.display_name}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"action-btn-wrapper\">\r\n        <ActionButtons\r\n          appCtx={appCtx}\r\n          handleClickExamine={handleClickExamine}\r\n          handleClickFilter={handleClickFilter}\r\n          handleClickDeselectAll={handleClickDeselectAll}\r\n          handleClickCompare={handleClickCompare}\r\n        />\r\n      </div>\r\n      {filterIsVisible && (\r\n        <div id=\"filterbox\">\r\n          I'm only interested in scenarios where{\" \"}\r\n          <select\r\n            name=\"ego-obj\"\r\n            id=\"ego-obj\"\r\n            value={menuEgoObjective}\r\n            onChange={(e) => void setMenuEgoObjective(e.target.value)}\r\n          >\r\n            {appCtx.waterdrops.groups.map((obj) => (\r\n              <option\r\n                key={descriptionsData[obj.key].id}\r\n                value={descriptionsData[obj.key].id}\r\n              >\r\n                {descriptionsData[obj.key].display_name ||\r\n                  descriptionsData[obj.key].id}\r\n              </option>\r\n            ))}\r\n          </select>{\" \"}\r\n          gets at least{\" \"}\r\n          <span className=\"menu-min-deliv\">\r\n            {menuMinDelivery}\r\n            <input\r\n              type=\"range\"\r\n              name=\"min-deliv\"\r\n              id=\"min-deliv\"\r\n              value={menuMinDelivery}\r\n              onChange={(e) => void setMenuMinDelivery(e.target.value)}\r\n              min={objectivesData.RANGE_OF_MINS[menuEgoObjective][0]}\r\n              max={objectivesData.RANGE_OF_MINS[menuEgoObjective][1]}\r\n            />\r\n          </span>{\" \"}\r\n          TAF in deliveries.\r\n          <button onClick={handleClickDone} className=\"fancy-font\">\r\n            <BiCheck />\r\n            <span>Done</span>\r\n          </button>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":["App","appState","useAppState","_jsxs","AppContext","Provider","value","children","className","_jsx","id","TutorialView","WideView","ExamineView","CompareView","goBack","onClick","createContext","DEGREE_SWAY","LINE_WIDTH","maskCounter","bucketGlyph","width","height","valueToLevelFn","arguments","length","undefined","d3","data","map","d","x","y","transitionSway","rects","multiplier","each","s","this","prevLevel","attr","transition","duration","delay","_","i","ease","attrTween","prevLiquidLevel","parseFloat","diff","Math","abs","t","concat","sin","min","PI","period","size","bucketShape","shapeFunc","drawBucketMask","shapeOutlineFunc","append","call","_ref","drawFunc","drawOutlineFunc","getPath","fn","path","toString","select","bucketShapeMask","context","drawBucket","closed","bottomRight","bottomLeft","moveTo","lineTo","closePath","distributeQuantiles","numericBins","unitsPerQuantile","maxQuantiles","quantileBins","bin","round","sum","Infinity","interpolateWatercolorBlue","levelToDropletLevel","p","max","ticksExact","start","stop","count","collideOffsetter","curXOffset","isTooClose","ActionButtons","filterBtn","examineBtn","compareBtn","appCtx","handleClickFilter","handleClickExamine","handleClickDeselectAll","handleClickCompare","isState","state","BiFilter","activeWaterdrops","BiCross","_Fragment","BiNetworkChart","LEVELS","drawBottle","bottleWidth","capWidth","capHeight","cornerRad","capCornerRad","arc","BottleGlyph","levelInterp","maxValue","colorInterp","resolution","GLYPH_MARGIN","top","right","bottom","left","svgElement","useRef","useLayoutEffect","svgContainer","current","bottleHeight","drawBottleCap","maxHeight","liquidLevels","glyph","domain","range","ticks","tickSize","tickFormat","liquids","selectAll","join","ref","e","BucketCreationGraphics","bucketInterper","label","TaggedBottleGlyph","constants","MAX_DELIVS","BAR_CHART_HEIGHT","CallToExploreSection","CardBBox","forwardRef","CompareBucketCreationsBackground","storyVars","CompareBucketCreationsText","CompareBucketCreationsGraphics","appHeight","descriptionsData","PAG_OBJECTIVE","display_name","bucketInterperPAG","PRF_OBJECTIVE","bucketInterperPRF","CompareScenariosGraphics","MainWaterdropGraphics","objectiveLabel","dropInterper","histData","PAG_DELIVS","histRange","objectivesData","goal","userGoal","setGoal","newGoal","setUserGoal","VariationWaterdropGraphics","variations","DROP_VARIATIONS","variation","interper","variationInterpers","idx","VARIATIONS_DELIVS","ConnectLine","connectLine","style","getConnectStyle","DataStoryScrollama","onSlideEnter","onSlideExit","Scrollama","offset","onStepEnter","async","_args$data$animHandle","args","direction","animHandler","do","onStepExit","_args$data$animHandle2","undo","onStepProgress","element","progress","_ref2","threshold","numQuantiles","histBins","thresholds","ceil","binnedQuantiles","quantiles","b","push","x1","x0","NUM_CIRCLES","MARGIN","WATERDROP_ICON","draw","SQRT2","DotHistogram","shortForm","razorElement","razorAreaElement","svgSelector","circles","useMemo","dataRange","filter","scale","text","transform","clamp","ignoreFn","preventDefault","dragging","addEventListener","window","document","removeEventListener","target","razorPos","offsetX","enter","MapCalifornia","useEffect","innerHeight","drawnRegions","minimap","proj","center","spatialData","CALIFORNIA_CENTER","translate","lineGeom","SPATIAL_DATA","features","f","includes","properties","CalLiteID","CALIFORNIA_OUTLINE","projection","geometry","coordinates","PAG_COLOR","raise","PRF_COLOR","SceneSettingStickers","settings","setColorSetting","v","onMouseEnter","onMouseLeave","title","SETT_DESC","SETT_NAME_FULL","SETT_VAL_STEPS","j","opacity","SceneSettingSubcard","SETT_NAME_SHORT","SkipBtn","startPos","documentElement","scrollTop","curPos","opac","PERCENTILE_LABELS","reverseData","reverse","xOffset","labels","TutHero","setState","scen","clas","desc","initDescriptionsData","console","log","objs","fetch","json","mapBy","SCEN_DIVISOR","initObjectivesData","SCENARIO_KEY_STRING","DELIV_KEY_STRING","BASELINE_SCEN","OBJECTIVES_DATA","chosenScenarios","name","obj","shuffledScens","shuffle","sort","splice","_ref3","OBJECTIVE_IDS","Object","keys","OBJECTIVE_GOALS_MAP","goalMap","SCENARIO_IDS","values","KEY_SETTINGS_MAP","optArr","SETT_NUM_OPTS","key","deserialize","slice","MIN_MAXES","minmaxes","objective","baselineMax","scenario","RANGE_OF_MINS","FLATTENED_DATA","DATA_GROUPINGS","flattenedData","dataGroupings","means","deliveries","minmax","orderedDataGroupings","criteria","objScens","ids","sortedObjScens","a","sorted","mean","maxVal","delivery","flat","keyToRank","rank","BASELINE_YRLY_KEY_STRING","Array","from","initSpatialData","SPATIAL_FEATURES","appWidth","innerWidth","useState","setActiveWaterdrops","waterdrops","setWaterdrops","setGoBack","goals","setGoals","zoomCallbacksRef","disableCamAdjustmentsRef","initWaterdrops","threeResources","renderer","setSize","time","dropsMesh","createMesh","timeEnd","querySelector","appendChild","domElement","outlineOpacity","groups","camera","create","webglElement","node","zoomFn","updateOutlineVisibility","k","cb","setAnimationLoop","render","scene","showModal","body","updateWaterdrops","useCallback","updateMeshes","realignCamera","setZoomFn","getOutlineOpacity","val","resetCamera","animated","callback","farHeight","pos","getZFromFarHeight","transitionDuration","dur","zoomTo","callZoomFromWorldViewport","worldX","worldY","worldPos","interpolateZoomCamera","elapsed","et","callZoom","addZoomHandler","setDisableCamAdjustments","disable","useCompareLargeDrops","activeMinidrop","setActiveMinidrop","groupsRef","camCentersRef","positions","lines","compareViewHelpers","calcLinesAndPositions","textX","textY","smallTextSize","SPREAD_1_2","largeTextSize","updateLabel","avgCoords","circlet","LOD_1_RAD_PX","updateScenIndicators","initComparer","getWaterdropGroups","camMidpoint","groupPositions","camFirstDrop","firstDrop","midpoint","container","updateDropsSVG","onHover","indicatorGroup","DEFAULT_SCENARIO","hideElems","showOtherDrop","showElems","hideOtherDrop","useDataStory","slides","setSlides","index","setIndex","useDataStoryVars","largeDropComparer","hookAnimations","deps","chartAnimGroup","anims","initShowLocationAnimGroup","initChartAnimGroup","bucketsFillAnim","initBucketsFillAnim","moveBucketsAnim","initMoveBucketsAnim","dropFillAnim","initDropFillAnim","changeRealityAnim","initChangeRealityAnim","fillVarDropsAnim","initFillVarDropsAnim","showScenLabelAnim","initShowScenLabelAnim","highlightBestAnim","initHighlightBestAnim","showQuantilesAnim","initShowQuantilesAnim","comparerAnimGroup","initComparerAnimGroup","_slides","barsAppear","barsCondense","showPAG","showPRF","getSlidesInRange","to","idxFrom","idxTo","attachScripts","slide","script","scripts","setBucketInterperPAG","setBucketInterperPRF","setDropInterper","setVariationInterpers","VARIATIONS","useDragPanels","viewTransform","panels","setPanels","panelsRef","useStateRef","mouseDownInfo","startX","deltaX","deltaY","startY","find","oldOffsetX","offsetY","oldOffsetY","onPanelDragStart","clientX","clientY","getPanelStyle","screenX","screenY","worldToScreen","LOD_1_LEVELS","LOD_1_MIN_LEV_VAL","LOD_1_SMALL_DROP_PAD_FACTOR","LOD_1_LARGE_DROP_PAD_FACTOR","LOD_2_SMALL_DROP_PAD_FACTOR","GROUP_HOVER_AREA_FACTOR","SQRT1_2","WaterdropMesh","constructor","added","initializeMeshes","add","outlineMesh","remove","dropsGeometry","MeshGeometry","MAX_POINTS_DROPS","outlinePoints","outlineMeshCoords","bottleOutline","nodes","globalX","globalY","levs","maxLev","globalTilt","tilt","l1","l2","meshCoords","bottlePartial","color","THREE","addMeshCoords","rotate","rotOutline","rotatePoints","copyCoords","dx","dy","finish","threeGeom","vertexColors","transparent","outlineGeometry","setFromPoints","dropsGeom","outlineGeom","material","needsUpdate","updateVisibility","clearMesh","setDrawRange","attributes","position","MAX_POINTS_OUTLINE","_THREEHandleZoom","_classPrivateFieldLooseKey","Camera","fov","near","far","defineProperty","_THREEHandleZoom2","raycaster","_ref4","set","webglView","svgView","zoom","getScaleFromZ","on","curTransform","_classPrivateFieldLooseBase","scaleExtent","_ref5","_ref6","endx","endy","endz","getFarHeightFromZ","tan","toRadians","z","getZFromScale","scaleHeight","intersectObject","mouseX","mouseY","mesh","setFromCamera","screenToWorld","numPoints","triangleIdx","setAttribute","Float32Array","positionAttribute","getAttribute","colorAttribute","v1","v2","v3","setXYZ","r","g","background","antialias","initThreeResources","largeDropInit","idStr","gradientInit","BOTTLE_SHAPE_FULL","BOTTLE_SHAPE_BODY","smallDropInit","largeDropUpdate","transitionDelay","isLeft","isBottom","baselinePos","generateTSpan","textUpdate","_ref7","gradientUpdate","dropBBox","getBBox","smallDropUpdate","dropCenterCorrection","rad","circlePosX","circlePosY","textPosX","textPosY","fontSize","lineWidth","helpers","waterdropGroups","_ref8","onUnhover","_ref9","drops","parentNode","getEndGroupLoc","updateColorDrops","opacFn","_ref10","getGroupLoc","_ref11","_ref12","_ref13","keyArr","spacing","n","angle","cos","groupsObj","activeMinidropKey","group","groupPos","clipEnds","updateLabelSVG","labelText","normedTextSize","updateScenIndicatorsSVG","animations","_pagX","_prfX","_pagXAxis","_prfXAxis","_pagDataDescending","_prfDataDescending","BAR_CHART_MARGIN","svgGroup","BAR_CHART_WIDTH","dataDescending","placeFromLeft","year","padding","xaxis","tickValues","prepareSVG","bandwidth","newWidth","bars","end","catch","then","PAG_INTERPER","PRF_INTERPER","PAG_INTERPER_DROP","classed","VARIATIONS_INTERPERS","createInterpsFromDelivs","delivs","minDelivs","maxDelivs","calcDomLev","demand","carryover","priority","regs","minflow","String","raw","_templateObject","_taggedTemplateLiteral","_templateObject2","_templateObject3","_templateObject4","_templateObject5","scenStr","scenNum","parseInt","updateSmallDropSVG","waterdropGroup","generateWaterdrop","delta","outer","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","placeDropsUsingPhysics","packingFactor","reuse","shape","bounds","Matter","minX","maxX","minY","maxY","genX","genY","points","random","contains","generateRandoPoints","WIDTH_AREA","AREA","floor","sqrt","radsToDropWidth","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","nx","ny","circle","restitution","parts","quad","centre","vertices","isStatic","cage","setParts","setCentre","world","FPS","SECS","update","retVal","CIRC_RAD","DROP_HEIGHT","dist","y1","x2","y2","distSq","getCenterDomRect","domRect","shortenByStart","shortenByEnd","len","normed","dropRadToDropHeight","c","rotatePoint","deg","vec","applyEuler","arr","newPoint","array","currentIndex","randomIndex","newObjs","groupBy","_setState","stateRef","curVal","stateInfo","stateName","wrap","replace","RegExp","arrRemove","item","findIndex","indexOf","yStart","yEnd","elemStr","displayVal","removeElems","gradId","stops","forEach","valOffset","camTransform","lineHeight","split","line","rot","radToDeg","atan2","barsExplain","bucketsFill","href","comparingTheTwo","forNowLetsFocus","ifChangeReality","fortunateCanExplore","theseVarsCalled","atAGlance","tryMoveRed","soWhyNot","letsBringRefuge","initConstants","INTERP_COLOR","PRF_DELIVS","vars","varDelivs","groupKeys","memberKeys","egoObjective","minDelivery","amtPerGroup","largeDropRad","appSettings","smallDropRad","largeNodesPhys","largeNodesPos","smallNodesPhys","smallNodesPos","nodeKeyToIdx","groupNodes","groupToNodes","groupKeyToIdx","rankCache","nodeData","delivMin","delivMax","w","groupID","memberID","arrRanks","mkey","rankMap","groupRank","memberRank","localTilt","parentTilt","rotatedX","rotatedY","domLev","groupKey","_descriptionsData$gro","interactorsInit","textGroup","interactorsUpdate","dropTransform","getFontSize","transformZoom","cameraHeight","waterdropsHeight","MAX_RAD","zoomRel","_d","drawMinimapSVG","type","pointGeom","updateLargeDropSVG","fontSizer","transformInfo","tNode","posx","posy","getBoundingClientRect","dis","fadeOutDrops","startOpac","useContext","colorSetting","setCamTransform","centerRef","viewCenter","setTimeout","ox","oy","newX","newY","correctionX","getIdealGroupPos","nodeID","makePanelsFromNodes","onMouseDown","activeMinidropsRef","curMinidropsRef","panelCountRef","hoveredCard","setHoveredCard","removePreviewRef","showAdditionalInfo","instrFontSize","labelFontSize","addDetailPanel","dropId","preview","forceReplace","groupX","groupY","groupHeight","pid","_p","offsetCount","newPanel","circleX","circleY","panelKey","removeDetailPanel","updateActiveMinidrops","hoverDrop","clearTimeout","unhoverDrop","hc","cx","cy","panelNode","panelBox","px","py","diffX","diffY","drawLineConnect","tutorialWaterdrops","hasEnteredCTE","setHasEnteredCTE","getElementById","scrollIntoView","behavior","elem","BiSkipPrevious","Step","curScreenTransform","setCurScreenTransform","firstStateEnterRef","currentHoveredDrop","setCurrentHoveredDrop","searchPrompt","setSearchPrompt","filterIsVisible","setFilterIsVisible","setEgoObjective","setMinDelivery","menuEgoObjective","setMenuEgoObjective","menuMinDelivery","setMenuMinDelivery","enableZoomRef","initSVGGraphics","cleanup","cameraListener","ti","mouseListener","registerEventListeners","cst","updateActiveDrops","wd","drawSVGGraphics","handleClickDone","newCamPos","startZoom","startOpacity","dropsMidpoint","wkey","aw","_descriptionsData$d$k","description","searchResults","fuzzysort","limit","all","tabIndex","onBlur","currentTarget","requestAnimationFrame","activeElement","placeholder","onChange","onFocus","display","BiCheck"],"sourceRoot":""}