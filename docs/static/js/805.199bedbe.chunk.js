"use strict";(self.webpackChunkcoeqwal_website=self.webpackChunkcoeqwal_website||[]).push([[805],{805:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.r(e),s.d(e,{default:()=>w});var n=s(366),r=s(43),o=s(96),i=s(956),c=s(251),l=s(313),h=s(621),d=s(293),u=s(68),p=s(579),m=t([c,l]);[c,l]=m.then?(await m)():m;const g=(0,c.c)("objective"),v=window.innerWidth,y=window.innerHeight;function w(){const[t,e,s]=(0,i.iJ)({}),[a,c,m]=(0,i.iJ)([]),[f,w]=(0,r.useState)([]),[x,b]=(0,r.useState)(null),[k,M,L]=(0,i.iJ)(!1),j=(0,r.useCallback)(n.m4Y().domain([y/g.height,y/g.groups[0].height]).range([.1,1]).clamp(!0),[]);(0,r.useEffect)((function(){document.querySelector("#mosaic-webgl").appendChild(u.Uk.domElement),n.Ltv("#mosaic-svg").attr("width",v).attr("height",y).append("g").attr("class","svg-trans"),u.UI.mount(n.Ltv(".bubbles-wrapper").node(),n.Ltv("#mosaic-svg").select(".svg-trans").node()),u.UI.setZoomFn((t=>{L.current||u.Q7.updateOutlineVisibility(j(t.k));for(const e of m.current)e(t)})),u.UI.setSize(v,y),u.Uk.setAnimationLoop((()=>{u.Uk.render(u.JH,u.UI.camera)})),A(!1),e({state:"WideView"})}),[]);const A=(0,r.useCallback)((function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;const s=[0,.08*-g.height,u.UI.getZFromFarHeight(g.height)];if(t){const{start:t}=C(s,e);t()}else u.UI.callZoomFromWorldViewport({worldX:s[0],worldY:-s[1],farHeight:g.height}),e&&e()}),[]),C=(0,r.useCallback)(((t,e)=>{const s=u.UI.interpolateZoomCamera(t),a=s.duration/2;return{start:()=>{const t=n.O1W((n=>{const r=Math.min(n/a,1);u.UI.callZoom(s(r)),1===r&&(t.stop(),e&&e())}))},duration:a}}),[]),S=(0,r.useCallback)((t=>{c((e=>[...e,t]))}),[]);return(0,p.jsxs)(o.B.Provider,{value:{appWidth:v,appHeight:y,state:t,setState:e,activeWaterdrops:f,setActiveWaterdrops:w,setDisableCamAdjustments:M,waterdrops:g,scene:u.JH,camera:u.UI,renderer:u.Uk,pointsMesh:u.XA,dropsMesh:u.Q7,setGoBack:b,zoomTo:C,resetCamera:A,getOutlineOpac:j,addZoomHandler:S},children:[(0,p.jsxs)("div",{className:"bubbles-wrapper",children:[(0,p.jsx)("div",{id:"mosaic-webgl"}),(0,p.jsx)("svg",{id:"mosaic-svg"})]}),(0,p.jsx)(l.A,{}),(0,p.jsx)(h.A,{}),(0,p.jsx)(d.A,{}),x&&(0,p.jsx)("button",{className:"go-back-btn",onClick:x,children:"\u2190"})]})}u.Uk.setSize(v,y),console.time("drops mesh creating"),u.Q7.createMesh(g),console.timeEnd("drops mesh creating"),a()}catch(f){a(f)}}))},96:(t,e,s)=>{s.d(e,{B:()=>a});const a=(0,s(43).createContext)({})},684:(t,e,s)=>{s.d(e,{YW:()=>r,kd:()=>n});var a=s(366);s(43);function n(t,e,s){return a.y17(s).map((a=>a/(s-1)*(e-t)+t))}const r=t=>a.dM(a.m4Y([.2,1])(t))},693:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.d(e,{R:()=>t});var n=s(956);const t=await async function(){const t=await(await fetch("./descriptions.json")).json();return console.log("DATA: loading descriptions data"),(0,n.Et)(t,(t=>{let{id:e}=t;return e}))}();a()}catch(r){a(r)}}),1)},58:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.d(e,{ZS:()=>d,pk:()=>i,uV:()=>u,vR:()=>p,wP:()=>m});var n=s(366),r=s(550),o=s(956);const t=1,i=1200,c="scens",l="delivs",h=await async function(){const t=await(await fetch("./objectives.json")).json();for(const e of t){e[c]=e[c];for(const t of e[c]){const e=t[l].map((t=>(0,r.qE)(t,0,i)));t[l]=Array.from(e).sort(((t,e)=>e-t))}e[c]=(0,o.Et)(e[c],(t=>{let{name:e}=t;return e}))}return console.log("DATA: loading objectives data"),(0,o.Et)(t,(t=>{let{obj:e}=t;return e}))}(),d=Object.keys(h),u=Object.keys(Object.values(h)[0][c]).filter(((e,s)=>s%t===0)),[p,m]=function(){const t=[],e={objective:{},scenario:{}},s=[];let a=0;for(const o of d)for(const r of u){e.objective[o]||(e.objective[o]=[]),e.scenario[r]||(e.scenario[r]=[]),e.objective[o].push(a),e.scenario[r].push(a);const i=h[o][c][r][l];t.push({id:a,objective:o,scenario:r,deliveries:i}),s.push(n.i2o(i)),a++}const r={};for(const o of Object.keys(e)){const a=[];for(const r of Object.keys(e[o])){const i=e[o][r],c=i.sort(((t,e)=>s[e]-s[t]));a.push({key:r,sorted:c,mean:n.i2o(i.map((e=>t[e].deliveries)).flat())})}const i=a.sort(((t,e)=>e.mean-t.mean));r[o]={};for(let t=0;t<i.length;t++){const{key:e,sorted:s}=i[t],a={};for(let t=0;t<s.length;t++)a[s[t]]=t;r[o][e]=a,r[o][e].rank=t}}return[t,r]}();a()}catch(i){a(i)}}),1)},82:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.d(e,{KW:()=>t,X8:()=>r,wU:()=>o});var n=s(956);const t=await async function(){const t=await(await fetch("./callite_spatial.json")).json();return console.log("DATA: loading callite spatial data"),t}(),r=(0,n.Et)(t.features,(t=>{let{properties:e}=t;return e.CalLiteID})),o=await async function(){const t=await(await fetch("./california.json")).json();return console.log("DATA: loading california spatial data"),t}();a()}catch(r){a(r)}}),1)},385:(t,e,s)=>{s.d(e,{Kn:()=>a,N3:()=>r,N7:()=>l,NU:()=>n,pC:()=>c,w5:()=>o,w9:()=>i});const a=5,n=1,r=.1,o=1.3,i=1.2,c=3,l=1.1/(1+Math.SQRT1_2)},68:(t,e,s)=>{s.d(e,{JH:()=>r,Q7:()=>o,UI:()=>c,Uk:()=>l,XA:()=>i});var a=s(408),n=(s(366),s(972));const r=function(){const t=new a.Z58;return t.background=new a.Q1f(15724527),t}(),o=new n.e8,i=new n._9,c=new n.i7({fov:45,near:1,far:3e3}),l=new a.JeP({antialias:!0})},251:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.d(e,{c:()=>u});var n=s(684),r=s(385),o=s(58),i=s(152),c=s(550),l=s(956),h=t([o,i]);function u(t){const e="objective"===t?o.ZS:o.uV,s="objective"===t?o.uV:o.ZS,a=(e.length,s.length),h=Math.sqrt(a/Math.PI)*r.NU*2*r.w5*r.w9,d=r.NU*r.w5,u=(0,c.hh)(0,0,e.map(((t,e)=>({r:h,id:e})))),p=(0,l.Et)(u,(t=>{let{id:e}=t;return e})),m=(0,c.hh)(0,0,s.map(((t,e)=>({r:d,id:e})))),f=(0,l.Et)(m,(t=>{let{id:e}=t;return e})),g=[],v=[],y={};for(const c of o.vR){const{id:e,objective:s,scenario:a,deliveries:l}=c,h=(0,i.Dy)(l,o.pk),d=(0,n.kd)(0,1,r.Kn+1).map((t=>h(t))).map(((t,e)=>Math.max(t,0==e?r.N3:0)*r.NU)),u="objective"===t?s:a,m="objective"===t?a:s,v=o.wP[t][u].rank,w=o.wP[t][u][e],x={id:e,levs:d,maxLev:r.NU,domLev:(0,i.Dq)(d),tilt:50*Math.random()-25,dur:100*Math.random()+400,x:f[w].x,y:f[w].y,group:u,key:m,globalX:p[v].x+f[w].x,globalY:p[v].y+f[w].y};g.push(x),y[u]||(y[u]=[]),y[u].push(x)}for(const n of e)v.push({x:p[o.wP[t][n].rank].x,y:p[o.wP[t][n].rank].y,tilt:50*Math.random()-25,key:n,height:m.height,nodes:y[n]});return{nodes:g,groups:v,height:u.height}}[o,i]=h.then?(await h)():h,a()}catch(d){a(d)}}))},152:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.d(e,{Dq:()=>h,Dy:()=>l});var n=s(366),r=s(684),o=s(58),i=t([o]);function l(t,e){return n.m4Y().domain((0,r.kd)(0,1,t.length)).range(t.map((t=>Math.min(1,t/e)))).clamp(!0)}function h(t){t=[1,...t,0];let e=0;for(let s=0;s<t.length-1;s++){e+=(t[s]-t[s+1])*(s-1)/(t.length+4)}return e}o=(i.then?(await i)():i)[0],a()}catch(c){a(c)}}))},550:(t,e,s)=>{s.d(e,{eh:()=>f,hh:()=>m,kt:()=>v,qE:()=>i,xg:()=>g});var a=s(366),n=s(783),r=s.n(n),o=s(972);function i(t,e,s){return Math.max(e,Math.min(s,t))}function c(t){const e=t/2,s=3*Math.PI/2/16,a=[{x:Math.cos(5*Math.PI/4)*e,y:Math.sin(5*Math.PI/4)*e},{x:0,y:-Math.SQRT2*e}];for(let n=0;n<=16;n++)a.push({x:Math.cos(n*s-Math.PI/4)*e,y:Math.sin(n*s-Math.PI/4)*e});return a}const l=function(){const t=c(3),e=c(1),s=[];for(let a=0;a<t.length-2;a++)s.push([t[a],t[a+(a<2?1:2)],e[a+(a<2?1:2)],e[a]]);return s}();let h,d,u,p;function m(t,e,s){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n&&u&&s.length===p)return u;h&&s.length===d||(h=a.y17(4).map((()=>function(t,e){const s=r().Bounds.create(t),n=s.min.x,o=s.max.x,i=s.min.y,c=s.max.y,l=a.m4Y([n,o]),h=a.m4Y([i,c]),d=[];for(let a=0;a<e;a++)for(;;){const e=l(Math.random()),s=h(Math.random());if(r().Vertices.contains(t,{x:e,y:s})){d.push([e,s]);break}}return d}(c(1),d=s.length))));const i=function(t){const e=a.czq(t.map((t=>t**2*3.14)));return Math.floor(2*Math.sqrt(e/3.14)/2)}(s.map((t=>{let{r:e}=t;return e}))),m=h[Math.floor(Math.random()*h.length)].map((t=>{let[e,s]=t;return[e*i,s*i]})),f=r().Engine,g=r().Bodies,v=r().Composite,y=f.create(),w=m.sort(((t,e)=>e[1]-t[1])),x=s.map(((t,e)=>{let{r:s,id:a}=t;const[n,r]=w[e];return g.circle(n,r,s,{restitution:0,id:a})})),b=l.map((t=>r().Body.create({position:r().Vertices.centre(t),vertices:t,isStatic:!0}))),k=r().Body.create({isStatic:!0});r().Body.setParts(k,b),r().Body.setCentre(k,{x:0,y:0}),r().Body.scale(k,i,i),v.add(y.world,[...x,k]);for(let a=0,r=60,o=.1;a<r*o;a++)f.update(y,1e3/r);const M=x.map((s=>{let{position:a,id:n}=s;return{id:n,x:a.x+t,y:a.y+e}}));return M.height=i/2/o.Sz*o.IC,!n||u&&M.length===p||(u=M,p=M.length),M}function f(t){return t*Math.PI/180}function g(t,e){let[s,a]=t,[n,r]=e;return Math.sqrt(function(t,e){let[s,a]=t,[n,r]=e;return(n-s)**2+(r-a)**2}([s,a],[n,r]))}function v(t){return[t.left+t.width/2,t.top+t.height/2]}},956:(t,e,s)=>{s.d(e,{Et:()=>n,LV:()=>c,Ul:()=>r,ad:()=>i,iJ:()=>o});var a=s(43);function n(t,e){const s=Object.groupBy(t,e);for(const a of Object.keys(s))s[a]=s[a][0];return s}function r(t,e){return e=function(t){return"string"===typeof t?e=>function(t,e,s){var a;const n=e.split(".");for(let r of n){if(!t)return s;t=t[r]}return null!==(a=t)&&void 0!==a?a:s}(e,t):t}(e),t.sort(((t,s)=>{const a=e(t),n=e(s);return a<n?-1:a>n?1:0}))}function o(t){const[e,s]=(0,a.useState)(t),n=(0,a.useRef)(t);(0,a.useEffect)((()=>{n.current=e}),[e]);const r=(0,a.useCallback)((t=>{s("function"===typeof t?e=>n.current=t(e):n.current=t)}),[]);return[e,r,n]}function i(t,e){return t&&t.state===e}function c(t){return t.replace(/(?![^\n]{1,15}$)([^\n]{1,15})\s/g,"$1\n")}},972:(t,e,s)=>{s.d(e,{IC:()=>p,Sz:()=>h,_9:()=>b,e8:()=>x,i7:()=>k,js:()=>l});var a=s(366),n=s(408),r=s(684),o=s(385),i=s(956),c=s(550);const l="M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z",h=Math.SQRT1_2,d=1,u=h+h,p=d+h,m=.75;function f(t){if(t>=m){return Math.SQRT1_2*(1-t)/(1-m)}const e=2*(1-t/(u/p))-1,s=Math.acos(e);return Math.sin(s)}function g(t){return(t-h/p)*(1+Math.SQRT2)}function v(t){return t/(1+Math.SQRT2)+h/p}function y(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(Math.abs(t-e)<.01)return[];const a=s/2/d*h,n=.1,r=[];let o,i,c,l;for(let h=1;h<=Math.ceil(10)&&(o=f(t+(h-1)*n),i=g(t+(h-1)*n),c=f(t+h*n),l=g(t+h*n),!(v(l)>=e));h++){const t=[-o*a,-i*a],e=[o*a,-i*a],s=[c*a,-l*a],n=[-c*a,-l*a];r.push([t,e,s]),r.push([t,s,n])}c=f(e),l=g(e);const u=[-o*a,-i*a],p=[o*a,-i*a],m=[c*a,-l*a],y=[-c*a,-l*a];return r.push([u,p,m]),r.push([u,m,y]),r}class w{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.threeGeom=new n.LoY,this.triangleIdx=0,this.threeGeom.setAttribute("position",new n.THS(new Float32Array(3*t),3)),e&&this.threeGeom.setAttribute("color",new n.THS(new Float32Array(3*t),3)),this.positionAttribute=this.threeGeom.getAttribute("position"),this.colorAttribute=this.threeGeom.getAttribute("color")}addMeshCoords(t,e,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(let n=0;n<t.length;n++){const[r,o,i]=t[n];this.positionAttribute.setXYZ(3*this.triangleIdx+0,e.x+r[0],e.y-r[1],a),this.positionAttribute.setXYZ(3*this.triangleIdx+1,e.x+o[0],e.y-o[1],a),this.positionAttribute.setXYZ(3*this.triangleIdx+2,e.x+i[0],e.y-i[1],a),s&&(this.colorAttribute.setXYZ(3*this.triangleIdx+0,s.r,s.g,s.b),this.colorAttribute.setXYZ(3*this.triangleIdx+1,s.r,s.g,s.b),this.colorAttribute.setXYZ(3*this.triangleIdx+2,s.r,s.g,s.b)),this.triangleIdx++}}finish(){this.threeGeom.setDrawRange(0,3*this.triangleIdx)}}class x{constructor(){this.added=!1}createMesh(t){this.dropsMesh?this.updateMeshes(t):this.initializeMeshes(t)}draw(t){this.added||(t.add(this.dropsMesh),t.add(this.outlineMesh),this.added=!0)}remove(t){this.added&&(t.remove(this.dropsMesh),t.remove(this.outlineMesh),this.added=!1)}initializeMeshes(t){const e=new w(x.MAX_POINTS_DROPS),s=[],a=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(Math.abs(t-e)<.01)return[];const a=s/2/d*h,n=.1,r=[],o=[];let i,c,l,u;for(let h=1;h<=Math.ceil(10)&&(i=f(t+(h-1)*n),c=g(t+(h-1)*n),l=f(t+h*n),u=g(t+h*n),!(v(u)>=e));h++){const t=[-i*a,-c*a],e=[i*a,-c*a],s=[l*a,-u*a],n=[-l*a,-u*a];r.push(e,s),o.push(t,n)}l=f(e),u=g(e);const p=[-i*a,-c*a],m=[i*a,-c*a],y=[l*a,-u*a],w=[-l*a,-u*a];return r.push(m,y),o.push(p,w),r.push(...o.reverse()),r}(0,1,2*o.NU*.975);for(let i=0;i<t.nodes.length;i++){const{id:c,globalX:l,globalY:h,levs:d,maxLev:u}=t.nodes[i];for(let t=d.length-1;t>=0;t--){const s=y((t!==d.length-1?d[t+1]:0)/u,d[t]/u,2*o.NU),a=new n.Q1f((0,r.YW)(t/o.Kn));e.addMeshCoords(s,{x:l,y:-h},a,i%5/50+.02)}s.push(...a.map((t=>{let[e,s]=t;return new n.Pq0(l+e,-h-s,i%5/50+.01)})))}e.finish(),this.dropsMesh=new n.eaF(e.threeGeom,new n.V9B({vertexColors:!0,transparent:!0,opacity:1})),this.outlineMesh=new n.DXC((new n.LoY).setFromPoints(s),new n.mrM({color:13421772,transparent:!0,opacity:0}))}updateOutlineVisibility(t){this.outlineMesh&&(this.outlineMesh.material.opacity=t,this.outlineMesh.material.needsUpdate=!0)}updateVisibility(t){this.outlineMesh&&this.dropsMesh&&(this.outlineMesh.material.opacity=t,this.outlineMesh.material.needsUpdate=!0,this.dropsMesh.material.opacity=t,this.dropsMesh.material.needsUpdate=!0)}updateMeshes(t){}}x.MAX_POINTS_DROPS=78e5,x.MAX_POINTS_OUTLINE=52e5;class b{constructor(){this.added=!1,this.vertToId={},this.idToVert={}}draw(t){this.added||(t.add(this.mesh),this.added=!0)}remove(t){this.added&&(t.remove(this.mesh),this.added=!1)}createMesh(t){return this.mesh||this.initializeMesh(t),this.updateMesh(t),this.mesh}initializeMesh(t){const e=new n.LoY,s=[],a=[];for(let o=0;o<t.nodes.length;o++){const{id:e,globalX:i,globalY:c,levs:l,domLev:h}=t.nodes[o],d=h>0?(0,r.YW)(h):"white";s.push(i,-c,0);const u=new n.Q1f(d);a.push(u.r,u.g,u.b),this.vertToId[o]=e,this.idToVert[e]=o}const i=new n.BH$({size:2*o.NU,sizeAttenuation:!0,vertexColors:!0,map:(new n.Tap).load("drop.png"),transparent:!0});e.setAttribute("position",new n.THS(new Float32Array(s),3)),e.setAttribute("color",new n.THS(new Float32Array(a),3)),this.mesh=new n.ONl(e,i)}updateMesh(t){const e=this.mesh.geometry.getAttribute("position");for(let s=0;s<t.nodes.length;s++){const{id:a,globalX:n,globalY:r}=t.nodes[s],o=this.idToVert[a];e.setXY(o,n,-r)}e.needsUpdate=!0}updatePoints(t,e,s){const a=this.mesh.geometry.vertices;for(let n=0;n<t.nodes.length;n++){const{id:r}=t.nodes[n],o=this.idToVert[r],[i,c]=e[r],l=a[o].x,h=a[o].y;a[o].setX(l+s*i),a[o].setY(h-s*c)}this.mesh.geometry.verticesNeedUpdate=!0}intersectObject(t,e,s){const a=t.intersectObject(e,s,this.mesh);if(a[0]){const t=(0,i.Ul)(a,"distanceToRay")[0];return this.vertToId[t.index]}return null}}class k{constructor(t){let{fov:e,near:s,far:a}=t;this.raycaster=new n.tBo,this.fov=e,this.near=s,this.far=a}setZoomFn(t){this.zoom=a.s_O().on("zoom",(e=>{this.curTransform=e.transform,this._THREEZoomHandler(e.transform),a.Ltv(this._svgElement).attr("transform",e.transform),t&&t(e.transform)}))}callZoom(t){this.zoom.transform(this.view,a.GSI.translate(t.x,t.y).scale(t.k))}callZoomFromWorldViewport(t){let{worldX:e,worldY:s,farHeight:a}=t;const n=this.height/a,r=-e*n+this.width/2,o=s*n+this.height/2;this.callZoom({x:r,y:o,k:n})}getZFromFarHeight(t){return Math.tan((0,c.eh)(90-this.fov/2))*t/2}getFarHeightFromZ(t){return Math.tan((0,c.eh)(this.fov)/2)*t*2}interpolateZoomCamera(t){let[e,s,n]=t;const r=a.p7([this.camera.position.x,this.camera.position.y,this.height/this.curTransform.k],[e,-s,this.getFarHeightFromZ(n)]),o=t=>{const[e,s,a]=r(t),n=this.height/a;return{x:-e*n+this.width/2,y:s*n+this.height/2,k:n}};return o.duration=r.duration,o}mount(t,e){this.view=a.Ltv(t),this._svgElement=e}setSize(t,e){this.width=t,this.height=e,this.zoom=this.zoom.scaleExtent([this.getScaleFromZ(this.far),this.getScaleFromZ(this.near)]),this.camera=new n.ubm(this.fov,t/e,this.near,this.far+1),this.camera.position.set(0,0,this.far),this.view.call(this.zoom),this.zoom.transform(this.view,a.GSI.translate(this.width/2,this.height/2).scale(this.getScaleFromZ(this.far)))}_THREEZoomHandler(t){const e=t.k,s=-(t.x-this.width/2)/e,a=(t.y-this.height/2)/e,n=this.getZFromScale(e);this.camera.position.set(s,a,n)}getScaleFromZ(t){const e=this.fov/2,s=(0,c.eh)(e),a=2*(Math.tan(s)*t);return this.height/a}getZFromScale(t){const e=this.fov/2,s=(0,c.eh)(e);return this.height/t/(2*Math.tan(s))}intersectObject(t,e,s){return this.raycaster.setFromCamera({x:t,y:e},this.camera),this.raycaster.intersectObject(s)}}},293:(t,e,s)=>{s.d(e,{A:()=>d});var a=s(96),n=s(684),r=s(366),o=s(43),i=s(385),c=s(956),l=s(972);const h=i.pC/i.w5;function d(){const{state:t,setState:e,setGoBack:s,resetCamera:d,activeWaterdrops:u,waterdrops:p}=(0,o.useContext)(a.B),[m,f]=(0,o.useState)(),g=(0,o.useRef)();(0,o.useEffect)((()=>{if(m){const t=[];for(let a=0;a<g.current.groups.length;a++){const e=g.current.groups[a],s=g.current.groupPositions[a],n=e.nodes.find((t=>t.key===m));t.push([n.x*i.pC/i.w5+s[0],n.y*i.pC/i.w5+s[1]])}const e=[],s=2*i.NU;for(let a=0;a<t.length;a++){const n=Array.from(t[a]),r=Array.from(t[a+1==t.length?0:a+1]),o=Math.sqrt((n[0]-r[0])**2+(n[1]-r[1])**2),i=[(r[0]-n[0])/o,(r[1]-n[1])/o];n[0]+=i[0]*s,n[1]+=i[1]*s,r[0]-=i[0]*s,r[1]-=i[1]*s,e.push([n,r])}r.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compCirclet").data(t).join("circle").attr("class","compCirclet").attr("display","initial").style("pointer-events","none").attr("fill","transparent").attr("stroke","orange").attr("stroke-dasharray",3).attr("stroke-width",3).attr("vector-effect","non-scaling-stroke").attr("r",s/2*1.2).transition().duration(100).attr("cx",(t=>t[0])).attr("cy",(t=>t[1]-.08*s)),r.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compLines").data(e).join("path").attr("class","compLines").attr("stroke","orange").attr("stroke-dasharray",3).attr("opacity",.5).attr("stroke-width",1).attr("vector-effect","non-scaling-stroke").transition().duration(100).attr("d",(t=>r.n8j()(t)))}}),[m]),(0,o.useEffect)((function(){if((0,c.ad)(t,"CompareView")){return function(t,e,s,a){let{onClick:o,onHover:c,onUnhover:d}=a;t.selectAll(".compLargeDrop").data(e.groups).join((t=>t.append("g").attr("class","compLargeDrop").each((function(t){let{nodes:e}=t;r.Ltv(this).selectAll(".compSmallDrop").data(e).enter().append("g").attr("class","compSmallDrop").each((function(t){let{levs:e}=t;const s=r.Ltv(this);s.append("rect").attr("class","bbox").style("visibility","hidden");const a=Math.floor(1e9*Math.random()),o=r.Ltv(this).append("defs").append("linearGradient").attr("id","".concat(a)).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");o.append("stop").attr("stop-color","transparent"),o.append("stop").attr("stop-color","transparent"),e.forEach(((t,e)=>{o.append("stop").attr("stop-color",(0,n.YW)(e/i.Kn)),o.append("stop").attr("stop-color",(0,n.YW)(e/i.Kn))})),s.append("path").attr("d",l.js).attr("class","outline").attr("fill","none").attr("stroke","lightgray").attr("stroke-width",.05),s.append("path").attr("class","fill").attr("d",l.js).attr("fill","url(#".concat(a,")"))}))})))).attr("display","initial").attr("transform",((t,e)=>{let{x:s,y:a}=t;return"translate(".concat(s,", ").concat(a,")")})).each((function(t){let{nodes:e}=t;r.Ltv(this).selectAll(".compSmallDrop").data(e).attr("display","initial").attr("transform",(t=>{let{x:e,y:s}=t;return"translate(".concat(e,", ").concat(s,")")})).on("click",(function(t,e){o&&o(e)})).on("mouseenter",(function(t,e){c&&c(e)})).on("mouseleave",(function(t,e){d&&d(e)})).each((function(t,e){let{levs:s,maxLev:a}=t;const n=r.Ltv(this);n.select(".outline").attr("transform","scale(".concat(.95*i.NU,")")),n.select(".fill").attr("transform","scale(".concat(i.NU,")")),n.selectAll("stop").each((function(t,e){let n=Math.floor(e/2);0===e%2&&(n-=1),-1===n?r.Ltv(this).attr("offset","".concat(0,"%")):n===s.length?r.Ltv(this).attr("offset","100%"):r.Ltv(this).attr("offset","".concat(100*(1-s[n]/a),"%"))}));const o=n.select(".fill");n.select(".bbox").attr("x",o.node().getBBox().x).attr("y",o.node().getBBox().y).attr("width",o.node().getBBox().width).attr("height",o.node().getBBox().height)})).transition().delay(s).duration(1e3).attr("transform",(t=>{let{x:e,y:s}=t;return"translate(".concat(e*h,", ").concat(s*h,")")}))})).transition().delay(s).duration(1e3).attr("transform",((t,s)=>"translate(".concat(e.groupPositions[s][0],", ").concat(e.groupPositions[s][1],")")))}(r.Ltv("#mosaic-svg").select(".svg-trans"),g.current=function(t,e,s){const a=e.groups.filter((e=>t.includes(e.key))),n=[],r=a[0].height*h*.75;for(let o=0,i=a.length;o<i;o++)n.push([s[0]+Math.cos(2*Math.PI/i*o)*r,s[1]+Math.sin(2*Math.PI/i*o)*r]);return{groups:a,groupPositions:n}}(u,p,t.avgCoord),t.transitionDuration/5,{onHover:t=>{f(t.key)}}),s((()=>()=>{e({state:"WideView"}),d()})),()=>{r.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compLargeDrop").remove(),r.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compCirclet").remove(),r.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".compLines").remove(),s(null)}}}),[t])}},621:(t,e,s)=>{s.d(e,{A:()=>d});var a=s(366),n=s(43),r=s(96),o=s(956),i=s(385),c=s(684),l=s(972),h=s(579);function d(){const{state:t,setState:e,setGoBack:s,resetCamera:d,activeWaterdrops:u,waterdrops:p}=(0,n.useContext)(r.B);return(0,n.useEffect)((function(){if((0,o.ad)(t,"ExamineView")){const n=t.transitionDuration;return function(t,e,s,n){let{onClick:r,onHover:o,onUnhover:h}=n;t.selectAll(".smallDrop").data(e).join((t=>t.append("g").attr("class","smallDrop").each((function(t,e){let{levs:s}=t;const n=a.Ltv(this);n.append("rect").attr("class","bbox").style("visibility","hidden");const r=a.Ltv(this).append("defs").append("linearGradient").attr("id","drop-fill-".concat(e)).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");r.append("stop").attr("stop-color","transparent"),r.append("stop").attr("stop-color","transparent"),s.forEach(((t,e)=>{r.append("stop").attr("stop-color",(0,c.YW)(e/i.Kn)),r.append("stop").attr("stop-color",(0,c.YW)(e/i.Kn))})),n.append("path").attr("d",l.js).attr("class","outline").attr("fill","none").attr("stroke","lightgray").attr("stroke-width",.05),n.append("path").attr("class","fill").attr("d",l.js).attr("fill","url(#drop-fill-".concat(e,")")),n.append("g").attr("class","circlet").append("circle").attr("fill","transparent").attr("stroke","transparent").attr("stroke-dasharray",3).attr("stroke-width",3).attr("vector-effect","non-scaling-stroke").attr("r",1.5)})))).attr("display","initial").attr("transform",(t=>{let{globalX:e,globalY:s}=t;return"translate(".concat(e,", ").concat(s,")")})).each((function(t,e){let{levs:s,maxLev:n,key:r}=t;const o=a.Ltv(this);o.select(".outline").attr("transform","scale(".concat(.95*i.NU,")")),o.select(".fill").attr("transform","scale(".concat(i.NU,")")),o.select(".circlet").attr("class",null).attr("class","circlet "+r),o.selectAll("stop").each((function(t,e){let r=Math.floor(e/2);0===e%2&&(r-=1),-1===r?a.Ltv(this).attr("offset","".concat(0,"%")):r===s.length?a.Ltv(this).attr("offset","100%"):a.Ltv(this).attr("offset","".concat(100*(1-s[r]/n),"%"))}));const c=o.select(".fill");o.select(".bbox").attr("x",c.node().getBBox().x).attr("y",c.node().getBBox().y).attr("width",c.node().getBBox().width).attr("height",c.node().getBBox().height)})).on("click",(function(t,e){r&&r(e)})).on("mouseenter",(function(t,e){a.Ltv(this).select(".circlet").classed("active")||a.Ltv(this).select("circle").attr("stroke","orange"),o&&o(e)})).on("mouseleave",(function(t,e){a.Ltv(this).select(".circlet").classed("active")||a.Ltv(this).select("circle").attr("stroke","transparent"),h&&h(e)})).transition().delay(s).duration(1e3).attr("transform",(t=>{let{globalX:e,globalY:s,x:a,y:n}=t;return"translate(".concat(e+a*(i.pC/i.w5-1),", ").concat(s+n*(i.pC/i.w5-1),") rotate(",0,")")}))}(a.Ltv("#mosaic-svg").select(".svg-trans"),p.groups.find((t=>t.key===u[0])).nodes,n/2,{}),s((()=>()=>{e({state:"WideView"}),d()})),()=>{a.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".smallDrop").attr("display","none"),s(null)}}}),[t]),(0,h.jsx)(h.Fragment,{})}},313:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.d(e,{A:()=>v});var n=s(366),r=s(43),o=s(96),i=s(385),c=s(68),l=s(956),h=s(128),d=s(693),u=s(550),p=s(82),m=s(579),f=t([d,p]);function v(){const{waterdrops:t,state:e,setState:s,camera:a,zoomTo:f,setActiveWaterdrops:g,activeWaterdrops:v,setDisableCamAdjustments:w,getOutlineOpac:x,addZoomHandler:b,appWidth:k,appHeight:M}=(0,r.useContext)(o.B),[L,j]=(0,r.useState)([]),[A,C,S]=(0,l.iJ)(!1),[I,U]=(0,r.useState)({zoom:1,mouseX:0,mouseY:0}),[B,E]=(0,r.useState)(null);(0,r.useEffect)((()=>{n.Ltv(".infobox").attr("display","none"),S.current&&n.Ltv("#mosaic-svg").select(".svg-trans").selectAll("text").each((function(){const e=n.Ltv(this),s=e.node(),[r,o]=(0,u.kt)(s.getBoundingClientRect()),i=s.getBBox().width*a.height/a.far*8,c=s.getBBox().height*a.height/a.far*10,l=(0,u.xg)([r,o],[I.mouseX,I.mouseY]);e.attr("font-size",((e,s)=>{const r=window.innerHeight/9,o=1/s*a.height/t.height;return((i=e*o)>r?0:n.m4Y().domain([0,r]).range([1,.4]).clamp(!0)(i))*Math.min(o,.4);var i})(l,I.zoom)),n.Ltv(this.parentNode.parentNode).select("image").attr("x",-i/2).attr("y",-c/2).attr("width",i).attr("height",c)}))}),[I]),(0,r.useEffect)((()=>{b((function(t){U((e=>({...e,zoom:t.k})))}));const t=t=>{U((e=>({...e,mouseX:t.x,mouseY:t.y})))};window.addEventListener("mousemove",t);const e=n.Ltv("#minimap").attr("width",200).attr("height",250),s=n.bAh().scale(1e3).center([-119,37.7749]).translate([100,125]);return e.selectAll("path").data([...p.KW.features.filter(((t,e)=>"MultiPolygon"===t.geometry.type)),p.wU]).join("path").attr("d",(t=>n.zFW().projection(s)(t))).attr("class",(t=>"outline "+t.properties.CalLiteID)).attr("stroke",(t=>t.properties.CalLiteID?"transparent":"lightgray")).attr("stroke-width",1).attr("fill","transparent"),e.selectAll("circle").data([...p.KW.features.filter(((t,e)=>"MultiPoint"===t.geometry.type))]).join("circle").each((function(t){const e=n.Ltv(this),[a,r]=s(t.geometry.coordinates[0]);e.attr("cx",a),e.attr("cy",r)})).attr("r",2).attr("class",(t=>"outline "+t.properties.CalLiteID)).attr("fill","transparent"),function(){window.removeEventListener("mousemove",t)}}),[]),(0,r.useEffect)((function(){if((0,l.ad)(e,"WideView")){C(!0),U((t=>({...t,zoom:a.curTransform.k}))),console.time("drawing"),c.Q7.draw(c.JH),console.timeEnd("drawing");const e=x(a.curTransform.k);c.Q7.updateVisibility(1),c.Q7.updateOutlineVisibility(e);const s=n.Ltv("#mosaic-svg").select(".svg-trans");n.Ltv(".infobox").style("display","initial"),y(s,t,{onClick:t=>{j((e=>{const s=e.findIndex((e=>e.key===t.key));return-1!==s?e.splice(s,1):e.push(t),[...e]})),g((e=>(e.includes(t.key)?(e.splice(e.indexOf(t.key),1),s.select(".circlet."+t.key).classed("active",!1)):(e.push(t.key),s.select(".circlet."+t.key).classed("active",!0)),[...e])))},onHover:t=>{E({id:t.key,description:d.R[t.key].desc}),p.X8[t.key]&&n.Ltv("#minimap").select(".outline."+t.key).attr("fill","gray")},onUnhover:t=>{E(null),p.X8[t.key]&&n.Ltv("#minimap").select(".outline."+t.key).attr("fill","transparent")}});for(const t of L)s.select(".circlet."+t.key).classed("active",!0);return()=>{n.Ltv("#mosaic-svg").select(".svg-trans").selectAll(".largeDrop").attr("display","none"),n.Ltv(".infobox").style("display","none"),C(!1)}}}),[e]);const T=(0,r.useCallback)((()=>{if(1==L.length){const t=L[0],{start:e,duration:r}=f([t.x,t.y-.08*t.height,a.getZFromFarHeight(t.height*i.pC/i.w5*1.5)],(()=>{w(!1)}));e(),s({state:"ExamineView",transitionDuration:r});const o=x(a.curTransform.k);w(!0);const l=n.O1W((t=>{const e=Math.min(1,t/(r/2));c.Q7.updateVisibility(1-e),c.Q7.updateOutlineVisibility(o*(1-e)),e>=1&&(l.stop(),c.Q7.remove(c.JH))}))}else if(L.length>1){const e=L.map((t=>[t.x,t.y])),r=n.i2o(e,(t=>t[0])),o=n.i2o(e,(t=>t[1])),{start:l,duration:h}=f([r,o,a.getZFromFarHeight(2*t.groups[0].height*i.pC/i.w5*.75*2)],(()=>{w(!1)}));l(),s({state:"CompareView",transitionDuration:h,avgCoord:[r,o]});const d=x(a.curTransform.k);w(!0);const u=n.O1W((t=>{const e=Math.min(1,t/(h/5));c.Q7.updateVisibility(1-e),c.Q7.updateOutlineVisibility(d*(1-e)),e>=1&&(u.stop(),c.Q7.remove(c.JH))}))}}),[L]);let D;return(0,l.ad)(e,"WideView")&&v.length&&(D=(0,m.jsxs)("button",{onClick:T,className:"wide-view-action-btn fancy-font",children:[1==v.length?(0,m.jsx)(h.WEK,{}):(0,m.jsx)(h.IS1,{}),1==v.length?"examine":"compare"]})),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:"infobox",children:[(0,m.jsx)("svg",{id:"minimap"}),B&&(0,m.jsxs)("div",{className:"details",children:[!p.X8[B.id]&&(0,m.jsx)("p",{className:"no-loc-data",children:"No Location Data"}),(0,m.jsx)("p",{className:"curDesc",children:B.description}),(0,m.jsxs)("p",{className:"curKey",children:["id: ",(0,m.jsxs)("span",{children:[" ",B.id," "]})]})]})]}),D]})}function y(t,e,s){let{onClick:a,onHover:r,onUnhover:o}=s;console.log("updating svg"),t.selectAll(".largeDrop").data(e.groups).join((t=>t.append("g").attr("class","largeDrop").each((function(t){const e=n.Ltv(this);e.append("g").attr("class","circlet").append("circle").attr("fill","transparent").attr("stroke","transparent").attr("stroke-dasharray",3).attr("stroke-width",3).attr("vector-effect","non-scaling-stroke").attr("r",1);const s=e.append("g");s.append("g").append("image").attr("href","glow.png").attr("preserveAspectRatio","none").attr("opacity",.8),s.append("g").append("text").attr("class","fancy-font").attr("text-anchor","middle").attr("font-size",0)})))).each((function(t){n.Ltv(this).select(".circlet").attr("class",null).attr("class","circlet "+t.key),n.Ltv(this).select("text").call((e=>{e.selectAll("*").remove();const s=(0,l.LV)(d.R[t.key].display_name||d.R[t.key].id).split("\n");s.forEach(((t,a)=>{e.append("tspan").attr("x",0).attr("y","".concat(-s.length/2+.5,"em")).attr("dy","".concat(a,"em")).text(t)}))}))})).attr("display","initial").attr("transform",(t=>{let{x:e,y:s,height:a}=t;return"translate(".concat(e,", ").concat(s-.08*a,") scale(").concat(a*i.N7,")")})).on("click",(function(t,e){a&&a(e)})).on("mouseenter",(function(t,e){n.Ltv(this).select(".circlet").classed("active")||n.Ltv(this).select("circle").attr("stroke","orange"),r&&r(e)})).on("mouseleave",(function(t,e){n.Ltv(this).select(".circlet").classed("active")||n.Ltv(this).select("circle").attr("stroke","transparent"),o&&o(e)}))}[d,p]=f.then?(await f)():f,a()}catch(g){a(g)}}))}}]);
//# sourceMappingURL=805.199bedbe.chunk.js.map