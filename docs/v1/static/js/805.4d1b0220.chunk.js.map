{"version":3,"file":"static/js/805.4d1b0220.chunk.js","mappings":"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","sources":["App.jsx","AppContext.jsx","bucket-lib/BucketGlyph.jsx","bucket-lib/quantile-histogram.js","bucket-lib/utils.js","components/DotHistogram.jsx","components/SceneSettingStickers.jsx","components/SceneSettingSubcard.jsx","components/WaterdropGlyph.jsx","data/descriptions-data.jsx","data/objectives-data.jsx","data/spatial-data.jsx","hooks/useAppState.jsx","hooks/useCompareLargeDrops.jsx","hooks/useDataStory.jsx","hooks/useDataStoryVars.jsx","hooks/useDragPanels.jsx","settings.jsx","utils/three-utils.jsx","three-resources.jsx","utils/data-story-anims.jsx","utils/data-utils.jsx","utils/math-utils.jsx","utils/misc-utils.jsx","utils/render-utils.jsx","utils/story-scripts.jsx","utils/tutorialview-utils.jsx","utils/waterdrop-utils.jsx","views/CompareView.jsx","views/ExamineView.jsx","views/TutorialView.jsx","views/WideView.jsx","views/compareview-helpers.jsx","views/examineview-helpers.jsx","views/wideview-helpers.jsx"],"sourcesContent":["import React from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport WideView from \"views/WideView\";\r\nimport ExamineView from \"views/ExamineView\";\r\nimport TutorialView from \"views/TutorialView\";\r\nimport CompareView from \"views/CompareView\";\r\n\r\nimport useAppState from \"hooks/useAppState\";\r\n\r\nexport default function App() {\r\n  const appState = useAppState();\r\n\r\n  return (\r\n    <AppContext.Provider value={appState}>\r\n      <div className=\"bubbles-wrapper\">\r\n        <div id=\"mosaic-webgl\"></div>\r\n        <svg id=\"mosaic-svg\">\r\n          <g className=\"svg-trans\"></g>\r\n        </svg>\r\n      </div>\r\n      <TutorialView />\r\n      <WideView />\r\n      <ExamineView />\r\n      <CompareView />\r\n      {appState.goBack && (\r\n        <button className=\"go-back-btn\" onClick={appState.goBack}>\r\n          \r\n        </button>\r\n      )}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n","import { createContext } from \"react\";\r\n\r\nexport const AppContext = createContext({});\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  bucketPath,\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"./utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nexport default function BucketGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () => ticksExact(0, 1, resolution + 1).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    svgContainer\r\n      .select(\".bucket-mask-path\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight));\r\n\r\n    svgContainer\r\n      .select(\".bucket-outline\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight).split(\"z\")[0]);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / resolution));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"bucket-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { quantileBins, ticksExact } from \"./utils\";\r\n\r\nexport function getQuantileBins(data, domain, unitsPerQuantile, width, height) {\r\n  const numQuantiles = data.length / unitsPerQuantile;\r\n  let histBins = d3\r\n    .histogram()\r\n    .value((d) => d)\r\n    .domain(domain)\r\n    .thresholds(\r\n      ticksExact(...domain, Math.ceil(width / (height / numQuantiles)))\r\n    )(data);\r\n\r\n  let binnedQuantiles = quantileBins(histBins, unitsPerQuantile, numQuantiles);\r\n\r\n  let quantiles = [];\r\n\r\n  for (let b = 0; b < binnedQuantiles.length; b++) {\r\n    for (let y = 0; y < binnedQuantiles[b]; y++) {\r\n      quantiles.push([\r\n        (histBins[b].x1 + histBins[b].x0) / 2,\r\n        ((y + 0.5) / numQuantiles) * data.length,\r\n      ]);\r\n    }\r\n  }\r\n\r\n  return quantiles;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\n// inclusive\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n\r\nexport const interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useMemo, useRef } from \"react\";\r\nimport { getQuantileBins } from \"bucket-lib/quantile-histogram\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\n\r\nconst NUM_CIRCLES = 20;\r\nconst MARGIN = { top: 10, right: 10, bottom: 20, left: 10 };\r\nconst DOMAIN = [0, objectivesData.MAX_DELIVS];\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport default function DotHistogram({\r\n  data,\r\n  goal,\r\n  setGoal,\r\n  width = 600,\r\n  height = 400,\r\n  shortForm = false,\r\n}) {\r\n  const { current: razorID } = useRef(Math.floor(Math.random() * 1e9));\r\n  const { current: razorAreaID } = useRef(Math.floor(Math.random() * 1e9));\r\n\r\n  const svgSelector = useRef();\r\n  const circles = useMemo(\r\n    () =>\r\n      getQuantileBins(data, DOMAIN, data.length / NUM_CIRCLES, width, height),\r\n    [data]\r\n  );\r\n\r\n  const dataRange = [0, data.length];\r\n  const x = d3.scaleLinear().domain(DOMAIN).range([0, width]);\r\n  const y = d3.scaleLinear().domain(dataRange).range([height, 0]);\r\n  const count = circles.filter((d) => d[0] > goal).length;\r\n\r\n  useEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width + MARGIN.left + MARGIN.right)\r\n      .attr(\"height\", height + MARGIN.top + MARGIN.bottom)\r\n      .style(\"pointer-events\", \"none\")\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${MARGIN.left},${MARGIN.top})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(\r\n        d3\r\n          .axisBottom()\r\n          .scale(d3.scaleLinear().domain(DOMAIN).range([0, width]))\r\n          .tickFormat(d3.format(\".2s\"))\r\n      )\r\n      .call((s) => {\r\n        s.selectAll(\"line\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"path\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"text\").attr(\"fill\", \"gray\");\r\n      })\r\n      .append(\"text\")\r\n      .attr(\"fill\", \"black\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${30})`)\r\n      .text(\"Delivery (TAF)\");\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n\r\n    const ignoreFn = (e) => e.preventDefault();\r\n    let dragging = false;\r\n\r\n    document.querySelector(`#i${razorID}`).addEventListener(\"mousedown\", () => {\r\n      dragging = true;\r\n      window.addEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", () => {\r\n      dragging = false;\r\n      window.removeEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document\r\n      .querySelector(`#i${razorAreaID}`)\r\n      .addEventListener(\"mousemove\", (e) => {\r\n        if (dragging && e.target.id === `i${razorAreaID}`) {\r\n          razor.style.transform = `translateX(${Math.min(\r\n            Math.max(e.offsetX, MARGIN.left),\r\n            MARGIN.left + width\r\n          )}px)\r\n            `;\r\n\r\n          setGoal(\r\n            d3\r\n              .scaleLinear()\r\n              .domain([MARGIN.left, width + MARGIN.left])\r\n              .range(DOMAIN)\r\n              .clamp(true)(e.offsetX)\r\n          );\r\n        }\r\n      });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const svgCircles = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".icons\")\r\n      .data(circles)\r\n      .join((enter) => enter.append(\"g\").call((s) => s.append(\"path\")))\r\n      .attr(\"class\", \"icons\")\r\n      .call((s) => {\r\n        s.selectAll(\"path\").attr(\r\n          \"d\",\r\n          d3.symbol(WATERDROP_ICON, height / NUM_CIRCLES)\r\n        );\r\n      });\r\n\r\n    svgCircles.attr(\"transform\", (d) => `translate(${x(d[0])},${y(d[1])})`);\r\n\r\n    svgCircles.attr(\"fill\", (d) => (d[0] > goal ? \"steelblue\" : \"black\"));\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(DOMAIN)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n  }, [goal, circles]);\r\n\r\n  return (\r\n    <div\r\n      className={`dot-${razorAreaID} dot-histogram-wrapper`}\r\n      id={`i${razorAreaID}`}\r\n    >\r\n      <div\r\n        className={`pdf-razor ` + (shortForm ? \"short-form\" : \"\")}\r\n        id={`i${razorID}`}\r\n      >\r\n        <div>\r\n          <span>\r\n            <u>\r\n              {circles.length - count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL NOT meet demand\"}\r\n          </span>\r\n          <span>\r\n            <u>\r\n              {count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL meet demand\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport { SETT_NAME_FULL, SETT_VAL_STEPS } from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingStickers({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings comp-settings\">\r\n      {settings.map((v, i) => (\r\n        <div\r\n          className=\"full-card\"\r\n          onMouseEnter={() => setColorSetting(i)}\r\n          onMouseLeave={() => setColorSetting(null)}\r\n          key={i}\r\n        >\r\n          <span>{SETT_NAME_FULL[i]}</span>\r\n          <span>{SETT_VAL_STEPS[i][v]}</span>\r\n          <div className=\"sett-dot-wrapper\">\r\n            {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n              <span\r\n                className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport {\r\n  SETT_NAME_SHORT,\r\n  SETT_NAME_FULL,\r\n  SETT_VAL_STEPS,\r\n} from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingSubcard({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings\">\r\n      <div className=\"condense\">\r\n        {settings.map((v, i) => (\r\n          <div className=\"sett-dot-wrapper\" key={i}>\r\n            <span>{SETT_NAME_SHORT[i]}</span>\r\n            {d3.range(v + 1).map((j) => (\r\n              <span\r\n                className=\"sett-dot\"\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"full\">\r\n        <div className=\"full-container\">\r\n          <span>The settings for this scenario are:</span>\r\n          {settings.map((v, i) => (\r\n            <div\r\n              className=\"full-card\"\r\n              onMouseEnter={() => setColorSetting(i)}\r\n              onMouseLeave={() => setColorSetting(null)}\r\n              key={i}\r\n            >\r\n              <span>{SETT_NAME_FULL[i]}</span>\r\n              <span>{SETT_VAL_STEPS[i][v]}</span>\r\n              <div className=\"sett-dot-wrapper\">\r\n                {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n                  <span\r\n                    className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                    key={j}\r\n                    style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n                  ></span>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"bucket-lib/utils\";\r\nimport {\r\n  DROP_HEIGHT,\r\n  DROP_RAD,\r\n  waterdropDeltaOutline,\r\n} from \"utils/render-utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nfunction dropPath(height, [x, y]) {\r\n  const points = waterdropDeltaOutline(0, 1, height, 20);\r\n\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d[0] + x;\r\n    })\r\n    .y(function (d) {\r\n      return d[1] + y;\r\n    });\r\n  return lineFunc(points) + \"z\";\r\n}\r\n\r\nexport default function WaterdropGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () => ticksExact(0, 1, resolution + 1).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    const dropD = dropPath((innerHeight * (DROP_RAD * 2)) / DROP_HEIGHT, [\r\n      width / 2,\r\n      (height * DROP_RAD) / DROP_HEIGHT,\r\n    ]);\r\n\r\n    svgContainer.select(\".bucket-mask-path\").attr(\"d\", dropD);\r\n    svgContainer.select(\".bucket-outline\").attr(\"d\", dropD);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / resolution));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"waterdrop-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initDescriptionsData() {\r\n  const objs = await (await fetch(\"./descriptions.json\")).json();\r\n\r\n  console.log(\"DATA: loading descriptions data\");\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n}\r\n\r\nexport const descriptionsData = await initDescriptionsData();\r\n","import * as d3 from \"d3\";\r\nimport { SETT_NUM_OPTS, deserialize } from \"utils/data-utils\";\r\n\r\nimport { clamp, shuffle } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst SCEN_DIVISOR = 1; // debugging purposes, don't render all scenarios to speed things up\r\n\r\nasync function initObjectivesData() {\r\n  const MAX_DELIVS = 1200;\r\n  const SCENARIO_KEY_STRING = \"scens\";\r\n  const DELIV_KEY_STRING = \"delivs\";\r\n\r\n  const OBJECTIVES_DATA = await (async function load() {\r\n    const objs = await (await fetch(\"./objectives.json\")).json();\r\n\r\n    for (const obj of objs) {\r\n      // shuffle so clusters of identical scenario results don't get processed deterministically\r\n      for (const scen of shuffle(obj[SCENARIO_KEY_STRING])) {\r\n        // data cleanup, clamping\r\n        const unord = scen[DELIV_KEY_STRING].map((v) =>\r\n          clamp(v, 0, MAX_DELIVS)\r\n        );\r\n\r\n        scen[DELIV_KEY_STRING] = unord.sort((a, b) => b - a);\r\n      }\r\n      obj[SCENARIO_KEY_STRING] = mapBy(\r\n        obj[SCENARIO_KEY_STRING],\r\n        ({ name }) => name\r\n      );\r\n    }\r\n\r\n    console.log(\"DATA: loading objectives data\");\r\n\r\n    return mapBy(objs, ({ obj }) => obj);\r\n  })();\r\n\r\n  const OBJECTIVE_IDS = Object.keys(OBJECTIVES_DATA);\r\n\r\n  const OBJECTIVE_GOALS_MAP = (function initDefaults() {\r\n    const goalMap = {};\r\n    for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n      goalMap[OBJECTIVE_IDS[i]] = 200;\r\n    return goalMap;\r\n  })();\r\n\r\n  const _SCENARIO_IDS = Object.keys(\r\n    Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n  );\r\n\r\n  const SCENARIO_IDS = _SCENARIO_IDS.filter(\r\n    (s, i) => i % SCEN_DIVISOR === 0 || s === \"expl0000\"\r\n  );\r\n\r\n  const KEY_SETTINGS_MAP = (function preprocessData() {\r\n    const map = {};\r\n    const optArr = Object.values(SETT_NUM_OPTS);\r\n\r\n    for (let i = 0; i < SCENARIO_IDS.length; i++) {\r\n      const key = SCENARIO_IDS[i];\r\n\r\n      map[key] = deserialize(key.slice(4)).map((v, i) => (v + 1) / optArr[i]);\r\n    }\r\n\r\n    return map;\r\n  })();\r\n\r\n  // Flattening hierarchical data makes it more flexible for classifying\r\n  // (from experience). id conveniently corresponds to index.\r\n  // Also cache classifications (by objective and by scenario, for now)\r\n  const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n    const flattenedData = [];\r\n    const dataGroupings = {\r\n      objective: {},\r\n      scenario: {},\r\n    };\r\n\r\n    // for ordering later\r\n    const means = [];\r\n\r\n    let idx = 0;\r\n    for (const obj of OBJECTIVE_IDS) {\r\n      for (const scen of SCENARIO_IDS) {\r\n        if (!dataGroupings[\"objective\"][obj])\r\n          dataGroupings[\"objective\"][obj] = [];\r\n\r\n        if (!dataGroupings[\"scenario\"][scen])\r\n          dataGroupings[\"scenario\"][scen] = [];\r\n\r\n        dataGroupings[\"objective\"][obj].push(idx);\r\n        dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n        const deliveries =\r\n          OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n        flattenedData.push({\r\n          id: idx,\r\n          objective: obj,\r\n          scenario: scen,\r\n          deliveries,\r\n        });\r\n\r\n        means.push(d3.mean(deliveries));\r\n\r\n        idx++;\r\n      }\r\n    }\r\n\r\n    const orderedDataGroupings = {};\r\n\r\n    for (const criteria of Object.keys(dataGroupings)) {\r\n      const objScens = [];\r\n      for (const key of Object.keys(dataGroupings[criteria])) {\r\n        const ids = dataGroupings[criteria][key];\r\n        const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n        objScens.push({\r\n          key,\r\n          sorted: sortedObjScens,\r\n          mean: d3.mean(ids.map((id) => flattenedData[id].deliveries).flat()),\r\n        });\r\n      }\r\n\r\n      const sortedObjScens = objScens.sort((a, b) => b.mean - a.mean);\r\n\r\n      orderedDataGroupings[criteria] = {};\r\n\r\n      for (let i = 0; i < sortedObjScens.length; i++) {\r\n        const { key, sorted } = sortedObjScens[i];\r\n        const IDtoRank = {};\r\n\r\n        for (let j = 0; j < sorted.length; j++) {\r\n          IDtoRank[sorted[j]] = j;\r\n        }\r\n        orderedDataGroupings[criteria][key] = IDtoRank;\r\n        orderedDataGroupings[criteria][key].rank = i;\r\n      }\r\n    }\r\n\r\n    return [flattenedData, orderedDataGroupings];\r\n  })();\r\n\r\n  return {\r\n    MAX_DELIVS,\r\n    SCENARIO_KEY_STRING,\r\n    DELIV_KEY_STRING,\r\n    OBJECTIVES_DATA,\r\n    OBJECTIVE_IDS,\r\n    OBJECTIVE_GOALS_MAP,\r\n    SCENARIO_IDS,\r\n    KEY_SETTINGS_MAP,\r\n    FLATTENED_DATA,\r\n    DATA_GROUPINGS,\r\n  };\r\n}\r\n\r\nexport const objectivesData = await initObjectivesData();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initSpatialData() {\r\n  const SPATIAL_DATA = await (async function load() {\r\n    const objs = await (await fetch(\"./callite_spatial.json\")).json();\r\n\r\n    console.log(\"DATA: loading callite spatial data\");\r\n\r\n    return objs;\r\n  })();\r\n\r\n  const SPATIAL_FEATURES = (function () {\r\n    return mapBy(\r\n      SPATIAL_DATA.features,\r\n      ({ properties }) => properties.CalLiteID\r\n    );\r\n  })();\r\n\r\n  const CALIFORNIA_OUTLINE = await (async function load() {\r\n    const objs = await (await fetch(\"./california.json\")).json();\r\n\r\n    console.log(\"DATA: loading california spatial data\");\r\n\r\n    return objs;\r\n  })();\r\n\r\n  const CALIFORNIA_CENTER = [-119, 37.7749];\r\n\r\n  return {\r\n    SPATIAL_DATA,\r\n    SPATIAL_FEATURES,\r\n    CALIFORNIA_OUTLINE,\r\n    CALIFORNIA_CENTER,\r\n  };\r\n}\r\n\r\nexport const spatialData = await initSpatialData();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { threeResources } from \"three-resources\";\r\nimport { waterdrops } from \"utils/waterdrop-utils\";\r\n\r\nconst appWidth = window.innerWidth,\r\n  appHeight = window.innerHeight;\r\n\r\nexport default function useAppState() {\r\n  const [state, setState] = useState({});\r\n  const [activeWaterdrops, setActiveWaterdrops] = useState([]);\r\n  const [goBack, setGoBack] = useState(null);\r\n  const [goals, setGoals] = useState(objectivesData.OBJECTIVE_GOALS_MAP);\r\n\r\n  const zoomCallbacksRef = useRef([]);\r\n  const disableCamAdjustmentsRef = useRef(false);\r\n\r\n  useEffect(function initialize() {\r\n    threeResources.renderer.setSize(appWidth, appHeight);\r\n\r\n    console.time(\"drops mesh creating\");\r\n    threeResources.dropsMesh.createMesh(waterdrops);\r\n    console.timeEnd(\"drops mesh creating\");\r\n\r\n    document\r\n      .querySelector(\"#mosaic-webgl\")\r\n      .appendChild(threeResources.renderer.domElement);\r\n\r\n    d3.select(\"#mosaic-svg\").attr(\"width\", appWidth).attr(\"height\", appHeight);\r\n\r\n    const outlineOpacity = d3\r\n      .scaleLinear()\r\n      .domain([\r\n        appHeight / waterdrops.height,\r\n        appHeight / waterdrops.groups[0].height,\r\n      ])\r\n      .range([0.1, 1])\r\n      .clamp(true);\r\n\r\n    threeResources.camera.create({\r\n      width: appWidth,\r\n      height: appHeight,\r\n      webglElement: d3.select(\".bubbles-wrapper\").node(),\r\n      svgElement: d3.select(\"#mosaic-svg\").select(\".svg-trans\").node(),\r\n      zoomFn: (transform) => {\r\n        if (!disableCamAdjustmentsRef.current) {\r\n          threeResources.dropsMesh.updateOutlineVisibility(\r\n            outlineOpacity(transform.k)\r\n          );\r\n        }\r\n\r\n        for (const cb of zoomCallbacksRef.current) cb(transform);\r\n      },\r\n    });\r\n\r\n    threeResources.renderer.setAnimationLoop(() => {\r\n      threeResources.renderer.render(\r\n        threeResources.scene,\r\n        threeResources.camera.camera\r\n      );\r\n    });\r\n\r\n    setState({ state: \"TutorialView\" });\r\n  }, []);\r\n\r\n  const getOutlineOpacity = useCallback(\r\n    (val) =>\r\n      d3\r\n        .scaleLinear()\r\n        .domain([\r\n          appHeight / waterdrops.height,\r\n          appHeight / waterdrops.groups[0].height,\r\n        ])\r\n        .range([0.1, 1])\r\n        .clamp(true)(val),\r\n    []\r\n  );\r\n\r\n  const resetCamera = useCallback(function (animated = true, callback) {\r\n    const farHeight = waterdrops.height * 1.2;\r\n    const pos = [\r\n      0,\r\n      -waterdrops.height * 0.08,\r\n      threeResources.camera.getZFromFarHeight(farHeight),\r\n    ];\r\n\r\n    let transitionDuration = 0;\r\n\r\n    if (animated) {\r\n      const [start, dur] = zoomTo(pos, callback);\r\n      transitionDuration = dur;\r\n\r\n      start();\r\n    } else {\r\n      threeResources.camera.callZoomFromWorldViewport({\r\n        worldX: pos[0],\r\n        worldY: -pos[1],\r\n        farHeight,\r\n      });\r\n      callback && callback();\r\n    }\r\n\r\n    return transitionDuration;\r\n  }, []);\r\n\r\n  const zoomTo = useCallback(function (worldPos, callback) {\r\n    const i = threeResources.camera.interpolateZoomCamera(worldPos);\r\n\r\n    const duration = i.duration / 2;\r\n\r\n    const start = () => {\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(elapsed / duration, 1);\r\n        threeResources.camera.callZoom(i(et));\r\n\r\n        if (et === 1) {\r\n          t.stop();\r\n          callback && callback();\r\n        }\r\n      });\r\n    };\r\n\r\n    return [start, duration];\r\n  }, []);\r\n\r\n  const addZoomHandler = useCallback(function (cb) {\r\n    zoomCallbacksRef.current.push(cb);\r\n  }, []);\r\n\r\n  const setDisableCamAdjustments = useCallback(function (disable) {\r\n    disableCamAdjustmentsRef.current = disable;\r\n  });\r\n\r\n  return {\r\n    appWidth,\r\n    appHeight,\r\n    state,\r\n    setState,\r\n    activeWaterdrops,\r\n    setActiveWaterdrops,\r\n    setDisableCamAdjustments,\r\n    waterdrops,\r\n    goBack,\r\n    setGoBack,\r\n    zoomTo,\r\n    resetCamera,\r\n    getOutlineOpacity,\r\n    addZoomHandler,\r\n    goals,\r\n    setGoals,\r\n    ...threeResources,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { circlet, hideElems, showElems } from \"utils/render-utils\";\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { constants, updateDropsSVG } from \"utils/tutorialview-utils\";\r\n\r\nimport { helpers as compareViewHelpers } from \"views/compareview-helpers\";\r\n\r\n// TODO turn into component?\r\nexport function useCompareLargeDrops() {\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const groupsRef = useRef();\r\n  const camCentersRef = useRef({});\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines] = compareViewHelpers.calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop\r\n        );\r\n\r\n        updateLabel(avgCoords(positions));\r\n        updateScenIndicators(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  function initialize(waterdrops, camera) {\r\n    groupsRef.current = compareViewHelpers.getWaterdropGroups(\r\n      [constants.PAG_OBJECTIVE, constants.PRF_OBJECTIVE],\r\n      waterdrops,\r\n      [0, 0]\r\n    );\r\n\r\n    const farHeight =\r\n      waterdrops.groups[0].height * 2 * settings.SPREAD_1_2 * 0.75;\r\n    const k = camera.height / farHeight;\r\n\r\n    let x = camera.width / 2;\r\n    let y = camera.height / 2;\r\n\r\n    const camMidpoint = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    x = -(groupsRef.current.groupPositions[0][0] * k) + camera.width / 2;\r\n    y = groupsRef.current.groupPositions[0][1] * k + camera.height / 2;\r\n\r\n    const camFirstDrop = {\r\n      x,\r\n      y,\r\n      k,\r\n    };\r\n\r\n    camCentersRef.current.firstDrop = camFirstDrop;\r\n    camCentersRef.current.midpoint = camMidpoint;\r\n\r\n    const container = d3\r\n      .select(\"#comparer-graphics\")\r\n      .attr(\"width\", window.innerWidth)\r\n      .attr(\"height\", window.innerHeight)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-group\")\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(camFirstDrop.x, camFirstDrop.y)\r\n          .scale(camFirstDrop.k)\r\n      );\r\n\r\n    const indicatorGroup = container\r\n      .append(\"g\")\r\n      .attr(\"class\", \"indicator-group\");\r\n\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-variable\");\r\n    indicatorGroup.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    updateDropsSVG(container, groupsRef.current, {\r\n      onHover: (d) => {\r\n        setActiveMinidrop(d.key);\r\n      },\r\n    });\r\n\r\n    setActiveMinidrop(constants.DEFAULT_SCENARIO);\r\n    hideElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  function updateLabel(pos) {\r\n    const [textX, textY] = pos;\r\n\r\n    const smallTextSize =\r\n      (groupsRef.current.groups[0].height * settings.SPREAD_1_2) / 15;\r\n    const largeTextSize =\r\n      (groupsRef.current.groups[0].height * settings.SPREAD_1_2) / 10;\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-label\")\r\n      .text(\"scenario\")\r\n      .attr(\"font-size\", smallTextSize)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n    d3.select(\"#comparer-graphics\")\r\n      .select(\"#member-variable\")\r\n      .attr(\"font-size\", largeTextSize)\r\n      .text(activeMinidrop.slice(4))\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"x\", textX)\r\n      .attr(\"y\", textY);\r\n  }\r\n\r\n  function updateScenIndicators(positions, lines) {\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".circlet\")\r\n      .data(positions)\r\n      .join(\"circle\")\r\n      .attr(\"class\", \"circlet\")\r\n      .call(circlet)\r\n      .attr(\"r\", settings.LOD_1_RAD_PX * 1.5)\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"cx\", (d) => d[0])\r\n      .attr(\"cy\", (d) => d[1]);\r\n\r\n    d3.select(\"#comparer-graphics .indicator-group\")\r\n      .selectAll(\".comp-line\")\r\n      .data(lines)\r\n      .join(\"path\")\r\n      .attr(\"class\", \"comp-line\")\r\n      .transition()\r\n      .duration(100)\r\n      .attr(\"d\", (d) => d3.line()(d));\r\n  }\r\n\r\n  function introDrop2() {\r\n    const container = d3.select(\"#comparer-graphics\");\r\n\r\n    container\r\n      .select(\".svg-group\")\r\n      .transition()\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(\r\n            camCentersRef.current.midpoint.x,\r\n            camCentersRef.current.midpoint.y\r\n          )\r\n          .scale(camCentersRef.current.midpoint.k)\r\n      );\r\n\r\n    showElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  function exitDrop2() {\r\n    const container = d3.select(\"#comparer-graphics\");\r\n\r\n    container\r\n      .select(\".svg-group\")\r\n      .transition()\r\n      .attr(\r\n        \"transform\",\r\n        d3.zoomIdentity\r\n          .translate(\r\n            camCentersRef.current.firstDrop.x,\r\n            camCentersRef.current.firstDrop.y\r\n          )\r\n          .scale(camCentersRef.current.firstDrop.k)\r\n      );\r\n\r\n    hideElems(\r\n      `.large-drop.${constants.PRF_OBJECTIVE}, .indicator-group`,\r\n      container\r\n    );\r\n  }\r\n\r\n  return { initComparer: initialize, introDrop2, exitDrop2 };\r\n}\r\n","import { useCallback, useState } from \"react\";\r\n\r\nimport { useCompareLargeDrops } from \"hooks/useCompareLargeDrops\";\r\nimport { useDataStoryVars } from \"hooks/useDataStoryVars\";\r\nimport { animations as anims } from \"utils/data-story-anims\";\r\nimport { scripts } from \"utils/story-scripts\";\r\n\r\nexport function useDataStory(appCtx) {\r\n  /*\r\n    slides = [\r\n        name: string,\r\n        animHandler: {\r\n            do: someFunctionToDoAnimation,\r\n            undo: someFunctionToReverseAnimation,\r\n        }\r\n    ]\r\n     */\r\n  const [slides, setSlides] = useState([]);\r\n\r\n  const storyVars = useDataStoryVars();\r\n  const largeDropComparer = useCompareLargeDrops();\r\n\r\n  const hookAnimations = useCallback(\r\n    function () {\r\n      largeDropComparer.initComparer(appCtx.waterdrops, appCtx.camera);\r\n      const context = {\r\n        deps: {\r\n          ...storyVars,\r\n          largeDropComparer,\r\n        },\r\n      };\r\n\r\n      const showLocationAnimGroup = anims.initShowLocationAnimGroup(context);\r\n      const chartAnimGroup = anims.initChartAnimGroup(context);\r\n      const bucketsFillAnim = anims.initBucketsFillAnim(context);\r\n      const dropFillAnim = anims.initDropFillAnim(context);\r\n      const changeRealityAnim = anims.initChangeRealityAnim(context);\r\n      const fillVarDropsAnim = anims.initFillVarDropsAnim(context);\r\n      const showScenLabelAnim = anims.initShowScenLabelAnim(context);\r\n      const highlightBestAnim = anims.initHighlightBestAnim(context);\r\n      const showQuantilesAnim = anims.initShowQuantilesAnim(context);\r\n      const comparerAnimGroup = anims.initComparerAnimGroup(context);\r\n\r\n      const _slides = [\r\n        {\r\n          name: \"howMuchIntro\",\r\n          // no anims\r\n        },\r\n        {\r\n          name: \"norCal\",\r\n          animHandler: showLocationAnimGroup.showPAG,\r\n        },\r\n        {\r\n          name: \"soCal\",\r\n          animHandler: showLocationAnimGroup.showPRF,\r\n        },\r\n        {\r\n          name: \"barsAppear\",\r\n          animHandler: chartAnimGroup.barsAppear,\r\n        },\r\n        {\r\n          name: \"barsExplain\",\r\n          // no anims\r\n        },\r\n        {\r\n          name: \"barsCondense\",\r\n          animHandler: chartAnimGroup.barsCondense,\r\n        },\r\n        {\r\n          name: \"bucketsFill\",\r\n          animHandler: bucketsFillAnim,\r\n        },\r\n        {\r\n          name: \"comparingTheTwo\",\r\n          // no anims\r\n        },\r\n        {\r\n          name: \"butTheAgGroup\",\r\n          // no anims\r\n        },\r\n        {\r\n          name: \"overallIfWantReliable\",\r\n          // no anims\r\n        },\r\n        {\r\n          name: \"forNowLetsFocus\",\r\n          animHandler: dropFillAnim,\r\n        },\r\n        {\r\n          name: \"darkerColsIndic\",\r\n          // no anims\r\n        },\r\n        {\r\n          name: \"ifChangeReality\",\r\n          animHandler: changeRealityAnim,\r\n        },\r\n        {\r\n          name: \"fortunateCanExplore\",\r\n          animHandler: fillVarDropsAnim,\r\n        },\r\n        {\r\n          name: \"theseVarsCalled\",\r\n          animHandler: showScenLabelAnim,\r\n        },\r\n        {\r\n          name: \"atAGlance\",\r\n          animHandler: highlightBestAnim,\r\n        },\r\n        {\r\n          name: \"tryMoveRed\",\r\n          animHandler: showQuantilesAnim,\r\n        },\r\n        {\r\n          name: \"collectAllScen\",\r\n          animHandler: comparerAnimGroup.showPAG,\r\n        },\r\n        {\r\n          name: \"soWhyNot\",\r\n          // no anims\r\n        },\r\n        {\r\n          name: \"letsBringRefuge\",\r\n          animHandler: comparerAnimGroup.showPRF,\r\n        },\r\n      ];\r\n\r\n      setSlides(_slides);\r\n    },\r\n    [appCtx.waterdrops, appCtx.camera]\r\n  );\r\n\r\n  const getFromTo = useCallback(\r\n    function (from, to) {\r\n      let idxFrom, idxTo;\r\n\r\n      for (let i = 0; i < slides.length; i++) {\r\n        if (slides[i].name === from) idxFrom = i;\r\n        else if (slides[i].name === to) {\r\n          idxTo = i;\r\n          break;\r\n        }\r\n      }\r\n\r\n      return attachScripts(slides.slice(idxFrom, idxTo + 1));\r\n    },\r\n    [slides]\r\n  );\r\n\r\n  return {\r\n    hookAnimations,\r\n    getSlidesInRange: getFromTo,\r\n    storyVars,\r\n  };\r\n}\r\n\r\nfunction attachScripts(slides) {\r\n  return slides.map((slide) => ({\r\n    ...slide,\r\n    script: scripts[slide.name],\r\n  }));\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useState } from \"react\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\n\r\nexport function useDataStoryVars() {\r\n  const [userGoal, setUserGoal] = useState(200);\r\n  const [bucketInterperPAG, setBucketInterperPAG] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [bucketInterperPRF, setBucketInterperPRF] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [dropInterper, setDropInterper] = useState(() =>\r\n    d3.scaleLinear().range([0, 0])\r\n  );\r\n  const [variationInterpers, setVariationInterpers] = useState(() =>\r\n    constants.VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n  );\r\n\r\n  return {\r\n    userGoal,\r\n    setUserGoal,\r\n    bucketInterperPAG,\r\n    setBucketInterperPAG,\r\n    bucketInterperPRF,\r\n    setBucketInterperPRF,\r\n    dropInterper,\r\n    setDropInterper,\r\n    variationInterpers,\r\n    setVariationInterpers,\r\n  };\r\n}\r\n","import { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { worldToScreen } from \"utils/render-utils\";\r\nimport { useStateRef } from \"utils/misc-utils\";\r\n\r\nexport function useDragPanels(viewTransform) {\r\n  const [panels, setPanels, panelsRef] = useStateRef([]);\r\n  const mouseDownInfo = useRef({});\r\n\r\n  useEffect(function initialize() {\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX !== undefined) {\r\n        mouseDownInfo.current = {};\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const onPanelDragStart = useCallback(function (e, { id }) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    e.preventDefault();\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }, []);\r\n\r\n  function getPanelStyle({ x, y, offsetX, offsetY }) {\r\n    const [screenX, screenY] = worldToScreen(x, y, viewTransform);\r\n    return {\r\n      left: `${screenX + offsetX}px`,\r\n      top: `${screenY + offsetY}px`,\r\n    };\r\n  }\r\n\r\n  return {\r\n    panels,\r\n    panelsRef,\r\n    setPanels,\r\n    onPanelDragStart,\r\n    getPanelStyle,\r\n  };\r\n}\r\n","function initSettings() {\r\n  const LOD_1_LEVELS = 5;\r\n  const LOD_1_RAD_PX = 1;\r\n  const LOD_1_MIN_LEV_VAL = 0.1;\r\n  const LOD_1_SMALL_DROP_PAD_FACTOR = 1.3;\r\n  const LOD_1_LARGE_DROP_PAD_FACTOR = 1.2;\r\n\r\n  const LOD_2_SMALL_DROP_PAD_FACTOR = 3;\r\n\r\n  const GROUP_HOVER_AREA_FACTOR = 1.1 / (1 + Math.SQRT1_2);\r\n  const SPREAD_1_2 = LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  return {\r\n    LOD_1_LEVELS,\r\n    LOD_1_RAD_PX,\r\n    LOD_1_MIN_LEV_VAL,\r\n    LOD_1_SMALL_DROP_PAD_FACTOR,\r\n    LOD_1_LARGE_DROP_PAD_FACTOR,\r\n    LOD_2_SMALL_DROP_PAD_FACTOR,\r\n    GROUP_HOVER_AREA_FACTOR,\r\n    SPREAD_1_2,\r\n  };\r\n}\r\n\r\nexport const settings = initSettings();\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport { settings } from \"settings\";\r\nimport { copyCoords, sortBy } from \"./misc-utils\";\r\nimport { rotatePoints, toRadians } from \"./math-utils\";\r\nimport {\r\n  waterdropDeltaOutline,\r\n  waterdropDelta,\r\n  worldToScreen,\r\n  screenToWorld,\r\n} from \"./render-utils\";\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return {\r\n    x: (mouseX / width) * 2 - 1,\r\n    y: -(mouseY / height) * 2 + 1,\r\n  };\r\n}\r\n\r\nexport class WaterdropMesh {\r\n  static MAX_POINTS_DROPS = 60 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n  static MAX_POINTS_OUTLINE = 40 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n\r\n  dropsMesh;\r\n  outlineMesh;\r\n\r\n  added = false;\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.dropsMesh) {\r\n      this.initializeMeshes(waterdrops);\r\n    } else {\r\n      this.updateMeshes(waterdrops);\r\n    }\r\n  }\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.dropsMesh);\r\n      scene.add(this.outlineMesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.dropsMesh);\r\n      scene.remove(this.outlineMesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  // TODO optimize!\r\n  initializeMeshes(waterdrops) {\r\n    const dropsGeometry = new MeshGeometry(WaterdropMesh.MAX_POINTS_DROPS);\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = waterdropDeltaOutline(\r\n      0,\r\n      1,\r\n      settings.LOD_1_RAD_PX * 2 * 0.975\r\n    );\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const {\r\n        id,\r\n        globalX: x,\r\n        globalY: y,\r\n        levs,\r\n        maxLev,\r\n        globalTilt: tilt,\r\n      } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = waterdropDelta(\r\n          l1 / maxLev,\r\n          l2 / maxLev,\r\n          settings.LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / settings.LOD_1_LEVELS)\r\n        );\r\n\r\n        dropsGeometry.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y, rotate: tilt },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      const rotOutline = rotatePoints(copyCoords(outlineMeshCoords), tilt);\r\n\r\n      outlinePoints.push(\r\n        ...rotOutline.map(([dx, dy]) => {\r\n          return new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01);\r\n        })\r\n      );\r\n    }\r\n\r\n    dropsGeometry.finish();\r\n\r\n    this.dropsMesh = new THREE.Mesh(\r\n      dropsGeometry.threeGeom,\r\n      new THREE.MeshBasicMaterial({\r\n        vertexColors: true,\r\n        transparent: true,\r\n        opacity: 1,\r\n      })\r\n    );\r\n\r\n    this.outlineMesh = new THREE.LineSegments(\r\n      new THREE.BufferGeometry().setFromPoints(outlinePoints),\r\n      new THREE.LineBasicMaterial({\r\n        color: 13421772,\r\n        transparent: true,\r\n        opacity: 0,\r\n      })\r\n    );\r\n  }\r\n\r\n  updateOutlineVisibility(opac) {\r\n    if (!this.outlineMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateVisibility(opac) {\r\n    if (!this.outlineMesh || !this.dropsMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n    this.dropsMesh.material.opacity = opac;\r\n    this.dropsMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateMeshes(waterdrops) {\r\n    // TODO fix\r\n  }\r\n}\r\n\r\nexport class WaterdropSimplifiedMesh {\r\n  mesh;\r\n  added = false;\r\n\r\n  vertToId = {};\r\n  idToVert = {};\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.mesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.mesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.mesh) {\r\n      this.initializeMesh(waterdrops);\r\n    }\r\n\r\n    this.updateMesh(waterdrops);\r\n\r\n    return this.mesh;\r\n  }\r\n\r\n  initializeMesh(waterdrops) {\r\n    const pointsGeometry = new THREE.BufferGeometry();\r\n\r\n    const vertices = [];\r\n    const colors = [];\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, domLev } = waterdrops.nodes[i];\r\n\r\n      const color = domLev > 0 ? interpolateWatercolorBlue(domLev) : \"white\";\r\n\r\n      vertices.push(x, -y, 0);\r\n      const t_color = new THREE.Color(color);\r\n      colors.push(t_color.r, t_color.g, t_color.b);\r\n\r\n      this.vertToId[i] = id;\r\n      this.idToVert[id] = i;\r\n    }\r\n\r\n    const pointsMaterial = new THREE.PointsMaterial({\r\n      size: settings.LOD_1_RAD_PX * 2,\r\n      sizeAttenuation: true,\r\n      vertexColors: true,\r\n      map: new THREE.TextureLoader().load(\"drop.png\"),\r\n      transparent: true,\r\n    });\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(vertices), 3)\r\n    );\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"color\",\r\n      new THREE.BufferAttribute(new Float32Array(colors), 3)\r\n    );\r\n\r\n    this.mesh = new THREE.Points(pointsGeometry, pointsMaterial);\r\n  }\r\n\r\n  updateMesh(waterdrops) {\r\n    const positionAttr = this.mesh.geometry.getAttribute(\"position\");\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: newX, globalY: newY } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n      positionAttr.setXY(idx, newX, -newY);\r\n    }\r\n    positionAttr.needsUpdate = true;\r\n  }\r\n\r\n  updatePoints(waterdrops, translations, dt) {\r\n    const verts = this.mesh.geometry.vertices;\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n\r\n      const [dx, dy] = translations[id];\r\n\r\n      const x = verts[idx].x;\r\n      const y = verts[idx].y;\r\n\r\n      verts[idx].setX(x + dt * dx);\r\n      verts[idx].setY(y - dt * dy);\r\n    }\r\n\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n\r\n  intersectObject(camera, x, y) {\r\n    const intersects = camera.intersectObject(x, y, this.mesh);\r\n\r\n    if (intersects[0]) {\r\n      const intersect = sortBy(intersects, \"distanceToRay\")[0];\r\n      return this.vertToId[intersect.index];\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  webglView;\r\n  curTransform;\r\n\r\n  raycaster = new THREE.Raycaster();\r\n\r\n  svgView;\r\n\r\n  constructor({ fov, near, far }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n  }\r\n\r\n  create({ width, height, webglElement, svgElement, zoomFn }) {\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.webglView = d3.select(webglElement);\r\n    this.svgView = d3.select(svgElement);\r\n\r\n    this.zoom = d3.zoom().on(\"zoom\", (e) => {\r\n      this.curTransform = e.transform;\r\n\r\n      this.#THREEHandleZoom(e.transform);\r\n      this.svgView.attr(\"transform\", e.transform);\r\n\r\n      zoomFn && zoomFn(e.transform);\r\n    });\r\n\r\n    this.#finishCreate();\r\n  }\r\n\r\n  callZoom(transform) {\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity.translate(transform.x, transform.y).scale(transform.k)\r\n    );\r\n  }\r\n\r\n  callZoomFromWorldViewport({ worldX, worldY, farHeight }) {\r\n    const k = this.height / farHeight;\r\n\r\n    const x = -(worldX * k) + this.width / 2;\r\n    const y = worldY * k + this.height / 2;\r\n\r\n    this.callZoom({\r\n      x,\r\n      y,\r\n      k,\r\n    });\r\n  }\r\n\r\n  interpolateZoomCamera([endx, endy, endz]) {\r\n    const i = d3.interpolateZoom(\r\n      [\r\n        this.camera.position.x,\r\n        this.camera.position.y,\r\n        this.height / this.curTransform.k,\r\n      ],\r\n      [endx, -endy, this.getFarHeightFromZ(endz)]\r\n    );\r\n\r\n    const interper = (t) => {\r\n      const [worldX, worldY, farHeight] = i(t);\r\n\r\n      const k = this.height / farHeight;\r\n\r\n      const x = -(worldX * k) + this.width / 2;\r\n      const y = worldY * k + this.height / 2;\r\n\r\n      return {\r\n        x,\r\n        y,\r\n        k,\r\n      };\r\n    };\r\n\r\n    interper.duration = i.duration;\r\n\r\n    return interper;\r\n  }\r\n\r\n  getZFromFarHeight(farHeight) {\r\n    return (Math.tan(toRadians(90 - this.fov / 2)) * farHeight) / 2;\r\n  }\r\n\r\n  getFarHeightFromZ(z) {\r\n    return Math.tan(toRadians(this.fov) / 2) * z * 2;\r\n  }\r\n\r\n  getScaleFromZ(z) {\r\n    const farHeight = this.getFarHeightFromZ(z);\r\n    const scale = this.height / farHeight;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const scaleHeight = this.height / scale;\r\n    const z = this.getZFromFarHeight(scaleHeight);\r\n    return z;\r\n  }\r\n\r\n  intersectObject(mouseX, mouseY, mesh) {\r\n    this.raycaster.setFromCamera(\r\n      {\r\n        x: mouseX,\r\n        y: mouseY,\r\n      },\r\n      this.camera\r\n    );\r\n\r\n    return this.raycaster.intersectObject(mesh);\r\n  }\r\n\r\n  worldToScreen(x, y) {\r\n    return worldToScreen(x, y, this.curTransform);\r\n  }\r\n\r\n  screenToWorld(x, y) {\r\n    return screenToWorld(x, y, this.curTransform);\r\n  }\r\n\r\n  #finishCreate() {\r\n    this.zoom = this.zoom.scaleExtent([\r\n      this.getScaleFromZ(this.far),\r\n      this.getScaleFromZ(this.near),\r\n    ]);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      this.fov,\r\n      this.width / this.height,\r\n      this.near,\r\n      this.far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.webglView.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  #THREEHandleZoom(transform) {\r\n    const scale = transform.k;\r\n    const x = -(transform.x - this.width / 2) / scale;\r\n    const y = (transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n}\r\n\r\nclass MeshGeometry {\r\n  threeGeom = new THREE.BufferGeometry();\r\n  triangleIdx = 0;\r\n  positionAttribute;\r\n  colorAttribute;\r\n\r\n  constructor(numPoints, color = true) {\r\n    this.threeGeom.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n    );\r\n\r\n    if (color)\r\n      this.threeGeom.setAttribute(\r\n        \"color\",\r\n        new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n      );\r\n\r\n    this.positionAttribute = this.threeGeom.getAttribute(\"position\");\r\n    this.colorAttribute = this.threeGeom.getAttribute(\"color\");\r\n  }\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = rotatePoints(\r\n        copyCoords(meshCoords[j]),\r\n        transform.rotate\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 0,\r\n        transform.x + v1[0],\r\n        transform.y - v1[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 1,\r\n        transform.x + v2[0],\r\n        transform.y - v2[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 2,\r\n        transform.x + v3[0],\r\n        transform.y - v3[1],\r\n        z\r\n      );\r\n\r\n      if (color) {\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 0,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 1,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 2,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n      }\r\n\r\n      this.triangleIdx++;\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    this.threeGeom.setDrawRange(0, this.triangleIdx * 3);\r\n  }\r\n}\r\n","import * as THREE from \"three\";\r\n\r\nimport { WaterdropMesh, Camera } from \"utils/three-utils\";\r\n\r\nfunction initThreeResources() {\r\n  const scene = (function getScene() {\r\n    const s = new THREE.Scene();\r\n    s.background = new THREE.Color(0xefefef);\r\n    return s;\r\n  })();\r\n\r\n  const dropsMesh = new WaterdropMesh();\r\n\r\n  const camera = new Camera({\r\n    fov: 45,\r\n    near: 1,\r\n    far: 3000,\r\n  });\r\n\r\n  const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\r\n  return { scene, camera, renderer, dropsMesh };\r\n}\r\n\r\nexport const threeResources = initThreeResources();\r\n","import * as d3 from \"d3\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport yearlyData from \"data/yearly.json\";\r\nimport { hideElems, showElems } from \"utils/render-utils\";\r\n\r\nfunction initAllAnims() {\r\n  function initShowLocationAnimGroup() {\r\n    function showPAGDo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n    }\r\n\r\n    function showPAGUndo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 1)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n    }\r\n\r\n    function showPRFDo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 1)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PRF_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n    }\r\n\r\n    function showPRFUndo() {\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PAG_OBJECTIVE)\r\n        .style(\"scale\", 10)\r\n        .transition()\r\n        .style(\"scale\", 1)\r\n        .attr(\"fill\", \"gray\");\r\n      d3.select(\"#tut-minimap\")\r\n        .select(\".outline.\" + constants.PRF_OBJECTIVE)\r\n        .transition()\r\n        .attr(\"fill\", \"transparent\");\r\n    }\r\n\r\n    return {\r\n      showPAG: {\r\n        do: showPAGDo,\r\n        undo: showPAGUndo,\r\n      },\r\n      showPRF: {\r\n        do: showPRFDo,\r\n        undo: showPRFUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  function initChartAnimGroup() {\r\n    let _pagX;\r\n    let _prfX;\r\n    let _pagXAxis;\r\n    let _prfXAxis;\r\n    let _pagDataDescending;\r\n    let _prfDataDescending;\r\n\r\n    const BAR_CHART_MARGIN = { top: 40, right: 30, bottom: 40, left: 60 };\r\n\r\n    function prepareSVG() {\r\n      // PAG\r\n      {\r\n        const svgGroup = d3\r\n          .select(\"#pag-bar-graph\")\r\n          .attr(\r\n            \"width\",\r\n            constants.BAR_CHART_WIDTH +\r\n              BAR_CHART_MARGIN.left +\r\n              BAR_CHART_MARGIN.right\r\n          )\r\n          .attr(\r\n            \"height\",\r\n            constants.BAR_CHART_HEIGHT +\r\n              BAR_CHART_MARGIN.top +\r\n              BAR_CHART_MARGIN.bottom\r\n          )\r\n          .attr(\"opacity\", 1)\r\n          .append(\"g\")\r\n          .attr(\"class\", \"svg-group\")\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        const dataDescending = yearlyData[constants.PAG_OBJECTIVE]\r\n          .map((val, placeFromLeft) => ({\r\n            val,\r\n            placeFromLeft,\r\n            year: placeFromLeft + 1,\r\n          }))\r\n          .sort((a, b) => b.val - a.val);\r\n\r\n        const x = d3\r\n          .scaleBand()\r\n          .domain(dataDescending.map(({ year }) => year).sort((a, b) => a - b))\r\n          .range([0, constants.BAR_CHART_WIDTH])\r\n          .padding(0.4);\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        const xaxis = d3\r\n          .axisBottom(x)\r\n          .tickSize(0)\r\n          .tickFormat((d) => `year ${d}`)\r\n          .tickValues(\r\n            x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0)\r\n          );\r\n\r\n        svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n        svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .call(xaxis)\r\n          .selectAll(\"text\")\r\n          .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n          .style(\"text-anchor\", \"end\");\r\n        svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n        _pagX = x;\r\n        _pagXAxis = xaxis;\r\n        _pagDataDescending = dataDescending;\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const svgGroup = d3\r\n          .select(\"#prf-bar-graph\")\r\n          .attr(\r\n            \"width\",\r\n            constants.BAR_CHART_WIDTH +\r\n              BAR_CHART_MARGIN.left +\r\n              BAR_CHART_MARGIN.right\r\n          )\r\n          .attr(\r\n            \"height\",\r\n            constants.BAR_CHART_HEIGHT +\r\n              BAR_CHART_MARGIN.top +\r\n              BAR_CHART_MARGIN.bottom\r\n          )\r\n          .attr(\"opacity\", 1)\r\n          .append(\"g\")\r\n          .attr(\"class\", \"svg-group\")\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        const dataDescending = yearlyData[constants.PRF_OBJECTIVE]\r\n          .map((val, placeFromLeft) => ({\r\n            val,\r\n            placeFromLeft,\r\n            year: placeFromLeft + 1,\r\n          }))\r\n          .sort((a, b) => b.val - a.val);\r\n\r\n        const x = d3\r\n          .scaleBand()\r\n          .domain(dataDescending.map(({ year }) => year).sort((a, b) => a - b))\r\n          .range([0, constants.BAR_CHART_WIDTH])\r\n          .padding(0.4);\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        const xaxis = d3\r\n          .axisBottom(x)\r\n          .tickSize(0)\r\n          .tickFormat((d) => `year ${d}`)\r\n          .tickValues(\r\n            x.domain().filter((_, i) => i === 0 || (i + 1) % 10 === 0)\r\n          );\r\n\r\n        svgGroup.append(\"g\").attr(\"class\", \"anim-xaxis\");\r\n        svgGroup.append(\"g\").attr(\"class\", \"axis-y\");\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .call(xaxis)\r\n          .selectAll(\"text\")\r\n          .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n          .style(\"text-anchor\", \"end\");\r\n        svgGroup.select(\".axis-y\").call(d3.axisLeft(y));\r\n\r\n        _prfX = x;\r\n        _prfXAxis = xaxis;\r\n        _prfDataDescending = dataDescending;\r\n      }\r\n    }\r\n\r\n    function barsAppearDo() {\r\n      // PAG\r\n      {\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        d3.select(\"#pag-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_pagDataDescending, (d) => d.placeFromLeft)\r\n          .join(\"rect\")\r\n          .attr(\"class\", \"bars\")\r\n          .attr(\"x\", (d) => _pagX(d.year))\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"width\", _pagX.bandwidth())\r\n          .attr(\"height\", 0)\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"fill\", \"steelblue\")\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => d.placeFromLeft * 10)\r\n          .attr(\"y\", (d) => y(d.val))\r\n          .attr(\"height\", (d) => constants.BAR_CHART_HEIGHT - y(d.val));\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const y = d3\r\n          .scaleLinear()\r\n          .domain([0, objectivesData.MAX_DELIVS])\r\n          .range([constants.BAR_CHART_HEIGHT, 0]);\r\n\r\n        d3.select(\"#prf-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_prfDataDescending, (d) => d.placeFromLeft)\r\n          .join(\"rect\")\r\n          .attr(\"class\", \"bars\")\r\n          .attr(\"x\", (d) => _prfX(d.year))\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"width\", _prfX.bandwidth())\r\n          .attr(\"height\", 0)\r\n          .attr(\"opacity\", 1)\r\n          .attr(\"fill\", \"steelblue\")\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => d.placeFromLeft * 10)\r\n          .attr(\"y\", (d) => y(d.val))\r\n          .attr(\"height\", (d) => constants.BAR_CHART_HEIGHT - y(d.val));\r\n      }\r\n    }\r\n\r\n    function barsAppearUndo() {\r\n      // PAG\r\n      {\r\n        d3.select(\"#pag-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_pagDataDescending, (d) => d.placeFromLeft)\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => (_pagDataDescending.length - d.placeFromLeft - 1) * 10)\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"height\", 0);\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        d3.select(\"#prf-bar-graph .svg-group\")\r\n          .selectAll(\".bars\")\r\n          .data(_prfDataDescending, (d) => d.placeFromLeft)\r\n          .transition()\r\n          .duration(500)\r\n          .delay((d) => (_prfDataDescending.length - d.placeFromLeft - 1) * 10)\r\n          .attr(\"y\", constants.BAR_CHART_HEIGHT)\r\n          .attr(\"height\", 0);\r\n      }\r\n    }\r\n\r\n    async function barsCondenseDo() {\r\n      // PAG\r\n      {\r\n        const newWidth = constants.BAR_CHART_WIDTH / 8;\r\n        const svgGroup = d3.select(\"#pag-bar-graph .svg-group\");\r\n\r\n        svgGroup.select(\".anim-xaxis\").call(_pagXAxis.tickFormat(\"\"));\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        bars\r\n          .style(\"mix-blend-mode\", \"multiply\")\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 0.05)\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (1 - d.placeFromLeft / _pagDataDescending.length) ** 4) *\r\n                1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"width\", newWidth)\r\n          .attr(\"x\", constants.BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            svgGroup\r\n              .select(\".anim-xaxis\")\r\n              .transition()\r\n              .transition(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(0, ${constants.BAR_CHART_HEIGHT + 50})`\r\n              )\r\n              .attr(\"opacity\", 0);\r\n\r\n            bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n            svgGroup\r\n              .transition()\r\n              .delay(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(${\r\n                  BAR_CHART_MARGIN.left +\r\n                  constants.BAR_CHART_WIDTH / 2 -\r\n                  newWidth / 2\r\n                },${BAR_CHART_MARGIN.top})`\r\n              );\r\n          });\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const newWidth = constants.BAR_CHART_WIDTH / 8;\r\n        const svgGroup = d3.select(\"#prf-bar-graph .svg-group\");\r\n\r\n        svgGroup.select(\".anim-xaxis\").call(_prfXAxis.tickFormat(\"\"));\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        bars\r\n          .style(\"mix-blend-mode\", \"multiply\")\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 0.05)\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (1 - d.placeFromLeft / _prfDataDescending.length) ** 4) *\r\n                1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"width\", newWidth)\r\n          .attr(\"x\", constants.BAR_CHART_WIDTH / 2 - newWidth / 2)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            svgGroup\r\n              .select(\".anim-xaxis\")\r\n              .transition()\r\n              .transition(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(0, ${constants.BAR_CHART_HEIGHT + 50})`\r\n              )\r\n              .attr(\"opacity\", 0);\r\n\r\n            bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n            svgGroup\r\n              .transition()\r\n              .delay(500)\r\n              .attr(\r\n                \"transform\",\r\n                `translate(${\r\n                  BAR_CHART_MARGIN.left +\r\n                  constants.BAR_CHART_WIDTH / 2 -\r\n                  newWidth / 2\r\n                },${BAR_CHART_MARGIN.top})`\r\n              );\r\n          });\r\n      }\r\n    }\r\n\r\n    function barsCondenseUndo() {\r\n      // PAG\r\n      {\r\n        const svgGroup = d3.select(\"#pag-bar-graph .svg-group\");\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .transition()\r\n          .transition(500)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .attr(\"opacity\", 1);\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .call(_pagXAxis.tickFormat((d) => `year ${d}`));\r\n\r\n        svgGroup\r\n          .transition()\r\n          .delay(500)\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        bars\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (d.placeFromLeft / _pagDataDescending.length) ** 4) * 1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"x\", (d) => _prfX(d.year))\r\n          .attr(\"width\", _pagX.bandwidth())\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 1)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            bars.style(\"mix-blend-mode\", \"normal\");\r\n          });\r\n      }\r\n\r\n      // PRF\r\n      {\r\n        const svgGroup = d3.select(\"#prf-bar-graph .svg-group\");\r\n\r\n        const bars = svgGroup.selectAll(\".bars\");\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .transition()\r\n          .transition(500)\r\n          .attr(\"transform\", `translate(0, ${constants.BAR_CHART_HEIGHT})`)\r\n          .attr(\"opacity\", 1);\r\n\r\n        svgGroup\r\n          .select(\".anim-xaxis\")\r\n          .call(_prfXAxis.tickFormat((d) => `year ${d}`));\r\n\r\n        svgGroup\r\n          .transition()\r\n          .delay(500)\r\n          .attr(\r\n            \"transform\",\r\n            `translate(${BAR_CHART_MARGIN.left},${BAR_CHART_MARGIN.top})`\r\n          );\r\n\r\n        bars\r\n          .transition()\r\n          .delay(\r\n            (d) =>\r\n              100 +\r\n              (1 - (d.placeFromLeft / _prfDataDescending.length) ** 4) * 1000\r\n          )\r\n          .duration(500)\r\n          .attr(\"x\", (d) => _prfX(d.year))\r\n          .attr(\"width\", _prfX.bandwidth())\r\n          .transition()\r\n          .duration(500)\r\n          .attr(\"opacity\", 1)\r\n          .end()\r\n          .catch(() => {})\r\n          .then(() => {\r\n            bars.style(\"mix-blend-mode\", \"normal\");\r\n          });\r\n      }\r\n    }\r\n\r\n    prepareSVG();\r\n\r\n    return {\r\n      barsAppear: {\r\n        do: barsAppearDo,\r\n        undo: barsAppearUndo,\r\n      },\r\n      barsCondense: {\r\n        do: barsCondenseDo,\r\n        undo: barsCondenseUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  function initBucketsFillAnim({ deps }) {\r\n    function animDo() {\r\n      d3.selectAll(\".tut-graph-wrapper .bucket-wrapper\").style(\r\n        \"display\",\r\n        \"initial\"\r\n      );\r\n      d3.select(\"#pag-bar-graph\").attr(\"opacity\", 0);\r\n      d3.select(\"#prf-bar-graph\").attr(\"opacity\", 0);\r\n\r\n      deps.setBucketInterperPAG(() => constants.PAG_INTERPER);\r\n      deps.setBucketInterperPRF(() => constants.PRF_INTERPER);\r\n    }\r\n\r\n    function animUndo() {\r\n      deps.setBucketInterperPAG(() => d3.scaleLinear().range([0, 0]));\r\n      deps.setBucketInterperPRF(() => d3.scaleLinear().range([0, 0]));\r\n\r\n      d3.selectAll(\".tut-graph-wrapper .bucket-wrapper\").style(\r\n        \"display\",\r\n        \"none\"\r\n      );\r\n      d3.select(\"#pag-bar-graph\").transition().attr(\"opacity\", 1);\r\n      d3.select(\"#prf-bar-graph\").transition().attr(\"opacity\", 1);\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initDropFillAnim({ deps }) {\r\n    function animDo() {\r\n      deps.setDropInterper(() => constants.PAG_INTERPER_DROP);\r\n    }\r\n\r\n    function animUndo() {\r\n      deps.setDropInterper(() => d3.scaleLinear().range([0, 0]));\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initChangeRealityAnim() {\r\n    function animDo() {\r\n      d3.selectAll(\".vardrop\")\r\n        .style(\"display\", \"initial\")\r\n        .classed(\"hasarrow\", true);\r\n\r\n      hideElems(\".main-waterdrop .objective-label\");\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.selectAll(\".vardrop\")\r\n        .style(\"display\", \"none\")\r\n        .classed(\"hasarrow\", false);\r\n\r\n      showElems(\".main-waterdrop .objective-label\");\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initFillVarDropsAnim({ deps }) {\r\n    function animDo() {\r\n      d3.selectAll(\".vardrop path\").style(\"stroke-dasharray\", \"none\");\r\n      deps.setVariationInterpers(constants.VARIATIONS_INTERPERS);\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.selectAll(\".vardrop path\").style(\"stroke-dasharray\", \"10 10\");\r\n      deps.setVariationInterpers(\r\n        constants.VARIATIONS.map(() => d3.scaleLinear().range([0, 0]))\r\n      );\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initShowScenLabelAnim() {\r\n    return {\r\n      do: function () {\r\n        d3.selectAll(\".var-scen-label\").style(\"display\", \"block\");\r\n      },\r\n      undo: function () {\r\n        d3.selectAll(\".var-scen-label\").style(\"display\", \"none\");\r\n      },\r\n    };\r\n  }\r\n\r\n  function initHighlightBestAnim() {\r\n    return {\r\n      do: function () {\r\n        d3.select(\".drop1\").classed(\"highlighted\", true);\r\n      },\r\n      undo: function () {\r\n        d3.select(\".drop1\").classed(\"highlighted\", false);\r\n      },\r\n    };\r\n  }\r\n\r\n  function initShowQuantilesAnim() {\r\n    function animDo() {\r\n      d3.select(\".drop1\").classed(\"highlighted\", false);\r\n      d3.selectAll(\".vardrop\").classed(\"hasarrow\", false);\r\n\r\n      d3.selectAll(\".var-scen-label\").style(\"opacity\", \"0.5\");\r\n      d3.selectAll(\".var-scen-label, .scen-number\").style(\"color\", \"gray\");\r\n\r\n      d3.select(\".main-waterdrop\")\r\n        .transition()\r\n        .style(\"transform\", \"translateY(-100px) scale(0.5)\");\r\n      // undo scaling of label due to shrinking div\r\n      d3.select(\".main-waterdrop .var-scen-label\")\r\n        .transition()\r\n        .style(\"transform\", \"scale(2)\");\r\n      d3.selectAll(\".drop1 .waterdrop-wrapper, .drop3 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"translate(-50px, 15px) scale(0.5)\");\r\n      d3.selectAll(\".drop2 .waterdrop-wrapper, .drop4 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"translate(50px, 15px) scale(0.5)\");\r\n\r\n      d3.select(\".main-histogram\").style(\"display\", \"initial\");\r\n      d3.selectAll(\".vardrop .dot-histogram-wrapper\").style(\r\n        \"display\",\r\n        \"initial\"\r\n      );\r\n    }\r\n\r\n    function animUndo() {\r\n      d3.select(\".drop1\").classed(\"highlighted\", true);\r\n      d3.selectAll(\".vardrop\").classed(\"hasarrow\", true);\r\n\r\n      d3.selectAll(\".var-scen-label\").style(\"opacity\", \"1\");\r\n      d3.selectAll(\".var-scen-label\").style(\"color\", \"black\");\r\n      d3.selectAll(\".scen-number\").style(\"color\", \"orange\");\r\n\r\n      d3.select(\".main-waterdrop\").transition().style(\"transform\", \"none\");\r\n      // undo scaling of label due to shrinking div\r\n      d3.select(\".main-waterdrop .var-scen-label\")\r\n        .transition()\r\n        .style(\"transform\", \"scale(1)\");\r\n      d3.selectAll(\".drop1 .waterdrop-wrapper, .drop3 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"none\");\r\n      d3.selectAll(\".drop2 .waterdrop-wrapper, .drop4 .waterdrop-wrapper\")\r\n        .transition()\r\n        .style(\"transform\", \"none\");\r\n\r\n      d3.select(\".main-histogram\").style(\"display\", \"none\");\r\n      d3.selectAll(\".vardrop .dot-histogram-wrapper\").style(\"display\", \"none\");\r\n    }\r\n\r\n    return {\r\n      do: animDo,\r\n      undo: animUndo,\r\n    };\r\n  }\r\n\r\n  function initComparerAnimGroup({ deps }) {\r\n    function showPAGAnimDo() {\r\n      hideElems(\".scrollama-compare-scenobjs .tut-drop-graphics-wrapper\");\r\n      showElems(\".scrollama-compare-scenobjs .tut-comparer-graphics-wrapper\");\r\n    }\r\n\r\n    function showPAGAnimUndo() {\r\n      showElems(\r\n        \".scrollama-compare-scenobjs .tut-drop-graphics-wrapper\",\r\n        d3,\r\n        \"grid\"\r\n      );\r\n      hideElems(\".scrollama-compare-scenobjs .tut-comparer-graphics-wrapper\");\r\n    }\r\n\r\n    function showPRFAnimDo() {\r\n      deps.largeDropComparer.introDrop2();\r\n    }\r\n\r\n    function showPRFAnimUndo() {\r\n      deps.largeDropComparer.exitDrop2();\r\n    }\r\n\r\n    return {\r\n      showPAG: {\r\n        do: showPAGAnimDo,\r\n        undo: showPAGAnimUndo,\r\n      },\r\n      showPRF: {\r\n        do: showPRFAnimDo,\r\n        undo: showPRFAnimUndo,\r\n      },\r\n    };\r\n  }\r\n\r\n  return {\r\n    initShowLocationAnimGroup,\r\n    initChartAnimGroup,\r\n    initBucketsFillAnim,\r\n    initDropFillAnim,\r\n    initChangeRealityAnim,\r\n    initFillVarDropsAnim,\r\n    initShowScenLabelAnim,\r\n    initHighlightBestAnim,\r\n    initShowQuantilesAnim,\r\n    initComparerAnimGroup,\r\n  };\r\n}\r\n\r\nexport const animations = initAllAnims();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\n\r\nexport function createInterps(obj_name, scen_name, data, maxDelivs) {\r\n  const delivs =\r\n    data[obj_name][objectivesData.SCENARIO_KEY_STRING][scen_name][\r\n      objectivesData.DELIV_KEY_STRING\r\n    ];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\nexport function createInterpsFromDelivs(delivs, maxDelivs) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\n// TODO fix colors\r\nexport function calcDomLev(levs) {\r\n  levs = [1, ...levs, 0];\r\n\r\n  let mean = 0;\r\n  for (let i = 0; i < levs.length - 1; i++) {\r\n    const dif = levs[i] - levs[i + 1];\r\n    mean += (dif * (i - 1)) / (levs.length + 4);\r\n  }\r\n\r\n  return mean;\r\n}\r\n\r\nexport const SETT_NAME_SHORT = [\"D\", \"C\", \"P\", \"R\", \"M\"];\r\nexport const SETT_NAME_FULL = [\r\n  \"Demand\",\r\n  \"Carryover\",\r\n  \"Priority\",\r\n  \"Regs.\",\r\n  \"Min. Flow\",\r\n];\r\nexport const SETT_VAL_STEPS = [\r\n  [1, 0.9, 0.8, 0.7, 0.6].reverse(), // demand\r\n  [1.0, 1.2, 1.3], // carryover\r\n  [0, 1], // priority\r\n  [1, 2, 3, 4], // regs\r\n  [0, 0.4, 0.6, 0.7, 0.8], // minflow\r\n];\r\n\r\nexport const SETT_NUM_OPTS = {\r\n  demand: SETT_VAL_STEPS[0].length,\r\n  carryover: SETT_VAL_STEPS[1].length,\r\n  priority: SETT_VAL_STEPS[2].length,\r\n  regs: SETT_VAL_STEPS[3].length,\r\n  minflow: SETT_VAL_STEPS[4].length,\r\n};\r\n\r\nexport function deserialize(scenStr) {\r\n  let scenNum = parseInt(scenStr);\r\n\r\n  const minflow = scenNum % SETT_NUM_OPTS.minflow;\r\n  scenNum = (scenNum - minflow) / SETT_NUM_OPTS.minflow;\r\n\r\n  const regs = scenNum % SETT_NUM_OPTS.regs;\r\n  scenNum = (scenNum - regs) / SETT_NUM_OPTS.regs;\r\n\r\n  const priority = scenNum % SETT_NUM_OPTS.priority;\r\n  scenNum = (scenNum - priority) / SETT_NUM_OPTS.priority;\r\n\r\n  const carryover = scenNum % SETT_NUM_OPTS.carryover;\r\n  scenNum = (scenNum - carryover) / SETT_NUM_OPTS.carryover;\r\n\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demand = scenNum % SETT_NUM_OPTS.demand;\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n\r\n  return [demandReverse, carryover, priority, regs, minflow];\r\n}\r\n\r\nexport function serialize(demand, carryover, priority, regs, minflow) {\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n  let code = 0;\r\n  code += minflow;\r\n  code += SETT_NUM_OPTS.minflow * regs;\r\n  code += SETT_NUM_OPTS.regs * SETT_NUM_OPTS.minflow * priority;\r\n  code +=\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    carryover;\r\n  code +=\r\n    SETT_NUM_OPTS.carryover *\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    demandReverse;\r\n\r\n  const finalKey = `expl${d3.format(\"0>4\")(code)}`;\r\n\r\n  return finalKey;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport Matter from \"matter-js\";\r\n\r\nimport { CIRC_RAD, DROP_HEIGHT } from \"./render-utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor((Math.sqrt(AREA / 3.14) * 2) / 2);\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes, reuse = false) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r));\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\nexport function percentToRatioFilled(p) {\r\n  p -= 0.0088;\r\n  return clamp(\r\n    (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326,\r\n    0,\r\n    1\r\n  );\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport function interp(x, a, b) {\r\n  return x * (b - a) + a;\r\n}\r\n\r\nexport function revInterp(t, a, b) {\r\n  return (t - a) / (b - a);\r\n}\r\n\r\nexport function distSq([x1, y1], [x2, y2]) {\r\n  return (x2 - x1) ** 2 + (y2 - y1) ** 2;\r\n}\r\n\r\nexport function dist([x1, y1], [x2, y2]) {\r\n  return Math.sqrt(distSq([x1, y1], [x2, y2]));\r\n}\r\n\r\nexport function getCenterDomRect(domRect) {\r\n  return [domRect.left + domRect.width / 2, domRect.top + domRect.height / 2];\r\n}\r\n\r\nexport function clipEnds([from, to], shortenByStart, shortenByEnd) {\r\n  const len = Math.sqrt((from[0] - to[0]) ** 2 + (from[1] - to[1]) ** 2);\r\n  const normed = [(to[0] - from[0]) / len, (to[1] - from[1]) / len];\r\n\r\n  if (shortenByEnd === undefined) shortenByEnd = shortenByStart;\r\n\r\n  from[0] += normed[0] * shortenByStart;\r\n  from[1] += normed[1] * shortenByStart;\r\n  to[0] -= normed[0] * shortenByEnd;\r\n  to[1] -= normed[1] * shortenByEnd;\r\n\r\n  return [from, to];\r\n}\r\n\r\nexport function dropRadToDropHeight(rad) {\r\n  return (1 + Math.SQRT2) * rad;\r\n}\r\n\r\nexport function dropCenterCorrection({ rad, height }) {\r\n  if (rad !== undefined) return dropRadToDropHeight(rad) * 0.08;\r\n  return height * 0.08;\r\n}\r\n\r\nexport function avgCoords(coords) {\r\n  return [d3.mean(coords, (c) => c[0]), d3.mean(coords, (c) => c[1])];\r\n}\r\n\r\nexport function rotatePoint(x, y, deg) {\r\n  const vec = new THREE.Vector3(x, y, 0).applyEuler(\r\n    new THREE.Euler(0, 0, toRadians(deg))\r\n  );\r\n  return [vec.x, vec.y];\r\n}\r\n\r\n// modifies arr!\r\nexport function rotatePoints(arr, deg) {\r\n  for (const a of arr) {\r\n    const newPoint = rotatePoint(a[0], a[1], deg);\r\n    a[0] = newPoint[0];\r\n    a[1] = newPoint[1];\r\n  }\r\n  return arr;\r\n}\r\n\r\n// https://stackoverflow.com/a/2450976\r\nexport function shuffle(array) {\r\n  let currentIndex = array.length;\r\n\r\n  // While there remain elements to shuffle...\r\n  while (currentIndex != 0) {\r\n    // Pick a remaining element...\r\n    let randomIndex = Math.floor(Math.random() * currentIndex);\r\n    currentIndex--;\r\n\r\n    // And swap it with the current element.\r\n    [array[currentIndex], array[randomIndex]] = [\r\n      array[randomIndex],\r\n      array[currentIndex],\r\n    ];\r\n  }\r\n\r\n  return array;\r\n}\r\n","// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    if (typeof v === \"function\")\r\n      _setState((curVal) => (stateRef.current = v(curVal)));\r\n    else _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n\r\nexport function isState(stateInfo, stateName) {\r\n  return stateInfo && stateInfo.state === stateName;\r\n}\r\n\r\nexport function wrap(s) {\r\n  return s.replace(/(?![^\\n]{1,15}$)([^\\n]{1,15})\\s/g, \"$1\\n\");\r\n}\r\n\r\nexport function genUUID() {\r\n  return Math.floor(Math.random() * 1e9);\r\n}\r\n\r\nexport function arrRemove(arr, item) {\r\n  let idx;\r\n  if (typeof item === \"function\") {\r\n    idx = arr.findIndex(item);\r\n  } else {\r\n    idx = arr.indexOf(item);\r\n  }\r\n  if (idx !== -1) arr.splice(idx, 1);\r\n  return arr;\r\n}\r\n\r\nexport function copyCoords(arr) {\r\n  return arr.map((a) => Array.from(a));\r\n}\r\n\r\n// https://www.geeksforgeeks.org/implement-search-box-with-debounce-in-javascript/\r\nexport const debounce = (fn, delay = 1000) => {\r\n  let timerId = null;\r\n  return (...args) => {\r\n    clearTimeout(timerId);\r\n    timerId = setTimeout(() => fn(...args), delay);\r\n  };\r\n};\r\n","import { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport * as d3 from \"d3\";\r\nimport { settings } from \"settings\";\r\nimport { wrap } from \"./misc-utils\";\r\nimport { percentToRatioFilled } from \"./math-utils\";\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport const CIRC_RAD = Math.SQRT1_2;\r\nexport const DROP_RAD = 1;\r\nexport const CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nexport const DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = (CIRC_RAD + DROP_RAD / 2) / DROP_HEIGHT;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2, subdivs = 10) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 1 / subdivs;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function circlet(s) {\r\n  s.attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke\", \"orange\")\r\n    .attr(\"stroke-dasharray\", 3)\r\n    .attr(\"stroke-width\", 3)\r\n    .attr(\"vector-effect\", \"non-scaling-stroke\");\r\n}\r\n\r\nexport function showElems(elemStr, container, displayVal) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", displayVal || \"block\");\r\n}\r\n\r\nexport function hideElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", \"none\");\r\n}\r\n\r\nexport function removeElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).remove();\r\n}\r\n\r\nexport function gradientInit(levs, gradId) {\r\n  return (s) => {\r\n    const stops = s\r\n      .append(\"defs\")\r\n      .append(\"linearGradient\")\r\n      .attr(\"id\", gradId)\r\n      .attr(\"x1\", \"0%\")\r\n      .attr(\"x2\", \"0%\")\r\n      .attr(\"y1\", \"0%\")\r\n      .attr(\"y2\", \"100%\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n    levs.forEach((_, i) => {\r\n      for (let j = 0; j < 2; j++) {\r\n        stops\r\n          .append(\"stop\")\r\n          .attr(\r\n            \"stop-color\",\r\n            interpolateWatercolorBlue(i / settings.LOD_1_LEVELS)\r\n          );\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nexport function gradientUpdate(levs, maxLev) {\r\n  return (s) => {\r\n    s.selectAll(\"stop\").each(function (_, i) {\r\n      // first stop is at 0\r\n      if (i === 0) {\r\n        d3.select(this).attr(\"offset\", `0%`);\r\n        return;\r\n      }\r\n\r\n      // last stop is at 100\r\n      if (i === (levs.length + 1) * 2 - 1) {\r\n        d3.select(this).attr(\"offset\", `100%`);\r\n        return;\r\n      }\r\n\r\n      let valOffset = Math.floor((i - 1) / 2);\r\n\r\n      d3.select(this).attr(\r\n        \"offset\",\r\n        `${(1 - percentToRatioFilled(levs[valOffset] / maxLev)) * 100}%`\r\n      );\r\n    });\r\n  };\r\n}\r\n\r\nexport function worldToScreen(x, y, camTransform) {\r\n  return [\r\n    x * camTransform.k + camTransform.x,\r\n    y * camTransform.k + camTransform.y,\r\n  ];\r\n}\r\n\r\nexport function screenToWorld(x, y, camTransform) {\r\n  return [\r\n    (x - camTransform.x) / camTransform.k,\r\n    (y - camTransform.y) / camTransform.k,\r\n  ];\r\n}\r\n\r\nexport function generateTSpan(text, lineHeight = 1.2) {\r\n  return (s) => {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = typeof text === \"string\" ? wrap(text).split(\"\\n\") : text;\r\n\r\n    const x = s.attr(\"x\");\r\n\r\n    lines.forEach((line) => {\r\n      s.append(\"tspan\").attr(\"x\", x).attr(\"dy\", `${lineHeight}em`).text(line);\r\n    });\r\n  };\r\n}\r\n","import React from \"react\";\r\n\r\nfunction initScripts() {\r\n  return {\r\n    howMuchIntro: (\r\n      <div className=\"tut-text-card hero\">\r\n        <em>How much water do the people of California get?</em> Let's focus on\r\n        two groups of people:\r\n      </div>\r\n    ),\r\n    norCal: (\r\n      <div className=\"tut-text-card\">the agriculture group in the north...</div>\r\n    ),\r\n    soCal: (\r\n      <div className=\"tut-text-card\">...and the refuge group in the south.</div>\r\n    ),\r\n    barsAppear: (\r\n      <div className=\"tut-text-card\">\r\n        This is the average yearly amount of water each group receives,\r\n        specifically from the <b>Central Valley Project</b>, one of two water\r\n        municipalities in California.\r\n      </div>\r\n    ),\r\n    barsExplain: (\r\n      <div className=\"tut-text-card\">\r\n        Here, it is presented as bar graphs, with the bottom axis representing\r\n        the year and the side axis representing the amount of water delivered in\r\n        thousand acre-feet (TAF).\r\n      </div>\r\n    ),\r\n    barsCondense: (\r\n      <div className=\"tut-text-card\">\r\n        We'll condense each bar graph into a single bar with a filled gradient.\r\n      </div>\r\n    ),\r\n    bucketsFill: (\r\n      <div className=\"tut-text-card\">\r\n        What we get are buckets of water showing which water levels are most\r\n        likely, with the darker areas being the most likely water levels.\r\n      </div>\r\n    ),\r\n    comparingTheTwo: (\r\n      <div className=\"tut-text-card\">\r\n        Comparing the two, we see that the maximum water level for the refuge\r\n        group is more than the agriculture group. Additionally, the refuge\r\n        group's water level is more consistent than that of the agriculture\r\n        group, with 1/3 maximum capacity being the most likely water level.\r\n      </div>\r\n    ),\r\n    butTheAgGroup: (\r\n      <div className=\"tut-text-card\">\r\n        But the agriculture group has some chances of reaching higher than the\r\n        refuge group's most likely water level, judging from the light blue\r\n        levels that are situated above the 1/3 mark.\r\n      </div>\r\n    ),\r\n    overallIfWantReliable: (\r\n      <div className=\"tut-text-card\" style={{ marginBottom: \"80vh\" }}>\r\n        Overall, if we want a reliable supply we would want the refuge group's\r\n        deliveries, but if we want a chance at higher supplies of water albeit\r\n        with more inconsistent results, we would want the agriculture group's\r\n        deliveries.\r\n      </div>\r\n    ),\r\n    forNowLetsFocus: (\r\n      <div className=\"tut-text-card\">\r\n        For now, let's focus on the agriculture group. Here it is as a drop of\r\n        water. We see here that the lightest color reaches the midpoint of the\r\n        maximum water possible, meaning that there is a chance 600 TAF of water\r\n        will be delivered to this group.\r\n      </div>\r\n    ),\r\n    darkerColsIndic: (\r\n      <div className=\"tut-text-card\">\r\n        The darker colors, however, indicate that it's more likely that less\r\n        than a quarter of the maximum, or around 300 TAF, will be delivered. As\r\n        we'll later see, this is not a lot compared to other areas of\r\n        California.\r\n      </div>\r\n    ),\r\n    ifChangeReality: (\r\n      <div className=\"tut-text-card\">\r\n        But what if we could <em>change reality</em>? What if we could increase\r\n        the likelihood of delivering as much water as possible by changing the\r\n        way we manage it?\r\n      </div>\r\n    ),\r\n    fortunateCanExplore: (\r\n      <div className=\"tut-text-card\">\r\n        Fortunately, we can explore those possibilities with the help of a\r\n        simulator called\r\n        <b> CalSim</b>.\r\n      </div>\r\n    ),\r\n    theseVarsCalled: (\r\n      <div className=\"tut-text-card\">\r\n        These variations are called <em>scenarios</em> and are labelled with\r\n        unique numbers. Our reality is a scenario with no variables changed,\r\n        labelled scenario 0000.\r\n      </div>\r\n    ),\r\n    atAGlance: (\r\n      <div className=\"tut-text-card\">\r\n        At a glance, we can easily see that scenario 0020 appears to be the best\r\n        scenario since the darker water levels reach higher than those of the\r\n        other scenarios. To more concretely compare these scenarios, however,\r\n        we'll use a different view.\r\n      </div>\r\n    ),\r\n    tryMoveRed: (\r\n      <div className=\"tut-text-card\" style={{ marginBottom: \"120vh\" }}>\r\n        Try moving the red line to change the minimum demand and see how well\r\n        each of these scenarios meet those demands.\r\n      </div>\r\n    ),\r\n    collectAllScen: (\r\n      <div className=\"tut-text-card\">\r\n        We'll collect all the possible scenarios and sort them by their average\r\n        deliveries.\r\n      </div>\r\n    ),\r\n    soWhyNot: (\r\n      <div className=\"tut-text-card\">\r\n        So why don't we just choose the best scenario? Well, it's because it's\r\n        not just this group that wants water. Other groups, which we call{\" \"}\r\n        <em>objectives</em>, want scenarios that best fit <em>them.</em>\r\n      </div>\r\n    ),\r\n    letsBringRefuge: (\r\n      <div className=\"tut-text-card\" style={{ marginBottom: \"120vh\" }}>\r\n        Let's bring back the refuge group. The scenarios that benefit the\r\n        agriculture group do not always benefit the refuge group, and vice\r\n        versa. Hover over the waterdrops to see how the same scenarios place for\r\n        each objective. (Can you find a scenario that benefits both?)\r\n      </div>\r\n    ),\r\n  };\r\n}\r\n\r\nexport const scripts = initScripts();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { settings } from \"settings\";\r\nimport { DROPLET_SHAPE, generateTSpan } from \"./render-utils\";\r\nimport { dropCenterCorrection, percentToRatioFilled } from \"./math-utils\";\r\nimport { genUUID } from \"./misc-utils\";\r\nimport { gradientUpdate } from \"./render-utils\";\r\nimport { gradientInit } from \"./render-utils\";\r\n\r\nfunction initConstants() {\r\n  const BAR_CHART_WIDTH = 500,\r\n    BAR_CHART_HEIGHT = 400;\r\n\r\n  const INTERP_COLOR = d3.interpolateRgbBasis([\r\n    \"#F2F5FB\",\r\n    \"#D0DDEB\",\r\n    \"#7B9BC0\",\r\n    \"#4F739F\",\r\n    \"#112A57\",\r\n  ]);\r\n\r\n  const PAG_OBJECTIVE = \"DEL_CVP_PAG_N\";\r\n  const PRF_OBJECTIVE = \"DEL_CVP_PRF_S\";\r\n\r\n  const DEFAULT_SCENARIO = \"expl0000\";\r\n\r\n  const PAG_DELIVS =\r\n    objectivesData.OBJECTIVES_DATA[PAG_OBJECTIVE][\r\n      objectivesData.SCENARIO_KEY_STRING\r\n    ][DEFAULT_SCENARIO][objectivesData.DELIV_KEY_STRING];\r\n  const PRF_DELIVS =\r\n    objectivesData.OBJECTIVES_DATA[PRF_OBJECTIVE][\r\n      objectivesData.SCENARIO_KEY_STRING\r\n    ][DEFAULT_SCENARIO][objectivesData.DELIV_KEY_STRING];\r\n\r\n  const VARIATIONS = [\r\n    \"expl0020\", // change priority\r\n    \"expl0080\", // increase carryover\r\n    \"expl0480\", // decrease demand\r\n    \"expl0004\", // increase minflow\r\n  ];\r\n\r\n  const VARIATIONS_DELIVS = VARIATIONS.map(\r\n    (vars) =>\r\n      objectivesData.OBJECTIVES_DATA[PAG_OBJECTIVE][\r\n        objectivesData.SCENARIO_KEY_STRING\r\n      ][vars][objectivesData.DELIV_KEY_STRING]\r\n  );\r\n\r\n  const VARIATIONS_INTERPERS = VARIATIONS_DELIVS.map(\r\n    (varDelivs) => (val) =>\r\n      percentToRatioFilled(\r\n        d3\r\n          .scaleLinear()\r\n          .domain(ticksExact(0, 1, varDelivs.length))\r\n          .range(\r\n            varDelivs\r\n              .map((v) => v / objectivesData.MAX_DELIVS)\r\n              .sort()\r\n              .reverse()\r\n          )\r\n          .clamp(true)(val)\r\n      )\r\n  );\r\n\r\n  const PAG_INTERPER = (val) =>\r\n    d3\r\n      .scaleLinear()\r\n      .domain(ticksExact(0, 1, PAG_DELIVS.length))\r\n      .range(\r\n        PAG_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n          .sort()\r\n          .reverse()\r\n      )\r\n      .clamp(true)(val);\r\n\r\n  const PAG_INTERPER_DROP = (val) =>\r\n    percentToRatioFilled(\r\n      d3\r\n        .scaleLinear()\r\n        .domain(ticksExact(0, 1, PAG_DELIVS.length))\r\n        .range(\r\n          PAG_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n            .sort()\r\n            .reverse()\r\n        )\r\n        .clamp(true)(val)\r\n    );\r\n\r\n  const PRF_INTERPER = (val) =>\r\n    d3\r\n      .scaleLinear()\r\n      .domain(ticksExact(0, 1, PRF_DELIVS.length))\r\n      .range(\r\n        PRF_DELIVS.map((v) => v / objectivesData.MAX_DELIVS)\r\n          .sort()\r\n          .reverse()\r\n      )\r\n      .clamp(true)(val);\r\n\r\n  const DROP_VARIATIONS = [\r\n    {\r\n      idx: 0,\r\n      scen: \"0020\",\r\n      clas: \"drop1\",\r\n      desc: \"change priority\",\r\n    },\r\n    {\r\n      idx: 1,\r\n      scen: \"0080\",\r\n      clas: \"drop2\",\r\n      desc: \"increase carryover\",\r\n    },\r\n    {\r\n      idx: 2,\r\n      scen: \"0480\",\r\n      clas: \"drop3\",\r\n      desc: \"decrease demand\",\r\n    },\r\n    {\r\n      idx: 3,\r\n      scen: \"0004\",\r\n      clas: \"drop4\",\r\n      desc: \"increase minimum flow\",\r\n    },\r\n  ];\r\n\r\n  return {\r\n    BAR_CHART_WIDTH,\r\n    BAR_CHART_HEIGHT,\r\n    INTERP_COLOR,\r\n    PAG_OBJECTIVE,\r\n    PRF_OBJECTIVE,\r\n    DEFAULT_SCENARIO,\r\n    PAG_DELIVS,\r\n    PRF_DELIVS,\r\n    VARIATIONS,\r\n    VARIATIONS_DELIVS,\r\n    VARIATIONS_INTERPERS,\r\n    PAG_INTERPER,\r\n    PAG_INTERPER_DROP,\r\n    PRF_INTERPER,\r\n    DROP_VARIATIONS,\r\n  };\r\n}\r\n\r\nfunction largeDropInit({ nodes, height, key }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"large-drop \" + key);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"stroke\", \"none\")\r\n      .attr(\"fill\", \"yellow\")\r\n      .attr(\"r\", settings.LOD_1_RAD_PX * 2);\r\n\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * settings.SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"fancy-font large-gray-text\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ key, levs, x, y }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const randId = `tut-grad-${genUUID()}`;\r\n\r\n    s.call(gradientInit(levs, randId));\r\n\r\n    if (key === \"expl0000\") {\r\n      d3.select(s.node().parentNode)\r\n        .select(\".highlight-circle\")\r\n        .attr(\"cx\", x * settings.SPREAD_1_2)\r\n        .attr(\r\n          \"cy\",\r\n          y * settings.SPREAD_1_2 -\r\n            dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n        );\r\n    }\r\n\r\n    s.append(\"path\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"class\", \"outline\")\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX * 0.95})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${randId})`)\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX})`);\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate({ nodes, key, height }) {\r\n  return (s) => {\r\n    s.select(\"text\")\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", (height / 2) * settings.SPREAD_1_2 * 0.8)\r\n      .call(\r\n        generateTSpan(\r\n          descriptionsData[key].display_name || descriptionsData[key].id\r\n        )\r\n      );\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\r\n        \"transform\",\r\n        ({ x, y }) =>\r\n          `translate(${x * settings.SPREAD_1_2}, ${y * settings.SPREAD_1_2})`\r\n      )\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ levs, maxLev }) {\r\n  return (s) => {\r\n    s.call(gradientUpdate(levs, maxLev));\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction updateDropsSVG(container, waterdropGroups, { onHover }) {\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (group, i) {\r\n        d3.select(this).call(\r\n          largeDropInit(group, waterdropGroups.groupPositions[i])\r\n        );\r\n      });\r\n    })\r\n    .attr(\"transform\", (_, i) => {\r\n      const groupPos = waterdropGroups.groupPositions[i];\r\n      return `translate(${groupPos[0]}, ${groupPos[1]})`;\r\n    })\r\n    .each(function (group) {\r\n      d3.select(this)\r\n        .call(largeDropUpdate(group))\r\n        .selectAll(\".small-drop\")\r\n        .on(\"mouseenter\", function (e, d) {\r\n          onHover && onHover(d);\r\n        });\r\n    });\r\n}\r\n\r\nconst constants = initConstants();\r\n\r\nexport { constants, updateDropsSVG };\r\n","import { ticksExact } from \"bucket-lib/utils\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\n\r\nimport { calcDomLev, createInterpsFromDelivs } from \"utils/data-utils\";\r\nimport { placeDropsUsingPhysics, rotatePoint } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\n// TODO optimize!!\r\nfunction initWaterdrops(grouping) {\r\n  console.time(\"init waterdrops\");\r\n  const groupKeys =\r\n    grouping === \"objective\"\r\n      ? objectivesData.OBJECTIVE_IDS\r\n      : objectivesData.SCENARIO_IDS;\r\n  const memberKeys =\r\n    grouping === \"objective\"\r\n      ? objectivesData.SCENARIO_IDS\r\n      : objectivesData.OBJECTIVE_IDS;\r\n\r\n  const amtGroups = groupKeys.length;\r\n  const amtPerGroup = memberKeys.length;\r\n\r\n  const largeDropRad =\r\n    Math.sqrt(amtPerGroup / Math.PI) *\r\n    settings.LOD_1_RAD_PX *\r\n    2 *\r\n    settings.LOD_1_SMALL_DROP_PAD_FACTOR *\r\n    settings.LOD_1_LARGE_DROP_PAD_FACTOR;\r\n  const smallDropRad =\r\n    settings.LOD_1_RAD_PX * settings.LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  const largeNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    groupKeys.map((p, idx) => ({\r\n      r: largeDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  for (let i = 0; i < largeNodesPhys.length; i++) {\r\n    largeNodesPhys[i].tilt = Math.random() * 50 - 25;\r\n  }\r\n\r\n  const largeNodesPos = mapBy(largeNodesPhys, ({ id }) => id);\r\n\r\n  const smallNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    memberKeys.map((s, idx) => ({\r\n      r: smallDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const smallNodesPos = mapBy(smallNodesPhys, ({ id }) => id);\r\n\r\n  const nodes = [];\r\n  const groupNodes = [];\r\n\r\n  const groupToNodes = {};\r\n\r\n  let idx = 0;\r\n\r\n  for (const nodeData of objectivesData.FLATTENED_DATA) {\r\n    const { id, objective, scenario, deliveries } = nodeData;\r\n\r\n    const i = createInterpsFromDelivs(deliveries, objectivesData.MAX_DELIVS);\r\n    const wds = ticksExact(0, 1, settings.LOD_1_LEVELS + 1).map((d) => i(d));\r\n\r\n    const levs = wds.map(\r\n      (w, i) =>\r\n        Math.max(w, i == 0 ? settings.LOD_1_MIN_LEV_VAL : 0) *\r\n        settings.LOD_1_RAD_PX\r\n    );\r\n\r\n    const groupID = grouping === \"objective\" ? objective : scenario;\r\n    const memberID = grouping === \"objective\" ? scenario : objective;\r\n\r\n    const groupRank = objectivesData.DATA_GROUPINGS[grouping][groupID].rank;\r\n    const memberRank = objectivesData.DATA_GROUPINGS[grouping][groupID][id];\r\n\r\n    const localTilt = Math.random() * 50 - 25;\r\n    const parentTilt = largeNodesPos[groupRank].tilt;\r\n\r\n    const { x, y } = smallNodesPos[memberRank];\r\n    const [rotatedX, rotatedY] = rotatePoint(x, y, parentTilt);\r\n\r\n    const node = {\r\n      id,\r\n      levs,\r\n      maxLev: settings.LOD_1_RAD_PX,\r\n      domLev: calcDomLev(levs),\r\n      tilt: localTilt,\r\n      dur: Math.random() * 100 + 400,\r\n      x,\r\n      y,\r\n      group: groupID,\r\n      key: memberID,\r\n      globalX: largeNodesPos[groupRank].x + rotatedX,\r\n      globalY: largeNodesPos[groupRank].y + rotatedY,\r\n      globalTilt: parentTilt + localTilt,\r\n    };\r\n\r\n    nodes.push(node);\r\n\r\n    if (!groupToNodes[groupID]) groupToNodes[groupID] = [];\r\n\r\n    groupToNodes[groupID].push(node);\r\n  }\r\n\r\n  for (const groupKey of groupKeys) {\r\n    const { x, y, tilt } =\r\n      largeNodesPos[objectivesData.DATA_GROUPINGS[grouping][groupKey].rank];\r\n    groupNodes.push({\r\n      x,\r\n      y,\r\n      tilt,\r\n      key: groupKey,\r\n      height: smallNodesPhys.height,\r\n      nodes: groupToNodes[groupKey],\r\n    });\r\n  }\r\n\r\n  console.timeEnd(\"init waterdrops\");\r\n\r\n  return {\r\n    nodes: nodes,\r\n    groups: groupNodes,\r\n    height: largeNodesPhys.height,\r\n  };\r\n}\r\n\r\nexport const waterdrops = initWaterdrops(\"objective\");\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingStickers from \"components/SceneSettingStickers\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { hideElems, removeElems, showElems } from \"utils/render-utils\";\r\nimport { deserialize } from \"utils/data-utils\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\n\r\nimport { helpers } from \"./compareview-helpers\";\r\n\r\nexport default function CompareView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n\r\n  const groupsRef = useRef();\r\n  const centerRef = useRef();\r\n\r\n  const getScreenDropHeight = () =>\r\n    groupsRef.current.groups[0].height * settings.SPREAD_1_2;\r\n\r\n  useEffect(function initialize() {\r\n    const container = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"compare-group\");\r\n\r\n    container.append(\"text\").attr(\"id\", \"member-variable\");\r\n    container.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    appCtx.addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"CompareView\")) {\r\n        const container = d3.select(\"#compare-group\");\r\n\r\n        const { viewCenter, transitionDuration = 0 } = appCtx.state;\r\n\r\n        centerRef.current = viewCenter;\r\n\r\n        groupsRef.current = helpers.getWaterdropGroups(\r\n          appCtx.activeWaterdrops,\r\n          appCtx.waterdrops,\r\n          viewCenter\r\n        );\r\n\r\n        helpers.updateDropsSVG(\r\n          container,\r\n          groupsRef.current,\r\n          transitionDuration / 5,\r\n          {\r\n            onHover: (d) => {\r\n              setActiveMinidrop({ key: d.key });\r\n            },\r\n          }\r\n        );\r\n\r\n        hideElems(\".large-gray-text\", container);\r\n\r\n        setTimeout(() => {\r\n          setActiveMinidrop({ key: groupsRef.current.groups[0].nodes[0].key });\r\n          showElems(\r\n            \"#member-variable, #member-label, .large-gray-text\",\r\n            container\r\n          );\r\n          showElems(\".comp-settings\", d3, \"flex\");\r\n        }, transitionDuration + 500);\r\n\r\n        appCtx.setGoBack(() => () => {\r\n          const transitionDuration = appCtx.resetCamera();\r\n\r\n          appCtx.setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(appCtx.camera.curTransform);\r\n\r\n        return function exitState() {\r\n          removeElems(\".large-drop, .circlet, .comp-line\", container);\r\n\r\n          hideElems(\"#member-variable, #member-label\", container);\r\n          hideElems(\".comp-settings\");\r\n\r\n          setPanels([]);\r\n          appCtx.setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines, nodes] = helpers.calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop.key\r\n        );\r\n\r\n        setPanels(makePanelsFromNodes(nodes));\r\n        helpers.updateLabelSVG(\r\n          avgCoords(positions),\r\n          activeMinidrop.key.slice(4),\r\n          getScreenDropHeight()\r\n        );\r\n        helpers.updateScenIndicatorsSVG(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#compare-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop-group\", container);\r\n        showElems(\".large-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return objectivesData.KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      helpers.updateColorDrops(\r\n        container,\r\n        groupsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop-group\", container);\r\n      hideElems(\".large-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function makePanelsFromNodes(nodes) {\r\n    return (p) => {\r\n      return nodes.map((n, i) => {\r\n        let ox = 0,\r\n          oy = 0;\r\n\r\n        if (p[i]) {\r\n          ox = p[i].offsetX;\r\n          oy = p[i].offsetY;\r\n        }\r\n\r\n        const [x, y, isLeft] = getIdealGroupPos(\r\n          groupsRef.current.groupPositions[i],\r\n          centerRef.current\r\n        );\r\n\r\n        return {\r\n          text: n.key,\r\n          x,\r\n          y,\r\n          id: groupsRef.current.groups[i].key,\r\n          nodeID: n.id,\r\n          isLeft,\r\n          offsetX: ox,\r\n          offsetY: oy,\r\n        };\r\n      });\r\n    };\r\n  }\r\n\r\n  function getIdealGroupPos([x, y], [centerX, centerY]) {\r\n    let newX = x,\r\n      newY = y;\r\n\r\n    const correctionX = groupsRef.current.groups[0].height * 2;\r\n\r\n    if (newX < centerX) newX -= correctionX;\r\n    else newX += correctionX;\r\n\r\n    return [newX, newY, newX < centerX];\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {activeMinidrop && (\r\n        <SceneSettingStickers\r\n          settings={deserialize(activeMinidrop.key.slice(4))}\r\n          setColorSetting={setColorSetting}\r\n        />\r\n      )}\r\n      {panels.map(({ x, y, id, isLeft, offsetX, offsetY, nodeID }, i) => (\r\n        <div\r\n          className={\"panel compare-panel\" + (isLeft ? \" left\" : \"\")}\r\n          key={i}\r\n          style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n          onMouseDown={(e) => onPanelDragStart(e, { id })}\r\n        >\r\n          <DotHistogram\r\n            width={300}\r\n            height={200}\r\n            data={objectivesData.FLATTENED_DATA[nodeID].deliveries}\r\n            goal={appCtx.goals[id]}\r\n            setGoal={(newGoal) => {\r\n              appCtx.setGoals((g) => {\r\n                g[id] = newGoal;\r\n                return { ...g };\r\n              });\r\n            }}\r\n          />\r\n        </div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingSubcard from \"components/SceneSettingSubcard\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport {\r\n  generateTSpan,\r\n  hideElems,\r\n  removeElems,\r\n  showElems,\r\n} from \"utils/render-utils\";\r\nimport { deserialize } from \"utils/data-utils\";\r\nimport { clipEnds, dist } from \"utils/math-utils\";\r\nimport { radToDeg } from \"three/src/math/MathUtils\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\n\r\nimport { helpers } from \"./examineview-helpers\";\r\n\r\nexport default function ExamineView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const activeMinidropsRef = useRef([]);\r\n  const curMinidropsRef = useRef(null);\r\n\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, panelsRef, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n  const [hoveredCard, setHoveredCard] = useState(null);\r\n  const removePreviewRef = useRef(null);\r\n\r\n  useEffect(function initialize() {\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"examine-group\");\r\n\r\n    svgGroup.append(\"circle\").attr(\"class\", \"highlight-circle\");\r\n\r\n    svgGroup.append(\"path\").attr(\"class\", \"connect-line\");\r\n\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"instruction-text large-gray-text fancy-font\");\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"large-drop-label large-gray-text fancy-font\");\r\n\r\n    appCtx.addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"ExamineView\")) {\r\n        const { transitionDuration = 0 } = appCtx.state;\r\n        const container = d3.select(\"#examine-group\");\r\n        curMinidropsRef.current = appCtx.waterdrops.groups.find(\r\n          (g) => g.key === appCtx.activeWaterdrops[0]\r\n        );\r\n\r\n        helpers.updateSmallDropSVG(\r\n          container,\r\n          curMinidropsRef.current,\r\n          transitionDuration / 2,\r\n          {\r\n            onClick: updateActiveMinidrops,\r\n            onHover: hoverDrop,\r\n            onUnhover: unhoverDrop,\r\n          }\r\n        );\r\n\r\n        setTimeout(positionTexts, transitionDuration * 1.2);\r\n\r\n        appCtx.setGoBack(() => () => {\r\n          const transitionDuration = appCtx.resetCamera();\r\n\r\n          appCtx.setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(appCtx.camera.curTransform);\r\n        showElems(\"#examine-group\");\r\n\r\n        return function exitState() {\r\n          removeElems(\".small-drop, .circlet\", container);\r\n          hideElems(\"#examine-group\");\r\n          d3.selectAll(\r\n            \"#examine-group .instruction-text, #examine-group .large-drop-label\"\r\n          ).attr(\"opacity\", 0);\r\n\r\n          setPanels([]);\r\n          activeMinidropsRef.current = [];\r\n          curMinidropsRef.current = null;\r\n          appCtx.setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#examine-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop\", container);\r\n        showElems(\".small-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return objectivesData.KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      helpers.updateColorDrops(\r\n        container,\r\n        curMinidropsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop\", container);\r\n      hideElems(\".small-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function positionTexts() {\r\n    const instrFontSize =\r\n      (16 / appCtx.camera.height) *\r\n      appCtx.camera.getZFromFarHeight(\r\n        curMinidropsRef.current.height * settings.SPREAD_1_2 * 1.5\r\n      );\r\n\r\n    d3.select(\"#examine-group .instruction-text\")\r\n      .attr(\r\n        \"x\",\r\n        curMinidropsRef.current.x -\r\n          curMinidropsRef.current.height * settings.SPREAD_1_2 * 0.8\r\n      )\r\n      .attr(\"y\", curMinidropsRef.current.y - instrFontSize)\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", instrFontSize)\r\n      .call(\r\n        generateTSpan([\"click to show panels.\", \"you can drag panels.\"], 1.6)\r\n      )\r\n      .call((s) => {\r\n        s.transition().attr(\"opacity\", 1);\r\n      })\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * instrFontSize);\r\n      });\r\n\r\n    const labelFontSize =\r\n      (20 / appCtx.camera.height) *\r\n      appCtx.camera.getZFromFarHeight(\r\n        curMinidropsRef.current.height * settings.SPREAD_1_2 * 1.5\r\n      );\r\n\r\n    d3.select(\"#examine-group .large-drop-label\")\r\n      .attr(\"x\", curMinidropsRef.current.x)\r\n      .attr(\r\n        \"y\",\r\n        curMinidropsRef.current.y +\r\n          (curMinidropsRef.current.height / 2) * settings.SPREAD_1_2 * 0.9\r\n      )\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"font-size\", labelFontSize)\r\n      .call(\r\n        generateTSpan(\r\n          descriptionsData[appCtx.activeWaterdrops[0]].display_name ||\r\n            descriptionsData[appCtx.activeWaterdrops[0]].id,\r\n          1.2\r\n        )\r\n      )\r\n      .transition()\r\n      .attr(\"opacity\", 1);\r\n  }\r\n\r\n  function addDetailPanel(dropId, preview = false, forceReplace = false) {\r\n    const { x: groupX, y: groupY } = curMinidropsRef.current;\r\n    const { x, y, id, key } = appCtx.waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      if (p.findIndex(({ id: pid }) => id === pid) !== -1) {\r\n        if (!forceReplace) return p;\r\n\r\n        arrRemove(p, (_p) => _p.id === id);\r\n      }\r\n      const newPanel = {\r\n        text: key.slice(4),\r\n        x: groupX + x * settings.SPREAD_1_2,\r\n        y: groupY + y * settings.SPREAD_1_2,\r\n        offsetX: 20,\r\n        offsetY: 40,\r\n        id,\r\n        preview,\r\n        panelKey: preview ? -1 : dropId,\r\n      };\r\n\r\n      return [...p, newPanel];\r\n    });\r\n  }\r\n\r\n  function removeDetailPanel(dropId) {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ id }) => dropId === id);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function removePreviewPanel() {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ panelKey }) => panelKey === -1);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function updateActiveMinidrops(d) {\r\n    const container = d3.select(\"#examine-group\");\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      arrRemove(activeMinidropsRef.current, d.id);\r\n      container.select(`.circlet#i${d.id}`).classed(\"active\", false);\r\n      removeDetailPanel(d.id);\r\n      setHoveredCard(null);\r\n    } else {\r\n      removeDetailPanel(d.id);\r\n      activeMinidropsRef.current.push(d.id);\r\n      container.select(`.circlet#i${d.id}`).classed(\"active\", true);\r\n      addDetailPanel(d.id);\r\n      setHoveredCard(d.id);\r\n    }\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      d3.select(`.examine-panel#p${d.id}`).style(\"z-index\", 100);\r\n      setHoveredCard(d.id);\r\n    } else {\r\n      if (removePreviewRef.current) {\r\n        clearTimeout(removePreviewRef.current);\r\n        removePreviewPanel();\r\n      }\r\n      addDetailPanel(d.id, true);\r\n    }\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    if (!activeMinidropsRef.current.includes(d.id)) {\r\n      removePreviewRef.current = setTimeout(() => {\r\n        removeDetailPanel(d.id);\r\n        removePreviewRef.current = null;\r\n      }, 100);\r\n    }\r\n\r\n    setHoveredCard((hc) => (hc === d.id ? null : hc));\r\n    d3.select(`.examine-panel#p${d.id}`).style(\"z-index\", 0);\r\n  }\r\n\r\n  function drawLineConnect(id) {\r\n    if (panelsRef.current.findIndex(({ id: pid }) => id === pid) === -1) return;\r\n\r\n    const { x: circleX, y: circleY } = panelsRef.current.find(\r\n      (p) => p.id === id\r\n    );\r\n\r\n    const [cx, cy] = appCtx.camera.worldToScreen(circleX, circleY);\r\n\r\n    const panelBox = d3\r\n      .select(`.examine-panel#p${id}`)\r\n      .node()\r\n      .getBoundingClientRect();\r\n    const [px, py] = [\r\n      panelBox.left + panelBox.width / 2,\r\n      panelBox.top + panelBox.height / 2,\r\n    ];\r\n\r\n    const diffX = px - cx;\r\n    const diffY = py - cy;\r\n\r\n    let left, top;\r\n    const margin = 5;\r\n\r\n    if (Math.abs(diffX) > Math.abs(diffY)) {\r\n      top = 0;\r\n      left = (diffX < 0 ? 1 : -1) * (panelBox.width / 2 - margin);\r\n    } else {\r\n      left = 0;\r\n      top = (diffY < 0 ? 1 : -1) * (panelBox.height / 2 - margin);\r\n    }\r\n\r\n    const line = clipEnds(\r\n      [\r\n        [cx, cy],\r\n        [px + left, py + top],\r\n      ],\r\n      8,\r\n      0\r\n    );\r\n\r\n    return line;\r\n  }\r\n\r\n  if (isState(appCtx.state, \"ExamineView\")) {\r\n    return (\r\n      <>\r\n        {panels.map(\r\n          ({ text, x, y, id, offsetX, offsetY, panelKey, preview }) => (\r\n            <div\r\n              className={`panel examine-panel ${preview ? \"preview\" : \"\"}`}\r\n              id={`p${id}`}\r\n              key={preview ? -1 : id}\r\n              style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n              onMouseDown={(e) => !preview && onPanelDragStart(e, { id })}\r\n              onMouseEnter={() => !preview && hoverDrop({ id })}\r\n              onMouseLeave={() => !preview && unhoverDrop({ id })}\r\n            >\r\n              <div className=\"panel-tab\">\r\n                scenario <span>{text}</span>\r\n              </div>\r\n              <DotHistogram\r\n                width={300}\r\n                height={200}\r\n                data={objectivesData.FLATTENED_DATA[id].deliveries}\r\n                goal={appCtx.goals[appCtx.activeWaterdrops[0]]}\r\n                setGoal={(newGoal) => {\r\n                  appCtx.setGoals((g) => {\r\n                    g[appCtx.activeWaterdrops[0]] = newGoal;\r\n                    return { ...g };\r\n                  });\r\n                }}\r\n              />\r\n              <SceneSettingSubcard\r\n                settings={deserialize(text)}\r\n                setColorSetting={setColorSetting}\r\n              />\r\n            </div>\r\n          )\r\n        )}\r\n        {hoveredCard && (\r\n          <ConnectLine connectLine={drawLineConnect(hoveredCard)} />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nfunction ConnectLine({ connectLine }) {\r\n  return (\r\n    <div className=\"connect-line\" style={getConnectStyle(...connectLine)}>\r\n      <div className=\"connect-line-container\"></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getConnectStyle(from, to) {\r\n  const width = dist(from, to);\r\n  const rot = radToDeg(Math.atan2(to[1] - from[1], to[0] - from[0]));\r\n  return {\r\n    left: `${from[0]}px`,\r\n    top: `${from[1]}px`,\r\n    width: `${width}px`,\r\n    rotate: `${rot}deg`,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useLayoutEffect, useRef } from \"react\";\r\nimport { Scrollama, Step } from \"react-scrollama\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport { isState } from \"utils/misc-utils\";\r\n\r\nimport BucketGlyph from \"bucket-lib/BucketGlyph\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport WaterdropGlyph from \"components/WaterdropGlyph\";\r\n\r\nimport { hideElems } from \"utils/render-utils\";\r\nimport { constants } from \"utils/tutorialview-utils\";\r\nimport { useDataStory } from \"hooks/useDataStory\";\r\n\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { spatialData } from \"data/spatial-data\";\r\n\r\nexport default function TutorialView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const { hookAnimations, getSlidesInRange, storyVars } = useDataStory(appCtx);\r\n\r\n  useLayoutEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"TutorialView\")) {\r\n        hideElems(\r\n          \".bucket-wrapper, .vardrop, .var-scen-label, .vardrop .dot-histogram-wrapper, .main-histogram, .tut-comparer-graphics-wrapper\"\r\n        );\r\n\r\n        hookAnimations();\r\n\r\n        return function exitState() {\r\n          appCtx.resetCamera(false);\r\n          hideElems(\".tutorial-view\");\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  if (!isState(appCtx.state, \"TutorialView\")) return;\r\n\r\n  return (\r\n    <div className=\"tutorial-view\">\r\n      <div className=\"scrollama scrollama-locations\">\r\n        <Minimap />\r\n        <SkipBtn onClick={() => appCtx.setState({ state: \"WideView\" })} />\r\n        <DataStoryScrollama>\r\n          {getSlidesInRange(\"howMuchIntro\", \"soCal\").map((slide, i) => (\r\n            <Step key={i} data={slide}>\r\n              {slide.script}\r\n            </Step>\r\n          ))}\r\n        </DataStoryScrollama>\r\n      </div>\r\n      <div className=\"scrollama scrollama-create-buckets\">\r\n        <CompareBucketCreationsGraphics storyVars={storyVars} />\r\n        <DataStoryScrollama>\r\n          {getSlidesInRange(\"barsAppear\", \"overallIfWantReliable\").map(\r\n            (slide, i) => (\r\n              <Step key={i} data={slide}>\r\n                {slide.script}\r\n              </Step>\r\n            )\r\n          )}\r\n        </DataStoryScrollama>\r\n      </div>\r\n      <div className=\"scrollama scrollama-compare-scenobjs\">\r\n        <CompareScenariosGraphics storyVars={storyVars} />\r\n        <OtherBigDroplet />\r\n        <DataStoryScrollama>\r\n          {getSlidesInRange(\"forNowLetsFocus\", \"letsBringRefuge\").map(\r\n            (slide, i) => (\r\n              <Step key={i} data={slide}>\r\n                {slide.script}\r\n              </Step>\r\n            )\r\n          )}\r\n        </DataStoryScrollama>\r\n      </div>\r\n      <CallToExploreCard\r\n        onClick={() => appCtx.setState({ state: \"WideView\" })}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction DataStoryScrollama({ children }) {\r\n  const onStepEnter = async ({ data, direction, element }) => {\r\n    if (direction === \"up\") return;\r\n    data.animHandler?.do();\r\n    d3.select(element).transition().style(\"opacity\", 1);\r\n  };\r\n\r\n  const onStepExit = async ({ data, direction, element }) => {\r\n    if (direction === \"down\") return;\r\n    data.animHandler?.undo();\r\n    d3.select(element).transition().style(\"opacity\", 0.2);\r\n  };\r\n\r\n  return (\r\n    <Scrollama offset={0.8} onStepEnter={onStepEnter} onStepExit={onStepExit}>\r\n      {children}\r\n    </Scrollama>\r\n  );\r\n}\r\n\r\nfunction Minimap({}) {\r\n  useEffect(function initialize() {\r\n    const width = 400,\r\n      height = 500;\r\n\r\n    const drawnRegions = [constants.PAG_OBJECTIVE, constants.PRF_OBJECTIVE];\r\n\r\n    const minimap = d3\r\n      .select(\"#tut-minimap\")\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n\r\n    const proj = d3\r\n      .geoMercator()\r\n      .scale(2000)\r\n      .center(spatialData.CALIFORNIA_CENTER)\r\n      .translate([width / 2, height / 2]);\r\n\r\n    const lineGeom = [\r\n      ...spatialData.SPATIAL_DATA.features.filter((f) =>\r\n        drawnRegions.includes(f.properties.CalLiteID)\r\n      ),\r\n      spatialData.CALIFORNIA_OUTLINE,\r\n    ];\r\n\r\n    minimap\r\n      .selectAll(\"path\")\r\n      .data(lineGeom)\r\n      .join(\"path\")\r\n      .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\r\n      .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n      .attr(\"stroke\", (d) => (d.properties.CalLiteID ? \"transparent\" : \"gray\"))\r\n      .attr(\"stroke-width\", 1)\r\n      .style(\"transform-origin\", (d) => {\r\n        const [x, y] = proj(d.geometry.coordinates[0][0][0]);\r\n\r\n        return `${x}px ${y}px`;\r\n      })\r\n      .attr(\"fill\", \"transparent\");\r\n  }, []);\r\n\r\n  return <svg className=\"tut-minimap\" id=\"tut-minimap\"></svg>;\r\n}\r\n\r\nfunction SkipBtn({ onClick }) {\r\n  useEffect(function mountFadeOutEffect() {\r\n    const startPos = document.documentElement.scrollTop;\r\n    const buffer = 50;\r\n\r\n    window.addEventListener(\"scroll\", function () {\r\n      const curPos = document.documentElement.scrollTop;\r\n      const opac = Math.max(0, 1 - (curPos - startPos) / buffer);\r\n\r\n      d3.select(\".skip-btn\").style(\"opacity\", opac);\r\n    });\r\n  }, []);\r\n  return (\r\n    <button className=\"skip-btn\" onClick={onClick}>\r\n      Skip intro\r\n    </button>\r\n  );\r\n}\r\n\r\nfunction CallToExploreCard({ onClick }) {\r\n  return (\r\n    <div className=\"tut-text-card cte\">\r\n      Thus, tradeoffs must often be made when managing California's water\r\n      supply. What are the ways we can manage California's water, and how do\r\n      their outcomes compare? Go to the next step to find out!\r\n      <button className=\"fancy-font\" onClick={onClick}>\r\n        click to explore!\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CompareBucketCreationsGraphics({ storyVars }) {\r\n  return (\r\n    <div className=\"tut-graph-wrapper\">\r\n      <BucketCreationGraphics\r\n        id={\"pag-bar-graph\"}\r\n        label={descriptionsData[constants.PAG_OBJECTIVE]?.display_name}\r\n        bucketInterper={storyVars.bucketInterperPAG}\r\n      />\r\n      <BucketCreationGraphics\r\n        id={\"prf-bar-graph\"}\r\n        label={descriptionsData[constants.PRF_OBJECTIVE]?.display_name}\r\n        bucketInterper={storyVars.bucketInterperPRF}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CompareScenariosGraphics({ storyVars }) {\r\n  return (\r\n    <div className=\"tut-drop-graphics-wrapper\">\r\n      <MainWaterdropGraphics\r\n        objectiveLabel={descriptionsData[constants.PAG_OBJECTIVE]?.display_name}\r\n        dropInterper={storyVars.dropInterper}\r\n        histData={constants.PAG_DELIVS}\r\n        goal={storyVars.userGoal}\r\n        setGoal={(newGoal) => {\r\n          storyVars.setUserGoal(newGoal);\r\n        }}\r\n      />\r\n      <VariationWaterdropGraphics\r\n        variations={constants.DROP_VARIATIONS.map((variation) => ({\r\n          ...variation,\r\n          interper: storyVars.variationInterpers[variation.idx],\r\n          histData: constants.VARIATIONS_DELIVS[variation.idx],\r\n        }))}\r\n        goal={storyVars.userGoal}\r\n        setGoal={(newGoal) => {\r\n          storyVars.setUserGoal(newGoal);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction OtherBigDroplet() {\r\n  return (\r\n    <div className=\"tut-comparer-graphics-wrapper\">\r\n      <svg id=\"comparer-graphics\"></svg>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction MainWaterdropGraphics({\r\n  objectiveLabel,\r\n  dropInterper,\r\n  histData,\r\n  goal,\r\n  setGoal,\r\n}) {\r\n  return (\r\n    <>\r\n      <div className=\"main-waterdrop\">\r\n        <WaterdropGlyph\r\n          levelInterp={dropInterper}\r\n          width={400}\r\n          height={constants.BAR_CHART_HEIGHT}\r\n          colorInterp={constants.INTERP_COLOR}\r\n        />\r\n        <p className=\"var-scen-label\">\r\n          scenario <span className=\"scen-number\">{\"0000\"}</span>\r\n        </p>\r\n        <p className=\"fancy-font objective-label\">{objectiveLabel}</p>\r\n      </div>\r\n      <div className=\"main-histogram\">\r\n        <DotHistogram\r\n          width={210}\r\n          height={140}\r\n          data={histData}\r\n          goal={goal}\r\n          setGoal={setGoal}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction VariationWaterdropGraphics({ variations, goal, setGoal }) {\r\n  return variations.map(({ idx, scen, clas, desc, interper, histData }) => (\r\n    <div className={`vardrop ${clas}`} key={idx} desc={desc}>\r\n      <WaterdropGlyph\r\n        levelInterp={interper}\r\n        width={400}\r\n        height={(constants.BAR_CHART_HEIGHT * 2) / 3}\r\n        colorInterp={constants.INTERP_COLOR}\r\n      />\r\n      <p className=\"var-scen-label\">\r\n        scenario <span className=\"scen-number\">{scen}</span>\r\n      </p>\r\n      <DotHistogram\r\n        shortForm\r\n        width={210}\r\n        height={140}\r\n        data={histData}\r\n        goal={goal}\r\n        setGoal={setGoal}\r\n      />\r\n    </div>\r\n  ));\r\n}\r\n\r\nfunction BucketCreationGraphics({ id, bucketInterper, label }) {\r\n  return (\r\n    <div className=\"tut-graph\">\r\n      <svg id={id}></svg>\r\n      <BucketGlyph\r\n        levelInterp={bucketInterper}\r\n        width={300}\r\n        height={constants.BAR_CHART_HEIGHT}\r\n        colorInterp={constants.INTERP_COLOR}\r\n      />\r\n      <p className=\"fancy-font objective-label\">{label}</p>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { BiCross, BiNetworkChart } from \"react-icons/bi\";\r\nimport fuzzysort from \"fuzzysort\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { spatialData } from \"data/spatial-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { avgCoords, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport { generateTSpan, hideElems, showElems } from \"utils/render-utils\";\r\n\r\nimport { helpers } from \"./wideview-helpers\";\r\n\r\nexport default function WideView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const [curScreenTransform, setCurScreenTransform] = useState({\r\n    zoom: 1,\r\n    mouseX: 0,\r\n    mouseY: 0,\r\n  });\r\n\r\n  const [currentHoveredDrop, setCurrentHoveredDrop] = useState(null);\r\n  const [searchPrompt, setSearchPrompt] = useState(null);\r\n\r\n  const enableZoomRef = useRef(false);\r\n  const activeDropsRef = useRef([]);\r\n\r\n  useEffect(function initialize() {\r\n    if (!appCtx.waterdrops) return;\r\n\r\n    initSVGGraphics();\r\n\r\n    const cleanup = registerEventListeners();\r\n\r\n    helpers.drawMinimapSVG();\r\n\r\n    return cleanup;\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"WideView\")) {\r\n        const { transitionDuration = 0 } = appCtx.state;\r\n        d3.select(\"body\").style(\"overflow\", \"hidden\");\r\n\r\n        enableZoomRef.current = true;\r\n        setCurScreenTransform((cst) => ({\r\n          ...cst,\r\n          zoom: appCtx.camera.curTransform.k,\r\n        }));\r\n\r\n        drawTHREEGraphics();\r\n        drawSVGGraphics();\r\n\r\n        showElems(\"#infobox, #mosaic-webgl, #mosaic-svg, #wide-group\");\r\n\r\n        return function exitState() {\r\n          hideElems(\"#infobox, #wide-group\");\r\n\r\n          enableZoomRef.current = false;\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateFontSizes() {\r\n      if (enableZoomRef.current) {\r\n        d3.select(\"#wide-group\")\r\n          .selectAll(\".cloud-text\")\r\n          .each(\r\n            helpers.fontSizer(\r\n              curScreenTransform,\r\n              appCtx.camera,\r\n              appCtx.waterdrops.height\r\n            )\r\n          );\r\n      }\r\n    },\r\n    [curScreenTransform]\r\n  );\r\n\r\n  const handleClickExamine = useCallback(function () {\r\n    appCtx.setDisableCamAdjustments(true);\r\n\r\n    const { x, y, height } = activeDropsRef.current[0];\r\n\r\n    const newCamPos = [\r\n      x,\r\n      y - dropCenterCorrection({ height }),\r\n      appCtx.camera.getZFromFarHeight(height * settings.SPREAD_1_2 * 1.5),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = appCtx.zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        appCtx.setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    appCtx.setState({ state: \"ExamineView\", transitionDuration });\r\n\r\n    const startOpacity = appCtx.getOutlineOpacity(appCtx.camera.curTransform.k);\r\n    helpers.fadeOutDrops(\r\n      appCtx.dropsMesh,\r\n      appCtx.scene,\r\n      startOpacity,\r\n      transitionDuration / 2\r\n    );\r\n  }, []);\r\n\r\n  const handleClickCompare = useCallback(function () {\r\n    appCtx.setDisableCamAdjustments(true);\r\n\r\n    const dropsMidpoint = avgCoords(\r\n      activeDropsRef.current.map((w) => [w.x, w.y])\r\n    );\r\n\r\n    const newCamPos = [\r\n      ...dropsMidpoint,\r\n      appCtx.camera.getZFromFarHeight(\r\n        appCtx.waterdrops.groups[0].height * 2 * settings.SPREAD_1_2 * 0.75 * 2\r\n      ),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = appCtx.zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        appCtx.setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    appCtx.setState({\r\n      state: \"CompareView\",\r\n      transitionDuration,\r\n      viewCenter: dropsMidpoint,\r\n    });\r\n\r\n    const startOpacity = appCtx.getOutlineOpacity(appCtx.camera.curTransform.k);\r\n    helpers.fadeOutDrops(\r\n      appCtx.dropsMesh,\r\n      appCtx.scene,\r\n      startOpacity,\r\n      transitionDuration / 5\r\n    );\r\n  }, []);\r\n\r\n  const handleClickDeselectAll = useCallback(function () {\r\n    appCtx.setActiveWaterdrops([]);\r\n    activeDropsRef.current = [];\r\n    d3.selectAll(\"#wide-group .circlet\").classed(\"active\", false);\r\n  }, []);\r\n\r\n  function initSVGGraphics() {\r\n    hideElems(\"#infobox, #mosaic-webgl, #mosaic-svg\");\r\n\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"wide-group\");\r\n\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"instruction-text large-gray-text fancy-font\")\r\n      .attr(\"x\", 0 - appCtx.waterdrops.height * 0.6);\r\n  }\r\n\r\n  function registerEventListeners() {\r\n    const cameraListener = (transform) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        zoom: transform.k,\r\n      }));\r\n    };\r\n\r\n    const mouseListener = (e) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        mouseX: e.x,\r\n        mouseY: e.y,\r\n      }));\r\n    };\r\n\r\n    appCtx.addZoomHandler(cameraListener);\r\n    window.addEventListener(\"mousemove\", mouseListener);\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener(\"mousemove\", mouseListener);\r\n    };\r\n  }\r\n\r\n  function drawTHREEGraphics() {\r\n    console.time(\"drawing\");\r\n    appCtx.dropsMesh.draw(appCtx.scene);\r\n    console.timeEnd(\"drawing\");\r\n\r\n    appCtx.dropsMesh.updateVisibility(1);\r\n    appCtx.dropsMesh.updateOutlineVisibility(\r\n      appCtx.getOutlineOpacity(appCtx.camera.curTransform.k)\r\n    );\r\n  }\r\n\r\n  function drawSVGGraphics() {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    helpers.updateLargeDropSVG(container, appCtx.waterdrops, {\r\n      onClick: updateActiveDrops,\r\n      onHover: hoverDrop,\r\n      onUnhover: unhoverDrop,\r\n    });\r\n\r\n    for (const wd of activeDropsRef.current) {\r\n      container.select(`.circlet#b${wd.key}`).classed(\"active\", true);\r\n    }\r\n\r\n    const fontSize =\r\n      (20 / appCtx.camera.height) *\r\n      appCtx.camera.getZFromFarHeight(appCtx.waterdrops.height);\r\n    container\r\n      .select(\".instruction-text\")\r\n      .attr(\"y\", -fontSize * 5)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", fontSize)\r\n      .call(\r\n        generateTSpan(\r\n          [\"click to interact.\", \"scroll to zoom.\", \"drag to pan.\"],\r\n          2\r\n        )\r\n      )\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * fontSize);\r\n      });\r\n  }\r\n\r\n  function updateActiveDrops(d) {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    appCtx.setActiveWaterdrops((aw) => {\r\n      if (aw.includes(d.key)) {\r\n        aw = arrRemove(aw, d.key);\r\n        activeDropsRef.current = arrRemove(activeDropsRef.current, d);\r\n\r\n        container.select(`.circlet#b${d.key}`).classed(\"active\", false);\r\n      } else {\r\n        aw.push(d.key);\r\n        activeDropsRef.current.push(d);\r\n\r\n        container.select(`.circlet#b${d.key}`).classed(\"active\", true);\r\n      }\r\n      return [...aw];\r\n    });\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    setCurrentHoveredDrop({\r\n      id: d.key,\r\n      description: descriptionsData[d.key].desc,\r\n    });\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"gray\");\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    setCurrentHoveredDrop(null);\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"transparent\");\r\n  }\r\n\r\n  const searchResults = useMemo(() => {\r\n    if (searchPrompt === null) return [];\r\n\r\n    return fuzzysort.go(searchPrompt, appCtx.waterdrops.groups, {\r\n      keys: [\r\n        (obj) => descriptionsData[obj.key].id,\r\n        (obj) => descriptionsData[obj.key].display_name,\r\n        (obj) => descriptionsData[obj.key].desc,\r\n      ],\r\n      limit: 10,\r\n      all: true,\r\n    });\r\n  }, [searchPrompt, appCtx.waterdrops]);\r\n\r\n  return (\r\n    <>\r\n      <div id=\"infobox\">\r\n        <svg id=\"minimap\"></svg>\r\n        {currentHoveredDrop && (\r\n          <div className=\"details\">\r\n            {!spatialData.SPATIAL_FEATURES[currentHoveredDrop.id] && (\r\n              <p className=\"no-loc-data\">No Location Data</p>\r\n            )}\r\n            <p className=\"curDesc\">{currentHoveredDrop.description}</p>\r\n            <p className=\"curKey\">\r\n              id: <span> {currentHoveredDrop.id} </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n        {!currentHoveredDrop && (\r\n          <div className=\"searchbox\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"search\"\r\n              value={searchPrompt || \"\"}\r\n              onChange={(e) => setSearchPrompt(e.target.value)}\r\n              onFocus={() => {\r\n                setSearchPrompt(\"\");\r\n                d3.select(\".results\").style(\"display\", \"flex\");\r\n              }}\r\n              onBlur={() => {\r\n                setTimeout(() => {\r\n                  setSearchPrompt(null);\r\n                  d3.select(\".results\").style(\"display\", \"none\");\r\n                }, 100);\r\n              }}\r\n            ></input>\r\n            <div className=\"results\" style={{ display: \"none\" }}>\r\n              {searchResults.map(({ obj: wd }) => (\r\n                <button key={wd.key} onClick={() => updateActiveDrops(wd)}>\r\n                  {descriptionsData[wd.key].display_name ||\r\n                    descriptionsData[wd.key].id}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"action-btn-wrapper\">\r\n        <ActionButtons\r\n          appCtx={appCtx}\r\n          handleClickExamine={handleClickExamine}\r\n          handleClickDeselectAll={handleClickDeselectAll}\r\n          handleClickCompare={handleClickCompare}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction ActionButtons({\r\n  appCtx,\r\n  handleClickExamine,\r\n  handleClickDeselectAll,\r\n  handleClickCompare,\r\n}) {\r\n  let examineBtn, compareBtn;\r\n\r\n  if (isState(appCtx.state, \"WideView\") && appCtx.activeWaterdrops.length) {\r\n    if (appCtx.activeWaterdrops.length === 1) {\r\n      examineBtn = (\r\n        <button\r\n          onClick={handleClickExamine}\r\n          className=\"wide-view-action-btn fancy-font\"\r\n        >\r\n          <BiCross />\r\n          <span>examine</span>\r\n        </button>\r\n      );\r\n    } else {\r\n      compareBtn = (\r\n        <>\r\n          <button\r\n            onClick={handleClickDeselectAll}\r\n            className=\"fancy-font supplement-btn\"\r\n          >\r\n            <span>deselect all</span>\r\n          </button>\r\n          <button\r\n            onClick={handleClickCompare}\r\n            className=\"wide-view-action-btn fancy-font\"\r\n          >\r\n            <BiNetworkChart />\r\n            <span>compare</span>\r\n          </button>\r\n        </>\r\n      );\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {examineBtn}\r\n      {compareBtn}\r\n    </>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { settings } from \"settings\";\r\n\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { clipEnds, dropCenterCorrection } from \"utils/math-utils\";\r\nimport {\r\n  DROPLET_SHAPE,\r\n  generateTSpan,\r\n  circlet,\r\n  gradientInit,\r\n  gradientUpdate,\r\n} from \"utils/render-utils\";\r\n\r\nfunction largeDropInit({ nodes, height }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"large-drop\");\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"stroke\", \"none\")\r\n      .attr(\"fill\", \"yellow\")\r\n      .attr(\"r\", settings.LOD_1_RAD_PX * 2);\r\n\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * settings.SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"fancy-font large-gray-text\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate({ nodes, key, height }, transitionDelay) {\r\n  return (s) => {\r\n    const getStartDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x}, ${y}) rotate(${tilt})`;\r\n    const getEndDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x * settings.SPREAD_1_2}, ${\r\n        y * settings.SPREAD_1_2\r\n      }) rotate(${tilt})`;\r\n\r\n    const baselinePos = {};\r\n\r\n    s.call(textUpdate(key, height))\r\n      .selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\"transform\", getStartDropLoc)\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n      })\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"transform\", getEndDropLoc);\r\n\r\n    s.select(\".highlight-circle\")\r\n      .attr(\"cx\", baselinePos.x)\r\n      .attr(\r\n        \"cy\",\r\n\r\n        baselinePos.y - dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n      )\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"cx\", baselinePos.x * settings.SPREAD_1_2)\r\n      .attr(\r\n        \"cy\",\r\n\r\n        baselinePos.y * settings.SPREAD_1_2 -\r\n          dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n      );\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ levs, id }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const idStr = `compare-grad-${id}`;\r\n\r\n    s.call(gradientInit(levs, idStr));\r\n\r\n    s.append(\"path\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"class\", \"outline\")\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX * 0.95})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${idStr})`)\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX})`);\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction textUpdate(key, height) {\r\n  return (s) => {\r\n    s.select(\"text\")\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", (height / 2) * settings.SPREAD_1_2 * 0.9)\r\n      .call(\r\n        generateTSpan(\r\n          descriptionsData[key].display_name || descriptionsData[key].id\r\n        )\r\n      );\r\n  };\r\n}\r\n\r\nfunction updateDropsSVG(\r\n  container,\r\n  waterdropGroups,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartGroupLoc = ({ x, y, tilt }) =>\r\n    `translate(${x}, ${y}) rotate(${tilt})`;\r\n  const getEndGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`;\r\n\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(largeDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartGroupLoc)\r\n    .each(function (node) {\r\n      const drops = d3\r\n        .select(this)\r\n        .call(largeDropUpdate(node, transitionDelay))\r\n        .selectAll(\".small-drop\");\r\n\r\n      if (onClick) {\r\n        drops.on(\"click\", function (_, d) {\r\n          onClick(d);\r\n        });\r\n      }\r\n\r\n      if (onHover) {\r\n        drops.on(\"mouseenter\", function (_, d) {\r\n          d3.select(this.parentNode).raise();\r\n          onHover(d);\r\n        });\r\n      }\r\n\r\n      if (onUnhover) {\r\n        drops.on(\"mouseleave\", function (_, d) {\r\n          onUnhover(d);\r\n        });\r\n      }\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndGroupLoc);\r\n}\r\n\r\nfunction updateColorDrops(container, waterdropGroups, opacFn, color) {\r\n  const getGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`;\r\n\r\n  container\r\n    .selectAll(\".color-drop-group\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function ({ nodes }) {\r\n        d3.select(this).call((s) => {\r\n          s.attr(\"class\", \"color-drop-group\")\r\n            .selectAll(\".color-drop\")\r\n            .data(nodes)\r\n            .join(\"circle\")\r\n            .attr(\"class\", \"color-drop\")\r\n            .attr(\"r\", settings.LOD_1_RAD_PX);\r\n        });\r\n      });\r\n    })\r\n    .attr(\"transform\", getGroupLoc)\r\n    .each(function () {\r\n      d3.select(this)\r\n        .selectAll(\".color-drop\")\r\n        .call((s) => {\r\n          s.attr(\"opacity\", ({ key }) => opacFn(key)).attr(\"fill\", color);\r\n        })\r\n        .attr(\"cx\", ({ x }) => x * settings.SPREAD_1_2)\r\n        .attr(\"cy\", ({ y }) => y * settings.SPREAD_1_2);\r\n    });\r\n}\r\n\r\nfunction getWaterdropGroups(keyArr, waterdrops, center) {\r\n  const groups = keyArr.map((k) => waterdrops.groups.find((g) => g.key === k));\r\n\r\n  const groupPositions = [];\r\n  const rad = groups[0].height * settings.SPREAD_1_2 * 0.75;\r\n\r\n  for (let i = 0, n = groups.length; i < n; i++) {\r\n    const angle = ((Math.PI * 2) / n) * (i - 0.5) - Math.PI / 2;\r\n    groupPositions.push([\r\n      center[0] + Math.cos(angle) * rad,\r\n      center[1] + Math.sin(angle) * rad,\r\n    ]);\r\n  }\r\n\r\n  return {\r\n    groups,\r\n    groupPositions,\r\n  };\r\n}\r\n\r\nfunction calcLinesAndPositions(groupsObj, activeMinidropKey) {\r\n  const positions = [];\r\n  const nodes = [];\r\n  for (let i = 0; i < groupsObj.groups.length; i++) {\r\n    const group = groupsObj.groups[i];\r\n    const groupPos = groupsObj.groupPositions[i];\r\n\r\n    const node = group.nodes.find((n) => n.key === activeMinidropKey);\r\n\r\n    nodes.push(node);\r\n\r\n    positions.push([\r\n      node.x * settings.SPREAD_1_2 + groupPos[0],\r\n      node.y * settings.SPREAD_1_2 +\r\n        groupPos[1] -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX }),\r\n    ]);\r\n  }\r\n\r\n  const lines = [];\r\n\r\n  for (let i = 0; i < positions.length; i++) {\r\n    const from = Array.from(positions[i]),\r\n      to = Array.from(positions[i + 1 == positions.length ? 0 : i + 1]);\r\n\r\n    clipEnds([from, to], settings.LOD_1_RAD_PX * 2);\r\n\r\n    lines.push([from, to]);\r\n  }\r\n\r\n  return [positions, lines, nodes];\r\n}\r\n\r\nfunction updateLabelSVG(pos, labelText, normedTextSize) {\r\n  const [textX, textY] = pos;\r\n\r\n  const smallTextSize = normedTextSize / 15;\r\n  const largeTextSize = normedTextSize / 10;\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-label\")\r\n    .text(\"scenario\")\r\n    .attr(\"font-size\", smallTextSize)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-variable\")\r\n    .attr(\"font-size\", largeTextSize)\r\n    .text(labelText)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY);\r\n}\r\n\r\nfunction updateScenIndicatorsSVG(positions, lines) {\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".circlet\")\r\n    .data(positions)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"circlet\")\r\n    .call(circlet)\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX * 1.5)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"cx\", (d) => d[0])\r\n    .attr(\"cy\", (d) => d[1]);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".comp-line\")\r\n    .data(lines)\r\n    .join(\"path\")\r\n    .attr(\"class\", \"comp-line\")\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"d\", (d) => d3.line()(d));\r\n}\r\n\r\nexport const helpers = {\r\n  updateDropsSVG,\r\n  updateColorDrops,\r\n  getWaterdropGroups,\r\n  calcLinesAndPositions,\r\n  updateLabelSVG,\r\n  updateScenIndicatorsSVG,\r\n};\r\n","import * as d3 from \"d3\";\r\n\r\nimport { settings } from \"settings\";\r\n\r\nimport { dropCenterCorrection } from \"utils/math-utils\";\r\nimport {\r\n  DROPLET_SHAPE,\r\n  circlet,\r\n  gradientInit,\r\n  gradientUpdate,\r\n} from \"utils/render-utils\";\r\n\r\nfunction smallDropInit({ levs, id }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"small-drop hover-capture\");\r\n\r\n    const idStr = `drop-fill-${id}`;\r\n\r\n    s.call(gradientInit(levs, idStr));\r\n\r\n    s.append(\"path\").attr(\"d\", DROPLET_SHAPE).attr(\"class\", \"outline\");\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${idStr})`);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"circlet interactive\")\r\n      .call(circlet)\r\n      .attr(\"cy\", -dropCenterCorrection({ rad: 1 }))\r\n      .attr(\"r\", 1.5);\r\n\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, id, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n    s.select(\".outline\").attr(\r\n      \"transform\",\r\n      `scale(${settings.LOD_1_RAD_PX * 0.95})`\r\n    );\r\n    s.select(\".fill\").attr(\"transform\", `scale(${settings.LOD_1_RAD_PX})`);\r\n\r\n    s.select(\".circlet\").attr(\"id\", `i${id}`);\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction updateSmallDropSVG(\r\n  container,\r\n  waterdropGroup,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartLoc = ({ globalX, globalY, globalTilt }) =>\r\n    `translate(${globalX}, ${globalY}) rotate(${globalTilt})`;\r\n  const getEndLoc = ({ x, y, tilt }) =>\r\n    `translate(${waterdropGroup.x + x * settings.SPREAD_1_2}, ${\r\n      waterdropGroup.y + y * settings.SPREAD_1_2\r\n    }) rotate(${tilt})`;\r\n\r\n  const baselinePos = {};\r\n\r\n  const drops = container\r\n    .selectAll(\".small-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartLoc)\r\n    .each(function (node) {\r\n      d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n    });\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n\r\n  drops\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndLoc);\r\n\r\n  container\r\n    .select(\".highlight-circle\")\r\n    .attr(\"stroke\", \"none\")\r\n    .attr(\"fill\", \"yellow\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX * 2)\r\n    .attr(\"cx\", waterdropGroup.x + baselinePos.x)\r\n    .attr(\r\n      \"cy\",\r\n      waterdropGroup.y +\r\n        baselinePos.y -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n    )\r\n    .attr(\"cx\", waterdropGroup.x + baselinePos.x * settings.SPREAD_1_2)\r\n    .attr(\r\n      \"cy\",\r\n      waterdropGroup.y +\r\n        baselinePos.y * settings.SPREAD_1_2 -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n    );\r\n}\r\n\r\nfunction updateColorDrops(container, waterdropGroup, opacFn, color) {\r\n  container\r\n    .selectAll(\".color-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"color-drop\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX)\r\n    .attr(\"opacity\", ({ key }) => opacFn(key))\r\n    .attr(\"fill\", color)\r\n    .attr(\"cx\", ({ x }) => waterdropGroup.x + x * settings.SPREAD_1_2)\r\n    .attr(\"cy\", ({ y }) => waterdropGroup.y + y * settings.SPREAD_1_2);\r\n}\r\n\r\nexport const helpers = {\r\n  updateSmallDropSVG,\r\n  updateColorDrops,\r\n};\r\n","import * as d3 from \"d3\";\r\n\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { spatialData } from \"data/spatial-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { dist, dropCenterCorrection, getCenterDomRect } from \"utils/math-utils\";\r\nimport { wrap } from \"utils/misc-utils\";\r\nimport { circlet } from \"utils/render-utils\";\r\n\r\nfunction interactorsInit() {\r\n  const s = d3.select(this);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"hover-capture\")\r\n    .attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke-width\", 0)\r\n    .attr(\"r\", 0.8);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"circlet interactive\")\r\n    .call(circlet)\r\n    .attr(\"r\", 1);\r\n\r\n  const textGroup = s.append(\"g\").attr(\"pointer-events\", \"none\");\r\n  textGroup\r\n    .append(\"image\")\r\n    .attr(\"href\", \"glow.png\")\r\n    .attr(\"preserveAspectRatio\", \"none\")\r\n    .attr(\"opacity\", 0.8);\r\n  textGroup\r\n    .append(\"text\")\r\n    .attr(\"class\", \"fancy-font cloud-text\")\r\n    .attr(\"text-anchor\", \"middle\")\r\n    .attr(\"font-size\", 0);\r\n}\r\n\r\nfunction interactorsUpdate(d) {\r\n  d3.select(this).select(\".circlet\").attr(\"id\", `b${d.key}`);\r\n  d3.select(this).select(\"text\").call(textUpdate(d));\r\n}\r\n\r\nfunction textUpdate(d) {\r\n  return function (s) {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = wrap(\r\n      descriptionsData[d.key].display_name || descriptionsData[d.key].id\r\n    ).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      s.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", `${-lines.length / 2 + 0.5}em`)\r\n        .attr(\"dy\", `${i}em`)\r\n        .text(line);\r\n    });\r\n  };\r\n}\r\n\r\nfunction dropTransform({ x, y, height }) {\r\n  return `translate(${x}, ${y - dropCenterCorrection({ height })}) scale(${\r\n    height * settings.GROUP_HOVER_AREA_FACTOR\r\n  })`;\r\n}\r\n\r\nfunction getFontSize(d, transformZoom, cameraHeight, waterdropsHeight) {\r\n  const MAX_RAD = window.innerHeight / 9;\r\n\r\n  const zoomRel = cameraHeight / waterdropsHeight / transformZoom;\r\n\r\n  const absFontSize = (_d) =>\r\n    _d > MAX_RAD\r\n      ? 0\r\n      : d3.scaleLinear().domain([0, MAX_RAD]).range([1, 0.4]).clamp(true)(_d);\r\n\r\n  return absFontSize(d * zoomRel) * Math.min(zoomRel, 0.4);\r\n}\r\n\r\nfunction drawMinimapSVG() {\r\n  const width = 200,\r\n    height = 250;\r\n\r\n  const minimap = d3\r\n    .select(\"#minimap\")\r\n    .attr(\"width\", width)\r\n    .attr(\"height\", height);\r\n\r\n  const proj = d3\r\n    .geoMercator()\r\n    .scale(1000)\r\n    .center(spatialData.CALIFORNIA_CENTER)\r\n    .translate([width / 2, height / 2]);\r\n\r\n  const lineGeom = [\r\n    ...spatialData.SPATIAL_DATA.features.filter(\r\n      (f) => f.geometry.type === \"MultiPolygon\"\r\n    ),\r\n    spatialData.CALIFORNIA_OUTLINE,\r\n  ];\r\n  const pointGeom = spatialData.SPATIAL_DATA.features.filter(\r\n    (f) => f.geometry.type === \"MultiPoint\"\r\n  );\r\n\r\n  minimap\r\n    .selectAll(\"path\")\r\n    .data(lineGeom)\r\n    .join(\"path\")\r\n    .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"stroke\", (d) => (d.properties.CalLiteID ? \"transparent\" : \"gray\"))\r\n    .attr(\"stroke-width\", 1)\r\n    .attr(\"fill\", \"transparent\");\r\n\r\n  minimap\r\n    .selectAll(\"circle\")\r\n    .data(pointGeom)\r\n    .join(\"circle\")\r\n    .each(function (d) {\r\n      const s = d3.select(this);\r\n\r\n      const [x, y] = proj(d.geometry.coordinates[0]);\r\n\r\n      s.attr(\"cx\", x);\r\n      s.attr(\"cy\", y);\r\n    })\r\n    .attr(\"r\", 2)\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"fill\", \"transparent\");\r\n}\r\n\r\nfunction updateLargeDropSVG(\r\n  container,\r\n  waterdrops,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const drops = container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdrops.groups, ({ key }) => key)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(interactorsInit);\r\n    })\r\n    .each(interactorsUpdate)\r\n    .attr(\"transform\", dropTransform)\r\n    .select(\".hover-capture\");\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      d3.select(this.parentNode).raise();\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n}\r\n\r\nfunction fontSizer(transformInfo, camera, waterdropsHeight) {\r\n  return function () {\r\n    const tNode = d3.select(this).node();\r\n\r\n    const [posx, posy] = getCenterDomRect(tNode.getBoundingClientRect());\r\n\r\n    const width = ((tNode.getBBox().width * camera.height) / camera.far) * 8,\r\n      height = ((tNode.getBBox().height * camera.height) / camera.far) * 10;\r\n\r\n    const dis = dist(\r\n      [posx, posy],\r\n      [transformInfo.mouseX, transformInfo.mouseY]\r\n    );\r\n\r\n    d3.select(this).attr(\r\n      \"font-size\",\r\n      getFontSize(dis, transformInfo.zoom, camera.height, waterdropsHeight)\r\n    );\r\n\r\n    d3.select(this.parentNode.parentNode)\r\n      .select(\"image\")\r\n      .attr(\"x\", -width / 2)\r\n      .attr(\"y\", -height / 2)\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n  };\r\n}\r\n\r\nfunction fadeOutDrops(dropsMesh, scene, startOpac, duration) {\r\n  const t = d3.timer((elapsed) => {\r\n    const et = Math.min(1, elapsed / duration);\r\n\r\n    dropsMesh.updateVisibility(1 - et);\r\n    dropsMesh.updateOutlineVisibility(startOpac * (1 - et));\r\n\r\n    if (et >= 1) {\r\n      t.stop();\r\n      dropsMesh.remove(scene);\r\n    }\r\n  });\r\n}\r\n\r\nexport const helpers = {\r\n  drawMinimapSVG,\r\n  updateLargeDropSVG,\r\n  fontSizer,\r\n  fadeOutDrops,\r\n};\r\n"],"names":["App","appState","useAppState","_jsxs","AppContext","Provider","value","children","className","_jsx","id","TutorialView","WideView","ExamineView","CompareView","goBack","onClick","createContext","DEGREE_SWAY","LEVELS","LINE_WIDTH","BucketGlyph","_ref","levelInterp","colorInterp","interpolateWatercolorBlue","width","height","resolution","useId","svgSelector","useRef","liquidLevels","useMemo","ticksExact","map","d","prevLiquidLevels","usePrevious","innerWidth","innerHeight","useLayoutEffect","svgContainer","current","append","attr","concat","select","bucketPath","split","liquids","selectAll","data","join","_","i","transition","ease","d3","period","delay","duration","attrTween","diff","Math","abs","t","sin","min","PI","ref","e","getQuantileBins","domain","unitsPerQuantile","numQuantiles","length","histBins","thresholds","ceil","binnedQuantiles","quantileBins","quantiles","b","y","push","x1","x0","start","stop","count","filled","arguments","undefined","taper","bottomRight","bottomLeft","x","lineFunc","numericBins","maxQuantiles","bin","round","sum","Infinity","isEqualFunc","prev","NUM_CIRCLES","MARGIN","top","right","bottom","left","DOMAIN","objectivesData","MAX_DELIVS","WATERDROP_ICON","draw","context","size","moveTo","lineTo","arc","SQRT2","closePath","DotHistogram","goal","setGoal","shortForm","razorID","floor","random","razorAreaID","circles","dataRange","range","filter","useEffect","style","call","scale","tickFormat","s","text","razor","document","querySelector","transform","clamp","ignoreFn","preventDefault","dragging","addEventListener","window","removeEventListener","target","max","offsetX","svgCircles","enter","SceneSettingStickers","settings","setColorSetting","v","onMouseEnter","onMouseLeave","SETT_NAME_FULL","SETT_VAL_STEPS","j","opacity","SceneSettingSubcard","SETT_NAME_SHORT","WaterdropGlyph","_ref2","dropD","points","waterdropDeltaOutline","dropPath","DROP_RAD","DROP_HEIGHT","async","initDescriptionsData","objs","fetch","json","console","log","mapBy","descriptionsData","SCEN_DIVISOR","initObjectivesData","SCENARIO_KEY_STRING","DELIV_KEY_STRING","OBJECTIVES_DATA","obj","scen","shuffle","unord","sort","a","name","OBJECTIVE_IDS","Object","keys","OBJECTIVE_GOALS_MAP","goalMap","SCENARIO_IDS","values","KEY_SETTINGS_MAP","optArr","SETT_NUM_OPTS","key","deserialize","slice","FLATTENED_DATA","DATA_GROUPINGS","flattenedData","dataGroupings","objective","scenario","means","idx","deliveries","orderedDataGroupings","criteria","objScens","ids","sortedObjScens","sorted","mean","flat","IDtoRank","rank","initSpatialData","SPATIAL_DATA","SPATIAL_FEATURES","features","properties","CalLiteID","CALIFORNIA_OUTLINE","CALIFORNIA_CENTER","spatialData","appWidth","appHeight","state","setState","useState","activeWaterdrops","setActiveWaterdrops","setGoBack","goals","setGoals","zoomCallbacksRef","disableCamAdjustmentsRef","threeResources","renderer","setSize","time","dropsMesh","createMesh","waterdrops","timeEnd","appendChild","domElement","outlineOpacity","groups","camera","create","webglElement","node","svgElement","zoomFn","updateOutlineVisibility","k","cb","setAnimationLoop","render","scene","getOutlineOpacity","useCallback","val","resetCamera","animated","callback","farHeight","pos","getZFromFarHeight","transitionDuration","dur","zoomTo","callZoomFromWorldViewport","worldX","worldY","worldPos","interpolateZoomCamera","elapsed","et","callZoom","addZoomHandler","setDisableCamAdjustments","disable","useCompareLargeDrops","activeMinidrop","setActiveMinidrop","groupsRef","camCentersRef","positions","lines","compareViewHelpers","calcLinesAndPositions","textX","textY","smallTextSize","SPREAD_1_2","largeTextSize","updateLabel","avgCoords","circlet","LOD_1_RAD_PX","updateScenIndicators","initComparer","getWaterdropGroups","constants","PAG_OBJECTIVE","PRF_OBJECTIVE","camMidpoint","groupPositions","camFirstDrop","firstDrop","midpoint","container","translate","indicatorGroup","updateDropsSVG","onHover","DEFAULT_SCENARIO","hideElems","introDrop2","showElems","exitDrop2","useDataStory","appCtx","slides","setSlides","storyVars","useDataStoryVars","largeDropComparer","hookAnimations","deps","showLocationAnimGroup","anims","initShowLocationAnimGroup","chartAnimGroup","initChartAnimGroup","bucketsFillAnim","initBucketsFillAnim","dropFillAnim","initDropFillAnim","changeRealityAnim","initChangeRealityAnim","fillVarDropsAnim","initFillVarDropsAnim","showScenLabelAnim","initShowScenLabelAnim","highlightBestAnim","initHighlightBestAnim","showQuantilesAnim","initShowQuantilesAnim","comparerAnimGroup","initComparerAnimGroup","_slides","animHandler","showPAG","showPRF","barsAppear","barsCondense","getSlidesInRange","from","to","idxFrom","idxTo","attachScripts","slide","script","scripts","userGoal","setUserGoal","bucketInterperPAG","setBucketInterperPAG","bucketInterperPRF","setBucketInterperPRF","dropInterper","setDropInterper","variationInterpers","setVariationInterpers","VARIATIONS","useDragPanels","viewTransform","panels","setPanels","panelsRef","useStateRef","mouseDownInfo","startX","deltaX","deltaY","startY","p","f","find","oldOffsetX","offsetY","oldOffsetY","onPanelDragStart","clientX","clientY","getPanelStyle","screenX","screenY","worldToScreen","LOD_1_LEVELS","LOD_1_MIN_LEV_VAL","LOD_1_SMALL_DROP_PAD_FACTOR","LOD_1_LARGE_DROP_PAD_FACTOR","LOD_2_SMALL_DROP_PAD_FACTOR","GROUP_HOVER_AREA_FACTOR","SQRT1_2","WaterdropMesh","constructor","added","this","updateMeshes","initializeMeshes","add","outlineMesh","remove","dropsGeometry","MeshGeometry","MAX_POINTS_DROPS","outlinePoints","outlineMeshCoords","nodes","globalX","globalY","levs","maxLev","globalTilt","tilt","l1","l2","meshCoords","waterdropDelta","color","THREE","addMeshCoords","rotate","rotOutline","rotatePoints","copyCoords","dx","dy","finish","threeGeom","vertexColors","transparent","setFromPoints","opac","material","needsUpdate","updateVisibility","MAX_POINTS_OUTLINE","_finishCreate","_classPrivateFieldLooseKey","_THREEHandleZoom","Camera","fov","near","far","defineProperty","_THREEHandleZoom2","_finishCreate2","raycaster","_ref3","webglView","svgView","zoom","on","curTransform","_classPrivateFieldLooseBase","_ref4","_ref5","endx","endy","endz","position","getFarHeightFromZ","interper","tan","toRadians","z","getScaleFromZ","getZFromScale","scaleHeight","intersectObject","mouseX","mouseY","mesh","setFromCamera","screenToWorld","scaleExtent","set","numPoints","triangleIdx","setAttribute","Float32Array","positionAttribute","getAttribute","colorAttribute","v1","v2","v3","setXYZ","r","g","setDrawRange","background","antialias","initThreeResources","animations","do","undo","_pagX","_prfX","_pagXAxis","_prfXAxis","_pagDataDescending","_prfDataDescending","BAR_CHART_MARGIN","svgGroup","BAR_CHART_WIDTH","BAR_CHART_HEIGHT","dataDescending","yearlyData","placeFromLeft","year","padding","xaxis","tickSize","tickValues","prepareSVG","bandwidth","newWidth","bars","end","catch","then","PAG_INTERPER","PRF_INTERPER","PAG_INTERPER_DROP","classed","VARIATIONS_INTERPERS","_ref6","createInterpsFromDelivs","delivs","maxDelivs","calcDomLev","reverse","demand","carryover","priority","regs","minflow","scenStr","scenNum","parseInt","generateWaterdrop","rad","delta","outer","cos","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","placeDropsUsingPhysics","reuse","shape","bounds","Matter","minX","maxX","minY","maxY","genX","genY","contains","generateRandoPoints","WIDTH_AREA","AREA","sqrt","radsToDropWidth","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","nx","ny","circle","restitution","parts","quad","centre","vertices","isStatic","cage","setParts","setCentre","world","FPS","SECS","update","retVal","CIRC_RAD","percentToRatioFilled","dist","_ref7","_ref8","y1","x2","y2","distSq","getCenterDomRect","domRect","clipEnds","_ref9","shortenByStart","shortenByEnd","len","normed","dropCenterCorrection","_ref10","dropRadToDropHeight","c","rotatePoint","deg","vec","applyEuler","arr","newPoint","array","currentIndex","randomIndex","fn","newObjs","groupBy","_setState","stateRef","curVal","isState","stateInfo","stateName","wrap","replace","genUUID","arrRemove","item","findIndex","indexOf","splice","Array","DROPLET_SHAPE","CIRC_HEIGHT","HAT_START","yToHalfWidth","trigX","angle","acos","yToSpriteY","spriteYToY","sy","yStart","yEnd","subdivs","Y_DELTA","rightCoords","leftCoords","dx1","dy1","dx2","dy2","v4","elemStr","displayVal","removeElems","gradientInit","gradId","stops","forEach","gradientUpdate","each","valOffset","camTransform","generateTSpan","lineHeight","line","howMuchIntro","norCal","soCal","barsExplain","bucketsFill","comparingTheTwo","butTheAgGroup","overallIfWantReliable","marginBottom","forNowLetsFocus","darkerColsIndic","ifChangeReality","fortunateCanExplore","theseVarsCalled","atAGlance","tryMoveRed","collectAllScen","soWhyNot","letsBringRefuge","initConstants","INTERP_COLOR","PAG_DELIVS","PRF_DELIVS","VARIATIONS_DELIVS","vars","varDelivs","DROP_VARIATIONS","clas","desc","largeDropInit","smallDropInit","randId","parentNode","largeDropUpdate","display_name","smallDropUpdate","dropBBox","getBBox","waterdropGroups","group","groupPos","initWaterdrops","grouping","groupKeys","memberKeys","amtPerGroup","largeDropRad","smallDropRad","largeNodesPhys","largeNodesPos","smallNodesPhys","smallNodesPos","groupNodes","groupToNodes","nodeData","w","groupID","memberID","groupRank","memberRank","localTilt","parentTilt","rotatedX","rotatedY","domLev","groupKey","useContext","colorSetting","setCamTransform","centerRef","viewCenter","helpers","setTimeout","n","ox","oy","isLeft","centerX","centerY","newX","newY","correctionX","getIdealGroupPos","nodeID","makePanelsFromNodes","updateLabelSVG","updateScenIndicatorsSVG","updateColorDrops","_Fragment","onMouseDown","newGoal","activeMinidropsRef","curMinidropsRef","hoveredCard","setHoveredCard","removePreviewRef","positionTexts","instrFontSize","labelFontSize","addDetailPanel","dropId","preview","forceReplace","groupX","groupY","pid","_p","newPanel","panelKey","removeDetailPanel","updateActiveMinidrops","includes","hoverDrop","clearTimeout","unhoverDrop","hc","updateSmallDropSVG","onUnhover","ConnectLine","connectLine","circleX","circleY","cx","cy","panelBox","getBoundingClientRect","px","py","diffX","diffY","drawLineConnect","getConnectStyle","rot","radToDeg","atan2","Minimap","SkipBtn","DataStoryScrollama","Step","CompareBucketCreationsGraphics","CompareScenariosGraphics","OtherBigDroplet","CallToExploreCard","Scrollama","offset","onStepEnter","_data$animHandler","direction","element","onStepExit","_data$animHandler2","drawnRegions","minimap","proj","center","lineGeom","projection","geometry","coordinates","startPos","documentElement","scrollTop","curPos","_descriptionsData$con","_descriptionsData$con2","BucketCreationGraphics","label","bucketInterper","_descriptionsData$con3","MainWaterdropGraphics","objectiveLabel","histData","VariationWaterdropGraphics","variations","variation","_ref11","_ref12","curScreenTransform","setCurScreenTransform","currentHoveredDrop","setCurrentHoveredDrop","searchPrompt","setSearchPrompt","enableZoomRef","activeDropsRef","initSVGGraphics","cleanup","cameraListener","ti","mouseListener","registerEventListeners","drawMinimapSVG","cst","updateLargeDropSVG","updateActiveDrops","wd","fontSize","drawSVGGraphics","fontSizer","handleClickExamine","newCamPos","startZoom","startOpacity","fadeOutDrops","handleClickCompare","dropsMidpoint","handleClickDeselectAll","aw","description","searchResults","fuzzysort","limit","all","type","placeholder","onChange","onFocus","onBlur","display","ActionButtons","examineBtn","compareBtn","BiCross","BiNetworkChart","transitionDelay","baselinePos","textUpdate","idStr","drops","raise","getEndGroupLoc","opacFn","getGroupLoc","keyArr","groupsObj","activeMinidropKey","labelText","normedTextSize","waterdropGroup","interactorsInit","textGroup","interactorsUpdate","dropTransform","getFontSize","transformZoom","cameraHeight","waterdropsHeight","MAX_RAD","zoomRel","_d","pointGeom","transformInfo","tNode","posx","posy","dis","startOpac"],"sourceRoot":""}