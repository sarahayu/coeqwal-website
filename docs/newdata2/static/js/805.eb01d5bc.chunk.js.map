{"version":3,"file":"static/js/805.eb01d5bc.chunk.js","mappings":"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","sources":["App.jsx","AppContext.jsx","bucket-lib/quantile-histogram.js","bucket-lib/utils.js","components/DotHistogram.jsx","components/SceneSettingStickers.jsx","components/SceneSettingSubcard.jsx","data/descriptions-data.jsx","data/objectives-data.jsx","data/spatial-data.jsx","hooks/useAppState.jsx","hooks/useDragPanels.jsx","settings.jsx","utils/three-utils.jsx","three-resources.jsx","utils/data-utils.jsx","utils/math-utils.jsx","utils/misc-utils.jsx","utils/render-utils.jsx","utils/waterdrop-utils.jsx","views/CompareView.jsx","views/ExamineView.jsx","views/WideView.jsx","views/compareview-helpers.jsx","views/examineview-helpers.jsx","views/wideview-helpers.jsx"],"sourcesContent":["import React from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\n\r\nimport WideView from \"views/WideView\";\r\nimport ExamineView from \"views/ExamineView\";\r\n// import TutorialView from \"views/TutorialView\";\r\nimport CompareView from \"views/CompareView\";\r\n\r\nimport useAppState from \"hooks/useAppState\";\r\n\r\nexport default function App() {\r\n  const appState = useAppState();\r\n\r\n  return (\r\n    <AppContext.Provider value={appState}>\r\n      <div className=\"bubbles-wrapper\">\r\n        <div id=\"mosaic-webgl\"></div>\r\n        <svg id=\"mosaic-svg\">\r\n          <g className=\"svg-trans\"></g>\r\n        </svg>\r\n      </div>\r\n      {/* <TutorialView /> */}\r\n      <WideView />\r\n      <ExamineView />\r\n      <CompareView />\r\n      {appState.goBack && (\r\n        <button className=\"go-back-btn\" onClick={appState.goBack}>\r\n          ←\r\n        </button>\r\n      )}\r\n    </AppContext.Provider>\r\n  );\r\n}\r\n","import { createContext } from \"react\";\r\n\r\nexport const AppContext = createContext({});\r\n","import * as d3 from \"d3\";\r\nimport { quantileBins, ticksExact } from \"./utils\";\r\n\r\nexport function getQuantileBins(data, domain, unitsPerQuantile, width, height) {\r\n  const numQuantiles = data.length / unitsPerQuantile;\r\n  let histBins = d3\r\n    .histogram()\r\n    .value((d) => d)\r\n    .domain(domain)\r\n    .thresholds(\r\n      ticksExact(...domain, Math.ceil(width / (height / numQuantiles)))\r\n    )(data);\r\n\r\n  let binnedQuantiles = quantileBins(histBins, unitsPerQuantile, numQuantiles);\r\n\r\n  let quantiles = [];\r\n\r\n  for (let b = 0; b < binnedQuantiles.length; b++) {\r\n    for (let y = 0; y < binnedQuantiles[b]; y++) {\r\n      quantiles.push([\r\n        (histBins[b].x1 + histBins[b].x0) / 2,\r\n        ((y + 0.5) / numQuantiles) * data.length,\r\n      ]);\r\n    }\r\n  }\r\n\r\n  return quantiles;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\n// inclusive\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n\r\nexport const interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n","import * as d3 from \"d3\";\r\nimport { useEffect, useMemo, useRef } from \"react\";\r\nimport { getQuantileBins } from \"bucket-lib/quantile-histogram\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\n\r\nconst NUM_CIRCLES = 20;\r\nconst MARGIN = { top: 10, right: 10, bottom: 20, left: 10 };\r\n\r\nconst WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport default function DotHistogram({\r\n  data,\r\n  domain = [0, objectivesData.MAX_DELIVS],\r\n  goal,\r\n  setGoal,\r\n  width = 600,\r\n  height = 400,\r\n  shortForm = false,\r\n}) {\r\n  const { current: razorID } = useRef(Math.floor(Math.random() * 1e9));\r\n  const { current: razorAreaID } = useRef(Math.floor(Math.random() * 1e9));\r\n\r\n  const svgSelector = useRef();\r\n  const circles = useMemo(\r\n    () =>\r\n      getQuantileBins(data, domain, data.length / NUM_CIRCLES, width, height),\r\n    [data]\r\n  );\r\n\r\n  const dataRange = [0, data.length];\r\n  const x = d3.scaleLinear().domain(domain).range([0, width]);\r\n  const y = d3.scaleLinear().domain(dataRange).range([height, 0]);\r\n  const count = circles.filter((d) => d[0] > goal).length;\r\n\r\n  useEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width + MARGIN.left + MARGIN.right)\r\n      .attr(\"height\", height + MARGIN.top + MARGIN.bottom)\r\n      .style(\"pointer-events\", \"none\")\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"transform\", `translate(${MARGIN.left},${MARGIN.top})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(\r\n        d3\r\n          .axisBottom()\r\n          .scale(d3.scaleLinear().domain(domain).range([0, width]))\r\n          .tickFormat(d3.format(\".2s\"))\r\n      )\r\n      .call((s) => {\r\n        s.selectAll(\"line\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"path\").attr(\"stroke\", \"gray\");\r\n        s.selectAll(\"text\").attr(\"fill\", \"gray\");\r\n      })\r\n      .append(\"text\")\r\n      .attr(\"fill\", \"black\")\r\n      .attr(\"transform\", `translate(${width / 2}, ${30})`)\r\n      .text(\"Delivery (TAF)\");\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(domain)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n\r\n    const ignoreFn = (e) => e.preventDefault();\r\n    let dragging = false;\r\n\r\n    document.querySelector(`#i${razorID}`).addEventListener(\"mousedown\", () => {\r\n      dragging = true;\r\n      window.addEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document.addEventListener(\"mouseup\", () => {\r\n      dragging = false;\r\n      window.removeEventListener(\"selectstart\", ignoreFn);\r\n    });\r\n\r\n    document\r\n      .querySelector(`#i${razorAreaID}`)\r\n      .addEventListener(\"mousemove\", (e) => {\r\n        if (dragging && e.target.id === `i${razorAreaID}`) {\r\n          razor.style.transform = `translateX(${Math.min(\r\n            Math.max(e.offsetX, MARGIN.left),\r\n            MARGIN.left + width\r\n          )}px)\r\n            `;\r\n\r\n          setGoal(\r\n            d3\r\n              .scaleLinear()\r\n              .domain([MARGIN.left, width + MARGIN.left])\r\n              .range(domain)\r\n              .clamp(true)(e.offsetX)\r\n          );\r\n        }\r\n      });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const svgCircles = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".icons\")\r\n      .data(circles)\r\n      .join((enter) => enter.append(\"g\").call((s) => s.append(\"path\")))\r\n      .attr(\"class\", \"icons\")\r\n      .call((s) => {\r\n        s.selectAll(\"path\").attr(\r\n          \"d\",\r\n          d3.symbol(WATERDROP_ICON, height / NUM_CIRCLES)\r\n        );\r\n      });\r\n\r\n    svgCircles.attr(\"transform\", (d) => `translate(${x(d[0])},${y(d[1])})`);\r\n\r\n    svgCircles.attr(\"fill\", (d) => (d[0] > goal ? \"steelblue\" : \"black\"));\r\n\r\n    const razor = document.querySelector(`#i${razorID}`);\r\n    razor.style.transform = `translateX(${d3\r\n      .scaleLinear()\r\n      .domain(domain)\r\n      .range([MARGIN.left, width + MARGIN.left])\r\n      .clamp(true)(goal)}px)`;\r\n  }, [goal, circles]);\r\n\r\n  return (\r\n    <div\r\n      className={`dot-${razorAreaID} dot-histogram-wrapper`}\r\n      id={`i${razorAreaID}`}\r\n    >\r\n      <div\r\n        className={`pdf-razor ` + (shortForm ? \"short-form\" : \"\")}\r\n        id={`i${razorID}`}\r\n      >\r\n        <div>\r\n          <span>\r\n            <u>\r\n              {circles.length - count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL NOT meet demand\"}\r\n          </span>\r\n          <span>\r\n            <u>\r\n              {count} / {NUM_CIRCLES}\r\n            </u>{\" \"}\r\n            {shortForm ? \"\" : \"yrs WILL meet demand\"}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport { SETT_NAME_FULL, SETT_VAL_STEPS } from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingStickers({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings comp-settings\">\r\n      {settings.map((v, i) => (\r\n        <div\r\n          className=\"full-card\"\r\n          onMouseEnter={() => setColorSetting(i)}\r\n          onMouseLeave={() => setColorSetting(null)}\r\n          key={i}\r\n        >\r\n          <span>{SETT_NAME_FULL[i]}</span>\r\n          <span>{SETT_VAL_STEPS[i][v]}</span>\r\n          <div className=\"sett-dot-wrapper\">\r\n            {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n              <span\r\n                className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React from \"react\";\r\nimport {\r\n  SETT_NAME_SHORT,\r\n  SETT_NAME_FULL,\r\n  SETT_VAL_STEPS,\r\n} from \"utils/data-utils\";\r\n\r\nexport default function SceneSettingSubcard({ settings, setColorSetting }) {\r\n  return (\r\n    <div className=\"scen-settings\">\r\n      <div className=\"condense\">\r\n        {settings.map((v, i) => (\r\n          <div className=\"sett-dot-wrapper\" key={i}>\r\n            <span>{SETT_NAME_SHORT[i]}</span>\r\n            {d3.range(v + 1).map((j) => (\r\n              <span\r\n                className=\"sett-dot\"\r\n                key={j}\r\n                style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n              ></span>\r\n            ))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"full\">\r\n        <div className=\"full-container\">\r\n          <span>The settings for this scenario are:</span>\r\n          {settings.map((v, i) => (\r\n            <div\r\n              className=\"full-card\"\r\n              onMouseEnter={() => setColorSetting(i)}\r\n              onMouseLeave={() => setColorSetting(null)}\r\n              key={i}\r\n            >\r\n              <span>{SETT_NAME_FULL[i]}</span>\r\n              <span>{SETT_VAL_STEPS[i][v]}</span>\r\n              <div className=\"sett-dot-wrapper\">\r\n                {d3.range(SETT_VAL_STEPS[i].length).map((j) => (\r\n                  <span\r\n                    className={`sett-dot ${j <= v ? \"filled\" : \"not-filled\"}`}\r\n                    key={j}\r\n                    style={{ opacity: (j + 1) / SETT_VAL_STEPS[i].length }}\r\n                  ></span>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initDescriptionsData() {\r\n  const objs = await (await fetch(\"./descriptions.json\")).json();\r\n\r\n  console.log(\"DATA: loading descriptions data\");\r\n\r\n  return mapBy(objs, ({ id }) => id);\r\n}\r\n\r\nexport const descriptionsData = await initDescriptionsData();\r\n","import * as d3 from \"d3\";\r\nimport { SETT_NUM_OPTS, deserialize } from \"utils/data-utils\";\r\n\r\nimport { clamp, shuffle } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst SCEN_DIVISOR = 1; // debugging purposes, don't render all scenarios to speed things up\r\n\r\nasync function initObjectivesData() {\r\n  const MAX_DELIVS = 1200;\r\n  const SCENARIO_KEY_STRING = \"scens\";\r\n  const DELIV_KEY_STRING = \"delivs\";\r\n  const BASELINE_SCEN = \"expl0000\";\r\n\r\n  const OBJECTIVES_DATA = await (async function load() {\r\n    const objs = await (await fetch(\"./objectives.json\")).json();\r\n\r\n    for (const obj of objs) {\r\n      // shuffle so clusters of identical scenario results don't get processed deterministically\r\n      for (const scen of shuffle(obj[SCENARIO_KEY_STRING])) {\r\n        // data cleanup, clamping\r\n        const unord = scen[DELIV_KEY_STRING];\r\n        scen[DELIV_KEY_STRING] = unord.sort((a, b) => b - a);\r\n      }\r\n      obj[SCENARIO_KEY_STRING] = mapBy(\r\n        obj[SCENARIO_KEY_STRING],\r\n        ({ name }) => name\r\n      );\r\n    }\r\n\r\n    console.log(\"DATA: loading objectives data\");\r\n\r\n    return mapBy(objs, ({ obj }) => obj);\r\n  })();\r\n\r\n  const OBJECTIVE_IDS = [\r\n    \"DEL_NOD_AG_TOTAL\",\r\n    \"DEL_SJV_AG_TOTAL\",\r\n    \"DEL_NOD_MI_TOTAL\",\r\n    \"DEL_SJV_MI_TOTAL\",\r\n    \"DEL_SOCAL_MI_TOTAL\",\r\n    \"CVP_SWP_EXPORTS\",\r\n    \"NDO\",\r\n    \"SAC_IN\",\r\n    \"SJR_IN\",\r\n    \"STO_NOD_TOTAL\",\r\n    \"STO_SOD_TOTAL\",\r\n  ];\r\n\r\n  const OBJECTIVE_GOALS_MAP = (function initDefaults() {\r\n    const goalMap = {};\r\n    for (let i = 0; i < OBJECTIVE_IDS.length; i++)\r\n      goalMap[OBJECTIVE_IDS[i]] = 200;\r\n    return goalMap;\r\n  })();\r\n\r\n  const _SCENARIO_IDS = Object.keys(\r\n    Object.values(OBJECTIVES_DATA)[0][SCENARIO_KEY_STRING]\r\n  );\r\n\r\n  const SCENARIO_IDS = _SCENARIO_IDS.filter(\r\n    (s, i) => i % SCEN_DIVISOR === 0 || s === \"expl0000\"\r\n  );\r\n\r\n  const KEY_SETTINGS_MAP = (function preprocessData() {\r\n    const map = {};\r\n    const optArr = Object.values(SETT_NUM_OPTS);\r\n\r\n    for (let i = 0; i < SCENARIO_IDS.length; i++) {\r\n      const key = SCENARIO_IDS[i];\r\n\r\n      map[key] = deserialize(key.slice(4)).map((v, i) => (v + 1) / optArr[i]);\r\n    }\r\n\r\n    return map;\r\n  })();\r\n\r\n  const MIN_MAXES = (function () {\r\n    const minmaxes = {};\r\n\r\n    for (const objective of OBJECTIVE_IDS) {\r\n      const baselineMax = d3.max(\r\n        OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][BASELINE_SCEN][\r\n          DELIV_KEY_STRING\r\n        ]\r\n      );\r\n\r\n      const scenariosMin = d3.min(\r\n        SCENARIO_IDS.map((scenario) =>\r\n          d3.min(\r\n            OBJECTIVES_DATA[objective][SCENARIO_KEY_STRING][scenario][\r\n              DELIV_KEY_STRING\r\n            ]\r\n          )\r\n        )\r\n      );\r\n\r\n      minmaxes[objective] = [scenariosMin, baselineMax];\r\n    }\r\n\r\n    return minmaxes;\r\n  })();\r\n\r\n  // Flattening hierarchical data makes it more flexible for classifying\r\n  // (from experience). id conveniently corresponds to index.\r\n  // Also cache classifications (by objective and by scenario, for now)\r\n  const [FLATTENED_DATA, DATA_GROUPINGS] = (function preprocessData() {\r\n    const flattenedData = [];\r\n    const dataGroupings = {\r\n      objective: {},\r\n      scenario: {},\r\n    };\r\n\r\n    // for ordering later\r\n    const means = [];\r\n\r\n    let idx = 0;\r\n    for (const obj of OBJECTIVE_IDS) {\r\n      for (const scen of SCENARIO_IDS) {\r\n        if (!dataGroupings[\"objective\"][obj])\r\n          dataGroupings[\"objective\"][obj] = [];\r\n\r\n        if (!dataGroupings[\"scenario\"][scen])\r\n          dataGroupings[\"scenario\"][scen] = [];\r\n\r\n        dataGroupings[\"objective\"][obj].push(idx);\r\n        dataGroupings[\"scenario\"][scen].push(idx);\r\n\r\n        const deliveries =\r\n          OBJECTIVES_DATA[obj][SCENARIO_KEY_STRING][scen][DELIV_KEY_STRING];\r\n\r\n        flattenedData.push({\r\n          id: idx,\r\n          objective: obj,\r\n          scenario: scen,\r\n          deliveries,\r\n        });\r\n\r\n        means.push(d3.mean(deliveries));\r\n\r\n        idx++;\r\n      }\r\n    }\r\n\r\n    const orderedDataGroupings = {};\r\n\r\n    for (const criteria of Object.keys(dataGroupings)) {\r\n      const objScens = [];\r\n      for (const key of Object.keys(dataGroupings[criteria])) {\r\n        const ids = dataGroupings[criteria][key];\r\n        const sortedObjScens = ids.sort((a, b) => means[b] - means[a]);\r\n        objScens.push({\r\n          key,\r\n          sorted: sortedObjScens,\r\n          mean: d3.mean(ids.map((id) => flattenedData[id].deliveries).flat()),\r\n        });\r\n      }\r\n\r\n      const sortedObjScens = objScens.sort((a, b) => b.mean - a.mean);\r\n\r\n      orderedDataGroupings[criteria] = {};\r\n\r\n      for (let i = 0; i < sortedObjScens.length; i++) {\r\n        const { key, sorted } = sortedObjScens[i];\r\n        const IDtoRank = {};\r\n\r\n        for (let j = 0; j < sorted.length; j++) {\r\n          IDtoRank[sorted[j]] = j;\r\n        }\r\n        orderedDataGroupings[criteria][key] = IDtoRank;\r\n        orderedDataGroupings[criteria][key].rank = i;\r\n      }\r\n    }\r\n\r\n    return [flattenedData, orderedDataGroupings];\r\n  })();\r\n\r\n  return {\r\n    MAX_DELIVS,\r\n    SCENARIO_KEY_STRING,\r\n    DELIV_KEY_STRING,\r\n    BASELINE_SCEN,\r\n    OBJECTIVES_DATA,\r\n    OBJECTIVE_IDS,\r\n    OBJECTIVE_GOALS_MAP,\r\n    SCENARIO_IDS,\r\n    KEY_SETTINGS_MAP,\r\n    MIN_MAXES,\r\n    FLATTENED_DATA,\r\n    DATA_GROUPINGS,\r\n  };\r\n}\r\n\r\nexport const objectivesData = await initObjectivesData();\r\n","import { mapBy } from \"utils/misc-utils\";\r\n\r\nasync function initSpatialData() {\r\n  const SPATIAL_DATA = await (async function load() {\r\n    const objs = await (await fetch(\"./callite_spatial.json\")).json();\r\n\r\n    console.log(\"DATA: loading callite spatial data\");\r\n\r\n    return objs;\r\n  })();\r\n\r\n  const SPATIAL_FEATURES = (function () {\r\n    return mapBy(\r\n      SPATIAL_DATA.features,\r\n      ({ properties }) => properties.CalLiteID\r\n    );\r\n  })();\r\n\r\n  const CALIFORNIA_OUTLINE = await (async function load() {\r\n    const objs = await (await fetch(\"./california.json\")).json();\r\n\r\n    console.log(\"DATA: loading california spatial data\");\r\n\r\n    return objs;\r\n  })();\r\n\r\n  const CALIFORNIA_CENTER = [-119, 37.7749];\r\n\r\n  return {\r\n    SPATIAL_DATA,\r\n    SPATIAL_FEATURES,\r\n    CALIFORNIA_OUTLINE,\r\n    CALIFORNIA_CENTER,\r\n  };\r\n}\r\n\r\nexport const spatialData = await initSpatialData();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { threeResources } from \"three-resources\";\r\nimport { waterdrops } from \"utils/waterdrop-utils\";\r\n\r\nconst appWidth = window.innerWidth,\r\n  appHeight = window.innerHeight;\r\n\r\nexport default function useAppState() {\r\n  const [state, setState] = useState({});\r\n  const [activeWaterdrops, setActiveWaterdrops] = useState([]);\r\n  const [goBack, setGoBack] = useState(null);\r\n  const [goals, setGoals] = useState(objectivesData.OBJECTIVE_GOALS_MAP);\r\n\r\n  const zoomCallbacksRef = useRef([]);\r\n  const disableCamAdjustmentsRef = useRef(false);\r\n\r\n  useEffect(function initialize() {\r\n    threeResources.renderer.setSize(appWidth, appHeight);\r\n\r\n    console.time(\"drops mesh creating\");\r\n    threeResources.dropsMesh.createMesh(waterdrops);\r\n    console.timeEnd(\"drops mesh creating\");\r\n\r\n    document\r\n      .querySelector(\"#mosaic-webgl\")\r\n      .appendChild(threeResources.renderer.domElement);\r\n\r\n    d3.select(\"#mosaic-svg\").attr(\"width\", appWidth).attr(\"height\", appHeight);\r\n\r\n    const outlineOpacity = d3\r\n      .scaleLinear()\r\n      .domain([\r\n        appHeight / waterdrops.height,\r\n        appHeight / waterdrops.groups[0].height,\r\n      ])\r\n      .range([0.1, 1])\r\n      .clamp(true);\r\n\r\n    threeResources.camera.create({\r\n      width: appWidth,\r\n      height: appHeight,\r\n      webglElement: d3.select(\".bubbles-wrapper\").node(),\r\n      svgElement: d3.select(\"#mosaic-svg\").select(\".svg-trans\").node(),\r\n      zoomFn: (transform) => {\r\n        if (!disableCamAdjustmentsRef.current) {\r\n          threeResources.dropsMesh.updateOutlineVisibility(\r\n            outlineOpacity(transform.k)\r\n          );\r\n        }\r\n\r\n        for (const cb of zoomCallbacksRef.current) cb(transform);\r\n      },\r\n    });\r\n\r\n    threeResources.renderer.setAnimationLoop(() => {\r\n      threeResources.renderer.render(\r\n        threeResources.scene,\r\n        threeResources.camera.camera\r\n      );\r\n    });\r\n\r\n    resetCamera();\r\n\r\n    setState({ state: \"WideView\" });\r\n  }, []);\r\n\r\n  const getOutlineOpacity = useCallback(\r\n    (val) =>\r\n      d3\r\n        .scaleLinear()\r\n        .domain([\r\n          appHeight / waterdrops.height,\r\n          appHeight / waterdrops.groups[0].height,\r\n        ])\r\n        .range([0.1, 1])\r\n        .clamp(true)(val),\r\n    []\r\n  );\r\n\r\n  const resetCamera = useCallback(function (animated = true, callback) {\r\n    const farHeight = waterdrops.height * 1.2;\r\n    const pos = [\r\n      0,\r\n      -waterdrops.height * 0.08,\r\n      threeResources.camera.getZFromFarHeight(farHeight),\r\n    ];\r\n\r\n    let transitionDuration = 0;\r\n\r\n    if (animated) {\r\n      const [start, dur] = zoomTo(pos, callback);\r\n      transitionDuration = dur;\r\n\r\n      start();\r\n    } else {\r\n      threeResources.camera.callZoomFromWorldViewport({\r\n        worldX: pos[0],\r\n        worldY: -pos[1],\r\n        farHeight,\r\n      });\r\n      callback && callback();\r\n    }\r\n\r\n    return transitionDuration;\r\n  }, []);\r\n\r\n  const zoomTo = useCallback(function (worldPos, callback) {\r\n    const i = threeResources.camera.interpolateZoomCamera(worldPos);\r\n\r\n    const duration = i.duration / 2;\r\n\r\n    const start = () => {\r\n      const t = d3.timer((elapsed) => {\r\n        const et = Math.min(elapsed / duration, 1);\r\n        threeResources.camera.callZoom(i(et));\r\n\r\n        if (et === 1) {\r\n          t.stop();\r\n          callback && callback();\r\n        }\r\n      });\r\n    };\r\n\r\n    return [start, duration];\r\n  }, []);\r\n\r\n  const addZoomHandler = useCallback(function (cb) {\r\n    zoomCallbacksRef.current.push(cb);\r\n  }, []);\r\n\r\n  const setDisableCamAdjustments = useCallback(function (disable) {\r\n    disableCamAdjustmentsRef.current = disable;\r\n  });\r\n\r\n  return {\r\n    appWidth,\r\n    appHeight,\r\n    state,\r\n    setState,\r\n    activeWaterdrops,\r\n    setActiveWaterdrops,\r\n    setDisableCamAdjustments,\r\n    waterdrops,\r\n    goBack,\r\n    setGoBack,\r\n    zoomTo,\r\n    resetCamera,\r\n    getOutlineOpacity,\r\n    addZoomHandler,\r\n    goals,\r\n    setGoals,\r\n    ...threeResources,\r\n  };\r\n}\r\n","import { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { worldToScreen } from \"utils/render-utils\";\r\nimport { useStateRef } from \"utils/misc-utils\";\r\n\r\nexport function useDragPanels(viewTransform) {\r\n  const [panels, setPanels, panelsRef] = useStateRef([]);\r\n  const mouseDownInfo = useRef({});\r\n\r\n  useEffect(function initialize() {\r\n    window.addEventListener(\"mousemove\", (e) => {\r\n      if (mouseDownInfo.current.startX === undefined) return;\r\n\r\n      mouseDownInfo.current.deltaX = e.x - mouseDownInfo.current.startX;\r\n      mouseDownInfo.current.deltaY = e.y - mouseDownInfo.current.startY;\r\n\r\n      setPanels((p) => {\r\n        if (mouseDownInfo.current.startX === undefined) return p;\r\n\r\n        const f = p.find((v) => v.id === mouseDownInfo.current.id);\r\n        f.offsetX = f.oldOffsetX + mouseDownInfo.current.deltaX;\r\n        f.offsetY = f.oldOffsetY + mouseDownInfo.current.deltaY;\r\n\r\n        return [...p];\r\n      });\r\n    });\r\n\r\n    window.addEventListener(\"mouseup\", (e) => {\r\n      if (mouseDownInfo.current.startX !== undefined) {\r\n        mouseDownInfo.current = {};\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const onPanelDragStart = useCallback(function (e, { id }) {\r\n    if (e.target.className === \"\") return; // we're clicking the razor, disregard\r\n\r\n    e.preventDefault();\r\n\r\n    mouseDownInfo.current = { startX: e.clientX, startY: e.clientY, id };\r\n\r\n    setPanels((p) => {\r\n      const f = p.find((v) => v.id === id);\r\n\r\n      f.oldOffsetX = f.offsetX;\r\n      f.oldOffsetY = f.offsetY;\r\n\r\n      return [...p];\r\n    });\r\n  }, []);\r\n\r\n  function getPanelStyle({ x, y, offsetX, offsetY }) {\r\n    const [screenX, screenY] = worldToScreen(x, y, viewTransform);\r\n    return {\r\n      left: `${screenX + offsetX}px`,\r\n      top: `${screenY + offsetY}px`,\r\n    };\r\n  }\r\n\r\n  return {\r\n    panels,\r\n    panelsRef,\r\n    setPanels,\r\n    onPanelDragStart,\r\n    getPanelStyle,\r\n  };\r\n}\r\n","function initSettings() {\r\n  const LOD_1_LEVELS = 10;\r\n  const LOD_1_RAD_PX = 1;\r\n  const LOD_1_MIN_LEV_VAL = 0.1;\r\n  const LOD_1_SMALL_DROP_PAD_FACTOR = 2;\r\n  const LOD_1_LARGE_DROP_PAD_FACTOR = 1.2;\r\n\r\n  const LOD_2_SMALL_DROP_PAD_FACTOR = 3;\r\n\r\n  const GROUP_HOVER_AREA_FACTOR = 1.1 / (1 + Math.SQRT1_2);\r\n  const SPREAD_1_2 = LOD_2_SMALL_DROP_PAD_FACTOR / LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  return {\r\n    LOD_1_LEVELS,\r\n    LOD_1_RAD_PX,\r\n    LOD_1_MIN_LEV_VAL,\r\n    LOD_1_SMALL_DROP_PAD_FACTOR,\r\n    LOD_1_LARGE_DROP_PAD_FACTOR,\r\n    LOD_2_SMALL_DROP_PAD_FACTOR,\r\n    GROUP_HOVER_AREA_FACTOR,\r\n    SPREAD_1_2,\r\n  };\r\n}\r\n\r\nexport const settings = initSettings();\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport { settings } from \"settings\";\r\nimport { copyCoords, sortBy } from \"./misc-utils\";\r\nimport { rotatePoints, toRadians } from \"./math-utils\";\r\nimport {\r\n  waterdropDeltaOutline,\r\n  waterdropDelta,\r\n  worldToScreen,\r\n  screenToWorld,\r\n} from \"./render-utils\";\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return {\r\n    x: (mouseX / width) * 2 - 1,\r\n    y: -(mouseY / height) * 2 + 1,\r\n  };\r\n}\r\n\r\nexport class WaterdropMesh {\r\n  static MAX_POINTS_DROPS = 60 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n  static MAX_POINTS_OUTLINE = 40 * 130000; // approx num verts per droplet * approx num droplets on screen\r\n\r\n  dropsMesh;\r\n  outlineMesh;\r\n\r\n  added = false;\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.dropsMesh) {\r\n      this.initializeMeshes(waterdrops);\r\n    } else {\r\n      this.updateMeshes(waterdrops);\r\n    }\r\n  }\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.dropsMesh);\r\n      scene.add(this.outlineMesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.dropsMesh);\r\n      scene.remove(this.outlineMesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  // TODO optimize!\r\n  initializeMeshes(waterdrops) {\r\n    const dropsGeometry = new MeshGeometry(WaterdropMesh.MAX_POINTS_DROPS);\r\n    const outlinePoints = [];\r\n\r\n    const outlineMeshCoords = waterdropDeltaOutline(\r\n      0,\r\n      1,\r\n      settings.LOD_1_RAD_PX * 2 * 0.975\r\n    );\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const {\r\n        id,\r\n        globalX: x,\r\n        globalY: y,\r\n        levs,\r\n        maxLev,\r\n        globalTilt: tilt,\r\n      } = waterdrops.nodes[i];\r\n\r\n      for (let k = levs.length - 1; k >= 0; k--) {\r\n        const l1 = k !== levs.length - 1 ? levs[k + 1] : 0;\r\n        const l2 = levs[k];\r\n\r\n        const meshCoords = waterdropDelta(\r\n          l1 / maxLev,\r\n          l2 / maxLev,\r\n          settings.LOD_1_RAD_PX * 2\r\n        );\r\n        const color = new THREE.Color(\r\n          interpolateWatercolorBlue(k / settings.LOD_1_LEVELS)\r\n        );\r\n\r\n        dropsGeometry.addMeshCoords(\r\n          meshCoords,\r\n          { x: x, y: -y, rotate: tilt },\r\n          color,\r\n          (i % 5) / 50 + 0.02\r\n        );\r\n      }\r\n\r\n      const rotOutline = rotatePoints(copyCoords(outlineMeshCoords), tilt);\r\n\r\n      outlinePoints.push(\r\n        ...rotOutline.map(([dx, dy]) => {\r\n          return new THREE.Vector3(x + dx, -y - dy, (i % 5) / 50 + 0.01);\r\n        })\r\n      );\r\n    }\r\n\r\n    dropsGeometry.finish();\r\n\r\n    this.dropsMesh = new THREE.Mesh(\r\n      dropsGeometry.threeGeom,\r\n      new THREE.MeshBasicMaterial({\r\n        vertexColors: true,\r\n        transparent: true,\r\n        opacity: 1,\r\n      })\r\n    );\r\n\r\n    this.outlineMesh = new THREE.LineSegments(\r\n      new THREE.BufferGeometry().setFromPoints(outlinePoints),\r\n      new THREE.LineBasicMaterial({\r\n        color: 13421772,\r\n        transparent: true,\r\n        opacity: 0,\r\n      })\r\n    );\r\n  }\r\n\r\n  updateOutlineVisibility(opac) {\r\n    if (!this.outlineMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateVisibility(opac) {\r\n    if (!this.outlineMesh || !this.dropsMesh) return;\r\n    this.outlineMesh.material.opacity = opac;\r\n    this.outlineMesh.material.needsUpdate = true;\r\n    this.dropsMesh.material.opacity = opac;\r\n    this.dropsMesh.material.needsUpdate = true;\r\n  }\r\n\r\n  updateMeshes(waterdrops) {\r\n    // TODO fix\r\n  }\r\n}\r\n\r\nexport class WaterdropSimplifiedMesh {\r\n  mesh;\r\n  added = false;\r\n\r\n  vertToId = {};\r\n  idToVert = {};\r\n\r\n  draw(scene) {\r\n    if (!this.added) {\r\n      scene.add(this.mesh);\r\n      this.added = true;\r\n    }\r\n  }\r\n\r\n  remove(scene) {\r\n    if (this.added) {\r\n      scene.remove(this.mesh);\r\n      this.added = false;\r\n    }\r\n  }\r\n\r\n  createMesh(waterdrops) {\r\n    if (!this.mesh) {\r\n      this.initializeMesh(waterdrops);\r\n    }\r\n\r\n    this.updateMesh(waterdrops);\r\n\r\n    return this.mesh;\r\n  }\r\n\r\n  initializeMesh(waterdrops) {\r\n    const pointsGeometry = new THREE.BufferGeometry();\r\n\r\n    const vertices = [];\r\n    const colors = [];\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: x, globalY: y, levs, domLev } = waterdrops.nodes[i];\r\n\r\n      const color = domLev > 0 ? interpolateWatercolorBlue(domLev) : \"white\";\r\n\r\n      vertices.push(x, -y, 0);\r\n      const t_color = new THREE.Color(color);\r\n      colors.push(t_color.r, t_color.g, t_color.b);\r\n\r\n      this.vertToId[i] = id;\r\n      this.idToVert[id] = i;\r\n    }\r\n\r\n    const pointsMaterial = new THREE.PointsMaterial({\r\n      size: settings.LOD_1_RAD_PX * 2,\r\n      sizeAttenuation: true,\r\n      vertexColors: true,\r\n      map: new THREE.TextureLoader().load(\"drop.png\"),\r\n      transparent: true,\r\n    });\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(vertices), 3)\r\n    );\r\n\r\n    pointsGeometry.setAttribute(\r\n      \"color\",\r\n      new THREE.BufferAttribute(new Float32Array(colors), 3)\r\n    );\r\n\r\n    this.mesh = new THREE.Points(pointsGeometry, pointsMaterial);\r\n  }\r\n\r\n  updateMesh(waterdrops) {\r\n    const positionAttr = this.mesh.geometry.getAttribute(\"position\");\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id, globalX: newX, globalY: newY } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n      positionAttr.setXY(idx, newX, -newY);\r\n    }\r\n    positionAttr.needsUpdate = true;\r\n  }\r\n\r\n  updatePoints(waterdrops, translations, dt) {\r\n    const verts = this.mesh.geometry.vertices;\r\n\r\n    for (let i = 0; i < waterdrops.nodes.length; i++) {\r\n      const { id } = waterdrops.nodes[i];\r\n      const idx = this.idToVert[id];\r\n\r\n      const [dx, dy] = translations[id];\r\n\r\n      const x = verts[idx].x;\r\n      const y = verts[idx].y;\r\n\r\n      verts[idx].setX(x + dt * dx);\r\n      verts[idx].setY(y - dt * dy);\r\n    }\r\n\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n\r\n  intersectObject(camera, x, y) {\r\n    const intersects = camera.intersectObject(x, y, this.mesh);\r\n\r\n    if (intersects[0]) {\r\n      const intersect = sortBy(intersects, \"distanceToRay\")[0];\r\n      return this.vertToId[intersect.index];\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  webglView;\r\n  curTransform;\r\n\r\n  raycaster = new THREE.Raycaster();\r\n\r\n  svgView;\r\n\r\n  constructor({ fov, near, far }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n  }\r\n\r\n  create({ width, height, webglElement, svgElement, zoomFn }) {\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.webglView = d3.select(webglElement);\r\n    this.svgView = d3.select(svgElement);\r\n\r\n    this.zoom = d3.zoom().on(\"zoom\", (e) => {\r\n      this.curTransform = e.transform;\r\n\r\n      this.#THREEHandleZoom(e.transform);\r\n      this.svgView.attr(\"transform\", e.transform);\r\n\r\n      zoomFn && zoomFn(e.transform);\r\n    });\r\n\r\n    this.#finishCreate();\r\n  }\r\n\r\n  callZoom(transform) {\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity.translate(transform.x, transform.y).scale(transform.k)\r\n    );\r\n  }\r\n\r\n  callZoomFromWorldViewport({ worldX, worldY, farHeight }) {\r\n    const k = this.height / farHeight;\r\n\r\n    const x = -(worldX * k) + this.width / 2;\r\n    const y = worldY * k + this.height / 2;\r\n\r\n    this.callZoom({\r\n      x,\r\n      y,\r\n      k,\r\n    });\r\n  }\r\n\r\n  interpolateZoomCamera([endx, endy, endz]) {\r\n    const i = d3.interpolateZoom(\r\n      [\r\n        this.camera.position.x,\r\n        this.camera.position.y,\r\n        this.height / this.curTransform.k,\r\n      ],\r\n      [endx, -endy, this.getFarHeightFromZ(endz)]\r\n    );\r\n\r\n    const interper = (t) => {\r\n      const [worldX, worldY, farHeight] = i(t);\r\n\r\n      const k = this.height / farHeight;\r\n\r\n      const x = -(worldX * k) + this.width / 2;\r\n      const y = worldY * k + this.height / 2;\r\n\r\n      return {\r\n        x,\r\n        y,\r\n        k,\r\n      };\r\n    };\r\n\r\n    interper.duration = i.duration;\r\n\r\n    return interper;\r\n  }\r\n\r\n  getZFromFarHeight(farHeight) {\r\n    return (Math.tan(toRadians(90 - this.fov / 2)) * farHeight) / 2;\r\n  }\r\n\r\n  getFarHeightFromZ(z) {\r\n    return Math.tan(toRadians(this.fov) / 2) * z * 2;\r\n  }\r\n\r\n  getScaleFromZ(z) {\r\n    const farHeight = this.getFarHeightFromZ(z);\r\n    const scale = this.height / farHeight;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const scaleHeight = this.height / scale;\r\n    const z = this.getZFromFarHeight(scaleHeight);\r\n    return z;\r\n  }\r\n\r\n  intersectObject(mouseX, mouseY, mesh) {\r\n    this.raycaster.setFromCamera(\r\n      {\r\n        x: mouseX,\r\n        y: mouseY,\r\n      },\r\n      this.camera\r\n    );\r\n\r\n    return this.raycaster.intersectObject(mesh);\r\n  }\r\n\r\n  worldToScreen(x, y) {\r\n    return worldToScreen(x, y, this.curTransform);\r\n  }\r\n\r\n  screenToWorld(x, y) {\r\n    return screenToWorld(x, y, this.curTransform);\r\n  }\r\n\r\n  #finishCreate() {\r\n    this.zoom = this.zoom.scaleExtent([\r\n      this.getScaleFromZ(this.far),\r\n      this.getScaleFromZ(this.near),\r\n    ]);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      this.fov,\r\n      this.width / this.height,\r\n      this.near,\r\n      this.far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.webglView.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.webglView,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  #THREEHandleZoom(transform) {\r\n    const scale = transform.k;\r\n    const x = -(transform.x - this.width / 2) / scale;\r\n    const y = (transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n}\r\n\r\nclass MeshGeometry {\r\n  threeGeom = new THREE.BufferGeometry();\r\n  triangleIdx = 0;\r\n  positionAttribute;\r\n  colorAttribute;\r\n\r\n  constructor(numPoints, color = true) {\r\n    this.threeGeom.setAttribute(\r\n      \"position\",\r\n      new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n    );\r\n\r\n    if (color)\r\n      this.threeGeom.setAttribute(\r\n        \"color\",\r\n        new THREE.BufferAttribute(new Float32Array(numPoints * 3), 3)\r\n      );\r\n\r\n    this.positionAttribute = this.threeGeom.getAttribute(\"position\");\r\n    this.colorAttribute = this.threeGeom.getAttribute(\"color\");\r\n  }\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = rotatePoints(\r\n        copyCoords(meshCoords[j]),\r\n        transform.rotate\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 0,\r\n        transform.x + v1[0],\r\n        transform.y - v1[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 1,\r\n        transform.x + v2[0],\r\n        transform.y - v2[1],\r\n        z\r\n      );\r\n\r\n      this.positionAttribute.setXYZ(\r\n        this.triangleIdx * 3 + 2,\r\n        transform.x + v3[0],\r\n        transform.y - v3[1],\r\n        z\r\n      );\r\n\r\n      if (color) {\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 0,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 1,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n        this.colorAttribute.setXYZ(\r\n          this.triangleIdx * 3 + 2,\r\n          color.r,\r\n          color.g,\r\n          color.b\r\n        );\r\n      }\r\n\r\n      this.triangleIdx++;\r\n    }\r\n  }\r\n\r\n  finish() {\r\n    this.threeGeom.setDrawRange(0, this.triangleIdx * 3);\r\n  }\r\n}\r\n","import * as THREE from \"three\";\r\n\r\nimport { WaterdropMesh, Camera } from \"utils/three-utils\";\r\n\r\nfunction initThreeResources() {\r\n  const scene = (function getScene() {\r\n    const s = new THREE.Scene();\r\n    s.background = new THREE.Color(0xefefef);\r\n    return s;\r\n  })();\r\n\r\n  const dropsMesh = new WaterdropMesh();\r\n\r\n  const camera = new Camera({\r\n    fov: 45,\r\n    near: 1,\r\n    far: 3000,\r\n  });\r\n\r\n  const renderer = new THREE.WebGLRenderer({ antialias: true });\r\n\r\n  return { scene, camera, renderer, dropsMesh };\r\n}\r\n\r\nexport const threeResources = initThreeResources();\r\n","import * as d3 from \"d3\";\r\n\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\n\r\nexport function createInterps(obj_name, scen_name, data, maxDelivs) {\r\n  const delivs =\r\n    data[obj_name][objectivesData.SCENARIO_KEY_STRING][scen_name][\r\n      objectivesData.DELIV_KEY_STRING\r\n    ];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\nexport function createInterpsFromDelivs(delivs, minDelivs, maxDelivs) {\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(\r\n      delivs.map((v) => Math.min(1, (v - minDelivs) / (maxDelivs - minDelivs)))\r\n    )\r\n    .clamp(true);\r\n}\r\n\r\n// TODO fix colors\r\nexport function calcDomLev(levs) {\r\n  levs = [1, ...levs, 0];\r\n\r\n  let mean = 0;\r\n  for (let i = 0; i < levs.length - 1; i++) {\r\n    const dif = levs[i] - levs[i + 1];\r\n    mean += (dif * (i - 1)) / (levs.length + 4);\r\n  }\r\n\r\n  return mean;\r\n}\r\n\r\nexport const SETT_NAME_SHORT = [\"D\", \"C\", \"P\", \"R\", \"M\"];\r\nexport const SETT_NAME_FULL = [\r\n  \"Demand\",\r\n  \"Carryover\",\r\n  \"Priority\",\r\n  \"Regs.\",\r\n  \"Min. Flow\",\r\n];\r\nexport const SETT_VAL_STEPS = [\r\n  [1, 0.9, 0.8, 0.7, 0.6].reverse(), // demand\r\n  [1.0, 1.2, 1.3], // carryover\r\n  [0, 1], // priority\r\n  [1, 2, 3, 4], // regs\r\n  [0, 0.4, 0.6, 0.7, 0.8], // minflow\r\n];\r\n\r\nexport const SETT_NUM_OPTS = {\r\n  demand: SETT_VAL_STEPS[0].length,\r\n  carryover: SETT_VAL_STEPS[1].length,\r\n  priority: SETT_VAL_STEPS[2].length,\r\n  regs: SETT_VAL_STEPS[3].length,\r\n  minflow: SETT_VAL_STEPS[4].length,\r\n};\r\n\r\nexport function deserialize(scenStr) {\r\n  let scenNum = parseInt(scenStr);\r\n\r\n  const minflow = scenNum % SETT_NUM_OPTS.minflow;\r\n  scenNum = (scenNum - minflow) / SETT_NUM_OPTS.minflow;\r\n\r\n  const regs = scenNum % SETT_NUM_OPTS.regs;\r\n  scenNum = (scenNum - regs) / SETT_NUM_OPTS.regs;\r\n\r\n  const priority = scenNum % SETT_NUM_OPTS.priority;\r\n  scenNum = (scenNum - priority) / SETT_NUM_OPTS.priority;\r\n\r\n  const carryover = scenNum % SETT_NUM_OPTS.carryover;\r\n  scenNum = (scenNum - carryover) / SETT_NUM_OPTS.carryover;\r\n\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demand = scenNum % SETT_NUM_OPTS.demand;\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n\r\n  return [demandReverse, carryover, priority, regs, minflow];\r\n}\r\n\r\nexport function serialize(demand, carryover, priority, regs, minflow) {\r\n  // reverse demand values so that 0 is low demand and 4 is high demand\r\n  const demandReverse = SETT_NUM_OPTS.demand - 1 - demand;\r\n  let code = 0;\r\n  code += minflow;\r\n  code += SETT_NUM_OPTS.minflow * regs;\r\n  code += SETT_NUM_OPTS.regs * SETT_NUM_OPTS.minflow * priority;\r\n  code +=\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    carryover;\r\n  code +=\r\n    SETT_NUM_OPTS.carryover *\r\n    SETT_NUM_OPTS.priority *\r\n    SETT_NUM_OPTS.regs *\r\n    SETT_NUM_OPTS.minflow *\r\n    demandReverse;\r\n\r\n  const finalKey = `expl${d3.format(\"0>4\")(code)}`;\r\n\r\n  return finalKey;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport * as THREE from \"three\";\r\nimport Matter from \"matter-js\";\r\n\r\nimport { CIRC_RAD, DROP_HEIGHT } from \"./render-utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor((Math.sqrt(AREA / 3.14) * 2) / 2);\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes, reuse = false) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r));\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\nexport function percentToRatioFilled(p) {\r\n  p -= 0.0088;\r\n  return clamp(\r\n    (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326,\r\n    0,\r\n    1\r\n  );\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport function interp(x, a, b) {\r\n  return x * (b - a) + a;\r\n}\r\n\r\nexport function revInterp(t, a, b) {\r\n  return (t - a) / (b - a);\r\n}\r\n\r\nexport function distSq([x1, y1], [x2, y2]) {\r\n  return (x2 - x1) ** 2 + (y2 - y1) ** 2;\r\n}\r\n\r\nexport function dist([x1, y1], [x2, y2]) {\r\n  return Math.sqrt(distSq([x1, y1], [x2, y2]));\r\n}\r\n\r\nexport function getCenterDomRect(domRect) {\r\n  return [domRect.left + domRect.width / 2, domRect.top + domRect.height / 2];\r\n}\r\n\r\nexport function clipEnds([from, to], shortenByStart, shortenByEnd) {\r\n  const len = Math.sqrt((from[0] - to[0]) ** 2 + (from[1] - to[1]) ** 2);\r\n  const normed = [(to[0] - from[0]) / len, (to[1] - from[1]) / len];\r\n\r\n  if (shortenByEnd === undefined) shortenByEnd = shortenByStart;\r\n\r\n  from[0] += normed[0] * shortenByStart;\r\n  from[1] += normed[1] * shortenByStart;\r\n  to[0] -= normed[0] * shortenByEnd;\r\n  to[1] -= normed[1] * shortenByEnd;\r\n\r\n  return [from, to];\r\n}\r\n\r\nexport function dropRadToDropHeight(rad) {\r\n  return (1 + Math.SQRT2) * rad;\r\n}\r\n\r\nexport function dropCenterCorrection({ rad, height }) {\r\n  if (rad !== undefined) return dropRadToDropHeight(rad) * 0.08;\r\n  return height * 0.08;\r\n}\r\n\r\nexport function avgCoords(coords) {\r\n  return [d3.mean(coords, (c) => c[0]), d3.mean(coords, (c) => c[1])];\r\n}\r\n\r\nexport function rotatePoint(x, y, deg) {\r\n  const vec = new THREE.Vector3(x, y, 0).applyEuler(\r\n    new THREE.Euler(0, 0, toRadians(deg))\r\n  );\r\n  return [vec.x, vec.y];\r\n}\r\n\r\n// modifies arr!\r\nexport function rotatePoints(arr, deg) {\r\n  for (const a of arr) {\r\n    const newPoint = rotatePoint(a[0], a[1], deg);\r\n    a[0] = newPoint[0];\r\n    a[1] = newPoint[1];\r\n  }\r\n  return arr;\r\n}\r\n\r\n// https://stackoverflow.com/a/2450976\r\nexport function shuffle(array) {\r\n  let currentIndex = array.length;\r\n\r\n  // While there remain elements to shuffle...\r\n  while (currentIndex != 0) {\r\n    // Pick a remaining element...\r\n    let randomIndex = Math.floor(Math.random() * currentIndex);\r\n    currentIndex--;\r\n\r\n    // And swap it with the current element.\r\n    [array[currentIndex], array[randomIndex]] = [\r\n      array[randomIndex],\r\n      array[currentIndex],\r\n    ];\r\n  }\r\n\r\n  return array;\r\n}\r\n","// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    if (typeof v === \"function\")\r\n      _setState((curVal) => (stateRef.current = v(curVal)));\r\n    else _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n\r\nexport function isState(stateInfo, stateName) {\r\n  return stateInfo && stateInfo.state === stateName;\r\n}\r\n\r\nexport function wrap(s) {\r\n  return s.replace(/(?![^\\n]{1,15}$)([^\\n]{1,15})\\s/g, \"$1\\n\");\r\n}\r\n\r\nexport function genUUID() {\r\n  return Math.floor(Math.random() * 1e9);\r\n}\r\n\r\nexport function arrRemove(arr, item) {\r\n  let idx;\r\n  if (typeof item === \"function\") {\r\n    idx = arr.findIndex(item);\r\n  } else {\r\n    idx = arr.indexOf(item);\r\n  }\r\n  if (idx !== -1) arr.splice(idx, 1);\r\n  return arr;\r\n}\r\n\r\nexport function copyCoords(arr) {\r\n  return arr.map((a) => Array.from(a));\r\n}\r\n\r\n// https://www.geeksforgeeks.org/implement-search-box-with-debounce-in-javascript/\r\nexport const debounce = (fn, delay = 1000) => {\r\n  let timerId = null;\r\n  return (...args) => {\r\n    clearTimeout(timerId);\r\n    timerId = setTimeout(() => fn(...args), delay);\r\n  };\r\n};\r\n","import { interpolateWatercolorBlue } from \"bucket-lib/utils\";\r\nimport * as d3 from \"d3\";\r\nimport { settings } from \"settings\";\r\nimport { wrap } from \"./misc-utils\";\r\nimport { percentToRatioFilled } from \"./math-utils\";\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport const CIRC_RAD = Math.SQRT1_2;\r\nexport const DROP_RAD = 1;\r\nexport const CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nexport const DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = (CIRC_RAD + DROP_RAD / 2) / DROP_HEIGHT;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2, subdivs = 10) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 1 / subdivs;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function circlet(s) {\r\n  s.attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke\", \"orange\")\r\n    .attr(\"stroke-dasharray\", 3)\r\n    .attr(\"stroke-width\", 3)\r\n    .attr(\"vector-effect\", \"non-scaling-stroke\");\r\n}\r\n\r\nexport function showElems(elemStr, container, displayVal) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", displayVal || \"block\");\r\n}\r\n\r\nexport function hideElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).style(\"display\", \"none\");\r\n}\r\n\r\nexport function removeElems(elemStr, container) {\r\n  (container || d3).selectAll(elemStr).remove();\r\n}\r\n\r\nexport function gradientInit(levs, gradId) {\r\n  return (s) => {\r\n    const stops = s\r\n      .append(\"defs\")\r\n      .append(\"linearGradient\")\r\n      .attr(\"id\", gradId)\r\n      .attr(\"x1\", \"0%\")\r\n      .attr(\"x2\", \"0%\")\r\n      .attr(\"y1\", \"0%\")\r\n      .attr(\"y2\", \"100%\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n    stops.append(\"stop\").attr(\"stop-color\", \"transparent\");\r\n\r\n    levs.forEach((_, i) => {\r\n      for (let j = 0; j < 2; j++) {\r\n        stops\r\n          .append(\"stop\")\r\n          .attr(\r\n            \"stop-color\",\r\n            interpolateWatercolorBlue(i / settings.LOD_1_LEVELS)\r\n          );\r\n      }\r\n    });\r\n  };\r\n}\r\n\r\nexport function gradientUpdate(levs, maxLev) {\r\n  return (s) => {\r\n    s.selectAll(\"stop\").each(function (_, i) {\r\n      // first stop is at 0\r\n      if (i === 0) {\r\n        d3.select(this).attr(\"offset\", `0%`);\r\n        return;\r\n      }\r\n\r\n      // last stop is at 100\r\n      if (i === (levs.length + 1) * 2 - 1) {\r\n        d3.select(this).attr(\"offset\", `100%`);\r\n        return;\r\n      }\r\n\r\n      let valOffset = Math.floor((i - 1) / 2);\r\n\r\n      d3.select(this).attr(\r\n        \"offset\",\r\n        `${(1 - percentToRatioFilled(levs[valOffset] / maxLev)) * 100}%`\r\n      );\r\n    });\r\n  };\r\n}\r\n\r\nexport function worldToScreen(x, y, camTransform) {\r\n  return [\r\n    x * camTransform.k + camTransform.x,\r\n    y * camTransform.k + camTransform.y,\r\n  ];\r\n}\r\n\r\nexport function screenToWorld(x, y, camTransform) {\r\n  return [\r\n    (x - camTransform.x) / camTransform.k,\r\n    (y - camTransform.y) / camTransform.k,\r\n  ];\r\n}\r\n\r\nexport function generateTSpan(text, lineHeight = 1.2) {\r\n  return (s) => {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = typeof text === \"string\" ? wrap(text).split(\"\\n\") : text;\r\n\r\n    const x = s.attr(\"x\");\r\n\r\n    lines.forEach((line) => {\r\n      s.append(\"tspan\").attr(\"x\", x).attr(\"dy\", `${lineHeight}em`).text(line);\r\n    });\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { ticksExact } from \"bucket-lib/utils\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { objectivesData } from \"data/objectives-data\";\r\n\r\nimport { calcDomLev, createInterpsFromDelivs } from \"utils/data-utils\";\r\nimport { placeDropsUsingPhysics, rotatePoint } from \"utils/math-utils\";\r\nimport { mapBy } from \"utils/misc-utils\";\r\n\r\nconst BASELINE_SCENARIO = \"expl0000\";\r\n\r\n// TODO optimize!!\r\nfunction initWaterdrops(grouping) {\r\n  console.time(\"init waterdrops\");\r\n  const groupKeys =\r\n    grouping === \"objective\"\r\n      ? objectivesData.OBJECTIVE_IDS\r\n      : objectivesData.SCENARIO_IDS;\r\n  const memberKeys =\r\n    grouping === \"objective\"\r\n      ? objectivesData.SCENARIO_IDS\r\n      : objectivesData.OBJECTIVE_IDS;\r\n\r\n  const amtGroups = groupKeys.length;\r\n  const amtPerGroup = memberKeys.length;\r\n\r\n  const largeDropRad =\r\n    Math.sqrt(amtPerGroup / Math.PI) *\r\n    settings.LOD_1_RAD_PX *\r\n    2 *\r\n    settings.LOD_1_SMALL_DROP_PAD_FACTOR *\r\n    settings.LOD_1_LARGE_DROP_PAD_FACTOR;\r\n  const smallDropRad =\r\n    settings.LOD_1_RAD_PX * settings.LOD_1_SMALL_DROP_PAD_FACTOR;\r\n\r\n  const largeNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    groupKeys.map((p, idx) => ({\r\n      r: largeDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  for (let i = 0; i < largeNodesPhys.length; i++) {\r\n    largeNodesPhys[i].tilt = 0;\r\n  }\r\n\r\n  const largeNodesPos = mapBy(largeNodesPhys, ({ id }) => id);\r\n\r\n  const smallNodesPhys = placeDropsUsingPhysics(\r\n    0,\r\n    0,\r\n    memberKeys.map((s, idx) => ({\r\n      r: smallDropRad,\r\n      id: idx,\r\n    }))\r\n  );\r\n\r\n  const smallNodesPos = mapBy(smallNodesPhys, ({ id }) => id);\r\n\r\n  const nodes = [];\r\n  const groupNodes = [];\r\n\r\n  const groupToNodes = {};\r\n\r\n  let idx = 0;\r\n\r\n  for (const nodeData of objectivesData.FLATTENED_DATA) {\r\n    const { id, objective, scenario, deliveries } = nodeData;\r\n\r\n    const [delivMin, delivMax] = objectivesData.MIN_MAXES[objective];\r\n\r\n    const i = createInterpsFromDelivs(deliveries, delivMin, delivMax);\r\n    const wds = ticksExact(0, 1, settings.LOD_1_LEVELS + 1).map((d) => i(d));\r\n\r\n    const levs = wds.map(\r\n      (w, i) =>\r\n        Math.max(w, i == 0 ? settings.LOD_1_MIN_LEV_VAL : 0) *\r\n        settings.LOD_1_RAD_PX\r\n    );\r\n\r\n    const groupID = grouping === \"objective\" ? objective : scenario;\r\n    const memberID = grouping === \"objective\" ? scenario : objective;\r\n\r\n    const groupRank = objectivesData.DATA_GROUPINGS[grouping][groupID].rank;\r\n    const memberRank = objectivesData.DATA_GROUPINGS[grouping][groupID][id];\r\n\r\n    const localTilt = 0;\r\n    const parentTilt = largeNodesPos[groupRank].tilt;\r\n\r\n    const { x, y } = smallNodesPos[memberRank];\r\n    const [rotatedX, rotatedY] = rotatePoint(x, y, parentTilt);\r\n\r\n    const node = {\r\n      id,\r\n      levs,\r\n      maxLev: settings.LOD_1_RAD_PX,\r\n      domLev: calcDomLev(levs),\r\n      tilt: localTilt,\r\n      dur: Math.random() * 100 + 400,\r\n      x,\r\n      y,\r\n      group: groupID,\r\n      key: memberID,\r\n      globalX: largeNodesPos[groupRank].x + rotatedX,\r\n      globalY: largeNodesPos[groupRank].y + rotatedY,\r\n      globalTilt: parentTilt + localTilt,\r\n    };\r\n\r\n    nodes.push(node);\r\n\r\n    if (!groupToNodes[groupID]) groupToNodes[groupID] = [];\r\n\r\n    groupToNodes[groupID].push(node);\r\n  }\r\n\r\n  for (const groupKey of groupKeys) {\r\n    const { x, y, tilt } =\r\n      largeNodesPos[objectivesData.DATA_GROUPINGS[grouping][groupKey].rank];\r\n    groupNodes.push({\r\n      x,\r\n      y,\r\n      tilt,\r\n      key: groupKey,\r\n      height: smallNodesPhys.height,\r\n      nodes: groupToNodes[groupKey],\r\n    });\r\n  }\r\n\r\n  console.timeEnd(\"init waterdrops\");\r\n\r\n  return {\r\n    nodes: nodes,\r\n    groups: groupNodes,\r\n    height: largeNodesPhys.height,\r\n  };\r\n}\r\n\r\nexport const waterdrops = initWaterdrops(\"objective\");\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingStickers from \"components/SceneSettingStickers\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { avgCoords } from \"utils/math-utils\";\r\nimport { isState } from \"utils/misc-utils\";\r\nimport { hideElems, removeElems, showElems } from \"utils/render-utils\";\r\nimport { deserialize } from \"utils/data-utils\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\n\r\nimport { helpers } from \"./compareview-helpers\";\r\n\r\nexport default function CompareView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const [activeMinidrop, setActiveMinidrop] = useState();\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n\r\n  const groupsRef = useRef();\r\n  const centerRef = useRef();\r\n\r\n  const getScreenDropHeight = () =>\r\n    groupsRef.current.groups[0].height * settings.SPREAD_1_2;\r\n\r\n  useEffect(function initialize() {\r\n    const container = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"compare-group\");\r\n\r\n    container.append(\"text\").attr(\"id\", \"member-variable\");\r\n    container.append(\"text\").attr(\"id\", \"member-label\");\r\n\r\n    appCtx.addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"CompareView\")) {\r\n        const container = d3.select(\"#compare-group\");\r\n\r\n        const { viewCenter, transitionDuration = 0 } = appCtx.state;\r\n\r\n        centerRef.current = viewCenter;\r\n\r\n        groupsRef.current = helpers.getWaterdropGroups(\r\n          appCtx.activeWaterdrops,\r\n          appCtx.waterdrops,\r\n          viewCenter\r\n        );\r\n\r\n        helpers.updateDropsSVG(\r\n          container,\r\n          groupsRef.current,\r\n          transitionDuration / 5,\r\n          {\r\n            onHover: (d) => {\r\n              setActiveMinidrop({ key: d.key });\r\n            },\r\n          }\r\n        );\r\n\r\n        hideElems(\".large-gray-text\", container);\r\n\r\n        setTimeout(() => {\r\n          setActiveMinidrop({ key: groupsRef.current.groups[0].nodes[0].key });\r\n          showElems(\r\n            \"#member-variable, #member-label, .large-gray-text\",\r\n            container\r\n          );\r\n          showElems(\".comp-settings\", d3, \"flex\");\r\n        }, transitionDuration + 500);\r\n\r\n        appCtx.setGoBack(() => () => {\r\n          const transitionDuration = appCtx.resetCamera();\r\n\r\n          appCtx.setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(appCtx.camera.curTransform);\r\n\r\n        return function exitState() {\r\n          removeElems(\".large-drop, .circlet, .comp-line\", container);\r\n\r\n          hideElems(\"#member-variable, #member-label\", container);\r\n          hideElems(\".comp-settings\");\r\n\r\n          setPanels([]);\r\n          appCtx.setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateCirclets() {\r\n      if (activeMinidrop) {\r\n        const [positions, lines, nodes] = helpers.calcLinesAndPositions(\r\n          groupsRef.current,\r\n          activeMinidrop.key\r\n        );\r\n\r\n        setPanels(makePanelsFromNodes(nodes));\r\n        helpers.updateLabelSVG(\r\n          avgCoords(positions),\r\n          activeMinidrop.key.slice(4),\r\n          getScreenDropHeight()\r\n        );\r\n        helpers.updateScenIndicatorsSVG(positions, lines);\r\n      }\r\n    },\r\n    [activeMinidrop]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#compare-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop-group\", container);\r\n        showElems(\".large-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return objectivesData.KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      helpers.updateColorDrops(\r\n        container,\r\n        groupsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop-group\", container);\r\n      hideElems(\".large-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function makePanelsFromNodes(nodes) {\r\n    return (p) => {\r\n      return nodes.map((n, i) => {\r\n        let ox = 0,\r\n          oy = 0;\r\n\r\n        if (p[i]) {\r\n          ox = p[i].offsetX;\r\n          oy = p[i].offsetY;\r\n        }\r\n\r\n        const [x, y, isLeft] = getIdealGroupPos(\r\n          groupsRef.current.groupPositions[i],\r\n          centerRef.current\r\n        );\r\n\r\n        return {\r\n          text: n.key,\r\n          x,\r\n          y,\r\n          id: groupsRef.current.groups[i].key,\r\n          nodeID: n.id,\r\n          isLeft,\r\n          offsetX: ox,\r\n          offsetY: oy,\r\n        };\r\n      });\r\n    };\r\n  }\r\n\r\n  function getIdealGroupPos([x, y], [centerX, centerY]) {\r\n    let newX = x,\r\n      newY = y;\r\n\r\n    const correctionX = groupsRef.current.groups[0].height * 2;\r\n\r\n    if (newX < centerX) newX -= correctionX;\r\n    else newX += correctionX;\r\n\r\n    return [newX, newY, newX < centerX];\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {activeMinidrop && (\r\n        <SceneSettingStickers\r\n          settings={deserialize(activeMinidrop.key.slice(4))}\r\n          setColorSetting={setColorSetting}\r\n        />\r\n      )}\r\n      {panels.map(({ x, y, id, isLeft, offsetX, offsetY, nodeID }, i) => {\r\n        const { objective, scenario } = objectivesData.FLATTENED_DATA[nodeID];\r\n\r\n        const baselineMax = d3.max(\r\n          objectivesData.OBJECTIVES_DATA[objective][\r\n            objectivesData.SCENARIO_KEY_STRING\r\n          ][scenario][objectivesData.DELIV_KEY_STRING]\r\n        );\r\n\r\n        return (\r\n          <div\r\n            className={\"panel compare-panel\" + (isLeft ? \" left\" : \"\")}\r\n            key={i}\r\n            style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n            onMouseDown={(e) => onPanelDragStart(e, { id })}\r\n          >\r\n            <DotHistogram\r\n              width={300}\r\n              height={200}\r\n              data={objectivesData.FLATTENED_DATA[nodeID].deliveries}\r\n              domain={[0, baselineMax]}\r\n              goal={appCtx.goals[id]}\r\n              setGoal={(newGoal) => {\r\n                appCtx.setGoals((g) => {\r\n                  g[id] = newGoal;\r\n                  return { ...g };\r\n                });\r\n              }}\r\n            />\r\n          </div>\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport DotHistogram from \"components/DotHistogram\";\r\nimport SceneSettingSubcard from \"components/SceneSettingSubcard\";\r\nimport { objectivesData } from \"data/objectives-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport {\r\n  generateTSpan,\r\n  hideElems,\r\n  removeElems,\r\n  showElems,\r\n} from \"utils/render-utils\";\r\nimport { deserialize } from \"utils/data-utils\";\r\nimport { clipEnds, dist } from \"utils/math-utils\";\r\nimport { radToDeg } from \"three/src/math/MathUtils\";\r\nimport { useDragPanels } from \"hooks/useDragPanels\";\r\n\r\nimport { helpers } from \"./examineview-helpers\";\r\n\r\nexport default function ExamineView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const activeMinidropsRef = useRef([]);\r\n  const curMinidropsRef = useRef(null);\r\n\r\n  const [colorSetting, setColorSetting] = useState(null);\r\n  const [camTransform, setCamTransform] = useState(d3.zoomIdentity);\r\n  const { panels, panelsRef, setPanels, onPanelDragStart, getPanelStyle } =\r\n    useDragPanels(camTransform);\r\n  const [hoveredCard, setHoveredCard] = useState(null);\r\n  const removePreviewRef = useRef(null);\r\n\r\n  useEffect(function initialize() {\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"examine-group\");\r\n\r\n    svgGroup.append(\"circle\").attr(\"class\", \"highlight-circle\");\r\n\r\n    svgGroup.append(\"path\").attr(\"class\", \"connect-line\");\r\n\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"instruction-text large-gray-text fancy-font\");\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"large-drop-label large-gray-text fancy-font\");\r\n\r\n    appCtx.addZoomHandler(function (transform) {\r\n      setCamTransform(transform);\r\n    });\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"ExamineView\")) {\r\n        const { transitionDuration = 0 } = appCtx.state;\r\n        const container = d3.select(\"#examine-group\");\r\n        curMinidropsRef.current = appCtx.waterdrops.groups.find(\r\n          (g) => g.key === appCtx.activeWaterdrops[0]\r\n        );\r\n\r\n        helpers.updateSmallDropSVG(\r\n          container,\r\n          curMinidropsRef.current,\r\n          transitionDuration / 2,\r\n          {\r\n            onClick: updateActiveMinidrops,\r\n            onHover: hoverDrop,\r\n            onUnhover: unhoverDrop,\r\n          }\r\n        );\r\n\r\n        setTimeout(positionTexts, transitionDuration * 1.2);\r\n\r\n        appCtx.setGoBack(() => () => {\r\n          const transitionDuration = appCtx.resetCamera();\r\n\r\n          appCtx.setState({ state: \"WideView\", transitionDuration });\r\n        });\r\n\r\n        setCamTransform(appCtx.camera.curTransform);\r\n        showElems(\"#examine-group\");\r\n\r\n        return function exitState() {\r\n          removeElems(\".small-drop, .circlet\", container);\r\n          hideElems(\"#examine-group\");\r\n          d3.selectAll(\r\n            \"#examine-group .instruction-text, #examine-group .large-drop-label\"\r\n          ).attr(\"opacity\", 0);\r\n\r\n          setPanels([]);\r\n          activeMinidropsRef.current = [];\r\n          curMinidropsRef.current = null;\r\n          appCtx.setGoBack(null);\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function highlightWithColor() {\r\n      const container = d3.select(\"#examine-group\");\r\n      if (colorSetting === null) {\r\n        hideElems(\".color-drop\", container);\r\n        showElems(\".small-drop\", container);\r\n        return;\r\n      }\r\n\r\n      const getOpacity = (key) => {\r\n        return objectivesData.KEY_SETTINGS_MAP[key][colorSetting];\r\n      };\r\n\r\n      const colors = [\"red\", \"orange\", \"blue\", \"green\", \"magenta\"];\r\n\r\n      helpers.updateColorDrops(\r\n        container,\r\n        curMinidropsRef.current,\r\n        getOpacity,\r\n        colors[colorSetting]\r\n      );\r\n      showElems(\".color-drop\", container);\r\n      hideElems(\".small-drop\", container);\r\n    },\r\n    [colorSetting]\r\n  );\r\n\r\n  function positionTexts() {\r\n    const instrFontSize =\r\n      (16 / appCtx.camera.height) *\r\n      appCtx.camera.getZFromFarHeight(\r\n        curMinidropsRef.current.height * settings.SPREAD_1_2 * 1.5\r\n      );\r\n\r\n    d3.select(\"#examine-group .instruction-text\")\r\n      .attr(\r\n        \"x\",\r\n        curMinidropsRef.current.x -\r\n          curMinidropsRef.current.height * settings.SPREAD_1_2 * 0.8\r\n      )\r\n      .attr(\"y\", curMinidropsRef.current.y - instrFontSize)\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", instrFontSize)\r\n      .call(\r\n        generateTSpan([\"click to show panels.\", \"you can drag panels.\"], 1.6)\r\n      )\r\n      .call((s) => {\r\n        s.transition().attr(\"opacity\", 1);\r\n      })\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * instrFontSize);\r\n      });\r\n\r\n    const labelFontSize =\r\n      (20 / appCtx.camera.height) *\r\n      appCtx.camera.getZFromFarHeight(\r\n        curMinidropsRef.current.height * settings.SPREAD_1_2 * 1.5\r\n      );\r\n\r\n    d3.select(\"#examine-group .large-drop-label\")\r\n      .attr(\"x\", curMinidropsRef.current.x)\r\n      .attr(\r\n        \"y\",\r\n        curMinidropsRef.current.y +\r\n          (curMinidropsRef.current.height / 2) * settings.SPREAD_1_2 * 0.9\r\n      )\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"font-size\", labelFontSize)\r\n      .call(\r\n        generateTSpan(\r\n          descriptionsData[appCtx.activeWaterdrops[0]]?.display_name ||\r\n            descriptionsData[appCtx.activeWaterdrops[0]]?.id ||\r\n            appCtx.activeWaterdrops[0],\r\n          1.2\r\n        )\r\n      )\r\n      .transition()\r\n      .attr(\"opacity\", 1);\r\n  }\r\n\r\n  function addDetailPanel(dropId, preview = false, forceReplace = false) {\r\n    const { x: groupX, y: groupY } = curMinidropsRef.current;\r\n    const { x, y, id, key } = appCtx.waterdrops.nodes[dropId];\r\n    setPanels((p) => {\r\n      if (p.findIndex(({ id: pid }) => id === pid) !== -1) {\r\n        if (!forceReplace) return p;\r\n\r\n        arrRemove(p, (_p) => _p.id === id);\r\n      }\r\n      const newPanel = {\r\n        text: key.slice(4),\r\n        x: groupX + x * settings.SPREAD_1_2,\r\n        y: groupY + y * settings.SPREAD_1_2,\r\n        offsetX: 20,\r\n        offsetY: 40,\r\n        id,\r\n        preview,\r\n        panelKey: preview ? -1 : dropId,\r\n      };\r\n\r\n      return [...p, newPanel];\r\n    });\r\n  }\r\n\r\n  function removeDetailPanel(dropId) {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ id }) => dropId === id);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function removePreviewPanel() {\r\n    setPanels((p) => {\r\n      arrRemove(p, ({ panelKey }) => panelKey === -1);\r\n\r\n      return [...p];\r\n    });\r\n  }\r\n\r\n  function updateActiveMinidrops(d) {\r\n    const container = d3.select(\"#examine-group\");\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      arrRemove(activeMinidropsRef.current, d.id);\r\n      container.select(`.circlet#i${d.id}`).classed(\"active\", false);\r\n      removeDetailPanel(d.id);\r\n      setHoveredCard(null);\r\n    } else {\r\n      removeDetailPanel(d.id);\r\n      activeMinidropsRef.current.push(d.id);\r\n      container.select(`.circlet#i${d.id}`).classed(\"active\", true);\r\n      addDetailPanel(d.id);\r\n      setHoveredCard(d.id);\r\n    }\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    if (activeMinidropsRef.current.includes(d.id)) {\r\n      d3.select(`.examine-panel#p${d.id}`).style(\"z-index\", 100);\r\n      setHoveredCard(d.id);\r\n    } else {\r\n      if (removePreviewRef.current) {\r\n        clearTimeout(removePreviewRef.current);\r\n        removePreviewPanel();\r\n      }\r\n      addDetailPanel(d.id, true);\r\n    }\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    if (!activeMinidropsRef.current.includes(d.id)) {\r\n      removePreviewRef.current = setTimeout(() => {\r\n        removeDetailPanel(d.id);\r\n        removePreviewRef.current = null;\r\n      }, 100);\r\n    }\r\n\r\n    setHoveredCard((hc) => (hc === d.id ? null : hc));\r\n    d3.select(`.examine-panel#p${d.id}`).style(\"z-index\", 0);\r\n  }\r\n\r\n  function drawLineConnect(id) {\r\n    if (panelsRef.current.findIndex(({ id: pid }) => id === pid) === -1) return;\r\n\r\n    const { x: circleX, y: circleY } = panelsRef.current.find(\r\n      (p) => p.id === id\r\n    );\r\n\r\n    const [cx, cy] = appCtx.camera.worldToScreen(circleX, circleY);\r\n\r\n    const panelBox = d3\r\n      .select(`.examine-panel#p${id}`)\r\n      .node()\r\n      .getBoundingClientRect();\r\n    const [px, py] = [\r\n      panelBox.left + panelBox.width / 2,\r\n      panelBox.top + panelBox.height / 2,\r\n    ];\r\n\r\n    const diffX = px - cx;\r\n    const diffY = py - cy;\r\n\r\n    let left, top;\r\n    const margin = 5;\r\n\r\n    if (Math.abs(diffX) > Math.abs(diffY)) {\r\n      top = 0;\r\n      left = (diffX < 0 ? 1 : -1) * (panelBox.width / 2 - margin);\r\n    } else {\r\n      left = 0;\r\n      top = (diffY < 0 ? 1 : -1) * (panelBox.height / 2 - margin);\r\n    }\r\n\r\n    const line = clipEnds(\r\n      [\r\n        [cx, cy],\r\n        [px + left, py + top],\r\n      ],\r\n      8,\r\n      0\r\n    );\r\n\r\n    return line;\r\n  }\r\n\r\n  if (isState(appCtx.state, \"ExamineView\")) {\r\n    return (\r\n      <>\r\n        {panels.map(\r\n          ({ text, x, y, id, offsetX, offsetY, panelKey, preview }) => {\r\n            const { objective, scenario } = objectivesData.FLATTENED_DATA[id];\r\n\r\n            const [scenMin, baselineMax] = objectivesData.MIN_MAXES[objective];\r\n\r\n            return (\r\n              <div\r\n                className={`panel examine-panel ${preview ? \"preview\" : \"\"}`}\r\n                id={`p${id}`}\r\n                key={preview ? -1 : id}\r\n                style={getPanelStyle({ x, y, offsetX, offsetY })}\r\n                onMouseDown={(e) => !preview && onPanelDragStart(e, { id })}\r\n                onMouseEnter={() => !preview && hoverDrop({ id })}\r\n                onMouseLeave={() => !preview && unhoverDrop({ id })}\r\n              >\r\n                <div className=\"panel-tab\">\r\n                  scenario <span>{text}</span>\r\n                </div>\r\n                <DotHistogram\r\n                  width={300}\r\n                  height={200}\r\n                  data={objectivesData.FLATTENED_DATA[id].deliveries}\r\n                  domain={[scenMin, baselineMax]}\r\n                  goal={appCtx.goals[appCtx.activeWaterdrops[0]]}\r\n                  setGoal={(newGoal) => {\r\n                    appCtx.setGoals((g) => {\r\n                      g[appCtx.activeWaterdrops[0]] = newGoal;\r\n                      return { ...g };\r\n                    });\r\n                  }}\r\n                />\r\n                <SceneSettingSubcard\r\n                  settings={deserialize(text)}\r\n                  setColorSetting={setColorSetting}\r\n                />\r\n              </div>\r\n            );\r\n          }\r\n        )}\r\n        {hoveredCard && (\r\n          <ConnectLine connectLine={drawLineConnect(hoveredCard)} />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nfunction ConnectLine({ connectLine }) {\r\n  return (\r\n    <div className=\"connect-line\" style={getConnectStyle(...connectLine)}>\r\n      <div className=\"connect-line-container\"></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getConnectStyle(from, to) {\r\n  const width = dist(from, to);\r\n  const rot = radToDeg(Math.atan2(to[1] - from[1], to[0] - from[0]));\r\n  return {\r\n    left: `${from[0]}px`,\r\n    top: `${from[1]}px`,\r\n    width: `${width}px`,\r\n    rotate: `${rot}deg`,\r\n  };\r\n}\r\n","import * as d3 from \"d3\";\r\nimport {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { BiCross, BiNetworkChart } from \"react-icons/bi\";\r\nimport fuzzysort from \"fuzzysort\";\r\n\r\nimport { AppContext } from \"AppContext\";\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { spatialData } from \"data/spatial-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { avgCoords, dropCenterCorrection } from \"utils/math-utils\";\r\nimport { arrRemove, isState } from \"utils/misc-utils\";\r\nimport { generateTSpan, hideElems, showElems } from \"utils/render-utils\";\r\n\r\nimport { helpers } from \"./wideview-helpers\";\r\n\r\nexport default function WideView() {\r\n  const appCtx = useContext(AppContext);\r\n\r\n  const [curScreenTransform, setCurScreenTransform] = useState({\r\n    zoom: 1,\r\n    mouseX: 0,\r\n    mouseY: 0,\r\n  });\r\n\r\n  const [currentHoveredDrop, setCurrentHoveredDrop] = useState(null);\r\n  const [searchPrompt, setSearchPrompt] = useState(null);\r\n\r\n  const enableZoomRef = useRef(false);\r\n  const activeDropsRef = useRef([]);\r\n\r\n  useEffect(function initialize() {\r\n    if (!appCtx.waterdrops) return;\r\n\r\n    initSVGGraphics();\r\n\r\n    const cleanup = registerEventListeners();\r\n\r\n    helpers.drawMinimapSVG();\r\n\r\n    return cleanup;\r\n  }, []);\r\n\r\n  useEffect(\r\n    function enterState() {\r\n      if (isState(appCtx.state, \"WideView\")) {\r\n        const { transitionDuration = 0 } = appCtx.state;\r\n        d3.select(\"body\").style(\"overflow\", \"hidden\");\r\n\r\n        enableZoomRef.current = true;\r\n        setCurScreenTransform((cst) => ({\r\n          ...cst,\r\n          zoom: appCtx.camera.curTransform.k,\r\n        }));\r\n\r\n        drawTHREEGraphics();\r\n        drawSVGGraphics();\r\n\r\n        showElems(\"#infobox, #mosaic-webgl, #mosaic-svg, #wide-group\");\r\n\r\n        return function exitState() {\r\n          hideElems(\"#infobox, #wide-group\");\r\n\r\n          enableZoomRef.current = false;\r\n        };\r\n      }\r\n    },\r\n    [appCtx.state]\r\n  );\r\n\r\n  useEffect(\r\n    function updateFontSizes() {\r\n      if (enableZoomRef.current) {\r\n        d3.select(\"#wide-group\")\r\n          .selectAll(\".cloud-text\")\r\n          .each(\r\n            helpers.fontSizer(\r\n              curScreenTransform,\r\n              appCtx.camera,\r\n              appCtx.waterdrops.height\r\n            )\r\n          );\r\n      }\r\n    },\r\n    [curScreenTransform]\r\n  );\r\n\r\n  const handleClickExamine = useCallback(function () {\r\n    appCtx.setDisableCamAdjustments(true);\r\n\r\n    const { x, y, height } = activeDropsRef.current[0];\r\n\r\n    const newCamPos = [\r\n      x,\r\n      y - dropCenterCorrection({ height }),\r\n      appCtx.camera.getZFromFarHeight(height * settings.SPREAD_1_2 * 1.5),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = appCtx.zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        appCtx.setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    appCtx.setState({ state: \"ExamineView\", transitionDuration });\r\n\r\n    const startOpacity = appCtx.getOutlineOpacity(appCtx.camera.curTransform.k);\r\n    helpers.fadeOutDrops(\r\n      appCtx.dropsMesh,\r\n      appCtx.scene,\r\n      startOpacity,\r\n      transitionDuration / 2\r\n    );\r\n  }, []);\r\n\r\n  const handleClickCompare = useCallback(function () {\r\n    appCtx.setDisableCamAdjustments(true);\r\n\r\n    const dropsMidpoint = avgCoords(\r\n      activeDropsRef.current.map((w) => [w.x, w.y])\r\n    );\r\n\r\n    const newCamPos = [\r\n      ...dropsMidpoint,\r\n      appCtx.camera.getZFromFarHeight(\r\n        appCtx.waterdrops.groups[0].height * 2 * settings.SPREAD_1_2 * 0.75 * 2\r\n      ),\r\n    ];\r\n\r\n    const [startZoom, transitionDuration] = appCtx.zoomTo(\r\n      newCamPos,\r\n      function onFinish() {\r\n        appCtx.setDisableCamAdjustments(false);\r\n      }\r\n    );\r\n\r\n    startZoom();\r\n\r\n    appCtx.setState({\r\n      state: \"CompareView\",\r\n      transitionDuration,\r\n      viewCenter: dropsMidpoint,\r\n    });\r\n\r\n    const startOpacity = appCtx.getOutlineOpacity(appCtx.camera.curTransform.k);\r\n    helpers.fadeOutDrops(\r\n      appCtx.dropsMesh,\r\n      appCtx.scene,\r\n      startOpacity,\r\n      transitionDuration / 5\r\n    );\r\n  }, []);\r\n\r\n  const handleClickDeselectAll = useCallback(function () {\r\n    appCtx.setActiveWaterdrops([]);\r\n    activeDropsRef.current = [];\r\n    d3.selectAll(\"#wide-group .circlet\").classed(\"active\", false);\r\n  }, []);\r\n\r\n  function initSVGGraphics() {\r\n    hideElems(\"#infobox, #mosaic-webgl, #mosaic-svg\");\r\n\r\n    const svgGroup = d3\r\n      .select(\"#mosaic-svg\")\r\n      .select(\".svg-trans\")\r\n      .append(\"g\")\r\n      .attr(\"id\", \"wide-group\");\r\n\r\n    svgGroup\r\n      .append(\"text\")\r\n      .attr(\"class\", \"instruction-text large-gray-text fancy-font\")\r\n      .attr(\"x\", 0 - appCtx.waterdrops.height * 0.6);\r\n  }\r\n\r\n  function registerEventListeners() {\r\n    const cameraListener = (transform) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        zoom: transform.k,\r\n      }));\r\n    };\r\n\r\n    const mouseListener = (e) => {\r\n      setCurScreenTransform((ti) => ({\r\n        ...ti,\r\n        mouseX: e.x,\r\n        mouseY: e.y,\r\n      }));\r\n    };\r\n\r\n    appCtx.addZoomHandler(cameraListener);\r\n    window.addEventListener(\"mousemove\", mouseListener);\r\n\r\n    return function cleanup() {\r\n      window.removeEventListener(\"mousemove\", mouseListener);\r\n    };\r\n  }\r\n\r\n  function drawTHREEGraphics() {\r\n    console.time(\"drawing\");\r\n    appCtx.dropsMesh.draw(appCtx.scene);\r\n    console.timeEnd(\"drawing\");\r\n\r\n    appCtx.dropsMesh.updateVisibility(1);\r\n    appCtx.dropsMesh.updateOutlineVisibility(\r\n      appCtx.getOutlineOpacity(appCtx.camera.curTransform.k)\r\n    );\r\n  }\r\n\r\n  function drawSVGGraphics() {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    helpers.updateLargeDropSVG(container, appCtx.waterdrops, {\r\n      onClick: updateActiveDrops,\r\n      onHover: hoverDrop,\r\n      onUnhover: unhoverDrop,\r\n    });\r\n\r\n    for (const wd of activeDropsRef.current) {\r\n      container.select(`.circlet#b${wd.key}`).classed(\"active\", true);\r\n    }\r\n\r\n    const fontSize =\r\n      (20 / appCtx.camera.height) *\r\n      appCtx.camera.getZFromFarHeight(appCtx.waterdrops.height);\r\n    container\r\n      .select(\".instruction-text\")\r\n      .attr(\"y\", -fontSize * 5)\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"font-size\", fontSize)\r\n      .call(\r\n        generateTSpan(\r\n          [\"click to interact.\", \"scroll to zoom.\", \"drag to pan.\"],\r\n          2\r\n        )\r\n      )\r\n      .selectAll(\"tspan\")\r\n      .each(function (_, i) {\r\n        d3.select(this).attr(\"dx\", i * fontSize);\r\n      });\r\n  }\r\n\r\n  function updateActiveDrops(d) {\r\n    const container = d3.select(\"#wide-group\");\r\n\r\n    appCtx.setActiveWaterdrops((aw) => {\r\n      if (aw.includes(d.key)) {\r\n        aw = arrRemove(aw, d.key);\r\n        activeDropsRef.current = arrRemove(activeDropsRef.current, d);\r\n\r\n        container.select(`.circlet#b${d.key}`).classed(\"active\", false);\r\n      } else {\r\n        aw.push(d.key);\r\n        activeDropsRef.current.push(d);\r\n\r\n        container.select(`.circlet#b${d.key}`).classed(\"active\", true);\r\n      }\r\n      return [...aw];\r\n    });\r\n  }\r\n\r\n  function hoverDrop(d) {\r\n    setCurrentHoveredDrop({\r\n      id: d.key,\r\n      description: descriptionsData[d.key]?.desc || d.key,\r\n    });\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"gray\");\r\n  }\r\n\r\n  function unhoverDrop(d) {\r\n    setCurrentHoveredDrop(null);\r\n\r\n    d3.select(\"#minimap\")\r\n      .select(\".outline.\" + d.key)\r\n      .attr(\"fill\", \"transparent\");\r\n  }\r\n\r\n  const searchResults = useMemo(() => {\r\n    if (searchPrompt === null) return [];\r\n\r\n    return fuzzysort.go(searchPrompt, appCtx.waterdrops.groups, {\r\n      keys: [(obj) => obj.key],\r\n      limit: 10,\r\n      all: true,\r\n    });\r\n  }, [searchPrompt, appCtx.waterdrops]);\r\n\r\n  return (\r\n    <>\r\n      <div id=\"infobox\">\r\n        <svg id=\"minimap\"></svg>\r\n        {currentHoveredDrop && (\r\n          <div className=\"details\">\r\n            {!spatialData.SPATIAL_FEATURES[currentHoveredDrop.id] && (\r\n              <p className=\"no-loc-data\">No Location Data</p>\r\n            )}\r\n            <p className=\"curDesc\">{currentHoveredDrop.description}</p>\r\n            <p className=\"curKey\">\r\n              id: <span> {currentHoveredDrop.id} </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n        {!currentHoveredDrop && (\r\n          <div className=\"searchbox\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"search\"\r\n              value={searchPrompt || \"\"}\r\n              onChange={(e) => setSearchPrompt(e.target.value)}\r\n              onFocus={() => {\r\n                setSearchPrompt(\"\");\r\n                d3.select(\".results\").style(\"display\", \"flex\");\r\n              }}\r\n              onBlur={() => {\r\n                setTimeout(() => {\r\n                  setSearchPrompt(null);\r\n                  d3.select(\".results\").style(\"display\", \"none\");\r\n                }, 100);\r\n              }}\r\n            ></input>\r\n            <div className=\"results\" style={{ display: \"none\" }}>\r\n              {searchResults.map(({ obj: wd }) => (\r\n                <button key={wd.key} onClick={() => updateActiveDrops(wd)}>\r\n                  {wd.key}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"action-btn-wrapper\">\r\n        <ActionButtons\r\n          appCtx={appCtx}\r\n          handleClickExamine={handleClickExamine}\r\n          handleClickDeselectAll={handleClickDeselectAll}\r\n          handleClickCompare={handleClickCompare}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction ActionButtons({\r\n  appCtx,\r\n  handleClickExamine,\r\n  handleClickDeselectAll,\r\n  handleClickCompare,\r\n}) {\r\n  let examineBtn, compareBtn;\r\n\r\n  if (isState(appCtx.state, \"WideView\") && appCtx.activeWaterdrops.length) {\r\n    if (appCtx.activeWaterdrops.length === 1) {\r\n      examineBtn = (\r\n        <button\r\n          onClick={handleClickExamine}\r\n          className=\"wide-view-action-btn fancy-font\"\r\n        >\r\n          <BiCross />\r\n          <span>examine</span>\r\n        </button>\r\n      );\r\n    } else {\r\n      compareBtn = (\r\n        <>\r\n          <button\r\n            onClick={handleClickDeselectAll}\r\n            className=\"fancy-font supplement-btn\"\r\n          >\r\n            <span>deselect all</span>\r\n          </button>\r\n          <button\r\n            onClick={handleClickCompare}\r\n            className=\"wide-view-action-btn fancy-font\"\r\n          >\r\n            <BiNetworkChart />\r\n            <span>compare</span>\r\n          </button>\r\n        </>\r\n      );\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {examineBtn}\r\n      {compareBtn}\r\n    </>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\n\r\nimport { settings } from \"settings\";\r\n\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { clipEnds, dropCenterCorrection } from \"utils/math-utils\";\r\nimport {\r\n  DROPLET_SHAPE,\r\n  generateTSpan,\r\n  circlet,\r\n  gradientInit,\r\n  gradientUpdate,\r\n} from \"utils/render-utils\";\r\n\r\nfunction largeDropInit({ nodes, height }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"large-drop\");\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"highlight-circle\")\r\n      .attr(\"stroke\", \"none\")\r\n      .attr(\"fill\", \"yellow\")\r\n      .attr(\"r\", settings.LOD_1_RAD_PX * 2);\r\n\r\n    s.append(\"text\")\r\n      .style(\"font-size\", (height * settings.SPREAD_1_2) / 15)\r\n      .attr(\"class\", \"fancy-font large-gray-text\")\r\n      .attr(\"text-anchor\", \"middle\");\r\n\r\n    s.selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .enter()\r\n      .append(\"g\")\r\n      .attr(\"class\", \"small-drop\")\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n  };\r\n}\r\n\r\nfunction largeDropUpdate({ nodes, key, height }, transitionDelay) {\r\n  return (s) => {\r\n    const getStartDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x}, ${y}) rotate(${tilt})`;\r\n    const getEndDropLoc = ({ x, y, tilt }) =>\r\n      `translate(${x * settings.SPREAD_1_2}, ${\r\n        y * settings.SPREAD_1_2\r\n      }) rotate(${tilt})`;\r\n\r\n    const baselinePos = {};\r\n\r\n    s.call(textUpdate(key, height))\r\n      .selectAll(\".small-drop\")\r\n      .data(nodes)\r\n      .attr(\"display\", \"initial\")\r\n      .attr(\"transform\", getStartDropLoc)\r\n      .each(function (node) {\r\n        d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n      })\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"transform\", getEndDropLoc);\r\n\r\n    s.select(\".highlight-circle\")\r\n      .attr(\"cx\", baselinePos.x)\r\n      .attr(\r\n        \"cy\",\r\n\r\n        baselinePos.y - dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n      )\r\n      .transition()\r\n      .delay(transitionDelay)\r\n      .duration(1000)\r\n      .attr(\"cx\", baselinePos.x * settings.SPREAD_1_2)\r\n      .attr(\r\n        \"cy\",\r\n\r\n        baselinePos.y * settings.SPREAD_1_2 -\r\n          dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n      );\r\n  };\r\n}\r\n\r\nfunction smallDropInit({ levs, id }) {\r\n  return (s) => {\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n\r\n    const idStr = `compare-grad-${id}`;\r\n\r\n    s.call(gradientInit(levs, idStr));\r\n\r\n    s.append(\"path\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"class\", \"outline\")\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX * 0.95})`);\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${idStr})`)\r\n      .attr(\"transform\", `scale(${settings.LOD_1_RAD_PX})`);\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction textUpdate(key, height) {\r\n  return (s) => {\r\n    s.select(\"text\")\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", (height / 2) * settings.SPREAD_1_2 * 0.9)\r\n      .call(\r\n        generateTSpan(\r\n          descriptionsData[key]?.display_name ||\r\n            descriptionsData[key]?.id ||\r\n            key\r\n        )\r\n      );\r\n  };\r\n}\r\n\r\nfunction updateDropsSVG(\r\n  container,\r\n  waterdropGroups,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartGroupLoc = ({ x, y, tilt }) =>\r\n    `translate(${x}, ${y}) rotate(${tilt})`;\r\n  const getEndGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`;\r\n\r\n  container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(largeDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartGroupLoc)\r\n    .each(function (node) {\r\n      const drops = d3\r\n        .select(this)\r\n        .call(largeDropUpdate(node, transitionDelay))\r\n        .selectAll(\".small-drop\");\r\n\r\n      if (onClick) {\r\n        drops.on(\"click\", function (_, d) {\r\n          onClick(d);\r\n        });\r\n      }\r\n\r\n      if (onHover) {\r\n        drops.on(\"mouseenter\", function (_, d) {\r\n          d3.select(this.parentNode).raise();\r\n          onHover(d);\r\n        });\r\n      }\r\n\r\n      if (onUnhover) {\r\n        drops.on(\"mouseleave\", function (_, d) {\r\n          onUnhover(d);\r\n        });\r\n      }\r\n    })\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndGroupLoc);\r\n}\r\n\r\nfunction updateColorDrops(container, waterdropGroups, opacFn, color) {\r\n  const getGroupLoc = (_, i) =>\r\n    `translate(${waterdropGroups.groupPositions[i][0]}, ${waterdropGroups.groupPositions[i][1]})`;\r\n\r\n  container\r\n    .selectAll(\".color-drop-group\")\r\n    .data(waterdropGroups.groups)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function ({ nodes }) {\r\n        d3.select(this).call((s) => {\r\n          s.attr(\"class\", \"color-drop-group\")\r\n            .selectAll(\".color-drop\")\r\n            .data(nodes)\r\n            .join(\"circle\")\r\n            .attr(\"class\", \"color-drop\")\r\n            .attr(\"r\", settings.LOD_1_RAD_PX);\r\n        });\r\n      });\r\n    })\r\n    .attr(\"transform\", getGroupLoc)\r\n    .each(function () {\r\n      d3.select(this)\r\n        .selectAll(\".color-drop\")\r\n        .call((s) => {\r\n          s.attr(\"opacity\", ({ key }) => opacFn(key)).attr(\"fill\", color);\r\n        })\r\n        .attr(\"cx\", ({ x }) => x * settings.SPREAD_1_2)\r\n        .attr(\"cy\", ({ y }) => y * settings.SPREAD_1_2);\r\n    });\r\n}\r\n\r\nfunction getWaterdropGroups(keyArr, waterdrops, center) {\r\n  const groups = keyArr.map((k) => waterdrops.groups.find((g) => g.key === k));\r\n\r\n  const groupPositions = [];\r\n  const rad = groups[0].height * settings.SPREAD_1_2 * 0.75;\r\n\r\n  for (let i = 0, n = groups.length; i < n; i++) {\r\n    const angle = ((Math.PI * 2) / n) * (i - 0.5) - Math.PI / 2;\r\n    groupPositions.push([\r\n      center[0] + Math.cos(angle) * rad,\r\n      center[1] + Math.sin(angle) * rad,\r\n    ]);\r\n  }\r\n\r\n  return {\r\n    groups,\r\n    groupPositions,\r\n  };\r\n}\r\n\r\nfunction calcLinesAndPositions(groupsObj, activeMinidropKey) {\r\n  const positions = [];\r\n  const nodes = [];\r\n  for (let i = 0; i < groupsObj.groups.length; i++) {\r\n    const group = groupsObj.groups[i];\r\n    const groupPos = groupsObj.groupPositions[i];\r\n\r\n    const node = group.nodes.find((n) => n.key === activeMinidropKey);\r\n\r\n    nodes.push(node);\r\n\r\n    positions.push([\r\n      node.x * settings.SPREAD_1_2 + groupPos[0],\r\n      node.y * settings.SPREAD_1_2 +\r\n        groupPos[1] -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX }),\r\n    ]);\r\n  }\r\n\r\n  const lines = [];\r\n\r\n  for (let i = 0; i < positions.length; i++) {\r\n    const from = Array.from(positions[i]),\r\n      to = Array.from(positions[i + 1 == positions.length ? 0 : i + 1]);\r\n\r\n    clipEnds([from, to], settings.LOD_1_RAD_PX * 2);\r\n\r\n    lines.push([from, to]);\r\n  }\r\n\r\n  return [positions, lines, nodes];\r\n}\r\n\r\nfunction updateLabelSVG(pos, labelText, normedTextSize) {\r\n  const [textX, textY] = pos;\r\n\r\n  const smallTextSize = normedTextSize / 15;\r\n  const largeTextSize = normedTextSize / 10;\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-label\")\r\n    .text(\"scenario\")\r\n    .attr(\"font-size\", smallTextSize)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY - smallTextSize * 1.5);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .select(\"#member-variable\")\r\n    .attr(\"font-size\", largeTextSize)\r\n    .text(labelText)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"x\", textX)\r\n    .attr(\"y\", textY);\r\n}\r\n\r\nfunction updateScenIndicatorsSVG(positions, lines) {\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".circlet\")\r\n    .data(positions)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"circlet\")\r\n    .call(circlet)\r\n    .attr(\"display\", \"initial\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX * 1.5)\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"cx\", (d) => d[0])\r\n    .attr(\"cy\", (d) => d[1]);\r\n\r\n  d3.select(\"#compare-group\")\r\n    .selectAll(\".comp-line\")\r\n    .data(lines)\r\n    .join(\"path\")\r\n    .attr(\"class\", \"comp-line\")\r\n    .transition()\r\n    .duration(100)\r\n    .attr(\"d\", (d) => d3.line()(d));\r\n}\r\n\r\nexport const helpers = {\r\n  updateDropsSVG,\r\n  updateColorDrops,\r\n  getWaterdropGroups,\r\n  calcLinesAndPositions,\r\n  updateLabelSVG,\r\n  updateScenIndicatorsSVG,\r\n};\r\n","import * as d3 from \"d3\";\r\n\r\nimport { settings } from \"settings\";\r\n\r\nimport { dropCenterCorrection } from \"utils/math-utils\";\r\nimport {\r\n  DROPLET_SHAPE,\r\n  circlet,\r\n  gradientInit,\r\n  gradientUpdate,\r\n} from \"utils/render-utils\";\r\n\r\nfunction smallDropInit({ levs, id }) {\r\n  return (s) => {\r\n    s.attr(\"class\", \"small-drop hover-capture\");\r\n\r\n    const idStr = `drop-fill-${id}`;\r\n\r\n    s.call(gradientInit(levs, idStr));\r\n\r\n    s.append(\"path\").attr(\"d\", DROPLET_SHAPE).attr(\"class\", \"outline\");\r\n\r\n    s.append(\"path\")\r\n      .attr(\"class\", \"fill\")\r\n      .attr(\"d\", DROPLET_SHAPE)\r\n      .attr(\"fill\", `url(#${idStr})`);\r\n\r\n    s.append(\"circle\")\r\n      .attr(\"class\", \"circlet interactive\")\r\n      .call(circlet)\r\n      .attr(\"cy\", -dropCenterCorrection({ rad: 1 }))\r\n      .attr(\"r\", 1.5);\r\n\r\n    s.append(\"rect\").attr(\"class\", \"bbox\").style(\"visibility\", \"hidden\");\r\n  };\r\n}\r\n\r\nfunction smallDropUpdate({ key, levs, maxLev, id, x, y }, baselinePos) {\r\n  return (s) => {\r\n    if (key === \"expl0000\") {\r\n      baselinePos.x = x;\r\n      baselinePos.y = y;\r\n    }\r\n\r\n    s.call(gradientUpdate(levs, maxLev));\r\n    s.select(\".outline\").attr(\r\n      \"transform\",\r\n      `scale(${settings.LOD_1_RAD_PX * 0.95})`\r\n    );\r\n    s.select(\".fill\").attr(\"transform\", `scale(${settings.LOD_1_RAD_PX})`);\r\n\r\n    s.select(\".circlet\").attr(\"id\", `i${id}`);\r\n\r\n    const dropBBox = s.select(\".fill\").node().getBBox();\r\n\r\n    s.select(\".bbox\")\r\n      .attr(\"x\", dropBBox.x)\r\n      .attr(\"y\", dropBBox.y)\r\n      .attr(\"width\", dropBBox.width)\r\n      .attr(\"height\", dropBBox.height);\r\n  };\r\n}\r\n\r\nfunction updateSmallDropSVG(\r\n  container,\r\n  waterdropGroup,\r\n  transitionDelay,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const getStartLoc = ({ globalX, globalY, globalTilt }) =>\r\n    `translate(${globalX}, ${globalY}) rotate(${globalTilt})`;\r\n  const getEndLoc = ({ x, y, tilt }) =>\r\n    `translate(${waterdropGroup.x + x * settings.SPREAD_1_2}, ${\r\n      waterdropGroup.y + y * settings.SPREAD_1_2\r\n    }) rotate(${tilt})`;\r\n\r\n  const baselinePos = {};\r\n\r\n  const drops = container\r\n    .selectAll(\".small-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join((enter) => {\r\n      return enter.append(\"g\").each(function (node) {\r\n        d3.select(this).call(smallDropInit(node));\r\n      });\r\n    })\r\n    .attr(\"transform\", getStartLoc)\r\n    .each(function (node) {\r\n      d3.select(this).call(smallDropUpdate(node, baselinePos));\r\n    });\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n\r\n  drops\r\n    .transition()\r\n    .delay(transitionDelay)\r\n    .duration(1000)\r\n    .attr(\"transform\", getEndLoc);\r\n\r\n  container\r\n    .select(\".highlight-circle\")\r\n    .attr(\"stroke\", \"none\")\r\n    .attr(\"fill\", \"yellow\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX * 2)\r\n    .attr(\"cx\", waterdropGroup.x + baselinePos.x)\r\n    .attr(\r\n      \"cy\",\r\n      waterdropGroup.y +\r\n        baselinePos.y -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n    )\r\n    .attr(\"cx\", waterdropGroup.x + baselinePos.x * settings.SPREAD_1_2)\r\n    .attr(\r\n      \"cy\",\r\n      waterdropGroup.y +\r\n        baselinePos.y * settings.SPREAD_1_2 -\r\n        dropCenterCorrection({ rad: settings.LOD_1_RAD_PX })\r\n    );\r\n}\r\n\r\nfunction updateColorDrops(container, waterdropGroup, opacFn, color) {\r\n  container\r\n    .selectAll(\".color-drop\")\r\n    .data(waterdropGroup.nodes)\r\n    .join(\"circle\")\r\n    .attr(\"class\", \"color-drop\")\r\n    .attr(\"r\", settings.LOD_1_RAD_PX)\r\n    .attr(\"opacity\", ({ key }) => opacFn(key))\r\n    .attr(\"fill\", color)\r\n    .attr(\"cx\", ({ x }) => waterdropGroup.x + x * settings.SPREAD_1_2)\r\n    .attr(\"cy\", ({ y }) => waterdropGroup.y + y * settings.SPREAD_1_2);\r\n}\r\n\r\nexport const helpers = {\r\n  updateSmallDropSVG,\r\n  updateColorDrops,\r\n};\r\n","import * as d3 from \"d3\";\r\n\r\nimport { descriptionsData } from \"data/descriptions-data\";\r\nimport { spatialData } from \"data/spatial-data\";\r\nimport { settings } from \"settings\";\r\n\r\nimport { dist, dropCenterCorrection, getCenterDomRect } from \"utils/math-utils\";\r\nimport { wrap } from \"utils/misc-utils\";\r\nimport { circlet } from \"utils/render-utils\";\r\n\r\nfunction interactorsInit() {\r\n  const s = d3.select(this);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"hover-capture\")\r\n    .attr(\"fill\", \"transparent\")\r\n    .attr(\"stroke-width\", 0)\r\n    .attr(\"r\", 0.8);\r\n\r\n  s.append(\"circle\")\r\n    .attr(\"class\", \"circlet interactive\")\r\n    .call(circlet)\r\n    .attr(\"r\", 1);\r\n\r\n  const textGroup = s.append(\"g\").attr(\"pointer-events\", \"none\");\r\n  textGroup\r\n    .append(\"image\")\r\n    .attr(\"href\", \"glow.png\")\r\n    .attr(\"preserveAspectRatio\", \"none\")\r\n    .attr(\"opacity\", 0.8);\r\n  textGroup\r\n    .append(\"text\")\r\n    .attr(\"class\", \"fancy-font cloud-text\")\r\n    .attr(\"text-anchor\", \"middle\")\r\n    .attr(\"font-size\", 0);\r\n}\r\n\r\nfunction interactorsUpdate(d) {\r\n  d3.select(this).select(\".circlet\").attr(\"id\", `b${d.key}`);\r\n  d3.select(this).select(\"text\").call(textUpdate(d));\r\n}\r\n\r\nfunction textUpdate(d) {\r\n  return function (s) {\r\n    s.selectAll(\"*\").remove();\r\n    const lines = wrap(d.key).split(\"\\n\");\r\n\r\n    lines.forEach((line, i) => {\r\n      s.append(\"tspan\")\r\n        .attr(\"x\", 0)\r\n        .attr(\"y\", `${-lines.length / 2 + 0.5}em`)\r\n        .attr(\"dy\", `${i}em`)\r\n        .text(line);\r\n    });\r\n  };\r\n}\r\n\r\nfunction dropTransform({ x, y, height }) {\r\n  return `translate(${x}, ${y - dropCenterCorrection({ height })}) scale(${\r\n    height * settings.GROUP_HOVER_AREA_FACTOR\r\n  })`;\r\n}\r\n\r\nfunction getFontSize(d, transformZoom, cameraHeight, waterdropsHeight) {\r\n  const MAX_RAD = window.innerHeight / 9;\r\n\r\n  const zoomRel = cameraHeight / waterdropsHeight / transformZoom;\r\n\r\n  const absFontSize = (_d) =>\r\n    _d > MAX_RAD\r\n      ? 0\r\n      : d3.scaleLinear().domain([0, MAX_RAD]).range([1, 0.4]).clamp(true)(_d);\r\n\r\n  return absFontSize(d * zoomRel) * Math.min(zoomRel, 0.4);\r\n}\r\n\r\nfunction drawMinimapSVG() {\r\n  const width = 200,\r\n    height = 250;\r\n\r\n  const minimap = d3\r\n    .select(\"#minimap\")\r\n    .attr(\"width\", width)\r\n    .attr(\"height\", height);\r\n\r\n  const proj = d3\r\n    .geoMercator()\r\n    .scale(1000)\r\n    .center(spatialData.CALIFORNIA_CENTER)\r\n    .translate([width / 2, height / 2]);\r\n\r\n  const lineGeom = [\r\n    ...spatialData.SPATIAL_DATA.features.filter(\r\n      (f) => f.geometry.type === \"MultiPolygon\"\r\n    ),\r\n    spatialData.CALIFORNIA_OUTLINE,\r\n  ];\r\n  const pointGeom = spatialData.SPATIAL_DATA.features.filter(\r\n    (f) => f.geometry.type === \"MultiPoint\"\r\n  );\r\n\r\n  minimap\r\n    .selectAll(\"path\")\r\n    .data(lineGeom)\r\n    .join(\"path\")\r\n    .attr(\"d\", (d) => d3.geoPath().projection(proj)(d))\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"stroke\", (d) => (d.properties.CalLiteID ? \"transparent\" : \"gray\"))\r\n    .attr(\"stroke-width\", 1)\r\n    .attr(\"fill\", \"transparent\");\r\n\r\n  minimap\r\n    .selectAll(\"circle\")\r\n    .data(pointGeom)\r\n    .join(\"circle\")\r\n    .each(function (d) {\r\n      const s = d3.select(this);\r\n\r\n      const [x, y] = proj(d.geometry.coordinates[0]);\r\n\r\n      s.attr(\"cx\", x);\r\n      s.attr(\"cy\", y);\r\n    })\r\n    .attr(\"r\", 2)\r\n    .attr(\"class\", (d) => \"outline \" + d.properties.CalLiteID)\r\n    .attr(\"fill\", \"transparent\");\r\n}\r\n\r\nfunction updateLargeDropSVG(\r\n  container,\r\n  waterdrops,\r\n  { onClick, onHover, onUnhover }\r\n) {\r\n  const drops = container\r\n    .selectAll(\".large-drop\")\r\n    .data(waterdrops.groups, ({ key }) => key)\r\n    .join((enter) => {\r\n      return enter\r\n        .append(\"g\")\r\n        .attr(\"class\", \"large-drop\")\r\n        .each(interactorsInit);\r\n    })\r\n    .each(interactorsUpdate)\r\n    .attr(\"transform\", dropTransform)\r\n    .select(\".hover-capture\");\r\n\r\n  if (onClick) {\r\n    drops.on(\"click\", function (_, d) {\r\n      onClick(d);\r\n    });\r\n  }\r\n\r\n  if (onHover) {\r\n    drops.on(\"mouseenter\", function (_, d) {\r\n      d3.select(this.parentNode).raise();\r\n      onHover(d);\r\n    });\r\n  }\r\n\r\n  if (onUnhover) {\r\n    drops.on(\"mouseleave\", function (_, d) {\r\n      onUnhover(d);\r\n    });\r\n  }\r\n}\r\n\r\nfunction fontSizer(transformInfo, camera, waterdropsHeight) {\r\n  return function () {\r\n    const tNode = d3.select(this).node();\r\n\r\n    const [posx, posy] = getCenterDomRect(tNode.getBoundingClientRect());\r\n\r\n    const width = ((tNode.getBBox().width * camera.height) / camera.far) * 8,\r\n      height = ((tNode.getBBox().height * camera.height) / camera.far) * 10;\r\n\r\n    const dis = dist(\r\n      [posx, posy],\r\n      [transformInfo.mouseX, transformInfo.mouseY]\r\n    );\r\n\r\n    d3.select(this).attr(\r\n      \"font-size\",\r\n      getFontSize(dis, transformInfo.zoom, camera.height, waterdropsHeight)\r\n    );\r\n\r\n    d3.select(this.parentNode.parentNode)\r\n      .select(\"image\")\r\n      .attr(\"x\", -width / 2)\r\n      .attr(\"y\", -height / 2)\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n  };\r\n}\r\n\r\nfunction fadeOutDrops(dropsMesh, scene, startOpac, duration) {\r\n  const t = d3.timer((elapsed) => {\r\n    const et = Math.min(1, elapsed / duration);\r\n\r\n    dropsMesh.updateVisibility(1 - et);\r\n    dropsMesh.updateOutlineVisibility(startOpac * (1 - et));\r\n\r\n    if (et >= 1) {\r\n      t.stop();\r\n      dropsMesh.remove(scene);\r\n    }\r\n  });\r\n}\r\n\r\nexport const helpers = {\r\n  drawMinimapSVG,\r\n  updateLargeDropSVG,\r\n  fontSizer,\r\n  fadeOutDrops,\r\n};\r\n"],"names":["App","appState","useAppState","_jsxs","AppContext","Provider","value","children","className","_jsx","id","WideView","ExamineView","CompareView","goBack","onClick","createContext","getQuantileBins","data","domain","unitsPerQuantile","width","height","numQuantiles","length","histBins","d3","d","thresholds","ticksExact","Math","ceil","binnedQuantiles","quantileBins","quantiles","b","y","push","x1","x0","start","stop","count","map","i","numericBins","maxQuantiles","bin","round","sum","Infinity","interpolateWatercolorBlue","NUM_CIRCLES","MARGIN","top","right","bottom","left","WATERDROP_ICON","draw","context","size","moveTo","lineTo","arc","SQRT2","PI","closePath","DotHistogram","_ref","objectivesData","MAX_DELIVS","goal","setGoal","shortForm","current","razorID","useRef","floor","random","razorAreaID","svgSelector","circles","useMemo","dataRange","x","range","filter","useEffect","attr","style","append","concat","call","scale","tickFormat","s","selectAll","text","razor","document","querySelector","transform","clamp","ignoreFn","e","preventDefault","dragging","addEventListener","window","removeEventListener","target","min","max","offsetX","svgCircles","select","join","enter","ref","SceneSettingStickers","settings","setColorSetting","v","onMouseEnter","onMouseLeave","SETT_NAME_FULL","SETT_VAL_STEPS","j","opacity","SceneSettingSubcard","SETT_NAME_SHORT","async","initDescriptionsData","objs","fetch","json","console","log","mapBy","descriptionsData","SCEN_DIVISOR","initObjectivesData","SCENARIO_KEY_STRING","DELIV_KEY_STRING","BASELINE_SCEN","OBJECTIVES_DATA","obj","scen","shuffle","unord","sort","a","name","_ref2","OBJECTIVE_IDS","OBJECTIVE_GOALS_MAP","goalMap","SCENARIO_IDS","Object","keys","values","KEY_SETTINGS_MAP","optArr","SETT_NUM_OPTS","key","deserialize","slice","MIN_MAXES","minmaxes","objective","baselineMax","scenariosMin","scenario","FLATTENED_DATA","DATA_GROUPINGS","flattenedData","dataGroupings","means","idx","deliveries","orderedDataGroupings","criteria","objScens","ids","sortedObjScens","sorted","mean","flat","IDtoRank","rank","initSpatialData","SPATIAL_DATA","SPATIAL_FEATURES","features","properties","CalLiteID","CALIFORNIA_OUTLINE","CALIFORNIA_CENTER","spatialData","appWidth","innerWidth","appHeight","innerHeight","state","setState","useState","activeWaterdrops","setActiveWaterdrops","setGoBack","goals","setGoals","zoomCallbacksRef","disableCamAdjustmentsRef","threeResources","renderer","setSize","time","dropsMesh","createMesh","waterdrops","timeEnd","appendChild","domElement","outlineOpacity","groups","camera","create","webglElement","node","svgElement","zoomFn","updateOutlineVisibility","k","cb","setAnimationLoop","render","scene","resetCamera","getOutlineOpacity","useCallback","val","animated","arguments","undefined","callback","farHeight","pos","getZFromFarHeight","transitionDuration","dur","zoomTo","callZoomFromWorldViewport","worldX","worldY","worldPos","interpolateZoomCamera","duration","t","elapsed","et","callZoom","addZoomHandler","setDisableCamAdjustments","disable","useDragPanels","viewTransform","panels","setPanels","panelsRef","useStateRef","mouseDownInfo","startX","deltaX","deltaY","startY","p","f","find","oldOffsetX","offsetY","oldOffsetY","onPanelDragStart","clientX","clientY","getPanelStyle","screenX","screenY","worldToScreen","LOD_1_LEVELS","LOD_1_RAD_PX","LOD_1_MIN_LEV_VAL","LOD_1_SMALL_DROP_PAD_FACTOR","LOD_1_LARGE_DROP_PAD_FACTOR","LOD_2_SMALL_DROP_PAD_FACTOR","GROUP_HOVER_AREA_FACTOR","SQRT1_2","SPREAD_1_2","WaterdropMesh","constructor","added","this","updateMeshes","initializeMeshes","add","outlineMesh","remove","dropsGeometry","MeshGeometry","MAX_POINTS_DROPS","outlinePoints","outlineMeshCoords","waterdropDeltaOutline","nodes","globalX","globalY","levs","maxLev","globalTilt","tilt","l1","l2","meshCoords","waterdropDelta","color","THREE","addMeshCoords","rotate","rotOutline","rotatePoints","copyCoords","dx","dy","finish","threeGeom","vertexColors","transparent","setFromPoints","opac","material","needsUpdate","updateVisibility","MAX_POINTS_OUTLINE","_finishCreate","_classPrivateFieldLooseKey","_THREEHandleZoom","Camera","fov","near","far","defineProperty","_THREEHandleZoom2","_finishCreate2","raycaster","_ref3","webglView","svgView","zoom","on","curTransform","_classPrivateFieldLooseBase","translate","_ref4","_ref5","endx","endy","endz","position","getFarHeightFromZ","interper","tan","toRadians","z","getScaleFromZ","getZFromScale","scaleHeight","intersectObject","mouseX","mouseY","mesh","setFromCamera","screenToWorld","scaleExtent","set","numPoints","triangleIdx","setAttribute","Float32Array","positionAttribute","getAttribute","colorAttribute","v1","v2","v3","setXYZ","r","g","setDrawRange","background","antialias","initThreeResources","createInterpsFromDelivs","delivs","minDelivs","maxDelivs","calcDomLev","reverse","demand","carryover","priority","regs","minflow","scenStr","scenNum","parseInt","generateWaterdrop","rad","delta","outer","cos","sin","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","placeDropsUsingPhysics","reuse","shape","bounds","Matter","minX","maxX","minY","maxY","genX","genY","points","contains","generateRandoPoints","WIDTH_AREA","AREA","sqrt","radsToDropWidth","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","nx","ny","circle","restitution","parts","quad","centre","vertices","isStatic","cage","setParts","setCentre","world","FPS","SECS","update","retVal","CIRC_RAD","DROP_HEIGHT","percentToRatioFilled","dist","_ref7","_ref8","y1","x2","y2","_ref6","distSq","getCenterDomRect","domRect","clipEnds","_ref9","shortenByStart","shortenByEnd","from","to","len","normed","dropCenterCorrection","_ref10","dropRadToDropHeight","avgCoords","c","rotatePoint","deg","vec","applyEuler","arr","newPoint","array","currentIndex","randomIndex","fn","newObjs","groupBy","_setState","stateRef","curVal","isState","stateInfo","stateName","wrap","replace","arrRemove","item","findIndex","indexOf","splice","Array","DROPLET_SHAPE","DROP_RAD","CIRC_HEIGHT","HAT_START","yToHalfWidth","trigX","angle","acos","yToSpriteY","spriteYToY","sy","yStart","yEnd","subdivs","abs","Y_DELTA","rightCoords","leftCoords","dx1","dy1","dx2","dy2","v4","circlet","showElems","elemStr","container","displayVal","hideElems","removeElems","gradientInit","gradId","stops","forEach","_","gradientUpdate","each","valOffset","camTransform","generateTSpan","lineHeight","lines","split","line","initWaterdrops","grouping","groupKeys","memberKeys","amtPerGroup","largeDropRad","smallDropRad","largeNodesPhys","largeNodesPos","smallNodesPhys","smallNodesPos","groupNodes","groupToNodes","nodeData","delivMin","delivMax","w","groupID","memberID","groupRank","memberRank","localTilt","parentTilt","rotatedX","rotatedY","domLev","group","groupKey","appCtx","useContext","activeMinidrop","setActiveMinidrop","colorSetting","setCamTransform","groupsRef","centerRef","viewCenter","helpers","getWaterdropGroups","updateDropsSVG","onHover","setTimeout","positions","calcLinesAndPositions","n","ox","oy","isLeft","centerX","centerY","newX","newY","correctionX","getIdealGroupPos","groupPositions","nodeID","makePanelsFromNodes","updateLabelSVG","updateScenIndicatorsSVG","updateColorDrops","_Fragment","onMouseDown","newGoal","activeMinidropsRef","curMinidropsRef","hoveredCard","setHoveredCard","removePreviewRef","positionTexts","_descriptionsData$app","_descriptionsData$app2","instrFontSize","transition","labelFontSize","display_name","addDetailPanel","dropId","preview","forceReplace","groupX","groupY","pid","_p","newPanel","panelKey","removeDetailPanel","updateActiveMinidrops","includes","classed","hoverDrop","clearTimeout","unhoverDrop","hc","svgGroup","updateSmallDropSVG","onUnhover","scenMin","ConnectLine","connectLine","circleX","circleY","cx","cy","panelBox","getBoundingClientRect","px","py","diffX","diffY","drawLineConnect","getConnectStyle","rot","radToDeg","atan2","curScreenTransform","setCurScreenTransform","currentHoveredDrop","setCurrentHoveredDrop","searchPrompt","setSearchPrompt","enableZoomRef","activeDropsRef","initSVGGraphics","cleanup","cameraListener","ti","mouseListener","registerEventListeners","drawMinimapSVG","cst","updateLargeDropSVG","updateActiveDrops","wd","fontSize","drawSVGGraphics","fontSizer","handleClickExamine","newCamPos","startZoom","startOpacity","fadeOutDrops","handleClickCompare","dropsMidpoint","handleClickDeselectAll","aw","_descriptionsData$d$k","description","desc","searchResults","fuzzysort","limit","all","type","placeholder","onChange","onFocus","onBlur","display","ActionButtons","examineBtn","compareBtn","BiCross","BiNetworkChart","largeDropInit","smallDropInit","largeDropUpdate","transitionDelay","baselinePos","textUpdate","smallDropUpdate","delay","idStr","dropBBox","getBBox","_descriptionsData$key","_descriptionsData$key2","waterdropGroups","drops","parentNode","raise","getEndGroupLoc","opacFn","getGroupLoc","_ref11","_ref12","keyArr","center","groupsObj","activeMinidropKey","groupPos","labelText","normedTextSize","textX","textY","smallTextSize","largeTextSize","waterdropGroup","interactorsInit","textGroup","interactorsUpdate","dropTransform","getFontSize","transformZoom","cameraHeight","waterdropsHeight","MAX_RAD","zoomRel","_d","minimap","proj","lineGeom","geometry","pointGeom","projection","coordinates","transformInfo","tNode","posx","posy","dis","startOpac"],"sourceRoot":""}