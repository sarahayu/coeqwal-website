"use strict";(self.webpackChunkcoeqwal_website=self.webpackChunkcoeqwal_website||[]).push([[805],{805:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.r(e),n.d(e,{default:()=>h});n(43);var a=n(96),s=n(313),o=n(621),i=n(293),c=n(336),l=n(579),d=t([s,o,i,c]);function h(){const t=(0,c.A)();return(0,l.jsxs)(a.B.Provider,{value:t,children:[(0,l.jsxs)("div",{className:"bubbles-wrapper",children:[(0,l.jsx)("div",{id:"mosaic-webgl"}),(0,l.jsx)("svg",{id:"mosaic-svg",children:(0,l.jsx)("g",{className:"svg-trans"})})]}),(0,l.jsx)(s.A,{}),(0,l.jsx)(o.A,{}),(0,l.jsx)(i.A,{}),t.goBack&&(0,l.jsx)("button",{className:"go-back-btn",onClick:t.goBack,children:"\u2190"})]})}[s,o,i,c]=d.then?(await d)():d,r()}catch(u){r(u)}}))},96:(t,e,n)=>{n.d(e,{B:()=>r});const r=(0,n(43).createContext)({})},987:(t,e,n)=>{n.d(e,{u:()=>s});var r=n(760),a=n(684);function s(t,e,n,s,o){const i=t.length/n;let c=r.histogram().value((t=>t)).domain(e).thresholds((0,a.kd)(...e,Math.ceil(s/(o/i))))(t),l=(0,a.Q2)(c,n,i),d=[];for(let r=0;r<l.length;r++)for(let e=0;e<l[r];e++)d.push([(c[r].x1+c[r].x0)/2,(e+.5)/i*t.length]);return d}},684:(t,e,n)=>{n.d(e,{Q2:()=>s,YW:()=>o,kd:()=>a});var r=n(760);n(43);function a(t,e,n){return r.range(n).map((r=>r/(n-1)*(e-t)+t))}function s(t,e,n){let a=t.map((t=>Math.round(t.length/e))),s=r.sum(a);for(;s>n;)a[r.minIndex(t,((t,n)=>0!==t.length?t.length/e-a[n]:1/0))]-=1,s=r.sum(a);for(;s<n;)a[r.maxIndex(t,((t,n)=>0!==t.length?t.length/e-a[n]:-1/0))]+=1,s=r.sum(a);return a}const o=t=>r.interpolateBlues(r.scaleLinear([.2,1])(t))},342:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{A:()=>m});var a=n(760),s=n(43),o=n(987),i=n(58),c=n(579),l=t([i]);i=(l.then?(await l)():l)[0];const u=20,h={top:10,right:10,bottom:20,left:10},p=[0,i.j.MAX_DELIVS],f={draw:function(t,e){t.moveTo(0,-e/2),t.lineTo(e/4,-e/4),t.arc(0,0,e/Math.SQRT2/2,-Math.PI/4,5*Math.PI/4),t.lineTo(0,-e/2),t.closePath()}};function m(t){let{data:e,domain:n=p,goal:r,setGoal:i,width:l=600,height:d=400,shortForm:m=!1}=t;const{current:g}=(0,s.useRef)(Math.floor(1e9*Math.random())),{current:y}=(0,s.useRef)(Math.floor(1e9*Math.random())),x=(0,s.useRef)(),_=(0,s.useMemo)((()=>(0,o.u)(e,n,e.length/u,l,d)),[e]),v=[0,e.length],A=a.scaleLinear().domain(n).range([0,l]),w=a.scaleLinear().domain(v).range([d,0]),D=_.filter((t=>t[0]>r)).length;return(0,s.useEffect)((()=>{x.current.attr("width",l+h.left+h.right).attr("height",d+h.top+h.bottom).style("pointer-events","none").append("g").attr("class","graph-area").attr("transform","translate(".concat(h.left,",").concat(h.top,")")).append("g").attr("transform","translate(0, ".concat(d,")")).call(a.axisBottom().scale(a.scaleLinear().domain(n).range([0,l])).tickFormat(a.format(".2s"))).call((t=>{t.selectAll("line").attr("stroke","gray"),t.selectAll("path").attr("stroke","gray"),t.selectAll("text").attr("fill","gray")})).append("text").attr("fill","black").attr("transform","translate(".concat(l/2,", ",30,")")).text("Delivery (TAF)");const t=document.querySelector("#i".concat(g));t.style.transform="translateX(".concat(a.scaleLinear().domain(n).range([h.left,l+h.left]).clamp(!0)(r),"px)");const e=t=>t.preventDefault();let s=!1;document.querySelector("#i".concat(g)).addEventListener("mousedown",(()=>{s=!0,window.addEventListener("selectstart",e)})),document.addEventListener("mouseup",(()=>{s=!1,window.removeEventListener("selectstart",e)})),document.querySelector("#i".concat(y)).addEventListener("mousemove",(e=>{s&&e.target.id==="i".concat(y)&&(t.style.transform="translateX(".concat(Math.min(Math.max(e.offsetX,h.left),h.left+l),"px)\n            "),i(a.scaleLinear().domain([h.left,l+h.left]).range(n).clamp(!0)(e.offsetX)))}))}),[]),(0,s.useEffect)((()=>{const t=x.current.select(".graph-area").selectAll(".icons").data(_).join((t=>t.append("g").call((t=>t.append("path"))))).attr("class","icons").call((t=>{t.selectAll("path").attr("d",a.symbol(f,d/u))}));t.attr("transform",(t=>"translate(".concat(A(t[0]),",").concat(w(t[1]),")"))),t.attr("fill",(t=>t[0]>r?"steelblue":"black"));document.querySelector("#i".concat(g)).style.transform="translateX(".concat(a.scaleLinear().domain(n).range([h.left,l+h.left]).clamp(!0)(r),"px)")}),[r,_]),(0,c.jsxs)("div",{className:"dot-".concat(y," dot-histogram-wrapper"),id:"i".concat(y),children:[(0,c.jsx)("div",{className:"pdf-razor "+(m?"short-form":""),id:"i".concat(g),children:(0,c.jsxs)("div",{children:[(0,c.jsxs)("span",{children:[(0,c.jsxs)("u",{children:[_.length-D," / ",u]})," ",m?"":"yrs WILL NOT meet demand"]}),(0,c.jsxs)("span",{children:[(0,c.jsxs)("u",{children:[D," / ",u]})," ",m?"":"yrs WILL meet demand"]})]})}),(0,c.jsx)("svg",{ref:t=>{x.current=a.select(t)}})]})}r()}catch(d){r(d)}}))},687:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{A:()=>l});var a=n(760),s=(n(43),n(152)),o=n(579),i=t([s]);function l(t){let{settings:e,setColorSetting:n}=t;return(0,o.jsx)("div",{className:"scen-settings comp-settings",children:e.map(((t,e)=>(0,o.jsxs)("div",{className:"full-card",onMouseEnter:()=>n(e),onMouseLeave:()=>n(null),children:[(0,o.jsx)("span",{children:s.RZ[e]}),(0,o.jsx)("span",{children:s.j9[e][t]}),(0,o.jsx)("div",{className:"sett-dot-wrapper",children:a.range(s.j9[e].length).map((n=>(0,o.jsx)("span",{className:"sett-dot ".concat(n<=t?"filled":"not-filled"),style:{opacity:(n+1)/s.j9[e].length}},n)))})]},e)))})}s=(i.then?(await i)():i)[0],r()}catch(c){r(c)}}))},83:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{A:()=>l});var a=n(760),s=(n(43),n(152)),o=n(579),i=t([s]);function l(t){let{settings:e,setColorSetting:n}=t;return(0,o.jsxs)("div",{className:"scen-settings",children:[(0,o.jsx)("div",{className:"condense",children:e.map(((t,e)=>(0,o.jsxs)("div",{className:"sett-dot-wrapper",children:[(0,o.jsx)("span",{children:s.kr[e]}),a.range(t+1).map((t=>(0,o.jsx)("span",{className:"sett-dot",style:{opacity:(t+1)/s.j9[e].length}},t)))]},e)))}),(0,o.jsx)("div",{className:"full",children:(0,o.jsxs)("div",{className:"full-container",children:[(0,o.jsx)("span",{children:"The settings for this scenario are:"}),e.map(((t,e)=>(0,o.jsxs)("div",{className:"full-card",onMouseEnter:()=>n(e),onMouseLeave:()=>n(null),children:[(0,o.jsx)("span",{children:s.RZ[e]}),(0,o.jsx)("span",{children:s.j9[e][t]}),(0,o.jsx)("div",{className:"sett-dot-wrapper",children:a.range(s.j9[e].length).map((n=>(0,o.jsx)("span",{className:"sett-dot ".concat(n<=t?"filled":"not-filled"),style:{opacity:(n+1)/s.j9[e].length}},n)))})]},e)))]})})]})}s=(i.then?(await i)():i)[0],r()}catch(c){r(c)}}))},693:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{G:()=>i});var a=n(956);async function o(){const t=await(await fetch("./descriptions.json")).json();return console.log("DATA: loading descriptions data"),(0,a.Et)(t,(t=>{let{id:e}=t;return e}))}const i=await o();r()}catch(s){r(s)}}),1)},58:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{j:()=>h});var a=n(760),s=n(152),o=n(550),i=n(956),c=t([s]);s=(c.then?(await c)():c)[0];const d=1;async function u(){const t="scens",e="delivs",n=await async function(){const n=await(await fetch("./objectives.json")).json();for(const r of n){for(const n of(0,o.k4)(r[t])){const t=n[e];n[e]=t.sort(((t,e)=>e-t))}r[t]=(0,i.Et)(r[t],(t=>{let{name:e}=t;return e}))}return console.log("DATA: loading objectives data"),(0,i.Et)(n,(t=>{let{obj:e}=t;return e}))}(),r=Object.keys(n),c=function(){const t={};for(let e=0;e<r.length;e++)t[r[e]]=200;return t}(),l=Object.keys(Object.values(n)[0][t]).filter(((t,e)=>e%d===0||"expl0000"===t)),u=function(){const t={},e=Object.values(s.hU);for(let n=0;n<l.length;n++){const r=l[n];t[r]=(0,s.iu)(r.slice(4)).map(((t,n)=>(t+1)/e[n]))}return t}(),[h,p]=function(){const s=[],o={objective:{},scenario:{}},i=[];let c=0;for(const u of r)for(const r of l){o.objective[u]||(o.objective[u]=[]),o.scenario[r]||(o.scenario[r]=[]),o.objective[u].push(c),o.scenario[r].push(c);const l=n[u][t][r][e];s.push({id:c,objective:u,scenario:r,deliveries:l}),i.push(a.mean(l)),c++}const d={};for(const t of Object.keys(o)){const e=[];for(const r of Object.keys(o[t])){const n=o[t][r],c=n.sort(((t,e)=>i[e]-i[t]));e.push({key:r,sorted:c,mean:a.mean(n.map((t=>s[t].deliveries)).flat())})}const n=e.sort(((t,e)=>e.mean-t.mean));d[t]={};for(let r=0;r<n.length;r++){const{key:e,sorted:a}=n[r],s={};for(let t=0;t<a.length;t++)s[a[t]]=t;d[t][e]=s,d[t][e].rank=r}}return[s,d]}();return{MAX_DELIVS:1200,SCENARIO_KEY_STRING:t,DELIV_KEY_STRING:e,OBJECTIVES_DATA:n,OBJECTIVE_IDS:r,OBJECTIVE_GOALS_MAP:c,SCENARIO_IDS:l,KEY_SETTINGS_MAP:u,FLATTENED_DATA:h,DATA_GROUPINGS:p}}const h=await u();r()}catch(l){r(l)}}),1)},82:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{l:()=>i});var a=n(956);async function o(){const t=await async function(){const t=await(await fetch("./callite_spatial.json")).json();return console.log("DATA: loading callite spatial data"),t}(),e=(0,a.Et)(t.features,(t=>{let{properties:e}=t;return e.CalLiteID})),n=await async function(){const t=await(await fetch("./california.json")).json();return console.log("DATA: loading california spatial data"),t}();return{SPATIAL_DATA:t,SPATIAL_FEATURES:e,CALIFORNIA_OUTLINE:n,CALIFORNIA_CENTER:[-119,37.7749]}}const i=await o();r()}catch(s){r(s)}}),1)},336:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{A:()=>p});var a=n(760),s=n(43),o=n(58),i=n(575),c=n(924),l=t([o,c]);[o,c]=l.then?(await l)():l;const u=window.innerWidth,h=window.innerHeight;function p(){const[t,e]=(0,s.useState)({}),[n,r]=(0,s.useState)([]),[l,d]=(0,s.useState)(null),[p,f]=(0,s.useState)(o.j.OBJECTIVE_GOALS_MAP),m=(0,s.useRef)([]),g=(0,s.useRef)(!1);(0,s.useEffect)((function(){i.e.renderer.setSize(u,h),console.time("drops mesh creating"),i.e.dropsMesh.createMesh(c.W),console.timeEnd("drops mesh creating"),document.querySelector("#mosaic-webgl").appendChild(i.e.renderer.domElement),a.select("#mosaic-svg").attr("width",u).attr("height",h);const t=a.scaleLinear().domain([h/c.W.height,h/c.W.groups[0].height]).range([.1,1]).clamp(!0);i.e.camera.create({width:u,height:h,webglElement:a.select(".bubbles-wrapper").node(),svgElement:a.select("#mosaic-svg").select(".svg-trans").node(),zoomFn:e=>{g.current||i.e.dropsMesh.updateOutlineVisibility(t(e.k));for(const t of m.current)t(e)}}),i.e.renderer.setAnimationLoop((()=>{i.e.renderer.render(i.e.scene,i.e.camera.camera)})),x(),e({state:"WideView"})}),[]);const y=(0,s.useCallback)((t=>a.scaleLinear().domain([h/c.W.height,h/c.W.groups[0].height]).range([.1,1]).clamp(!0)(t)),[]),x=(0,s.useCallback)((function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;const n=1.2*c.W.height,r=[0,.08*-c.W.height,i.e.camera.getZFromFarHeight(n)];let a=0;if(t){const[t,n]=_(r,e);a=n,t()}else i.e.camera.callZoomFromWorldViewport({worldX:r[0],worldY:-r[1],farHeight:n}),e&&e();return a}),[]),_=(0,s.useCallback)((function(t,e){const n=i.e.camera.interpolateZoomCamera(t),r=n.duration/2;return[()=>{const t=a.timer((a=>{const s=Math.min(a/r,1);i.e.camera.callZoom(n(s)),1===s&&(t.stop(),e&&e())}))},r]}),[]),v=(0,s.useCallback)((function(t){m.current.push(t)}),[]),A=(0,s.useCallback)((function(t){g.current=t}));return{appWidth:u,appHeight:h,state:t,setState:e,activeWaterdrops:n,setActiveWaterdrops:r,setDisableCamAdjustments:A,waterdrops:c.W,goBack:l,setGoBack:d,zoomTo:_,resetCamera:x,getOutlineOpacity:y,addZoomHandler:v,goals:p,setGoals:f,...i.e}}r()}catch(d){r(d)}}))},368:(t,e,n)=>{n.d(e,{J:()=>o});var r=n(43),a=n(972),s=n(956);function o(t){const[e,n,o]=(0,s.iJ)([]),i=(0,r.useRef)({});(0,r.useEffect)((function(){window.addEventListener("mousemove",(t=>{void 0!==i.current.startX&&(i.current.deltaX=t.x-i.current.startX,i.current.deltaY=t.y-i.current.startY,n((t=>{if(void 0===i.current.startX)return t;const e=t.find((t=>t.id===i.current.id));return e.offsetX=e.oldOffsetX+i.current.deltaX,e.offsetY=e.oldOffsetY+i.current.deltaY,[...t]})))})),window.addEventListener("mouseup",(t=>{void 0!==i.current.startX&&(i.current={})}))}),[]);const c=(0,r.useCallback)((function(t,e){let{id:r}=e;""!==t.target.className&&(t.preventDefault(),i.current={startX:t.clientX,startY:t.clientY,id:r},n((t=>{const e=t.find((t=>t.id===r));return e.oldOffsetX=e.offsetX,e.oldOffsetY=e.offsetY,[...t]})))}),[]);return{panels:e,panelsRef:o,setPanels:n,onPanelDragStart:c,getPanelStyle:function(e){let{x:n,y:r,offsetX:s,offsetY:o}=e;const[i,c]=(0,a.UK)(n,r,t);return{left:"".concat(i+s,"px"),top:"".concat(c+o,"px")}}}}},385:(t,e,n)=>{n.d(e,{W:()=>r});const r={LOD_1_LEVELS:10,LOD_1_RAD_PX:1,LOD_1_MIN_LEV_VAL:.1,LOD_1_SMALL_DROP_PAD_FACTOR:3,LOD_1_LARGE_DROP_PAD_FACTOR:1.2,LOD_2_SMALL_DROP_PAD_FACTOR:3,GROUP_HOVER_AREA_FACTOR:1.1/(1+Math.SQRT1_2),SPREAD_1_2:1}},575:(t,e,n)=>{n.d(e,{e:()=>_});var r=n(408),a=n(473),s=n(341),o=n(760),i=n(684),c=n(385),l=n(956),d=n(550),u=n(972);class h{constructor(){this.added=!1}createMesh(t){this.dropsMesh?this.updateMeshes(t):this.initializeMeshes(t)}draw(t){this.added||(t.add(this.dropsMesh),t.add(this.outlineMesh),this.added=!0)}remove(t){this.added&&(t.remove(this.dropsMesh),t.remove(this.outlineMesh),this.added=!1)}initializeMeshes(t){const e=new x(h.MAX_POINTS_DROPS),n=[],a=(0,u.bp)(0,1,2*c.W.LOD_1_RAD_PX*.975);for(let s=0;s<t.nodes.length;s++){const{id:o,globalX:h,globalY:p,levs:f,maxLev:m,globalTilt:g}=t.nodes[s];for(let t=f.length-1;t>=0;t--){const n=t!==f.length-1?f[t+1]:0,a=f[t],o=(0,u.Ng)(n/m,a/m,2*c.W.LOD_1_RAD_PX),l=new r.Q1f((0,i.YW)(t/c.W.LOD_1_LEVELS));e.addMeshCoords(o,{x:h,y:-p,rotate:g},l,s%5/50+.02)}const y=(0,d.Hb)((0,l.K7)(a),g);n.push(...y.map((t=>{let[e,n]=t;return new r.Pq0(h+e,-p-n,s%5/50+.01)})))}e.finish(),this.dropsMesh=new r.eaF(e.threeGeom,new r.V9B({vertexColors:!0,transparent:!0,opacity:1})),this.outlineMesh=new r.DXC((new r.LoY).setFromPoints(n),new r.mrM({color:13421772,transparent:!0,opacity:0}))}updateOutlineVisibility(t){this.outlineMesh&&(this.outlineMesh.material.opacity=t,this.outlineMesh.material.needsUpdate=!0)}updateVisibility(t){this.outlineMesh&&this.dropsMesh&&(this.outlineMesh.material.opacity=t,this.outlineMesh.material.needsUpdate=!0,this.dropsMesh.material.opacity=t,this.dropsMesh.material.needsUpdate=!0)}updateMeshes(t){}}h.MAX_POINTS_DROPS=78e5,h.MAX_POINTS_OUTLINE=52e5;var p=(0,s.A)("finishCreate"),f=(0,s.A)("THREEHandleZoom");class m{constructor(t){let{fov:e,near:n,far:a}=t;Object.defineProperty(this,f,{value:y}),Object.defineProperty(this,p,{value:g}),this.raycaster=new r.tBo,this.fov=e,this.near=n,this.far=a}create(t){let{width:e,height:n,webglElement:r,svgElement:s,zoomFn:i}=t;this.width=e,this.height=n,this.webglView=o.select(r),this.svgView=o.select(s),this.zoom=o.zoom().on("zoom",(t=>{this.curTransform=t.transform,(0,a.A)(this,f)[f](t.transform),this.svgView.attr("transform",t.transform),i&&i(t.transform)})),(0,a.A)(this,p)[p]()}callZoom(t){this.zoom.transform(this.webglView,o.zoomIdentity.translate(t.x,t.y).scale(t.k))}callZoomFromWorldViewport(t){let{worldX:e,worldY:n,farHeight:r}=t;const a=this.height/r,s=-e*a+this.width/2,o=n*a+this.height/2;this.callZoom({x:s,y:o,k:a})}interpolateZoomCamera(t){let[e,n,r]=t;const a=o.interpolateZoom([this.camera.position.x,this.camera.position.y,this.height/this.curTransform.k],[e,-n,this.getFarHeightFromZ(r)]),s=t=>{const[e,n,r]=a(t),s=this.height/r;return{x:-e*s+this.width/2,y:n*s+this.height/2,k:s}};return s.duration=a.duration,s}getZFromFarHeight(t){return Math.tan((0,d.eh)(90-this.fov/2))*t/2}getFarHeightFromZ(t){return Math.tan((0,d.eh)(this.fov)/2)*t*2}getScaleFromZ(t){const e=this.getFarHeightFromZ(t);return this.height/e}getZFromScale(t){const e=this.height/t;return this.getZFromFarHeight(e)}intersectObject(t,e,n){return this.raycaster.setFromCamera({x:t,y:e},this.camera),this.raycaster.intersectObject(n)}worldToScreen(t,e){return(0,u.UK)(t,e,this.curTransform)}screenToWorld(t,e){return(0,u.UT)(t,e,this.curTransform)}}function g(){this.zoom=this.zoom.scaleExtent([this.getScaleFromZ(this.far),this.getScaleFromZ(this.near)]),this.camera=new r.ubm(this.fov,this.width/this.height,this.near,this.far+1),this.camera.position.set(0,0,this.far),this.webglView.call(this.zoom),this.zoom.transform(this.webglView,o.zoomIdentity.translate(this.width/2,this.height/2).scale(this.getScaleFromZ(this.far)))}function y(t){const e=t.k,n=-(t.x-this.width/2)/e,r=(t.y-this.height/2)/e,a=this.getZFromScale(e);this.camera.position.set(n,r,a)}class x{constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.threeGeom=new r.LoY,this.triangleIdx=0,this.threeGeom.setAttribute("position",new r.THS(new Float32Array(3*t),3)),e&&this.threeGeom.setAttribute("color",new r.THS(new Float32Array(3*t),3)),this.positionAttribute=this.threeGeom.getAttribute("position"),this.colorAttribute=this.threeGeom.getAttribute("color")}addMeshCoords(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(let a=0;a<t.length;a++){const[s,o,i]=(0,d.Hb)((0,l.K7)(t[a]),e.rotate);this.positionAttribute.setXYZ(3*this.triangleIdx+0,e.x+s[0],e.y-s[1],r),this.positionAttribute.setXYZ(3*this.triangleIdx+1,e.x+o[0],e.y-o[1],r),this.positionAttribute.setXYZ(3*this.triangleIdx+2,e.x+i[0],e.y-i[1],r),n&&(this.colorAttribute.setXYZ(3*this.triangleIdx+0,n.r,n.g,n.b),this.colorAttribute.setXYZ(3*this.triangleIdx+1,n.r,n.g,n.b),this.colorAttribute.setXYZ(3*this.triangleIdx+2,n.r,n.g,n.b)),this.triangleIdx++}}finish(){this.threeGeom.setDrawRange(0,3*this.triangleIdx)}}const _=function(){const t=function(){const t=new r.Z58;return t.background=new r.Q1f(15724527),t}(),e=new h;return{scene:t,camera:new m({fov:45,near:1,far:3e3}),renderer:new r.JeP({antialias:!0}),dropsMesh:e}}()},152:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{Dq:()=>d,Dy:()=>l,RZ:()=>h,hU:()=>f,iu:()=>m,j9:()=>p,kr:()=>u});var a=n(760),s=n(684),o=n(58),i=t([o]);function l(t,e){return a.scaleLinear().domain((0,s.kd)(0,1,t.length)).range(t.map((t=>Math.min(1,t/e)))).clamp(!0)}function d(t){t=[1,...t,0];let e=0;for(let n=0;n<t.length-1;n++){e+=(t[n]-t[n+1])*(n-1)/(t.length+4)}return e}o=(i.then?(await i)():i)[0];const u=["D","C","P","R","M"],h=["Demand","Carryover","Priority","Regs.","Min. Flow"],p=[[1,.9,.8,.7,.6].reverse(),[1,1.2,1.3],[0,1],[1,2,3,4],[0,.4,.6,.7,.8]],f={demand:p[0].length,carryover:p[1].length,priority:p[2].length,regs:p[3].length,minflow:p[4].length};function m(t){let e=parseInt(t);const n=e%f.minflow;e=(e-n)/f.minflow;const r=e%f.regs;e=(e-r)/f.regs;const a=e%f.priority;e=(e-a)/f.priority;const s=e%f.carryover;e=(e-s)/f.carryover;const o=e%f.demand;return[f.demand-1-o,s,a,r,n]}r()}catch(c){r(c)}}))},550:(t,e,n)=>{n.d(e,{D5:()=>_,Hb:()=>D,eh:()=>g,hh:()=>f,jF:()=>v,k4:()=>j,kt:()=>x,p6:()=>A,sR:()=>w,si:()=>m,xg:()=>y});var r=n(760),a=n(408),s=n(783),o=n.n(s),i=n(972);function c(t){const e=t/2,n=3*Math.PI/2/16,r=[{x:Math.cos(5*Math.PI/4)*e,y:Math.sin(5*Math.PI/4)*e},{x:0,y:-Math.SQRT2*e}];for(let a=0;a<=16;a++)r.push({x:Math.cos(a*n-Math.PI/4)*e,y:Math.sin(a*n-Math.PI/4)*e});return r}const l=function(){const t=c(3),e=c(1),n=[];for(let r=0;r<t.length-2;r++)n.push([t[r],t[r+(r<2?1:2)],e[r+(r<2?1:2)],e[r]]);return n}();let d,u,h,p;function f(t,e,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(a&&h&&n.length===p)return h;d&&n.length===u||(d=r.range(4).map((()=>function(t,e){const n=o().Bounds.create(t),a=n.min.x,s=n.max.x,i=n.min.y,c=n.max.y,l=r.scaleLinear([a,s]),d=r.scaleLinear([i,c]),u=[];for(let r=0;r<e;r++)for(;;){const e=l(Math.random()),n=d(Math.random());if(o().Vertices.contains(t,{x:e,y:n})){u.push([e,n]);break}}return u}(c(1),u=n.length))));const s=function(t){const e=r.sum(t.map((t=>t**2*3.14)));return Math.floor(2*Math.sqrt(e/3.14)/2)}(n.map((t=>{let{r:e}=t;return e}))),f=d[Math.floor(Math.random()*d.length)].map((t=>{let[e,n]=t;return[e*s,n*s]})),m=o().Engine,g=o().Bodies,y=o().Composite,x=m.create(),_=f.sort(((t,e)=>e[1]-t[1])),v=n.map(((t,e)=>{let{r:n,id:r}=t;const[a,s]=_[e];return g.circle(a,s,n,{restitution:0,id:r})})),A=l.map((t=>o().Body.create({position:o().Vertices.centre(t),vertices:t,isStatic:!0}))),w=o().Body.create({isStatic:!0});o().Body.setParts(w,A),o().Body.setCentre(w,{x:0,y:0}),o().Body.scale(w,s,s),y.add(x.world,[...v,w]);for(let r=0,o=60,i=.1;r<o*i;r++)m.update(x,1e3/o);const D=v.map((n=>{let{position:r,id:a}=n;return{id:a,x:r.x+t,y:r.y+e}}));return D.height=s/2/i.Sz*i.IC,!a||h&&D.length===p||(h=D,p=D.length),D}function m(t){return e=(3.1304*(t-=.0088)**3-4.2384*t**2+3.3471*t+.0298)/2.2326,n=0,r=1,Math.max(n,Math.min(r,e));var e,n,r}function g(t){return t*Math.PI/180}function y(t,e){let[n,r]=t,[a,s]=e;return Math.sqrt(function(t,e){let[n,r]=t,[a,s]=e;return(a-n)**2+(s-r)**2}([n,r],[a,s]))}function x(t){return[t.left+t.width/2,t.top+t.height/2]}function _(t,e,n){let[r,a]=t;const s=Math.sqrt((r[0]-a[0])**2+(r[1]-a[1])**2),o=[(a[0]-r[0])/s,(a[1]-r[1])/s];return void 0===n&&(n=e),r[0]+=o[0]*e,r[1]+=o[1]*e,a[0]-=o[0]*n,a[1]-=o[1]*n,[r,a]}function v(t){let{rad:e,height:n}=t;return void 0!==e?.08*function(t){return(1+Math.SQRT2)*t}(e):.08*n}function A(t){return[r.mean(t,(t=>t[0])),r.mean(t,(t=>t[1]))]}function w(t,e,n){const r=new a.Pq0(t,e,0).applyEuler(new a.O9p(0,0,g(n)));return[r.x,r.y]}function D(t,e){for(const n of t){const t=w(n[0],n[1],e);n[0]=t[0],n[1]=t[1]}return t}function j(t){let e=t.length;for(;0!=e;){let n=Math.floor(Math.random()*e);e--,[t[e],t[n]]=[t[n],t[e]]}return t}},956:(t,e,n)=>{n.d(e,{Et:()=>a,K7:()=>l,LV:()=>i,ad:()=>o,iJ:()=>s,od:()=>c});var r=n(43);function a(t,e){const n=Object.groupBy(t,e);for(const r of Object.keys(n))n[r]=n[r][0];return n}function s(t){const[e,n]=(0,r.useState)(t),a=(0,r.useRef)(t);(0,r.useEffect)((()=>{a.current=e}),[e]);const s=(0,r.useCallback)((t=>{n("function"===typeof t?e=>a.current=t(e):a.current=t)}),[]);return[e,s,a]}function o(t,e){return t&&t.state===e}function i(t){return t.replace(/(?![^\n]{1,15}$)([^\n]{1,15})\s/g,"$1\n")}function c(t,e){let n;return n="function"===typeof e?t.findIndex(e):t.indexOf(e),-1!==n&&t.splice(n,1),t}function l(t){return t.map((t=>Array.from(t)))}},972:(t,e,n)=>{n.d(e,{GI:()=>j,IC:()=>h,JB:()=>_,Ng:()=>x,Sz:()=>l,UK:()=>b,UT:()=>E,YB:()=>v,Y_:()=>S,bp:()=>y,f2:()=>A,h7:()=>w,ji:()=>D,js:()=>c});var r=n(684),a=n(760),s=n(385),o=n(956),i=n(550);const c="M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z",l=Math.SQRT1_2,d=1,u=l+l,h=d+l,p=(l+d/2)/h;function f(t){if(t>=p){return Math.SQRT1_2*(1-t)/(1-p)}const e=2*(1-t/(u/h))-1,n=Math.acos(e);return Math.sin(n)}function m(t){return(t-l/h)*(1+Math.SQRT2)}function g(t){return t/(1+Math.SQRT2)+l/h}function y(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;if(Math.abs(t-e)<.01)return[];const a=n/2/d*l,s=1/r,o=[],i=[];let c,u,h,p;for(let l=1;l<=Math.ceil(1/s)&&(c=f(t+(l-1)*s),u=m(t+(l-1)*s),h=f(t+l*s),p=m(t+l*s),!(g(p)>=e));l++){const t=[-c*a,-u*a],e=[c*a,-u*a],n=[h*a,-p*a],r=[-h*a,-p*a];o.push(e,n),i.push(t,r)}h=f(e),p=m(e);const y=[-c*a,-u*a],x=[c*a,-u*a],_=[h*a,-p*a],v=[-h*a,-p*a];return o.push(x,_),i.push(y,v),o.push(...i.reverse()),o}function x(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(Math.abs(t-e)<.01)return[];const r=n/2/d*l,a=.1,s=[];let o,i,c,u;for(let l=1;l<=Math.ceil(10)&&(o=f(t+(l-1)*a),i=m(t+(l-1)*a),c=f(t+l*a),u=m(t+l*a),!(g(u)>=e));l++){const t=[-o*r,-i*r],e=[o*r,-i*r],n=[c*r,-u*r],a=[-c*r,-u*r];s.push([t,e,n]),s.push([t,n,a])}c=f(e),u=m(e);const h=[-o*r,-i*r],p=[o*r,-i*r],y=[c*r,-u*r],x=[-c*r,-u*r];return s.push([h,p,y]),s.push([h,y,x]),s}function _(t){t.attr("fill","transparent").attr("stroke","orange").attr("stroke-dasharray",3).attr("stroke-width",3).attr("vector-effect","non-scaling-stroke")}function v(t,e,n){(e||a).selectAll(t).style("display",n||"block")}function A(t,e){(e||a).selectAll(t).style("display","none")}function w(t,e){(e||a).selectAll(t).remove()}function D(t,e){return n=>{const a=n.append("defs").append("linearGradient").attr("id",e).attr("x1","0%").attr("x2","0%").attr("y1","0%").attr("y2","100%");a.append("stop").attr("stop-color","transparent"),a.append("stop").attr("stop-color","transparent"),t.forEach(((t,e)=>{for(let n=0;n<2;n++)a.append("stop").attr("stop-color",(0,r.YW)(e/s.W.LOD_1_LEVELS))}))}}function j(t,e){return n=>{n.selectAll("stop").each((function(n,r){if(0===r)return void a.select(this).attr("offset","0%");if(r===2*(t.length+1)-1)return void a.select(this).attr("offset","100%");let s=Math.floor((r-1)/2);a.select(this).attr("offset","".concat(100*(1-(0,i.si)(t[s]/e)),"%"))}))}}function b(t,e,n){return[t*n.k+n.x,e*n.k+n.y]}function E(t,e,n){return[(t-n.x)/n.k,(e-n.y)/n.k]}function S(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.2;return n=>{n.selectAll("*").remove();const r="string"===typeof t?(0,o.LV)(t).split("\n"):t,a=n.attr("x");r.forEach((t=>{n.append("tspan").attr("x",a).attr("dy","".concat(e,"em")).text(t)}))}}},924:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{W:()=>f});var a=n(760),s=n(684),o=n(385),i=n(58),c=n(152),l=n(550),d=n(956),u=t([i,c]);function p(t){console.time("init waterdrops");const e="objective"===t?i.j.OBJECTIVE_IDS:i.j.SCENARIO_IDS,n="objective"===t?i.j.SCENARIO_IDS:i.j.OBJECTIVE_IDS,r=(e.length,n.length),u=Math.sqrt(r/Math.PI)*o.W.LOD_1_RAD_PX*2*o.W.LOD_1_SMALL_DROP_PAD_FACTOR*o.W.LOD_1_LARGE_DROP_PAD_FACTOR,h=o.W.LOD_1_RAD_PX*o.W.LOD_1_SMALL_DROP_PAD_FACTOR,p=(0,l.hh)(0,0,e.map(((t,e)=>({r:u,id:e}))));for(let a=0;a<p.length;a++)p[a].tilt=0;const f=(0,d.Et)(p,(t=>{let{id:e}=t;return e})),m=(0,l.hh)(0,0,n.map(((t,e)=>({r:h,id:e})))),g=(0,d.Et)(m,(t=>{let{id:e}=t;return e})),y=[],x=[],_={};for(const d of i.j.FLATTENED_DATA){const{id:e,objective:n,scenario:r,deliveries:u}=d,h=(0,c.Dy)(u,a.max(i.j.OBJECTIVES_DATA[n][i.j.SCENARIO_KEY_STRING].expl0000[i.j.DELIV_KEY_STRING])),p=(0,s.kd)(0,1,o.W.LOD_1_LEVELS+1).map((t=>h(t))).map(((t,e)=>Math.max(t,0==e?o.W.LOD_1_MIN_LEV_VAL:0)*o.W.LOD_1_RAD_PX)),m="objective"===t?n:r,x="objective"===t?r:n,v=i.j.DATA_GROUPINGS[t][m].rank,A=i.j.DATA_GROUPINGS[t][m][e],w=0,D=f[v].tilt,{x:j,y:b}=g[A],[E,S]=(0,l.sR)(j,b,D),L={id:e,levs:p,maxLev:o.W.LOD_1_RAD_PX,domLev:(0,c.Dq)(p),tilt:w,dur:100*Math.random()+400,x:j,y:b,group:m,key:x,globalX:f[v].x+E,globalY:f[v].y+S,globalTilt:D+w};y.push(L),_[m]||(_[m]=[]),_[m].push(L)}for(const a of e){const{x:e,y:n,tilt:r}=f[i.j.DATA_GROUPINGS[t][a].rank];x.push({x:e,y:n,tilt:r,key:a,height:m.height,nodes:_[a]})}return console.timeEnd("init waterdrops"),{nodes:y,groups:x,height:p.height}}[i,c]=u.then?(await u)():u;const f=p("objective");r()}catch(h){r(h)}}))},293:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{A:()=>v});var a=n(760),s=n(43),o=n(96),i=n(342),c=n(687),l=n(58),d=n(385),u=n(550),h=n(956),p=n(972),f=n(152),m=n(368),g=n(701),y=n(579),x=t([i,c,l,f,g]);function v(){const t=(0,s.useContext)(o.B),[e,n]=(0,s.useState)(),[r,x]=(0,s.useState)(null),[_,v]=(0,s.useState)(a.zoomIdentity),{panels:A,setPanels:w,onPanelDragStart:D,getPanelStyle:j}=(0,m.J)(_),b=(0,s.useRef)(),E=(0,s.useRef)();return(0,s.useEffect)((function(){const e=a.select("#mosaic-svg").select(".svg-trans").append("g").attr("id","compare-group");e.append("text").attr("id","member-variable"),e.append("text").attr("id","member-label"),t.addZoomHandler((function(t){v(t)}))}),[]),(0,s.useEffect)((function(){if((0,h.ad)(t.state,"CompareView")){const e=a.select("#compare-group"),{viewCenter:r,transitionDuration:s=0}=t.state;return E.current=r,b.current=g._.getWaterdropGroups(t.activeWaterdrops,t.waterdrops,r),g._.updateDropsSVG(e,b.current,s/5,{onHover:t=>{n({key:t.key})}}),(0,p.f2)(".large-gray-text",e),setTimeout((()=>{n({key:b.current.groups[0].nodes[0].key}),(0,p.YB)("#member-variable, #member-label, .large-gray-text",e),(0,p.YB)(".comp-settings",a,"flex")}),s+500),t.setGoBack((()=>()=>{const e=t.resetCamera();t.setState({state:"WideView",transitionDuration:e})})),v(t.camera.curTransform),function(){(0,p.h7)(".large-drop, .circlet, .comp-line",e),(0,p.f2)("#member-variable, #member-label",e),(0,p.f2)(".comp-settings"),w([]),t.setGoBack(null)}}}),[t.state]),(0,s.useEffect)((function(){if(e){const[t,n,r]=g._.calcLinesAndPositions(b.current,e.key);w(function(t){return e=>t.map(((t,n)=>{let r=0,a=0;e[n]&&(r=e[n].offsetX,a=e[n].offsetY);const[s,o,i]=function(t,e){let[n,r]=t,[a,s]=e,o=n,i=r;const c=2*b.current.groups[0].height;o<a?o-=c:o+=c;return[o,i,o<a]}(b.current.groupPositions[n],E.current);return{text:t.key,x:s,y:o,id:b.current.groups[n].key,nodeID:t.id,isLeft:i,offsetX:r,offsetY:a}}))}(r)),g._.updateLabelSVG((0,u.p6)(t),e.key.slice(4),b.current.groups[0].height*d.W.SPREAD_1_2),g._.updateScenIndicatorsSVG(t,n)}}),[e]),(0,s.useEffect)((function(){const t=a.select("#compare-group");if(null===r)return(0,p.f2)(".color-drop-group",t),void(0,p.YB)(".large-drop",t);g._.updateColorDrops(t,b.current,(t=>l.j.KEY_SETTINGS_MAP[t][r]),["red","orange","blue","green","magenta"][r]),(0,p.YB)(".color-drop-group",t),(0,p.f2)(".large-drop",t)}),[r]),(0,y.jsxs)(y.Fragment,{children:[e&&(0,y.jsx)(c.A,{settings:(0,f.iu)(e.key.slice(4)),setColorSetting:x}),A.map(((e,n)=>{let{x:r,y:a,id:s,isLeft:o,offsetX:c,offsetY:d,nodeID:u}=e;return(0,y.jsx)("div",{className:"panel compare-panel"+(o?" left":""),style:j({x:r,y:a,offsetX:c,offsetY:d}),onMouseDown:t=>D(t,{id:s}),children:(0,y.jsx)(i.A,{width:300,height:200,data:l.j.FLATTENED_DATA[u].deliveries,goal:t.goals[s],setGoal:e=>{t.setGoals((t=>(t[s]=e,{...t})))}})},n)}))]})}[i,c,l,f,g]=x.then?(await x)():x,r()}catch(_){r(_)}}))},621:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{A:()=>w});var a=n(760),s=n(43),o=n(96),i=n(342),c=n(83),l=n(58),d=n(385),u=n(693),h=n(956),p=n(972),f=n(152),m=n(550),g=n(186),y=n(368),x=n(285),_=n(579),v=t([i,c,l,u,f]);function w(){const t=(0,s.useContext)(o.B),e=(0,s.useRef)([]),n=(0,s.useRef)(null),[r,g]=(0,s.useState)(null),[v,A]=(0,s.useState)(a.zoomIdentity),{panels:w,panelsRef:j,setPanels:b,onPanelDragStart:E,getPanelStyle:S}=(0,y.J)(v),[L,k]=(0,s.useState)(null),R=(0,s.useRef)(null);function M(){var e,r;const s=16/t.camera.height*t.camera.getZFromFarHeight(n.current.height*d.W.SPREAD_1_2*1.5);a.select("#examine-group .instruction-text").attr("x",n.current.x-n.current.height*d.W.SPREAD_1_2*.8).attr("y",n.current.y-s).attr("opacity",0).attr("text-anchor","end").attr("font-size",s).call((0,p.Y_)(["click to show panels.","you can drag panels."],1.6)).call((t=>{t.transition().attr("opacity",1)})).selectAll("tspan").each((function(t,e){a.select(this).attr("dx",e*s)}));const o=20/t.camera.height*t.camera.getZFromFarHeight(n.current.height*d.W.SPREAD_1_2*1.5);a.select("#examine-group .large-drop-label").attr("x",n.current.x).attr("y",n.current.y+n.current.height/2*d.W.SPREAD_1_2*.9).attr("opacity",0).attr("text-anchor","middle").attr("font-size",o).call((0,p.Y_)((null===(e=u.G[t.activeWaterdrops[0]])||void 0===e?void 0:e.display_name)||(null===(r=u.G[t.activeWaterdrops[0]])||void 0===r?void 0:r.id)||t.activeWaterdrops[0],1.2)).transition().attr("opacity",1)}function P(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{x:s,y:o}=n.current,{x:i,y:c,id:l,key:u}=t.waterdrops.nodes[e];b((t=>{if(-1!==t.findIndex((t=>{let{id:e}=t;return l===e}))){if(!a)return t;(0,h.od)(t,(t=>t.id===l))}const n={text:u.slice(4),x:s+i*d.W.SPREAD_1_2,y:o+c*d.W.SPREAD_1_2,offsetX:20,offsetY:40,id:l,preview:r,panelKey:r?-1:e};return[...t,n]}))}function O(t){b((e=>((0,h.od)(e,(e=>{let{id:n}=e;return t===n})),[...e])))}function T(t){const n=a.select("#examine-group");e.current.includes(t.id)?((0,h.od)(e.current,t.id),n.select(".circlet#i".concat(t.id)).classed("active",!1),O(t.id),k(null)):(O(t.id),e.current.push(t.id),n.select(".circlet#i".concat(t.id)).classed("active",!0),P(t.id),k(t.id))}function C(t){e.current.includes(t.id)?(a.select(".examine-panel#p".concat(t.id)).style("z-index",100),k(t.id)):(R.current&&(clearTimeout(R.current),b((t=>((0,h.od)(t,(t=>{let{panelKey:e}=t;return-1===e})),[...t])))),P(t.id,!0))}function I(t){e.current.includes(t.id)||(R.current=setTimeout((()=>{O(t.id),R.current=null}),100)),k((e=>e===t.id?null:e)),a.select(".examine-panel#p".concat(t.id)).style("z-index",0)}if((0,s.useEffect)((function(){const e=a.select("#mosaic-svg").select(".svg-trans").append("g").attr("id","examine-group");e.append("circle").attr("class","highlight-circle"),e.append("path").attr("class","connect-line"),e.append("text").attr("class","instruction-text large-gray-text fancy-font"),e.append("text").attr("class","large-drop-label large-gray-text fancy-font"),t.addZoomHandler((function(t){A(t)}))}),[]),(0,s.useEffect)((function(){if((0,h.ad)(t.state,"ExamineView")){const{transitionDuration:r=0}=t.state,s=a.select("#examine-group");return n.current=t.waterdrops.groups.find((e=>e.key===t.activeWaterdrops[0])),x._.updateSmallDropSVG(s,n.current,r/2,{onClick:T,onHover:C,onUnhover:I}),setTimeout(M,1.2*r),t.setGoBack((()=>()=>{const e=t.resetCamera();t.setState({state:"WideView",transitionDuration:e})})),A(t.camera.curTransform),(0,p.YB)("#examine-group"),function(){(0,p.h7)(".small-drop, .circlet",s),(0,p.f2)("#examine-group"),a.selectAll("#examine-group .instruction-text, #examine-group .large-drop-label").attr("opacity",0),b([]),e.current=[],n.current=null,t.setGoBack(null)}}}),[t.state]),(0,s.useEffect)((function(){const t=a.select("#examine-group");if(null===r)return(0,p.f2)(".color-drop",t),void(0,p.YB)(".small-drop",t);x._.updateColorDrops(t,n.current,(t=>l.j.KEY_SETTINGS_MAP[t][r]),["red","orange","blue","green","magenta"][r]),(0,p.YB)(".color-drop",t),(0,p.f2)(".small-drop",t)}),[r]),(0,h.ad)(t.state,"ExamineView"))return(0,_.jsxs)(_.Fragment,{children:[w.map((e=>{let{text:n,x:r,y:s,id:o,offsetX:d,offsetY:u,panelKey:h,preview:p}=e;const{objective:m,scenario:y}=l.j.FLATTENED_DATA[o],x=a.max(l.j.OBJECTIVES_DATA[m][l.j.SCENARIO_KEY_STRING][y][l.j.DELIV_KEY_STRING]);return(0,_.jsxs)("div",{className:"panel examine-panel ".concat(p?"preview":""),id:"p".concat(o),style:S({x:r,y:s,offsetX:d,offsetY:u}),onMouseDown:t=>!p&&E(t,{id:o}),onMouseEnter:()=>!p&&C({id:o}),onMouseLeave:()=>!p&&I({id:o}),children:[(0,_.jsxs)("div",{className:"panel-tab",children:["scenario ",(0,_.jsx)("span",{children:n})]}),(0,_.jsx)(i.A,{width:300,height:200,data:l.j.FLATTENED_DATA[o].deliveries,domain:[0,x],goal:t.goals[t.activeWaterdrops[0]],setGoal:e=>{t.setGoals((n=>(n[t.activeWaterdrops[0]]=e,{...n})))}}),(0,_.jsx)(c.A,{settings:(0,f.iu)(n),setColorSetting:g})]},p?-1:o)})),L&&(0,_.jsx)(D,{connectLine:function(e){if(-1===j.current.findIndex((t=>{let{id:n}=t;return e===n})))return;const{x:n,y:r}=j.current.find((t=>t.id===e)),[s,o]=t.camera.worldToScreen(n,r),i=a.select(".examine-panel#p".concat(e)).node().getBoundingClientRect(),[c,l]=[i.left+i.width/2,i.top+i.height/2],d=c-s,u=l-o;let h,p;return Math.abs(d)>Math.abs(u)?(p=0,h=(d<0?1:-1)*(i.width/2-5)):(h=0,p=(u<0?1:-1)*(i.height/2-5)),(0,m.D5)([[s,o],[c+h,l+p]],8,0)}(L)})]})}function D(t){let{connectLine:e}=t;return(0,_.jsx)("div",{className:"connect-line",style:j(...e),children:(0,_.jsx)("div",{className:"connect-line-container"})})}function j(t,e){const n=(0,m.xg)(t,e),r=(0,g.H)(Math.atan2(e[1]-t[1],e[0]-t[0]));return{left:"".concat(t[0],"px"),top:"".concat(t[1],"px"),width:"".concat(n,"px"),rotate:"".concat(r,"deg")}}[i,c,l,u,f]=v.then?(await v)():v,r()}catch(A){r(A)}}))},313:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{A:()=>v});var a=n(760),s=n(43),o=n(128),i=n(192),c=n.n(i),l=n(96),d=n(693),u=n(82),h=n(385),p=n(550),f=n(956),m=n(972),g=n(97),y=n(579),x=t([d,u,g]);function v(){const t=(0,s.useContext)(l.B),[e,n]=(0,s.useState)({zoom:1,mouseX:0,mouseY:0}),[r,o]=(0,s.useState)(null),[i,x]=(0,s.useState)(null),_=(0,s.useRef)(!1),v=(0,s.useRef)([]);(0,s.useEffect)((function(){if(!t.waterdrops)return;!function(){(0,m.f2)("#infobox, #mosaic-webgl, #mosaic-svg");a.select("#mosaic-svg").select(".svg-trans").append("g").attr("id","wide-group").append("text").attr("class","instruction-text large-gray-text fancy-font").attr("x",0-.6*t.waterdrops.height)}();const e=function(){const e=t=>{n((e=>({...e,zoom:t.k})))},r=t=>{n((e=>({...e,mouseX:t.x,mouseY:t.y})))};return t.addZoomHandler(e),window.addEventListener("mousemove",r),function(){window.removeEventListener("mousemove",r)}}();return g._.drawMinimapSVG(),e}),[]),(0,s.useEffect)((function(){if((0,f.ad)(t.state,"WideView")){const{transitionDuration:e=0}=t.state;return a.select("body").style("overflow","hidden"),_.current=!0,n((e=>({...e,zoom:t.camera.curTransform.k}))),console.time("drawing"),t.dropsMesh.draw(t.scene),console.timeEnd("drawing"),t.dropsMesh.updateVisibility(1),t.dropsMesh.updateOutlineVisibility(t.getOutlineOpacity(t.camera.curTransform.k)),function(){const e=a.select("#wide-group");g._.updateLargeDropSVG(e,t.waterdrops,{onClick:b,onHover:E,onUnhover:S});for(const t of v.current)e.select(".circlet#b".concat(t.key)).classed("active",!0);const n=20/t.camera.height*t.camera.getZFromFarHeight(t.waterdrops.height);e.select(".instruction-text").attr("y",5*-n).attr("text-anchor","end").attr("font-size",n).call((0,m.Y_)(["click to interact.","scroll to zoom.","drag to pan."],2)).selectAll("tspan").each((function(t,e){a.select(this).attr("dx",e*n)}))}(),(0,m.YB)("#infobox, #mosaic-webgl, #mosaic-svg, #wide-group"),function(){(0,m.f2)("#infobox, #wide-group"),_.current=!1}}}),[t.state]),(0,s.useEffect)((function(){_.current&&a.select("#wide-group").selectAll(".cloud-text").each(g._.fontSizer(e,t.camera,t.waterdrops.height))}),[e]);const w=(0,s.useCallback)((function(){t.setDisableCamAdjustments(!0);const{x:e,y:n,height:r}=v.current[0],a=[e,n-(0,p.jF)({height:r}),t.camera.getZFromFarHeight(r*h.W.SPREAD_1_2*1.5)],[s,o]=t.zoomTo(a,(function(){t.setDisableCamAdjustments(!1)}));s(),t.setState({state:"ExamineView",transitionDuration:o});const i=t.getOutlineOpacity(t.camera.curTransform.k);g._.fadeOutDrops(t.dropsMesh,t.scene,i,o/2)}),[]),D=(0,s.useCallback)((function(){t.setDisableCamAdjustments(!0);const e=(0,p.p6)(v.current.map((t=>[t.x,t.y]))),n=[...e,t.camera.getZFromFarHeight(2*t.waterdrops.groups[0].height*h.W.SPREAD_1_2*.75*2)],[r,a]=t.zoomTo(n,(function(){t.setDisableCamAdjustments(!1)}));r(),t.setState({state:"CompareView",transitionDuration:a,viewCenter:e});const s=t.getOutlineOpacity(t.camera.curTransform.k);g._.fadeOutDrops(t.dropsMesh,t.scene,s,a/5)}),[]),j=(0,s.useCallback)((function(){t.setActiveWaterdrops([]),v.current=[],a.selectAll("#wide-group .circlet").classed("active",!1)}),[]);function b(e){const n=a.select("#wide-group");t.setActiveWaterdrops((t=>(t.includes(e.key)?(t=(0,f.od)(t,e.key),v.current=(0,f.od)(v.current,e),n.select(".circlet#b".concat(e.key)).classed("active",!1)):(t.push(e.key),v.current.push(e),n.select(".circlet#b".concat(e.key)).classed("active",!0)),[...t])))}function E(t){var e;o({id:t.key,description:(null===(e=d.G[t.key])||void 0===e?void 0:e.desc)||t.key}),a.select("#minimap").select(".outline."+t.key).attr("fill","gray")}function S(t){o(null),a.select("#minimap").select(".outline."+t.key).attr("fill","transparent")}const L=(0,s.useMemo)((()=>null===i?[]:c().go(i,t.waterdrops.groups,{keys:[t=>t.key],limit:10,all:!0})),[i,t.waterdrops]);return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{id:"infobox",children:[(0,y.jsx)("svg",{id:"minimap"}),r&&(0,y.jsxs)("div",{className:"details",children:[!u.l.SPATIAL_FEATURES[r.id]&&(0,y.jsx)("p",{className:"no-loc-data",children:"No Location Data"}),(0,y.jsx)("p",{className:"curDesc",children:r.description}),(0,y.jsxs)("p",{className:"curKey",children:["id: ",(0,y.jsxs)("span",{children:[" ",r.id," "]})]})]}),!r&&(0,y.jsxs)("div",{className:"searchbox",children:[(0,y.jsx)("input",{type:"text",placeholder:"search",value:i||"",onChange:t=>x(t.target.value),onFocus:()=>{x(""),a.select(".results").style("display","flex")},onBlur:()=>{setTimeout((()=>{x(null),a.select(".results").style("display","none")}),100)}}),(0,y.jsx)("div",{className:"results",style:{display:"none"},children:L.map((t=>{let{obj:e}=t;return(0,y.jsx)("button",{onClick:()=>b(e),children:e.key},e.key)}))})]})]}),(0,y.jsx)("div",{className:"action-btn-wrapper",children:(0,y.jsx)(A,{appCtx:t,handleClickExamine:w,handleClickDeselectAll:j,handleClickCompare:D})})]})}function A(t){let e,n,{appCtx:r,handleClickExamine:a,handleClickDeselectAll:s,handleClickCompare:i}=t;return(0,f.ad)(r.state,"WideView")&&r.activeWaterdrops.length&&(1===r.activeWaterdrops.length?e=(0,y.jsxs)("button",{onClick:a,className:"wide-view-action-btn fancy-font",children:[(0,y.jsx)(o.WEK,{}),(0,y.jsx)("span",{children:"examine"})]}):n=(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("button",{onClick:s,className:"fancy-font supplement-btn",children:(0,y.jsx)("span",{children:"deselect all"})}),(0,y.jsxs)("button",{onClick:i,className:"wide-view-action-btn fancy-font",children:[(0,y.jsx)(o.IS1,{}),(0,y.jsx)("span",{children:"compare"})]})]})),(0,y.jsxs)(y.Fragment,{children:[e,n]})}[d,u,g]=x.then?(await x)():x,r()}catch(_){r(_)}}))},701:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{_:()=>w});var a=n(760),s=n(385),o=n(693),i=n(550),c=n(972),l=t([o]);function u(t){let{nodes:e,height:n}=t;return t=>{t.attr("class","large-drop"),t.append("circle").attr("class","highlight-circle").attr("stroke","none").attr("fill","yellow").attr("r",2*s.W.LOD_1_RAD_PX),t.append("text").style("font-size",n*s.W.SPREAD_1_2/15).attr("class","fancy-font large-gray-text").attr("text-anchor","middle"),t.selectAll(".small-drop").data(e).enter().append("g").attr("class","small-drop").each((function(t){a.select(this).call(p(t))}))}}function h(t,e){let{nodes:n,key:r,height:o}=t;return t=>{const c={};t.call(m(r,o)).selectAll(".small-drop").data(n).attr("display","initial").attr("transform",(t=>{let{x:e,y:n,tilt:r}=t;return"translate(".concat(e,", ").concat(n,") rotate(").concat(r,")")})).each((function(t){a.select(this).call(f(t,c))})).transition().delay(e).duration(1e3).attr("transform",(t=>{let{x:e,y:n,tilt:r}=t;return"translate(".concat(e*s.W.SPREAD_1_2,", ").concat(n*s.W.SPREAD_1_2,") rotate(").concat(r,")")})),t.select(".highlight-circle").attr("cx",c.x).attr("cy",c.y-(0,i.jF)({rad:s.W.LOD_1_RAD_PX})).transition().delay(e).duration(1e3).attr("cx",c.x*s.W.SPREAD_1_2).attr("cy",c.y*s.W.SPREAD_1_2-(0,i.jF)({rad:s.W.LOD_1_RAD_PX}))}}function p(t){let{levs:e,id:n}=t;return t=>{t.append("rect").attr("class","bbox").style("visibility","hidden");const r="compare-grad-".concat(n);t.call((0,c.ji)(e,r)),t.append("path").attr("d",c.js).attr("class","outline").attr("transform","scale(".concat(.95*s.W.LOD_1_RAD_PX,")")),t.append("path").attr("class","fill").attr("d",c.js).attr("fill","url(#".concat(r,")")).attr("transform","scale(".concat(s.W.LOD_1_RAD_PX,")"))}}function f(t,e){let{key:n,levs:r,maxLev:a,x:s,y:o}=t;return t=>{"expl0000"===n&&(e.x=s,e.y=o),t.call((0,c.GI)(r,a));const i=t.select(".fill").node().getBBox();t.select(".bbox").attr("x",i.x).attr("y",i.y).attr("width",i.width).attr("height",i.height)}}function m(t,e){return n=>{var r,a;n.select("text").attr("x",0).attr("y",e/2*s.W.SPREAD_1_2*.9).call((0,c.Y_)((null===(r=o.G[t])||void 0===r?void 0:r.display_name)||(null===(a=o.G[t])||void 0===a?void 0:a.id)||t))}}function g(t,e,n,r){let{onClick:s,onHover:o,onUnhover:i}=r;t.selectAll(".large-drop").data(e.groups).join((t=>t.append("g").each((function(t){a.select(this).call(u(t))})))).attr("transform",(t=>{let{x:e,y:n,tilt:r}=t;return"translate(".concat(e,", ").concat(n,") rotate(").concat(r,")")})).each((function(t){const e=a.select(this).call(h(t,n)).selectAll(".small-drop");s&&e.on("click",(function(t,e){s(e)})),o&&e.on("mouseenter",(function(t,e){a.select(this.parentNode).raise(),o(e)})),i&&e.on("mouseleave",(function(t,e){i(e)}))})).transition().delay(n).duration(1e3).attr("transform",((t,n)=>"translate(".concat(e.groupPositions[n][0],", ").concat(e.groupPositions[n][1],")")))}function y(t,e,n,r){t.selectAll(".color-drop-group").data(e.groups).join((t=>t.append("g").each((function(t){let{nodes:e}=t;a.select(this).call((t=>{t.attr("class","color-drop-group").selectAll(".color-drop").data(e).join("circle").attr("class","color-drop").attr("r",s.W.LOD_1_RAD_PX)}))})))).attr("transform",((t,n)=>"translate(".concat(e.groupPositions[n][0],", ").concat(e.groupPositions[n][1],")"))).each((function(){a.select(this).selectAll(".color-drop").call((t=>{t.attr("opacity",(t=>{let{key:e}=t;return n(e)})).attr("fill",r)})).attr("cx",(t=>{let{x:e}=t;return e*s.W.SPREAD_1_2})).attr("cy",(t=>{let{y:e}=t;return e*s.W.SPREAD_1_2}))}))}function x(t,e,n){const r=t.map((t=>e.groups.find((e=>e.key===t)))),a=[],o=r[0].height*s.W.SPREAD_1_2*.75;for(let s=0,i=r.length;s<i;s++){const t=2*Math.PI/i*(s-.5)-Math.PI/2;a.push([n[0]+Math.cos(t)*o,n[1]+Math.sin(t)*o])}return{groups:r,groupPositions:a}}function _(t,e){const n=[],r=[];for(let o=0;o<t.groups.length;o++){const a=t.groups[o],c=t.groupPositions[o],l=a.nodes.find((t=>t.key===e));r.push(l),n.push([l.x*s.W.SPREAD_1_2+c[0],l.y*s.W.SPREAD_1_2+c[1]-(0,i.jF)({rad:s.W.LOD_1_RAD_PX})])}const a=[];for(let o=0;o<n.length;o++){const t=Array.from(n[o]),e=Array.from(n[o+1==n.length?0:o+1]);(0,i.D5)([t,e],2*s.W.LOD_1_RAD_PX),a.push([t,e])}return[n,a,r]}function v(t,e,n){const[r,s]=t,o=n/15,i=n/10;a.select("#compare-group").select("#member-label").text("scenario").attr("font-size",o).transition().duration(100).attr("x",r).attr("y",s-1.5*o),a.select("#compare-group").select("#member-variable").attr("font-size",i).text(e).transition().duration(100).attr("x",r).attr("y",s)}function A(t,e){a.select("#compare-group").selectAll(".circlet").data(t).join("circle").attr("class","circlet").call(c.JB).attr("display","initial").attr("r",1.5*s.W.LOD_1_RAD_PX).transition().duration(100).attr("cx",(t=>t[0])).attr("cy",(t=>t[1])),a.select("#compare-group").selectAll(".comp-line").data(e).join("path").attr("class","comp-line").transition().duration(100).attr("d",(t=>a.line()(t)))}o=(l.then?(await l)():l)[0];const w={updateDropsSVG:g,updateColorDrops:y,getWaterdropGroups:x,calcLinesAndPositions:_,updateLabelSVG:v,updateScenIndicatorsSVG:A};r()}catch(d){r(d)}}))},285:(t,e,n)=>{n.d(e,{_:()=>i});var r=n(760),a=n(385),s=n(550),o=n(972);const i={updateSmallDropSVG:function(t,e,n,i){let{onClick:c,onHover:l,onUnhover:d}=i;const u={},h=t.selectAll(".small-drop").data(e.nodes).join((t=>t.append("g").each((function(t){r.select(this).call(function(t){let{levs:e,id:n}=t;return t=>{t.attr("class","small-drop hover-capture");const r="drop-fill-".concat(n);t.call((0,o.ji)(e,r)),t.append("path").attr("d",o.js).attr("class","outline"),t.append("path").attr("class","fill").attr("d",o.js).attr("fill","url(#".concat(r,")")),t.append("circle").attr("class","circlet interactive").call(o.JB).attr("cy",-(0,s.jF)({rad:1})).attr("r",1.5),t.append("rect").attr("class","bbox").style("visibility","hidden")}}(t))})))).attr("transform",(t=>{let{globalX:e,globalY:n,globalTilt:r}=t;return"translate(".concat(e,", ").concat(n,") rotate(").concat(r,")")})).each((function(t){r.select(this).call(function(t,e){let{key:n,levs:r,maxLev:s,id:i,x:c,y:l}=t;return t=>{"expl0000"===n&&(e.x=c,e.y=l),t.call((0,o.GI)(r,s)),t.select(".outline").attr("transform","scale(".concat(.95*a.W.LOD_1_RAD_PX,")")),t.select(".fill").attr("transform","scale(".concat(a.W.LOD_1_RAD_PX,")")),t.select(".circlet").attr("id","i".concat(i));const d=t.select(".fill").node().getBBox();t.select(".bbox").attr("x",d.x).attr("y",d.y).attr("width",d.width).attr("height",d.height)}}(t,u))}));c&&h.on("click",(function(t,e){c(e)})),l&&h.on("mouseenter",(function(t,e){l(e)})),d&&h.on("mouseleave",(function(t,e){d(e)})),h.transition().delay(n).duration(1e3).attr("transform",(t=>{let{x:n,y:r,tilt:s}=t;return"translate(".concat(e.x+n*a.W.SPREAD_1_2,", ").concat(e.y+r*a.W.SPREAD_1_2,") rotate(").concat(s,")")})),t.select(".highlight-circle").attr("stroke","none").attr("fill","yellow").attr("r",2*a.W.LOD_1_RAD_PX).attr("cx",e.x+u.x).attr("cy",e.y+u.y-(0,s.jF)({rad:a.W.LOD_1_RAD_PX})).attr("cx",e.x+u.x*a.W.SPREAD_1_2).attr("cy",e.y+u.y*a.W.SPREAD_1_2-(0,s.jF)({rad:a.W.LOD_1_RAD_PX}))},updateColorDrops:function(t,e,n,r){t.selectAll(".color-drop").data(e.nodes).join("circle").attr("class","color-drop").attr("r",a.W.LOD_1_RAD_PX).attr("opacity",(t=>{let{key:e}=t;return n(e)})).attr("fill",r).attr("cx",(t=>{let{x:n}=t;return e.x+n*a.W.SPREAD_1_2})).attr("cy",(t=>{let{y:n}=t;return e.y+n*a.W.SPREAD_1_2}))}}},97:(t,e,n)=>{n.a(t,(async(t,r)=>{try{n.d(e,{_:()=>w});var a=n(760),s=n(693),o=n(82),i=n(385),c=n(550),l=n(956),d=n(972),u=t([s,o]);function p(){const t=a.select(this);t.append("circle").attr("class","hover-capture").attr("fill","transparent").attr("stroke-width",0).attr("r",.8),t.append("circle").attr("class","circlet interactive").call(d.JB).attr("r",1);const e=t.append("g").attr("pointer-events","none");e.append("image").attr("href","glow.png").attr("preserveAspectRatio","none").attr("opacity",.8),e.append("text").attr("class","fancy-font cloud-text").attr("text-anchor","middle").attr("font-size",0)}function f(t){a.select(this).select(".circlet").attr("id","b".concat(t.key)),a.select(this).select("text").call(m(t))}function m(t){return function(e){e.selectAll("*").remove();const n=(0,l.LV)(t.key).split("\n");n.forEach(((t,r)=>{e.append("tspan").attr("x",0).attr("y","".concat(-n.length/2+.5,"em")).attr("dy","".concat(r,"em")).text(t)}))}}function g(t){let{x:e,y:n,height:r}=t;return"translate(".concat(e,", ").concat(n-(0,c.jF)({height:r}),") scale(").concat(r*i.W.GROUP_HOVER_AREA_FACTOR,")")}function y(t,e,n,r){const s=window.innerHeight/9,o=n/r/e;return((i=t*o)>s?0:a.scaleLinear().domain([0,s]).range([1,.4]).clamp(!0)(i))*Math.min(o,.4);var i}function x(){const t=a.select("#minimap").attr("width",200).attr("height",250),e=a.geoMercator().scale(1e3).center(o.l.CALIFORNIA_CENTER).translate([100,125]),n=[...o.l.SPATIAL_DATA.features.filter((t=>"MultiPolygon"===t.geometry.type)),o.l.CALIFORNIA_OUTLINE],r=o.l.SPATIAL_DATA.features.filter((t=>"MultiPoint"===t.geometry.type));t.selectAll("path").data(n).join("path").attr("d",(t=>a.geoPath().projection(e)(t))).attr("class",(t=>"outline "+t.properties.CalLiteID)).attr("stroke",(t=>t.properties.CalLiteID?"transparent":"gray")).attr("stroke-width",1).attr("fill","transparent"),t.selectAll("circle").data(r).join("circle").each((function(t){const n=a.select(this),[r,s]=e(t.geometry.coordinates[0]);n.attr("cx",r),n.attr("cy",s)})).attr("r",2).attr("class",(t=>"outline "+t.properties.CalLiteID)).attr("fill","transparent")}function _(t,e,n){let{onClick:r,onHover:s,onUnhover:o}=n;const i=t.selectAll(".large-drop").data(e.groups,(t=>{let{key:e}=t;return e})).join((t=>t.append("g").attr("class","large-drop").each(p))).each(f).attr("transform",g).select(".hover-capture");r&&i.on("click",(function(t,e){r(e)})),s&&i.on("mouseenter",(function(t,e){a.select(this.parentNode).raise(),s(e)})),o&&i.on("mouseleave",(function(t,e){o(e)}))}function v(t,e,n){return function(){const r=a.select(this).node(),[s,o]=(0,c.kt)(r.getBoundingClientRect()),i=r.getBBox().width*e.height/e.far*8,l=r.getBBox().height*e.height/e.far*10,d=(0,c.xg)([s,o],[t.mouseX,t.mouseY]);a.select(this).attr("font-size",y(d,t.zoom,e.height,n)),a.select(this.parentNode.parentNode).select("image").attr("x",-i/2).attr("y",-l/2).attr("width",i).attr("height",l)}}function A(t,e,n,r){const s=a.timer((a=>{const o=Math.min(1,a/r);t.updateVisibility(1-o),t.updateOutlineVisibility(n*(1-o)),o>=1&&(s.stop(),t.remove(e))}))}[s,o]=u.then?(await u)():u;const w={drawMinimapSVG:x,updateLargeDropSVG:_,fontSizer:v,fadeOutDrops:A};r()}catch(h){r(h)}}))}}]);
//# sourceMappingURL=805.a00ca900.chunk.js.map